'use strict';const a2_0x12dd45=a2_0x4785;(function(_0x58a766,_0x27826e){const _0x1b438f=a2_0x4785,_0x23228e=_0x58a766();while(!![]){try{const _0x10eca9=parseInt(_0x1b438f(0xe4))/0x1*(parseInt(_0x1b438f(0xa5))/0x2)+parseInt(_0x1b438f(0xdd))/0x3+parseInt(_0x1b438f(0xca))/0x4*(-parseInt(_0x1b438f(0xbf))/0x5)+-parseInt(_0x1b438f(0xc8))/0x6+-parseInt(_0x1b438f(0xaa))/0x7*(parseInt(_0x1b438f(0xd0))/0x8)+parseInt(_0x1b438f(0xcc))/0x9*(parseInt(_0x1b438f(0xcb))/0xa)+-parseInt(_0x1b438f(0xdf))/0xb;if(_0x10eca9===_0x27826e)break;else _0x23228e['push'](_0x23228e['shift']());}catch(_0x2a8d31){_0x23228e['push'](_0x23228e['shift']());}}}(a2_0x39b2,0x9d77e));function a2_0x4785(_0x148fce,_0x562e0a){const _0x39b257=a2_0x39b2();return a2_0x4785=function(_0x4785bd,_0x435855){_0x4785bd=_0x4785bd-0x9c;let _0x30839f=_0x39b257[_0x4785bd];return _0x30839f;},a2_0x4785(_0x148fce,_0x562e0a);}var __decorate=this&&this['__decorate']||function(_0x2fb1fb,_0x2a00cd,_0x38867c,_0x1598f5){const _0x308cef=a2_0x4785;var _0x1fd204=arguments['length'],_0x2e4467=_0x1fd204<0x3?_0x2a00cd:_0x1598f5===null?_0x1598f5=Object[_0x308cef(0xc2)](_0x2a00cd,_0x38867c):_0x1598f5,_0x2cca3f;if(typeof Reflect===_0x308cef(0xb6)&&typeof Reflect['decorate']==='function')_0x2e4467=Reflect[_0x308cef(0xd2)](_0x2fb1fb,_0x2a00cd,_0x38867c,_0x1598f5);else{for(var _0x3be483=_0x2fb1fb[_0x308cef(0xa4)]-0x1;_0x3be483>=0x0;_0x3be483--)if(_0x2cca3f=_0x2fb1fb[_0x3be483])_0x2e4467=(_0x1fd204<0x3?_0x2cca3f(_0x2e4467):_0x1fd204>0x3?_0x2cca3f(_0x2a00cd,_0x38867c,_0x2e4467):_0x2cca3f(_0x2a00cd,_0x38867c))||_0x2e4467;}return _0x1fd204>0x3&&_0x2e4467&&Object['defineProperty'](_0x2a00cd,_0x38867c,_0x2e4467),_0x2e4467;},__metadata=this&&this['__metadata']||function(_0x2466dd,_0x409bc0){const _0x224ada=a2_0x4785;if(typeof Reflect===_0x224ada(0xb6)&&typeof Reflect[_0x224ada(0xd4)]===_0x224ada(0x9f))return Reflect[_0x224ada(0xd4)](_0x2466dd,_0x409bc0);},AgendaService_1;Object['defineProperty'](exports,a2_0x12dd45(0xd6),{'value':!![]}),exports['AgendaService']=void 0x0;const common_1=require('@nestjs/common'),nestjs_agenda_1=require(a2_0x12dd45(0xc5)),event_emitter_1=require('@nestjs/event-emitter'),mongodb_1=require('mongodb'),enums_1=require(a2_0x12dd45(0xbe)),events_1=require(a2_0x12dd45(0xd8)),job_1=require('../common/job'),dtos_1=require(a2_0x12dd45(0xcd)),mappers_1=require(a2_0x12dd45(0xe8)),voice_mapper_1=require(a2_0x12dd45(0xae)),textToAudio_mapper_1=require(a2_0x12dd45(0xc9));let AgendaService=AgendaService_1=class AgendaService{constructor(_0x3523d9){const _0x3924a3=a2_0x12dd45;this[_0x3924a3(0xbc)]=_0x3523d9,this[_0x3924a3(0xab)]=new common_1[(_0x3924a3(0xa6))](AgendaService_1['name']),this[_0x3924a3(0xe2)]();}async[a2_0x12dd45(0xe2)](){const _0xe6a20e=a2_0x12dd45;await this[_0xe6a20e(0xbc)][_0xe6a20e(0xa9)](),this[_0xe6a20e(0xbc)][_0xe6a20e(0xc7)](_0xe6a20e(0xd9),enums_1[_0xe6a20e(0xa1)][_0xe6a20e(0xde)]),this[_0xe6a20e(0xbc)][_0xe6a20e(0xc7)]('0\x200\x20*\x20*\x20*',enums_1['BackgroundJobType'][_0xe6a20e(0xd1)]),this[_0xe6a20e(0xbc)]['now'](enums_1['BackgroundJobType'][_0xe6a20e(0xde)],null);}async[a2_0x12dd45(0xb5)](){const _0x40a4b3=a2_0x12dd45;this['logger']['log'](_0x40a4b3(0xb0)),await this[_0x40a4b3(0xbc)]['cancel']({'name':{'$in':Object[_0x40a4b3(0xba)](enums_1[_0x40a4b3(0xb9)])}}),this[_0x40a4b3(0xbc)][_0x40a4b3(0xa3)](enums_1['BackgroundJobType'][_0x40a4b3(0xde)],null);}async[a2_0x12dd45(0xdb)](){const _0x19caf2=a2_0x12dd45,_0x1c44e9=await this[_0x19caf2(0xbc)][_0x19caf2(0xe7)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x1c44e9;}async[a2_0x12dd45(0xda)](_0x564a2c){const _0x54d2d1=a2_0x12dd45,_0xda7808=this[_0x54d2d1(0xb7)](_0x564a2c),_0x2531d1=(0x0,dtos_1[_0x54d2d1(0xb8)])(_0x564a2c),_0x404162=_0x2531d1?_0x564a2c[_0x54d2d1(0xa0)]:_0x564a2c[_0x54d2d1(0xc7)];let _0x59b0ea;return _0x2531d1?_0x59b0ea=await this[_0x54d2d1(0xbc)][_0x54d2d1(0xac)](_0x404162,_0x564a2c[_0x54d2d1(0xa7)],_0xda7808):_0x59b0ea=await this[_0x54d2d1(0xbc)]['every'](_0x404162,_0x564a2c['jobType'],_0xda7808,{'startDate':new Date(_0x564a2c[_0x54d2d1(0xa8)]),'endDate':new Date(_0x564a2c[_0x54d2d1(0xd5)]),'skipImmediate':!![]}),{'jobId':_0x59b0ea[_0x54d2d1(0xcf)][_0x54d2d1(0xd3)][_0x54d2d1(0xb3)]()};}async['cancelJob'](_0x2f904d){const _0x7f884=a2_0x12dd45,_0xb56b9f=await this[_0x7f884(0xbc)]['jobs']({'_id':new mongodb_1['ObjectId'](_0x2f904d)});if(!_0xb56b9f[_0x7f884(0xa4)])return{'success':!![],'message':_0x7f884(0xd7)+_0x2f904d+_0x7f884(0xe0)};const _0x254c94=await this[_0x7f884(0xbc)][_0x7f884(0x9d)]({'_id':new mongodb_1[(_0x7f884(0xa2))](_0x2f904d)});job_1[_0x7f884(0xe1)][_0x7f884(0xe5)](_0x2f904d);if(_0x254c94)return{'success':!![],'message':_0x7f884(0xd7)+_0x2f904d+'\x20is\x20cancelled'};return{'success':![],'message':_0x7f884(0xbd)+_0x2f904d};}async['rescheduleJob'](_0x1e2542,_0x12de87){return await this['cancelJob'](_0x1e2542),await this['scheduleJob'](_0x12de87);}[a2_0x12dd45(0xb7)](_0x48b549){const _0x645593=a2_0x12dd45;switch(_0x48b549[_0x645593(0xa7)]){case enums_1[_0x645593(0xb9)][_0x645593(0x9c)]:{return(0x0,mappers_1['toPlaySoundCommand'])(_0x48b549);}case enums_1['JobType'][_0x645593(0xb2)]:{return(0x0,mappers_1[_0x645593(0xb4)])(_0x48b549);}case enums_1[_0x645593(0xb9)][_0x645593(0xaf)]:{return(0x0,voice_mapper_1[_0x645593(0xce)])(_0x48b549);}case enums_1[_0x645593(0xb9)][_0x645593(0xbb)]:{return(0x0,textToAudio_mapper_1['toPlayTextToAudioCommand'])(_0x48b549);}default:throw new common_1['NotFoundException']('Job\x20type\x20not\x20found');}}};function a2_0x39b2(){const _0x4863e=['object','getJobPayload','isScheduleJobDTO','JobType','values','PlayTextToAudio','agendaAgent','Failed\x20to\x20cancel\x20job\x20','../common/enums','2211060bMxHeX','design:returntype','Injectable','getOwnPropertyDescriptor','EventChangedEvent','design:type','@agent-ly/nestjs-agenda','Updated','every','541548bjOEKl','./mappers/textToAudio.mapper','8DXJILw','50JsTpZY','1896849NESxMe','./dtos','toPlayVoiceCommand','attrs','752nLXVpa','PurgeTempUploadedFiles','decorate','_id','metadata','endDate','__esModule','Job\x20','../common/events','0\x200\x20*\x20*\x20*','scheduleJob','getJobs','design:paramtypes','2967603zeTofZ','CheckEvent','16632187UBHLZB','\x20not\x20found','PROCESS_CACHE','initialize','prototype','653bKQMEo','killProcess','AgendaService','jobs','./mappers','PlaySound','cancel','OnEvent','function','when','BackgroundJobType','ObjectId','now','length','3394sssdSX','Logger','jobType','startDate','purge','1449VaroCe','logger','schedule','Deleted','./mappers/voice.mapper','PlayVoiceRecorded','Scheduling\x20events...','ScheduleChangedEvent','PlayMusic','toString','toPlayMusicCommand','rescheduleEvents'];a2_0x39b2=function(){return _0x4863e;};return a2_0x39b2();}__decorate([(0x0,event_emitter_1[a2_0x12dd45(0x9e)])(events_1[a2_0x12dd45(0xb1)][a2_0x12dd45(0xc6)]),(0x0,event_emitter_1[a2_0x12dd45(0x9e)])(events_1[a2_0x12dd45(0xb1)][a2_0x12dd45(0xad)]),(0x0,event_emitter_1[a2_0x12dd45(0x9e)])(events_1[a2_0x12dd45(0xc3)]['Created']),(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x12dd45(0xc3)][a2_0x12dd45(0xc6)]),(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x12dd45(0xc3)]['Deleted']),__metadata(a2_0x12dd45(0xc4),Function),__metadata('design:paramtypes',[]),__metadata(a2_0x12dd45(0xc0),Promise)],AgendaService[a2_0x12dd45(0xe3)],a2_0x12dd45(0xb5),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x12dd45(0xc1)])(),__metadata(a2_0x12dd45(0xdc),[nestjs_agenda_1[a2_0x12dd45(0xe6)]])],AgendaService),exports[a2_0x12dd45(0xe6)]=AgendaService;