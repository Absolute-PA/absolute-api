'use strict';function a2_0x8b5e(_0x28bc49,_0xe483ce){const _0x1454bb=a2_0x1454();return a2_0x8b5e=function(_0x8b5ee7,_0x587669){_0x8b5ee7=_0x8b5ee7-0x1e5;let _0xb5f495=_0x1454bb[_0x8b5ee7];return _0xb5f495;},a2_0x8b5e(_0x28bc49,_0xe483ce);}const a2_0x5b1090=a2_0x8b5e;function a2_0x1454(){const _0x3ee673=['Updated','Injectable','2326600QsoEzP','agendaAgent','105162yMLItV','@agent-ly/nestjs-agenda','CheckEvent','length','toString','object','Deleted','BackgroundJobType','rescheduleEvents','now','startDate','PurgeTempUploadedFiles','../common/job','_id','defineProperty','./dtos','OnEvent','cancel','toPlayMusicCommand','decorate','isScheduleJobDTO','function','design:paramtypes','PlaySound','PlayTextToAudio','133MonhCL','jobs','design:returntype','PlayMusic','ScheduleChangedEvent','Failed\x20to\x20cancel\x20job\x20','Logger','log','__decorate','./mappers/voice.mapper','jobType','schedule','cancelJob','design:type','JobType','../common/enums','__esModule','0\x200\x20*\x20*\x20*','497921ScibZM','Scheduling\x20events...','values','8775952RiLkmA','NotFoundException','470nDoGVA','429201ZsEQae','3696464dzXHzz','prototype','ObjectId','./mappers','AgendaService','logger','initialize','toPlayVoiceCommand','\x20not\x20found','killProcess','getJobs','rescheduleJob','2NimZTx','./mappers/textToAudio.mapper','@nestjs/common','2096109NVQmla','EventChangedEvent','PlayVoiceRecorded','scheduleJob','Job\x20','getOwnPropertyDescriptor','attrs','name','every','getJobPayload','@nestjs/event-emitter','metadata'];a2_0x1454=function(){return _0x3ee673;};return a2_0x1454();}(function(_0x3d66ab,_0x893338){const _0xb1bff0=a2_0x8b5e,_0x1f9385=_0x3d66ab();while(!![]){try{const _0x635dd5=-parseInt(_0xb1bff0(0x20c))/0x1*(parseInt(_0xb1bff0(0x21f))/0x2)+parseInt(_0xb1bff0(0x222))/0x3+-parseInt(_0xb1bff0(0x213))/0x4+parseInt(_0xb1bff0(0x230))/0x5+-parseInt(_0xb1bff0(0x232))/0x6*(parseInt(_0xb1bff0(0x1fa))/0x7)+-parseInt(_0xb1bff0(0x20f))/0x8+-parseInt(_0xb1bff0(0x212))/0x9*(-parseInt(_0xb1bff0(0x211))/0xa);if(_0x635dd5===_0x893338)break;else _0x1f9385['push'](_0x1f9385['shift']());}catch(_0x3b2306){_0x1f9385['push'](_0x1f9385['shift']());}}}(a2_0x1454,0x87192));var __decorate=this&&this[a2_0x5b1090(0x202)]||function(_0x1ffd05,_0x3b8136,_0x2c4339,_0x309032){const _0x3e8ac0=a2_0x5b1090;var _0x5c10c0=arguments[_0x3e8ac0(0x235)],_0x16cbb1=_0x5c10c0<0x3?_0x3b8136:_0x309032===null?_0x309032=Object[_0x3e8ac0(0x227)](_0x3b8136,_0x2c4339):_0x309032,_0x3c7635;if(typeof Reflect===_0x3e8ac0(0x1e6)&&typeof Reflect['decorate']===_0x3e8ac0(0x1f6))_0x16cbb1=Reflect[_0x3e8ac0(0x1f4)](_0x1ffd05,_0x3b8136,_0x2c4339,_0x309032);else{for(var _0x560bc6=_0x1ffd05[_0x3e8ac0(0x235)]-0x1;_0x560bc6>=0x0;_0x560bc6--)if(_0x3c7635=_0x1ffd05[_0x560bc6])_0x16cbb1=(_0x5c10c0<0x3?_0x3c7635(_0x16cbb1):_0x5c10c0>0x3?_0x3c7635(_0x3b8136,_0x2c4339,_0x16cbb1):_0x3c7635(_0x3b8136,_0x2c4339))||_0x16cbb1;}return _0x5c10c0>0x3&&_0x16cbb1&&Object[_0x3e8ac0(0x1ef)](_0x3b8136,_0x2c4339,_0x16cbb1),_0x16cbb1;},__metadata=this&&this['__metadata']||function(_0x5a6ff9,_0x413a05){const _0x4062bd=a2_0x5b1090;if(typeof Reflect==='object'&&typeof Reflect[_0x4062bd(0x22d)]===_0x4062bd(0x1f6))return Reflect[_0x4062bd(0x22d)](_0x5a6ff9,_0x413a05);},AgendaService_1;Object[a2_0x5b1090(0x1ef)](exports,a2_0x5b1090(0x20a),{'value':!![]}),exports[a2_0x5b1090(0x217)]=void 0x0;const common_1=require(a2_0x5b1090(0x221)),nestjs_agenda_1=require(a2_0x5b1090(0x233)),event_emitter_1=require(a2_0x5b1090(0x22c)),mongodb_1=require('mongodb'),enums_1=require(a2_0x5b1090(0x209)),events_1=require('../common/events'),job_1=require(a2_0x5b1090(0x1ed)),dtos_1=require(a2_0x5b1090(0x1f0)),mappers_1=require(a2_0x5b1090(0x216)),voice_mapper_1=require(a2_0x5b1090(0x203)),textToAudio_mapper_1=require(a2_0x5b1090(0x220));let AgendaService=AgendaService_1=class AgendaService{constructor(_0xb61d50){const _0x4c9133=a2_0x5b1090;this['agendaAgent']=_0xb61d50,this[_0x4c9133(0x218)]=new common_1[(_0x4c9133(0x200))](AgendaService_1[_0x4c9133(0x229)]),this[_0x4c9133(0x219)]();}async[a2_0x5b1090(0x219)](){const _0x1165a5=a2_0x5b1090;await this['agendaAgent']['purge'](),this[_0x1165a5(0x231)][_0x1165a5(0x22a)](_0x1165a5(0x20b),enums_1['BackgroundJobType'][_0x1165a5(0x234)]),this['agendaAgent'][_0x1165a5(0x22a)](_0x1165a5(0x20b),enums_1[_0x1165a5(0x1e8)][_0x1165a5(0x1ec)]),this[_0x1165a5(0x231)][_0x1165a5(0x1ea)](enums_1[_0x1165a5(0x1e8)][_0x1165a5(0x234)],null);}async[a2_0x5b1090(0x1e9)](){const _0x14d4d3=a2_0x5b1090;this['logger'][_0x14d4d3(0x201)](_0x14d4d3(0x20d)),await this['agendaAgent']['cancel']({'name':{'$in':Object[_0x14d4d3(0x20e)](enums_1['JobType'])}}),this[_0x14d4d3(0x231)][_0x14d4d3(0x1ea)](enums_1[_0x14d4d3(0x1e8)]['CheckEvent'],null);}async[a2_0x5b1090(0x21d)](){const _0xed60db=a2_0x5b1090,_0x58d644=await this['agendaAgent'][_0xed60db(0x1fb)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x58d644;}async[a2_0x5b1090(0x225)](_0xc886c4){const _0x2174e9=a2_0x5b1090,_0x4cdd16=this[_0x2174e9(0x22b)](_0xc886c4),_0x30eed5=(0x0,dtos_1[_0x2174e9(0x1f5)])(_0xc886c4),_0x1e951e=_0x30eed5?_0xc886c4['when']:_0xc886c4[_0x2174e9(0x22a)];let _0x304224;return _0x30eed5?_0x304224=await this[_0x2174e9(0x231)][_0x2174e9(0x205)](_0x1e951e,_0xc886c4[_0x2174e9(0x204)],_0x4cdd16):_0x304224=await this[_0x2174e9(0x231)][_0x2174e9(0x22a)](_0x1e951e,_0xc886c4['jobType'],_0x4cdd16,{'startDate':new Date(_0xc886c4[_0x2174e9(0x1eb)]),'endDate':new Date(_0xc886c4['endDate']),'skipImmediate':!![]}),{'jobId':_0x304224[_0x2174e9(0x228)][_0x2174e9(0x1ee)][_0x2174e9(0x1e5)]()};}async['cancelJob'](_0x421fca){const _0xaa6252=a2_0x5b1090,_0x1c9675=await this[_0xaa6252(0x231)][_0xaa6252(0x1fb)]({'_id':new mongodb_1[(_0xaa6252(0x215))](_0x421fca)});if(!_0x1c9675[_0xaa6252(0x235)])return{'success':!![],'message':'Job\x20'+_0x421fca+_0xaa6252(0x21b)};const _0x11c33c=await this[_0xaa6252(0x231)][_0xaa6252(0x1f2)]({'_id':new mongodb_1[(_0xaa6252(0x215))](_0x421fca)});job_1['PROCESS_CACHE'][_0xaa6252(0x21c)](_0x421fca);if(_0x11c33c)return{'success':!![],'message':_0xaa6252(0x226)+_0x421fca+'\x20is\x20cancelled'};return{'success':![],'message':_0xaa6252(0x1ff)+_0x421fca};}async[a2_0x5b1090(0x21e)](_0x2c947e,_0x932d68){const _0x55d298=a2_0x5b1090;return await this[_0x55d298(0x206)](_0x2c947e),await this[_0x55d298(0x225)](_0x932d68);}['getJobPayload'](_0x3872e9){const _0x19a864=a2_0x5b1090;switch(_0x3872e9[_0x19a864(0x204)]){case enums_1[_0x19a864(0x208)][_0x19a864(0x1f8)]:{return(0x0,mappers_1['toPlaySoundCommand'])(_0x3872e9);}case enums_1['JobType'][_0x19a864(0x1fd)]:{return(0x0,mappers_1[_0x19a864(0x1f3)])(_0x3872e9);}case enums_1[_0x19a864(0x208)][_0x19a864(0x224)]:{return(0x0,voice_mapper_1[_0x19a864(0x21a)])(_0x3872e9);}case enums_1['JobType'][_0x19a864(0x1f9)]:{return(0x0,textToAudio_mapper_1['toPlayTextToAudioCommand'])(_0x3872e9);}default:throw new common_1[(_0x19a864(0x210))]('Job\x20type\x20not\x20found');}}};__decorate([(0x0,event_emitter_1[a2_0x5b1090(0x1f1)])(events_1[a2_0x5b1090(0x1fe)]['Updated']),(0x0,event_emitter_1[a2_0x5b1090(0x1f1)])(events_1[a2_0x5b1090(0x1fe)][a2_0x5b1090(0x1e7)]),(0x0,event_emitter_1[a2_0x5b1090(0x1f1)])(events_1['EventChangedEvent']['Created']),(0x0,event_emitter_1[a2_0x5b1090(0x1f1)])(events_1[a2_0x5b1090(0x223)][a2_0x5b1090(0x22e)]),(0x0,event_emitter_1[a2_0x5b1090(0x1f1)])(events_1[a2_0x5b1090(0x223)][a2_0x5b1090(0x1e7)]),__metadata(a2_0x5b1090(0x207),Function),__metadata(a2_0x5b1090(0x1f7),[]),__metadata(a2_0x5b1090(0x1fc),Promise)],AgendaService[a2_0x5b1090(0x214)],a2_0x5b1090(0x1e9),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x5b1090(0x22f)])(),__metadata(a2_0x5b1090(0x1f7),[nestjs_agenda_1['AgendaService']])],AgendaService),exports[a2_0x5b1090(0x217)]=AgendaService;