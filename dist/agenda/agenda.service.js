'use strict';const a2_0x17351d=a2_0x199a;(function(_0x52ca2a,_0x5bdfe6){const _0x1c536d=a2_0x199a,_0x4273c1=_0x52ca2a();while(!![]){try{const _0x621c18=-parseInt(_0x1c536d(0xcf))/0x1*(-parseInt(_0x1c536d(0xe1))/0x2)+-parseInt(_0x1c536d(0xf3))/0x3*(parseInt(_0x1c536d(0xfe))/0x4)+-parseInt(_0x1c536d(0x100))/0x5*(-parseInt(_0x1c536d(0xcd))/0x6)+-parseInt(_0x1c536d(0xc7))/0x7+-parseInt(_0x1c536d(0xcc))/0x8*(parseInt(_0x1c536d(0xe5))/0x9)+-parseInt(_0x1c536d(0xc6))/0xa*(-parseInt(_0x1c536d(0xd6))/0xb)+parseInt(_0x1c536d(0xdd))/0xc;if(_0x621c18===_0x5bdfe6)break;else _0x4273c1['push'](_0x4273c1['shift']());}catch(_0x114655){_0x4273c1['push'](_0x4273c1['shift']());}}}(a2_0x42d6,0x1ae76));function a2_0x42d6(){const _0x484f1f=['PlayVoiceRecorded','prototype','OnEvent','PlayMusic','toString','NotFoundException','purge','object','BackgroundJobType','initialize','logger','Updated','cancel','1413260nlBAlx','1371902jMTsex','design:type','killProcess','mongodb','every','4040qcFAiw','354BeRmke','./dtos','991kAnVEx','toPlayMusicCommand','PROCESS_CACHE','schedule','name','jobs','toPlayTextToAudioCommand','11hWnoks','Job\x20','endDate','@nestjs/common','design:returntype','_id','scheduleJob','575520ZiBzLn','0\x200\x20*\x20*\x20*','__esModule','function','316qsvPdJ','../common/events','ObjectId','Scheduling\x20events...','3267dkGYaa','getOwnPropertyDescriptor','PlaySound','defineProperty','log','@agent-ly/nestjs-agenda','\x20not\x20found','attrs','jobType','design:paramtypes','AgendaService','rescheduleEvents','__decorate','when','6PFsGzW','Injectable','JobType','rescheduleJob','../common/enums','Job\x20type\x20not\x20found','agendaAgent','length','Created','ScheduleChangedEvent','getJobPayload','131276wJEFfL','decorate','17735nTKJGJ','PurgeTempUploadedFiles','@nestjs/event-emitter','metadata','EventChangedEvent','./mappers/textToAudio.mapper','\x20is\x20cancelled','./mappers/voice.mapper','now','getJobs','Deleted'];a2_0x42d6=function(){return _0x484f1f;};return a2_0x42d6();}var __decorate=this&&this[a2_0x17351d(0xf1)]||function(_0x127109,_0x43a70b,_0x1ac203,_0x20db63){const _0x46cfd3=a2_0x17351d;var _0x3ea580=arguments[_0x46cfd3(0xfa)],_0x203c48=_0x3ea580<0x3?_0x43a70b:_0x20db63===null?_0x20db63=Object[_0x46cfd3(0xe6)](_0x43a70b,_0x1ac203):_0x20db63,_0x1a423a;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x46cfd3(0xe0))_0x203c48=Reflect[_0x46cfd3(0xff)](_0x127109,_0x43a70b,_0x1ac203,_0x20db63);else{for(var _0x1097f4=_0x127109[_0x46cfd3(0xfa)]-0x1;_0x1097f4>=0x0;_0x1097f4--)if(_0x1a423a=_0x127109[_0x1097f4])_0x203c48=(_0x3ea580<0x3?_0x1a423a(_0x203c48):_0x3ea580>0x3?_0x1a423a(_0x43a70b,_0x1ac203,_0x203c48):_0x1a423a(_0x43a70b,_0x1ac203))||_0x203c48;}return _0x3ea580>0x3&&_0x203c48&&Object[_0x46cfd3(0xe8)](_0x43a70b,_0x1ac203,_0x203c48),_0x203c48;},__metadata=this&&this['__metadata']||function(_0x1fe1c1,_0x203b27){const _0x58dcbc=a2_0x17351d;if(typeof Reflect===_0x58dcbc(0xc0)&&typeof Reflect[_0x58dcbc(0x103)]==='function')return Reflect[_0x58dcbc(0x103)](_0x1fe1c1,_0x203b27);},AgendaService_1;Object[a2_0x17351d(0xe8)](exports,a2_0x17351d(0xdf),{'value':!![]}),exports[a2_0x17351d(0xef)]=void 0x0;const common_1=require(a2_0x17351d(0xd9)),nestjs_agenda_1=require(a2_0x17351d(0xea)),event_emitter_1=require(a2_0x17351d(0x102)),mongodb_1=require(a2_0x17351d(0xca)),enums_1=require(a2_0x17351d(0xf7)),events_1=require(a2_0x17351d(0xe2)),job_1=require('../common/job'),dtos_1=require(a2_0x17351d(0xce)),mappers_1=require('./mappers'),voice_mapper_1=require(a2_0x17351d(0xb5)),textToAudio_mapper_1=require(a2_0x17351d(0x105));function a2_0x199a(_0xd394ca,_0x3b5515){const _0x42d6e9=a2_0x42d6();return a2_0x199a=function(_0x199af8,_0x2b3e0e){_0x199af8=_0x199af8-0xb4;let _0x5ee5ed=_0x42d6e9[_0x199af8];return _0x5ee5ed;},a2_0x199a(_0xd394ca,_0x3b5515);}let AgendaService=AgendaService_1=class AgendaService{constructor(_0x3c3245){const _0x35bbac=a2_0x17351d;this[_0x35bbac(0xf9)]=_0x3c3245,this[_0x35bbac(0xc3)]=new common_1['Logger'](AgendaService_1[_0x35bbac(0xd3)]),this[_0x35bbac(0xc2)]();}async['initialize'](){const _0x56f75e=a2_0x17351d;await this[_0x56f75e(0xf9)][_0x56f75e(0xbf)](),this[_0x56f75e(0xf9)][_0x56f75e(0xcb)](_0x56f75e(0xde),enums_1[_0x56f75e(0xc1)]['CheckEvent']),this[_0x56f75e(0xf9)]['every'](_0x56f75e(0xde),enums_1[_0x56f75e(0xc1)][_0x56f75e(0x101)]),this['agendaAgent'][_0x56f75e(0xb6)](enums_1[_0x56f75e(0xc1)]['CheckEvent'],null);}async['rescheduleEvents'](){const _0x154be1=a2_0x17351d;this[_0x154be1(0xc3)][_0x154be1(0xe9)](_0x154be1(0xe4)),await this[_0x154be1(0xf9)][_0x154be1(0xc5)]({'name':{'$in':Object['values'](enums_1['JobType'])}}),this[_0x154be1(0xf9)][_0x154be1(0xb6)](enums_1[_0x154be1(0xc1)]['CheckEvent'],null);}async[a2_0x17351d(0xb7)](){const _0x4d9479=a2_0x17351d,_0x172721=await this[_0x4d9479(0xf9)][_0x4d9479(0xd4)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x172721;}async[a2_0x17351d(0xdc)](_0x2a7d27){const _0x2381a5=a2_0x17351d,_0x431d7c=this[_0x2381a5(0xfd)](_0x2a7d27),_0x18efb2=(0x0,dtos_1['isScheduleJobDTO'])(_0x2a7d27),_0x1cff07=_0x18efb2?_0x2a7d27[_0x2381a5(0xf2)]:_0x2a7d27[_0x2381a5(0xcb)];let _0x220914;return _0x18efb2?_0x220914=await this['agendaAgent'][_0x2381a5(0xd2)](_0x1cff07,_0x2a7d27['jobType'],_0x431d7c):_0x220914=await this['agendaAgent'][_0x2381a5(0xcb)](_0x1cff07,_0x2a7d27[_0x2381a5(0xed)],_0x431d7c,{'startDate':new Date(_0x2a7d27['startDate']),'endDate':new Date(_0x2a7d27[_0x2381a5(0xd8)]),'skipImmediate':!![]}),{'jobId':_0x220914[_0x2381a5(0xec)][_0x2381a5(0xdb)][_0x2381a5(0xbd)]()};}async['cancelJob'](_0x5e6718){const _0x1a29b5=a2_0x17351d,_0x68a1c3=await this[_0x1a29b5(0xf9)][_0x1a29b5(0xd4)]({'_id':new mongodb_1[(_0x1a29b5(0xe3))](_0x5e6718)});if(!_0x68a1c3[_0x1a29b5(0xfa)])return{'success':!![],'message':_0x1a29b5(0xd7)+_0x5e6718+_0x1a29b5(0xeb)};const _0x3235e6=await this['agendaAgent'][_0x1a29b5(0xc5)]({'_id':new mongodb_1['ObjectId'](_0x5e6718)});job_1[_0x1a29b5(0xd1)][_0x1a29b5(0xc9)](_0x5e6718);if(_0x3235e6)return{'success':!![],'message':_0x1a29b5(0xd7)+_0x5e6718+_0x1a29b5(0xb4)};return{'success':![],'message':'Failed\x20to\x20cancel\x20job\x20'+_0x5e6718};}async[a2_0x17351d(0xf6)](_0x55406d,_0x121542){const _0xf6f795=a2_0x17351d;return await this['cancelJob'](_0x55406d),await this[_0xf6f795(0xdc)](_0x121542);}[a2_0x17351d(0xfd)](_0x202d62){const _0x32be41=a2_0x17351d;switch(_0x202d62[_0x32be41(0xed)]){case enums_1['JobType'][_0x32be41(0xe7)]:{return(0x0,mappers_1['toPlaySoundCommand'])(_0x202d62);}case enums_1[_0x32be41(0xf5)][_0x32be41(0xbc)]:{return(0x0,mappers_1[_0x32be41(0xd0)])(_0x202d62);}case enums_1[_0x32be41(0xf5)][_0x32be41(0xb9)]:{return(0x0,voice_mapper_1['toPlayVoiceCommand'])(_0x202d62);}case enums_1['JobType']['PlayTextToAudio']:{return(0x0,textToAudio_mapper_1[_0x32be41(0xd5)])(_0x202d62);}default:throw new common_1[(_0x32be41(0xbe))](_0x32be41(0xf8));}}};__decorate([(0x0,event_emitter_1[a2_0x17351d(0xbb)])(events_1[a2_0x17351d(0xfc)][a2_0x17351d(0xc4)]),(0x0,event_emitter_1[a2_0x17351d(0xbb)])(events_1[a2_0x17351d(0xfc)][a2_0x17351d(0xb8)]),(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x17351d(0x104)][a2_0x17351d(0xfb)]),(0x0,event_emitter_1[a2_0x17351d(0xbb)])(events_1[a2_0x17351d(0x104)][a2_0x17351d(0xc4)]),(0x0,event_emitter_1[a2_0x17351d(0xbb)])(events_1[a2_0x17351d(0x104)][a2_0x17351d(0xb8)]),__metadata(a2_0x17351d(0xc8),Function),__metadata('design:paramtypes',[]),__metadata(a2_0x17351d(0xda),Promise)],AgendaService[a2_0x17351d(0xba)],a2_0x17351d(0xf0),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x17351d(0xf4)])(),__metadata(a2_0x17351d(0xee),[nestjs_agenda_1[a2_0x17351d(0xef)]])],AgendaService),exports[a2_0x17351d(0xef)]=AgendaService;