'use strict';const a2_0x4996d8=a2_0x25a2;(function(_0x27bba1,_0x71683c){const _0x357d0d=a2_0x25a2,_0x3017db=_0x27bba1();while(!![]){try{const _0x12b7d3=-parseInt(_0x357d0d(0xbb))/0x1+parseInt(_0x357d0d(0x9f))/0x2+parseInt(_0x357d0d(0x98))/0x3+parseInt(_0x357d0d(0xd3))/0x4*(parseInt(_0x357d0d(0xd5))/0x5)+parseInt(_0x357d0d(0xc8))/0x6*(parseInt(_0x357d0d(0xd7))/0x7)+-parseInt(_0x357d0d(0xa3))/0x8*(parseInt(_0x357d0d(0xe0))/0x9)+-parseInt(_0x357d0d(0xb0))/0xa;if(_0x12b7d3===_0x71683c)break;else _0x3017db['push'](_0x3017db['shift']());}catch(_0x68eddd){_0x3017db['push'](_0x3017db['shift']());}}}(a2_0x2e89,0x7c390));function a2_0x2e89(){const _0x5316d2=['9bfdsjp','Created','./mappers/voice.mapper','AgendaService','./mappers/textToAudio.mapper','2049243jBcxih','toString','decorate','logger','BackgroundJobType','Job\x20type\x20not\x20found','__esModule','1318604lJqJEY','toPlayVoiceCommand','purge','getJobPayload','1789064yrFLoe','toPlaySoundCommand','toPlayTextToAudioCommand','design:type','PlayVoiceRecorded','design:paramtypes','function','endDate','rescheduleJob','PlayTextToAudio','cancelJob','every','0\x200\x20*\x20*\x20*','12785450ytVbAL','schedule','values','./mappers','name','PlayMusic','EventChangedEvent','rescheduleEvents','startDate','JobType','PurgeTempUploadedFiles','419476NAISaY','initialize','../common/enums','when','Job\x20','toPlayMusicCommand','jobs','_id','@nestjs/common','defineProperty','OnEvent','Updated','../common/job','405774VVtkEv','isScheduleJobDTO','object','@agent-ly/nestjs-agenda','../common/events','agendaAgent','metadata','Deleted','Logger','design:returntype','__decorate','956YAtnbj','\x20is\x20cancelled','8615TBKytI','jobType','70LZivTr','getJobs','PROCESS_CACHE','CheckEvent','length','log','\x20not\x20found','./dtos','now'];a2_0x2e89=function(){return _0x5316d2;};return a2_0x2e89();}function a2_0x25a2(_0x1b0436,_0x26e8d2){const _0x2e8988=a2_0x2e89();return a2_0x25a2=function(_0x25a205,_0x16e9a3){_0x25a205=_0x25a205-0x98;let _0x14d3e4=_0x2e8988[_0x25a205];return _0x14d3e4;},a2_0x25a2(_0x1b0436,_0x26e8d2);}var __decorate=this&&this[a2_0x4996d8(0xd2)]||function(_0x500757,_0x6d7ea6,_0x871c53,_0x9416bf){const _0x5e6975=a2_0x4996d8;var _0x4a7a2f=arguments[_0x5e6975(0xdb)],_0x5530a8=_0x4a7a2f<0x3?_0x6d7ea6:_0x9416bf===null?_0x9416bf=Object['getOwnPropertyDescriptor'](_0x6d7ea6,_0x871c53):_0x9416bf,_0x57eac3;if(typeof Reflect===_0x5e6975(0xca)&&typeof Reflect[_0x5e6975(0x9a)]===_0x5e6975(0xa9))_0x5530a8=Reflect['decorate'](_0x500757,_0x6d7ea6,_0x871c53,_0x9416bf);else{for(var _0x193818=_0x500757[_0x5e6975(0xdb)]-0x1;_0x193818>=0x0;_0x193818--)if(_0x57eac3=_0x500757[_0x193818])_0x5530a8=(_0x4a7a2f<0x3?_0x57eac3(_0x5530a8):_0x4a7a2f>0x3?_0x57eac3(_0x6d7ea6,_0x871c53,_0x5530a8):_0x57eac3(_0x6d7ea6,_0x871c53))||_0x5530a8;}return _0x4a7a2f>0x3&&_0x5530a8&&Object[_0x5e6975(0xc4)](_0x6d7ea6,_0x871c53,_0x5530a8),_0x5530a8;},__metadata=this&&this['__metadata']||function(_0x75248f,_0x3b5aa1){const _0x1fcfa9=a2_0x4996d8;if(typeof Reflect===_0x1fcfa9(0xca)&&typeof Reflect[_0x1fcfa9(0xce)]===_0x1fcfa9(0xa9))return Reflect[_0x1fcfa9(0xce)](_0x75248f,_0x3b5aa1);},AgendaService_1;Object[a2_0x4996d8(0xc4)](exports,a2_0x4996d8(0x9e),{'value':!![]}),exports[a2_0x4996d8(0xe3)]=void 0x0;const common_1=require(a2_0x4996d8(0xc3)),nestjs_agenda_1=require(a2_0x4996d8(0xcb)),event_emitter_1=require('@nestjs/event-emitter'),mongodb_1=require('mongodb'),enums_1=require(a2_0x4996d8(0xbd)),events_1=require(a2_0x4996d8(0xcc)),job_1=require(a2_0x4996d8(0xc7)),dtos_1=require(a2_0x4996d8(0xde)),mappers_1=require(a2_0x4996d8(0xb3)),voice_mapper_1=require(a2_0x4996d8(0xe2)),textToAudio_mapper_1=require(a2_0x4996d8(0xe4));let AgendaService=AgendaService_1=class AgendaService{constructor(_0x21d3bc){const _0x14bb4e=a2_0x4996d8;this[_0x14bb4e(0xcd)]=_0x21d3bc,this[_0x14bb4e(0x9b)]=new common_1[(_0x14bb4e(0xd0))](AgendaService_1[_0x14bb4e(0xb4)]),this[_0x14bb4e(0xbc)]();}async['initialize'](){const _0xe5aadb=a2_0x4996d8;await this[_0xe5aadb(0xcd)][_0xe5aadb(0xa1)](),this[_0xe5aadb(0xcd)]['every'](_0xe5aadb(0xaf),enums_1['BackgroundJobType'][_0xe5aadb(0xda)]),this[_0xe5aadb(0xcd)][_0xe5aadb(0xae)](_0xe5aadb(0xaf),enums_1[_0xe5aadb(0x9c)][_0xe5aadb(0xba)]),this[_0xe5aadb(0xcd)][_0xe5aadb(0xdf)](enums_1[_0xe5aadb(0x9c)][_0xe5aadb(0xda)],null);}async['rescheduleEvents'](){const _0x56494c=a2_0x4996d8;this[_0x56494c(0x9b)][_0x56494c(0xdc)]('Scheduling\x20events...'),await this[_0x56494c(0xcd)]['cancel']({'name':{'$in':Object[_0x56494c(0xb2)](enums_1[_0x56494c(0xb9)])}}),this['agendaAgent'][_0x56494c(0xdf)](enums_1[_0x56494c(0x9c)][_0x56494c(0xda)],null);}async[a2_0x4996d8(0xd8)](){const _0x108b0f=a2_0x4996d8,_0x1c352e=await this['agendaAgent'][_0x108b0f(0xc1)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x1c352e;}async['scheduleJob'](_0x941b92){const _0x3fb39f=a2_0x4996d8,_0x21c90a=this[_0x3fb39f(0xa2)](_0x941b92),_0xd55802=(0x0,dtos_1[_0x3fb39f(0xc9)])(_0x941b92),_0x44325f=_0xd55802?_0x941b92[_0x3fb39f(0xbe)]:_0x941b92[_0x3fb39f(0xae)];let _0x53356e;return _0xd55802?_0x53356e=await this[_0x3fb39f(0xcd)][_0x3fb39f(0xb1)](_0x44325f,_0x941b92[_0x3fb39f(0xd6)],_0x21c90a):_0x53356e=await this[_0x3fb39f(0xcd)][_0x3fb39f(0xae)](_0x44325f,_0x941b92[_0x3fb39f(0xd6)],_0x21c90a,{'startDate':new Date(_0x941b92[_0x3fb39f(0xb8)]),'endDate':new Date(_0x941b92[_0x3fb39f(0xaa)]),'skipImmediate':!![]}),{'jobId':_0x53356e['attrs'][_0x3fb39f(0xc2)][_0x3fb39f(0x99)]()};}async[a2_0x4996d8(0xad)](_0x4c6d81){const _0x447f12=a2_0x4996d8,_0x37edda=await this['agendaAgent'][_0x447f12(0xc1)]({'_id':new mongodb_1['ObjectId'](_0x4c6d81)});if(!_0x37edda[_0x447f12(0xdb)])return{'success':!![],'message':_0x447f12(0xbf)+_0x4c6d81+_0x447f12(0xdd)};const _0x545b73=await this[_0x447f12(0xcd)]['cancel']({'_id':new mongodb_1['ObjectId'](_0x4c6d81)});job_1[_0x447f12(0xd9)]['killProcess'](_0x4c6d81);if(_0x545b73)return{'success':!![],'message':_0x447f12(0xbf)+_0x4c6d81+_0x447f12(0xd4)};return{'success':![],'message':'Failed\x20to\x20cancel\x20job\x20'+_0x4c6d81};}async[a2_0x4996d8(0xab)](_0x8e3d84,_0x4eecb0){const _0x441c8a=a2_0x4996d8;return await this[_0x441c8a(0xad)](_0x8e3d84),await this['scheduleJob'](_0x4eecb0);}[a2_0x4996d8(0xa2)](_0x52c6c5){const _0x2e9475=a2_0x4996d8;switch(_0x52c6c5[_0x2e9475(0xd6)]){case enums_1[_0x2e9475(0xb9)]['PlaySound']:{return(0x0,mappers_1[_0x2e9475(0xa4)])(_0x52c6c5);}case enums_1['JobType'][_0x2e9475(0xb5)]:{return(0x0,mappers_1[_0x2e9475(0xc0)])(_0x52c6c5);}case enums_1['JobType'][_0x2e9475(0xa7)]:{return(0x0,voice_mapper_1[_0x2e9475(0xa0)])(_0x52c6c5);}case enums_1['JobType'][_0x2e9475(0xac)]:{return(0x0,textToAudio_mapper_1[_0x2e9475(0xa5)])(_0x52c6c5);}default:throw new common_1['NotFoundException'](_0x2e9475(0x9d));}}};__decorate([(0x0,event_emitter_1[a2_0x4996d8(0xc5)])(events_1['ScheduleChangedEvent'][a2_0x4996d8(0xc6)]),(0x0,event_emitter_1['OnEvent'])(events_1['ScheduleChangedEvent'][a2_0x4996d8(0xcf)]),(0x0,event_emitter_1[a2_0x4996d8(0xc5)])(events_1['EventChangedEvent'][a2_0x4996d8(0xe1)]),(0x0,event_emitter_1[a2_0x4996d8(0xc5)])(events_1[a2_0x4996d8(0xb6)][a2_0x4996d8(0xc6)]),(0x0,event_emitter_1[a2_0x4996d8(0xc5)])(events_1[a2_0x4996d8(0xb6)][a2_0x4996d8(0xcf)]),__metadata(a2_0x4996d8(0xa6),Function),__metadata(a2_0x4996d8(0xa8),[]),__metadata(a2_0x4996d8(0xd1),Promise)],AgendaService['prototype'],a2_0x4996d8(0xb7),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(a2_0x4996d8(0xa8),[nestjs_agenda_1[a2_0x4996d8(0xe3)]])],AgendaService),exports[a2_0x4996d8(0xe3)]=AgendaService;