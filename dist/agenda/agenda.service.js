'use strict';function a2_0x102c(){const _0x2e0ebe=['PlaySound','PROCESS_CACHE','__metadata','toPlayMusicCommand','__esModule','now','jobs','every','./mappers','EventChangedEvent','Job\x20','toPlaySoundCommand','./mappers/voice.mapper','CheckEvent','../common/enums','decorate','47695GrjuSl','Deleted','toString','AgendaService','rescheduleEvents','2406456KIEoKz','isScheduleJobDTO','1603360OFMvet','@nestjs/event-emitter','metadata','Logger','endDate','values','911920SmDHBh','jobType','../common/job','cancelJob','killProcess','\x20is\x20cancelled','ObjectId','0\x200\x20*\x20*\x20*','getOwnPropertyDescriptor','Failed\x20to\x20cancel\x20job\x20','defineProperty','6jRLPaN','NotFoundException','design:paramtypes','Job\x20type\x20not\x20found','function','976871HoIIEg','@nestjs/common','2UwpgCz','getJobs','3600FyrkUq','Injectable','PlayVoiceRecorded','OnEvent','2236904tfHpTT','getJobPayload','./mappers/textToAudio.mapper','object','length','852daPZgO','JobType','when','agendaAgent','PlayTextToAudio','Scheduling\x20events...','attrs','scheduleJob','name','\x20not\x20found','Updated','ScheduleChangedEvent','cancel','Created','BackgroundJobType','PlayMusic'];a2_0x102c=function(){return _0x2e0ebe;};return a2_0x102c();}const a2_0x36589b=a2_0x8320;(function(_0x2aa250,_0x19c132){const _0x213688=a2_0x8320,_0x248532=_0x2aa250();while(!![]){try{const _0x51a42c=-parseInt(_0x213688(0x20b))/0x1*(-parseInt(_0x213688(0x1e0))/0x2)+-parseInt(_0x213688(0x1eb))/0x3*(parseInt(_0x213688(0x1e2))/0x4)+-parseInt(_0x213688(0x218))/0x5+parseInt(_0x213688(0x1d9))/0x6*(-parseInt(_0x213688(0x1de))/0x7)+parseInt(_0x213688(0x1e6))/0x8+parseInt(_0x213688(0x210))/0x9+parseInt(_0x213688(0x212))/0xa;if(_0x51a42c===_0x19c132)break;else _0x248532['push'](_0x248532['shift']());}catch(_0x570df5){_0x248532['push'](_0x248532['shift']());}}}(a2_0x102c,0x2b553));var __decorate=this&&this['__decorate']||function(_0x15675e,_0x5513bd,_0x10f1d3,_0x561eaa){const _0x48d5a1=a2_0x8320;var _0x577ebc=arguments['length'],_0x5dfa66=_0x577ebc<0x3?_0x5513bd:_0x561eaa===null?_0x561eaa=Object[_0x48d5a1(0x1d6)](_0x5513bd,_0x10f1d3):_0x561eaa,_0x39b0c2;if(typeof Reflect===_0x48d5a1(0x1e9)&&typeof Reflect[_0x48d5a1(0x20a)]===_0x48d5a1(0x1dd))_0x5dfa66=Reflect['decorate'](_0x15675e,_0x5513bd,_0x10f1d3,_0x561eaa);else{for(var _0x2ca7bd=_0x15675e[_0x48d5a1(0x1ea)]-0x1;_0x2ca7bd>=0x0;_0x2ca7bd--)if(_0x39b0c2=_0x15675e[_0x2ca7bd])_0x5dfa66=(_0x577ebc<0x3?_0x39b0c2(_0x5dfa66):_0x577ebc>0x3?_0x39b0c2(_0x5513bd,_0x10f1d3,_0x5dfa66):_0x39b0c2(_0x5513bd,_0x10f1d3))||_0x5dfa66;}return _0x577ebc>0x3&&_0x5dfa66&&Object[_0x48d5a1(0x1d8)](_0x5513bd,_0x10f1d3,_0x5dfa66),_0x5dfa66;},__metadata=this&&this[a2_0x36589b(0x1fd)]||function(_0x2bd87b,_0x261e0f){const _0x425aa2=a2_0x36589b;if(typeof Reflect==='object'&&typeof Reflect[_0x425aa2(0x214)]===_0x425aa2(0x1dd))return Reflect[_0x425aa2(0x214)](_0x2bd87b,_0x261e0f);},AgendaService_1;Object[a2_0x36589b(0x1d8)](exports,a2_0x36589b(0x1ff),{'value':!![]}),exports[a2_0x36589b(0x20e)]=void 0x0;function a2_0x8320(_0x229b6a,_0x58020f){const _0x102c3c=a2_0x102c();return a2_0x8320=function(_0x83207c,_0x4c2536){_0x83207c=_0x83207c-0x1d4;let _0x3f7fcd=_0x102c3c[_0x83207c];return _0x3f7fcd;},a2_0x8320(_0x229b6a,_0x58020f);}const common_1=require(a2_0x36589b(0x1df)),nestjs_agenda_1=require('@agent-ly/nestjs-agenda'),event_emitter_1=require(a2_0x36589b(0x213)),mongodb_1=require('mongodb'),enums_1=require(a2_0x36589b(0x209)),events_1=require('../common/events'),job_1=require(a2_0x36589b(0x21a)),dtos_1=require('./dtos'),mappers_1=require(a2_0x36589b(0x203)),voice_mapper_1=require(a2_0x36589b(0x207)),textToAudio_mapper_1=require(a2_0x36589b(0x1e8));let AgendaService=AgendaService_1=class AgendaService{constructor(_0x1f3183){const _0x5bd7b9=a2_0x36589b;this[_0x5bd7b9(0x1ee)]=_0x1f3183,this['logger']=new common_1[(_0x5bd7b9(0x215))](AgendaService_1[_0x5bd7b9(0x1f3)]),this['initialize']();}async['initialize'](){const _0x1f1bda=a2_0x36589b;await this[_0x1f1bda(0x1ee)]['purge'](),this[_0x1f1bda(0x1ee)][_0x1f1bda(0x202)](_0x1f1bda(0x1d5),enums_1[_0x1f1bda(0x1f9)][_0x1f1bda(0x208)]),this[_0x1f1bda(0x1ee)]['every']('0\x200\x20*\x20*\x20*',enums_1[_0x1f1bda(0x1f9)]['PurgeTempUploadedFiles']),this[_0x1f1bda(0x1ee)][_0x1f1bda(0x200)](enums_1[_0x1f1bda(0x1f9)]['CheckEvent'],null);}async[a2_0x36589b(0x20f)](){const _0x1c4f0c=a2_0x36589b;this['logger']['log'](_0x1c4f0c(0x1f0)),await this[_0x1c4f0c(0x1ee)][_0x1c4f0c(0x1f7)]({'name':{'$in':Object[_0x1c4f0c(0x217)](enums_1[_0x1c4f0c(0x1ec)])}}),this['agendaAgent'][_0x1c4f0c(0x200)](enums_1[_0x1c4f0c(0x1f9)]['CheckEvent'],null);}async[a2_0x36589b(0x1e1)](){const _0x483a54=a2_0x36589b,_0x549a2b=await this[_0x483a54(0x1ee)][_0x483a54(0x201)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x549a2b;}async[a2_0x36589b(0x1f2)](_0x3daa8b){const _0xd569cd=a2_0x36589b,_0x5d59c2=this[_0xd569cd(0x1e7)](_0x3daa8b),_0x1c8c3c=(0x0,dtos_1[_0xd569cd(0x211)])(_0x3daa8b),_0x137fa3=_0x1c8c3c?_0x3daa8b[_0xd569cd(0x1ed)]:_0x3daa8b[_0xd569cd(0x202)];let _0x13af91;return _0x1c8c3c?_0x13af91=await this[_0xd569cd(0x1ee)]['schedule'](_0x137fa3,_0x3daa8b[_0xd569cd(0x219)],_0x5d59c2):_0x13af91=await this[_0xd569cd(0x1ee)][_0xd569cd(0x202)](_0x137fa3,_0x3daa8b[_0xd569cd(0x219)],_0x5d59c2,{'startDate':new Date(_0x3daa8b['startDate']),'endDate':new Date(_0x3daa8b[_0xd569cd(0x216)]),'skipImmediate':!![]}),{'jobId':_0x13af91[_0xd569cd(0x1f1)]['_id'][_0xd569cd(0x20d)]()};}async[a2_0x36589b(0x21b)](_0x276d0c){const _0x13d161=a2_0x36589b,_0x15cca4=await this[_0x13d161(0x1ee)][_0x13d161(0x201)]({'_id':new mongodb_1[(_0x13d161(0x1d4))](_0x276d0c)});if(!_0x15cca4[_0x13d161(0x1ea)])return{'success':!![],'message':_0x13d161(0x205)+_0x276d0c+_0x13d161(0x1f4)};const _0x5ec27d=await this['agendaAgent'][_0x13d161(0x1f7)]({'_id':new mongodb_1[(_0x13d161(0x1d4))](_0x276d0c)});job_1[_0x13d161(0x1fc)][_0x13d161(0x21c)](_0x276d0c);if(_0x5ec27d)return{'success':!![],'message':_0x13d161(0x205)+_0x276d0c+_0x13d161(0x21d)};return{'success':![],'message':_0x13d161(0x1d7)+_0x276d0c};}async['rescheduleJob'](_0xd113ac,_0x31276c){const _0x16bafb=a2_0x36589b;return await this[_0x16bafb(0x21b)](_0xd113ac),await this['scheduleJob'](_0x31276c);}[a2_0x36589b(0x1e7)](_0x4ec391){const _0x1be643=a2_0x36589b;switch(_0x4ec391[_0x1be643(0x219)]){case enums_1[_0x1be643(0x1ec)][_0x1be643(0x1fb)]:{return(0x0,mappers_1[_0x1be643(0x206)])(_0x4ec391);}case enums_1['JobType'][_0x1be643(0x1fa)]:{return(0x0,mappers_1[_0x1be643(0x1fe)])(_0x4ec391);}case enums_1[_0x1be643(0x1ec)][_0x1be643(0x1e4)]:{return(0x0,voice_mapper_1['toPlayVoiceCommand'])(_0x4ec391);}case enums_1[_0x1be643(0x1ec)][_0x1be643(0x1ef)]:{return(0x0,textToAudio_mapper_1['toPlayTextToAudioCommand'])(_0x4ec391);}default:throw new common_1[(_0x1be643(0x1da))](_0x1be643(0x1dc));}}};__decorate([(0x0,event_emitter_1[a2_0x36589b(0x1e5)])(events_1[a2_0x36589b(0x1f6)]['Updated']),(0x0,event_emitter_1[a2_0x36589b(0x1e5)])(events_1['ScheduleChangedEvent'][a2_0x36589b(0x20c)]),(0x0,event_emitter_1[a2_0x36589b(0x1e5)])(events_1[a2_0x36589b(0x204)][a2_0x36589b(0x1f8)]),(0x0,event_emitter_1[a2_0x36589b(0x1e5)])(events_1['EventChangedEvent'][a2_0x36589b(0x1f5)]),(0x0,event_emitter_1[a2_0x36589b(0x1e5)])(events_1[a2_0x36589b(0x204)][a2_0x36589b(0x20c)]),__metadata('design:type',Function),__metadata(a2_0x36589b(0x1db),[]),__metadata('design:returntype',Promise)],AgendaService['prototype'],a2_0x36589b(0x20f),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x36589b(0x1e3)])(),__metadata(a2_0x36589b(0x1db),[nestjs_agenda_1[a2_0x36589b(0x20e)]])],AgendaService),exports[a2_0x36589b(0x20e)]=AgendaService;