'use strict';const a2_0x4156b8=a2_0x27d0;function a2_0x27d0(_0x2db56e,_0xb39584){const _0x597c1b=a2_0x597c();return a2_0x27d0=function(_0x27d0f1,_0x1194ec){_0x27d0f1=_0x27d0f1-0x13c;let _0x260712=_0x597c1b[_0x27d0f1];return _0x260712;},a2_0x27d0(_0x2db56e,_0xb39584);}(function(_0x374d0e,_0xea03){const _0x5cb27a=a2_0x27d0,_0x169389=_0x374d0e();while(!![]){try{const _0x3d281a=-parseInt(_0x5cb27a(0x188))/0x1+parseInt(_0x5cb27a(0x13e))/0x2*(-parseInt(_0x5cb27a(0x16f))/0x3)+parseInt(_0x5cb27a(0x17a))/0x4*(parseInt(_0x5cb27a(0x17b))/0x5)+parseInt(_0x5cb27a(0x180))/0x6*(-parseInt(_0x5cb27a(0x145))/0x7)+-parseInt(_0x5cb27a(0x168))/0x8+parseInt(_0x5cb27a(0x15b))/0x9*(-parseInt(_0x5cb27a(0x150))/0xa)+parseInt(_0x5cb27a(0x18a))/0xb*(parseInt(_0x5cb27a(0x141))/0xc);if(_0x3d281a===_0xea03)break;else _0x169389['push'](_0x169389['shift']());}catch(_0x479974){_0x169389['push'](_0x169389['shift']());}}}(a2_0x597c,0x2ffbb));var __decorate=this&&this[a2_0x4156b8(0x182)]||function(_0x214ed3,_0x48bf28,_0x3690dd,_0x23bfe7){const _0x3550a3=a2_0x4156b8;var _0x341be4=arguments['length'],_0x120901=_0x341be4<0x3?_0x48bf28:_0x23bfe7===null?_0x23bfe7=Object[_0x3550a3(0x15d)](_0x48bf28,_0x3690dd):_0x23bfe7,_0x5df7cc;if(typeof Reflect===_0x3550a3(0x14a)&&typeof Reflect['decorate']===_0x3550a3(0x159))_0x120901=Reflect[_0x3550a3(0x18b)](_0x214ed3,_0x48bf28,_0x3690dd,_0x23bfe7);else{for(var _0x4c4fe7=_0x214ed3[_0x3550a3(0x186)]-0x1;_0x4c4fe7>=0x0;_0x4c4fe7--)if(_0x5df7cc=_0x214ed3[_0x4c4fe7])_0x120901=(_0x341be4<0x3?_0x5df7cc(_0x120901):_0x341be4>0x3?_0x5df7cc(_0x48bf28,_0x3690dd,_0x120901):_0x5df7cc(_0x48bf28,_0x3690dd))||_0x120901;}return _0x341be4>0x3&&_0x120901&&Object[_0x3550a3(0x13c)](_0x48bf28,_0x3690dd,_0x120901),_0x120901;},__metadata=this&&this['__metadata']||function(_0x601b0,_0x19a9e7){const _0x1f55ad=a2_0x4156b8;if(typeof Reflect===_0x1f55ad(0x14a)&&typeof Reflect[_0x1f55ad(0x155)]===_0x1f55ad(0x159))return Reflect[_0x1f55ad(0x155)](_0x601b0,_0x19a9e7);},AgendaService_1;Object[a2_0x4156b8(0x13c)](exports,a2_0x4156b8(0x16e),{'value':!![]}),exports[a2_0x4156b8(0x144)]=void 0x0;const common_1=require(a2_0x4156b8(0x17f)),nestjs_agenda_1=require(a2_0x4156b8(0x14b)),event_emitter_1=require('@nestjs/event-emitter'),mongodb_1=require('mongodb'),enums_1=require('../common/enums'),events_1=require(a2_0x4156b8(0x185)),job_1=require(a2_0x4156b8(0x183)),dtos_1=require(a2_0x4156b8(0x15c)),mappers_1=require(a2_0x4156b8(0x146)),voice_mapper_1=require(a2_0x4156b8(0x147)),textToAudio_mapper_1=require('./mappers/textToAudio.mapper');function a2_0x597c(){const _0x12175e=['decorate','defineProperty','prototype','2PCDExb','values','killProcess','252oEYmLc','cancel','JobType','AgendaService','1409786sFUTRd','./mappers','./mappers/voice.mapper','now','Created','object','@agent-ly/nestjs-agenda','PlayMusic','design:type','toPlayMusicCommand','cancelJob','5080veccjH','startDate','attrs','jobs','PROCESS_CACHE','metadata','ObjectId','Failed\x20to\x20cancel\x20job\x20','purge','function','BackgroundJobType','864elWQSy','./dtos','getOwnPropertyDescriptor','getJobPayload','log','scheduleJob','agendaAgent','Job\x20','Updated','schedule','rescheduleEvents','PlayTextToAudio','0\x200\x20*\x20*\x20*','681136ARkZCU','toString','toPlayTextToAudioCommand','\x20not\x20found','toPlaySoundCommand','_id','__esModule','133941VzGeKx','isScheduleJobDTO','EventChangedEvent','Job\x20type\x20not\x20found','Injectable','design:paramtypes','logger','ScheduleChangedEvent','rescheduleJob','CheckEvent','initialize','1012728aoNaUj','5utNDJd','every','PlaySound','PlayVoiceRecorded','@nestjs/common','6RaHQJB','design:returntype','__decorate','../common/job','OnEvent','../common/events','length','endDate','377689XPQVkx','\x20is\x20cancelled','367191wPXdCI'];a2_0x597c=function(){return _0x12175e;};return a2_0x597c();}let AgendaService=AgendaService_1=class AgendaService{constructor(_0x119fdc){const _0x3ba4dc=a2_0x4156b8;this[_0x3ba4dc(0x161)]=_0x119fdc,this[_0x3ba4dc(0x175)]=new common_1['Logger'](AgendaService_1['name']),this[_0x3ba4dc(0x179)]();}async[a2_0x4156b8(0x179)](){const _0x188463=a2_0x4156b8;await this[_0x188463(0x161)][_0x188463(0x158)](),this[_0x188463(0x161)]['every']('0\x200\x20*\x20*\x20*',enums_1[_0x188463(0x15a)]['CheckEvent']),this[_0x188463(0x161)]['every'](_0x188463(0x167),enums_1[_0x188463(0x15a)]['PurgeTempUploadedFiles']),this['agendaAgent'][_0x188463(0x148)](enums_1[_0x188463(0x15a)][_0x188463(0x178)],null);}async[a2_0x4156b8(0x165)](){const _0x483cc4=a2_0x4156b8;this['logger'][_0x483cc4(0x15f)]('Scheduling\x20events...'),await this[_0x483cc4(0x161)][_0x483cc4(0x142)]({'name':{'$in':Object[_0x483cc4(0x13f)](enums_1['JobType'])}}),this[_0x483cc4(0x161)]['now'](enums_1[_0x483cc4(0x15a)]['CheckEvent'],null);}async['getJobs'](){const _0x2dce4a=a2_0x4156b8,_0x50b498=await this['agendaAgent'][_0x2dce4a(0x153)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x50b498;}async[a2_0x4156b8(0x160)](_0x572ee6){const _0x4891ab=a2_0x4156b8,_0x27e4ad=this[_0x4891ab(0x15e)](_0x572ee6),_0x341266=(0x0,dtos_1[_0x4891ab(0x170)])(_0x572ee6),_0x2f8917=_0x341266?_0x572ee6['when']:_0x572ee6['every'];let _0x5b0bd8;return _0x341266?_0x5b0bd8=await this['agendaAgent'][_0x4891ab(0x164)](_0x2f8917,_0x572ee6['jobType'],_0x27e4ad):_0x5b0bd8=await this[_0x4891ab(0x161)][_0x4891ab(0x17c)](_0x2f8917,_0x572ee6['jobType'],_0x27e4ad,{'startDate':new Date(_0x572ee6[_0x4891ab(0x151)]),'endDate':new Date(_0x572ee6[_0x4891ab(0x187)]),'skipImmediate':!![]}),{'jobId':_0x5b0bd8[_0x4891ab(0x152)][_0x4891ab(0x16d)][_0x4891ab(0x169)]()};}async[a2_0x4156b8(0x14f)](_0x21f32a){const _0x37c756=a2_0x4156b8,_0x235abc=await this[_0x37c756(0x161)]['jobs']({'_id':new mongodb_1['ObjectId'](_0x21f32a)});if(!_0x235abc[_0x37c756(0x186)])return{'success':!![],'message':_0x37c756(0x162)+_0x21f32a+_0x37c756(0x16b)};const _0x4af3d8=await this[_0x37c756(0x161)][_0x37c756(0x142)]({'_id':new mongodb_1[(_0x37c756(0x156))](_0x21f32a)});job_1[_0x37c756(0x154)][_0x37c756(0x140)](_0x21f32a);if(_0x4af3d8)return{'success':!![],'message':_0x37c756(0x162)+_0x21f32a+_0x37c756(0x189)};return{'success':![],'message':_0x37c756(0x157)+_0x21f32a};}async[a2_0x4156b8(0x177)](_0x16027d,_0x313954){const _0x34cc74=a2_0x4156b8;return await this[_0x34cc74(0x14f)](_0x16027d),await this[_0x34cc74(0x160)](_0x313954);}[a2_0x4156b8(0x15e)](_0x2b0eac){const _0x5b3f94=a2_0x4156b8;switch(_0x2b0eac['jobType']){case enums_1[_0x5b3f94(0x143)][_0x5b3f94(0x17d)]:{return(0x0,mappers_1[_0x5b3f94(0x16c)])(_0x2b0eac);}case enums_1[_0x5b3f94(0x143)][_0x5b3f94(0x14c)]:{return(0x0,mappers_1[_0x5b3f94(0x14e)])(_0x2b0eac);}case enums_1[_0x5b3f94(0x143)][_0x5b3f94(0x17e)]:{return(0x0,voice_mapper_1['toPlayVoiceCommand'])(_0x2b0eac);}case enums_1[_0x5b3f94(0x143)][_0x5b3f94(0x166)]:{return(0x0,textToAudio_mapper_1[_0x5b3f94(0x16a)])(_0x2b0eac);}default:throw new common_1['NotFoundException'](_0x5b3f94(0x172));}}};__decorate([(0x0,event_emitter_1[a2_0x4156b8(0x184)])(events_1[a2_0x4156b8(0x176)][a2_0x4156b8(0x163)]),(0x0,event_emitter_1[a2_0x4156b8(0x184)])(events_1[a2_0x4156b8(0x176)]['Deleted']),(0x0,event_emitter_1[a2_0x4156b8(0x184)])(events_1['EventChangedEvent'][a2_0x4156b8(0x149)]),(0x0,event_emitter_1[a2_0x4156b8(0x184)])(events_1['EventChangedEvent'][a2_0x4156b8(0x163)]),(0x0,event_emitter_1[a2_0x4156b8(0x184)])(events_1[a2_0x4156b8(0x171)]['Deleted']),__metadata(a2_0x4156b8(0x14d),Function),__metadata(a2_0x4156b8(0x174),[]),__metadata(a2_0x4156b8(0x181),Promise)],AgendaService[a2_0x4156b8(0x13d)],a2_0x4156b8(0x165),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x4156b8(0x173)])(),__metadata('design:paramtypes',[nestjs_agenda_1['AgendaService']])],AgendaService),exports[a2_0x4156b8(0x144)]=AgendaService;