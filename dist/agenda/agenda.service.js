'use strict';const a2_0x235e6e=a2_0x4772;(function(_0x5a08da,_0x4ee048){const _0x4da429=a2_0x4772,_0x43985b=_0x5a08da();while(!![]){try{const _0x4738b8=-parseInt(_0x4da429(0xa3))/0x1+parseInt(_0x4da429(0x97))/0x2+-parseInt(_0x4da429(0xb5))/0x3*(parseInt(_0x4da429(0x9b))/0x4)+-parseInt(_0x4da429(0xd5))/0x5+parseInt(_0x4da429(0xbb))/0x6+parseInt(_0x4da429(0xc3))/0x7+parseInt(_0x4da429(0xd0))/0x8;if(_0x4738b8===_0x4ee048)break;else _0x43985b['push'](_0x43985b['shift']());}catch(_0x482b30){_0x43985b['push'](_0x43985b['shift']());}}}(a2_0x4ff4,0xb623b));function a2_0x4772(_0x5da2b7,_0x3279f6){const _0x4ff409=a2_0x4ff4();return a2_0x4772=function(_0x477235,_0x19092f){_0x477235=_0x477235-0x8a;let _0x3c731c=_0x4ff409[_0x477235];return _0x3c731c;},a2_0x4772(_0x5da2b7,_0x3279f6);}var __decorate=this&&this[a2_0x235e6e(0xcc)]||function(_0x3213b0,_0xd0bfb2,_0x124710,_0x237f38){const _0x446e0d=a2_0x235e6e;var _0x315dee=arguments[_0x446e0d(0x9e)],_0x4bd6ab=_0x315dee<0x3?_0xd0bfb2:_0x237f38===null?_0x237f38=Object[_0x446e0d(0xb4)](_0xd0bfb2,_0x124710):_0x237f38,_0x5e3786;if(typeof Reflect===_0x446e0d(0xc9)&&typeof Reflect[_0x446e0d(0xbf)]===_0x446e0d(0xa5))_0x4bd6ab=Reflect[_0x446e0d(0xbf)](_0x3213b0,_0xd0bfb2,_0x124710,_0x237f38);else{for(var _0x24215f=_0x3213b0[_0x446e0d(0x9e)]-0x1;_0x24215f>=0x0;_0x24215f--)if(_0x5e3786=_0x3213b0[_0x24215f])_0x4bd6ab=(_0x315dee<0x3?_0x5e3786(_0x4bd6ab):_0x315dee>0x3?_0x5e3786(_0xd0bfb2,_0x124710,_0x4bd6ab):_0x5e3786(_0xd0bfb2,_0x124710))||_0x4bd6ab;}return _0x315dee>0x3&&_0x4bd6ab&&Object['defineProperty'](_0xd0bfb2,_0x124710,_0x4bd6ab),_0x4bd6ab;},__metadata=this&&this[a2_0x235e6e(0xbd)]||function(_0x21c3ee,_0x249900){const _0x1f62dc=a2_0x235e6e;if(typeof Reflect===_0x1f62dc(0xc9)&&typeof Reflect['metadata']===_0x1f62dc(0xa5))return Reflect['metadata'](_0x21c3ee,_0x249900);},AgendaService_1;Object[a2_0x235e6e(0xab)](exports,'__esModule',{'value':!![]}),exports[a2_0x235e6e(0xa1)]=void 0x0;const common_1=require('@nestjs/common'),nestjs_agenda_1=require(a2_0x235e6e(0xac)),event_emitter_1=require(a2_0x235e6e(0xd3)),mongodb_1=require(a2_0x235e6e(0x8c)),enums_1=require('../common/enums'),events_1=require(a2_0x235e6e(0xcf)),job_1=require('../common/job'),dtos_1=require(a2_0x235e6e(0xa8)),mappers_1=require('./mappers'),voice_mapper_1=require(a2_0x235e6e(0xa7)),textToAudio_mapper_1=require(a2_0x235e6e(0xd4));function a2_0x4ff4(){const _0x2e4791=['getJobPayload','Job\x20','rescheduleEvents','toPlaySoundCommand','prototype','PROCESS_CACHE','initialize','0\x200\x20*\x20*\x20*','mongodb','endDate','NotFoundException','Scheduling\x20events...','\x20is\x20cancelled','rescheduleJob','jobs','startDate','Updated','agendaAgent','CheckEvent','2259916UrqHcF','every','toString','PlayMusic','1676VWBGAq','killProcess','name','length','toPlayTextToAudioCommand','Deleted','AgendaService','attrs','1033474JPdTHY','when','function','ScheduleChangedEvent','./mappers/voice.mapper','./dtos','cancelJob','purge','defineProperty','@agent-ly/nestjs-agenda','design:returntype','toPlayVoiceCommand','scheduleJob','\x20not\x20found','logger','Logger','PurgeTempUploadedFiles','getOwnPropertyDescriptor','2097jIGkUe','JobType','schedule','design:type','isScheduleJobDTO','jobType','3249054qnLkNJ','BackgroundJobType','__metadata','getJobs','decorate','OnEvent','PlayVoiceRecorded','PlayTextToAudio','2037434KFFUBY','cancel','Injectable','values','log','EventChangedEvent','object','now','ObjectId','__decorate','toPlayMusicCommand','PlaySound','../common/events','1540536dKCEXS','design:paramtypes','_id','@nestjs/event-emitter','./mappers/textToAudio.mapper','413490eTqqen'];a2_0x4ff4=function(){return _0x2e4791;};return a2_0x4ff4();}let AgendaService=AgendaService_1=class AgendaService{constructor(_0x2654fb){const _0xfe1071=a2_0x235e6e;this[_0xfe1071(0x95)]=_0x2654fb,this[_0xfe1071(0xb1)]=new common_1[(_0xfe1071(0xb2))](AgendaService_1[_0xfe1071(0x9d)]),this[_0xfe1071(0x8a)]();}async[a2_0x235e6e(0x8a)](){const _0x3f8793=a2_0x235e6e;await this[_0x3f8793(0x95)][_0x3f8793(0xaa)](),this['agendaAgent'][_0x3f8793(0x98)](_0x3f8793(0x8b),enums_1[_0x3f8793(0xbc)][_0x3f8793(0x96)]),this[_0x3f8793(0x95)][_0x3f8793(0x98)](_0x3f8793(0x8b),enums_1['BackgroundJobType'][_0x3f8793(0xb3)]),this[_0x3f8793(0x95)][_0x3f8793(0xca)](enums_1['BackgroundJobType'][_0x3f8793(0x96)],null);}async[a2_0x235e6e(0xd8)](){const _0x2c5b5f=a2_0x235e6e;this[_0x2c5b5f(0xb1)][_0x2c5b5f(0xc7)](_0x2c5b5f(0x8f)),await this[_0x2c5b5f(0x95)][_0x2c5b5f(0xc4)]({'name':{'$in':Object[_0x2c5b5f(0xc6)](enums_1[_0x2c5b5f(0xb6)])}}),this['agendaAgent'][_0x2c5b5f(0xca)](enums_1[_0x2c5b5f(0xbc)][_0x2c5b5f(0x96)],null);}async[a2_0x235e6e(0xbe)](){const _0x2da4b1=a2_0x235e6e,_0xe86326=await this[_0x2da4b1(0x95)][_0x2da4b1(0x92)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0xe86326;}async[a2_0x235e6e(0xaf)](_0x240c1a){const _0x418575=a2_0x235e6e,_0x2a1325=this[_0x418575(0xd6)](_0x240c1a),_0x1f5efe=(0x0,dtos_1[_0x418575(0xb9)])(_0x240c1a),_0x57ca12=_0x1f5efe?_0x240c1a[_0x418575(0xa4)]:_0x240c1a[_0x418575(0x98)];let _0x3c69d4;return _0x1f5efe?_0x3c69d4=await this[_0x418575(0x95)][_0x418575(0xb7)](_0x57ca12,_0x240c1a[_0x418575(0xba)],_0x2a1325):_0x3c69d4=await this[_0x418575(0x95)][_0x418575(0x98)](_0x57ca12,_0x240c1a[_0x418575(0xba)],_0x2a1325,{'startDate':new Date(_0x240c1a[_0x418575(0x93)]),'endDate':new Date(_0x240c1a[_0x418575(0x8d)]),'skipImmediate':!![]}),{'jobId':_0x3c69d4[_0x418575(0xa2)][_0x418575(0xd2)][_0x418575(0x99)]()};}async[a2_0x235e6e(0xa9)](_0x32409f){const _0x4c792e=a2_0x235e6e,_0x28792f=await this[_0x4c792e(0x95)][_0x4c792e(0x92)]({'_id':new mongodb_1[(_0x4c792e(0xcb))](_0x32409f)});if(!_0x28792f[_0x4c792e(0x9e)])return{'success':!![],'message':_0x4c792e(0xd7)+_0x32409f+_0x4c792e(0xb0)};const _0x53dc12=await this[_0x4c792e(0x95)][_0x4c792e(0xc4)]({'_id':new mongodb_1[(_0x4c792e(0xcb))](_0x32409f)});job_1[_0x4c792e(0xdb)][_0x4c792e(0x9c)](_0x32409f);if(_0x53dc12)return{'success':!![],'message':'Job\x20'+_0x32409f+_0x4c792e(0x90)};return{'success':![],'message':'Failed\x20to\x20cancel\x20job\x20'+_0x32409f};}async[a2_0x235e6e(0x91)](_0x57c48c,_0x2986d2){const _0x3f93e2=a2_0x235e6e;return await this[_0x3f93e2(0xa9)](_0x57c48c),await this[_0x3f93e2(0xaf)](_0x2986d2);}[a2_0x235e6e(0xd6)](_0x3f75b8){const _0x233809=a2_0x235e6e;switch(_0x3f75b8['jobType']){case enums_1[_0x233809(0xb6)][_0x233809(0xce)]:{return(0x0,mappers_1[_0x233809(0xd9)])(_0x3f75b8);}case enums_1[_0x233809(0xb6)][_0x233809(0x9a)]:{return(0x0,mappers_1[_0x233809(0xcd)])(_0x3f75b8);}case enums_1['JobType'][_0x233809(0xc1)]:{return(0x0,voice_mapper_1[_0x233809(0xae)])(_0x3f75b8);}case enums_1[_0x233809(0xb6)][_0x233809(0xc2)]:{return(0x0,textToAudio_mapper_1[_0x233809(0x9f)])(_0x3f75b8);}default:throw new common_1[(_0x233809(0x8e))]('Job\x20type\x20not\x20found');}}};__decorate([(0x0,event_emitter_1[a2_0x235e6e(0xc0)])(events_1['ScheduleChangedEvent'][a2_0x235e6e(0x94)]),(0x0,event_emitter_1[a2_0x235e6e(0xc0)])(events_1[a2_0x235e6e(0xa6)][a2_0x235e6e(0xa0)]),(0x0,event_emitter_1[a2_0x235e6e(0xc0)])(events_1[a2_0x235e6e(0xc8)]['Created']),(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x235e6e(0xc8)][a2_0x235e6e(0x94)]),(0x0,event_emitter_1[a2_0x235e6e(0xc0)])(events_1[a2_0x235e6e(0xc8)][a2_0x235e6e(0xa0)]),__metadata(a2_0x235e6e(0xb8),Function),__metadata(a2_0x235e6e(0xd1),[]),__metadata(a2_0x235e6e(0xad),Promise)],AgendaService[a2_0x235e6e(0xda)],a2_0x235e6e(0xd8),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x235e6e(0xc5)])(),__metadata(a2_0x235e6e(0xd1),[nestjs_agenda_1[a2_0x235e6e(0xa1)]])],AgendaService),exports[a2_0x235e6e(0xa1)]=AgendaService;