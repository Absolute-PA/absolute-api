'use strict';function a2_0x2108(){const _0x5c8a0f=['__metadata','length','values','8428KXEePf','jobType','toPlayMusicCommand','killProcess','Created','toPlayTextToAudioCommand','2004552stGZZu','Scheduling\x20events...','endDate','Logger','toPlaySoundCommand','getOwnPropertyDescriptor','cancel','rescheduleEvents','EventChangedEvent','975363hfeiaZ','1025129ZRbmIX','PurgeTempUploadedFiles','NotFoundException','defineProperty','3253527sJDCCo','JobType','Failed\x20to\x20cancel\x20job\x20','design:paramtypes','./mappers/voice.mapper','2125kFiCyO','function','@agent-ly/nestjs-agenda','PlayMusic','toString','jobs','ScheduleChangedEvent','agendaAgent','7DQTnmc','getJobPayload','design:type','initialize','metadata','../common/job','scheduleJob','design:returntype','__decorate','@nestjs/common','log','getJobs','Job\x20type\x20not\x20found','mongodb','_id','__esModule','../common/events','./mappers/textToAudio.mapper','now','1740094PMEvfE','PlayTextToAudio','PROCESS_CACHE','decorate','AgendaService','schedule','./mappers','OnEvent','Injectable','PlayVoiceRecorded','logger','0\x200\x20*\x20*\x20*','8593744eLYNwe','purge','10NWiTrb','Job\x20','\x20is\x20cancelled','name','cancelJob','when','BackgroundJobType','every','CheckEvent','Updated'];a2_0x2108=function(){return _0x5c8a0f;};return a2_0x2108();}const a2_0xe9519d=a2_0x1b32;(function(_0x3fdaea,_0x1eafb8){const _0x229305=a2_0x1b32,_0xc355d=_0x3fdaea();while(!![]){try{const _0x33bea3=parseInt(_0x229305(0xe6))/0x1+parseInt(_0x229305(0x10a))/0x2+-parseInt(_0x229305(0x134))/0x3+-parseInt(_0x229305(0x125))/0x4*(-parseInt(_0x229305(0xef))/0x5)+-parseInt(_0x229305(0x12b))/0x6+parseInt(_0x229305(0xf7))/0x7*(-parseInt(_0x229305(0x116))/0x8)+parseInt(_0x229305(0xea))/0x9*(-parseInt(_0x229305(0x118))/0xa);if(_0x33bea3===_0x1eafb8)break;else _0xc355d['push'](_0xc355d['shift']());}catch(_0x4bbd11){_0xc355d['push'](_0xc355d['shift']());}}}(a2_0x2108,0xa9da5));var __decorate=this&&this[a2_0xe9519d(0xff)]||function(_0x4747e2,_0x5dc281,_0x4d37c1,_0x1176ad){const _0x7d7d41=a2_0xe9519d;var _0x2b6b98=arguments[_0x7d7d41(0x123)],_0x16ccb1=_0x2b6b98<0x3?_0x5dc281:_0x1176ad===null?_0x1176ad=Object[_0x7d7d41(0x130)](_0x5dc281,_0x4d37c1):_0x1176ad,_0x57751b;if(typeof Reflect==='object'&&typeof Reflect[_0x7d7d41(0x10d)]==='function')_0x16ccb1=Reflect[_0x7d7d41(0x10d)](_0x4747e2,_0x5dc281,_0x4d37c1,_0x1176ad);else{for(var _0x106631=_0x4747e2[_0x7d7d41(0x123)]-0x1;_0x106631>=0x0;_0x106631--)if(_0x57751b=_0x4747e2[_0x106631])_0x16ccb1=(_0x2b6b98<0x3?_0x57751b(_0x16ccb1):_0x2b6b98>0x3?_0x57751b(_0x5dc281,_0x4d37c1,_0x16ccb1):_0x57751b(_0x5dc281,_0x4d37c1))||_0x16ccb1;}return _0x2b6b98>0x3&&_0x16ccb1&&Object[_0x7d7d41(0xe9)](_0x5dc281,_0x4d37c1,_0x16ccb1),_0x16ccb1;},__metadata=this&&this[a2_0xe9519d(0x122)]||function(_0x5dc642,_0x3298c0){const _0x462017=a2_0xe9519d;if(typeof Reflect==='object'&&typeof Reflect[_0x462017(0xfb)]===_0x462017(0xf0))return Reflect[_0x462017(0xfb)](_0x5dc642,_0x3298c0);},AgendaService_1;function a2_0x1b32(_0x4ace15,_0x4fa9c1){const _0x210801=a2_0x2108();return a2_0x1b32=function(_0x1b3277,_0x4839e8){_0x1b3277=_0x1b3277-0xe6;let _0x5a2372=_0x210801[_0x1b3277];return _0x5a2372;},a2_0x1b32(_0x4ace15,_0x4fa9c1);}Object['defineProperty'](exports,a2_0xe9519d(0x106),{'value':!![]}),exports[a2_0xe9519d(0x10e)]=void 0x0;const common_1=require(a2_0xe9519d(0x100)),nestjs_agenda_1=require(a2_0xe9519d(0xf1)),event_emitter_1=require('@nestjs/event-emitter'),mongodb_1=require(a2_0xe9519d(0x104)),enums_1=require('../common/enums'),events_1=require(a2_0xe9519d(0x107)),job_1=require(a2_0xe9519d(0xfc)),dtos_1=require('./dtos'),mappers_1=require(a2_0xe9519d(0x110)),voice_mapper_1=require(a2_0xe9519d(0xee)),textToAudio_mapper_1=require(a2_0xe9519d(0x108));let AgendaService=AgendaService_1=class AgendaService{constructor(_0x42a843){const _0x86e3c1=a2_0xe9519d;this[_0x86e3c1(0xf6)]=_0x42a843,this[_0x86e3c1(0x114)]=new common_1[(_0x86e3c1(0x12e))](AgendaService_1[_0x86e3c1(0x11b)]),this[_0x86e3c1(0xfa)]();}async[a2_0xe9519d(0xfa)](){const _0x578156=a2_0xe9519d;await this[_0x578156(0xf6)][_0x578156(0x117)](),this[_0x578156(0xf6)][_0x578156(0x11f)](_0x578156(0x115),enums_1[_0x578156(0x11e)][_0x578156(0x120)]),this[_0x578156(0xf6)][_0x578156(0x11f)](_0x578156(0x115),enums_1[_0x578156(0x11e)][_0x578156(0xe7)]),this[_0x578156(0xf6)]['now'](enums_1[_0x578156(0x11e)][_0x578156(0x120)],null);}async[a2_0xe9519d(0x132)](){const _0x55d4c3=a2_0xe9519d;this[_0x55d4c3(0x114)][_0x55d4c3(0x101)](_0x55d4c3(0x12c)),await this['agendaAgent'][_0x55d4c3(0x131)]({'name':{'$in':Object[_0x55d4c3(0x124)](enums_1['JobType'])}}),this[_0x55d4c3(0xf6)][_0x55d4c3(0x109)](enums_1[_0x55d4c3(0x11e)]['CheckEvent'],null);}async[a2_0xe9519d(0x102)](){const _0x5dbd1c=a2_0xe9519d,_0x27b4bc=await this[_0x5dbd1c(0xf6)][_0x5dbd1c(0xf4)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x27b4bc;}async[a2_0xe9519d(0xfd)](_0x291087){const _0x5a404c=a2_0xe9519d,_0x2771b2=this[_0x5a404c(0xf8)](_0x291087),_0x3303bf=(0x0,dtos_1['isScheduleJobDTO'])(_0x291087),_0x14bd6e=_0x3303bf?_0x291087[_0x5a404c(0x11d)]:_0x291087[_0x5a404c(0x11f)];let _0x4676ac;return _0x3303bf?_0x4676ac=await this['agendaAgent'][_0x5a404c(0x10f)](_0x14bd6e,_0x291087['jobType'],_0x2771b2):_0x4676ac=await this[_0x5a404c(0xf6)][_0x5a404c(0x11f)](_0x14bd6e,_0x291087[_0x5a404c(0x126)],_0x2771b2,{'startDate':new Date(_0x291087['startDate']),'endDate':new Date(_0x291087[_0x5a404c(0x12d)]),'skipImmediate':!![]}),{'jobId':_0x4676ac['attrs'][_0x5a404c(0x105)][_0x5a404c(0xf3)]()};}async[a2_0xe9519d(0x11c)](_0x3da71d){const _0x251cba=a2_0xe9519d,_0x589132=await this[_0x251cba(0xf6)][_0x251cba(0xf4)]({'_id':new mongodb_1['ObjectId'](_0x3da71d)});if(!_0x589132['length'])return{'success':!![],'message':_0x251cba(0x119)+_0x3da71d+'\x20not\x20found'};const _0x21bfe2=await this['agendaAgent'][_0x251cba(0x131)]({'_id':new mongodb_1['ObjectId'](_0x3da71d)});job_1[_0x251cba(0x10c)][_0x251cba(0x128)](_0x3da71d);if(_0x21bfe2)return{'success':!![],'message':_0x251cba(0x119)+_0x3da71d+_0x251cba(0x11a)};return{'success':![],'message':_0x251cba(0xec)+_0x3da71d};}async['rescheduleJob'](_0x44beec,_0x249437){return await this['cancelJob'](_0x44beec),await this['scheduleJob'](_0x249437);}['getJobPayload'](_0x381412){const _0x394493=a2_0xe9519d;switch(_0x381412[_0x394493(0x126)]){case enums_1[_0x394493(0xeb)]['PlaySound']:{return(0x0,mappers_1[_0x394493(0x12f)])(_0x381412);}case enums_1[_0x394493(0xeb)][_0x394493(0xf2)]:{return(0x0,mappers_1[_0x394493(0x127)])(_0x381412);}case enums_1['JobType'][_0x394493(0x113)]:{return(0x0,voice_mapper_1['toPlayVoiceCommand'])(_0x381412);}case enums_1[_0x394493(0xeb)][_0x394493(0x10b)]:{return(0x0,textToAudio_mapper_1[_0x394493(0x12a)])(_0x381412);}default:throw new common_1[(_0x394493(0xe8))](_0x394493(0x103));}}};__decorate([(0x0,event_emitter_1[a2_0xe9519d(0x111)])(events_1['ScheduleChangedEvent'][a2_0xe9519d(0x121)]),(0x0,event_emitter_1['OnEvent'])(events_1[a2_0xe9519d(0xf5)]['Deleted']),(0x0,event_emitter_1[a2_0xe9519d(0x111)])(events_1['EventChangedEvent'][a2_0xe9519d(0x129)]),(0x0,event_emitter_1[a2_0xe9519d(0x111)])(events_1['EventChangedEvent'][a2_0xe9519d(0x121)]),(0x0,event_emitter_1[a2_0xe9519d(0x111)])(events_1[a2_0xe9519d(0x133)]['Deleted']),__metadata(a2_0xe9519d(0xf9),Function),__metadata(a2_0xe9519d(0xed),[]),__metadata(a2_0xe9519d(0xfe),Promise)],AgendaService['prototype'],a2_0xe9519d(0x132),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0xe9519d(0x112)])(),__metadata('design:paramtypes',[nestjs_agenda_1[a2_0xe9519d(0x10e)]])],AgendaService),exports[a2_0xe9519d(0x10e)]=AgendaService;