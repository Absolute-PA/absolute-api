'use strict';const a2_0x244945=a2_0x4a6b;(function(_0x3db57f,_0x331d5d){const _0x31070e=a2_0x4a6b,_0x533b0b=_0x3db57f();while(!![]){try{const _0x42d8d6=-parseInt(_0x31070e(0x1f1))/0x1+-parseInt(_0x31070e(0x215))/0x2*(-parseInt(_0x31070e(0x225))/0x3)+parseInt(_0x31070e(0x1d8))/0x4*(-parseInt(_0x31070e(0x213))/0x5)+-parseInt(_0x31070e(0x1f9))/0x6+parseInt(_0x31070e(0x1f4))/0x7*(-parseInt(_0x31070e(0x1d4))/0x8)+-parseInt(_0x31070e(0x21f))/0x9+parseInt(_0x31070e(0x1e7))/0xa*(parseInt(_0x31070e(0x207))/0xb);if(_0x42d8d6===_0x331d5d)break;else _0x533b0b['push'](_0x533b0b['shift']());}catch(_0x463cb5){_0x533b0b['push'](_0x533b0b['shift']());}}}(a2_0x5f36,0x5e47f));function a2_0x5f36(){const _0xc320f3=['ObjectId','design:paramtypes','5670390ixtESn','Scheduling\x20events...','prototype','cancel','log','startDate','attrs','agendaAgent','cancelJob','length','271925wgoFAu','__metadata','Updated','3934JXiFEp','ScheduleChangedEvent','__decorate','Created','0\x200\x20*\x20*\x20*','2333382cSiyZc','values','initialize','./mappers','toPlaySoundCommand','@agent-ly/nestjs-agenda','getJobPayload','toPlayVoiceCommand','purge','PROCESS_CACHE','when','toString','Deleted','metadata','33yyaHFN','decorate','./dtos','design:type','function','./mappers/textToAudio.mapper','getJobs','Logger','toPlayTextToAudioCommand','every','CheckEvent','now','5CWFuMK','Job\x20','149206LvXfOZ','AgendaService','jobType','PurgeTempUploadedFiles','PlayVoiceRecorded','schedule','logger','@nestjs/event-emitter','_id','OnEvent','4039767mRfAKO','rescheduleJob','PlayTextToAudio','\x20not\x20found','EventChangedEvent','\x20is\x20cancelled','6nFPKXY','isScheduleJobDTO','40nTiQdp','@nestjs/common','BackgroundJobType','NotFoundException','1406612yjRnzm','rescheduleEvents','object','__esModule','./mappers/voice.mapper','name','design:returntype','defineProperty','PlayMusic','endDate','killProcess','PlaySound','JobType'];a2_0x5f36=function(){return _0xc320f3;};return a2_0x5f36();}function a2_0x4a6b(_0x50e811,_0x4d4f97){const _0x5f3669=a2_0x5f36();return a2_0x4a6b=function(_0x4a6b8c,_0x593069){_0x4a6b8c=_0x4a6b8c-0x1d3;let _0x4d837b=_0x5f3669[_0x4a6b8c];return _0x4d837b;},a2_0x4a6b(_0x50e811,_0x4d4f97);}var __decorate=this&&this[a2_0x244945(0x1f6)]||function(_0x590eda,_0x11787e,_0x4cafc3,_0x4a5f86){const _0xfab158=a2_0x244945;var _0x55b59f=arguments['length'],_0x11a74a=_0x55b59f<0x3?_0x11787e:_0x4a5f86===null?_0x4a5f86=Object['getOwnPropertyDescriptor'](_0x11787e,_0x4cafc3):_0x4a5f86,_0xabaf25;if(typeof Reflect==='object'&&typeof Reflect[_0xfab158(0x208)]===_0xfab158(0x20b))_0x11a74a=Reflect[_0xfab158(0x208)](_0x590eda,_0x11787e,_0x4cafc3,_0x4a5f86);else{for(var _0x320c66=_0x590eda[_0xfab158(0x1f0)]-0x1;_0x320c66>=0x0;_0x320c66--)if(_0xabaf25=_0x590eda[_0x320c66])_0x11a74a=(_0x55b59f<0x3?_0xabaf25(_0x11a74a):_0x55b59f>0x3?_0xabaf25(_0x11787e,_0x4cafc3,_0x11a74a):_0xabaf25(_0x11787e,_0x4cafc3))||_0x11a74a;}return _0x55b59f>0x3&&_0x11a74a&&Object[_0xfab158(0x1df)](_0x11787e,_0x4cafc3,_0x11a74a),_0x11a74a;},__metadata=this&&this[a2_0x244945(0x1f2)]||function(_0xeabc6b,_0x408a87){const _0x7ff269=a2_0x244945;if(typeof Reflect===_0x7ff269(0x1da)&&typeof Reflect[_0x7ff269(0x206)]===_0x7ff269(0x20b))return Reflect[_0x7ff269(0x206)](_0xeabc6b,_0x408a87);},AgendaService_1;Object[a2_0x244945(0x1df)](exports,a2_0x244945(0x1db),{'value':!![]}),exports['AgendaService']=void 0x0;const common_1=require(a2_0x244945(0x1d5)),nestjs_agenda_1=require(a2_0x244945(0x1fe)),event_emitter_1=require(a2_0x244945(0x21c)),mongodb_1=require('mongodb'),enums_1=require('../common/enums'),events_1=require('../common/events'),job_1=require('../common/job'),dtos_1=require(a2_0x244945(0x209)),mappers_1=require(a2_0x244945(0x1fc)),voice_mapper_1=require(a2_0x244945(0x1dc)),textToAudio_mapper_1=require(a2_0x244945(0x20c));let AgendaService=AgendaService_1=class AgendaService{constructor(_0x3ebc0b){const _0x340257=a2_0x244945;this[_0x340257(0x1ee)]=_0x3ebc0b,this['logger']=new common_1[(_0x340257(0x20e))](AgendaService_1[_0x340257(0x1dd)]),this['initialize']();}async[a2_0x244945(0x1fb)](){const _0x2b0325=a2_0x244945;await this['agendaAgent'][_0x2b0325(0x201)](),this[_0x2b0325(0x1ee)][_0x2b0325(0x210)](_0x2b0325(0x1f8),enums_1[_0x2b0325(0x1d6)]['CheckEvent']),this[_0x2b0325(0x1ee)][_0x2b0325(0x210)](_0x2b0325(0x1f8),enums_1['BackgroundJobType'][_0x2b0325(0x218)]),this[_0x2b0325(0x1ee)]['now'](enums_1[_0x2b0325(0x1d6)][_0x2b0325(0x211)],null);}async[a2_0x244945(0x1d9)](){const _0x345f64=a2_0x244945;this[_0x345f64(0x21b)][_0x345f64(0x1eb)](_0x345f64(0x1e8)),await this[_0x345f64(0x1ee)][_0x345f64(0x1ea)]({'name':{'$in':Object[_0x345f64(0x1fa)](enums_1['JobType'])}}),this[_0x345f64(0x1ee)][_0x345f64(0x212)](enums_1['BackgroundJobType']['CheckEvent'],null);}async[a2_0x244945(0x20d)](){const _0x40e450=a2_0x244945,_0x3287b1=await this[_0x40e450(0x1ee)]['jobs']({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x3287b1;}async['scheduleJob'](_0x44805d){const _0x54cda9=a2_0x244945,_0x806939=this['getJobPayload'](_0x44805d),_0x2c06d2=(0x0,dtos_1[_0x54cda9(0x1d3)])(_0x44805d),_0x34df6c=_0x2c06d2?_0x44805d[_0x54cda9(0x203)]:_0x44805d[_0x54cda9(0x210)];let _0x390133;return _0x2c06d2?_0x390133=await this['agendaAgent'][_0x54cda9(0x21a)](_0x34df6c,_0x44805d[_0x54cda9(0x217)],_0x806939):_0x390133=await this['agendaAgent'][_0x54cda9(0x210)](_0x34df6c,_0x44805d[_0x54cda9(0x217)],_0x806939,{'startDate':new Date(_0x44805d[_0x54cda9(0x1ec)]),'endDate':new Date(_0x44805d[_0x54cda9(0x1e1)]),'skipImmediate':!![]}),{'jobId':_0x390133[_0x54cda9(0x1ed)][_0x54cda9(0x21d)][_0x54cda9(0x204)]()};}async[a2_0x244945(0x1ef)](_0x14dc64){const _0x2251c6=a2_0x244945,_0x2f7f23=await this[_0x2251c6(0x1ee)]['jobs']({'_id':new mongodb_1[(_0x2251c6(0x1e5))](_0x14dc64)});if(!_0x2f7f23[_0x2251c6(0x1f0)])return{'success':!![],'message':'Job\x20'+_0x14dc64+_0x2251c6(0x222)};const _0x55fefd=await this[_0x2251c6(0x1ee)]['cancel']({'_id':new mongodb_1['ObjectId'](_0x14dc64)});job_1[_0x2251c6(0x202)][_0x2251c6(0x1e2)](_0x14dc64);if(_0x55fefd)return{'success':!![],'message':_0x2251c6(0x214)+_0x14dc64+_0x2251c6(0x224)};return{'success':![],'message':'Failed\x20to\x20cancel\x20job\x20'+_0x14dc64};}async[a2_0x244945(0x220)](_0x327623,_0x12bf2d){const _0x4b8083=a2_0x244945;return await this[_0x4b8083(0x1ef)](_0x327623),await this['scheduleJob'](_0x12bf2d);}[a2_0x244945(0x1ff)](_0x40584b){const _0x4be0db=a2_0x244945;switch(_0x40584b[_0x4be0db(0x217)]){case enums_1[_0x4be0db(0x1e4)][_0x4be0db(0x1e3)]:{return(0x0,mappers_1[_0x4be0db(0x1fd)])(_0x40584b);}case enums_1[_0x4be0db(0x1e4)][_0x4be0db(0x1e0)]:{return(0x0,mappers_1['toPlayMusicCommand'])(_0x40584b);}case enums_1[_0x4be0db(0x1e4)][_0x4be0db(0x219)]:{return(0x0,voice_mapper_1[_0x4be0db(0x200)])(_0x40584b);}case enums_1[_0x4be0db(0x1e4)][_0x4be0db(0x221)]:{return(0x0,textToAudio_mapper_1[_0x4be0db(0x20f)])(_0x40584b);}default:throw new common_1[(_0x4be0db(0x1d7))]('Job\x20type\x20not\x20found');}}};__decorate([(0x0,event_emitter_1[a2_0x244945(0x21e)])(events_1[a2_0x244945(0x1f5)][a2_0x244945(0x1f3)]),(0x0,event_emitter_1[a2_0x244945(0x21e)])(events_1[a2_0x244945(0x1f5)][a2_0x244945(0x205)]),(0x0,event_emitter_1[a2_0x244945(0x21e)])(events_1[a2_0x244945(0x223)][a2_0x244945(0x1f7)]),(0x0,event_emitter_1[a2_0x244945(0x21e)])(events_1[a2_0x244945(0x223)][a2_0x244945(0x1f3)]),(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x244945(0x223)][a2_0x244945(0x205)]),__metadata(a2_0x244945(0x20a),Function),__metadata(a2_0x244945(0x1e6),[]),__metadata(a2_0x244945(0x1de),Promise)],AgendaService[a2_0x244945(0x1e9)],a2_0x244945(0x1d9),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(a2_0x244945(0x1e6),[nestjs_agenda_1[a2_0x244945(0x216)]])],AgendaService),exports[a2_0x244945(0x216)]=AgendaService;