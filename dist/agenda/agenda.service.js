'use strict';const a2_0x266291=a2_0x2bf1;(function(_0x343695,_0x3caf7e){const _0xb8d78f=a2_0x2bf1,_0x537766=_0x343695();while(!![]){try{const _0xb47bd5=parseInt(_0xb8d78f(0x13d))/0x1+-parseInt(_0xb8d78f(0x10e))/0x2+-parseInt(_0xb8d78f(0x148))/0x3*(parseInt(_0xb8d78f(0x115))/0x4)+-parseInt(_0xb8d78f(0x13f))/0x5*(-parseInt(_0xb8d78f(0x10f))/0x6)+parseInt(_0xb8d78f(0x108))/0x7+parseInt(_0xb8d78f(0x13c))/0x8*(-parseInt(_0xb8d78f(0xff))/0x9)+-parseInt(_0xb8d78f(0x10c))/0xa;if(_0xb47bd5===_0x3caf7e)break;else _0x537766['push'](_0x537766['shift']());}catch(_0x4d30e4){_0x537766['push'](_0x537766['shift']());}}}(a2_0x5be8,0xeffb7));function a2_0x2bf1(_0x4e1ecf,_0x25cc6a){const _0x5be87b=a2_0x5be8();return a2_0x2bf1=function(_0x2bf1d3,_0x5ee33a){_0x2bf1d3=_0x2bf1d3-0xfd;let _0x5c59d0=_0x5be87b[_0x2bf1d3];return _0x5c59d0;},a2_0x2bf1(_0x4e1ecf,_0x25cc6a);}var __decorate=this&&this[a2_0x266291(0x11a)]||function(_0x3f7ee8,_0x3f3570,_0x2134bd,_0x5fdf0){const _0x19e2fd=a2_0x266291;var _0x4c3a49=arguments['length'],_0x4470ff=_0x4c3a49<0x3?_0x3f3570:_0x5fdf0===null?_0x5fdf0=Object[_0x19e2fd(0x126)](_0x3f3570,_0x2134bd):_0x5fdf0,_0x4c96d3;if(typeof Reflect===_0x19e2fd(0x140)&&typeof Reflect[_0x19e2fd(0x138)]===_0x19e2fd(0x11e))_0x4470ff=Reflect[_0x19e2fd(0x138)](_0x3f7ee8,_0x3f3570,_0x2134bd,_0x5fdf0);else{for(var _0x487bcf=_0x3f7ee8[_0x19e2fd(0x136)]-0x1;_0x487bcf>=0x0;_0x487bcf--)if(_0x4c96d3=_0x3f7ee8[_0x487bcf])_0x4470ff=(_0x4c3a49<0x3?_0x4c96d3(_0x4470ff):_0x4c3a49>0x3?_0x4c96d3(_0x3f3570,_0x2134bd,_0x4470ff):_0x4c96d3(_0x3f3570,_0x2134bd))||_0x4470ff;}return _0x4c3a49>0x3&&_0x4470ff&&Object['defineProperty'](_0x3f3570,_0x2134bd,_0x4470ff),_0x4470ff;},__metadata=this&&this[a2_0x266291(0x14b)]||function(_0x19dd8e,_0x2455fb){const _0x5514ce=a2_0x266291;if(typeof Reflect==='object'&&typeof Reflect[_0x5514ce(0x10a)]===_0x5514ce(0x11e))return Reflect[_0x5514ce(0x10a)](_0x19dd8e,_0x2455fb);},AgendaService_1;Object[a2_0x266291(0x11d)](exports,a2_0x266291(0x104),{'value':!![]}),exports[a2_0x266291(0x137)]=void 0x0;const common_1=require(a2_0x266291(0x146)),nestjs_agenda_1=require('@agent-ly/nestjs-agenda'),event_emitter_1=require(a2_0x266291(0x142)),mongodb_1=require('mongodb'),enums_1=require(a2_0x266291(0x147)),events_1=require(a2_0x266291(0x135)),job_1=require(a2_0x266291(0x13a)),dtos_1=require(a2_0x266291(0x134)),mappers_1=require(a2_0x266291(0x11b)),voice_mapper_1=require(a2_0x266291(0x13b)),textToAudio_mapper_1=require(a2_0x266291(0x145));let AgendaService=AgendaService_1=class AgendaService{constructor(_0x542893){const _0x1c5126=a2_0x266291;this[_0x1c5126(0x106)]=_0x542893,this['logger']=new common_1[(_0x1c5126(0x11c))](AgendaService_1[_0x1c5126(0x123)]),this[_0x1c5126(0x149)]();}async[a2_0x266291(0x149)](){const _0x506306=a2_0x266291;await this[_0x506306(0x106)]['purge'](),this[_0x506306(0x106)][_0x506306(0x10b)](_0x506306(0x111),enums_1[_0x506306(0x11f)][_0x506306(0x129)]),this[_0x506306(0x106)]['every'](_0x506306(0x111),enums_1['BackgroundJobType']['PurgeTempUploadedFiles']),this[_0x506306(0x106)][_0x506306(0x101)](enums_1[_0x506306(0x11f)][_0x506306(0x129)],null);}async[a2_0x266291(0x109)](){const _0x17d889=a2_0x266291;this[_0x17d889(0x12b)][_0x17d889(0x112)](_0x17d889(0x124)),await this['agendaAgent']['cancel']({'name':{'$in':Object['values'](enums_1[_0x17d889(0x132)])}}),this[_0x17d889(0x106)]['now'](enums_1['BackgroundJobType'][_0x17d889(0x129)],null);}async[a2_0x266291(0xfe)](){const _0x4c07e1=a2_0x266291,_0x4639f9=await this[_0x4c07e1(0x106)]['jobs']({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x4639f9;}async[a2_0x266291(0x120)](_0x55b204){const _0x1b958c=a2_0x266291,_0x453587=this[_0x1b958c(0x100)](_0x55b204),_0x1345d1=(0x0,dtos_1['isScheduleJobDTO'])(_0x55b204),_0x360c1f=_0x1345d1?_0x55b204[_0x1b958c(0x143)]:_0x55b204[_0x1b958c(0x10b)];let _0x4b2a58;return _0x1345d1?_0x4b2a58=await this[_0x1b958c(0x106)]['schedule'](_0x360c1f,_0x55b204['jobType'],_0x453587):_0x4b2a58=await this[_0x1b958c(0x106)][_0x1b958c(0x10b)](_0x360c1f,_0x55b204[_0x1b958c(0x114)],_0x453587,{'startDate':new Date(_0x55b204[_0x1b958c(0x113)]),'endDate':new Date(_0x55b204[_0x1b958c(0x13e)]),'skipImmediate':!![]}),{'jobId':_0x4b2a58[_0x1b958c(0x107)][_0x1b958c(0x14c)][_0x1b958c(0x12a)]()};}async[a2_0x266291(0x12d)](_0x40630a){const _0x3f4e35=a2_0x266291,_0x1d000f=await this['agendaAgent'][_0x3f4e35(0x14a)]({'_id':new mongodb_1['ObjectId'](_0x40630a)});if(!_0x1d000f[_0x3f4e35(0x136)])return{'success':!![],'message':'Job\x20'+_0x40630a+_0x3f4e35(0x133)};const _0x1587c0=await this[_0x3f4e35(0x106)][_0x3f4e35(0x110)]({'_id':new mongodb_1[(_0x3f4e35(0x144))](_0x40630a)});job_1[_0x3f4e35(0x130)]['killProcess'](_0x40630a);if(_0x1587c0)return{'success':!![],'message':_0x3f4e35(0x12e)+_0x40630a+_0x3f4e35(0x102)};return{'success':![],'message':_0x3f4e35(0x121)+_0x40630a};}async[a2_0x266291(0x103)](_0x2a2b2d,_0x20c50c){const _0x3298f2=a2_0x266291;return await this[_0x3298f2(0x12d)](_0x2a2b2d),await this['scheduleJob'](_0x20c50c);}['getJobPayload'](_0xb365ba){const _0xc90ad0=a2_0x266291;switch(_0xb365ba['jobType']){case enums_1[_0xc90ad0(0x132)][_0xc90ad0(0x12f)]:{return(0x0,mappers_1['toPlaySoundCommand'])(_0xb365ba);}case enums_1[_0xc90ad0(0x132)][_0xc90ad0(0x139)]:{return(0x0,mappers_1[_0xc90ad0(0x127)])(_0xb365ba);}case enums_1[_0xc90ad0(0x132)][_0xc90ad0(0x116)]:{return(0x0,voice_mapper_1['toPlayVoiceCommand'])(_0xb365ba);}case enums_1[_0xc90ad0(0x132)][_0xc90ad0(0x141)]:{return(0x0,textToAudio_mapper_1[_0xc90ad0(0x125)])(_0xb365ba);}default:throw new common_1[(_0xc90ad0(0x119))](_0xc90ad0(0x12c));}}};__decorate([(0x0,event_emitter_1[a2_0x266291(0xfd)])(events_1[a2_0x266291(0x118)]['Updated']),(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x266291(0x118)][a2_0x266291(0x122)]),(0x0,event_emitter_1[a2_0x266291(0xfd)])(events_1[a2_0x266291(0x128)][a2_0x266291(0x10d)]),(0x0,event_emitter_1[a2_0x266291(0xfd)])(events_1[a2_0x266291(0x128)][a2_0x266291(0x105)]),(0x0,event_emitter_1[a2_0x266291(0xfd)])(events_1['EventChangedEvent'][a2_0x266291(0x122)]),__metadata('design:type',Function),__metadata('design:paramtypes',[]),__metadata('design:returntype',Promise)],AgendaService['prototype'],'rescheduleEvents',null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x266291(0x131)])(),__metadata(a2_0x266291(0x117),[nestjs_agenda_1[a2_0x266291(0x137)]])],AgendaService),exports[a2_0x266291(0x137)]=AgendaService;function a2_0x5be8(){const _0x70700c=['log','startDate','jobType','106936kbmZqU','PlayVoiceRecorded','design:paramtypes','ScheduleChangedEvent','NotFoundException','__decorate','./mappers','Logger','defineProperty','function','BackgroundJobType','scheduleJob','Failed\x20to\x20cancel\x20job\x20','Deleted','name','Scheduling\x20events...','toPlayTextToAudioCommand','getOwnPropertyDescriptor','toPlayMusicCommand','EventChangedEvent','CheckEvent','toString','logger','Job\x20type\x20not\x20found','cancelJob','Job\x20','PlaySound','PROCESS_CACHE','Injectable','JobType','\x20not\x20found','./dtos','../common/events','length','AgendaService','decorate','PlayMusic','../common/job','./mappers/voice.mapper','40BgfCCU','931925wQIXrG','endDate','8003605mDhbIf','object','PlayTextToAudio','@nestjs/event-emitter','when','ObjectId','./mappers/textToAudio.mapper','@nestjs/common','../common/enums','63MHAnXN','initialize','jobs','__metadata','_id','OnEvent','getJobs','145278iBLuDg','getJobPayload','now','\x20is\x20cancelled','rescheduleJob','__esModule','Updated','agendaAgent','attrs','8442294CHEZch','rescheduleEvents','metadata','every','10542780RDGfJC','Created','2118638dGLRNB','6GZDtRO','cancel','0\x200\x20*\x20*\x20*'];a2_0x5be8=function(){return _0x70700c;};return a2_0x5be8();}