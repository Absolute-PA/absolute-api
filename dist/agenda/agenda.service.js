'use strict';function a2_0x22f3(){const _0xde9b6b=['when','toPlayTextToAudioCommand','2215992QCarzH','name','getJobs','@nestjs/common','@nestjs/event-emitter','CheckEvent','cancel','PlaySound','toPlayVoiceCommand','./mappers/textToAudio.mapper','defineProperty','function','now','Logger','initialize','__decorate','toPlayMusicCommand','agendaAgent','48fjHFaG','14oQYRlc','toPlaySoundCommand','ScheduleChangedEvent','\x20is\x20cancelled','../common/job','PlayTextToAudio','decorate','\x20not\x20found','AgendaService','__esModule','length','107145kkSNXj','prototype','2258216uFtQPB','Updated','NotFoundException','every','OnEvent','rescheduleEvents','804837aYsbdX','object','cancelJob','Deleted','design:returntype','BackgroundJobType','jobType','./dtos','PROCESS_CACHE','logger','attrs','startDate','196165cHZeWs','mongodb','toString','ObjectId','getOwnPropertyDescriptor','JobType','1256096WxycPn','isScheduleJobDTO','Created','scheduleJob','EventChangedEvent','purge','./mappers','endDate','jobs','Failed\x20to\x20cancel\x20job\x20','Injectable','2001192gkQMOg','design:type','getJobPayload','PlayMusic','0\x200\x20*\x20*\x20*','Scheduling\x20events...','_id','metadata','killProcess'];a2_0x22f3=function(){return _0xde9b6b;};return a2_0x22f3();}const a2_0x4ed281=a2_0x11a7;(function(_0x3f5450,_0x407004){const _0x6ce4de=a2_0x11a7,_0x36068f=_0x3f5450();while(!![]){try{const _0x39a21e=parseInt(_0x6ce4de(0xe2))/0x1+parseInt(_0x6ce4de(0xf4))/0x2+-parseInt(_0x6ce4de(0x10a))/0x3+parseInt(_0x6ce4de(0xdc))/0x4+-parseInt(_0x6ce4de(0xee))/0x5*(parseInt(_0x6ce4de(0xce))/0x6)+-parseInt(_0x6ce4de(0xcf))/0x7*(parseInt(_0x6ce4de(0xff))/0x8)+-parseInt(_0x6ce4de(0xda))/0x9;if(_0x39a21e===_0x407004)break;else _0x36068f['push'](_0x36068f['shift']());}catch(_0x53e441){_0x36068f['push'](_0x36068f['shift']());}}}(a2_0x22f3,0x69a44));var __decorate=this&&this[a2_0x4ed281(0xcb)]||function(_0x26c6e6,_0x38d26c,_0xa7bac9,_0x29f579){const _0x58e816=a2_0x4ed281;var _0xc92eb5=arguments[_0x58e816(0xd9)],_0x318da0=_0xc92eb5<0x3?_0x38d26c:_0x29f579===null?_0x29f579=Object[_0x58e816(0xf2)](_0x38d26c,_0xa7bac9):_0x29f579,_0x40d8a2;if(typeof Reflect===_0x58e816(0xe3)&&typeof Reflect[_0x58e816(0xd5)]===_0x58e816(0x115))_0x318da0=Reflect['decorate'](_0x26c6e6,_0x38d26c,_0xa7bac9,_0x29f579);else{for(var _0x5a63b7=_0x26c6e6[_0x58e816(0xd9)]-0x1;_0x5a63b7>=0x0;_0x5a63b7--)if(_0x40d8a2=_0x26c6e6[_0x5a63b7])_0x318da0=(_0xc92eb5<0x3?_0x40d8a2(_0x318da0):_0xc92eb5>0x3?_0x40d8a2(_0x38d26c,_0xa7bac9,_0x318da0):_0x40d8a2(_0x38d26c,_0xa7bac9))||_0x318da0;}return _0xc92eb5>0x3&&_0x318da0&&Object[_0x58e816(0x114)](_0x38d26c,_0xa7bac9,_0x318da0),_0x318da0;},__metadata=this&&this['__metadata']||function(_0x4c2bee,_0x3371e4){const _0x2071a4=a2_0x4ed281;if(typeof Reflect==='object'&&typeof Reflect[_0x2071a4(0x106)]==='function')return Reflect[_0x2071a4(0x106)](_0x4c2bee,_0x3371e4);},AgendaService_1;Object[a2_0x4ed281(0x114)](exports,a2_0x4ed281(0xd8),{'value':!![]}),exports['AgendaService']=void 0x0;function a2_0x11a7(_0x11bb37,_0x4731c9){const _0x22f306=a2_0x22f3();return a2_0x11a7=function(_0x11a76c,_0x4a905b){_0x11a76c=_0x11a76c-0xca;let _0x16ec7b=_0x22f306[_0x11a76c];return _0x16ec7b;},a2_0x11a7(_0x11bb37,_0x4731c9);}const common_1=require(a2_0x4ed281(0x10d)),nestjs_agenda_1=require('@agent-ly/nestjs-agenda'),event_emitter_1=require(a2_0x4ed281(0x10e)),mongodb_1=require(a2_0x4ed281(0xef)),enums_1=require('../common/enums'),events_1=require('../common/events'),job_1=require(a2_0x4ed281(0xd3)),dtos_1=require(a2_0x4ed281(0xe9)),mappers_1=require(a2_0x4ed281(0xfa)),voice_mapper_1=require('./mappers/voice.mapper'),textToAudio_mapper_1=require(a2_0x4ed281(0x113));let AgendaService=AgendaService_1=class AgendaService{constructor(_0x32e5be){const _0x3fab79=a2_0x4ed281;this[_0x3fab79(0xcd)]=_0x32e5be,this['logger']=new common_1[(_0x3fab79(0x117))](AgendaService_1[_0x3fab79(0x10b)]),this[_0x3fab79(0xca)]();}async[a2_0x4ed281(0xca)](){const _0x2a1925=a2_0x4ed281;await this[_0x2a1925(0xcd)][_0x2a1925(0xf9)](),this[_0x2a1925(0xcd)][_0x2a1925(0xdf)](_0x2a1925(0x103),enums_1[_0x2a1925(0xe7)]['CheckEvent']),this[_0x2a1925(0xcd)][_0x2a1925(0xdf)](_0x2a1925(0x103),enums_1[_0x2a1925(0xe7)]['PurgeTempUploadedFiles']),this[_0x2a1925(0xcd)][_0x2a1925(0x116)](enums_1['BackgroundJobType'][_0x2a1925(0x10f)],null);}async['rescheduleEvents'](){const _0x58630a=a2_0x4ed281;this[_0x58630a(0xeb)]['log'](_0x58630a(0x104)),await this[_0x58630a(0xcd)][_0x58630a(0x110)]({'name':{'$in':Object['values'](enums_1['JobType'])}}),this['agendaAgent']['now'](enums_1['BackgroundJobType'][_0x58630a(0x10f)],null);}async[a2_0x4ed281(0x10c)](){const _0x4cd77e=a2_0x4ed281,_0x303d8a=await this[_0x4cd77e(0xcd)][_0x4cd77e(0xfc)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x303d8a;}async[a2_0x4ed281(0xf7)](_0x1bf20e){const _0x3d20c1=a2_0x4ed281,_0x5b6271=this[_0x3d20c1(0x101)](_0x1bf20e),_0x16f933=(0x0,dtos_1[_0x3d20c1(0xf5)])(_0x1bf20e),_0x1ccd67=_0x16f933?_0x1bf20e[_0x3d20c1(0x108)]:_0x1bf20e[_0x3d20c1(0xdf)];let _0x2e34ea;return _0x16f933?_0x2e34ea=await this[_0x3d20c1(0xcd)]['schedule'](_0x1ccd67,_0x1bf20e[_0x3d20c1(0xe8)],_0x5b6271):_0x2e34ea=await this[_0x3d20c1(0xcd)][_0x3d20c1(0xdf)](_0x1ccd67,_0x1bf20e[_0x3d20c1(0xe8)],_0x5b6271,{'startDate':new Date(_0x1bf20e[_0x3d20c1(0xed)]),'endDate':new Date(_0x1bf20e[_0x3d20c1(0xfb)]),'skipImmediate':!![]}),{'jobId':_0x2e34ea[_0x3d20c1(0xec)][_0x3d20c1(0x105)][_0x3d20c1(0xf0)]()};}async['cancelJob'](_0xbba41a){const _0x40c455=a2_0x4ed281,_0x15bcd4=await this['agendaAgent'][_0x40c455(0xfc)]({'_id':new mongodb_1[(_0x40c455(0xf1))](_0xbba41a)});if(!_0x15bcd4[_0x40c455(0xd9)])return{'success':!![],'message':'Job\x20'+_0xbba41a+_0x40c455(0xd6)};const _0x1ca9b9=await this[_0x40c455(0xcd)][_0x40c455(0x110)]({'_id':new mongodb_1[(_0x40c455(0xf1))](_0xbba41a)});job_1[_0x40c455(0xea)][_0x40c455(0x107)](_0xbba41a);if(_0x1ca9b9)return{'success':!![],'message':'Job\x20'+_0xbba41a+_0x40c455(0xd2)};return{'success':![],'message':_0x40c455(0xfd)+_0xbba41a};}async['rescheduleJob'](_0x1895bb,_0xc68f70){const _0x3abe44=a2_0x4ed281;return await this[_0x3abe44(0xe4)](_0x1895bb),await this[_0x3abe44(0xf7)](_0xc68f70);}['getJobPayload'](_0x2859d0){const _0x3021d0=a2_0x4ed281;switch(_0x2859d0['jobType']){case enums_1[_0x3021d0(0xf3)][_0x3021d0(0x111)]:{return(0x0,mappers_1[_0x3021d0(0xd0)])(_0x2859d0);}case enums_1[_0x3021d0(0xf3)][_0x3021d0(0x102)]:{return(0x0,mappers_1[_0x3021d0(0xcc)])(_0x2859d0);}case enums_1[_0x3021d0(0xf3)]['PlayVoiceRecorded']:{return(0x0,voice_mapper_1[_0x3021d0(0x112)])(_0x2859d0);}case enums_1[_0x3021d0(0xf3)][_0x3021d0(0xd4)]:{return(0x0,textToAudio_mapper_1[_0x3021d0(0x109)])(_0x2859d0);}default:throw new common_1[(_0x3021d0(0xde))]('Job\x20type\x20not\x20found');}}};__decorate([(0x0,event_emitter_1[a2_0x4ed281(0xe0)])(events_1[a2_0x4ed281(0xd1)][a2_0x4ed281(0xdd)]),(0x0,event_emitter_1[a2_0x4ed281(0xe0)])(events_1['ScheduleChangedEvent'][a2_0x4ed281(0xe5)]),(0x0,event_emitter_1[a2_0x4ed281(0xe0)])(events_1[a2_0x4ed281(0xf8)][a2_0x4ed281(0xf6)]),(0x0,event_emitter_1['OnEvent'])(events_1['EventChangedEvent'][a2_0x4ed281(0xdd)]),(0x0,event_emitter_1[a2_0x4ed281(0xe0)])(events_1['EventChangedEvent'][a2_0x4ed281(0xe5)]),__metadata(a2_0x4ed281(0x100),Function),__metadata('design:paramtypes',[]),__metadata(a2_0x4ed281(0xe6),Promise)],AgendaService[a2_0x4ed281(0xdb)],a2_0x4ed281(0xe1),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x4ed281(0xfe)])(),__metadata('design:paramtypes',[nestjs_agenda_1[a2_0x4ed281(0xd7)]])],AgendaService),exports[a2_0x4ed281(0xd7)]=AgendaService;