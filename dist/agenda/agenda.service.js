'use strict';const a2_0x2b36df=a2_0x50e6;(function(_0x34fbe8,_0x4f7dc3){const _0x38ada2=a2_0x50e6,_0x59eade=_0x34fbe8();while(!![]){try{const _0x1b2a96=parseInt(_0x38ada2(0x198))/0x1+parseInt(_0x38ada2(0x17f))/0x2*(parseInt(_0x38ada2(0x17a))/0x3)+-parseInt(_0x38ada2(0x189))/0x4*(parseInt(_0x38ada2(0x1c1))/0x5)+-parseInt(_0x38ada2(0x199))/0x6*(parseInt(_0x38ada2(0x193))/0x7)+parseInt(_0x38ada2(0x19a))/0x8+parseInt(_0x38ada2(0x1a9))/0x9+-parseInt(_0x38ada2(0x176))/0xa;if(_0x1b2a96===_0x4f7dc3)break;else _0x59eade['push'](_0x59eade['shift']());}catch(_0x3f8063){_0x59eade['push'](_0x59eade['shift']());}}}(a2_0x3b71,0xe6ba8));function a2_0x50e6(_0x34f007,_0x3ee982){const _0x3b7170=a2_0x3b71();return a2_0x50e6=function(_0x50e607,_0x1bb1f6){_0x50e607=_0x50e607-0x174;let _0x47f455=_0x3b7170[_0x50e607];return _0x47f455;},a2_0x50e6(_0x34f007,_0x3ee982);}var __decorate=this&&this[a2_0x2b36df(0x192)]||function(_0x18c0bb,_0x2eac34,_0x25c642,_0x5d8517){const _0x308d02=a2_0x2b36df;var _0x37e9bb=arguments['length'],_0x2b56d6=_0x37e9bb<0x3?_0x2eac34:_0x5d8517===null?_0x5d8517=Object['getOwnPropertyDescriptor'](_0x2eac34,_0x25c642):_0x5d8517,_0x25d005;if(typeof Reflect===_0x308d02(0x1af)&&typeof Reflect[_0x308d02(0x1b5)]===_0x308d02(0x1bb))_0x2b56d6=Reflect['decorate'](_0x18c0bb,_0x2eac34,_0x25c642,_0x5d8517);else{for(var _0x3b0226=_0x18c0bb[_0x308d02(0x1aa)]-0x1;_0x3b0226>=0x0;_0x3b0226--)if(_0x25d005=_0x18c0bb[_0x3b0226])_0x2b56d6=(_0x37e9bb<0x3?_0x25d005(_0x2b56d6):_0x37e9bb>0x3?_0x25d005(_0x2eac34,_0x25c642,_0x2b56d6):_0x25d005(_0x2eac34,_0x25c642))||_0x2b56d6;}return _0x37e9bb>0x3&&_0x2b56d6&&Object[_0x308d02(0x1bf)](_0x2eac34,_0x25c642,_0x2b56d6),_0x2b56d6;},__metadata=this&&this['__metadata']||function(_0x1d66b6,_0x59cb83){const _0x10ec34=a2_0x2b36df;if(typeof Reflect===_0x10ec34(0x1af)&&typeof Reflect[_0x10ec34(0x188)]===_0x10ec34(0x1bb))return Reflect['metadata'](_0x1d66b6,_0x59cb83);},AgendaService_1;function a2_0x3b71(){const _0x419f3a=['./dtos','../common/enums','design:returntype','./mappers/voice.mapper','PROCESS_CACHE','7112574jIllsL','length','getJobPayload','schedule','killProcess','EventChangedEvent','object','Injectable','jobs','cancel','Job\x20type\x20not\x20found','now','decorate','Updated','AgendaService','isScheduleJobDTO','toPlayVoiceCommand','@agent-ly/nestjs-agenda','function','getJobs','_id','PurgeTempUploadedFiles','defineProperty','./mappers/textToAudio.mapper','5iZXUjt','Created','Deleted','12921080haEuDl','JobType','0\x200\x20*\x20*\x20*','design:type','3268659fRWfmf','jobType','initialize','rescheduleEvents','every','2NlzVxQ','rescheduleJob','Failed\x20to\x20cancel\x20job\x20','mongodb','ScheduleChangedEvent','OnEvent','design:paramtypes','cancelJob','scheduleJob','metadata','4766088qAVrfk','prototype','\x20not\x20found','ObjectId','@nestjs/event-emitter','agendaAgent','CheckEvent','BackgroundJobType','../common/events','__decorate','2065Xdnbpx','PlayMusic','values','./mappers','PlayTextToAudio','546434wTINUU','1686pKiQOm','8682528bhHeTr','logger','endDate','__esModule','\x20is\x20cancelled','@nestjs/common','Job\x20','purge','Logger','startDate'];a2_0x3b71=function(){return _0x419f3a;};return a2_0x3b71();}Object[a2_0x2b36df(0x1bf)](exports,a2_0x2b36df(0x19d),{'value':!![]}),exports[a2_0x2b36df(0x1b7)]=void 0x0;const common_1=require(a2_0x2b36df(0x19f)),nestjs_agenda_1=require(a2_0x2b36df(0x1ba)),event_emitter_1=require(a2_0x2b36df(0x18d)),mongodb_1=require(a2_0x2b36df(0x182)),enums_1=require(a2_0x2b36df(0x1a5)),events_1=require(a2_0x2b36df(0x191)),job_1=require('../common/job'),dtos_1=require(a2_0x2b36df(0x1a4)),mappers_1=require(a2_0x2b36df(0x196)),voice_mapper_1=require(a2_0x2b36df(0x1a7)),textToAudio_mapper_1=require(a2_0x2b36df(0x1c0));let AgendaService=AgendaService_1=class AgendaService{constructor(_0xb49e68){const _0x16951d=a2_0x2b36df;this[_0x16951d(0x18e)]=_0xb49e68,this[_0x16951d(0x19b)]=new common_1[(_0x16951d(0x1a2))](AgendaService_1['name']),this[_0x16951d(0x17c)]();}async['initialize'](){const _0x225818=a2_0x2b36df;await this[_0x225818(0x18e)][_0x225818(0x1a1)](),this['agendaAgent'][_0x225818(0x17e)](_0x225818(0x178),enums_1['BackgroundJobType'][_0x225818(0x18f)]),this['agendaAgent'][_0x225818(0x17e)](_0x225818(0x178),enums_1[_0x225818(0x190)][_0x225818(0x1be)]),this[_0x225818(0x18e)][_0x225818(0x1b4)](enums_1[_0x225818(0x190)][_0x225818(0x18f)],null);}async[a2_0x2b36df(0x17d)](){const _0x4bd44c=a2_0x2b36df;this[_0x4bd44c(0x19b)]['log']('Scheduling\x20events...'),await this[_0x4bd44c(0x18e)][_0x4bd44c(0x1b2)]({'name':{'$in':Object[_0x4bd44c(0x195)](enums_1['JobType'])}}),this[_0x4bd44c(0x18e)][_0x4bd44c(0x1b4)](enums_1[_0x4bd44c(0x190)][_0x4bd44c(0x18f)],null);}async[a2_0x2b36df(0x1bc)](){const _0x250827=a2_0x2b36df,_0x3ba604=await this[_0x250827(0x18e)][_0x250827(0x1b1)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x3ba604;}async[a2_0x2b36df(0x187)](_0x46149a){const _0x6e9861=a2_0x2b36df,_0x579d30=this['getJobPayload'](_0x46149a),_0x2ca2d5=(0x0,dtos_1[_0x6e9861(0x1b8)])(_0x46149a),_0x10ee04=_0x2ca2d5?_0x46149a['when']:_0x46149a[_0x6e9861(0x17e)];let _0x42b38c;return _0x2ca2d5?_0x42b38c=await this[_0x6e9861(0x18e)][_0x6e9861(0x1ac)](_0x10ee04,_0x46149a[_0x6e9861(0x17b)],_0x579d30):_0x42b38c=await this[_0x6e9861(0x18e)][_0x6e9861(0x17e)](_0x10ee04,_0x46149a[_0x6e9861(0x17b)],_0x579d30,{'startDate':new Date(_0x46149a[_0x6e9861(0x1a3)]),'endDate':new Date(_0x46149a[_0x6e9861(0x19c)]),'skipImmediate':!![]}),{'jobId':_0x42b38c['attrs'][_0x6e9861(0x1bd)]['toString']()};}async[a2_0x2b36df(0x186)](_0x3461bf){const _0x29f18c=a2_0x2b36df,_0x4bbc42=await this[_0x29f18c(0x18e)][_0x29f18c(0x1b1)]({'_id':new mongodb_1[(_0x29f18c(0x18c))](_0x3461bf)});if(!_0x4bbc42[_0x29f18c(0x1aa)])return{'success':!![],'message':'Job\x20'+_0x3461bf+_0x29f18c(0x18b)};const _0x5f4fa4=await this[_0x29f18c(0x18e)]['cancel']({'_id':new mongodb_1['ObjectId'](_0x3461bf)});job_1[_0x29f18c(0x1a8)][_0x29f18c(0x1ad)](_0x3461bf);if(_0x5f4fa4)return{'success':!![],'message':_0x29f18c(0x1a0)+_0x3461bf+_0x29f18c(0x19e)};return{'success':![],'message':_0x29f18c(0x181)+_0x3461bf};}async[a2_0x2b36df(0x180)](_0x38f7be,_0x201ec6){const _0x1c2f68=a2_0x2b36df;return await this[_0x1c2f68(0x186)](_0x38f7be),await this[_0x1c2f68(0x187)](_0x201ec6);}[a2_0x2b36df(0x1ab)](_0x13a003){const _0x37a701=a2_0x2b36df;switch(_0x13a003[_0x37a701(0x17b)]){case enums_1[_0x37a701(0x177)]['PlaySound']:{return(0x0,mappers_1['toPlaySoundCommand'])(_0x13a003);}case enums_1[_0x37a701(0x177)][_0x37a701(0x194)]:{return(0x0,mappers_1['toPlayMusicCommand'])(_0x13a003);}case enums_1[_0x37a701(0x177)]['PlayVoiceRecorded']:{return(0x0,voice_mapper_1[_0x37a701(0x1b9)])(_0x13a003);}case enums_1['JobType'][_0x37a701(0x197)]:{return(0x0,textToAudio_mapper_1['toPlayTextToAudioCommand'])(_0x13a003);}default:throw new common_1['NotFoundException'](_0x37a701(0x1b3));}}};__decorate([(0x0,event_emitter_1[a2_0x2b36df(0x184)])(events_1[a2_0x2b36df(0x183)][a2_0x2b36df(0x1b6)]),(0x0,event_emitter_1[a2_0x2b36df(0x184)])(events_1[a2_0x2b36df(0x183)]['Deleted']),(0x0,event_emitter_1[a2_0x2b36df(0x184)])(events_1[a2_0x2b36df(0x1ae)][a2_0x2b36df(0x174)]),(0x0,event_emitter_1[a2_0x2b36df(0x184)])(events_1[a2_0x2b36df(0x1ae)][a2_0x2b36df(0x1b6)]),(0x0,event_emitter_1[a2_0x2b36df(0x184)])(events_1['EventChangedEvent'][a2_0x2b36df(0x175)]),__metadata(a2_0x2b36df(0x179),Function),__metadata(a2_0x2b36df(0x185),[]),__metadata(a2_0x2b36df(0x1a6),Promise)],AgendaService[a2_0x2b36df(0x18a)],'rescheduleEvents',null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x2b36df(0x1b0)])(),__metadata(a2_0x2b36df(0x185),[nestjs_agenda_1[a2_0x2b36df(0x1b7)]])],AgendaService),exports['AgendaService']=AgendaService;