'use strict';const a2_0x452c30=a2_0x4ae0;function a2_0x5a85(){const _0x48cf43=['407cahcsk','3909924rcOoyd','attrs','rescheduleEvents','purge','PurgeTempUploadedFiles','endDate','when','1030840QLEWLa','4280sFifNT','Job\x20','defineProperty','AgendaService','object','every','killProcess','@agent-ly/nestjs-agenda','\x20not\x20found','6415IFwnIL','0\x200\x20*\x20*\x20*','Job\x20type\x20not\x20found','decorate','CheckEvent','__decorate','initialize','scheduleJob','now','@nestjs/common','__esModule','toString','@nestjs/event-emitter','isScheduleJobDTO','Injectable','JobType','ScheduleChangedEvent','toPlayTextToAudioCommand','\x20is\x20cancelled','design:paramtypes','agendaAgent','6298jWCIRl','517IkKNkH','Deleted','jobType','mongodb','schedule','ObjectId','length','name','EventChangedEvent','Logger','design:type','startDate','function','_id','prototype','__metadata','BackgroundJobType','PlayMusic','154VHuxnp','6920304YXuvSW','4801887ZSNqTw','logger','500672zdAxNu','../common/job','OnEvent','Updated','../common/enums','./mappers/textToAudio.mapper','./mappers/voice.mapper','./mappers','PlaySound','./dtos','metadata','toPlaySoundCommand','Failed\x20to\x20cancel\x20job\x20','rescheduleJob','NotFoundException','cancelJob','jobs','../common/events','cancel','getJobPayload'];a2_0x5a85=function(){return _0x48cf43;};return a2_0x5a85();}(function(_0x2c6aac,_0x3876a3){const _0xd0e98e=a2_0x4ae0,_0x3b4fec=_0x2c6aac();while(!![]){try{const _0xd931a2=-parseInt(_0xd0e98e(0x15f))/0x1*(parseInt(_0xd0e98e(0x134))/0x2)+parseInt(_0xd0e98e(0x149))/0x3+parseInt(_0xd0e98e(0x168))/0x4*(-parseInt(_0xd0e98e(0x171))/0x5)+-parseInt(_0xd0e98e(0x148))/0x6+-parseInt(_0xd0e98e(0x147))/0x7*(parseInt(_0xd0e98e(0x14b))/0x8)+-parseInt(_0xd0e98e(0x160))/0x9+parseInt(_0xd0e98e(0x167))/0xa*(parseInt(_0xd0e98e(0x135))/0xb);if(_0xd931a2===_0x3876a3)break;else _0x3b4fec['push'](_0x3b4fec['shift']());}catch(_0x542aaf){_0x3b4fec['push'](_0x3b4fec['shift']());}}}(a2_0x5a85,0xc9c58));function a2_0x4ae0(_0x3dec2d,_0x1e82fe){const _0x5a850a=a2_0x5a85();return a2_0x4ae0=function(_0x4ae020,_0x572745){_0x4ae020=_0x4ae020-0x12d;let _0x1c957a=_0x5a850a[_0x4ae020];return _0x1c957a;},a2_0x4ae0(_0x3dec2d,_0x1e82fe);}var __decorate=this&&this[a2_0x452c30(0x176)]||function(_0x5cb794,_0x43f5c9,_0x52eadb,_0x32afbb){const _0x208273=a2_0x452c30;var _0x4626b8=arguments[_0x208273(0x13b)],_0x300be2=_0x4626b8<0x3?_0x43f5c9:_0x32afbb===null?_0x32afbb=Object['getOwnPropertyDescriptor'](_0x43f5c9,_0x52eadb):_0x32afbb,_0x13373d;if(typeof Reflect===_0x208273(0x16c)&&typeof Reflect[_0x208273(0x174)]===_0x208273(0x141))_0x300be2=Reflect[_0x208273(0x174)](_0x5cb794,_0x43f5c9,_0x52eadb,_0x32afbb);else{for(var _0x4a0350=_0x5cb794[_0x208273(0x13b)]-0x1;_0x4a0350>=0x0;_0x4a0350--)if(_0x13373d=_0x5cb794[_0x4a0350])_0x300be2=(_0x4626b8<0x3?_0x13373d(_0x300be2):_0x4626b8>0x3?_0x13373d(_0x43f5c9,_0x52eadb,_0x300be2):_0x13373d(_0x43f5c9,_0x52eadb))||_0x300be2;}return _0x4626b8>0x3&&_0x300be2&&Object[_0x208273(0x16a)](_0x43f5c9,_0x52eadb,_0x300be2),_0x300be2;},__metadata=this&&this[a2_0x452c30(0x144)]||function(_0x5b66f0,_0x1c2bb5){const _0x866059=a2_0x452c30;if(typeof Reflect===_0x866059(0x16c)&&typeof Reflect[_0x866059(0x155)]===_0x866059(0x141))return Reflect[_0x866059(0x155)](_0x5b66f0,_0x1c2bb5);},AgendaService_1;Object[a2_0x452c30(0x16a)](exports,a2_0x452c30(0x17b),{'value':!![]}),exports[a2_0x452c30(0x16b)]=void 0x0;const common_1=require(a2_0x452c30(0x17a)),nestjs_agenda_1=require(a2_0x452c30(0x16f)),event_emitter_1=require(a2_0x452c30(0x17d)),mongodb_1=require(a2_0x452c30(0x138)),enums_1=require(a2_0x452c30(0x14f)),events_1=require(a2_0x452c30(0x15c)),job_1=require(a2_0x452c30(0x14c)),dtos_1=require(a2_0x452c30(0x154)),mappers_1=require(a2_0x452c30(0x152)),voice_mapper_1=require(a2_0x452c30(0x151)),textToAudio_mapper_1=require(a2_0x452c30(0x150));let AgendaService=AgendaService_1=class AgendaService{constructor(_0x45777a){const _0x39f637=a2_0x452c30;this[_0x39f637(0x133)]=_0x45777a,this['logger']=new common_1[(_0x39f637(0x13e))](AgendaService_1[_0x39f637(0x13c)]),this[_0x39f637(0x177)]();}async['initialize'](){const _0x5733e8=a2_0x452c30;await this['agendaAgent'][_0x5733e8(0x163)](),this['agendaAgent'][_0x5733e8(0x16d)](_0x5733e8(0x172),enums_1[_0x5733e8(0x145)][_0x5733e8(0x175)]),this['agendaAgent'][_0x5733e8(0x16d)]('0\x200\x20*\x20*\x20*',enums_1[_0x5733e8(0x145)][_0x5733e8(0x164)]),this['agendaAgent'][_0x5733e8(0x179)](enums_1[_0x5733e8(0x145)][_0x5733e8(0x175)],null);}async['rescheduleEvents'](){const _0x4ee4ba=a2_0x452c30;this[_0x4ee4ba(0x14a)]['log']('Scheduling\x20events...'),await this[_0x4ee4ba(0x133)][_0x4ee4ba(0x15d)]({'name':{'$in':Object['values'](enums_1[_0x4ee4ba(0x12e)])}}),this[_0x4ee4ba(0x133)][_0x4ee4ba(0x179)](enums_1[_0x4ee4ba(0x145)][_0x4ee4ba(0x175)],null);}async['getJobs'](){const _0x17c1d4=a2_0x452c30,_0x2c1fd8=await this[_0x17c1d4(0x133)][_0x17c1d4(0x15b)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x2c1fd8;}async[a2_0x452c30(0x178)](_0x5e063f){const _0x1bf08c=a2_0x452c30,_0x2d6688=this['getJobPayload'](_0x5e063f),_0x3a0fb4=(0x0,dtos_1[_0x1bf08c(0x17e)])(_0x5e063f),_0x2e27f0=_0x3a0fb4?_0x5e063f[_0x1bf08c(0x166)]:_0x5e063f[_0x1bf08c(0x16d)];let _0x2f86d4;return _0x3a0fb4?_0x2f86d4=await this[_0x1bf08c(0x133)][_0x1bf08c(0x139)](_0x2e27f0,_0x5e063f['jobType'],_0x2d6688):_0x2f86d4=await this[_0x1bf08c(0x133)][_0x1bf08c(0x16d)](_0x2e27f0,_0x5e063f[_0x1bf08c(0x137)],_0x2d6688,{'startDate':new Date(_0x5e063f[_0x1bf08c(0x140)]),'endDate':new Date(_0x5e063f[_0x1bf08c(0x165)]),'skipImmediate':!![]}),{'jobId':_0x2f86d4[_0x1bf08c(0x161)][_0x1bf08c(0x142)][_0x1bf08c(0x17c)]()};}async[a2_0x452c30(0x15a)](_0x450298){const _0x31f2be=a2_0x452c30,_0x2d1d7b=await this['agendaAgent'][_0x31f2be(0x15b)]({'_id':new mongodb_1[(_0x31f2be(0x13a))](_0x450298)});if(!_0x2d1d7b[_0x31f2be(0x13b)])return{'success':!![],'message':_0x31f2be(0x169)+_0x450298+_0x31f2be(0x170)};const _0x1bffa7=await this[_0x31f2be(0x133)][_0x31f2be(0x15d)]({'_id':new mongodb_1[(_0x31f2be(0x13a))](_0x450298)});job_1['PROCESS_CACHE'][_0x31f2be(0x16e)](_0x450298);if(_0x1bffa7)return{'success':!![],'message':'Job\x20'+_0x450298+_0x31f2be(0x131)};return{'success':![],'message':_0x31f2be(0x157)+_0x450298};}async[a2_0x452c30(0x158)](_0xc8b583,_0x2679de){const _0x4ea762=a2_0x452c30;return await this[_0x4ea762(0x15a)](_0xc8b583),await this[_0x4ea762(0x178)](_0x2679de);}[a2_0x452c30(0x15e)](_0x540b18){const _0x27c750=a2_0x452c30;switch(_0x540b18[_0x27c750(0x137)]){case enums_1[_0x27c750(0x12e)][_0x27c750(0x153)]:{return(0x0,mappers_1[_0x27c750(0x156)])(_0x540b18);}case enums_1[_0x27c750(0x12e)][_0x27c750(0x146)]:{return(0x0,mappers_1['toPlayMusicCommand'])(_0x540b18);}case enums_1['JobType']['PlayVoiceRecorded']:{return(0x0,voice_mapper_1['toPlayVoiceCommand'])(_0x540b18);}case enums_1['JobType']['PlayTextToAudio']:{return(0x0,textToAudio_mapper_1[_0x27c750(0x130)])(_0x540b18);}default:throw new common_1[(_0x27c750(0x159))](_0x27c750(0x173));}}};__decorate([(0x0,event_emitter_1[a2_0x452c30(0x14d)])(events_1[a2_0x452c30(0x12f)][a2_0x452c30(0x14e)]),(0x0,event_emitter_1[a2_0x452c30(0x14d)])(events_1[a2_0x452c30(0x12f)][a2_0x452c30(0x136)]),(0x0,event_emitter_1[a2_0x452c30(0x14d)])(events_1['EventChangedEvent']['Created']),(0x0,event_emitter_1[a2_0x452c30(0x14d)])(events_1[a2_0x452c30(0x13d)][a2_0x452c30(0x14e)]),(0x0,event_emitter_1[a2_0x452c30(0x14d)])(events_1[a2_0x452c30(0x13d)][a2_0x452c30(0x136)]),__metadata(a2_0x452c30(0x13f),Function),__metadata(a2_0x452c30(0x132),[]),__metadata('design:returntype',Promise)],AgendaService[a2_0x452c30(0x143)],a2_0x452c30(0x162),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x452c30(0x12d)])(),__metadata(a2_0x452c30(0x132),[nestjs_agenda_1[a2_0x452c30(0x16b)]])],AgendaService),exports[a2_0x452c30(0x16b)]=AgendaService;