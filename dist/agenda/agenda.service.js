'use strict';const a2_0x397442=a2_0x1c8b;(function(_0x3f27ba,_0x49a08){const _0x4e945a=a2_0x1c8b,_0x2f82d7=_0x3f27ba();while(!![]){try{const _0xf15de9=-parseInt(_0x4e945a(0xc8))/0x1+-parseInt(_0x4e945a(0x96))/0x2+-parseInt(_0x4e945a(0x95))/0x3+-parseInt(_0x4e945a(0xab))/0x4+-parseInt(_0x4e945a(0x9d))/0x5+parseInt(_0x4e945a(0x92))/0x6+parseInt(_0x4e945a(0xb9))/0x7;if(_0xf15de9===_0x49a08)break;else _0x2f82d7['push'](_0x2f82d7['shift']());}catch(_0x4bf960){_0x2f82d7['push'](_0x2f82d7['shift']());}}}(a2_0x19a0,0xd6a4a));var __decorate=this&&this[a2_0x397442(0xc9)]||function(_0x466311,_0x3ad3d7,_0x5ca5b8,_0xa40ec4){const _0x314bbf=a2_0x397442;var _0x5a7ceb=arguments[_0x314bbf(0xcb)],_0x9c9e98=_0x5a7ceb<0x3?_0x3ad3d7:_0xa40ec4===null?_0xa40ec4=Object[_0x314bbf(0xbc)](_0x3ad3d7,_0x5ca5b8):_0xa40ec4,_0x99054e;if(typeof Reflect===_0x314bbf(0xc4)&&typeof Reflect[_0x314bbf(0xac)]===_0x314bbf(0xb2))_0x9c9e98=Reflect[_0x314bbf(0xac)](_0x466311,_0x3ad3d7,_0x5ca5b8,_0xa40ec4);else{for(var _0x556099=_0x466311[_0x314bbf(0xcb)]-0x1;_0x556099>=0x0;_0x556099--)if(_0x99054e=_0x466311[_0x556099])_0x9c9e98=(_0x5a7ceb<0x3?_0x99054e(_0x9c9e98):_0x5a7ceb>0x3?_0x99054e(_0x3ad3d7,_0x5ca5b8,_0x9c9e98):_0x99054e(_0x3ad3d7,_0x5ca5b8))||_0x9c9e98;}return _0x5a7ceb>0x3&&_0x9c9e98&&Object[_0x314bbf(0xd3)](_0x3ad3d7,_0x5ca5b8,_0x9c9e98),_0x9c9e98;},__metadata=this&&this[a2_0x397442(0xa9)]||function(_0x3544ba,_0x4cb965){const _0x37fac1=a2_0x397442;if(typeof Reflect==='object'&&typeof Reflect[_0x37fac1(0xaa)]===_0x37fac1(0xb2))return Reflect[_0x37fac1(0xaa)](_0x3544ba,_0x4cb965);},AgendaService_1;function a2_0x19a0(){const _0x51c370=['cancelJob','PlayTextToAudio','ScheduleChangedEvent','values','PlaySound','JobType','PROCESS_CACHE','initialize','10284834msGBtc','name','EventChangedEvent','667980MnoBFV','2334160SowWjn','Failed\x20to\x20cancel\x20job\x20','mongodb','Logger','endDate','scheduleJob','toPlayMusicCommand','1370915FbEIaZ','./dtos','toPlayTextToAudioCommand','../common/job','0\x200\x20*\x20*\x20*','getJobPayload','BackgroundJobType','_id','schedule','log','@nestjs/event-emitter','every','__metadata','metadata','2348264uMmqgb','decorate','when','\x20is\x20cancelled','../common/events','design:type','./mappers/textToAudio.mapper','function','../common/enums','now','logger','PlayMusic','Deleted','__esModule','11820921FzMqat','NotFoundException','jobs','getOwnPropertyDescriptor','jobType','toPlaySoundCommand','ObjectId','cancel','PurgeTempUploadedFiles','@agent-ly/nestjs-agenda','CheckEvent','object','killProcess','./mappers','design:returntype','272675IRYXfV','__decorate','design:paramtypes','length','OnEvent','startDate','PlayVoiceRecorded','Created','rescheduleEvents','Job\x20','agendaAgent','defineProperty','AgendaService'];a2_0x19a0=function(){return _0x51c370;};return a2_0x19a0();}Object[a2_0x397442(0xd3)](exports,a2_0x397442(0xb8),{'value':!![]}),exports[a2_0x397442(0xd4)]=void 0x0;const common_1=require('@nestjs/common'),nestjs_agenda_1=require(a2_0x397442(0xc2)),event_emitter_1=require(a2_0x397442(0xa7)),mongodb_1=require(a2_0x397442(0x98)),enums_1=require(a2_0x397442(0xb3)),events_1=require(a2_0x397442(0xaf)),job_1=require(a2_0x397442(0xa0)),dtos_1=require(a2_0x397442(0x9e)),mappers_1=require(a2_0x397442(0xc6)),voice_mapper_1=require('./mappers/voice.mapper'),textToAudio_mapper_1=require(a2_0x397442(0xb1));function a2_0x1c8b(_0xf8f261,_0x96d4a5){const _0x19a06a=a2_0x19a0();return a2_0x1c8b=function(_0x1c8b65,_0x530c77){_0x1c8b65=_0x1c8b65-0x92;let _0x359d3d=_0x19a06a[_0x1c8b65];return _0x359d3d;},a2_0x1c8b(_0xf8f261,_0x96d4a5);}let AgendaService=AgendaService_1=class AgendaService{constructor(_0x461433){const _0x335d87=a2_0x397442;this[_0x335d87(0xd2)]=_0x461433,this[_0x335d87(0xb5)]=new common_1[(_0x335d87(0x99))](AgendaService_1[_0x335d87(0x93)]),this[_0x335d87(0xdc)]();}async[a2_0x397442(0xdc)](){const _0x4759cf=a2_0x397442;await this[_0x4759cf(0xd2)]['purge'](),this[_0x4759cf(0xd2)][_0x4759cf(0xa8)](_0x4759cf(0xa1),enums_1[_0x4759cf(0xa3)][_0x4759cf(0xc3)]),this['agendaAgent']['every'](_0x4759cf(0xa1),enums_1[_0x4759cf(0xa3)][_0x4759cf(0xc1)]),this[_0x4759cf(0xd2)][_0x4759cf(0xb4)](enums_1[_0x4759cf(0xa3)][_0x4759cf(0xc3)],null);}async[a2_0x397442(0xd0)](){const _0x3652b7=a2_0x397442;this['logger'][_0x3652b7(0xa6)]('Scheduling\x20events...'),await this['agendaAgent'][_0x3652b7(0xc0)]({'name':{'$in':Object[_0x3652b7(0xd8)](enums_1[_0x3652b7(0xda)])}}),this[_0x3652b7(0xd2)]['now'](enums_1[_0x3652b7(0xa3)][_0x3652b7(0xc3)],null);}async['getJobs'](){const _0x3057d4=a2_0x397442,_0x1e1d25=await this['agendaAgent'][_0x3057d4(0xbb)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x1e1d25;}async[a2_0x397442(0x9b)](_0x393b4c){const _0x51bd2f=a2_0x397442,_0x2c38eb=this[_0x51bd2f(0xa2)](_0x393b4c),_0x494656=(0x0,dtos_1['isScheduleJobDTO'])(_0x393b4c),_0x4186da=_0x494656?_0x393b4c[_0x51bd2f(0xad)]:_0x393b4c[_0x51bd2f(0xa8)];let _0x163834;return _0x494656?_0x163834=await this[_0x51bd2f(0xd2)][_0x51bd2f(0xa5)](_0x4186da,_0x393b4c[_0x51bd2f(0xbd)],_0x2c38eb):_0x163834=await this['agendaAgent'][_0x51bd2f(0xa8)](_0x4186da,_0x393b4c[_0x51bd2f(0xbd)],_0x2c38eb,{'startDate':new Date(_0x393b4c[_0x51bd2f(0xcd)]),'endDate':new Date(_0x393b4c[_0x51bd2f(0x9a)]),'skipImmediate':!![]}),{'jobId':_0x163834['attrs'][_0x51bd2f(0xa4)]['toString']()};}async[a2_0x397442(0xd5)](_0x4cf577){const _0x373d3b=a2_0x397442,_0x338a8f=await this[_0x373d3b(0xd2)][_0x373d3b(0xbb)]({'_id':new mongodb_1[(_0x373d3b(0xbf))](_0x4cf577)});if(!_0x338a8f[_0x373d3b(0xcb)])return{'success':!![],'message':_0x373d3b(0xd1)+_0x4cf577+'\x20not\x20found'};const _0xe7a347=await this[_0x373d3b(0xd2)][_0x373d3b(0xc0)]({'_id':new mongodb_1[(_0x373d3b(0xbf))](_0x4cf577)});job_1[_0x373d3b(0xdb)][_0x373d3b(0xc5)](_0x4cf577);if(_0xe7a347)return{'success':!![],'message':_0x373d3b(0xd1)+_0x4cf577+_0x373d3b(0xae)};return{'success':![],'message':_0x373d3b(0x97)+_0x4cf577};}async['rescheduleJob'](_0x13cee1,_0x7dc9ea){const _0x24a8fc=a2_0x397442;return await this['cancelJob'](_0x13cee1),await this[_0x24a8fc(0x9b)](_0x7dc9ea);}[a2_0x397442(0xa2)](_0x12afab){const _0x37da60=a2_0x397442;switch(_0x12afab[_0x37da60(0xbd)]){case enums_1['JobType'][_0x37da60(0xd9)]:{return(0x0,mappers_1[_0x37da60(0xbe)])(_0x12afab);}case enums_1[_0x37da60(0xda)][_0x37da60(0xb6)]:{return(0x0,mappers_1[_0x37da60(0x9c)])(_0x12afab);}case enums_1[_0x37da60(0xda)][_0x37da60(0xce)]:{return(0x0,voice_mapper_1['toPlayVoiceCommand'])(_0x12afab);}case enums_1[_0x37da60(0xda)][_0x37da60(0xd6)]:{return(0x0,textToAudio_mapper_1[_0x37da60(0x9f)])(_0x12afab);}default:throw new common_1[(_0x37da60(0xba))]('Job\x20type\x20not\x20found');}}};__decorate([(0x0,event_emitter_1[a2_0x397442(0xcc)])(events_1['ScheduleChangedEvent']['Updated']),(0x0,event_emitter_1[a2_0x397442(0xcc)])(events_1[a2_0x397442(0xd7)][a2_0x397442(0xb7)]),(0x0,event_emitter_1[a2_0x397442(0xcc)])(events_1[a2_0x397442(0x94)][a2_0x397442(0xcf)]),(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x397442(0x94)]['Updated']),(0x0,event_emitter_1[a2_0x397442(0xcc)])(events_1['EventChangedEvent'][a2_0x397442(0xb7)]),__metadata(a2_0x397442(0xb0),Function),__metadata(a2_0x397442(0xca),[]),__metadata(a2_0x397442(0xc7),Promise)],AgendaService['prototype'],a2_0x397442(0xd0),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(a2_0x397442(0xca),[nestjs_agenda_1[a2_0x397442(0xd4)]])],AgendaService),exports[a2_0x397442(0xd4)]=AgendaService;