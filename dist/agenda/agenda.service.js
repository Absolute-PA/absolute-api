'use strict';const a2_0x2abfff=a2_0x1651;(function(_0x3d7e0c,_0x1a7948){const _0x2d1f01=a2_0x1651,_0x32b578=_0x3d7e0c();while(!![]){try{const _0x1a41d8=-parseInt(_0x2d1f01(0x100))/0x1*(parseInt(_0x2d1f01(0x10a))/0x2)+parseInt(_0x2d1f01(0x11f))/0x3*(-parseInt(_0x2d1f01(0xef))/0x4)+parseInt(_0x2d1f01(0xfc))/0x5*(parseInt(_0x2d1f01(0x135))/0x6)+parseInt(_0x2d1f01(0xfa))/0x7+-parseInt(_0x2d1f01(0x102))/0x8*(-parseInt(_0x2d1f01(0x130))/0x9)+parseInt(_0x2d1f01(0xe9))/0xa+-parseInt(_0x2d1f01(0x12f))/0xb;if(_0x1a41d8===_0x1a7948)break;else _0x32b578['push'](_0x32b578['shift']());}catch(_0x403bfd){_0x32b578['push'](_0x32b578['shift']());}}}(a2_0x38bf,0x5e8bd));function a2_0x1651(_0x2e0124,_0x20fff2){const _0x38bf32=a2_0x38bf();return a2_0x1651=function(_0x16514e,_0x254dfb){_0x16514e=_0x16514e-0xe6;let _0x1401b9=_0x38bf32[_0x16514e];return _0x1401b9;},a2_0x1651(_0x2e0124,_0x20fff2);}function a2_0x38bf(){const _0x453a9a=['Logger','getJobPayload','startDate','object','PROCESS_CACHE','42juexBQ','__metadata','decorate','NotFoundException','./mappers/voice.mapper','function','scheduleJob','./mappers/textToAudio.mapper','PlayVoiceRecorded','when','Failed\x20to\x20cancel\x20job\x20','now','./dtos','OnEvent','__decorate','PurgeTempUploadedFiles','4827669fCOvQw','80847apLiKL','Created','every','cancelJob','values','24UaZRlq','AgendaService','name','PlayMusic','design:paramtypes','jobType','rescheduleJob','2354110LBXfPh','metadata','toString','rescheduleEvents','killProcess','defineProperty','52236aOLyrU','PlayTextToAudio','Injectable','../common/enums','jobs','@nestjs/common','toPlaySoundCommand','toPlayMusicCommand','mongodb','log','\x20is\x20cancelled','4791150ulHlco','../common/events','377395aqTZuL','Scheduling\x20events...','getJobs','endDate','679927tJFOcN','ScheduleChangedEvent','416nbOssQ','BackgroundJobType','@agent-ly/nestjs-agenda','Job\x20','0\x200\x20*\x20*\x20*','@nestjs/event-emitter','CheckEvent','purge','2dbBRYp','cancel','length','./mappers','prototype','ObjectId','schedule','JobType','EventChangedEvent','initialize','logger','Updated','attrs','toPlayVoiceCommand','toPlayTextToAudioCommand','agendaAgent'];a2_0x38bf=function(){return _0x453a9a;};return a2_0x38bf();}var __decorate=this&&this[a2_0x2abfff(0x12d)]||function(_0x21dec8,_0x183a5c,_0x2f44f1,_0x261a84){const _0x41fa91=a2_0x2abfff;var _0x377d21=arguments['length'],_0x5e1cde=_0x377d21<0x3?_0x183a5c:_0x261a84===null?_0x261a84=Object['getOwnPropertyDescriptor'](_0x183a5c,_0x2f44f1):_0x261a84,_0x4bcede;if(typeof Reflect===_0x41fa91(0x11d)&&typeof Reflect[_0x41fa91(0x121)]===_0x41fa91(0x124))_0x5e1cde=Reflect[_0x41fa91(0x121)](_0x21dec8,_0x183a5c,_0x2f44f1,_0x261a84);else{for(var _0x28123a=_0x21dec8[_0x41fa91(0x10c)]-0x1;_0x28123a>=0x0;_0x28123a--)if(_0x4bcede=_0x21dec8[_0x28123a])_0x5e1cde=(_0x377d21<0x3?_0x4bcede(_0x5e1cde):_0x377d21>0x3?_0x4bcede(_0x183a5c,_0x2f44f1,_0x5e1cde):_0x4bcede(_0x183a5c,_0x2f44f1))||_0x5e1cde;}return _0x377d21>0x3&&_0x5e1cde&&Object[_0x41fa91(0xee)](_0x183a5c,_0x2f44f1,_0x5e1cde),_0x5e1cde;},__metadata=this&&this[a2_0x2abfff(0x120)]||function(_0x2a4972,_0x5581e3){const _0x71ff78=a2_0x2abfff;if(typeof Reflect===_0x71ff78(0x11d)&&typeof Reflect[_0x71ff78(0xea)]===_0x71ff78(0x124))return Reflect['metadata'](_0x2a4972,_0x5581e3);},AgendaService_1;Object[a2_0x2abfff(0xee)](exports,'__esModule',{'value':!![]}),exports[a2_0x2abfff(0x136)]=void 0x0;const common_1=require(a2_0x2abfff(0xf4)),nestjs_agenda_1=require(a2_0x2abfff(0x104)),event_emitter_1=require(a2_0x2abfff(0x107)),mongodb_1=require(a2_0x2abfff(0xf7)),enums_1=require(a2_0x2abfff(0xf2)),events_1=require(a2_0x2abfff(0xfb)),job_1=require('../common/job'),dtos_1=require(a2_0x2abfff(0x12b)),mappers_1=require(a2_0x2abfff(0x10d)),voice_mapper_1=require(a2_0x2abfff(0x123)),textToAudio_mapper_1=require(a2_0x2abfff(0x126));let AgendaService=AgendaService_1=class AgendaService{constructor(_0x17ab0d){const _0xcabb8d=a2_0x2abfff;this[_0xcabb8d(0x119)]=_0x17ab0d,this[_0xcabb8d(0x114)]=new common_1[(_0xcabb8d(0x11a))](AgendaService_1[_0xcabb8d(0x137)]),this[_0xcabb8d(0x113)]();}async[a2_0x2abfff(0x113)](){const _0x56f9b7=a2_0x2abfff;await this[_0x56f9b7(0x119)][_0x56f9b7(0x109)](),this[_0x56f9b7(0x119)][_0x56f9b7(0x132)]('0\x200\x20*\x20*\x20*',enums_1['BackgroundJobType']['CheckEvent']),this[_0x56f9b7(0x119)][_0x56f9b7(0x132)](_0x56f9b7(0x106),enums_1['BackgroundJobType'][_0x56f9b7(0x12e)]),this[_0x56f9b7(0x119)][_0x56f9b7(0x12a)](enums_1['BackgroundJobType']['CheckEvent'],null);}async['rescheduleEvents'](){const _0x39975d=a2_0x2abfff;this[_0x39975d(0x114)][_0x39975d(0xf8)](_0x39975d(0xfd)),await this[_0x39975d(0x119)][_0x39975d(0x10b)]({'name':{'$in':Object[_0x39975d(0x134)](enums_1[_0x39975d(0x111)])}}),this[_0x39975d(0x119)][_0x39975d(0x12a)](enums_1[_0x39975d(0x103)][_0x39975d(0x108)],null);}async[a2_0x2abfff(0xfe)](){const _0x7ae1b7=a2_0x2abfff,_0x4e3b87=await this[_0x7ae1b7(0x119)][_0x7ae1b7(0xf3)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x4e3b87;}async[a2_0x2abfff(0x125)](_0x34358a){const _0x4bf161=a2_0x2abfff,_0x1a19e3=this[_0x4bf161(0x11b)](_0x34358a),_0x451cc1=(0x0,dtos_1['isScheduleJobDTO'])(_0x34358a),_0x2d3f75=_0x451cc1?_0x34358a[_0x4bf161(0x128)]:_0x34358a[_0x4bf161(0x132)];let _0x24b2a0;return _0x451cc1?_0x24b2a0=await this[_0x4bf161(0x119)][_0x4bf161(0x110)](_0x2d3f75,_0x34358a[_0x4bf161(0xe7)],_0x1a19e3):_0x24b2a0=await this[_0x4bf161(0x119)]['every'](_0x2d3f75,_0x34358a['jobType'],_0x1a19e3,{'startDate':new Date(_0x34358a[_0x4bf161(0x11c)]),'endDate':new Date(_0x34358a[_0x4bf161(0xff)]),'skipImmediate':!![]}),{'jobId':_0x24b2a0[_0x4bf161(0x116)]['_id'][_0x4bf161(0xeb)]()};}async[a2_0x2abfff(0x133)](_0x5c9a17){const _0x4d265a=a2_0x2abfff,_0x2c494a=await this[_0x4d265a(0x119)][_0x4d265a(0xf3)]({'_id':new mongodb_1[(_0x4d265a(0x10f))](_0x5c9a17)});if(!_0x2c494a['length'])return{'success':!![],'message':_0x4d265a(0x105)+_0x5c9a17+'\x20not\x20found'};const _0x548930=await this[_0x4d265a(0x119)][_0x4d265a(0x10b)]({'_id':new mongodb_1[(_0x4d265a(0x10f))](_0x5c9a17)});job_1[_0x4d265a(0x11e)][_0x4d265a(0xed)](_0x5c9a17);if(_0x548930)return{'success':!![],'message':_0x4d265a(0x105)+_0x5c9a17+_0x4d265a(0xf9)};return{'success':![],'message':_0x4d265a(0x129)+_0x5c9a17};}async[a2_0x2abfff(0xe8)](_0x4dcc52,_0x253e28){const _0x4936dd=a2_0x2abfff;return await this[_0x4936dd(0x133)](_0x4dcc52),await this[_0x4936dd(0x125)](_0x253e28);}['getJobPayload'](_0x292914){const _0x3b056c=a2_0x2abfff;switch(_0x292914[_0x3b056c(0xe7)]){case enums_1[_0x3b056c(0x111)]['PlaySound']:{return(0x0,mappers_1[_0x3b056c(0xf5)])(_0x292914);}case enums_1['JobType'][_0x3b056c(0x138)]:{return(0x0,mappers_1[_0x3b056c(0xf6)])(_0x292914);}case enums_1[_0x3b056c(0x111)][_0x3b056c(0x127)]:{return(0x0,voice_mapper_1[_0x3b056c(0x117)])(_0x292914);}case enums_1[_0x3b056c(0x111)][_0x3b056c(0xf0)]:{return(0x0,textToAudio_mapper_1[_0x3b056c(0x118)])(_0x292914);}default:throw new common_1[(_0x3b056c(0x122))]('Job\x20type\x20not\x20found');}}};__decorate([(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x2abfff(0x101)][a2_0x2abfff(0x115)]),(0x0,event_emitter_1[a2_0x2abfff(0x12c)])(events_1[a2_0x2abfff(0x101)]['Deleted']),(0x0,event_emitter_1[a2_0x2abfff(0x12c)])(events_1[a2_0x2abfff(0x112)][a2_0x2abfff(0x131)]),(0x0,event_emitter_1[a2_0x2abfff(0x12c)])(events_1[a2_0x2abfff(0x112)]['Updated']),(0x0,event_emitter_1[a2_0x2abfff(0x12c)])(events_1[a2_0x2abfff(0x112)]['Deleted']),__metadata('design:type',Function),__metadata('design:paramtypes',[]),__metadata('design:returntype',Promise)],AgendaService[a2_0x2abfff(0x10e)],a2_0x2abfff(0xec),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x2abfff(0xf1)])(),__metadata(a2_0x2abfff(0xe6),[nestjs_agenda_1[a2_0x2abfff(0x136)]])],AgendaService),exports[a2_0x2abfff(0x136)]=AgendaService;