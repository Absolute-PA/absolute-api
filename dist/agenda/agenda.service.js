'use strict';const a2_0x33eac9=a2_0x4eee;(function(_0x2d9928,_0x5380c9){const _0x558dc1=a2_0x4eee,_0x2a2508=_0x2d9928();while(!![]){try{const _0x30b185=parseInt(_0x558dc1(0xca))/0x1+-parseInt(_0x558dc1(0xc8))/0x2+parseInt(_0x558dc1(0x99))/0x3+parseInt(_0x558dc1(0xb8))/0x4*(parseInt(_0x558dc1(0x8f))/0x5)+-parseInt(_0x558dc1(0xb9))/0x6*(parseInt(_0x558dc1(0xa4))/0x7)+-parseInt(_0x558dc1(0xa6))/0x8+parseInt(_0x558dc1(0xb4))/0x9;if(_0x30b185===_0x5380c9)break;else _0x2a2508['push'](_0x2a2508['shift']());}catch(_0x27f561){_0x2a2508['push'](_0x2a2508['shift']());}}}(a2_0x2c36,0x1df55));function a2_0x2c36(){const _0xa9a33a=['./mappers/voice.mapper','../common/job','attrs','killProcess','schedule','\x20not\x20found','function','AgendaService','295iZhyiH','@nestjs/common','purge','BackgroundJobType','initialize','design:returntype','Injectable','defineProperty','endDate','EventChangedEvent','595017Fxqght','agendaAgent','toString','Scheduling\x20events...','every','values','PlaySound','_id','decorate','__metadata','Failed\x20to\x20cancel\x20job\x20','273mHJYIp','design:paramtypes','1726480scpEkb','now','ScheduleChangedEvent','log','JobType','jobs','object','startDate','toPlayTextToAudioCommand','__esModule','Logger','Job\x20','Updated','jobType','1312020oOfTfo','CheckEvent','OnEvent','toPlaySoundCommand','4412JhrKXa','4698SOZqqS','@agent-ly/nestjs-agenda','PROCESS_CACHE','toPlayVoiceCommand','when','getOwnPropertyDescriptor','./dtos','metadata','__decorate','PurgeTempUploadedFiles','logger','length','@nestjs/event-emitter','getJobPayload','rescheduleJob','370760OizSwS','rescheduleEvents','145240ASDFbh','cancelJob','./mappers','design:type','./mappers/textToAudio.mapper','scheduleJob','Deleted','prototype','0\x200\x20*\x20*\x20*','PlayMusic','../common/events','Created','toPlayMusicCommand','ObjectId'];a2_0x2c36=function(){return _0xa9a33a;};return a2_0x2c36();}var __decorate=this&&this[a2_0x33eac9(0xc1)]||function(_0x305c10,_0x5591cb,_0x116802,_0x37880d){const _0x11fee3=a2_0x33eac9;var _0x47a1b6=arguments[_0x11fee3(0xc4)],_0x4adcd9=_0x47a1b6<0x3?_0x5591cb:_0x37880d===null?_0x37880d=Object[_0x11fee3(0xbe)](_0x5591cb,_0x116802):_0x37880d,_0x8e5034;if(typeof Reflect===_0x11fee3(0xac)&&typeof Reflect[_0x11fee3(0xa1)]===_0x11fee3(0x8d))_0x4adcd9=Reflect[_0x11fee3(0xa1)](_0x305c10,_0x5591cb,_0x116802,_0x37880d);else{for(var _0x57ad5d=_0x305c10['length']-0x1;_0x57ad5d>=0x0;_0x57ad5d--)if(_0x8e5034=_0x305c10[_0x57ad5d])_0x4adcd9=(_0x47a1b6<0x3?_0x8e5034(_0x4adcd9):_0x47a1b6>0x3?_0x8e5034(_0x5591cb,_0x116802,_0x4adcd9):_0x8e5034(_0x5591cb,_0x116802))||_0x4adcd9;}return _0x47a1b6>0x3&&_0x4adcd9&&Object[_0x11fee3(0x96)](_0x5591cb,_0x116802,_0x4adcd9),_0x4adcd9;},__metadata=this&&this[a2_0x33eac9(0xa2)]||function(_0xe2416c,_0x248b33){const _0x57aee5=a2_0x33eac9;if(typeof Reflect===_0x57aee5(0xac)&&typeof Reflect[_0x57aee5(0xc0)]===_0x57aee5(0x8d))return Reflect[_0x57aee5(0xc0)](_0xe2416c,_0x248b33);},AgendaService_1;Object[a2_0x33eac9(0x96)](exports,a2_0x33eac9(0xaf),{'value':!![]}),exports[a2_0x33eac9(0x8e)]=void 0x0;const common_1=require(a2_0x33eac9(0x90)),nestjs_agenda_1=require(a2_0x33eac9(0xba)),event_emitter_1=require(a2_0x33eac9(0xc5)),mongodb_1=require('mongodb'),enums_1=require('../common/enums'),events_1=require(a2_0x33eac9(0x83)),job_1=require(a2_0x33eac9(0x88)),dtos_1=require(a2_0x33eac9(0xbf)),mappers_1=require(a2_0x33eac9(0xcc)),voice_mapper_1=require(a2_0x33eac9(0x87)),textToAudio_mapper_1=require(a2_0x33eac9(0xce));function a2_0x4eee(_0xc956d8,_0x43ca78){const _0x2c3682=a2_0x2c36();return a2_0x4eee=function(_0x4eeeab,_0x5ae49d){_0x4eeeab=_0x4eeeab-0x7e;let _0xe5f25b=_0x2c3682[_0x4eeeab];return _0xe5f25b;},a2_0x4eee(_0xc956d8,_0x43ca78);}let AgendaService=AgendaService_1=class AgendaService{constructor(_0x2dc392){const _0x3fcac9=a2_0x33eac9;this[_0x3fcac9(0x9a)]=_0x2dc392,this[_0x3fcac9(0xc3)]=new common_1[(_0x3fcac9(0xb0))](AgendaService_1['name']),this[_0x3fcac9(0x93)]();}async['initialize'](){const _0x12f4a0=a2_0x33eac9;await this['agendaAgent'][_0x12f4a0(0x91)](),this[_0x12f4a0(0x9a)][_0x12f4a0(0x9d)](_0x12f4a0(0x81),enums_1[_0x12f4a0(0x92)][_0x12f4a0(0xb5)]),this['agendaAgent']['every']('0\x200\x20*\x20*\x20*',enums_1['BackgroundJobType'][_0x12f4a0(0xc2)]),this['agendaAgent']['now'](enums_1[_0x12f4a0(0x92)][_0x12f4a0(0xb5)],null);}async[a2_0x33eac9(0xc9)](){const _0x5a1623=a2_0x33eac9;this[_0x5a1623(0xc3)][_0x5a1623(0xa9)](_0x5a1623(0x9c)),await this[_0x5a1623(0x9a)]['cancel']({'name':{'$in':Object[_0x5a1623(0x9e)](enums_1['JobType'])}}),this['agendaAgent'][_0x5a1623(0xa7)](enums_1[_0x5a1623(0x92)][_0x5a1623(0xb5)],null);}async['getJobs'](){const _0x218aef=a2_0x33eac9,_0x1799a0=await this[_0x218aef(0x9a)][_0x218aef(0xab)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x1799a0;}async['scheduleJob'](_0x29a629){const _0x806ea1=a2_0x33eac9,_0xa7e12d=this[_0x806ea1(0xc6)](_0x29a629),_0x1e1f66=(0x0,dtos_1['isScheduleJobDTO'])(_0x29a629),_0x33fdfe=_0x1e1f66?_0x29a629[_0x806ea1(0xbd)]:_0x29a629['every'];let _0x120331;return _0x1e1f66?_0x120331=await this['agendaAgent'][_0x806ea1(0x8b)](_0x33fdfe,_0x29a629[_0x806ea1(0xb3)],_0xa7e12d):_0x120331=await this[_0x806ea1(0x9a)][_0x806ea1(0x9d)](_0x33fdfe,_0x29a629['jobType'],_0xa7e12d,{'startDate':new Date(_0x29a629[_0x806ea1(0xad)]),'endDate':new Date(_0x29a629[_0x806ea1(0x97)]),'skipImmediate':!![]}),{'jobId':_0x120331[_0x806ea1(0x89)][_0x806ea1(0xa0)][_0x806ea1(0x9b)]()};}async[a2_0x33eac9(0xcb)](_0x101578){const _0xa44c38=a2_0x33eac9,_0x152a8c=await this[_0xa44c38(0x9a)][_0xa44c38(0xab)]({'_id':new mongodb_1[(_0xa44c38(0x86))](_0x101578)});if(!_0x152a8c['length'])return{'success':!![],'message':_0xa44c38(0xb1)+_0x101578+_0xa44c38(0x8c)};const _0xba204e=await this['agendaAgent']['cancel']({'_id':new mongodb_1[(_0xa44c38(0x86))](_0x101578)});job_1[_0xa44c38(0xbb)][_0xa44c38(0x8a)](_0x101578);if(_0xba204e)return{'success':!![],'message':_0xa44c38(0xb1)+_0x101578+'\x20is\x20cancelled'};return{'success':![],'message':_0xa44c38(0xa3)+_0x101578};}async[a2_0x33eac9(0xc7)](_0x50e499,_0x20cfd1){const _0x1da9e7=a2_0x33eac9;return await this['cancelJob'](_0x50e499),await this[_0x1da9e7(0x7e)](_0x20cfd1);}[a2_0x33eac9(0xc6)](_0x4e492b){const _0x5408b7=a2_0x33eac9;switch(_0x4e492b[_0x5408b7(0xb3)]){case enums_1[_0x5408b7(0xaa)][_0x5408b7(0x9f)]:{return(0x0,mappers_1[_0x5408b7(0xb7)])(_0x4e492b);}case enums_1[_0x5408b7(0xaa)][_0x5408b7(0x82)]:{return(0x0,mappers_1[_0x5408b7(0x85)])(_0x4e492b);}case enums_1[_0x5408b7(0xaa)]['PlayVoiceRecorded']:{return(0x0,voice_mapper_1[_0x5408b7(0xbc)])(_0x4e492b);}case enums_1[_0x5408b7(0xaa)]['PlayTextToAudio']:{return(0x0,textToAudio_mapper_1[_0x5408b7(0xae)])(_0x4e492b);}default:throw new common_1['NotFoundException']('Job\x20type\x20not\x20found');}}};__decorate([(0x0,event_emitter_1[a2_0x33eac9(0xb6)])(events_1[a2_0x33eac9(0xa8)][a2_0x33eac9(0xb2)]),(0x0,event_emitter_1[a2_0x33eac9(0xb6)])(events_1[a2_0x33eac9(0xa8)][a2_0x33eac9(0x7f)]),(0x0,event_emitter_1[a2_0x33eac9(0xb6)])(events_1[a2_0x33eac9(0x98)][a2_0x33eac9(0x84)]),(0x0,event_emitter_1[a2_0x33eac9(0xb6)])(events_1['EventChangedEvent']['Updated']),(0x0,event_emitter_1[a2_0x33eac9(0xb6)])(events_1[a2_0x33eac9(0x98)][a2_0x33eac9(0x7f)]),__metadata(a2_0x33eac9(0xcd),Function),__metadata(a2_0x33eac9(0xa5),[]),__metadata(a2_0x33eac9(0x94),Promise)],AgendaService[a2_0x33eac9(0x80)],a2_0x33eac9(0xc9),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x33eac9(0x95)])(),__metadata('design:paramtypes',[nestjs_agenda_1[a2_0x33eac9(0x8e)]])],AgendaService),exports[a2_0x33eac9(0x8e)]=AgendaService;