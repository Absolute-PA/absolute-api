'use strict';const a2_0x1ab42f=a2_0xf19f;(function(_0x147365,_0x47e04c){const _0x201b60=a2_0xf19f,_0xd4e650=_0x147365();while(!![]){try{const _0xa2c35f=-parseInt(_0x201b60(0x1e3))/0x1+parseInt(_0x201b60(0x1c2))/0x2*(parseInt(_0x201b60(0x1b8))/0x3)+-parseInt(_0x201b60(0x1d4))/0x4*(-parseInt(_0x201b60(0x1ce))/0x5)+-parseInt(_0x201b60(0x1c7))/0x6*(-parseInt(_0x201b60(0x1a7))/0x7)+-parseInt(_0x201b60(0x1ea))/0x8*(parseInt(_0x201b60(0x1dd))/0x9)+-parseInt(_0x201b60(0x1da))/0xa*(-parseInt(_0x201b60(0x1a8))/0xb)+-parseInt(_0x201b60(0x1a2))/0xc*(-parseInt(_0x201b60(0x1ca))/0xd);if(_0xa2c35f===_0x47e04c)break;else _0xd4e650['push'](_0xd4e650['shift']());}catch(_0x1abfe3){_0xd4e650['push'](_0xd4e650['shift']());}}}(a2_0x5491,0x847d7));var __decorate=this&&this['__decorate']||function(_0x32e299,_0x2ffdc8,_0x22ec83,_0x385d9b){const _0x59beee=a2_0xf19f;var _0x6e37f1=arguments[_0x59beee(0x1d3)],_0x31d3a3=_0x6e37f1<0x3?_0x2ffdc8:_0x385d9b===null?_0x385d9b=Object['getOwnPropertyDescriptor'](_0x2ffdc8,_0x22ec83):_0x385d9b,_0xd75032;if(typeof Reflect===_0x59beee(0x1b4)&&typeof Reflect['decorate']===_0x59beee(0x1b3))_0x31d3a3=Reflect['decorate'](_0x32e299,_0x2ffdc8,_0x22ec83,_0x385d9b);else{for(var _0x479342=_0x32e299[_0x59beee(0x1d3)]-0x1;_0x479342>=0x0;_0x479342--)if(_0xd75032=_0x32e299[_0x479342])_0x31d3a3=(_0x6e37f1<0x3?_0xd75032(_0x31d3a3):_0x6e37f1>0x3?_0xd75032(_0x2ffdc8,_0x22ec83,_0x31d3a3):_0xd75032(_0x2ffdc8,_0x22ec83))||_0x31d3a3;}return _0x6e37f1>0x3&&_0x31d3a3&&Object['defineProperty'](_0x2ffdc8,_0x22ec83,_0x31d3a3),_0x31d3a3;},__metadata=this&&this[a2_0x1ab42f(0x1cf)]||function(_0x3d09fa,_0x11dbec){const _0x2a224a=a2_0x1ab42f;if(typeof Reflect===_0x2a224a(0x1b4)&&typeof Reflect[_0x2a224a(0x1c6)]===_0x2a224a(0x1b3))return Reflect[_0x2a224a(0x1c6)](_0x3d09fa,_0x11dbec);},AgendaService_1;function a2_0xf19f(_0x28a62f,_0x4d2a44){const _0x5491bb=a2_0x5491();return a2_0xf19f=function(_0xf19f63,_0x43b899){_0xf19f63=_0xf19f63-0x19f;let _0x380cc8=_0x5491bb[_0xf19f63];return _0x380cc8;},a2_0xf19f(_0x28a62f,_0x4d2a44);}Object['defineProperty'](exports,a2_0x1ab42f(0x1a6),{'value':!![]}),exports[a2_0x1ab42f(0x1ab)]=void 0x0;function a2_0x5491(){const _0x590899=['./dtos','name','61930mcMYUB','@nestjs/event-emitter','cancelJob','77967EOHdnI','PlayVoiceRecorded','toString','PlayMusic','design:paramtypes','./mappers/textToAudio.mapper','1068762dwMkdv','BackgroundJobType','purge','schedule','Job\x20','\x20not\x20found','mongodb','480VuRBgH','EventChangedEvent','Job\x20type\x20not\x20found','jobType','attrs','log','0\x200\x20*\x20*\x20*','every','12LGyyYF','Updated','toPlayTextToAudioCommand','ObjectId','__esModule','2170IFYQhP','1056JhDFGo','CheckEvent','Created','AgendaService','jobs','agendaAgent','design:type','./mappers','killProcess','PurgeTempUploadedFiles','when','function','object','isScheduleJobDTO','ScheduleChangedEvent','../common/events','26646BjnFuv','JobType','getJobPayload','OnEvent','Injectable','getJobs','@nestjs/common','@agent-ly/nestjs-agenda','Scheduling\x20events...','values','34OWfvmf','now','toPlaySoundCommand','NotFoundException','metadata','9918bloZem','rescheduleEvents','logger','1736761geAHUA','../common/job','cancel','initialize','10KkKauZ','__metadata','Deleted','scheduleJob','endDate','length','1479344lpEwRu','_id','../common/enums','Failed\x20to\x20cancel\x20job\x20'];a2_0x5491=function(){return _0x590899;};return a2_0x5491();}const common_1=require(a2_0x1ab42f(0x1be)),nestjs_agenda_1=require(a2_0x1ab42f(0x1bf)),event_emitter_1=require(a2_0x1ab42f(0x1db)),mongodb_1=require(a2_0x1ab42f(0x1e9)),enums_1=require(a2_0x1ab42f(0x1d6)),events_1=require(a2_0x1ab42f(0x1b7)),job_1=require(a2_0x1ab42f(0x1cb)),dtos_1=require(a2_0x1ab42f(0x1d8)),mappers_1=require(a2_0x1ab42f(0x1af)),voice_mapper_1=require('./mappers/voice.mapper'),textToAudio_mapper_1=require(a2_0x1ab42f(0x1e2));let AgendaService=AgendaService_1=class AgendaService{constructor(_0x31605b){const _0x557ca6=a2_0x1ab42f;this['agendaAgent']=_0x31605b,this[_0x557ca6(0x1c9)]=new common_1['Logger'](AgendaService_1[_0x557ca6(0x1d9)]),this[_0x557ca6(0x1cd)]();}async[a2_0x1ab42f(0x1cd)](){const _0x2f7d59=a2_0x1ab42f;await this[_0x2f7d59(0x1ad)][_0x2f7d59(0x1e5)](),this[_0x2f7d59(0x1ad)][_0x2f7d59(0x1a1)]('0\x200\x20*\x20*\x20*',enums_1['BackgroundJobType'][_0x2f7d59(0x1a9)]),this[_0x2f7d59(0x1ad)]['every'](_0x2f7d59(0x1a0),enums_1[_0x2f7d59(0x1e4)][_0x2f7d59(0x1b1)]),this[_0x2f7d59(0x1ad)][_0x2f7d59(0x1c3)](enums_1[_0x2f7d59(0x1e4)][_0x2f7d59(0x1a9)],null);}async[a2_0x1ab42f(0x1c8)](){const _0x3f8aca=a2_0x1ab42f;this['logger'][_0x3f8aca(0x19f)](_0x3f8aca(0x1c0)),await this[_0x3f8aca(0x1ad)][_0x3f8aca(0x1cc)]({'name':{'$in':Object[_0x3f8aca(0x1c1)](enums_1[_0x3f8aca(0x1b9)])}}),this[_0x3f8aca(0x1ad)]['now'](enums_1[_0x3f8aca(0x1e4)][_0x3f8aca(0x1a9)],null);}async[a2_0x1ab42f(0x1bd)](){const _0x3ffeb0=a2_0x1ab42f,_0x3b3a30=await this[_0x3ffeb0(0x1ad)]['jobs']({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x3b3a30;}async[a2_0x1ab42f(0x1d1)](_0x12acbd){const _0x5cc8ab=a2_0x1ab42f,_0x43bc9f=this[_0x5cc8ab(0x1ba)](_0x12acbd),_0x22f557=(0x0,dtos_1[_0x5cc8ab(0x1b5)])(_0x12acbd),_0x17ff23=_0x22f557?_0x12acbd[_0x5cc8ab(0x1b2)]:_0x12acbd[_0x5cc8ab(0x1a1)];let _0x56edd5;return _0x22f557?_0x56edd5=await this['agendaAgent'][_0x5cc8ab(0x1e6)](_0x17ff23,_0x12acbd['jobType'],_0x43bc9f):_0x56edd5=await this[_0x5cc8ab(0x1ad)]['every'](_0x17ff23,_0x12acbd[_0x5cc8ab(0x1ed)],_0x43bc9f,{'startDate':new Date(_0x12acbd['startDate']),'endDate':new Date(_0x12acbd[_0x5cc8ab(0x1d2)]),'skipImmediate':!![]}),{'jobId':_0x56edd5[_0x5cc8ab(0x1ee)][_0x5cc8ab(0x1d5)][_0x5cc8ab(0x1df)]()};}async[a2_0x1ab42f(0x1dc)](_0x1fedae){const _0x1dbc2a=a2_0x1ab42f,_0x4cdb17=await this[_0x1dbc2a(0x1ad)][_0x1dbc2a(0x1ac)]({'_id':new mongodb_1[(_0x1dbc2a(0x1a5))](_0x1fedae)});if(!_0x4cdb17[_0x1dbc2a(0x1d3)])return{'success':!![],'message':'Job\x20'+_0x1fedae+_0x1dbc2a(0x1e8)};const _0x287a59=await this[_0x1dbc2a(0x1ad)][_0x1dbc2a(0x1cc)]({'_id':new mongodb_1['ObjectId'](_0x1fedae)});job_1['PROCESS_CACHE'][_0x1dbc2a(0x1b0)](_0x1fedae);if(_0x287a59)return{'success':!![],'message':_0x1dbc2a(0x1e7)+_0x1fedae+'\x20is\x20cancelled'};return{'success':![],'message':_0x1dbc2a(0x1d7)+_0x1fedae};}async['rescheduleJob'](_0x5a769e,_0x2068ee){const _0x2f0abb=a2_0x1ab42f;return await this[_0x2f0abb(0x1dc)](_0x5a769e),await this['scheduleJob'](_0x2068ee);}['getJobPayload'](_0x58ba3f){const _0x4cea4e=a2_0x1ab42f;switch(_0x58ba3f[_0x4cea4e(0x1ed)]){case enums_1[_0x4cea4e(0x1b9)]['PlaySound']:{return(0x0,mappers_1[_0x4cea4e(0x1c4)])(_0x58ba3f);}case enums_1['JobType'][_0x4cea4e(0x1e0)]:{return(0x0,mappers_1['toPlayMusicCommand'])(_0x58ba3f);}case enums_1[_0x4cea4e(0x1b9)][_0x4cea4e(0x1de)]:{return(0x0,voice_mapper_1['toPlayVoiceCommand'])(_0x58ba3f);}case enums_1[_0x4cea4e(0x1b9)]['PlayTextToAudio']:{return(0x0,textToAudio_mapper_1[_0x4cea4e(0x1a4)])(_0x58ba3f);}default:throw new common_1[(_0x4cea4e(0x1c5))](_0x4cea4e(0x1ec));}}};__decorate([(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x1ab42f(0x1b6)][a2_0x1ab42f(0x1a3)]),(0x0,event_emitter_1[a2_0x1ab42f(0x1bb)])(events_1[a2_0x1ab42f(0x1b6)][a2_0x1ab42f(0x1d0)]),(0x0,event_emitter_1[a2_0x1ab42f(0x1bb)])(events_1[a2_0x1ab42f(0x1eb)][a2_0x1ab42f(0x1aa)]),(0x0,event_emitter_1[a2_0x1ab42f(0x1bb)])(events_1[a2_0x1ab42f(0x1eb)][a2_0x1ab42f(0x1a3)]),(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x1ab42f(0x1eb)][a2_0x1ab42f(0x1d0)]),__metadata(a2_0x1ab42f(0x1ae),Function),__metadata(a2_0x1ab42f(0x1e1),[]),__metadata('design:returntype',Promise)],AgendaService['prototype'],'rescheduleEvents',null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x1ab42f(0x1bc)])(),__metadata('design:paramtypes',[nestjs_agenda_1[a2_0x1ab42f(0x1ab)]])],AgendaService),exports['AgendaService']=AgendaService;