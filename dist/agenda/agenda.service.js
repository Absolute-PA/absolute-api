'use strict';const a2_0x505e10=a2_0x5b92;(function(_0x502121,_0x591d23){const _0x2ff5fb=a2_0x5b92,_0x257dec=_0x502121();while(!![]){try{const _0x3669ad=parseInt(_0x2ff5fb(0xe1))/0x1*(parseInt(_0x2ff5fb(0x10e))/0x2)+-parseInt(_0x2ff5fb(0xff))/0x3*(parseInt(_0x2ff5fb(0xcb))/0x4)+-parseInt(_0x2ff5fb(0xd6))/0x5*(parseInt(_0x2ff5fb(0xed))/0x6)+-parseInt(_0x2ff5fb(0xd2))/0x7*(-parseInt(_0x2ff5fb(0x107))/0x8)+parseInt(_0x2ff5fb(0xeb))/0x9*(-parseInt(_0x2ff5fb(0xe6))/0xa)+-parseInt(_0x2ff5fb(0xc8))/0xb*(parseInt(_0x2ff5fb(0xd4))/0xc)+parseInt(_0x2ff5fb(0x10c))/0xd;if(_0x3669ad===_0x591d23)break;else _0x257dec['push'](_0x257dec['shift']());}catch(_0x319100){_0x257dec['push'](_0x257dec['shift']());}}}(a2_0x24df,0x78e80));var __decorate=this&&this[a2_0x505e10(0xfd)]||function(_0x302933,_0x134dd6,_0x4a406a,_0x4e45ef){const _0x110d0c=a2_0x505e10;var _0x1e1a28=arguments[_0x110d0c(0xe7)],_0xc93a36=_0x1e1a28<0x3?_0x134dd6:_0x4e45ef===null?_0x4e45ef=Object[_0x110d0c(0xf5)](_0x134dd6,_0x4a406a):_0x4e45ef,_0x5744b2;if(typeof Reflect===_0x110d0c(0x10b)&&typeof Reflect['decorate']===_0x110d0c(0xbf))_0xc93a36=Reflect[_0x110d0c(0xd9)](_0x302933,_0x134dd6,_0x4a406a,_0x4e45ef);else{for(var _0x1d4616=_0x302933[_0x110d0c(0xe7)]-0x1;_0x1d4616>=0x0;_0x1d4616--)if(_0x5744b2=_0x302933[_0x1d4616])_0xc93a36=(_0x1e1a28<0x3?_0x5744b2(_0xc93a36):_0x1e1a28>0x3?_0x5744b2(_0x134dd6,_0x4a406a,_0xc93a36):_0x5744b2(_0x134dd6,_0x4a406a))||_0xc93a36;}return _0x1e1a28>0x3&&_0xc93a36&&Object[_0x110d0c(0xe3)](_0x134dd6,_0x4a406a,_0xc93a36),_0xc93a36;},__metadata=this&&this[a2_0x505e10(0xf6)]||function(_0x1d00ce,_0x1b2ff3){const _0x27431c=a2_0x505e10;if(typeof Reflect==='object'&&typeof Reflect[_0x27431c(0xfe)]===_0x27431c(0xbf))return Reflect[_0x27431c(0xfe)](_0x1d00ce,_0x1b2ff3);},AgendaService_1;Object[a2_0x505e10(0xe3)](exports,a2_0x505e10(0xdb),{'value':!![]}),exports[a2_0x505e10(0xf8)]=void 0x0;function a2_0x24df(){const _0xa00eb0=['schedule','__decorate','metadata','2274XKCgfZ','name','startDate','./mappers','PlayVoiceRecorded','@nestjs/common','BackgroundJobType','initialize','415776mapnpA','cancel','values','PurgeTempUploadedFiles','object','4015245ovIhyK','ObjectId','927604ztcOqP','OnEvent','\x20is\x20cancelled','Updated','logger','function','Created','./mappers/textToAudio.mapper','when','Scheduling\x20events...','_id','toPlayMusicCommand','rescheduleEvents','toString','9295946jZAGGP','ScheduleChangedEvent','design:type','240YUCFaH','getJobs','toPlayVoiceCommand','Deleted','0\x200\x20*\x20*\x20*','Logger','PlayMusic','91dbpVGd','log','12apaqRE','toPlayTextToAudioCommand','263515lnRXvN','killProcess','every','decorate','jobs','__esModule','Job\x20','@agent-ly/nestjs-agenda','../common/events','getJobPayload','EventChangedEvent','2SCXTsM','Failed\x20to\x20cancel\x20job\x20','defineProperty','PlaySound','../common/job','25990DusEKW','length','JobType','prototype','purge','180ysIYDm','agendaAgent','54lfTbBP','design:paramtypes','design:returntype','jobType','cancelJob','now','endDate','isScheduleJobDTO','getOwnPropertyDescriptor','__metadata','\x20not\x20found','AgendaService','CheckEvent','scheduleJob','NotFoundException'];a2_0x24df=function(){return _0xa00eb0;};return a2_0x24df();}const common_1=require(a2_0x505e10(0x104)),nestjs_agenda_1=require(a2_0x505e10(0xdd)),event_emitter_1=require('@nestjs/event-emitter'),mongodb_1=require('mongodb'),enums_1=require('../common/enums'),events_1=require(a2_0x505e10(0xde)),job_1=require(a2_0x505e10(0xe5)),dtos_1=require('./dtos'),mappers_1=require(a2_0x505e10(0x102)),voice_mapper_1=require('./mappers/voice.mapper'),textToAudio_mapper_1=require(a2_0x505e10(0xc1));function a2_0x5b92(_0x224573,_0x554549){const _0x24dfc0=a2_0x24df();return a2_0x5b92=function(_0x5b92e5,_0x3a106d){_0x5b92e5=_0x5b92e5-0xbd;let _0x1939fa=_0x24dfc0[_0x5b92e5];return _0x1939fa;},a2_0x5b92(_0x224573,_0x554549);}let AgendaService=AgendaService_1=class AgendaService{constructor(_0x42637b){const _0x307509=a2_0x505e10;this[_0x307509(0xec)]=_0x42637b,this[_0x307509(0xbe)]=new common_1[(_0x307509(0xd0))](AgendaService_1[_0x307509(0x100)]),this[_0x307509(0x106)]();}async['initialize'](){const _0x7a4228=a2_0x505e10;await this[_0x7a4228(0xec)][_0x7a4228(0xea)](),this[_0x7a4228(0xec)][_0x7a4228(0xd8)](_0x7a4228(0xcf),enums_1[_0x7a4228(0x105)][_0x7a4228(0xf9)]),this[_0x7a4228(0xec)][_0x7a4228(0xd8)](_0x7a4228(0xcf),enums_1[_0x7a4228(0x105)][_0x7a4228(0x10a)]),this['agendaAgent'][_0x7a4228(0xf2)](enums_1[_0x7a4228(0x105)][_0x7a4228(0xf9)],null);}async[a2_0x505e10(0xc6)](){const _0x479a85=a2_0x505e10;this[_0x479a85(0xbe)][_0x479a85(0xd3)](_0x479a85(0xc3)),await this[_0x479a85(0xec)][_0x479a85(0x108)]({'name':{'$in':Object[_0x479a85(0x109)](enums_1[_0x479a85(0xe8)])}}),this['agendaAgent']['now'](enums_1[_0x479a85(0x105)]['CheckEvent'],null);}async[a2_0x505e10(0xcc)](){const _0x396e8c=a2_0x505e10,_0xa5b7cf=await this['agendaAgent'][_0x396e8c(0xda)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0xa5b7cf;}async[a2_0x505e10(0xfa)](_0x7a3cd2){const _0x394df3=a2_0x505e10,_0x4bf2fe=this[_0x394df3(0xdf)](_0x7a3cd2),_0x4235cb=(0x0,dtos_1[_0x394df3(0xf4)])(_0x7a3cd2),_0xa96485=_0x4235cb?_0x7a3cd2[_0x394df3(0xc2)]:_0x7a3cd2[_0x394df3(0xd8)];let _0x7f6b45;return _0x4235cb?_0x7f6b45=await this[_0x394df3(0xec)][_0x394df3(0xfc)](_0xa96485,_0x7a3cd2[_0x394df3(0xf0)],_0x4bf2fe):_0x7f6b45=await this[_0x394df3(0xec)][_0x394df3(0xd8)](_0xa96485,_0x7a3cd2[_0x394df3(0xf0)],_0x4bf2fe,{'startDate':new Date(_0x7a3cd2[_0x394df3(0x101)]),'endDate':new Date(_0x7a3cd2[_0x394df3(0xf3)]),'skipImmediate':!![]}),{'jobId':_0x7f6b45['attrs'][_0x394df3(0xc4)][_0x394df3(0xc7)]()};}async['cancelJob'](_0x938de7){const _0x2a9f5e=a2_0x505e10,_0x2bab8c=await this['agendaAgent'][_0x2a9f5e(0xda)]({'_id':new mongodb_1[(_0x2a9f5e(0x10d))](_0x938de7)});if(!_0x2bab8c[_0x2a9f5e(0xe7)])return{'success':!![],'message':_0x2a9f5e(0xdc)+_0x938de7+_0x2a9f5e(0xf7)};const _0x1ce206=await this[_0x2a9f5e(0xec)]['cancel']({'_id':new mongodb_1[(_0x2a9f5e(0x10d))](_0x938de7)});job_1['PROCESS_CACHE'][_0x2a9f5e(0xd7)](_0x938de7);if(_0x1ce206)return{'success':!![],'message':'Job\x20'+_0x938de7+_0x2a9f5e(0x110)};return{'success':![],'message':_0x2a9f5e(0xe2)+_0x938de7};}async['rescheduleJob'](_0x5d35f8,_0x1cc530){const _0x4a8977=a2_0x505e10;return await this[_0x4a8977(0xf1)](_0x5d35f8),await this[_0x4a8977(0xfa)](_0x1cc530);}[a2_0x505e10(0xdf)](_0x1e9bbf){const _0x2f3b4c=a2_0x505e10;switch(_0x1e9bbf[_0x2f3b4c(0xf0)]){case enums_1[_0x2f3b4c(0xe8)][_0x2f3b4c(0xe4)]:{return(0x0,mappers_1['toPlaySoundCommand'])(_0x1e9bbf);}case enums_1[_0x2f3b4c(0xe8)][_0x2f3b4c(0xd1)]:{return(0x0,mappers_1[_0x2f3b4c(0xc5)])(_0x1e9bbf);}case enums_1[_0x2f3b4c(0xe8)][_0x2f3b4c(0x103)]:{return(0x0,voice_mapper_1[_0x2f3b4c(0xcd)])(_0x1e9bbf);}case enums_1[_0x2f3b4c(0xe8)]['PlayTextToAudio']:{return(0x0,textToAudio_mapper_1[_0x2f3b4c(0xd5)])(_0x1e9bbf);}default:throw new common_1[(_0x2f3b4c(0xfb))]('Job\x20type\x20not\x20found');}}};__decorate([(0x0,event_emitter_1[a2_0x505e10(0x10f)])(events_1['ScheduleChangedEvent'][a2_0x505e10(0xbd)]),(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x505e10(0xc9)][a2_0x505e10(0xce)]),(0x0,event_emitter_1[a2_0x505e10(0x10f)])(events_1['EventChangedEvent'][a2_0x505e10(0xc0)]),(0x0,event_emitter_1[a2_0x505e10(0x10f)])(events_1[a2_0x505e10(0xe0)]['Updated']),(0x0,event_emitter_1[a2_0x505e10(0x10f)])(events_1[a2_0x505e10(0xe0)][a2_0x505e10(0xce)]),__metadata(a2_0x505e10(0xca),Function),__metadata('design:paramtypes',[]),__metadata(a2_0x505e10(0xef),Promise)],AgendaService[a2_0x505e10(0xe9)],a2_0x505e10(0xc6),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(a2_0x505e10(0xee),[nestjs_agenda_1[a2_0x505e10(0xf8)]])],AgendaService),exports['AgendaService']=AgendaService;