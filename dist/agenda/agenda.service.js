'use strict';const a2_0x5f22e1=a2_0x1674;(function(_0x130cc7,_0x3ac494){const _0x554fa7=a2_0x1674,_0x5857f4=_0x130cc7();while(!![]){try{const _0x3ccea2=-parseInt(_0x554fa7(0x14e))/0x1+parseInt(_0x554fa7(0x142))/0x2*(-parseInt(_0x554fa7(0x171))/0x3)+-parseInt(_0x554fa7(0x13a))/0x4+-parseInt(_0x554fa7(0x12d))/0x5*(parseInt(_0x554fa7(0x130))/0x6)+parseInt(_0x554fa7(0x162))/0x7+parseInt(_0x554fa7(0x13e))/0x8*(parseInt(_0x554fa7(0x14c))/0x9)+parseInt(_0x554fa7(0x14b))/0xa;if(_0x3ccea2===_0x3ac494)break;else _0x5857f4['push'](_0x5857f4['shift']());}catch(_0x58779e){_0x5857f4['push'](_0x5857f4['shift']());}}}(a2_0x3cf7,0x2d843));function a2_0x3cf7(){const _0x2d0023=['decorate','attrs','401272fUyKNE','mongodb','./mappers','__esModule','32gZBuTK','when','design:type','cancelJob','2nibMJy','CheckEvent','PlayTextToAudio','ObjectId','logger','now','prototype','design:returntype','defineProperty','3361740gvCEJm','453762jcBpPd','toPlayMusicCommand','191468krMSGD','killProcess','getJobPayload','Updated','function','BackgroundJobType','startDate','ScheduleChangedEvent','Injectable','0\x200\x20*\x20*\x20*','toPlayTextToAudioCommand','isScheduleJobDTO','initialize','PROCESS_CACHE','\x20not\x20found','rescheduleEvents','JobType','__decorate','schedule','@agent-ly/nestjs-agenda','306257eqkkJs','toString','PlayMusic','jobType','AgendaService','every','agendaAgent','design:paramtypes','cancel','values','Created','name','Job\x20','Deleted','Logger','140079YtKweq','PlayVoiceRecorded','metadata','PlaySound','../common/events','Failed\x20to\x20cancel\x20job\x20','./mappers/voice.mapper','OnEvent','./dtos','283415feePMA','scheduleJob','@nestjs/common','6VIHCwJ','PurgeTempUploadedFiles','object','rescheduleJob','log','__metadata','../common/job','length'];a2_0x3cf7=function(){return _0x2d0023;};return a2_0x3cf7();}var __decorate=this&&this[a2_0x5f22e1(0x15f)]||function(_0x5693cd,_0x345786,_0x582fb0,_0x2bc732){const _0x1227f3=a2_0x5f22e1;var _0x33ed94=arguments[_0x1227f3(0x137)],_0x5b0328=_0x33ed94<0x3?_0x345786:_0x2bc732===null?_0x2bc732=Object['getOwnPropertyDescriptor'](_0x345786,_0x582fb0):_0x2bc732,_0x32e411;if(typeof Reflect==='object'&&typeof Reflect[_0x1227f3(0x138)]===_0x1227f3(0x152))_0x5b0328=Reflect[_0x1227f3(0x138)](_0x5693cd,_0x345786,_0x582fb0,_0x2bc732);else{for(var _0x201aeb=_0x5693cd[_0x1227f3(0x137)]-0x1;_0x201aeb>=0x0;_0x201aeb--)if(_0x32e411=_0x5693cd[_0x201aeb])_0x5b0328=(_0x33ed94<0x3?_0x32e411(_0x5b0328):_0x33ed94>0x3?_0x32e411(_0x345786,_0x582fb0,_0x5b0328):_0x32e411(_0x345786,_0x582fb0))||_0x5b0328;}return _0x33ed94>0x3&&_0x5b0328&&Object[_0x1227f3(0x14a)](_0x345786,_0x582fb0,_0x5b0328),_0x5b0328;},__metadata=this&&this[a2_0x5f22e1(0x135)]||function(_0x308cac,_0x598aea){const _0x911042=a2_0x5f22e1;if(typeof Reflect===_0x911042(0x132)&&typeof Reflect['metadata']===_0x911042(0x152))return Reflect[_0x911042(0x173)](_0x308cac,_0x598aea);},AgendaService_1;Object[a2_0x5f22e1(0x14a)](exports,a2_0x5f22e1(0x13d),{'value':!![]}),exports[a2_0x5f22e1(0x166)]=void 0x0;const common_1=require(a2_0x5f22e1(0x12f)),nestjs_agenda_1=require(a2_0x5f22e1(0x161)),event_emitter_1=require('@nestjs/event-emitter'),mongodb_1=require(a2_0x5f22e1(0x13b)),enums_1=require('../common/enums'),events_1=require(a2_0x5f22e1(0x128)),job_1=require(a2_0x5f22e1(0x136)),dtos_1=require(a2_0x5f22e1(0x12c)),mappers_1=require(a2_0x5f22e1(0x13c)),voice_mapper_1=require(a2_0x5f22e1(0x12a)),textToAudio_mapper_1=require('./mappers/textToAudio.mapper');function a2_0x1674(_0x1c74c6,_0xbd3039){const _0x3cf739=a2_0x3cf7();return a2_0x1674=function(_0x167498,_0x4d5d34){_0x167498=_0x167498-0x127;let _0x3b3edb=_0x3cf739[_0x167498];return _0x3b3edb;},a2_0x1674(_0x1c74c6,_0xbd3039);}let AgendaService=AgendaService_1=class AgendaService{constructor(_0x16fc42){const _0xbc71f0=a2_0x5f22e1;this['agendaAgent']=_0x16fc42,this[_0xbc71f0(0x146)]=new common_1[(_0xbc71f0(0x170))](AgendaService_1[_0xbc71f0(0x16d)]),this[_0xbc71f0(0x15a)]();}async[a2_0x5f22e1(0x15a)](){const _0x276579=a2_0x5f22e1;await this[_0x276579(0x168)]['purge'](),this[_0x276579(0x168)][_0x276579(0x167)](_0x276579(0x157),enums_1['BackgroundJobType']['CheckEvent']),this[_0x276579(0x168)][_0x276579(0x167)](_0x276579(0x157),enums_1[_0x276579(0x153)][_0x276579(0x131)]),this[_0x276579(0x168)]['now'](enums_1['BackgroundJobType'][_0x276579(0x143)],null);}async[a2_0x5f22e1(0x15d)](){const _0x41d58c=a2_0x5f22e1;this[_0x41d58c(0x146)][_0x41d58c(0x134)]('Scheduling\x20events...'),await this['agendaAgent'][_0x41d58c(0x16a)]({'name':{'$in':Object[_0x41d58c(0x16b)](enums_1['JobType'])}}),this['agendaAgent'][_0x41d58c(0x147)](enums_1[_0x41d58c(0x153)][_0x41d58c(0x143)],null);}async['getJobs'](){const _0x28af5f=await this['agendaAgent']['jobs']({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x28af5f;}async[a2_0x5f22e1(0x12e)](_0x5b75cc){const _0x1ce060=a2_0x5f22e1,_0x4984fd=this['getJobPayload'](_0x5b75cc),_0x27bc89=(0x0,dtos_1[_0x1ce060(0x159)])(_0x5b75cc),_0x5be772=_0x27bc89?_0x5b75cc[_0x1ce060(0x13f)]:_0x5b75cc[_0x1ce060(0x167)];let _0x456ef7;return _0x27bc89?_0x456ef7=await this['agendaAgent'][_0x1ce060(0x160)](_0x5be772,_0x5b75cc[_0x1ce060(0x165)],_0x4984fd):_0x456ef7=await this[_0x1ce060(0x168)][_0x1ce060(0x167)](_0x5be772,_0x5b75cc[_0x1ce060(0x165)],_0x4984fd,{'startDate':new Date(_0x5b75cc[_0x1ce060(0x154)]),'endDate':new Date(_0x5b75cc['endDate']),'skipImmediate':!![]}),{'jobId':_0x456ef7[_0x1ce060(0x139)]['_id'][_0x1ce060(0x163)]()};}async[a2_0x5f22e1(0x141)](_0xdbb651){const _0x4f90b1=a2_0x5f22e1,_0x40bc24=await this[_0x4f90b1(0x168)]['jobs']({'_id':new mongodb_1['ObjectId'](_0xdbb651)});if(!_0x40bc24[_0x4f90b1(0x137)])return{'success':!![],'message':_0x4f90b1(0x16e)+_0xdbb651+_0x4f90b1(0x15c)};const _0x261d03=await this[_0x4f90b1(0x168)][_0x4f90b1(0x16a)]({'_id':new mongodb_1[(_0x4f90b1(0x145))](_0xdbb651)});job_1[_0x4f90b1(0x15b)][_0x4f90b1(0x14f)](_0xdbb651);if(_0x261d03)return{'success':!![],'message':_0x4f90b1(0x16e)+_0xdbb651+'\x20is\x20cancelled'};return{'success':![],'message':_0x4f90b1(0x129)+_0xdbb651};}async[a2_0x5f22e1(0x133)](_0x354fca,_0xf3d4dc){const _0x48740e=a2_0x5f22e1;return await this[_0x48740e(0x141)](_0x354fca),await this[_0x48740e(0x12e)](_0xf3d4dc);}[a2_0x5f22e1(0x150)](_0x5a957d){const _0x1d0704=a2_0x5f22e1;switch(_0x5a957d['jobType']){case enums_1[_0x1d0704(0x15e)][_0x1d0704(0x127)]:{return(0x0,mappers_1['toPlaySoundCommand'])(_0x5a957d);}case enums_1[_0x1d0704(0x15e)][_0x1d0704(0x164)]:{return(0x0,mappers_1[_0x1d0704(0x14d)])(_0x5a957d);}case enums_1['JobType'][_0x1d0704(0x172)]:{return(0x0,voice_mapper_1['toPlayVoiceCommand'])(_0x5a957d);}case enums_1['JobType'][_0x1d0704(0x144)]:{return(0x0,textToAudio_mapper_1[_0x1d0704(0x158)])(_0x5a957d);}default:throw new common_1['NotFoundException']('Job\x20type\x20not\x20found');}}};__decorate([(0x0,event_emitter_1[a2_0x5f22e1(0x12b)])(events_1[a2_0x5f22e1(0x155)]['Updated']),(0x0,event_emitter_1[a2_0x5f22e1(0x12b)])(events_1[a2_0x5f22e1(0x155)][a2_0x5f22e1(0x16f)]),(0x0,event_emitter_1[a2_0x5f22e1(0x12b)])(events_1['EventChangedEvent'][a2_0x5f22e1(0x16c)]),(0x0,event_emitter_1[a2_0x5f22e1(0x12b)])(events_1['EventChangedEvent'][a2_0x5f22e1(0x151)]),(0x0,event_emitter_1[a2_0x5f22e1(0x12b)])(events_1['EventChangedEvent'][a2_0x5f22e1(0x16f)]),__metadata(a2_0x5f22e1(0x140),Function),__metadata(a2_0x5f22e1(0x169),[]),__metadata(a2_0x5f22e1(0x149),Promise)],AgendaService[a2_0x5f22e1(0x148)],a2_0x5f22e1(0x15d),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x5f22e1(0x156)])(),__metadata('design:paramtypes',[nestjs_agenda_1[a2_0x5f22e1(0x166)]])],AgendaService),exports['AgendaService']=AgendaService;