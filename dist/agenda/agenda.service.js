'use strict';const a2_0x5a26f5=a2_0x2049;function a2_0x2049(_0x5ce6e3,_0x457e8c){const _0x53a235=a2_0x53a2();return a2_0x2049=function(_0x2049bb,_0x1b4485){_0x2049bb=_0x2049bb-0x167;let _0x712a30=_0x53a235[_0x2049bb];return _0x712a30;},a2_0x2049(_0x5ce6e3,_0x457e8c);}(function(_0x534eed,_0x48f221){const _0x15c87b=a2_0x2049,_0x321ab1=_0x534eed();while(!![]){try{const _0xca268f=-parseInt(_0x15c87b(0x17d))/0x1*(-parseInt(_0x15c87b(0x19d))/0x2)+-parseInt(_0x15c87b(0x17c))/0x3+parseInt(_0x15c87b(0x183))/0x4*(parseInt(_0x15c87b(0x1ab))/0x5)+-parseInt(_0x15c87b(0x18f))/0x6+-parseInt(_0x15c87b(0x181))/0x7+parseInt(_0x15c87b(0x1ac))/0x8+parseInt(_0x15c87b(0x18c))/0x9;if(_0xca268f===_0x48f221)break;else _0x321ab1['push'](_0x321ab1['shift']());}catch(_0x4cc226){_0x321ab1['push'](_0x321ab1['shift']());}}}(a2_0x53a2,0x4830a));var __decorate=this&&this['__decorate']||function(_0x255f35,_0x1ba571,_0x62937,_0x425eaf){const _0x41e1b3=a2_0x2049;var _0x17c86f=arguments[_0x41e1b3(0x17a)],_0x2b3655=_0x17c86f<0x3?_0x1ba571:_0x425eaf===null?_0x425eaf=Object[_0x41e1b3(0x190)](_0x1ba571,_0x62937):_0x425eaf,_0x5881db;if(typeof Reflect===_0x41e1b3(0x180)&&typeof Reflect[_0x41e1b3(0x196)]===_0x41e1b3(0x184))_0x2b3655=Reflect[_0x41e1b3(0x196)](_0x255f35,_0x1ba571,_0x62937,_0x425eaf);else{for(var _0x4b201a=_0x255f35[_0x41e1b3(0x17a)]-0x1;_0x4b201a>=0x0;_0x4b201a--)if(_0x5881db=_0x255f35[_0x4b201a])_0x2b3655=(_0x17c86f<0x3?_0x5881db(_0x2b3655):_0x17c86f>0x3?_0x5881db(_0x1ba571,_0x62937,_0x2b3655):_0x5881db(_0x1ba571,_0x62937))||_0x2b3655;}return _0x17c86f>0x3&&_0x2b3655&&Object[_0x41e1b3(0x1a5)](_0x1ba571,_0x62937,_0x2b3655),_0x2b3655;},__metadata=this&&this[a2_0x5a26f5(0x170)]||function(_0x445083,_0x9bd36d){const _0xb98061=a2_0x5a26f5;if(typeof Reflect===_0xb98061(0x180)&&typeof Reflect[_0xb98061(0x18a)]===_0xb98061(0x184))return Reflect[_0xb98061(0x18a)](_0x445083,_0x9bd36d);},AgendaService_1;Object['defineProperty'](exports,a2_0x5a26f5(0x1b0),{'value':!![]}),exports[a2_0x5a26f5(0x186)]=void 0x0;function a2_0x53a2(){const _0xa4f40b=['jobs','./mappers/textToAudio.mapper','toPlayMusicCommand','getJobPayload','Created','\x20is\x20cancelled','Deleted','agendaAgent','NotFoundException','__metadata','endDate','design:paramtypes','startDate','scheduleJob','./mappers','PlayTextToAudio','getJobs','now','every','length','design:returntype','103746VctLuN','673tHBfSB','name','killProcess','object','3216143ySROuc','initialize','12872IzGlwQ','function','purge','AgendaService','BackgroundJobType','JobType','design:type','metadata','./dtos','1950354PbuAzM','\x20not\x20found','Updated','756996MbPoQQ','getOwnPropertyDescriptor','Failed\x20to\x20cancel\x20job\x20','_id','OnEvent','cancel','ObjectId','decorate','Job\x20','0\x200\x20*\x20*\x20*','rescheduleEvents','when','values','EventChangedEvent','74wsCRgL','./mappers/voice.mapper','cancelJob','jobType','@agent-ly/nestjs-agenda','CheckEvent','PlayVoiceRecorded','toPlayTextToAudioCommand','defineProperty','logger','Job\x20type\x20not\x20found','Logger','Injectable','PROCESS_CACHE','545JxxjEY','2588144aueDzI','PlaySound','toPlaySoundCommand','attrs','__esModule','../common/events'];a2_0x53a2=function(){return _0xa4f40b;};return a2_0x53a2();}const common_1=require('@nestjs/common'),nestjs_agenda_1=require(a2_0x5a26f5(0x1a1)),event_emitter_1=require('@nestjs/event-emitter'),mongodb_1=require('mongodb'),enums_1=require('../common/enums'),events_1=require(a2_0x5a26f5(0x1b1)),job_1=require('../common/job'),dtos_1=require(a2_0x5a26f5(0x18b)),mappers_1=require(a2_0x5a26f5(0x175)),voice_mapper_1=require(a2_0x5a26f5(0x19e)),textToAudio_mapper_1=require(a2_0x5a26f5(0x168));let AgendaService=AgendaService_1=class AgendaService{constructor(_0x5b0439){const _0x479ea5=a2_0x5a26f5;this[_0x479ea5(0x16e)]=_0x5b0439,this[_0x479ea5(0x1a6)]=new common_1[(_0x479ea5(0x1a8))](AgendaService_1[_0x479ea5(0x17e)]),this['initialize']();}async[a2_0x5a26f5(0x182)](){const _0x54c215=a2_0x5a26f5;await this[_0x54c215(0x16e)][_0x54c215(0x185)](),this[_0x54c215(0x16e)][_0x54c215(0x179)](_0x54c215(0x198),enums_1[_0x54c215(0x187)][_0x54c215(0x1a2)]),this['agendaAgent'][_0x54c215(0x179)](_0x54c215(0x198),enums_1[_0x54c215(0x187)]['PurgeTempUploadedFiles']),this[_0x54c215(0x16e)][_0x54c215(0x178)](enums_1[_0x54c215(0x187)][_0x54c215(0x1a2)],null);}async['rescheduleEvents'](){const _0x4b46b7=a2_0x5a26f5;this[_0x4b46b7(0x1a6)]['log']('Scheduling\x20events...'),await this[_0x4b46b7(0x16e)][_0x4b46b7(0x194)]({'name':{'$in':Object[_0x4b46b7(0x19b)](enums_1[_0x4b46b7(0x188)])}}),this[_0x4b46b7(0x16e)]['now'](enums_1[_0x4b46b7(0x187)][_0x4b46b7(0x1a2)],null);}async[a2_0x5a26f5(0x177)](){const _0x444856=a2_0x5a26f5,_0x28a262=await this[_0x444856(0x16e)]['jobs']({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x28a262;}async[a2_0x5a26f5(0x174)](_0x1ec67c){const _0x212e8e=a2_0x5a26f5,_0x14854a=this[_0x212e8e(0x16a)](_0x1ec67c),_0x132180=(0x0,dtos_1['isScheduleJobDTO'])(_0x1ec67c),_0x3e020d=_0x132180?_0x1ec67c[_0x212e8e(0x19a)]:_0x1ec67c[_0x212e8e(0x179)];let _0x3459aa;return _0x132180?_0x3459aa=await this[_0x212e8e(0x16e)]['schedule'](_0x3e020d,_0x1ec67c[_0x212e8e(0x1a0)],_0x14854a):_0x3459aa=await this['agendaAgent'][_0x212e8e(0x179)](_0x3e020d,_0x1ec67c['jobType'],_0x14854a,{'startDate':new Date(_0x1ec67c[_0x212e8e(0x173)]),'endDate':new Date(_0x1ec67c[_0x212e8e(0x171)]),'skipImmediate':!![]}),{'jobId':_0x3459aa[_0x212e8e(0x1af)][_0x212e8e(0x192)]['toString']()};}async[a2_0x5a26f5(0x19f)](_0x3418cc){const _0x1f3ab=a2_0x5a26f5,_0x475ab8=await this['agendaAgent'][_0x1f3ab(0x167)]({'_id':new mongodb_1[(_0x1f3ab(0x195))](_0x3418cc)});if(!_0x475ab8[_0x1f3ab(0x17a)])return{'success':!![],'message':_0x1f3ab(0x197)+_0x3418cc+_0x1f3ab(0x18d)};const _0x342e6d=await this['agendaAgent']['cancel']({'_id':new mongodb_1[(_0x1f3ab(0x195))](_0x3418cc)});job_1[_0x1f3ab(0x1aa)][_0x1f3ab(0x17f)](_0x3418cc);if(_0x342e6d)return{'success':!![],'message':'Job\x20'+_0x3418cc+_0x1f3ab(0x16c)};return{'success':![],'message':_0x1f3ab(0x191)+_0x3418cc};}async['rescheduleJob'](_0xa13eb7,_0x519dd2){const _0x14c912=a2_0x5a26f5;return await this['cancelJob'](_0xa13eb7),await this[_0x14c912(0x174)](_0x519dd2);}['getJobPayload'](_0x142ca4){const _0x8e1ff3=a2_0x5a26f5;switch(_0x142ca4[_0x8e1ff3(0x1a0)]){case enums_1[_0x8e1ff3(0x188)][_0x8e1ff3(0x1ad)]:{return(0x0,mappers_1[_0x8e1ff3(0x1ae)])(_0x142ca4);}case enums_1[_0x8e1ff3(0x188)]['PlayMusic']:{return(0x0,mappers_1[_0x8e1ff3(0x169)])(_0x142ca4);}case enums_1[_0x8e1ff3(0x188)][_0x8e1ff3(0x1a3)]:{return(0x0,voice_mapper_1['toPlayVoiceCommand'])(_0x142ca4);}case enums_1[_0x8e1ff3(0x188)][_0x8e1ff3(0x176)]:{return(0x0,textToAudio_mapper_1[_0x8e1ff3(0x1a4)])(_0x142ca4);}default:throw new common_1[(_0x8e1ff3(0x16f))](_0x8e1ff3(0x1a7));}}};__decorate([(0x0,event_emitter_1[a2_0x5a26f5(0x193)])(events_1['ScheduleChangedEvent'][a2_0x5a26f5(0x18e)]),(0x0,event_emitter_1['OnEvent'])(events_1['ScheduleChangedEvent'][a2_0x5a26f5(0x16d)]),(0x0,event_emitter_1[a2_0x5a26f5(0x193)])(events_1[a2_0x5a26f5(0x19c)][a2_0x5a26f5(0x16b)]),(0x0,event_emitter_1[a2_0x5a26f5(0x193)])(events_1[a2_0x5a26f5(0x19c)]['Updated']),(0x0,event_emitter_1[a2_0x5a26f5(0x193)])(events_1[a2_0x5a26f5(0x19c)][a2_0x5a26f5(0x16d)]),__metadata(a2_0x5a26f5(0x189),Function),__metadata('design:paramtypes',[]),__metadata(a2_0x5a26f5(0x17b),Promise)],AgendaService['prototype'],a2_0x5a26f5(0x199),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x5a26f5(0x1a9)])(),__metadata(a2_0x5a26f5(0x172),[nestjs_agenda_1[a2_0x5a26f5(0x186)]])],AgendaService),exports[a2_0x5a26f5(0x186)]=AgendaService;