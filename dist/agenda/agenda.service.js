'use strict';const a2_0xc804c4=a2_0x3aed;(function(_0x420163,_0x1bd74b){const _0x22229c=a2_0x3aed,_0x12dd17=_0x420163();while(!![]){try{const _0x4c56f7=-parseInt(_0x22229c(0x129))/0x1*(parseInt(_0x22229c(0x12c))/0x2)+parseInt(_0x22229c(0x11f))/0x3+-parseInt(_0x22229c(0x137))/0x4*(-parseInt(_0x22229c(0x144))/0x5)+parseInt(_0x22229c(0x138))/0x6*(-parseInt(_0x22229c(0x128))/0x7)+-parseInt(_0x22229c(0x153))/0x8+-parseInt(_0x22229c(0x134))/0x9*(parseInt(_0x22229c(0x15e))/0xa)+-parseInt(_0x22229c(0x133))/0xb*(-parseInt(_0x22229c(0x152))/0xc);if(_0x4c56f7===_0x1bd74b)break;else _0x12dd17['push'](_0x12dd17['shift']());}catch(_0x551909){_0x12dd17['push'](_0x12dd17['shift']());}}}(a2_0x417c,0x37e44));var __decorate=this&&this[a2_0xc804c4(0x165)]||function(_0x243070,_0xc2ab8a,_0x4b2347,_0x2a3bf1){const _0x36387c=a2_0xc804c4;var _0x20fe14=arguments['length'],_0x236bf6=_0x20fe14<0x3?_0xc2ab8a:_0x2a3bf1===null?_0x2a3bf1=Object['getOwnPropertyDescriptor'](_0xc2ab8a,_0x4b2347):_0x2a3bf1,_0x3b27ca;if(typeof Reflect==='object'&&typeof Reflect[_0x36387c(0x11e)]==='function')_0x236bf6=Reflect[_0x36387c(0x11e)](_0x243070,_0xc2ab8a,_0x4b2347,_0x2a3bf1);else{for(var _0x400388=_0x243070[_0x36387c(0x124)]-0x1;_0x400388>=0x0;_0x400388--)if(_0x3b27ca=_0x243070[_0x400388])_0x236bf6=(_0x20fe14<0x3?_0x3b27ca(_0x236bf6):_0x20fe14>0x3?_0x3b27ca(_0xc2ab8a,_0x4b2347,_0x236bf6):_0x3b27ca(_0xc2ab8a,_0x4b2347))||_0x236bf6;}return _0x20fe14>0x3&&_0x236bf6&&Object[_0x36387c(0x151)](_0xc2ab8a,_0x4b2347,_0x236bf6),_0x236bf6;},__metadata=this&&this[a2_0xc804c4(0x158)]||function(_0x3b6522,_0x3b44fa){const _0x139821=a2_0xc804c4;if(typeof Reflect===_0x139821(0x147)&&typeof Reflect[_0x139821(0x162)]===_0x139821(0x119))return Reflect[_0x139821(0x162)](_0x3b6522,_0x3b44fa);},AgendaService_1;function a2_0x417c(){const _0x321d70=['CheckEvent','design:type','function','EventChangedEvent','./mappers','attrs','@nestjs/common','decorate','864345nPKUlq','PlaySound','ObjectId','JobType','0\x200\x20*\x20*\x20*','length','Scheduling\x20events...','toPlayTextToAudioCommand','prototype','684992YQWNjR','9mHhavr','now','\x20is\x20cancelled','59876xZnYKw','Failed\x20to\x20cancel\x20job\x20','logger','Job\x20','Deleted','../common/enums','AgendaService','208307HZpRAT','45GBsenc','cancelJob','_id','4OBVmFw','24JJGpdt','BackgroundJobType','when','PlayTextToAudio','./mappers/voice.mapper','initialize','PROCESS_CACHE','killProcess','PlayMusic','Logger','log','mongodb','2239185QdLZJD','__esModule','\x20not\x20found','object','OnEvent','../common/events','agendaAgent','@agent-ly/nestjs-agenda','rescheduleEvents','./dtos','name','schedule','scheduleJob','defineProperty','456NJHWEf','3352080XGgJSu','cancel','getJobPayload','isScheduleJobDTO','PurgeTempUploadedFiles','__metadata','Job\x20type\x20not\x20found','every','design:paramtypes','toPlayVoiceCommand','endDate','293500IoXrvk','Created','design:returntype','toPlayMusicCommand','metadata','Updated','rescheduleJob','__decorate','./mappers/textToAudio.mapper','ScheduleChangedEvent','values','PlayVoiceRecorded','@nestjs/event-emitter','jobType'];a2_0x417c=function(){return _0x321d70;};return a2_0x417c();}Object['defineProperty'](exports,a2_0xc804c4(0x145),{'value':!![]}),exports[a2_0xc804c4(0x132)]=void 0x0;function a2_0x3aed(_0x2558e7,_0x1a046b){const _0x417c00=a2_0x417c();return a2_0x3aed=function(_0x3aed03,_0x3c5e51){_0x3aed03=_0x3aed03-0x112;let _0x1ece4b=_0x417c00[_0x3aed03];return _0x1ece4b;},a2_0x3aed(_0x2558e7,_0x1a046b);}const common_1=require(a2_0xc804c4(0x11d)),nestjs_agenda_1=require(a2_0xc804c4(0x14b)),event_emitter_1=require(a2_0xc804c4(0x115)),mongodb_1=require(a2_0xc804c4(0x143)),enums_1=require(a2_0xc804c4(0x131)),events_1=require(a2_0xc804c4(0x149)),job_1=require('../common/job'),dtos_1=require(a2_0xc804c4(0x14d)),mappers_1=require(a2_0xc804c4(0x11b)),voice_mapper_1=require(a2_0xc804c4(0x13c)),textToAudio_mapper_1=require(a2_0xc804c4(0x166));let AgendaService=AgendaService_1=class AgendaService{constructor(_0x346cb7){const _0x5148e0=a2_0xc804c4;this[_0x5148e0(0x14a)]=_0x346cb7,this[_0x5148e0(0x12e)]=new common_1[(_0x5148e0(0x141))](AgendaService_1[_0x5148e0(0x14e)]),this[_0x5148e0(0x13d)]();}async[a2_0xc804c4(0x13d)](){const _0x26b23c=a2_0xc804c4;await this[_0x26b23c(0x14a)]['purge'](),this['agendaAgent'][_0x26b23c(0x15a)](_0x26b23c(0x123),enums_1[_0x26b23c(0x139)][_0x26b23c(0x117)]),this['agendaAgent'][_0x26b23c(0x15a)](_0x26b23c(0x123),enums_1[_0x26b23c(0x139)][_0x26b23c(0x157)]),this['agendaAgent'][_0x26b23c(0x12a)](enums_1[_0x26b23c(0x139)][_0x26b23c(0x117)],null);}async[a2_0xc804c4(0x14c)](){const _0x462389=a2_0xc804c4;this[_0x462389(0x12e)][_0x462389(0x142)](_0x462389(0x125)),await this[_0x462389(0x14a)]['cancel']({'name':{'$in':Object[_0x462389(0x113)](enums_1[_0x462389(0x122)])}}),this[_0x462389(0x14a)][_0x462389(0x12a)](enums_1[_0x462389(0x139)][_0x462389(0x117)],null);}async['getJobs'](){const _0x13f799=a2_0xc804c4,_0xf340b3=await this[_0x13f799(0x14a)]['jobs']({'nextRunAt':{'$exists':!![],'$ne':null}});return _0xf340b3;}async[a2_0xc804c4(0x150)](_0x2fa3d9){const _0x8d8ba=a2_0xc804c4,_0xaa09fd=this[_0x8d8ba(0x155)](_0x2fa3d9),_0x45186d=(0x0,dtos_1[_0x8d8ba(0x156)])(_0x2fa3d9),_0xd6a34b=_0x45186d?_0x2fa3d9[_0x8d8ba(0x13a)]:_0x2fa3d9[_0x8d8ba(0x15a)];let _0x79ccd2;return _0x45186d?_0x79ccd2=await this['agendaAgent'][_0x8d8ba(0x14f)](_0xd6a34b,_0x2fa3d9[_0x8d8ba(0x116)],_0xaa09fd):_0x79ccd2=await this[_0x8d8ba(0x14a)][_0x8d8ba(0x15a)](_0xd6a34b,_0x2fa3d9[_0x8d8ba(0x116)],_0xaa09fd,{'startDate':new Date(_0x2fa3d9['startDate']),'endDate':new Date(_0x2fa3d9[_0x8d8ba(0x15d)]),'skipImmediate':!![]}),{'jobId':_0x79ccd2[_0x8d8ba(0x11c)][_0x8d8ba(0x136)]['toString']()};}async['cancelJob'](_0xea824){const _0x45f3ee=a2_0xc804c4,_0x7b03d4=await this[_0x45f3ee(0x14a)]['jobs']({'_id':new mongodb_1[(_0x45f3ee(0x121))](_0xea824)});if(!_0x7b03d4[_0x45f3ee(0x124)])return{'success':!![],'message':_0x45f3ee(0x12f)+_0xea824+_0x45f3ee(0x146)};const _0x32e9bc=await this[_0x45f3ee(0x14a)][_0x45f3ee(0x154)]({'_id':new mongodb_1['ObjectId'](_0xea824)});job_1[_0x45f3ee(0x13e)][_0x45f3ee(0x13f)](_0xea824);if(_0x32e9bc)return{'success':!![],'message':_0x45f3ee(0x12f)+_0xea824+_0x45f3ee(0x12b)};return{'success':![],'message':_0x45f3ee(0x12d)+_0xea824};}async[a2_0xc804c4(0x164)](_0x72f9fd,_0x149b10){const _0x1e0754=a2_0xc804c4;return await this[_0x1e0754(0x135)](_0x72f9fd),await this[_0x1e0754(0x150)](_0x149b10);}['getJobPayload'](_0x433311){const _0x2e9bd5=a2_0xc804c4;switch(_0x433311[_0x2e9bd5(0x116)]){case enums_1['JobType'][_0x2e9bd5(0x120)]:{return(0x0,mappers_1['toPlaySoundCommand'])(_0x433311);}case enums_1[_0x2e9bd5(0x122)][_0x2e9bd5(0x140)]:{return(0x0,mappers_1[_0x2e9bd5(0x161)])(_0x433311);}case enums_1[_0x2e9bd5(0x122)][_0x2e9bd5(0x114)]:{return(0x0,voice_mapper_1[_0x2e9bd5(0x15c)])(_0x433311);}case enums_1[_0x2e9bd5(0x122)][_0x2e9bd5(0x13b)]:{return(0x0,textToAudio_mapper_1[_0x2e9bd5(0x126)])(_0x433311);}default:throw new common_1['NotFoundException'](_0x2e9bd5(0x159));}}};__decorate([(0x0,event_emitter_1['OnEvent'])(events_1[a2_0xc804c4(0x112)][a2_0xc804c4(0x163)]),(0x0,event_emitter_1[a2_0xc804c4(0x148)])(events_1['ScheduleChangedEvent']['Deleted']),(0x0,event_emitter_1['OnEvent'])(events_1[a2_0xc804c4(0x11a)][a2_0xc804c4(0x15f)]),(0x0,event_emitter_1['OnEvent'])(events_1[a2_0xc804c4(0x11a)][a2_0xc804c4(0x163)]),(0x0,event_emitter_1[a2_0xc804c4(0x148)])(events_1[a2_0xc804c4(0x11a)][a2_0xc804c4(0x130)]),__metadata(a2_0xc804c4(0x118),Function),__metadata(a2_0xc804c4(0x15b),[]),__metadata(a2_0xc804c4(0x160),Promise)],AgendaService[a2_0xc804c4(0x127)],a2_0xc804c4(0x14c),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(a2_0xc804c4(0x15b),[nestjs_agenda_1['AgendaService']])],AgendaService),exports[a2_0xc804c4(0x132)]=AgendaService;