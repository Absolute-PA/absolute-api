'use strict';const a2_0x276ece=a2_0x2d5f;function a2_0x2d5f(_0x541deb,_0x31cee3){const _0x8b075c=a2_0x8b07();return a2_0x2d5f=function(_0x2d5f89,_0x4a718f){_0x2d5f89=_0x2d5f89-0xe3;let _0x140734=_0x8b075c[_0x2d5f89];return _0x140734;},a2_0x2d5f(_0x541deb,_0x31cee3);}(function(_0x3fbafd,_0x5ef13e){const _0x3a8595=a2_0x2d5f,_0x521b53=_0x3fbafd();while(!![]){try{const _0x30a4a0=parseInt(_0x3a8595(0xe3))/0x1+-parseInt(_0x3a8595(0x121))/0x2+-parseInt(_0x3a8595(0xef))/0x3*(parseInt(_0x3a8595(0x11b))/0x4)+-parseInt(_0x3a8595(0x123))/0x5*(parseInt(_0x3a8595(0x10f))/0x6)+-parseInt(_0x3a8595(0x11c))/0x7*(parseInt(_0x3a8595(0x127))/0x8)+-parseInt(_0x3a8595(0xf5))/0x9*(parseInt(_0x3a8595(0xf4))/0xa)+-parseInt(_0x3a8595(0xe6))/0xb*(-parseInt(_0x3a8595(0x102))/0xc);if(_0x30a4a0===_0x5ef13e)break;else _0x521b53['push'](_0x521b53['shift']());}catch(_0x1ea897){_0x521b53['push'](_0x521b53['shift']());}}}(a2_0x8b07,0x1d0f4));var __decorate=this&&this[a2_0x276ece(0xf2)]||function(_0x12593e,_0x5e7b50,_0x439a2c,_0x2e1366){const _0x1d3bb6=a2_0x276ece;var _0x4925af=arguments[_0x1d3bb6(0x11e)],_0x4a3095=_0x4925af<0x3?_0x5e7b50:_0x2e1366===null?_0x2e1366=Object[_0x1d3bb6(0xfb)](_0x5e7b50,_0x439a2c):_0x2e1366,_0x336366;if(typeof Reflect===_0x1d3bb6(0x107)&&typeof Reflect[_0x1d3bb6(0xf9)]==='function')_0x4a3095=Reflect[_0x1d3bb6(0xf9)](_0x12593e,_0x5e7b50,_0x439a2c,_0x2e1366);else{for(var _0x14a6c8=_0x12593e['length']-0x1;_0x14a6c8>=0x0;_0x14a6c8--)if(_0x336366=_0x12593e[_0x14a6c8])_0x4a3095=(_0x4925af<0x3?_0x336366(_0x4a3095):_0x4925af>0x3?_0x336366(_0x5e7b50,_0x439a2c,_0x4a3095):_0x336366(_0x5e7b50,_0x439a2c))||_0x4a3095;}return _0x4925af>0x3&&_0x4a3095&&Object[_0x1d3bb6(0xf6)](_0x5e7b50,_0x439a2c,_0x4a3095),_0x4a3095;},__metadata=this&&this['__metadata']||function(_0x37782a,_0x23e74a){const _0x1a39f4=a2_0x276ece;if(typeof Reflect===_0x1a39f4(0x107)&&typeof Reflect['metadata']==='function')return Reflect[_0x1a39f4(0x139)](_0x37782a,_0x23e74a);},AgendaService_1;function a2_0x8b07(){const _0x24c166=['472rqDIrY','log','isScheduleJobDTO','logger','toPlaySoundCommand','ObjectId','./mappers','every','design:returntype','@nestjs/common','when','@agent-ly/nestjs-agenda','initialize','Scheduling\x20events...','PlaySound','cancelJob','toPlayMusicCommand','prototype','metadata','221006vAnXxC','toString','Failed\x20to\x20cancel\x20job\x20','38929RimDQi','../common/events','PlayVoiceRecorded','./mappers/textToAudio.mapper','__esModule','BackgroundJobType','Created','PlayMusic','purge','3pbSXsx','values','Logger','__decorate','Job\x20','5290VmuJJT','1692iZqtOX','defineProperty','0\x200\x20*\x20*\x20*','EventChangedEvent','decorate','name','getOwnPropertyDescriptor','Deleted','startDate','rescheduleJob','AgendaService','killProcess','getJobs','1452GVKoHm','\x20is\x20cancelled','NotFoundException','ScheduleChangedEvent','../common/job','object','./dtos','Injectable','mongodb','JobType','jobs','./mappers/voice.mapper','agendaAgent','1368LVSaNr','Updated','PROCESS_CACHE','Job\x20type\x20not\x20found','cancel','toPlayVoiceCommand','schedule','@nestjs/event-emitter','getJobPayload','scheduleJob','../common/enums','_id','773844dCoEsH','7833kqdArU','rescheduleEvents','length','PurgeTempUploadedFiles','OnEvent','12838ixbaGU','CheckEvent','3615ehELQu','design:paramtypes','endDate','attrs'];a2_0x8b07=function(){return _0x24c166;};return a2_0x8b07();}Object[a2_0x276ece(0xf6)](exports,a2_0x276ece(0xea),{'value':!![]}),exports['AgendaService']=void 0x0;const common_1=require(a2_0x276ece(0x130)),nestjs_agenda_1=require(a2_0x276ece(0x132)),event_emitter_1=require(a2_0x276ece(0x116)),mongodb_1=require(a2_0x276ece(0x10a)),enums_1=require(a2_0x276ece(0x119)),events_1=require(a2_0x276ece(0xe7)),job_1=require(a2_0x276ece(0x106)),dtos_1=require(a2_0x276ece(0x108)),mappers_1=require(a2_0x276ece(0x12d)),voice_mapper_1=require(a2_0x276ece(0x10d)),textToAudio_mapper_1=require(a2_0x276ece(0xe9));let AgendaService=AgendaService_1=class AgendaService{constructor(_0x5118a7){const _0x4e3e72=a2_0x276ece;this[_0x4e3e72(0x10e)]=_0x5118a7,this[_0x4e3e72(0x12a)]=new common_1[(_0x4e3e72(0xf1))](AgendaService_1[_0x4e3e72(0xfa)]),this[_0x4e3e72(0x133)]();}async['initialize'](){const _0x549a63=a2_0x276ece;await this[_0x549a63(0x10e)][_0x549a63(0xee)](),this[_0x549a63(0x10e)]['every'](_0x549a63(0xf7),enums_1[_0x549a63(0xeb)][_0x549a63(0x122)]),this[_0x549a63(0x10e)][_0x549a63(0x12e)](_0x549a63(0xf7),enums_1[_0x549a63(0xeb)][_0x549a63(0x11f)]),this['agendaAgent']['now'](enums_1['BackgroundJobType'][_0x549a63(0x122)],null);}async['rescheduleEvents'](){const _0x26e832=a2_0x276ece;this[_0x26e832(0x12a)][_0x26e832(0x128)](_0x26e832(0x134)),await this['agendaAgent'][_0x26e832(0x113)]({'name':{'$in':Object[_0x26e832(0xf0)](enums_1['JobType'])}}),this[_0x26e832(0x10e)]['now'](enums_1['BackgroundJobType']['CheckEvent'],null);}async[a2_0x276ece(0x101)](){const _0x4d79d1=a2_0x276ece,_0x3cdc55=await this[_0x4d79d1(0x10e)][_0x4d79d1(0x10c)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x3cdc55;}async[a2_0x276ece(0x118)](_0x18d3a1){const _0x36f0a6=a2_0x276ece,_0x436812=this['getJobPayload'](_0x18d3a1),_0x35eae2=(0x0,dtos_1[_0x36f0a6(0x129)])(_0x18d3a1),_0x18f8ce=_0x35eae2?_0x18d3a1[_0x36f0a6(0x131)]:_0x18d3a1[_0x36f0a6(0x12e)];let _0x292cdd;return _0x35eae2?_0x292cdd=await this[_0x36f0a6(0x10e)][_0x36f0a6(0x115)](_0x18f8ce,_0x18d3a1['jobType'],_0x436812):_0x292cdd=await this[_0x36f0a6(0x10e)]['every'](_0x18f8ce,_0x18d3a1['jobType'],_0x436812,{'startDate':new Date(_0x18d3a1[_0x36f0a6(0xfd)]),'endDate':new Date(_0x18d3a1[_0x36f0a6(0x125)]),'skipImmediate':!![]}),{'jobId':_0x292cdd[_0x36f0a6(0x126)][_0x36f0a6(0x11a)][_0x36f0a6(0xe4)]()};}async[a2_0x276ece(0x136)](_0x1c05ec){const _0x3bb58a=a2_0x276ece,_0x430281=await this['agendaAgent']['jobs']({'_id':new mongodb_1[(_0x3bb58a(0x12c))](_0x1c05ec)});if(!_0x430281[_0x3bb58a(0x11e)])return{'success':!![],'message':_0x3bb58a(0xf3)+_0x1c05ec+'\x20not\x20found'};const _0x1e0ed1=await this[_0x3bb58a(0x10e)]['cancel']({'_id':new mongodb_1[(_0x3bb58a(0x12c))](_0x1c05ec)});job_1[_0x3bb58a(0x111)][_0x3bb58a(0x100)](_0x1c05ec);if(_0x1e0ed1)return{'success':!![],'message':_0x3bb58a(0xf3)+_0x1c05ec+_0x3bb58a(0x103)};return{'success':![],'message':_0x3bb58a(0xe5)+_0x1c05ec};}async[a2_0x276ece(0xfe)](_0x247f6e,_0x20566e){const _0x674d29=a2_0x276ece;return await this[_0x674d29(0x136)](_0x247f6e),await this[_0x674d29(0x118)](_0x20566e);}[a2_0x276ece(0x117)](_0x488c8e){const _0x4b4469=a2_0x276ece;switch(_0x488c8e['jobType']){case enums_1[_0x4b4469(0x10b)][_0x4b4469(0x135)]:{return(0x0,mappers_1[_0x4b4469(0x12b)])(_0x488c8e);}case enums_1[_0x4b4469(0x10b)][_0x4b4469(0xed)]:{return(0x0,mappers_1[_0x4b4469(0x137)])(_0x488c8e);}case enums_1[_0x4b4469(0x10b)][_0x4b4469(0xe8)]:{return(0x0,voice_mapper_1[_0x4b4469(0x114)])(_0x488c8e);}case enums_1[_0x4b4469(0x10b)]['PlayTextToAudio']:{return(0x0,textToAudio_mapper_1['toPlayTextToAudioCommand'])(_0x488c8e);}default:throw new common_1[(_0x4b4469(0x104))](_0x4b4469(0x112));}}};__decorate([(0x0,event_emitter_1[a2_0x276ece(0x120)])(events_1['ScheduleChangedEvent'][a2_0x276ece(0x110)]),(0x0,event_emitter_1[a2_0x276ece(0x120)])(events_1[a2_0x276ece(0x105)]['Deleted']),(0x0,event_emitter_1[a2_0x276ece(0x120)])(events_1[a2_0x276ece(0xf8)][a2_0x276ece(0xec)]),(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x276ece(0xf8)][a2_0x276ece(0x110)]),(0x0,event_emitter_1[a2_0x276ece(0x120)])(events_1['EventChangedEvent'][a2_0x276ece(0xfc)]),__metadata('design:type',Function),__metadata('design:paramtypes',[]),__metadata(a2_0x276ece(0x12f),Promise)],AgendaService[a2_0x276ece(0x138)],a2_0x276ece(0x11d),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x276ece(0x109)])(),__metadata(a2_0x276ece(0x124),[nestjs_agenda_1[a2_0x276ece(0xff)]])],AgendaService),exports[a2_0x276ece(0xff)]=AgendaService;