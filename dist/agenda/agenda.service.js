'use strict';const a2_0x46aa50=a2_0x2c4e;(function(_0x3b2819,_0x166843){const _0x135533=a2_0x2c4e,_0xa1999d=_0x3b2819();while(!![]){try{const _0x30f7d3=parseInt(_0x135533(0x1de))/0x1+-parseInt(_0x135533(0x200))/0x2*(-parseInt(_0x135533(0x20b))/0x3)+-parseInt(_0x135533(0x1cc))/0x4*(-parseInt(_0x135533(0x203))/0x5)+parseInt(_0x135533(0x1ee))/0x6+-parseInt(_0x135533(0x1f6))/0x7*(-parseInt(_0x135533(0x209))/0x8)+-parseInt(_0x135533(0x1e7))/0x9+-parseInt(_0x135533(0x1d0))/0xa;if(_0x30f7d3===_0x166843)break;else _0xa1999d['push'](_0xa1999d['shift']());}catch(_0x4a8581){_0xa1999d['push'](_0xa1999d['shift']());}}}(a2_0x12b6,0x337ca));var __decorate=this&&this[a2_0x46aa50(0x1c7)]||function(_0x3bb2d9,_0x2f4105,_0x2df8d9,_0x451f6b){const _0x42454b=a2_0x46aa50;var _0x56b35b=arguments[_0x42454b(0x1cd)],_0x3797e2=_0x56b35b<0x3?_0x2f4105:_0x451f6b===null?_0x451f6b=Object[_0x42454b(0x1e1)](_0x2f4105,_0x2df8d9):_0x451f6b,_0x4a4013;if(typeof Reflect===_0x42454b(0x204)&&typeof Reflect[_0x42454b(0x1c8)]===_0x42454b(0x1ed))_0x3797e2=Reflect[_0x42454b(0x1c8)](_0x3bb2d9,_0x2f4105,_0x2df8d9,_0x451f6b);else{for(var _0x13b993=_0x3bb2d9[_0x42454b(0x1cd)]-0x1;_0x13b993>=0x0;_0x13b993--)if(_0x4a4013=_0x3bb2d9[_0x13b993])_0x3797e2=(_0x56b35b<0x3?_0x4a4013(_0x3797e2):_0x56b35b>0x3?_0x4a4013(_0x2f4105,_0x2df8d9,_0x3797e2):_0x4a4013(_0x2f4105,_0x2df8d9))||_0x3797e2;}return _0x56b35b>0x3&&_0x3797e2&&Object[_0x42454b(0x202)](_0x2f4105,_0x2df8d9,_0x3797e2),_0x3797e2;},__metadata=this&&this[a2_0x46aa50(0x1fe)]||function(_0x4f4de0,_0x2a47b6){const _0x326d74=a2_0x46aa50;if(typeof Reflect===_0x326d74(0x204)&&typeof Reflect[_0x326d74(0x1dc)]===_0x326d74(0x1ed))return Reflect[_0x326d74(0x1dc)](_0x4f4de0,_0x2a47b6);},AgendaService_1;Object[a2_0x46aa50(0x202)](exports,a2_0x46aa50(0x206),{'value':!![]}),exports['AgendaService']=void 0x0;function a2_0x12b6(){const _0x9332e3=['ScheduleChangedEvent','log','jobType','when','rescheduleJob','schedule','__decorate','decorate','rescheduleEvents','getJobs','now','25580zvUkEN','length','cancelJob','toPlayVoiceCommand','3650210MvySrj','endDate','CheckEvent','AgendaService','PlayVoiceRecorded','Job\x20','agendaAgent','getJobPayload','Job\x20type\x20not\x20found','design:paramtypes','./mappers/voice.mapper','./mappers','metadata','toPlayTextToAudioCommand','53259TyqxED','mongodb','@nestjs/event-emitter','getOwnPropertyDescriptor','logger','../common/events','initialize','Failed\x20to\x20cancel\x20job\x20','BackgroundJobType','898614uCXpil','ObjectId','Deleted','EventChangedEvent','0\x200\x20*\x20*\x20*','OnEvent','function','2266206uDEFEI','every','./dtos','toString','Injectable','cancel','PROCESS_CACHE','design:returntype','63BCuFqS','JobType','name','@agent-ly/nestjs-agenda','Updated','PlayMusic','purge','scheduleJob','__metadata','values','8SNXcMZ','Logger','defineProperty','10gWtLek','object','../common/job','__esModule','PlayTextToAudio','./mappers/textToAudio.mapper','60248bjIKXF','isScheduleJobDTO','123171IwoahQ'];a2_0x12b6=function(){return _0x9332e3;};return a2_0x12b6();}function a2_0x2c4e(_0x32a1ea,_0x463610){const _0x12b655=a2_0x12b6();return a2_0x2c4e=function(_0x2c4e58,_0x5d77fd){_0x2c4e58=_0x2c4e58-0x1c6;let _0x17dd76=_0x12b655[_0x2c4e58];return _0x17dd76;},a2_0x2c4e(_0x32a1ea,_0x463610);}const common_1=require('@nestjs/common'),nestjs_agenda_1=require(a2_0x46aa50(0x1f9)),event_emitter_1=require(a2_0x46aa50(0x1e0)),mongodb_1=require(a2_0x46aa50(0x1df)),enums_1=require('../common/enums'),events_1=require(a2_0x46aa50(0x1e3)),job_1=require(a2_0x46aa50(0x205)),dtos_1=require(a2_0x46aa50(0x1f0)),mappers_1=require(a2_0x46aa50(0x1db)),voice_mapper_1=require(a2_0x46aa50(0x1da)),textToAudio_mapper_1=require(a2_0x46aa50(0x208));let AgendaService=AgendaService_1=class AgendaService{constructor(_0x1909e4){const _0x561060=a2_0x46aa50;this['agendaAgent']=_0x1909e4,this[_0x561060(0x1e2)]=new common_1[(_0x561060(0x201))](AgendaService_1[_0x561060(0x1f8)]),this[_0x561060(0x1e4)]();}async[a2_0x46aa50(0x1e4)](){const _0x133be6=a2_0x46aa50;await this[_0x133be6(0x1d6)][_0x133be6(0x1fc)](),this[_0x133be6(0x1d6)]['every'](_0x133be6(0x1eb),enums_1[_0x133be6(0x1e6)][_0x133be6(0x1d2)]),this[_0x133be6(0x1d6)]['every'](_0x133be6(0x1eb),enums_1[_0x133be6(0x1e6)]['PurgeTempUploadedFiles']),this[_0x133be6(0x1d6)][_0x133be6(0x1cb)](enums_1[_0x133be6(0x1e6)][_0x133be6(0x1d2)],null);}async[a2_0x46aa50(0x1c9)](){const _0x45fb52=a2_0x46aa50;this[_0x45fb52(0x1e2)][_0x45fb52(0x20d)]('Scheduling\x20events...'),await this[_0x45fb52(0x1d6)]['cancel']({'name':{'$in':Object[_0x45fb52(0x1ff)](enums_1[_0x45fb52(0x1f7)])}}),this[_0x45fb52(0x1d6)][_0x45fb52(0x1cb)](enums_1[_0x45fb52(0x1e6)][_0x45fb52(0x1d2)],null);}async[a2_0x46aa50(0x1ca)](){const _0x19ae1d=a2_0x46aa50,_0x5049fe=await this[_0x19ae1d(0x1d6)]['jobs']({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x5049fe;}async[a2_0x46aa50(0x1fd)](_0x1cbd37){const _0x34caa1=a2_0x46aa50,_0x4da5a9=this[_0x34caa1(0x1d7)](_0x1cbd37),_0x7728e1=(0x0,dtos_1[_0x34caa1(0x20a)])(_0x1cbd37),_0x589314=_0x7728e1?_0x1cbd37[_0x34caa1(0x20f)]:_0x1cbd37['every'];let _0x41d7f7;return _0x7728e1?_0x41d7f7=await this[_0x34caa1(0x1d6)][_0x34caa1(0x1c6)](_0x589314,_0x1cbd37[_0x34caa1(0x20e)],_0x4da5a9):_0x41d7f7=await this[_0x34caa1(0x1d6)][_0x34caa1(0x1ef)](_0x589314,_0x1cbd37[_0x34caa1(0x20e)],_0x4da5a9,{'startDate':new Date(_0x1cbd37['startDate']),'endDate':new Date(_0x1cbd37[_0x34caa1(0x1d1)]),'skipImmediate':!![]}),{'jobId':_0x41d7f7['attrs']['_id'][_0x34caa1(0x1f1)]()};}async[a2_0x46aa50(0x1ce)](_0x47a429){const _0x167dc2=a2_0x46aa50,_0x2eca29=await this[_0x167dc2(0x1d6)]['jobs']({'_id':new mongodb_1[(_0x167dc2(0x1e8))](_0x47a429)});if(!_0x2eca29['length'])return{'success':!![],'message':_0x167dc2(0x1d5)+_0x47a429+'\x20not\x20found'};const _0x4c9e23=await this['agendaAgent'][_0x167dc2(0x1f3)]({'_id':new mongodb_1[(_0x167dc2(0x1e8))](_0x47a429)});job_1[_0x167dc2(0x1f4)]['killProcess'](_0x47a429);if(_0x4c9e23)return{'success':!![],'message':'Job\x20'+_0x47a429+'\x20is\x20cancelled'};return{'success':![],'message':_0x167dc2(0x1e5)+_0x47a429};}async[a2_0x46aa50(0x210)](_0x1cd7b0,_0x5dec1d){const _0x3fe5ab=a2_0x46aa50;return await this[_0x3fe5ab(0x1ce)](_0x1cd7b0),await this[_0x3fe5ab(0x1fd)](_0x5dec1d);}[a2_0x46aa50(0x1d7)](_0x206a89){const _0x4ea61d=a2_0x46aa50;switch(_0x206a89['jobType']){case enums_1['JobType']['PlaySound']:{return(0x0,mappers_1['toPlaySoundCommand'])(_0x206a89);}case enums_1[_0x4ea61d(0x1f7)][_0x4ea61d(0x1fb)]:{return(0x0,mappers_1['toPlayMusicCommand'])(_0x206a89);}case enums_1[_0x4ea61d(0x1f7)][_0x4ea61d(0x1d4)]:{return(0x0,voice_mapper_1[_0x4ea61d(0x1cf)])(_0x206a89);}case enums_1[_0x4ea61d(0x1f7)][_0x4ea61d(0x207)]:{return(0x0,textToAudio_mapper_1[_0x4ea61d(0x1dd)])(_0x206a89);}default:throw new common_1['NotFoundException'](_0x4ea61d(0x1d8));}}};__decorate([(0x0,event_emitter_1[a2_0x46aa50(0x1ec)])(events_1[a2_0x46aa50(0x20c)][a2_0x46aa50(0x1fa)]),(0x0,event_emitter_1[a2_0x46aa50(0x1ec)])(events_1[a2_0x46aa50(0x20c)]['Deleted']),(0x0,event_emitter_1[a2_0x46aa50(0x1ec)])(events_1[a2_0x46aa50(0x1ea)]['Created']),(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x46aa50(0x1ea)][a2_0x46aa50(0x1fa)]),(0x0,event_emitter_1[a2_0x46aa50(0x1ec)])(events_1[a2_0x46aa50(0x1ea)][a2_0x46aa50(0x1e9)]),__metadata('design:type',Function),__metadata(a2_0x46aa50(0x1d9),[]),__metadata(a2_0x46aa50(0x1f5),Promise)],AgendaService['prototype'],'rescheduleEvents',null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x46aa50(0x1f2)])(),__metadata(a2_0x46aa50(0x1d9),[nestjs_agenda_1[a2_0x46aa50(0x1d3)]])],AgendaService),exports[a2_0x46aa50(0x1d3)]=AgendaService;