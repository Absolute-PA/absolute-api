'use strict';const a2_0x451157=a2_0x594f;(function(_0x2b8605,_0x57d07b){const _0x470d1d=a2_0x594f,_0x1cb8aa=_0x2b8605();while(!![]){try{const _0x372af2=parseInt(_0x470d1d(0xd8))/0x1*(parseInt(_0x470d1d(0xd4))/0x2)+-parseInt(_0x470d1d(0xf1))/0x3*(-parseInt(_0x470d1d(0xb5))/0x4)+parseInt(_0x470d1d(0xce))/0x5*(parseInt(_0x470d1d(0xee))/0x6)+parseInt(_0x470d1d(0xaf))/0x7+parseInt(_0x470d1d(0xc7))/0x8+-parseInt(_0x470d1d(0xe7))/0x9*(parseInt(_0x470d1d(0xbf))/0xa)+-parseInt(_0x470d1d(0xd9))/0xb;if(_0x372af2===_0x57d07b)break;else _0x1cb8aa['push'](_0x1cb8aa['shift']());}catch(_0x2988ef){_0x1cb8aa['push'](_0x1cb8aa['shift']());}}}(a2_0x90e1,0x6105f));var __decorate=this&&this[a2_0x451157(0xd0)]||function(_0xce7e7d,_0x329e6d,_0xc6b6fc,_0x80ac78){const _0x4a10d4=a2_0x451157;var _0x32f252=arguments[_0x4a10d4(0xb7)],_0x1f2768=_0x32f252<0x3?_0x329e6d:_0x80ac78===null?_0x80ac78=Object[_0x4a10d4(0xeb)](_0x329e6d,_0xc6b6fc):_0x80ac78,_0x1ea837;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x4a10d4(0xde))_0x1f2768=Reflect[_0x4a10d4(0xf8)](_0xce7e7d,_0x329e6d,_0xc6b6fc,_0x80ac78);else{for(var _0x3b7722=_0xce7e7d[_0x4a10d4(0xb7)]-0x1;_0x3b7722>=0x0;_0x3b7722--)if(_0x1ea837=_0xce7e7d[_0x3b7722])_0x1f2768=(_0x32f252<0x3?_0x1ea837(_0x1f2768):_0x32f252>0x3?_0x1ea837(_0x329e6d,_0xc6b6fc,_0x1f2768):_0x1ea837(_0x329e6d,_0xc6b6fc))||_0x1f2768;}return _0x32f252>0x3&&_0x1f2768&&Object['defineProperty'](_0x329e6d,_0xc6b6fc,_0x1f2768),_0x1f2768;},__metadata=this&&this[a2_0x451157(0xef)]||function(_0x5d8e40,_0x5d8d84){const _0x45b2d4=a2_0x451157;if(typeof Reflect==='object'&&typeof Reflect[_0x45b2d4(0xfc)]===_0x45b2d4(0xde))return Reflect[_0x45b2d4(0xfc)](_0x5d8e40,_0x5d8d84);},AgendaService_1;Object[a2_0x451157(0xc4)](exports,'__esModule',{'value':!![]}),exports['AgendaService']=void 0x0;function a2_0x90e1(){const _0x526480=['\x20not\x20found','toPlayVoiceCommand','EventChangedEvent','92mrEBoq','initialize','ObjectId','endDate','1409fnjcZz','3083465ppMFSb','Created','design:paramtypes','jobType','Job\x20','function','NotFoundException','values','PlayTextToAudio','./mappers/voice.mapper','./dtos','AgendaService','isScheduleJobDTO','startDate','9HuVmDX','BackgroundJobType','log','@nestjs/common','getOwnPropertyDescriptor','jobs','Failed\x20to\x20cancel\x20job\x20','6OSRiec','__metadata','Updated','9414QUuybt','scheduleJob','ScheduleChangedEvent','PurgeTempUploadedFiles','cancelJob','PlayVoiceRecorded','JobType','decorate','toPlaySoundCommand','schedule','PROCESS_CACHE','metadata','\x20is\x20cancelled','CheckEvent','2265543hwgpzC','every','rescheduleJob','OnEvent','./mappers/textToAudio.mapper','PlayMusic','460PUDRlW','when','length','purge','@nestjs/event-emitter','attrs','cancel','toPlayTextToAudioCommand','toString','0\x200\x20*\x20*\x20*','7340930kcfJWw','mongodb','Deleted','_id','./mappers','defineProperty','design:returntype','Injectable','1495240vrchFc','agendaAgent','now','prototype','PlaySound','rescheduleEvents','logger','2377885TKqQDe','getJobPayload','__decorate'];a2_0x90e1=function(){return _0x526480;};return a2_0x90e1();}function a2_0x594f(_0x2baa66,_0x32bf00){const _0x90e101=a2_0x90e1();return a2_0x594f=function(_0x594ff8,_0x46b68e){_0x594ff8=_0x594ff8-0xaf;let _0x11e5a0=_0x90e101[_0x594ff8];return _0x11e5a0;},a2_0x594f(_0x2baa66,_0x32bf00);}const common_1=require(a2_0x451157(0xea)),nestjs_agenda_1=require('@agent-ly/nestjs-agenda'),event_emitter_1=require(a2_0x451157(0xb9)),mongodb_1=require(a2_0x451157(0xc0)),enums_1=require('../common/enums'),events_1=require('../common/events'),job_1=require('../common/job'),dtos_1=require(a2_0x451157(0xe3)),mappers_1=require(a2_0x451157(0xc3)),voice_mapper_1=require(a2_0x451157(0xe2)),textToAudio_mapper_1=require(a2_0x451157(0xb3));let AgendaService=AgendaService_1=class AgendaService{constructor(_0x508798){const _0x597caf=a2_0x451157;this[_0x597caf(0xc8)]=_0x508798,this[_0x597caf(0xcd)]=new common_1['Logger'](AgendaService_1['name']),this[_0x597caf(0xd5)]();}async[a2_0x451157(0xd5)](){const _0x3a26f1=a2_0x451157;await this[_0x3a26f1(0xc8)][_0x3a26f1(0xb8)](),this[_0x3a26f1(0xc8)][_0x3a26f1(0xb0)](_0x3a26f1(0xbe),enums_1['BackgroundJobType'][_0x3a26f1(0xfe)]),this[_0x3a26f1(0xc8)][_0x3a26f1(0xb0)](_0x3a26f1(0xbe),enums_1[_0x3a26f1(0xe8)][_0x3a26f1(0xf4)]),this['agendaAgent'][_0x3a26f1(0xc9)](enums_1[_0x3a26f1(0xe8)][_0x3a26f1(0xfe)],null);}async[a2_0x451157(0xcc)](){const _0x339f5e=a2_0x451157;this[_0x339f5e(0xcd)][_0x339f5e(0xe9)]('Scheduling\x20events...'),await this[_0x339f5e(0xc8)][_0x339f5e(0xbb)]({'name':{'$in':Object[_0x339f5e(0xe0)](enums_1['JobType'])}}),this[_0x339f5e(0xc8)][_0x339f5e(0xc9)](enums_1['BackgroundJobType'][_0x339f5e(0xfe)],null);}async['getJobs'](){const _0x5e7f1b=a2_0x451157,_0x3bae2c=await this[_0x5e7f1b(0xc8)]['jobs']({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x3bae2c;}async[a2_0x451157(0xf2)](_0x1bd981){const _0x232ab6=a2_0x451157,_0x2f5ae2=this[_0x232ab6(0xcf)](_0x1bd981),_0x1599b6=(0x0,dtos_1[_0x232ab6(0xe5)])(_0x1bd981),_0x5e73af=_0x1599b6?_0x1bd981[_0x232ab6(0xb6)]:_0x1bd981[_0x232ab6(0xb0)];let _0x14fdf2;return _0x1599b6?_0x14fdf2=await this[_0x232ab6(0xc8)][_0x232ab6(0xfa)](_0x5e73af,_0x1bd981[_0x232ab6(0xdc)],_0x2f5ae2):_0x14fdf2=await this[_0x232ab6(0xc8)][_0x232ab6(0xb0)](_0x5e73af,_0x1bd981[_0x232ab6(0xdc)],_0x2f5ae2,{'startDate':new Date(_0x1bd981[_0x232ab6(0xe6)]),'endDate':new Date(_0x1bd981[_0x232ab6(0xd7)]),'skipImmediate':!![]}),{'jobId':_0x14fdf2[_0x232ab6(0xba)][_0x232ab6(0xc2)][_0x232ab6(0xbd)]()};}async[a2_0x451157(0xf5)](_0x42ee97){const _0x216d86=a2_0x451157,_0x57a59a=await this[_0x216d86(0xc8)][_0x216d86(0xec)]({'_id':new mongodb_1['ObjectId'](_0x42ee97)});if(!_0x57a59a[_0x216d86(0xb7)])return{'success':!![],'message':_0x216d86(0xdd)+_0x42ee97+_0x216d86(0xd1)};const _0x8486d3=await this['agendaAgent'][_0x216d86(0xbb)]({'_id':new mongodb_1[(_0x216d86(0xd6))](_0x42ee97)});job_1[_0x216d86(0xfb)]['killProcess'](_0x42ee97);if(_0x8486d3)return{'success':!![],'message':'Job\x20'+_0x42ee97+_0x216d86(0xfd)};return{'success':![],'message':_0x216d86(0xed)+_0x42ee97};}async[a2_0x451157(0xb1)](_0x467784,_0x370eb1){const _0x137193=a2_0x451157;return await this[_0x137193(0xf5)](_0x467784),await this[_0x137193(0xf2)](_0x370eb1);}['getJobPayload'](_0x22124a){const _0x36d8c7=a2_0x451157;switch(_0x22124a['jobType']){case enums_1[_0x36d8c7(0xf7)][_0x36d8c7(0xcb)]:{return(0x0,mappers_1[_0x36d8c7(0xf9)])(_0x22124a);}case enums_1[_0x36d8c7(0xf7)][_0x36d8c7(0xb4)]:{return(0x0,mappers_1['toPlayMusicCommand'])(_0x22124a);}case enums_1[_0x36d8c7(0xf7)][_0x36d8c7(0xf6)]:{return(0x0,voice_mapper_1[_0x36d8c7(0xd2)])(_0x22124a);}case enums_1[_0x36d8c7(0xf7)][_0x36d8c7(0xe1)]:{return(0x0,textToAudio_mapper_1[_0x36d8c7(0xbc)])(_0x22124a);}default:throw new common_1[(_0x36d8c7(0xdf))]('Job\x20type\x20not\x20found');}}};__decorate([(0x0,event_emitter_1[a2_0x451157(0xb2)])(events_1[a2_0x451157(0xf3)][a2_0x451157(0xf0)]),(0x0,event_emitter_1[a2_0x451157(0xb2)])(events_1[a2_0x451157(0xf3)][a2_0x451157(0xc1)]),(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x451157(0xd3)][a2_0x451157(0xda)]),(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x451157(0xd3)][a2_0x451157(0xf0)]),(0x0,event_emitter_1[a2_0x451157(0xb2)])(events_1['EventChangedEvent'][a2_0x451157(0xc1)]),__metadata('design:type',Function),__metadata(a2_0x451157(0xdb),[]),__metadata(a2_0x451157(0xc5),Promise)],AgendaService[a2_0x451157(0xca)],a2_0x451157(0xcc),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x451157(0xc6)])(),__metadata('design:paramtypes',[nestjs_agenda_1[a2_0x451157(0xe4)]])],AgendaService),exports[a2_0x451157(0xe4)]=AgendaService;