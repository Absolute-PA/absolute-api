'use strict';const a2_0x586e42=a2_0x37c0;function a2_0x9f88(){const _0x107218=['mongodb','0\x200\x20*\x20*\x20*','./mappers','toPlayTextToAudioCommand','3749892OKCtiP','name','Updated','getJobPayload','2959248aOysqI','every','1607976UYCbFo','5tYSanK','NotFoundException','3TWEWzJ','defineProperty','length','rescheduleJob','11Mvyppl','toPlayMusicCommand','toPlayVoiceCommand','initialize','Failed\x20to\x20cancel\x20job\x20','metadata','988073pXAHqW','cancel','jobs','PlayMusic','prototype','9hzESlA','\x20is\x20cancelled','function','now','decorate','PlaySound','Job\x20','__decorate','cancelJob','logger','OnEvent','EventChangedEvent','Job\x20type\x20not\x20found','Created','startDate','design:paramtypes','1687497tkDKnc','Injectable','./dtos','scheduleJob','@agent-ly/nestjs-agenda','ScheduleChangedEvent','rescheduleEvents','BackgroundJobType','CheckEvent','Deleted','PlayTextToAudio','toPlaySoundCommand','design:type','__esModule','jobType','purge','AgendaService','PlayVoiceRecorded','JobType','\x20not\x20found','toString','1208452DfIedK','__metadata','agendaAgent','object','11327710NaZYIC','endDate','../common/events'];a2_0x9f88=function(){return _0x107218;};return a2_0x9f88();}(function(_0x521ee6,_0x90d4ae){const _0x3dcc39=a2_0x37c0,_0x430679=_0x521ee6();while(!![]){try{const _0x16ec6a=-parseInt(_0x3dcc39(0x161))/0x1+-parseInt(_0x3dcc39(0x18b))/0x2*(parseInt(_0x3dcc39(0x157))/0x3)+-parseInt(_0x3dcc39(0x14e))/0x4*(-parseInt(_0x3dcc39(0x155))/0x5)+-parseInt(_0x3dcc39(0x154))/0x6+parseInt(_0x3dcc39(0x176))/0x7+parseInt(_0x3dcc39(0x152))/0x8*(parseInt(_0x3dcc39(0x166))/0x9)+-parseInt(_0x3dcc39(0x18f))/0xa*(-parseInt(_0x3dcc39(0x15b))/0xb);if(_0x16ec6a===_0x90d4ae)break;else _0x430679['push'](_0x430679['shift']());}catch(_0xac3047){_0x430679['push'](_0x430679['shift']());}}}(a2_0x9f88,0xc86be));function a2_0x37c0(_0x3c6428,_0x513b36){const _0x9f88c4=a2_0x9f88();return a2_0x37c0=function(_0x37c041,_0xa5856c){_0x37c041=_0x37c041-0x148;let _0x51dcca=_0x9f88c4[_0x37c041];return _0x51dcca;},a2_0x37c0(_0x3c6428,_0x513b36);}var __decorate=this&&this[a2_0x586e42(0x16d)]||function(_0x592ef0,_0x1f1026,_0x3b8a41,_0x5e396e){const _0x372460=a2_0x586e42;var _0x2f3587=arguments['length'],_0x20d41e=_0x2f3587<0x3?_0x1f1026:_0x5e396e===null?_0x5e396e=Object['getOwnPropertyDescriptor'](_0x1f1026,_0x3b8a41):_0x5e396e,_0x3ef7de;if(typeof Reflect===_0x372460(0x18e)&&typeof Reflect[_0x372460(0x16a)]===_0x372460(0x168))_0x20d41e=Reflect[_0x372460(0x16a)](_0x592ef0,_0x1f1026,_0x3b8a41,_0x5e396e);else{for(var _0x49ed52=_0x592ef0[_0x372460(0x159)]-0x1;_0x49ed52>=0x0;_0x49ed52--)if(_0x3ef7de=_0x592ef0[_0x49ed52])_0x20d41e=(_0x2f3587<0x3?_0x3ef7de(_0x20d41e):_0x2f3587>0x3?_0x3ef7de(_0x1f1026,_0x3b8a41,_0x20d41e):_0x3ef7de(_0x1f1026,_0x3b8a41))||_0x20d41e;}return _0x2f3587>0x3&&_0x20d41e&&Object[_0x372460(0x158)](_0x1f1026,_0x3b8a41,_0x20d41e),_0x20d41e;},__metadata=this&&this[a2_0x586e42(0x18c)]||function(_0x555167,_0xe1546f){const _0x4a47d5=a2_0x586e42;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x4a47d5(0x168))return Reflect[_0x4a47d5(0x160)](_0x555167,_0xe1546f);},AgendaService_1;Object['defineProperty'](exports,a2_0x586e42(0x183),{'value':!![]}),exports['AgendaService']=void 0x0;const common_1=require('@nestjs/common'),nestjs_agenda_1=require(a2_0x586e42(0x17a)),event_emitter_1=require('@nestjs/event-emitter'),mongodb_1=require(a2_0x586e42(0x14a)),enums_1=require('../common/enums'),events_1=require(a2_0x586e42(0x149)),job_1=require('../common/job'),dtos_1=require(a2_0x586e42(0x178)),mappers_1=require(a2_0x586e42(0x14c)),voice_mapper_1=require('./mappers/voice.mapper'),textToAudio_mapper_1=require('./mappers/textToAudio.mapper');let AgendaService=AgendaService_1=class AgendaService{constructor(_0x3253e1){const _0x28b976=a2_0x586e42;this[_0x28b976(0x18d)]=_0x3253e1,this[_0x28b976(0x16f)]=new common_1['Logger'](AgendaService_1[_0x28b976(0x14f)]),this[_0x28b976(0x15e)]();}async[a2_0x586e42(0x15e)](){const _0x133758=a2_0x586e42;await this[_0x133758(0x18d)][_0x133758(0x185)](),this[_0x133758(0x18d)][_0x133758(0x153)](_0x133758(0x14b),enums_1[_0x133758(0x17d)][_0x133758(0x17e)]),this[_0x133758(0x18d)][_0x133758(0x153)]('0\x200\x20*\x20*\x20*',enums_1[_0x133758(0x17d)]['PurgeTempUploadedFiles']),this[_0x133758(0x18d)][_0x133758(0x169)](enums_1[_0x133758(0x17d)][_0x133758(0x17e)],null);}async[a2_0x586e42(0x17c)](){const _0x524ec7=a2_0x586e42;this['logger']['log']('Scheduling\x20events...'),await this[_0x524ec7(0x18d)][_0x524ec7(0x162)]({'name':{'$in':Object['values'](enums_1[_0x524ec7(0x188)])}}),this['agendaAgent'][_0x524ec7(0x169)](enums_1[_0x524ec7(0x17d)][_0x524ec7(0x17e)],null);}async['getJobs'](){const _0x24d6a8=a2_0x586e42,_0x540875=await this['agendaAgent'][_0x24d6a8(0x163)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x540875;}async[a2_0x586e42(0x179)](_0x34412f){const _0x3effc8=a2_0x586e42,_0x205695=this[_0x3effc8(0x151)](_0x34412f),_0x653e59=(0x0,dtos_1['isScheduleJobDTO'])(_0x34412f),_0x764dcb=_0x653e59?_0x34412f['when']:_0x34412f['every'];let _0x4b8b35;return _0x653e59?_0x4b8b35=await this[_0x3effc8(0x18d)]['schedule'](_0x764dcb,_0x34412f[_0x3effc8(0x184)],_0x205695):_0x4b8b35=await this[_0x3effc8(0x18d)][_0x3effc8(0x153)](_0x764dcb,_0x34412f['jobType'],_0x205695,{'startDate':new Date(_0x34412f[_0x3effc8(0x174)]),'endDate':new Date(_0x34412f[_0x3effc8(0x148)]),'skipImmediate':!![]}),{'jobId':_0x4b8b35['attrs']['_id'][_0x3effc8(0x18a)]()};}async[a2_0x586e42(0x16e)](_0x3f8177){const _0x31aa8c=a2_0x586e42,_0x398294=await this[_0x31aa8c(0x18d)][_0x31aa8c(0x163)]({'_id':new mongodb_1['ObjectId'](_0x3f8177)});if(!_0x398294[_0x31aa8c(0x159)])return{'success':!![],'message':_0x31aa8c(0x16c)+_0x3f8177+_0x31aa8c(0x189)};const _0x23f077=await this[_0x31aa8c(0x18d)][_0x31aa8c(0x162)]({'_id':new mongodb_1['ObjectId'](_0x3f8177)});job_1['PROCESS_CACHE']['killProcess'](_0x3f8177);if(_0x23f077)return{'success':!![],'message':_0x31aa8c(0x16c)+_0x3f8177+_0x31aa8c(0x167)};return{'success':![],'message':_0x31aa8c(0x15f)+_0x3f8177};}async[a2_0x586e42(0x15a)](_0x428207,_0x1322cd){const _0x37c177=a2_0x586e42;return await this[_0x37c177(0x16e)](_0x428207),await this[_0x37c177(0x179)](_0x1322cd);}[a2_0x586e42(0x151)](_0x24c4a9){const _0x36cea4=a2_0x586e42;switch(_0x24c4a9[_0x36cea4(0x184)]){case enums_1[_0x36cea4(0x188)][_0x36cea4(0x16b)]:{return(0x0,mappers_1[_0x36cea4(0x181)])(_0x24c4a9);}case enums_1['JobType'][_0x36cea4(0x164)]:{return(0x0,mappers_1[_0x36cea4(0x15c)])(_0x24c4a9);}case enums_1['JobType'][_0x36cea4(0x187)]:{return(0x0,voice_mapper_1[_0x36cea4(0x15d)])(_0x24c4a9);}case enums_1[_0x36cea4(0x188)][_0x36cea4(0x180)]:{return(0x0,textToAudio_mapper_1[_0x36cea4(0x14d)])(_0x24c4a9);}default:throw new common_1[(_0x36cea4(0x156))](_0x36cea4(0x172));}}};__decorate([(0x0,event_emitter_1[a2_0x586e42(0x170)])(events_1[a2_0x586e42(0x17b)][a2_0x586e42(0x150)]),(0x0,event_emitter_1[a2_0x586e42(0x170)])(events_1['ScheduleChangedEvent'][a2_0x586e42(0x17f)]),(0x0,event_emitter_1[a2_0x586e42(0x170)])(events_1[a2_0x586e42(0x171)][a2_0x586e42(0x173)]),(0x0,event_emitter_1[a2_0x586e42(0x170)])(events_1[a2_0x586e42(0x171)][a2_0x586e42(0x150)]),(0x0,event_emitter_1['OnEvent'])(events_1['EventChangedEvent'][a2_0x586e42(0x17f)]),__metadata(a2_0x586e42(0x182),Function),__metadata(a2_0x586e42(0x175),[]),__metadata('design:returntype',Promise)],AgendaService[a2_0x586e42(0x165)],a2_0x586e42(0x17c),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x586e42(0x177)])(),__metadata('design:paramtypes',[nestjs_agenda_1[a2_0x586e42(0x186)]])],AgendaService),exports[a2_0x586e42(0x186)]=AgendaService;