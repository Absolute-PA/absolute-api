'use strict';const a2_0x5e2ea4=a2_0x5f52;(function(_0x49c231,_0x10d4a4){const _0x28664d=a2_0x5f52,_0x5ace0b=_0x49c231();while(!![]){try{const _0x187435=parseInt(_0x28664d(0x139))/0x1+parseInt(_0x28664d(0x13a))/0x2*(parseInt(_0x28664d(0x15b))/0x3)+-parseInt(_0x28664d(0x170))/0x4+parseInt(_0x28664d(0x160))/0x5*(-parseInt(_0x28664d(0x15c))/0x6)+parseInt(_0x28664d(0x137))/0x7*(parseInt(_0x28664d(0x13e))/0x8)+-parseInt(_0x28664d(0x169))/0x9*(-parseInt(_0x28664d(0x16c))/0xa)+-parseInt(_0x28664d(0x150))/0xb;if(_0x187435===_0x10d4a4)break;else _0x5ace0b['push'](_0x5ace0b['shift']());}catch(_0x157889){_0x5ace0b['push'](_0x5ace0b['shift']());}}}(a2_0x4991,0x7ab9d));var __decorate=this&&this['__decorate']||function(_0x42994d,_0x335104,_0x514db7,_0x4fca07){const _0x1ae837=a2_0x5f52;var _0x498c41=arguments['length'],_0x3eb352=_0x498c41<0x3?_0x335104:_0x4fca07===null?_0x4fca07=Object['getOwnPropertyDescriptor'](_0x335104,_0x514db7):_0x4fca07,_0x42c183;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x3eb352=Reflect[_0x1ae837(0x167)](_0x42994d,_0x335104,_0x514db7,_0x4fca07);else{for(var _0x276332=_0x42994d[_0x1ae837(0x142)]-0x1;_0x276332>=0x0;_0x276332--)if(_0x42c183=_0x42994d[_0x276332])_0x3eb352=(_0x498c41<0x3?_0x42c183(_0x3eb352):_0x498c41>0x3?_0x42c183(_0x335104,_0x514db7,_0x3eb352):_0x42c183(_0x335104,_0x514db7))||_0x3eb352;}return _0x498c41>0x3&&_0x3eb352&&Object[_0x1ae837(0x135)](_0x335104,_0x514db7,_0x3eb352),_0x3eb352;},__metadata=this&&this[a2_0x5e2ea4(0x152)]||function(_0x2a57df,_0x49cac3){const _0x54348a=a2_0x5e2ea4;if(typeof Reflect===_0x54348a(0x153)&&typeof Reflect[_0x54348a(0x15f)]===_0x54348a(0x141))return Reflect['metadata'](_0x2a57df,_0x49cac3);},AgendaService_1;function a2_0x5f52(_0x5bb2a3,_0x32f53b){const _0x499167=a2_0x4991();return a2_0x5f52=function(_0x5f5227,_0x5aa129){_0x5f5227=_0x5f5227-0x126;let _0x1934e4=_0x499167[_0x5f5227];return _0x1934e4;},a2_0x5f52(_0x5bb2a3,_0x32f53b);}Object[a2_0x5e2ea4(0x135)](exports,a2_0x5e2ea4(0x156),{'value':!![]}),exports['AgendaService']=void 0x0;function a2_0x4991(){const _0x4a407a=['design:paramtypes','rescheduleEvents','PurgeTempUploadedFiles','toString','startDate','Logger','PlaySound','PlayVoiceRecorded','_id','logger','PROCESS_CACHE','isScheduleJobDTO','./mappers/voice.mapper','defineProperty','purge','378zFydBD','./mappers/textToAudio.mapper','108005fStimq','749378kECShi','schedule','scheduleJob','cancel','141560MzxCeA','every','getJobs','function','length','BackgroundJobType','NotFoundException','OnEvent','design:type','\x20not\x20found','now','toPlayMusicCommand','killProcess','prototype','values','0\x200\x20*\x20*\x20*','initialize','PlayMusic','7233545MRcWva','Updated','__metadata','object','@nestjs/event-emitter','cancelJob','__esModule','AgendaService','CheckEvent','ScheduleChangedEvent','getJobPayload','6hVJncD','3738rYcxrh','../common/job','./mappers','metadata','6605swmhLI','EventChangedEvent','@nestjs/common','Job\x20type\x20not\x20found','../common/events','ObjectId','rescheduleJob','decorate','design:returntype','207VWAsOq','name','toPlayTextToAudioCommand','365570zZwZRl','jobType','\x20is\x20cancelled','endDate','2681844TJSEsx','./dtos','agendaAgent','JobType','toPlaySoundCommand'];a2_0x4991=function(){return _0x4a407a;};return a2_0x4991();}const common_1=require(a2_0x5e2ea4(0x162)),nestjs_agenda_1=require('@agent-ly/nestjs-agenda'),event_emitter_1=require(a2_0x5e2ea4(0x154)),mongodb_1=require('mongodb'),enums_1=require('../common/enums'),events_1=require(a2_0x5e2ea4(0x164)),job_1=require(a2_0x5e2ea4(0x15d)),dtos_1=require(a2_0x5e2ea4(0x171)),mappers_1=require(a2_0x5e2ea4(0x15e)),voice_mapper_1=require(a2_0x5e2ea4(0x134)),textToAudio_mapper_1=require(a2_0x5e2ea4(0x138));let AgendaService=AgendaService_1=class AgendaService{constructor(_0x236ae1){const _0x5df632=a2_0x5e2ea4;this[_0x5df632(0x172)]=_0x236ae1,this[_0x5df632(0x131)]=new common_1[(_0x5df632(0x12d))](AgendaService_1[_0x5df632(0x16a)]),this['initialize']();}async[a2_0x5e2ea4(0x14e)](){const _0x5f222d=a2_0x5e2ea4;await this[_0x5f222d(0x172)][_0x5f222d(0x136)](),this['agendaAgent'][_0x5f222d(0x13f)](_0x5f222d(0x14d),enums_1[_0x5f222d(0x143)][_0x5f222d(0x158)]),this['agendaAgent']['every'](_0x5f222d(0x14d),enums_1[_0x5f222d(0x143)][_0x5f222d(0x12a)]),this[_0x5f222d(0x172)][_0x5f222d(0x148)](enums_1['BackgroundJobType'][_0x5f222d(0x158)],null);}async[a2_0x5e2ea4(0x129)](){const _0x521dd5=a2_0x5e2ea4;this['logger']['log']('Scheduling\x20events...'),await this[_0x521dd5(0x172)][_0x521dd5(0x13d)]({'name':{'$in':Object[_0x521dd5(0x14c)](enums_1[_0x521dd5(0x126)])}}),this[_0x521dd5(0x172)]['now'](enums_1[_0x521dd5(0x143)]['CheckEvent'],null);}async[a2_0x5e2ea4(0x140)](){const _0x329427=a2_0x5e2ea4,_0x19b0f0=await this[_0x329427(0x172)]['jobs']({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x19b0f0;}async['scheduleJob'](_0x55f3ea){const _0x2483a1=a2_0x5e2ea4,_0xe42a56=this[_0x2483a1(0x15a)](_0x55f3ea),_0x25a980=(0x0,dtos_1[_0x2483a1(0x133)])(_0x55f3ea),_0x25b636=_0x25a980?_0x55f3ea['when']:_0x55f3ea[_0x2483a1(0x13f)];let _0x274f6c;return _0x25a980?_0x274f6c=await this[_0x2483a1(0x172)][_0x2483a1(0x13b)](_0x25b636,_0x55f3ea[_0x2483a1(0x16d)],_0xe42a56):_0x274f6c=await this[_0x2483a1(0x172)]['every'](_0x25b636,_0x55f3ea[_0x2483a1(0x16d)],_0xe42a56,{'startDate':new Date(_0x55f3ea[_0x2483a1(0x12c)]),'endDate':new Date(_0x55f3ea[_0x2483a1(0x16f)]),'skipImmediate':!![]}),{'jobId':_0x274f6c['attrs'][_0x2483a1(0x130)][_0x2483a1(0x12b)]()};}async[a2_0x5e2ea4(0x155)](_0x5246e8){const _0x21f14b=a2_0x5e2ea4,_0x3836a2=await this[_0x21f14b(0x172)]['jobs']({'_id':new mongodb_1[(_0x21f14b(0x165))](_0x5246e8)});if(!_0x3836a2[_0x21f14b(0x142)])return{'success':!![],'message':'Job\x20'+_0x5246e8+_0x21f14b(0x147)};const _0x460f2c=await this['agendaAgent'][_0x21f14b(0x13d)]({'_id':new mongodb_1[(_0x21f14b(0x165))](_0x5246e8)});job_1[_0x21f14b(0x132)][_0x21f14b(0x14a)](_0x5246e8);if(_0x460f2c)return{'success':!![],'message':'Job\x20'+_0x5246e8+_0x21f14b(0x16e)};return{'success':![],'message':'Failed\x20to\x20cancel\x20job\x20'+_0x5246e8};}async[a2_0x5e2ea4(0x166)](_0x1f85b1,_0x5cc54c){const _0xacee0a=a2_0x5e2ea4;return await this[_0xacee0a(0x155)](_0x1f85b1),await this[_0xacee0a(0x13c)](_0x5cc54c);}[a2_0x5e2ea4(0x15a)](_0x16f2ce){const _0x3ccdef=a2_0x5e2ea4;switch(_0x16f2ce[_0x3ccdef(0x16d)]){case enums_1['JobType'][_0x3ccdef(0x12e)]:{return(0x0,mappers_1[_0x3ccdef(0x127)])(_0x16f2ce);}case enums_1[_0x3ccdef(0x126)][_0x3ccdef(0x14f)]:{return(0x0,mappers_1[_0x3ccdef(0x149)])(_0x16f2ce);}case enums_1[_0x3ccdef(0x126)][_0x3ccdef(0x12f)]:{return(0x0,voice_mapper_1['toPlayVoiceCommand'])(_0x16f2ce);}case enums_1[_0x3ccdef(0x126)]['PlayTextToAudio']:{return(0x0,textToAudio_mapper_1[_0x3ccdef(0x16b)])(_0x16f2ce);}default:throw new common_1[(_0x3ccdef(0x144))](_0x3ccdef(0x163));}}};__decorate([(0x0,event_emitter_1[a2_0x5e2ea4(0x145)])(events_1[a2_0x5e2ea4(0x159)][a2_0x5e2ea4(0x151)]),(0x0,event_emitter_1[a2_0x5e2ea4(0x145)])(events_1[a2_0x5e2ea4(0x159)]['Deleted']),(0x0,event_emitter_1[a2_0x5e2ea4(0x145)])(events_1[a2_0x5e2ea4(0x161)]['Created']),(0x0,event_emitter_1[a2_0x5e2ea4(0x145)])(events_1[a2_0x5e2ea4(0x161)][a2_0x5e2ea4(0x151)]),(0x0,event_emitter_1[a2_0x5e2ea4(0x145)])(events_1['EventChangedEvent']['Deleted']),__metadata(a2_0x5e2ea4(0x146),Function),__metadata(a2_0x5e2ea4(0x128),[]),__metadata(a2_0x5e2ea4(0x168),Promise)],AgendaService[a2_0x5e2ea4(0x14b)],'rescheduleEvents',null),AgendaService=AgendaService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(a2_0x5e2ea4(0x128),[nestjs_agenda_1[a2_0x5e2ea4(0x157)]])],AgendaService),exports['AgendaService']=AgendaService;