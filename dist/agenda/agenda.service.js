'use strict';const a2_0x5ced47=a2_0x5b70;(function(_0x4c10ff,_0x4ea54f){const _0x1c3b1f=a2_0x5b70,_0x2785e8=_0x4c10ff();while(!![]){try{const _0xfe4a2f=-parseInt(_0x1c3b1f(0x179))/0x1+parseInt(_0x1c3b1f(0x1a3))/0x2+-parseInt(_0x1c3b1f(0x16c))/0x3*(-parseInt(_0x1c3b1f(0x175))/0x4)+parseInt(_0x1c3b1f(0x18f))/0x5+parseInt(_0x1c3b1f(0x173))/0x6+-parseInt(_0x1c3b1f(0x15d))/0x7*(parseInt(_0x1c3b1f(0x178))/0x8)+-parseInt(_0x1c3b1f(0x188))/0x9*(parseInt(_0x1c3b1f(0x163))/0xa);if(_0xfe4a2f===_0x4ea54f)break;else _0x2785e8['push'](_0x2785e8['shift']());}catch(_0x4f1a74){_0x2785e8['push'](_0x2785e8['shift']());}}}(a2_0x5a33,0x47010));var __decorate=this&&this[a2_0x5ced47(0x1a0)]||function(_0x581022,_0x1c37fb,_0x119565,_0x344236){const _0x199fae=a2_0x5ced47;var _0x4c1192=arguments[_0x199fae(0x19c)],_0x44cbcd=_0x4c1192<0x3?_0x1c37fb:_0x344236===null?_0x344236=Object['getOwnPropertyDescriptor'](_0x1c37fb,_0x119565):_0x344236,_0x50140f;if(typeof Reflect===_0x199fae(0x18e)&&typeof Reflect[_0x199fae(0x170)]===_0x199fae(0x15f))_0x44cbcd=Reflect['decorate'](_0x581022,_0x1c37fb,_0x119565,_0x344236);else{for(var _0x11adf8=_0x581022[_0x199fae(0x19c)]-0x1;_0x11adf8>=0x0;_0x11adf8--)if(_0x50140f=_0x581022[_0x11adf8])_0x44cbcd=(_0x4c1192<0x3?_0x50140f(_0x44cbcd):_0x4c1192>0x3?_0x50140f(_0x1c37fb,_0x119565,_0x44cbcd):_0x50140f(_0x1c37fb,_0x119565))||_0x44cbcd;}return _0x4c1192>0x3&&_0x44cbcd&&Object[_0x199fae(0x1a2)](_0x1c37fb,_0x119565,_0x44cbcd),_0x44cbcd;},__metadata=this&&this[a2_0x5ced47(0x155)]||function(_0x1b2d77,_0x14c929){const _0x3f1b50=a2_0x5ced47;if(typeof Reflect===_0x3f1b50(0x18e)&&typeof Reflect[_0x3f1b50(0x16f)]==='function')return Reflect['metadata'](_0x1b2d77,_0x14c929);},AgendaService_1;Object[a2_0x5ced47(0x1a2)](exports,'__esModule',{'value':!![]}),exports[a2_0x5ced47(0x185)]=void 0x0;const common_1=require(a2_0x5ced47(0x156)),nestjs_agenda_1=require(a2_0x5ced47(0x192)),event_emitter_1=require(a2_0x5ced47(0x158)),mongodb_1=require(a2_0x5ced47(0x17f)),enums_1=require(a2_0x5ced47(0x1a4)),events_1=require('../common/events'),job_1=require('../common/job'),dtos_1=require(a2_0x5ced47(0x16b)),mappers_1=require(a2_0x5ced47(0x181)),voice_mapper_1=require('./mappers/voice.mapper'),textToAudio_mapper_1=require(a2_0x5ced47(0x183));function a2_0x5b70(_0x4dd8c6,_0x5281bc){const _0x5a330a=a2_0x5a33();return a2_0x5b70=function(_0x5b7022,_0x3823a6){_0x5b7022=_0x5b7022-0x155;let _0x4cb599=_0x5a330a[_0x5b7022];return _0x4cb599;},a2_0x5b70(_0x4dd8c6,_0x5281bc);}let AgendaService=AgendaService_1=class AgendaService{constructor(_0x411079){const _0x211642=a2_0x5ced47;this[_0x211642(0x172)]=_0x411079,this['logger']=new common_1[(_0x211642(0x15e))](AgendaService_1[_0x211642(0x190)]),this['initialize']();}async[a2_0x5ced47(0x19f)](){const _0x269bcb=a2_0x5ced47;await this[_0x269bcb(0x172)][_0x269bcb(0x18c)](),this['agendaAgent'][_0x269bcb(0x191)](_0x269bcb(0x17b),enums_1[_0x269bcb(0x198)][_0x269bcb(0x196)]),this[_0x269bcb(0x172)][_0x269bcb(0x191)](_0x269bcb(0x17b),enums_1['BackgroundJobType'][_0x269bcb(0x162)]),this[_0x269bcb(0x172)]['now'](enums_1['BackgroundJobType'][_0x269bcb(0x196)],null);}async[a2_0x5ced47(0x1a1)](){const _0x3bd452=a2_0x5ced47;this['logger'][_0x3bd452(0x16d)](_0x3bd452(0x159)),await this[_0x3bd452(0x172)][_0x3bd452(0x167)]({'name':{'$in':Object['values'](enums_1['JobType'])}}),this[_0x3bd452(0x172)]['now'](enums_1[_0x3bd452(0x198)]['CheckEvent'],null);}async[a2_0x5ced47(0x180)](){const _0x16c812=a2_0x5ced47,_0x23af65=await this[_0x16c812(0x172)][_0x16c812(0x194)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x23af65;}async[a2_0x5ced47(0x199)](_0x2ad247){const _0x347334=a2_0x5ced47,_0x3d5816=this[_0x347334(0x176)](_0x2ad247),_0x746e4c=(0x0,dtos_1['isScheduleJobDTO'])(_0x2ad247),_0x3f13cf=_0x746e4c?_0x2ad247['when']:_0x2ad247['every'];let _0x41be26;return _0x746e4c?_0x41be26=await this[_0x347334(0x172)][_0x347334(0x171)](_0x3f13cf,_0x2ad247[_0x347334(0x187)],_0x3d5816):_0x41be26=await this[_0x347334(0x172)]['every'](_0x3f13cf,_0x2ad247[_0x347334(0x187)],_0x3d5816,{'startDate':new Date(_0x2ad247[_0x347334(0x164)]),'endDate':new Date(_0x2ad247[_0x347334(0x17a)]),'skipImmediate':!![]}),{'jobId':_0x41be26[_0x347334(0x186)][_0x347334(0x18d)][_0x347334(0x15b)]()};}async[a2_0x5ced47(0x16a)](_0x5d3e07){const _0x416d76=a2_0x5ced47,_0x443838=await this[_0x416d76(0x172)][_0x416d76(0x194)]({'_id':new mongodb_1[(_0x416d76(0x165))](_0x5d3e07)});if(!_0x443838[_0x416d76(0x19c)])return{'success':!![],'message':_0x416d76(0x18b)+_0x5d3e07+_0x416d76(0x174)};const _0x3ad6ce=await this['agendaAgent']['cancel']({'_id':new mongodb_1[(_0x416d76(0x165))](_0x5d3e07)});job_1[_0x416d76(0x17d)][_0x416d76(0x182)](_0x5d3e07);if(_0x3ad6ce)return{'success':!![],'message':_0x416d76(0x18b)+_0x5d3e07+_0x416d76(0x19d)};return{'success':![],'message':_0x416d76(0x189)+_0x5d3e07};}async[a2_0x5ced47(0x177)](_0x50eb3a,_0x52cf27){const _0xc222b6=a2_0x5ced47;return await this[_0xc222b6(0x16a)](_0x50eb3a),await this[_0xc222b6(0x199)](_0x52cf27);}[a2_0x5ced47(0x176)](_0x12cff7){const _0x538a67=a2_0x5ced47;switch(_0x12cff7[_0x538a67(0x187)]){case enums_1[_0x538a67(0x19a)][_0x538a67(0x18a)]:{return(0x0,mappers_1[_0x538a67(0x16e)])(_0x12cff7);}case enums_1['JobType'][_0x538a67(0x1a5)]:{return(0x0,mappers_1[_0x538a67(0x160)])(_0x12cff7);}case enums_1[_0x538a67(0x19a)][_0x538a67(0x168)]:{return(0x0,voice_mapper_1['toPlayVoiceCommand'])(_0x12cff7);}case enums_1[_0x538a67(0x19a)][_0x538a67(0x19b)]:{return(0x0,textToAudio_mapper_1[_0x538a67(0x169)])(_0x12cff7);}default:throw new common_1[(_0x538a67(0x17c))](_0x538a67(0x15a));}}};__decorate([(0x0,event_emitter_1[a2_0x5ced47(0x15c)])(events_1['ScheduleChangedEvent'][a2_0x5ced47(0x197)]),(0x0,event_emitter_1[a2_0x5ced47(0x15c)])(events_1['ScheduleChangedEvent'][a2_0x5ced47(0x17e)]),(0x0,event_emitter_1[a2_0x5ced47(0x15c)])(events_1['EventChangedEvent'][a2_0x5ced47(0x184)]),(0x0,event_emitter_1[a2_0x5ced47(0x15c)])(events_1[a2_0x5ced47(0x19e)][a2_0x5ced47(0x197)]),(0x0,event_emitter_1[a2_0x5ced47(0x15c)])(events_1['EventChangedEvent'][a2_0x5ced47(0x17e)]),__metadata(a2_0x5ced47(0x195),Function),__metadata(a2_0x5ced47(0x157),[]),__metadata(a2_0x5ced47(0x193),Promise)],AgendaService[a2_0x5ced47(0x161)],'rescheduleEvents',null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x5ced47(0x166)])(),__metadata(a2_0x5ced47(0x157),[nestjs_agenda_1[a2_0x5ced47(0x185)]])],AgendaService),exports['AgendaService']=AgendaService;function a2_0x5a33(){const _0x16d699=['CheckEvent','Updated','BackgroundJobType','scheduleJob','JobType','PlayTextToAudio','length','\x20is\x20cancelled','EventChangedEvent','initialize','__decorate','rescheduleEvents','defineProperty','782202TOKBFm','../common/enums','PlayMusic','__metadata','@nestjs/common','design:paramtypes','@nestjs/event-emitter','Scheduling\x20events...','Job\x20type\x20not\x20found','toString','OnEvent','49777MhOBsz','Logger','function','toPlayMusicCommand','prototype','PurgeTempUploadedFiles','2089610pXoBBd','startDate','ObjectId','Injectable','cancel','PlayVoiceRecorded','toPlayTextToAudioCommand','cancelJob','./dtos','24ResZrC','log','toPlaySoundCommand','metadata','decorate','schedule','agendaAgent','1190634iZeNmT','\x20not\x20found','50192OCHoew','getJobPayload','rescheduleJob','104OcMANs','195313yROYlT','endDate','0\x200\x20*\x20*\x20*','NotFoundException','PROCESS_CACHE','Deleted','mongodb','getJobs','./mappers','killProcess','./mappers/textToAudio.mapper','Created','AgendaService','attrs','jobType','27lvCeSN','Failed\x20to\x20cancel\x20job\x20','PlaySound','Job\x20','purge','_id','object','2577735SBAFve','name','every','@agent-ly/nestjs-agenda','design:returntype','jobs','design:type'];a2_0x5a33=function(){return _0x16d699;};return a2_0x5a33();}