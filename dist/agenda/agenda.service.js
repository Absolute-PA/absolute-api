'use strict';const a2_0x181b16=a2_0x2613;(function(_0x579c51,_0xfa208b){const _0x44a693=a2_0x2613,_0x10c6a1=_0x579c51();while(!![]){try{const _0x2d1bad=-parseInt(_0x44a693(0x211))/0x1+parseInt(_0x44a693(0x1e8))/0x2+parseInt(_0x44a693(0x214))/0x3+parseInt(_0x44a693(0x213))/0x4*(-parseInt(_0x44a693(0x209))/0x5)+-parseInt(_0x44a693(0x1d1))/0x6*(parseInt(_0x44a693(0x1f1))/0x7)+-parseInt(_0x44a693(0x1f8))/0x8*(parseInt(_0x44a693(0x1de))/0x9)+parseInt(_0x44a693(0x1fb))/0xa;if(_0x2d1bad===_0xfa208b)break;else _0x10c6a1['push'](_0x10c6a1['shift']());}catch(_0x25bbc6){_0x10c6a1['push'](_0x10c6a1['shift']());}}}(a2_0x5334,0x2ca41));var __decorate=this&&this[a2_0x181b16(0x219)]||function(_0x253dc8,_0x49763a,_0x2bbda1,_0x40f3b9){const _0x14a312=a2_0x181b16;var _0x5e33c4=arguments['length'],_0x2c6200=_0x5e33c4<0x3?_0x49763a:_0x40f3b9===null?_0x40f3b9=Object['getOwnPropertyDescriptor'](_0x49763a,_0x2bbda1):_0x40f3b9,_0x1e4ef4;if(typeof Reflect===_0x14a312(0x1ef)&&typeof Reflect[_0x14a312(0x20e)]==='function')_0x2c6200=Reflect['decorate'](_0x253dc8,_0x49763a,_0x2bbda1,_0x40f3b9);else{for(var _0x14085f=_0x253dc8[_0x14a312(0x205)]-0x1;_0x14085f>=0x0;_0x14085f--)if(_0x1e4ef4=_0x253dc8[_0x14085f])_0x2c6200=(_0x5e33c4<0x3?_0x1e4ef4(_0x2c6200):_0x5e33c4>0x3?_0x1e4ef4(_0x49763a,_0x2bbda1,_0x2c6200):_0x1e4ef4(_0x49763a,_0x2bbda1))||_0x2c6200;}return _0x5e33c4>0x3&&_0x2c6200&&Object[_0x14a312(0x1ec)](_0x49763a,_0x2bbda1,_0x2c6200),_0x2c6200;},__metadata=this&&this[a2_0x181b16(0x210)]||function(_0xe04fc6,_0x23affc){const _0x30abac=a2_0x181b16;if(typeof Reflect===_0x30abac(0x1ef)&&typeof Reflect[_0x30abac(0x217)]===_0x30abac(0x21c))return Reflect[_0x30abac(0x217)](_0xe04fc6,_0x23affc);},AgendaService_1;Object['defineProperty'](exports,a2_0x181b16(0x216),{'value':!![]}),exports[a2_0x181b16(0x1f6)]=void 0x0;const common_1=require('@nestjs/common'),nestjs_agenda_1=require('@agent-ly/nestjs-agenda'),event_emitter_1=require(a2_0x181b16(0x200)),mongodb_1=require(a2_0x181b16(0x1fc)),enums_1=require('../common/enums'),events_1=require(a2_0x181b16(0x1ee)),job_1=require(a2_0x181b16(0x1d6)),dtos_1=require('./dtos'),mappers_1=require('./mappers'),voice_mapper_1=require(a2_0x181b16(0x20f)),textToAudio_mapper_1=require(a2_0x181b16(0x1d2));function a2_0x2613(_0x5bad1e,_0x20243){const _0x533431=a2_0x5334();return a2_0x2613=function(_0x26132f,_0x449ccb){_0x26132f=_0x26132f-0x1d1;let _0x43e579=_0x533431[_0x26132f];return _0x43e579;},a2_0x2613(_0x5bad1e,_0x20243);}function a2_0x5334(){const _0x4ed68f=['AgendaService','cancel','8WuggPi','_id','jobType','5000970cmPOlS','mongodb','Job\x20type\x20not\x20found','PurgeTempUploadedFiles','Injectable','@nestjs/event-emitter','PlayVoiceRecorded','toPlayMusicCommand','toString','prototype','length','CheckEvent','purge','ObjectId','9210FUZemO','Created','every','getJobs','Scheduling\x20events...','decorate','./mappers/voice.mapper','__metadata','133647ocXgHI','BackgroundJobType','488ZgSEXG','857667vcdEEX','cancelJob','__esModule','metadata','name','__decorate','agendaAgent','logger','function','48sVsfjI','./mappers/textToAudio.mapper','isScheduleJobDTO','design:returntype','design:type','../common/job','initialize','PROCESS_CACHE','EventChangedEvent','Deleted','ScheduleChangedEvent','values','Updated','689787RCMwQz','now','startDate','\x20not\x20found','jobs','toPlayVoiceCommand','NotFoundException','scheduleJob','\x20is\x20cancelled','rescheduleJob','197306MhWNGw','Logger','OnEvent','PlaySound','defineProperty','killProcess','../common/events','object','getJobPayload','233429FZmPID','rescheduleEvents','JobType','design:paramtypes','attrs'];a2_0x5334=function(){return _0x4ed68f;};return a2_0x5334();}let AgendaService=AgendaService_1=class AgendaService{constructor(_0x19f3b3){const _0x1d8477=a2_0x181b16;this[_0x1d8477(0x21a)]=_0x19f3b3,this[_0x1d8477(0x21b)]=new common_1[(_0x1d8477(0x1e9))](AgendaService_1[_0x1d8477(0x218)]),this[_0x1d8477(0x1d7)]();}async[a2_0x181b16(0x1d7)](){const _0x4f4753=a2_0x181b16;await this[_0x4f4753(0x21a)][_0x4f4753(0x207)](),this[_0x4f4753(0x21a)][_0x4f4753(0x20b)]('0\x200\x20*\x20*\x20*',enums_1['BackgroundJobType'][_0x4f4753(0x206)]),this[_0x4f4753(0x21a)][_0x4f4753(0x20b)]('0\x200\x20*\x20*\x20*',enums_1['BackgroundJobType'][_0x4f4753(0x1fe)]),this[_0x4f4753(0x21a)][_0x4f4753(0x1df)](enums_1[_0x4f4753(0x212)][_0x4f4753(0x206)],null);}async[a2_0x181b16(0x1f2)](){const _0x372958=a2_0x181b16;this[_0x372958(0x21b)]['log'](_0x372958(0x20d)),await this['agendaAgent'][_0x372958(0x1f7)]({'name':{'$in':Object[_0x372958(0x1dc)](enums_1['JobType'])}}),this[_0x372958(0x21a)][_0x372958(0x1df)](enums_1['BackgroundJobType'][_0x372958(0x206)],null);}async[a2_0x181b16(0x20c)](){const _0x47ef25=a2_0x181b16,_0xf39905=await this[_0x47ef25(0x21a)]['jobs']({'nextRunAt':{'$exists':!![],'$ne':null}});return _0xf39905;}async[a2_0x181b16(0x1e5)](_0x9904c8){const _0x1d011f=a2_0x181b16,_0x1355ba=this[_0x1d011f(0x1f0)](_0x9904c8),_0x36e9c=(0x0,dtos_1[_0x1d011f(0x1d3)])(_0x9904c8),_0x4ad45b=_0x36e9c?_0x9904c8['when']:_0x9904c8[_0x1d011f(0x20b)];let _0x3e5008;return _0x36e9c?_0x3e5008=await this[_0x1d011f(0x21a)]['schedule'](_0x4ad45b,_0x9904c8[_0x1d011f(0x1fa)],_0x1355ba):_0x3e5008=await this[_0x1d011f(0x21a)][_0x1d011f(0x20b)](_0x4ad45b,_0x9904c8['jobType'],_0x1355ba,{'startDate':new Date(_0x9904c8[_0x1d011f(0x1e0)]),'endDate':new Date(_0x9904c8['endDate']),'skipImmediate':!![]}),{'jobId':_0x3e5008[_0x1d011f(0x1f5)][_0x1d011f(0x1f9)][_0x1d011f(0x203)]()};}async[a2_0x181b16(0x215)](_0x4b8f8a){const _0x1d3a65=a2_0x181b16,_0x340249=await this[_0x1d3a65(0x21a)][_0x1d3a65(0x1e2)]({'_id':new mongodb_1[(_0x1d3a65(0x208))](_0x4b8f8a)});if(!_0x340249['length'])return{'success':!![],'message':'Job\x20'+_0x4b8f8a+_0x1d3a65(0x1e1)};const _0x382b41=await this[_0x1d3a65(0x21a)]['cancel']({'_id':new mongodb_1[(_0x1d3a65(0x208))](_0x4b8f8a)});job_1[_0x1d3a65(0x1d8)][_0x1d3a65(0x1ed)](_0x4b8f8a);if(_0x382b41)return{'success':!![],'message':'Job\x20'+_0x4b8f8a+_0x1d3a65(0x1e6)};return{'success':![],'message':'Failed\x20to\x20cancel\x20job\x20'+_0x4b8f8a};}async[a2_0x181b16(0x1e7)](_0x30dcfd,_0x1eaf9b){const _0x719453=a2_0x181b16;return await this['cancelJob'](_0x30dcfd),await this[_0x719453(0x1e5)](_0x1eaf9b);}[a2_0x181b16(0x1f0)](_0x1caa0e){const _0x39dc5a=a2_0x181b16;switch(_0x1caa0e['jobType']){case enums_1[_0x39dc5a(0x1f3)][_0x39dc5a(0x1eb)]:{return(0x0,mappers_1['toPlaySoundCommand'])(_0x1caa0e);}case enums_1[_0x39dc5a(0x1f3)]['PlayMusic']:{return(0x0,mappers_1[_0x39dc5a(0x202)])(_0x1caa0e);}case enums_1['JobType'][_0x39dc5a(0x201)]:{return(0x0,voice_mapper_1[_0x39dc5a(0x1e3)])(_0x1caa0e);}case enums_1['JobType']['PlayTextToAudio']:{return(0x0,textToAudio_mapper_1['toPlayTextToAudioCommand'])(_0x1caa0e);}default:throw new common_1[(_0x39dc5a(0x1e4))](_0x39dc5a(0x1fd));}}};__decorate([(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x181b16(0x1db)][a2_0x181b16(0x1dd)]),(0x0,event_emitter_1[a2_0x181b16(0x1ea)])(events_1[a2_0x181b16(0x1db)][a2_0x181b16(0x1da)]),(0x0,event_emitter_1[a2_0x181b16(0x1ea)])(events_1[a2_0x181b16(0x1d9)][a2_0x181b16(0x20a)]),(0x0,event_emitter_1[a2_0x181b16(0x1ea)])(events_1[a2_0x181b16(0x1d9)][a2_0x181b16(0x1dd)]),(0x0,event_emitter_1[a2_0x181b16(0x1ea)])(events_1[a2_0x181b16(0x1d9)][a2_0x181b16(0x1da)]),__metadata(a2_0x181b16(0x1d5),Function),__metadata(a2_0x181b16(0x1f4),[]),__metadata(a2_0x181b16(0x1d4),Promise)],AgendaService[a2_0x181b16(0x204)],a2_0x181b16(0x1f2),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x181b16(0x1ff)])(),__metadata('design:paramtypes',[nestjs_agenda_1[a2_0x181b16(0x1f6)]])],AgendaService),exports['AgendaService']=AgendaService;