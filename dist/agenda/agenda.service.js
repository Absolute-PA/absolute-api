'use strict';const a2_0x35dba2=a2_0x2b0b;(function(_0x22d8c8,_0x2b94dc){const _0xc2e0cd=a2_0x2b0b,_0x55fe5a=_0x22d8c8();while(!![]){try{const _0x445f35=parseInt(_0xc2e0cd(0x147))/0x1*(parseInt(_0xc2e0cd(0x166))/0x2)+-parseInt(_0xc2e0cd(0x168))/0x3*(-parseInt(_0xc2e0cd(0x16d))/0x4)+parseInt(_0xc2e0cd(0x130))/0x5*(-parseInt(_0xc2e0cd(0x171))/0x6)+parseInt(_0xc2e0cd(0x15d))/0x7+parseInt(_0xc2e0cd(0x13a))/0x8*(parseInt(_0xc2e0cd(0x12d))/0x9)+parseInt(_0xc2e0cd(0x156))/0xa*(-parseInt(_0xc2e0cd(0x15a))/0xb)+-parseInt(_0xc2e0cd(0x149))/0xc;if(_0x445f35===_0x2b94dc)break;else _0x55fe5a['push'](_0x55fe5a['shift']());}catch(_0x1a81d7){_0x55fe5a['push'](_0x55fe5a['shift']());}}}(a2_0x338c,0x1dad7));function a2_0x2b0b(_0x5baad9,_0x13e289){const _0x338c14=a2_0x338c();return a2_0x2b0b=function(_0x2b0b93,_0x513c5b){_0x2b0b93=_0x2b0b93-0x12a;let _0x3fa4a1=_0x338c14[_0x2b0b93];return _0x3fa4a1;},a2_0x2b0b(_0x5baad9,_0x13e289);}var __decorate=this&&this[a2_0x35dba2(0x145)]||function(_0x39f0df,_0x556fd4,_0x2dbdee,_0x535804){const _0xe4bc1=a2_0x35dba2;var _0x133fa9=arguments[_0xe4bc1(0x154)],_0x34a341=_0x133fa9<0x3?_0x556fd4:_0x535804===null?_0x535804=Object[_0xe4bc1(0x135)](_0x556fd4,_0x2dbdee):_0x535804,_0x1ff9fe;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x34a341=Reflect[_0xe4bc1(0x14f)](_0x39f0df,_0x556fd4,_0x2dbdee,_0x535804);else{for(var _0x44dd3e=_0x39f0df[_0xe4bc1(0x154)]-0x1;_0x44dd3e>=0x0;_0x44dd3e--)if(_0x1ff9fe=_0x39f0df[_0x44dd3e])_0x34a341=(_0x133fa9<0x3?_0x1ff9fe(_0x34a341):_0x133fa9>0x3?_0x1ff9fe(_0x556fd4,_0x2dbdee,_0x34a341):_0x1ff9fe(_0x556fd4,_0x2dbdee))||_0x34a341;}return _0x133fa9>0x3&&_0x34a341&&Object[_0xe4bc1(0x131)](_0x556fd4,_0x2dbdee,_0x34a341),_0x34a341;},__metadata=this&&this['__metadata']||function(_0x1e49f4,_0x4b83fe){const _0x54297a=a2_0x35dba2;if(typeof Reflect===_0x54297a(0x177)&&typeof Reflect['metadata']===_0x54297a(0x155))return Reflect['metadata'](_0x1e49f4,_0x4b83fe);},AgendaService_1;function a2_0x338c(){const _0x499a59=['Created','36295AKPHmx','defineProperty','when','schedule','Injectable','getOwnPropertyDescriptor','Scheduling\x20events...','cancel','Job\x20','PlayTextToAudio','543544WtCctZ','./dtos','agendaAgent','./mappers/textToAudio.mapper','values','killProcess','@agent-ly/nestjs-agenda','startDate','rescheduleEvents','jobType','\x20not\x20found','__decorate','cancelJob','94frjCap','Logger','17124NcvPNu','0\x200\x20*\x20*\x20*','getJobPayload','../common/enums','PlayMusic','toPlayMusicCommand','decorate','EventChangedEvent','../common/job','./mappers','Failed\x20to\x20cancel\x20job\x20','length','function','390TyvMHh','jobs','Deleted','../common/events','28446EbNGbH','@nestjs/common','design:paramtypes','380870FobQqJ','Updated','PurgeTempUploadedFiles','rescheduleJob','_id','mongodb','toString','AgendaService','every','2644bOetmV','BackgroundJobType','3WPVhVr','PlaySound','toPlaySoundCommand','purge','logger','14572oIDlJP','PROCESS_CACHE','ScheduleChangedEvent','getJobs','78KpjMvg','scheduleJob','JobType','log','OnEvent','attrs','object','isScheduleJobDTO','\x20is\x20cancelled','design:returntype','CheckEvent','now','ObjectId','endDate','18FuWunU','toPlayVoiceCommand'];a2_0x338c=function(){return _0x499a59;};return a2_0x338c();}Object[a2_0x35dba2(0x131)](exports,'__esModule',{'value':!![]}),exports['AgendaService']=void 0x0;const common_1=require(a2_0x35dba2(0x15b)),nestjs_agenda_1=require(a2_0x35dba2(0x140)),event_emitter_1=require('@nestjs/event-emitter'),mongodb_1=require(a2_0x35dba2(0x162)),enums_1=require(a2_0x35dba2(0x14c)),events_1=require(a2_0x35dba2(0x159)),job_1=require(a2_0x35dba2(0x151)),dtos_1=require(a2_0x35dba2(0x13b)),mappers_1=require(a2_0x35dba2(0x152)),voice_mapper_1=require('./mappers/voice.mapper'),textToAudio_mapper_1=require(a2_0x35dba2(0x13d));let AgendaService=AgendaService_1=class AgendaService{constructor(_0x29abbe){const _0x38d427=a2_0x35dba2;this[_0x38d427(0x13c)]=_0x29abbe,this[_0x38d427(0x16c)]=new common_1[(_0x38d427(0x148))](AgendaService_1['name']),this['initialize']();}async['initialize'](){const _0x57882f=a2_0x35dba2;await this[_0x57882f(0x13c)][_0x57882f(0x16b)](),this[_0x57882f(0x13c)][_0x57882f(0x165)](_0x57882f(0x14a),enums_1[_0x57882f(0x167)][_0x57882f(0x17b)]),this[_0x57882f(0x13c)][_0x57882f(0x165)]('0\x200\x20*\x20*\x20*',enums_1[_0x57882f(0x167)][_0x57882f(0x15f)]),this['agendaAgent'][_0x57882f(0x12a)](enums_1[_0x57882f(0x167)][_0x57882f(0x17b)],null);}async[a2_0x35dba2(0x142)](){const _0x37a5a0=a2_0x35dba2;this[_0x37a5a0(0x16c)][_0x37a5a0(0x174)](_0x37a5a0(0x136)),await this[_0x37a5a0(0x13c)][_0x37a5a0(0x137)]({'name':{'$in':Object[_0x37a5a0(0x13e)](enums_1[_0x37a5a0(0x173)])}}),this[_0x37a5a0(0x13c)][_0x37a5a0(0x12a)](enums_1[_0x37a5a0(0x167)][_0x37a5a0(0x17b)],null);}async[a2_0x35dba2(0x170)](){const _0x462681=a2_0x35dba2,_0x51b67f=await this[_0x462681(0x13c)][_0x462681(0x157)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x51b67f;}async[a2_0x35dba2(0x172)](_0x124fe2){const _0x2a82e7=a2_0x35dba2,_0x2586db=this[_0x2a82e7(0x14b)](_0x124fe2),_0x177290=(0x0,dtos_1[_0x2a82e7(0x178)])(_0x124fe2),_0x590a2e=_0x177290?_0x124fe2[_0x2a82e7(0x132)]:_0x124fe2[_0x2a82e7(0x165)];let _0x4f7f14;return _0x177290?_0x4f7f14=await this['agendaAgent'][_0x2a82e7(0x133)](_0x590a2e,_0x124fe2['jobType'],_0x2586db):_0x4f7f14=await this[_0x2a82e7(0x13c)][_0x2a82e7(0x165)](_0x590a2e,_0x124fe2['jobType'],_0x2586db,{'startDate':new Date(_0x124fe2[_0x2a82e7(0x141)]),'endDate':new Date(_0x124fe2[_0x2a82e7(0x12c)]),'skipImmediate':!![]}),{'jobId':_0x4f7f14[_0x2a82e7(0x176)][_0x2a82e7(0x161)][_0x2a82e7(0x163)]()};}async['cancelJob'](_0x3f731d){const _0xfe2314=a2_0x35dba2,_0x5901f7=await this[_0xfe2314(0x13c)][_0xfe2314(0x157)]({'_id':new mongodb_1['ObjectId'](_0x3f731d)});if(!_0x5901f7[_0xfe2314(0x154)])return{'success':!![],'message':'Job\x20'+_0x3f731d+_0xfe2314(0x144)};const _0xa51acf=await this['agendaAgent'][_0xfe2314(0x137)]({'_id':new mongodb_1[(_0xfe2314(0x12b))](_0x3f731d)});job_1[_0xfe2314(0x16e)][_0xfe2314(0x13f)](_0x3f731d);if(_0xa51acf)return{'success':!![],'message':_0xfe2314(0x138)+_0x3f731d+_0xfe2314(0x179)};return{'success':![],'message':_0xfe2314(0x153)+_0x3f731d};}async[a2_0x35dba2(0x160)](_0x2be427,_0x7427aa){const _0x3e1b0b=a2_0x35dba2;return await this[_0x3e1b0b(0x146)](_0x2be427),await this['scheduleJob'](_0x7427aa);}['getJobPayload'](_0x46ea7a){const _0x23babd=a2_0x35dba2;switch(_0x46ea7a[_0x23babd(0x143)]){case enums_1[_0x23babd(0x173)][_0x23babd(0x169)]:{return(0x0,mappers_1[_0x23babd(0x16a)])(_0x46ea7a);}case enums_1[_0x23babd(0x173)][_0x23babd(0x14d)]:{return(0x0,mappers_1[_0x23babd(0x14e)])(_0x46ea7a);}case enums_1['JobType']['PlayVoiceRecorded']:{return(0x0,voice_mapper_1[_0x23babd(0x12e)])(_0x46ea7a);}case enums_1[_0x23babd(0x173)][_0x23babd(0x139)]:{return(0x0,textToAudio_mapper_1['toPlayTextToAudioCommand'])(_0x46ea7a);}default:throw new common_1['NotFoundException']('Job\x20type\x20not\x20found');}}};__decorate([(0x0,event_emitter_1[a2_0x35dba2(0x175)])(events_1[a2_0x35dba2(0x16f)][a2_0x35dba2(0x15e)]),(0x0,event_emitter_1[a2_0x35dba2(0x175)])(events_1['ScheduleChangedEvent'][a2_0x35dba2(0x158)]),(0x0,event_emitter_1[a2_0x35dba2(0x175)])(events_1['EventChangedEvent'][a2_0x35dba2(0x12f)]),(0x0,event_emitter_1[a2_0x35dba2(0x175)])(events_1[a2_0x35dba2(0x150)][a2_0x35dba2(0x15e)]),(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x35dba2(0x150)][a2_0x35dba2(0x158)]),__metadata('design:type',Function),__metadata('design:paramtypes',[]),__metadata(a2_0x35dba2(0x17a),Promise)],AgendaService['prototype'],a2_0x35dba2(0x142),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x35dba2(0x134)])(),__metadata(a2_0x35dba2(0x15c),[nestjs_agenda_1[a2_0x35dba2(0x164)]])],AgendaService),exports[a2_0x35dba2(0x164)]=AgendaService;