'use strict';const a2_0x58dc4c=a2_0x3cd1;(function(_0x55de47,_0xb61686){const _0x47cb5c=a2_0x3cd1,_0x4d7e7a=_0x55de47();while(!![]){try{const _0x54dac1=-parseInt(_0x47cb5c(0x16d))/0x1+-parseInt(_0x47cb5c(0x1b3))/0x2+-parseInt(_0x47cb5c(0x1b0))/0x3*(-parseInt(_0x47cb5c(0x16f))/0x4)+-parseInt(_0x47cb5c(0x1b1))/0x5*(parseInt(_0x47cb5c(0x1a1))/0x6)+-parseInt(_0x47cb5c(0x1a6))/0x7+parseInt(_0x47cb5c(0x1ae))/0x8+parseInt(_0x47cb5c(0x172))/0x9;if(_0x54dac1===_0xb61686)break;else _0x4d7e7a['push'](_0x4d7e7a['shift']());}catch(_0x541258){_0x4d7e7a['push'](_0x4d7e7a['shift']());}}}(a2_0x3c59,0x424de));var __decorate=this&&this['__decorate']||function(_0x17a965,_0x256d15,_0x4aeb34,_0x26297c){const _0x5a1930=a2_0x3cd1;var _0x52ca4f=arguments[_0x5a1930(0x178)],_0x3f5596=_0x52ca4f<0x3?_0x256d15:_0x26297c===null?_0x26297c=Object[_0x5a1930(0x1a0)](_0x256d15,_0x4aeb34):_0x26297c,_0x5d3b18;if(typeof Reflect===_0x5a1930(0x176)&&typeof Reflect[_0x5a1930(0x18a)]===_0x5a1930(0x18d))_0x3f5596=Reflect[_0x5a1930(0x18a)](_0x17a965,_0x256d15,_0x4aeb34,_0x26297c);else{for(var _0x923f4c=_0x17a965[_0x5a1930(0x178)]-0x1;_0x923f4c>=0x0;_0x923f4c--)if(_0x5d3b18=_0x17a965[_0x923f4c])_0x3f5596=(_0x52ca4f<0x3?_0x5d3b18(_0x3f5596):_0x52ca4f>0x3?_0x5d3b18(_0x256d15,_0x4aeb34,_0x3f5596):_0x5d3b18(_0x256d15,_0x4aeb34))||_0x3f5596;}return _0x52ca4f>0x3&&_0x3f5596&&Object[_0x5a1930(0x1b2)](_0x256d15,_0x4aeb34,_0x3f5596),_0x3f5596;},__metadata=this&&this[a2_0x58dc4c(0x16b)]||function(_0x1844de,_0x199211){const _0xea6991=a2_0x58dc4c;if(typeof Reflect===_0xea6991(0x176)&&typeof Reflect[_0xea6991(0x186)]===_0xea6991(0x18d))return Reflect[_0xea6991(0x186)](_0x1844de,_0x199211);},AgendaService_1;Object[a2_0x58dc4c(0x1b2)](exports,a2_0x58dc4c(0x1ad),{'value':!![]}),exports[a2_0x58dc4c(0x192)]=void 0x0;function a2_0x3cd1(_0x2e9687,_0x4f1392){const _0x3c597c=a2_0x3c59();return a2_0x3cd1=function(_0x3cd1b0,_0x3b61f0){_0x3cd1b0=_0x3cd1b0-0x168;let _0x4049a0=_0x3c597c[_0x3cd1b0];return _0x4049a0;},a2_0x3cd1(_0x2e9687,_0x4f1392);}function a2_0x3c59(){const _0xf8649a=['12159801nUWliE','EventChangedEvent','./mappers','PurgeTempUploadedFiles','object','Scheduling\x20events...','length','purge','logger','Job\x20','killProcess','cancelJob','PROCESS_CACHE','ObjectId','_id','./mappers/textToAudio.mapper','schedule','getJobPayload','0\x200\x20*\x20*\x20*','getJobs','metadata','PlaySound','Deleted','../common/events','decorate','BackgroundJobType','NotFoundException','function','PlayTextToAudio','ScheduleChangedEvent','isScheduleJobDTO','\x20not\x20found','AgendaService','rescheduleJob','JobType','CheckEvent','toPlayMusicCommand','cancel','every','jobs','design:type','PlayMusic','scheduleJob','toPlayTextToAudioCommand','design:returntype','initialize','getOwnPropertyDescriptor','12oOFqWy','now','Failed\x20to\x20cancel\x20job\x20','values','./dtos','1197329hpKZtg','@agent-ly/nestjs-agenda','startDate','Updated','PlayVoiceRecorded','Injectable','Job\x20type\x20not\x20found','__esModule','743368vomwxO','attrs','111wATCuq','1000780WsBAKh','defineProperty','637770wSQWLS','\x20is\x20cancelled','Created','design:paramtypes','__metadata','toString','316039sQCocm','OnEvent','3660yrLmjK','../common/job','agendaAgent'];a2_0x3c59=function(){return _0xf8649a;};return a2_0x3c59();}const common_1=require('@nestjs/common'),nestjs_agenda_1=require(a2_0x58dc4c(0x1a7)),event_emitter_1=require('@nestjs/event-emitter'),mongodb_1=require('mongodb'),enums_1=require('../common/enums'),events_1=require(a2_0x58dc4c(0x189)),job_1=require(a2_0x58dc4c(0x170)),dtos_1=require(a2_0x58dc4c(0x1a5)),mappers_1=require(a2_0x58dc4c(0x174)),voice_mapper_1=require('./mappers/voice.mapper'),textToAudio_mapper_1=require(a2_0x58dc4c(0x181));let AgendaService=AgendaService_1=class AgendaService{constructor(_0x34908b){const _0x53e3c6=a2_0x58dc4c;this[_0x53e3c6(0x171)]=_0x34908b,this[_0x53e3c6(0x17a)]=new common_1['Logger'](AgendaService_1['name']),this['initialize']();}async[a2_0x58dc4c(0x19f)](){const _0x27b5d3=a2_0x58dc4c;await this[_0x27b5d3(0x171)][_0x27b5d3(0x179)](),this['agendaAgent'][_0x27b5d3(0x198)](_0x27b5d3(0x184),enums_1['BackgroundJobType'][_0x27b5d3(0x195)]),this['agendaAgent']['every'](_0x27b5d3(0x184),enums_1['BackgroundJobType'][_0x27b5d3(0x175)]),this[_0x27b5d3(0x171)][_0x27b5d3(0x1a2)](enums_1['BackgroundJobType'][_0x27b5d3(0x195)],null);}async['rescheduleEvents'](){const _0x132b4a=a2_0x58dc4c;this['logger']['log'](_0x132b4a(0x177)),await this[_0x132b4a(0x171)][_0x132b4a(0x197)]({'name':{'$in':Object[_0x132b4a(0x1a4)](enums_1[_0x132b4a(0x194)])}}),this[_0x132b4a(0x171)][_0x132b4a(0x1a2)](enums_1[_0x132b4a(0x18b)][_0x132b4a(0x195)],null);}async[a2_0x58dc4c(0x185)](){const _0x419111=a2_0x58dc4c,_0x3e103c=await this[_0x419111(0x171)][_0x419111(0x199)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x3e103c;}async[a2_0x58dc4c(0x19c)](_0x3e7627){const _0x644821=a2_0x58dc4c,_0x2a16d6=this[_0x644821(0x183)](_0x3e7627),_0x553f10=(0x0,dtos_1[_0x644821(0x190)])(_0x3e7627),_0x11462a=_0x553f10?_0x3e7627['when']:_0x3e7627[_0x644821(0x198)];let _0x3bb56f;return _0x553f10?_0x3bb56f=await this[_0x644821(0x171)][_0x644821(0x182)](_0x11462a,_0x3e7627['jobType'],_0x2a16d6):_0x3bb56f=await this[_0x644821(0x171)][_0x644821(0x198)](_0x11462a,_0x3e7627['jobType'],_0x2a16d6,{'startDate':new Date(_0x3e7627[_0x644821(0x1a8)]),'endDate':new Date(_0x3e7627['endDate']),'skipImmediate':!![]}),{'jobId':_0x3bb56f[_0x644821(0x1af)][_0x644821(0x180)][_0x644821(0x16c)]()};}async[a2_0x58dc4c(0x17d)](_0x3b98e6){const _0x55c956=a2_0x58dc4c,_0x2460c6=await this[_0x55c956(0x171)][_0x55c956(0x199)]({'_id':new mongodb_1[(_0x55c956(0x17f))](_0x3b98e6)});if(!_0x2460c6['length'])return{'success':!![],'message':_0x55c956(0x17b)+_0x3b98e6+_0x55c956(0x191)};const _0x4daefc=await this[_0x55c956(0x171)][_0x55c956(0x197)]({'_id':new mongodb_1['ObjectId'](_0x3b98e6)});job_1[_0x55c956(0x17e)][_0x55c956(0x17c)](_0x3b98e6);if(_0x4daefc)return{'success':!![],'message':_0x55c956(0x17b)+_0x3b98e6+_0x55c956(0x168)};return{'success':![],'message':_0x55c956(0x1a3)+_0x3b98e6};}async[a2_0x58dc4c(0x193)](_0x4e093a,_0x1e5c20){const _0x212069=a2_0x58dc4c;return await this[_0x212069(0x17d)](_0x4e093a),await this[_0x212069(0x19c)](_0x1e5c20);}['getJobPayload'](_0x8e90c9){const _0x181158=a2_0x58dc4c;switch(_0x8e90c9['jobType']){case enums_1[_0x181158(0x194)][_0x181158(0x187)]:{return(0x0,mappers_1['toPlaySoundCommand'])(_0x8e90c9);}case enums_1[_0x181158(0x194)][_0x181158(0x19b)]:{return(0x0,mappers_1[_0x181158(0x196)])(_0x8e90c9);}case enums_1[_0x181158(0x194)][_0x181158(0x1aa)]:{return(0x0,voice_mapper_1['toPlayVoiceCommand'])(_0x8e90c9);}case enums_1['JobType'][_0x181158(0x18e)]:{return(0x0,textToAudio_mapper_1[_0x181158(0x19d)])(_0x8e90c9);}default:throw new common_1[(_0x181158(0x18c))](_0x181158(0x1ac));}}};__decorate([(0x0,event_emitter_1[a2_0x58dc4c(0x16e)])(events_1[a2_0x58dc4c(0x18f)][a2_0x58dc4c(0x1a9)]),(0x0,event_emitter_1[a2_0x58dc4c(0x16e)])(events_1[a2_0x58dc4c(0x18f)]['Deleted']),(0x0,event_emitter_1[a2_0x58dc4c(0x16e)])(events_1[a2_0x58dc4c(0x173)][a2_0x58dc4c(0x169)]),(0x0,event_emitter_1[a2_0x58dc4c(0x16e)])(events_1[a2_0x58dc4c(0x173)][a2_0x58dc4c(0x1a9)]),(0x0,event_emitter_1[a2_0x58dc4c(0x16e)])(events_1['EventChangedEvent'][a2_0x58dc4c(0x188)]),__metadata(a2_0x58dc4c(0x19a),Function),__metadata(a2_0x58dc4c(0x16a),[]),__metadata(a2_0x58dc4c(0x19e),Promise)],AgendaService['prototype'],'rescheduleEvents',null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x58dc4c(0x1ab)])(),__metadata('design:paramtypes',[nestjs_agenda_1[a2_0x58dc4c(0x192)]])],AgendaService),exports['AgendaService']=AgendaService;