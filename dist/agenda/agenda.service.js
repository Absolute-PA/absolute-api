'use strict';function a2_0x40bd(){const _0x36bc0e=['getOwnPropertyDescriptor','@nestjs/event-emitter','15392493MSfHgx','values','\x20not\x20found','design:returntype','./dtos','design:paramtypes','every','PlayTextToAudio','OnEvent','toPlayMusicCommand','11688173VAWEBA','\x20is\x20cancelled','cancel','cancelJob','mongodb','length','toString','name','Deleted','@nestjs/common','object','CheckEvent','rescheduleJob','toPlayTextToAudioCommand','125jCnDeM','AgendaService','8FNqcEc','decorate','Scheduling\x20events...','7670670zvSbwO','PROCESS_CACHE','__esModule','defineProperty','ObjectId','./mappers/voice.mapper','./mappers','EventChangedEvent','5062689dINErk','JobType','prototype','scheduleJob','../common/events','jobType','../common/job','attrs','startDate','Created','function','agendaAgent','1132491iHUELq','Failed\x20to\x20cancel\x20job\x20','34492vhqnTT','metadata','now','initialize','BackgroundJobType','purge','rescheduleEvents','Updated','getJobs','logger','892478uHgYFV','Job\x20type\x20not\x20found','getJobPayload','_id','@agent-ly/nestjs-agenda','log','killProcess','0\x200\x20*\x20*\x20*','../common/enums','Logger','Job\x20','./mappers/textToAudio.mapper','Injectable','schedule','__decorate','endDate','design:type'];a2_0x40bd=function(){return _0x36bc0e;};return a2_0x40bd();}const a2_0x2f541d=a2_0x1289;(function(_0x5a36a0,_0xed92fe){const _0x1bff55=a2_0x1289,_0x4aa221=_0x5a36a0();while(!![]){try{const _0x44c63a=parseInt(_0x1bff55(0x92))/0x1+parseInt(_0x1bff55(0x9e))/0x2+-parseInt(_0x1bff55(0xd6))/0x3+-parseInt(_0x1bff55(0x94))/0x4*(parseInt(_0x1bff55(0xc9))/0x5)+parseInt(_0x1bff55(0xce))/0x6+parseInt(_0x1bff55(0xbb))/0x7+-parseInt(_0x1bff55(0xcb))/0x8*(parseInt(_0x1bff55(0xb1))/0x9);if(_0x44c63a===_0xed92fe)break;else _0x4aa221['push'](_0x4aa221['shift']());}catch(_0x400532){_0x4aa221['push'](_0x4aa221['shift']());}}}(a2_0x40bd,0xdf05b));var __decorate=this&&this[a2_0x2f541d(0xac)]||function(_0x31da12,_0x58eecb,_0x283ef8,_0xf84e05){const _0x570f96=a2_0x2f541d;var _0x3deaff=arguments[_0x570f96(0xc0)],_0x5892b6=_0x3deaff<0x3?_0x58eecb:_0xf84e05===null?_0xf84e05=Object[_0x570f96(0xaf)](_0x58eecb,_0x283ef8):_0xf84e05,_0x2377b4;if(typeof Reflect===_0x570f96(0xc5)&&typeof Reflect[_0x570f96(0xcc)]===_0x570f96(0x90))_0x5892b6=Reflect[_0x570f96(0xcc)](_0x31da12,_0x58eecb,_0x283ef8,_0xf84e05);else{for(var _0x6b29e8=_0x31da12[_0x570f96(0xc0)]-0x1;_0x6b29e8>=0x0;_0x6b29e8--)if(_0x2377b4=_0x31da12[_0x6b29e8])_0x5892b6=(_0x3deaff<0x3?_0x2377b4(_0x5892b6):_0x3deaff>0x3?_0x2377b4(_0x58eecb,_0x283ef8,_0x5892b6):_0x2377b4(_0x58eecb,_0x283ef8))||_0x5892b6;}return _0x3deaff>0x3&&_0x5892b6&&Object['defineProperty'](_0x58eecb,_0x283ef8,_0x5892b6),_0x5892b6;},__metadata=this&&this['__metadata']||function(_0x2eb2bc,_0x29d0d1){const _0x22f919=a2_0x2f541d;if(typeof Reflect===_0x22f919(0xc5)&&typeof Reflect[_0x22f919(0x95)]==='function')return Reflect[_0x22f919(0x95)](_0x2eb2bc,_0x29d0d1);},AgendaService_1;Object[a2_0x2f541d(0xd1)](exports,a2_0x2f541d(0xd0),{'value':!![]}),exports[a2_0x2f541d(0xca)]=void 0x0;function a2_0x1289(_0x526b45,_0x29df38){const _0x40bd09=a2_0x40bd();return a2_0x1289=function(_0x128938,_0x436145){_0x128938=_0x128938-0x88;let _0xbbbfec=_0x40bd09[_0x128938];return _0xbbbfec;},a2_0x1289(_0x526b45,_0x29df38);}const common_1=require(a2_0x2f541d(0xc4)),nestjs_agenda_1=require(a2_0x2f541d(0xa2)),event_emitter_1=require(a2_0x2f541d(0xb0)),mongodb_1=require(a2_0x2f541d(0xbf)),enums_1=require(a2_0x2f541d(0xa6)),events_1=require(a2_0x2f541d(0x8a)),job_1=require(a2_0x2f541d(0x8c)),dtos_1=require(a2_0x2f541d(0xb5)),mappers_1=require(a2_0x2f541d(0xd4)),voice_mapper_1=require(a2_0x2f541d(0xd3)),textToAudio_mapper_1=require(a2_0x2f541d(0xa9));let AgendaService=AgendaService_1=class AgendaService{constructor(_0xaf7032){const _0x31938d=a2_0x2f541d;this[_0x31938d(0x91)]=_0xaf7032,this[_0x31938d(0x9d)]=new common_1[(_0x31938d(0xa7))](AgendaService_1[_0x31938d(0xc2)]),this[_0x31938d(0x97)]();}async['initialize'](){const _0x50d89f=a2_0x2f541d;await this[_0x50d89f(0x91)][_0x50d89f(0x99)](),this[_0x50d89f(0x91)][_0x50d89f(0xb7)](_0x50d89f(0xa5),enums_1[_0x50d89f(0x98)][_0x50d89f(0xc6)]),this[_0x50d89f(0x91)][_0x50d89f(0xb7)](_0x50d89f(0xa5),enums_1[_0x50d89f(0x98)]['PurgeTempUploadedFiles']),this[_0x50d89f(0x91)][_0x50d89f(0x96)](enums_1['BackgroundJobType'][_0x50d89f(0xc6)],null);}async[a2_0x2f541d(0x9a)](){const _0x1f6f38=a2_0x2f541d;this[_0x1f6f38(0x9d)][_0x1f6f38(0xa3)](_0x1f6f38(0xcd)),await this[_0x1f6f38(0x91)][_0x1f6f38(0xbd)]({'name':{'$in':Object[_0x1f6f38(0xb2)](enums_1['JobType'])}}),this[_0x1f6f38(0x91)]['now'](enums_1[_0x1f6f38(0x98)][_0x1f6f38(0xc6)],null);}async[a2_0x2f541d(0x9c)](){const _0x815821=a2_0x2f541d,_0x43d424=await this[_0x815821(0x91)]['jobs']({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x43d424;}async[a2_0x2f541d(0x89)](_0x582e89){const _0x35556e=a2_0x2f541d,_0x8df18e=this[_0x35556e(0xa0)](_0x582e89),_0x28c6f3=(0x0,dtos_1['isScheduleJobDTO'])(_0x582e89),_0x5d562d=_0x28c6f3?_0x582e89['when']:_0x582e89['every'];let _0x2cbf60;return _0x28c6f3?_0x2cbf60=await this[_0x35556e(0x91)][_0x35556e(0xab)](_0x5d562d,_0x582e89['jobType'],_0x8df18e):_0x2cbf60=await this[_0x35556e(0x91)][_0x35556e(0xb7)](_0x5d562d,_0x582e89[_0x35556e(0x8b)],_0x8df18e,{'startDate':new Date(_0x582e89[_0x35556e(0x8e)]),'endDate':new Date(_0x582e89[_0x35556e(0xad)]),'skipImmediate':!![]}),{'jobId':_0x2cbf60[_0x35556e(0x8d)][_0x35556e(0xa1)][_0x35556e(0xc1)]()};}async[a2_0x2f541d(0xbe)](_0x1a3fd5){const _0x1d00e2=a2_0x2f541d,_0x57435f=await this[_0x1d00e2(0x91)]['jobs']({'_id':new mongodb_1[(_0x1d00e2(0xd2))](_0x1a3fd5)});if(!_0x57435f[_0x1d00e2(0xc0)])return{'success':!![],'message':_0x1d00e2(0xa8)+_0x1a3fd5+_0x1d00e2(0xb3)};const _0x5254d2=await this[_0x1d00e2(0x91)][_0x1d00e2(0xbd)]({'_id':new mongodb_1[(_0x1d00e2(0xd2))](_0x1a3fd5)});job_1[_0x1d00e2(0xcf)][_0x1d00e2(0xa4)](_0x1a3fd5);if(_0x5254d2)return{'success':!![],'message':_0x1d00e2(0xa8)+_0x1a3fd5+_0x1d00e2(0xbc)};return{'success':![],'message':_0x1d00e2(0x93)+_0x1a3fd5};}async[a2_0x2f541d(0xc7)](_0x457db9,_0x5ea6ba){const _0x19dcaf=a2_0x2f541d;return await this['cancelJob'](_0x457db9),await this[_0x19dcaf(0x89)](_0x5ea6ba);}['getJobPayload'](_0x58d181){const _0x5085f4=a2_0x2f541d;switch(_0x58d181[_0x5085f4(0x8b)]){case enums_1[_0x5085f4(0xd7)]['PlaySound']:{return(0x0,mappers_1['toPlaySoundCommand'])(_0x58d181);}case enums_1[_0x5085f4(0xd7)]['PlayMusic']:{return(0x0,mappers_1[_0x5085f4(0xba)])(_0x58d181);}case enums_1[_0x5085f4(0xd7)]['PlayVoiceRecorded']:{return(0x0,voice_mapper_1['toPlayVoiceCommand'])(_0x58d181);}case enums_1[_0x5085f4(0xd7)][_0x5085f4(0xb8)]:{return(0x0,textToAudio_mapper_1[_0x5085f4(0xc8)])(_0x58d181);}default:throw new common_1['NotFoundException'](_0x5085f4(0x9f));}}};__decorate([(0x0,event_emitter_1[a2_0x2f541d(0xb9)])(events_1['ScheduleChangedEvent']['Updated']),(0x0,event_emitter_1[a2_0x2f541d(0xb9)])(events_1['ScheduleChangedEvent'][a2_0x2f541d(0xc3)]),(0x0,event_emitter_1[a2_0x2f541d(0xb9)])(events_1[a2_0x2f541d(0xd5)][a2_0x2f541d(0x8f)]),(0x0,event_emitter_1[a2_0x2f541d(0xb9)])(events_1['EventChangedEvent'][a2_0x2f541d(0x9b)]),(0x0,event_emitter_1[a2_0x2f541d(0xb9)])(events_1[a2_0x2f541d(0xd5)]['Deleted']),__metadata(a2_0x2f541d(0xae),Function),__metadata(a2_0x2f541d(0xb6),[]),__metadata(a2_0x2f541d(0xb4),Promise)],AgendaService[a2_0x2f541d(0x88)],'rescheduleEvents',null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x2f541d(0xaa)])(),__metadata(a2_0x2f541d(0xb6),[nestjs_agenda_1[a2_0x2f541d(0xca)]])],AgendaService),exports[a2_0x2f541d(0xca)]=AgendaService;