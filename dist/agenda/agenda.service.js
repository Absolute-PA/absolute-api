'use strict';const a2_0x23f8a7=a2_0x5a48;function a2_0x442c(){const _0x141be2=['3012xMTKpx','1458922ppvlkM','Created','function','3210160ASpXgy','AgendaService','4545IDknJm','startDate','__esModule','defineProperty','./mappers/textToAudio.mapper','cancel','__decorate','metadata','ScheduleChangedEvent','PlaySound','./mappers','jobType','\x20not\x20found','design:type','0\x200\x20*\x20*\x20*','OnEvent','getJobPayload','toString','ObjectId','./dtos','decorate','rescheduleEvents','logger','@nestjs/common','2802IoCOiI','toPlaySoundCommand','6950300dIEMSo','@nestjs/event-emitter','PlayTextToAudio','object','861zQdVEX','Scheduling\x20events...','rescheduleJob','design:returntype','initialize','1COvKbW','name','_id','agendaAgent','scheduleJob','PlayVoiceRecorded','4765hZRVFW','killProcess','../common/job','PlayMusic','getOwnPropertyDescriptor','10jjUhUT','./mappers/voice.mapper','Updated','purge','toPlayTextToAudioCommand','EventChangedEvent','1247796azVSsm','design:paramtypes','endDate','now','Job\x20type\x20not\x20found','when','CheckEvent','187WHQyXr','toPlayVoiceCommand','JobType','attrs','Deleted','Job\x20','../common/enums','every','length','Failed\x20to\x20cancel\x20job\x20','@agent-ly/nestjs-agenda','values','BackgroundJobType','Injectable','schedule','Logger'];a2_0x442c=function(){return _0x141be2;};return a2_0x442c();}(function(_0x36bd69,_0xb34b1d){const _0x5bd6f6=a2_0x5a48,_0x2ce64c=_0x36bd69();while(!![]){try{const _0x34dc31=parseInt(_0x5bd6f6(0x106))/0x1*(parseInt(_0x5bd6f6(0xde))/0x2)+-parseInt(_0x5bd6f6(0x101))/0x3*(parseInt(_0x5bd6f6(0xdd))/0x4)+parseInt(_0x5bd6f6(0x10c))/0x5*(parseInt(_0x5bd6f6(0xfb))/0x6)+parseInt(_0x5bd6f6(0xfd))/0x7+parseInt(_0x5bd6f6(0xe1))/0x8+-parseInt(_0x5bd6f6(0xe3))/0x9*(-parseInt(_0x5bd6f6(0x111))/0xa)+-parseInt(_0x5bd6f6(0x11e))/0xb*(parseInt(_0x5bd6f6(0x117))/0xc);if(_0x34dc31===_0xb34b1d)break;else _0x2ce64c['push'](_0x2ce64c['shift']());}catch(_0x5ca7f6){_0x2ce64c['push'](_0x2ce64c['shift']());}}}(a2_0x442c,0x8ee95));function a2_0x5a48(_0x933c83,_0x22dda6){const _0x442c7f=a2_0x442c();return a2_0x5a48=function(_0x5a48fd,_0x1a9ef4){_0x5a48fd=_0x5a48fd-0xd7;let _0x3aec19=_0x442c7f[_0x5a48fd];return _0x3aec19;},a2_0x5a48(_0x933c83,_0x22dda6);}var __decorate=this&&this[a2_0x23f8a7(0xe9)]||function(_0x6b57fe,_0x19e4ed,_0x72585c,_0x11c4d9){const _0x34b102=a2_0x23f8a7;var _0x2298f4=arguments[_0x34b102(0x126)],_0x42e9fd=_0x2298f4<0x3?_0x19e4ed:_0x11c4d9===null?_0x11c4d9=Object[_0x34b102(0x110)](_0x19e4ed,_0x72585c):_0x11c4d9,_0x5296da;if(typeof Reflect===_0x34b102(0x100)&&typeof Reflect[_0x34b102(0xf7)]===_0x34b102(0xe0))_0x42e9fd=Reflect['decorate'](_0x6b57fe,_0x19e4ed,_0x72585c,_0x11c4d9);else{for(var _0x30dff1=_0x6b57fe[_0x34b102(0x126)]-0x1;_0x30dff1>=0x0;_0x30dff1--)if(_0x5296da=_0x6b57fe[_0x30dff1])_0x42e9fd=(_0x2298f4<0x3?_0x5296da(_0x42e9fd):_0x2298f4>0x3?_0x5296da(_0x19e4ed,_0x72585c,_0x42e9fd):_0x5296da(_0x19e4ed,_0x72585c))||_0x42e9fd;}return _0x2298f4>0x3&&_0x42e9fd&&Object[_0x34b102(0xe6)](_0x19e4ed,_0x72585c,_0x42e9fd),_0x42e9fd;},__metadata=this&&this['__metadata']||function(_0x30c43e,_0x173c5f){const _0x1e8387=a2_0x23f8a7;if(typeof Reflect===_0x1e8387(0x100)&&typeof Reflect[_0x1e8387(0xea)]==='function')return Reflect[_0x1e8387(0xea)](_0x30c43e,_0x173c5f);},AgendaService_1;Object[a2_0x23f8a7(0xe6)](exports,a2_0x23f8a7(0xe5),{'value':!![]}),exports[a2_0x23f8a7(0xe2)]=void 0x0;const common_1=require(a2_0x23f8a7(0xfa)),nestjs_agenda_1=require(a2_0x23f8a7(0xd7)),event_emitter_1=require(a2_0x23f8a7(0xfe)),mongodb_1=require('mongodb'),enums_1=require(a2_0x23f8a7(0x124)),events_1=require('../common/events'),job_1=require(a2_0x23f8a7(0x10e)),dtos_1=require(a2_0x23f8a7(0xf6)),mappers_1=require(a2_0x23f8a7(0xed)),voice_mapper_1=require(a2_0x23f8a7(0x112)),textToAudio_mapper_1=require(a2_0x23f8a7(0xe7));let AgendaService=AgendaService_1=class AgendaService{constructor(_0x57814f){const _0x2d122b=a2_0x23f8a7;this['agendaAgent']=_0x57814f,this['logger']=new common_1[(_0x2d122b(0xdc))](AgendaService_1[_0x2d122b(0x107)]),this[_0x2d122b(0x105)]();}async[a2_0x23f8a7(0x105)](){const _0x4007e8=a2_0x23f8a7;await this[_0x4007e8(0x109)][_0x4007e8(0x114)](),this['agendaAgent']['every'](_0x4007e8(0xf1),enums_1[_0x4007e8(0xd9)]['CheckEvent']),this[_0x4007e8(0x109)]['every'](_0x4007e8(0xf1),enums_1[_0x4007e8(0xd9)]['PurgeTempUploadedFiles']),this[_0x4007e8(0x109)][_0x4007e8(0x11a)](enums_1[_0x4007e8(0xd9)][_0x4007e8(0x11d)],null);}async[a2_0x23f8a7(0xf8)](){const _0x5607a8=a2_0x23f8a7;this[_0x5607a8(0xf9)]['log'](_0x5607a8(0x102)),await this[_0x5607a8(0x109)][_0x5607a8(0xe8)]({'name':{'$in':Object[_0x5607a8(0xd8)](enums_1[_0x5607a8(0x120)])}}),this[_0x5607a8(0x109)][_0x5607a8(0x11a)](enums_1[_0x5607a8(0xd9)]['CheckEvent'],null);}async['getJobs'](){const _0x42d114=await this['agendaAgent']['jobs']({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x42d114;}async[a2_0x23f8a7(0x10a)](_0x330d72){const _0x1824fb=a2_0x23f8a7,_0x2d0f6e=this[_0x1824fb(0xf3)](_0x330d72),_0x35551a=(0x0,dtos_1['isScheduleJobDTO'])(_0x330d72),_0x453d35=_0x35551a?_0x330d72[_0x1824fb(0x11c)]:_0x330d72[_0x1824fb(0x125)];let _0x538758;return _0x35551a?_0x538758=await this[_0x1824fb(0x109)][_0x1824fb(0xdb)](_0x453d35,_0x330d72[_0x1824fb(0xee)],_0x2d0f6e):_0x538758=await this[_0x1824fb(0x109)][_0x1824fb(0x125)](_0x453d35,_0x330d72[_0x1824fb(0xee)],_0x2d0f6e,{'startDate':new Date(_0x330d72[_0x1824fb(0xe4)]),'endDate':new Date(_0x330d72[_0x1824fb(0x119)]),'skipImmediate':!![]}),{'jobId':_0x538758[_0x1824fb(0x121)][_0x1824fb(0x108)][_0x1824fb(0xf4)]()};}async['cancelJob'](_0x2cd7c7){const _0x103179=a2_0x23f8a7,_0x1e26f6=await this['agendaAgent']['jobs']({'_id':new mongodb_1[(_0x103179(0xf5))](_0x2cd7c7)});if(!_0x1e26f6[_0x103179(0x126)])return{'success':!![],'message':'Job\x20'+_0x2cd7c7+_0x103179(0xef)};const _0x31c077=await this[_0x103179(0x109)][_0x103179(0xe8)]({'_id':new mongodb_1['ObjectId'](_0x2cd7c7)});job_1['PROCESS_CACHE'][_0x103179(0x10d)](_0x2cd7c7);if(_0x31c077)return{'success':!![],'message':_0x103179(0x123)+_0x2cd7c7+'\x20is\x20cancelled'};return{'success':![],'message':_0x103179(0x127)+_0x2cd7c7};}async[a2_0x23f8a7(0x103)](_0x50b92f,_0x360fbb){const _0x43852c=a2_0x23f8a7;return await this['cancelJob'](_0x50b92f),await this[_0x43852c(0x10a)](_0x360fbb);}[a2_0x23f8a7(0xf3)](_0x4708e0){const _0x16c6ee=a2_0x23f8a7;switch(_0x4708e0[_0x16c6ee(0xee)]){case enums_1['JobType'][_0x16c6ee(0xec)]:{return(0x0,mappers_1[_0x16c6ee(0xfc)])(_0x4708e0);}case enums_1['JobType'][_0x16c6ee(0x10f)]:{return(0x0,mappers_1['toPlayMusicCommand'])(_0x4708e0);}case enums_1[_0x16c6ee(0x120)][_0x16c6ee(0x10b)]:{return(0x0,voice_mapper_1[_0x16c6ee(0x11f)])(_0x4708e0);}case enums_1[_0x16c6ee(0x120)][_0x16c6ee(0xff)]:{return(0x0,textToAudio_mapper_1[_0x16c6ee(0x115)])(_0x4708e0);}default:throw new common_1['NotFoundException'](_0x16c6ee(0x11b));}}};__decorate([(0x0,event_emitter_1[a2_0x23f8a7(0xf2)])(events_1[a2_0x23f8a7(0xeb)][a2_0x23f8a7(0x113)]),(0x0,event_emitter_1[a2_0x23f8a7(0xf2)])(events_1['ScheduleChangedEvent'][a2_0x23f8a7(0x122)]),(0x0,event_emitter_1[a2_0x23f8a7(0xf2)])(events_1[a2_0x23f8a7(0x116)][a2_0x23f8a7(0xdf)]),(0x0,event_emitter_1[a2_0x23f8a7(0xf2)])(events_1['EventChangedEvent']['Updated']),(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x23f8a7(0x116)][a2_0x23f8a7(0x122)]),__metadata(a2_0x23f8a7(0xf0),Function),__metadata('design:paramtypes',[]),__metadata(a2_0x23f8a7(0x104),Promise)],AgendaService['prototype'],a2_0x23f8a7(0xf8),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x23f8a7(0xda)])(),__metadata(a2_0x23f8a7(0x118),[nestjs_agenda_1[a2_0x23f8a7(0xe2)]])],AgendaService),exports[a2_0x23f8a7(0xe2)]=AgendaService;