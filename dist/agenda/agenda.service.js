'use strict';const a2_0x263e1e=a2_0x41f3;(function(_0x24144d,_0x5a679e){const _0x1cc388=a2_0x41f3,_0x469a9b=_0x24144d();while(!![]){try{const _0xf56a48=parseInt(_0x1cc388(0x143))/0x1+parseInt(_0x1cc388(0x165))/0x2*(-parseInt(_0x1cc388(0x146))/0x3)+parseInt(_0x1cc388(0x139))/0x4+parseInt(_0x1cc388(0x157))/0x5+parseInt(_0x1cc388(0x129))/0x6+-parseInt(_0x1cc388(0x13b))/0x7+parseInt(_0x1cc388(0x14d))/0x8;if(_0xf56a48===_0x5a679e)break;else _0x469a9b['push'](_0x469a9b['shift']());}catch(_0x37af9f){_0x469a9b['push'](_0x469a9b['shift']());}}}(a2_0x3eb6,0x4e8dc));var __decorate=this&&this['__decorate']||function(_0x3f1237,_0x18715f,_0x4f8a7d,_0x385065){const _0x49e9c9=a2_0x41f3;var _0x4dbfa8=arguments[_0x49e9c9(0x15d)],_0x5b8619=_0x4dbfa8<0x3?_0x18715f:_0x385065===null?_0x385065=Object[_0x49e9c9(0x12c)](_0x18715f,_0x4f8a7d):_0x385065,_0x5d791;if(typeof Reflect===_0x49e9c9(0x16c)&&typeof Reflect[_0x49e9c9(0x166)]===_0x49e9c9(0x12b))_0x5b8619=Reflect['decorate'](_0x3f1237,_0x18715f,_0x4f8a7d,_0x385065);else{for(var _0x3bc36d=_0x3f1237[_0x49e9c9(0x15d)]-0x1;_0x3bc36d>=0x0;_0x3bc36d--)if(_0x5d791=_0x3f1237[_0x3bc36d])_0x5b8619=(_0x4dbfa8<0x3?_0x5d791(_0x5b8619):_0x4dbfa8>0x3?_0x5d791(_0x18715f,_0x4f8a7d,_0x5b8619):_0x5d791(_0x18715f,_0x4f8a7d))||_0x5b8619;}return _0x4dbfa8>0x3&&_0x5b8619&&Object[_0x49e9c9(0x15f)](_0x18715f,_0x4f8a7d,_0x5b8619),_0x5b8619;},__metadata=this&&this['__metadata']||function(_0x2fc726,_0x3445c6){const _0x39228d=a2_0x41f3;if(typeof Reflect===_0x39228d(0x16c)&&typeof Reflect[_0x39228d(0x160)]===_0x39228d(0x12b))return Reflect['metadata'](_0x2fc726,_0x3445c6);},AgendaService_1;Object['defineProperty'](exports,a2_0x263e1e(0x130),{'value':!![]}),exports[a2_0x263e1e(0x167)]=void 0x0;function a2_0x41f3(_0x38feb8,_0x2c1f19){const _0x3eb6e9=a2_0x3eb6();return a2_0x41f3=function(_0x41f341,_0x478d6d){_0x41f341=_0x41f341-0x127;let _0x21eae9=_0x3eb6e9[_0x41f341];return _0x21eae9;},a2_0x41f3(_0x38feb8,_0x2c1f19);}const common_1=require(a2_0x263e1e(0x168)),nestjs_agenda_1=require(a2_0x263e1e(0x12a)),event_emitter_1=require('@nestjs/event-emitter'),mongodb_1=require(a2_0x263e1e(0x12e)),enums_1=require(a2_0x263e1e(0x150)),events_1=require('../common/events'),job_1=require('../common/job'),dtos_1=require(a2_0x263e1e(0x16d)),mappers_1=require('./mappers'),voice_mapper_1=require('./mappers/voice.mapper'),textToAudio_mapper_1=require('./mappers/textToAudio.mapper');let AgendaService=AgendaService_1=class AgendaService{constructor(_0x372364){const _0x134eb1=a2_0x263e1e;this['agendaAgent']=_0x372364,this[_0x134eb1(0x15b)]=new common_1['Logger'](AgendaService_1['name']),this[_0x134eb1(0x156)]();}async['initialize'](){const _0x466463=a2_0x263e1e;await this[_0x466463(0x13d)][_0x466463(0x14b)](),this[_0x466463(0x13d)][_0x466463(0x137)](_0x466463(0x169),enums_1['BackgroundJobType'][_0x466463(0x128)]),this[_0x466463(0x13d)][_0x466463(0x137)](_0x466463(0x169),enums_1['BackgroundJobType'][_0x466463(0x16a)]),this[_0x466463(0x13d)][_0x466463(0x153)](enums_1['BackgroundJobType'][_0x466463(0x128)],null);}async[a2_0x263e1e(0x140)](){const _0x2ab5be=a2_0x263e1e;this['logger']['log'](_0x2ab5be(0x163)),await this[_0x2ab5be(0x13d)][_0x2ab5be(0x138)]({'name':{'$in':Object[_0x2ab5be(0x132)](enums_1[_0x2ab5be(0x131)])}}),this[_0x2ab5be(0x13d)][_0x2ab5be(0x153)](enums_1[_0x2ab5be(0x14c)][_0x2ab5be(0x128)],null);}async[a2_0x263e1e(0x13e)](){const _0x3c239c=a2_0x263e1e,_0x36e866=await this[_0x3c239c(0x13d)][_0x3c239c(0x144)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x36e866;}async[a2_0x263e1e(0x13f)](_0xb7bf1f){const _0x109419=a2_0x263e1e,_0x856fc2=this[_0x109419(0x164)](_0xb7bf1f),_0x314307=(0x0,dtos_1['isScheduleJobDTO'])(_0xb7bf1f),_0x19893b=_0x314307?_0xb7bf1f[_0x109419(0x135)]:_0xb7bf1f[_0x109419(0x137)];let _0x442c29;return _0x314307?_0x442c29=await this[_0x109419(0x13d)][_0x109419(0x159)](_0x19893b,_0xb7bf1f[_0x109419(0x148)],_0x856fc2):_0x442c29=await this[_0x109419(0x13d)][_0x109419(0x137)](_0x19893b,_0xb7bf1f[_0x109419(0x148)],_0x856fc2,{'startDate':new Date(_0xb7bf1f[_0x109419(0x13a)]),'endDate':new Date(_0xb7bf1f['endDate']),'skipImmediate':!![]}),{'jobId':_0x442c29['attrs']['_id'][_0x109419(0x162)]()};}async[a2_0x263e1e(0x136)](_0x1dfc20){const _0x2764f5=a2_0x263e1e,_0x413922=await this[_0x2764f5(0x13d)][_0x2764f5(0x144)]({'_id':new mongodb_1[(_0x2764f5(0x149))](_0x1dfc20)});if(!_0x413922['length'])return{'success':!![],'message':_0x2764f5(0x16b)+_0x1dfc20+_0x2764f5(0x14a)};const _0x32a1fc=await this[_0x2764f5(0x13d)][_0x2764f5(0x138)]({'_id':new mongodb_1['ObjectId'](_0x1dfc20)});job_1[_0x2764f5(0x15a)][_0x2764f5(0x141)](_0x1dfc20);if(_0x32a1fc)return{'success':!![],'message':_0x2764f5(0x16b)+_0x1dfc20+'\x20is\x20cancelled'};return{'success':![],'message':'Failed\x20to\x20cancel\x20job\x20'+_0x1dfc20};}async[a2_0x263e1e(0x145)](_0x2bb564,_0x5c39b6){return await this['cancelJob'](_0x2bb564),await this['scheduleJob'](_0x5c39b6);}['getJobPayload'](_0x39ce61){const _0x1e8161=a2_0x263e1e;switch(_0x39ce61[_0x1e8161(0x148)]){case enums_1['JobType'][_0x1e8161(0x12d)]:{return(0x0,mappers_1[_0x1e8161(0x14e)])(_0x39ce61);}case enums_1[_0x1e8161(0x131)][_0x1e8161(0x147)]:{return(0x0,mappers_1[_0x1e8161(0x12f)])(_0x39ce61);}case enums_1[_0x1e8161(0x131)][_0x1e8161(0x151)]:{return(0x0,voice_mapper_1['toPlayVoiceCommand'])(_0x39ce61);}case enums_1['JobType']['PlayTextToAudio']:{return(0x0,textToAudio_mapper_1[_0x1e8161(0x13c)])(_0x39ce61);}default:throw new common_1[(_0x1e8161(0x155))](_0x1e8161(0x142));}}};function a2_0x3eb6(){const _0x3fe316=['Job\x20type\x20not\x20found','363709wBlUpA','jobs','rescheduleJob','6717xoBeMV','PlayMusic','jobType','ObjectId','\x20not\x20found','purge','BackgroundJobType','1320000VWbvCZ','toPlaySoundCommand','design:paramtypes','../common/enums','PlayVoiceRecorded','Created','now','Updated','NotFoundException','initialize','571325tvxgbE','EventChangedEvent','schedule','PROCESS_CACHE','logger','ScheduleChangedEvent','length','prototype','defineProperty','metadata','design:type','toString','Scheduling\x20events...','getJobPayload','374splqjF','decorate','AgendaService','@nestjs/common','0\x200\x20*\x20*\x20*','PurgeTempUploadedFiles','Job\x20','object','./dtos','Deleted','CheckEvent','2982594wZbCRr','@agent-ly/nestjs-agenda','function','getOwnPropertyDescriptor','PlaySound','mongodb','toPlayMusicCommand','__esModule','JobType','values','OnEvent','Injectable','when','cancelJob','every','cancel','958032pSPXwU','startDate','4473924pWMLoL','toPlayTextToAudioCommand','agendaAgent','getJobs','scheduleJob','rescheduleEvents','killProcess'];a2_0x3eb6=function(){return _0x3fe316;};return a2_0x3eb6();}__decorate([(0x0,event_emitter_1[a2_0x263e1e(0x133)])(events_1[a2_0x263e1e(0x15c)]['Updated']),(0x0,event_emitter_1[a2_0x263e1e(0x133)])(events_1[a2_0x263e1e(0x15c)][a2_0x263e1e(0x127)]),(0x0,event_emitter_1[a2_0x263e1e(0x133)])(events_1['EventChangedEvent'][a2_0x263e1e(0x152)]),(0x0,event_emitter_1[a2_0x263e1e(0x133)])(events_1[a2_0x263e1e(0x158)][a2_0x263e1e(0x154)]),(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x263e1e(0x158)][a2_0x263e1e(0x127)]),__metadata(a2_0x263e1e(0x161),Function),__metadata(a2_0x263e1e(0x14f),[]),__metadata('design:returntype',Promise)],AgendaService[a2_0x263e1e(0x15e)],a2_0x263e1e(0x140),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x263e1e(0x134)])(),__metadata(a2_0x263e1e(0x14f),[nestjs_agenda_1[a2_0x263e1e(0x167)]])],AgendaService),exports[a2_0x263e1e(0x167)]=AgendaService;