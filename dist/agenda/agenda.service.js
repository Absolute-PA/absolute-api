'use strict';const a2_0x113fb2=a2_0x3a77;(function(_0x46ad12,_0x4b8666){const _0x574111=a2_0x3a77,_0xc450a9=_0x46ad12();while(!![]){try{const _0x58699b=-parseInt(_0x574111(0x1ed))/0x1+parseInt(_0x574111(0x1d8))/0x2*(parseInt(_0x574111(0x1f3))/0x3)+parseInt(_0x574111(0x1f4))/0x4*(parseInt(_0x574111(0x1ba))/0x5)+parseInt(_0x574111(0x1bc))/0x6*(-parseInt(_0x574111(0x1ab))/0x7)+parseInt(_0x574111(0x1da))/0x8*(parseInt(_0x574111(0x1b7))/0x9)+parseInt(_0x574111(0x1c3))/0xa+parseInt(_0x574111(0x1e0))/0xb;if(_0x58699b===_0x4b8666)break;else _0xc450a9['push'](_0xc450a9['shift']());}catch(_0x4a5d92){_0xc450a9['push'](_0xc450a9['shift']());}}}(a2_0x5d3f,0x9462b));var __decorate=this&&this['__decorate']||function(_0x40664d,_0x4513a2,_0x95ca04,_0x30f80c){const _0x13fb4f=a2_0x3a77;var _0x587e4e=arguments[_0x13fb4f(0x1f2)],_0x588888=_0x587e4e<0x3?_0x4513a2:_0x30f80c===null?_0x30f80c=Object[_0x13fb4f(0x1dc)](_0x4513a2,_0x95ca04):_0x30f80c,_0x4c573f;if(typeof Reflect===_0x13fb4f(0x1e2)&&typeof Reflect[_0x13fb4f(0x1a9)]===_0x13fb4f(0x1ca))_0x588888=Reflect[_0x13fb4f(0x1a9)](_0x40664d,_0x4513a2,_0x95ca04,_0x30f80c);else{for(var _0xf73bc4=_0x40664d[_0x13fb4f(0x1f2)]-0x1;_0xf73bc4>=0x0;_0xf73bc4--)if(_0x4c573f=_0x40664d[_0xf73bc4])_0x588888=(_0x587e4e<0x3?_0x4c573f(_0x588888):_0x587e4e>0x3?_0x4c573f(_0x4513a2,_0x95ca04,_0x588888):_0x4c573f(_0x4513a2,_0x95ca04))||_0x588888;}return _0x587e4e>0x3&&_0x588888&&Object['defineProperty'](_0x4513a2,_0x95ca04,_0x588888),_0x588888;},__metadata=this&&this[a2_0x113fb2(0x1c1)]||function(_0x5e8d9c,_0x4b34c1){const _0x433aed=a2_0x113fb2;if(typeof Reflect==='object'&&typeof Reflect[_0x433aed(0x1c8)]===_0x433aed(0x1ca))return Reflect[_0x433aed(0x1c8)](_0x5e8d9c,_0x4b34c1);},AgendaService_1;Object[a2_0x113fb2(0x1c5)](exports,'__esModule',{'value':!![]}),exports[a2_0x113fb2(0x1b3)]=void 0x0;function a2_0x5d3f(){const _0x66c12b=['length','48kwxyFk','36uZlWoy','now','ScheduleChangedEvent','0\x200\x20*\x20*\x20*','design:returntype','Updated','toPlayMusicCommand','decorate','PlayTextToAudio','336LgjGrh','logger','JobType','killProcess','BackgroundJobType','toString','cancel','@nestjs/common','AgendaService','initialize','name','design:type','18WwICLp','Deleted','isScheduleJobDTO','285715RhqYAF','../common/enums','56418VYrkNT','values','Created','Scheduling\x20events...','\x20is\x20cancelled','__metadata','purge','317430ujttnZ','PROCESS_CACHE','defineProperty','OnEvent','EventChangedEvent','metadata','Job\x20','function','jobType','schedule','../common/events','startDate','\x20not\x20found','toPlayVoiceCommand','_id','endDate','PlayMusic','toPlaySoundCommand','Failed\x20to\x20cancel\x20job\x20','./dtos','PlayVoiceRecorded','996sZJeXR','cancelJob','2882272VCuQbv','NotFoundException','getOwnPropertyDescriptor','scheduleJob','rescheduleEvents','when','9253420wtUMBQ','./mappers/textToAudio.mapper','object','mongodb','design:paramtypes','Injectable','Logger','every','prototype','attrs','jobs','agendaAgent','rescheduleJob','1056655KblYmX','CheckEvent','ObjectId','../common/job','PurgeTempUploadedFiles'];a2_0x5d3f=function(){return _0x66c12b;};return a2_0x5d3f();}const common_1=require(a2_0x113fb2(0x1b2)),nestjs_agenda_1=require('@agent-ly/nestjs-agenda'),event_emitter_1=require('@nestjs/event-emitter'),mongodb_1=require(a2_0x113fb2(0x1e3)),enums_1=require(a2_0x113fb2(0x1bb)),events_1=require(a2_0x113fb2(0x1cd)),job_1=require(a2_0x113fb2(0x1f0)),dtos_1=require(a2_0x113fb2(0x1d6)),mappers_1=require('./mappers'),voice_mapper_1=require('./mappers/voice.mapper'),textToAudio_mapper_1=require(a2_0x113fb2(0x1e1));function a2_0x3a77(_0x51a629,_0x16a380){const _0x5d3f3c=a2_0x5d3f();return a2_0x3a77=function(_0x3a77d9,_0x23dd1c){_0x3a77d9=_0x3a77d9-0x1a4;let _0x1dd66a=_0x5d3f3c[_0x3a77d9];return _0x1dd66a;},a2_0x3a77(_0x51a629,_0x16a380);}let AgendaService=AgendaService_1=class AgendaService{constructor(_0x1aa355){const _0x2c9c91=a2_0x113fb2;this[_0x2c9c91(0x1eb)]=_0x1aa355,this[_0x2c9c91(0x1ac)]=new common_1[(_0x2c9c91(0x1e6))](AgendaService_1[_0x2c9c91(0x1b5)]),this['initialize']();}async[a2_0x113fb2(0x1b4)](){const _0x20a678=a2_0x113fb2;await this[_0x20a678(0x1eb)][_0x20a678(0x1c2)](),this[_0x20a678(0x1eb)][_0x20a678(0x1e7)](_0x20a678(0x1a5),enums_1['BackgroundJobType'][_0x20a678(0x1ee)]),this['agendaAgent'][_0x20a678(0x1e7)](_0x20a678(0x1a5),enums_1['BackgroundJobType'][_0x20a678(0x1f1)]),this[_0x20a678(0x1eb)][_0x20a678(0x1f5)](enums_1[_0x20a678(0x1af)][_0x20a678(0x1ee)],null);}async[a2_0x113fb2(0x1de)](){const _0x384c8b=a2_0x113fb2;this[_0x384c8b(0x1ac)]['log'](_0x384c8b(0x1bf)),await this[_0x384c8b(0x1eb)]['cancel']({'name':{'$in':Object[_0x384c8b(0x1bd)](enums_1[_0x384c8b(0x1ad)])}}),this[_0x384c8b(0x1eb)]['now'](enums_1[_0x384c8b(0x1af)]['CheckEvent'],null);}async['getJobs'](){const _0xf2b98a=a2_0x113fb2,_0x1a19ab=await this[_0xf2b98a(0x1eb)]['jobs']({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x1a19ab;}async[a2_0x113fb2(0x1dd)](_0x25053c){const _0x11b01a=a2_0x113fb2,_0x3e3948=this['getJobPayload'](_0x25053c),_0x417581=(0x0,dtos_1[_0x11b01a(0x1b9)])(_0x25053c),_0x18e210=_0x417581?_0x25053c[_0x11b01a(0x1df)]:_0x25053c[_0x11b01a(0x1e7)];let _0x5b049e;return _0x417581?_0x5b049e=await this['agendaAgent'][_0x11b01a(0x1cc)](_0x18e210,_0x25053c['jobType'],_0x3e3948):_0x5b049e=await this['agendaAgent'][_0x11b01a(0x1e7)](_0x18e210,_0x25053c[_0x11b01a(0x1cb)],_0x3e3948,{'startDate':new Date(_0x25053c[_0x11b01a(0x1ce)]),'endDate':new Date(_0x25053c[_0x11b01a(0x1d2)]),'skipImmediate':!![]}),{'jobId':_0x5b049e[_0x11b01a(0x1e9)][_0x11b01a(0x1d1)][_0x11b01a(0x1b0)]()};}async[a2_0x113fb2(0x1d9)](_0x400e5f){const _0x5e3dcd=a2_0x113fb2,_0x2e6fdb=await this[_0x5e3dcd(0x1eb)][_0x5e3dcd(0x1ea)]({'_id':new mongodb_1['ObjectId'](_0x400e5f)});if(!_0x2e6fdb[_0x5e3dcd(0x1f2)])return{'success':!![],'message':_0x5e3dcd(0x1c9)+_0x400e5f+_0x5e3dcd(0x1cf)};const _0x1c78da=await this[_0x5e3dcd(0x1eb)][_0x5e3dcd(0x1b1)]({'_id':new mongodb_1[(_0x5e3dcd(0x1ef))](_0x400e5f)});job_1[_0x5e3dcd(0x1c4)][_0x5e3dcd(0x1ae)](_0x400e5f);if(_0x1c78da)return{'success':!![],'message':_0x5e3dcd(0x1c9)+_0x400e5f+_0x5e3dcd(0x1c0)};return{'success':![],'message':_0x5e3dcd(0x1d5)+_0x400e5f};}async[a2_0x113fb2(0x1ec)](_0x49471c,_0x1f3bc4){const _0x48a3f5=a2_0x113fb2;return await this[_0x48a3f5(0x1d9)](_0x49471c),await this[_0x48a3f5(0x1dd)](_0x1f3bc4);}['getJobPayload'](_0xf1a130){const _0x58eba8=a2_0x113fb2;switch(_0xf1a130[_0x58eba8(0x1cb)]){case enums_1[_0x58eba8(0x1ad)]['PlaySound']:{return(0x0,mappers_1[_0x58eba8(0x1d4)])(_0xf1a130);}case enums_1['JobType'][_0x58eba8(0x1d3)]:{return(0x0,mappers_1[_0x58eba8(0x1a8)])(_0xf1a130);}case enums_1[_0x58eba8(0x1ad)][_0x58eba8(0x1d7)]:{return(0x0,voice_mapper_1[_0x58eba8(0x1d0)])(_0xf1a130);}case enums_1['JobType'][_0x58eba8(0x1aa)]:{return(0x0,textToAudio_mapper_1['toPlayTextToAudioCommand'])(_0xf1a130);}default:throw new common_1[(_0x58eba8(0x1db))]('Job\x20type\x20not\x20found');}}};__decorate([(0x0,event_emitter_1[a2_0x113fb2(0x1c6)])(events_1[a2_0x113fb2(0x1a4)][a2_0x113fb2(0x1a7)]),(0x0,event_emitter_1[a2_0x113fb2(0x1c6)])(events_1[a2_0x113fb2(0x1a4)][a2_0x113fb2(0x1b8)]),(0x0,event_emitter_1[a2_0x113fb2(0x1c6)])(events_1[a2_0x113fb2(0x1c7)][a2_0x113fb2(0x1be)]),(0x0,event_emitter_1[a2_0x113fb2(0x1c6)])(events_1['EventChangedEvent']['Updated']),(0x0,event_emitter_1[a2_0x113fb2(0x1c6)])(events_1['EventChangedEvent'][a2_0x113fb2(0x1b8)]),__metadata(a2_0x113fb2(0x1b6),Function),__metadata('design:paramtypes',[]),__metadata(a2_0x113fb2(0x1a6),Promise)],AgendaService[a2_0x113fb2(0x1e8)],a2_0x113fb2(0x1de),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x113fb2(0x1e5)])(),__metadata(a2_0x113fb2(0x1e4),[nestjs_agenda_1[a2_0x113fb2(0x1b3)]])],AgendaService),exports['AgendaService']=AgendaService;