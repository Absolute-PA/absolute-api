'use strict';const a2_0x1943ad=a2_0x1ab5;(function(_0x2cf8dd,_0x161d47){const _0x258edf=a2_0x1ab5,_0x2a2570=_0x2cf8dd();while(!![]){try{const _0x1bef9c=parseInt(_0x258edf(0x127))/0x1+parseInt(_0x258edf(0x132))/0x2*(-parseInt(_0x258edf(0xfd))/0x3)+parseInt(_0x258edf(0x11c))/0x4*(-parseInt(_0x258edf(0x110))/0x5)+parseInt(_0x258edf(0x12b))/0x6+-parseInt(_0x258edf(0x122))/0x7+parseInt(_0x258edf(0xf3))/0x8+parseInt(_0x258edf(0xff))/0x9*(-parseInt(_0x258edf(0x13c))/0xa);if(_0x1bef9c===_0x161d47)break;else _0x2a2570['push'](_0x2a2570['shift']());}catch(_0x5de254){_0x2a2570['push'](_0x2a2570['shift']());}}}(a2_0x360c,0x6c7fe));function a2_0x1ab5(_0xcf4676,_0x37d60b){const _0x360cd9=a2_0x360c();return a2_0x1ab5=function(_0x1ab5a4,_0x5bd341){_0x1ab5a4=_0x1ab5a4-0xf0;let _0x3920d0=_0x360cd9[_0x1ab5a4];return _0x3920d0;},a2_0x1ab5(_0xcf4676,_0x37d60b);}var __decorate=this&&this[a2_0x1943ad(0x13e)]||function(_0x7c6019,_0x489f44,_0x76c1ba,_0x5b3e0c){const _0x435b6a=a2_0x1943ad;var _0x281031=arguments['length'],_0xbb1f0e=_0x281031<0x3?_0x489f44:_0x5b3e0c===null?_0x5b3e0c=Object[_0x435b6a(0x11a)](_0x489f44,_0x76c1ba):_0x5b3e0c,_0x145202;if(typeof Reflect===_0x435b6a(0xf6)&&typeof Reflect['decorate']==='function')_0xbb1f0e=Reflect[_0x435b6a(0x108)](_0x7c6019,_0x489f44,_0x76c1ba,_0x5b3e0c);else{for(var _0x1dac3c=_0x7c6019[_0x435b6a(0x116)]-0x1;_0x1dac3c>=0x0;_0x1dac3c--)if(_0x145202=_0x7c6019[_0x1dac3c])_0xbb1f0e=(_0x281031<0x3?_0x145202(_0xbb1f0e):_0x281031>0x3?_0x145202(_0x489f44,_0x76c1ba,_0xbb1f0e):_0x145202(_0x489f44,_0x76c1ba))||_0xbb1f0e;}return _0x281031>0x3&&_0xbb1f0e&&Object[_0x435b6a(0x135)](_0x489f44,_0x76c1ba,_0xbb1f0e),_0xbb1f0e;},__metadata=this&&this[a2_0x1943ad(0xf2)]||function(_0x47849a,_0xf5a050){const _0x2f0410=a2_0x1943ad;if(typeof Reflect==='object'&&typeof Reflect[_0x2f0410(0x10d)]==='function')return Reflect[_0x2f0410(0x10d)](_0x47849a,_0xf5a050);},AgendaService_1;Object[a2_0x1943ad(0x135)](exports,a2_0x1943ad(0xfc),{'value':!![]}),exports[a2_0x1943ad(0x139)]=void 0x0;const common_1=require('@nestjs/common'),nestjs_agenda_1=require(a2_0x1943ad(0x119)),event_emitter_1=require('@nestjs/event-emitter'),mongodb_1=require(a2_0x1943ad(0x109)),enums_1=require(a2_0x1943ad(0xf0)),events_1=require(a2_0x1943ad(0x100)),job_1=require(a2_0x1943ad(0x129)),dtos_1=require(a2_0x1943ad(0x12e)),mappers_1=require('./mappers'),voice_mapper_1=require(a2_0x1943ad(0x11e)),textToAudio_mapper_1=require(a2_0x1943ad(0x107));function a2_0x360c(){const _0x492d6c=['NotFoundException','rescheduleEvents','CheckEvent','endDate','./mappers/textToAudio.mapper','decorate','mongodb','cancelJob','Deleted','design:type','metadata','cancel','toPlayTextToAudioCommand','41240ByilOC','PlaySound','Job\x20type\x20not\x20found','log','EventChangedEvent','PlayTextToAudio','length','attrs','_id','@agent-ly/nestjs-agenda','getOwnPropertyDescriptor','Updated','76pPbvRv','OnEvent','./mappers/voice.mapper','agendaAgent','when','\x20not\x20found','108850GFlBMB','Failed\x20to\x20cancel\x20job\x20','Logger','PROCESS_CACHE','getJobPayload','517426GSXQPA','prototype','../common/job','getJobs','2868420kpMsSF','toPlayMusicCommand','schedule','./dtos','startDate','design:paramtypes','ScheduleChangedEvent','326riKFRR','\x20is\x20cancelled','Created','defineProperty','PlayMusic','logger','ObjectId','AgendaService','isScheduleJobDTO','toPlaySoundCommand','10PUAKhl','jobs','__decorate','BackgroundJobType','../common/enums','scheduleJob','__metadata','2874664LdgIdv','initialize','JobType','object','name','jobType','design:returntype','0\x200\x20*\x20*\x20*','Job\x20','__esModule','10083qKPWnR','rescheduleJob','1712790rfxbEO','../common/events','every','Injectable'];a2_0x360c=function(){return _0x492d6c;};return a2_0x360c();}let AgendaService=AgendaService_1=class AgendaService{constructor(_0x4806fd){const _0x5f3acb=a2_0x1943ad;this[_0x5f3acb(0x11f)]=_0x4806fd,this[_0x5f3acb(0x137)]=new common_1[(_0x5f3acb(0x124))](AgendaService_1[_0x5f3acb(0xf7)]),this[_0x5f3acb(0xf4)]();}async[a2_0x1943ad(0xf4)](){const _0x20e0bf=a2_0x1943ad;await this['agendaAgent']['purge'](),this[_0x20e0bf(0x11f)][_0x20e0bf(0x101)]('0\x200\x20*\x20*\x20*',enums_1[_0x20e0bf(0x13f)][_0x20e0bf(0x105)]),this[_0x20e0bf(0x11f)][_0x20e0bf(0x101)](_0x20e0bf(0xfa),enums_1[_0x20e0bf(0x13f)]['PurgeTempUploadedFiles']),this['agendaAgent']['now'](enums_1[_0x20e0bf(0x13f)][_0x20e0bf(0x105)],null);}async[a2_0x1943ad(0x104)](){const _0xf13e7b=a2_0x1943ad;this[_0xf13e7b(0x137)][_0xf13e7b(0x113)]('Scheduling\x20events...'),await this[_0xf13e7b(0x11f)][_0xf13e7b(0x10e)]({'name':{'$in':Object['values'](enums_1[_0xf13e7b(0xf5)])}}),this[_0xf13e7b(0x11f)]['now'](enums_1[_0xf13e7b(0x13f)][_0xf13e7b(0x105)],null);}async[a2_0x1943ad(0x12a)](){const _0x17f721=a2_0x1943ad,_0x567db8=await this[_0x17f721(0x11f)][_0x17f721(0x13d)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x567db8;}async[a2_0x1943ad(0xf1)](_0x29addf){const _0x5e514b=a2_0x1943ad,_0x32eb70=this['getJobPayload'](_0x29addf),_0x5bdd28=(0x0,dtos_1[_0x5e514b(0x13a)])(_0x29addf),_0xb90409=_0x5bdd28?_0x29addf[_0x5e514b(0x120)]:_0x29addf['every'];let _0x2c636b;return _0x5bdd28?_0x2c636b=await this[_0x5e514b(0x11f)][_0x5e514b(0x12d)](_0xb90409,_0x29addf[_0x5e514b(0xf8)],_0x32eb70):_0x2c636b=await this[_0x5e514b(0x11f)][_0x5e514b(0x101)](_0xb90409,_0x29addf[_0x5e514b(0xf8)],_0x32eb70,{'startDate':new Date(_0x29addf[_0x5e514b(0x12f)]),'endDate':new Date(_0x29addf[_0x5e514b(0x106)]),'skipImmediate':!![]}),{'jobId':_0x2c636b[_0x5e514b(0x117)][_0x5e514b(0x118)]['toString']()};}async[a2_0x1943ad(0x10a)](_0x570e75){const _0x17ee8f=a2_0x1943ad,_0x7ca8fd=await this[_0x17ee8f(0x11f)]['jobs']({'_id':new mongodb_1[(_0x17ee8f(0x138))](_0x570e75)});if(!_0x7ca8fd[_0x17ee8f(0x116)])return{'success':!![],'message':_0x17ee8f(0xfb)+_0x570e75+_0x17ee8f(0x121)};const _0x4656a2=await this[_0x17ee8f(0x11f)][_0x17ee8f(0x10e)]({'_id':new mongodb_1[(_0x17ee8f(0x138))](_0x570e75)});job_1[_0x17ee8f(0x125)]['killProcess'](_0x570e75);if(_0x4656a2)return{'success':!![],'message':'Job\x20'+_0x570e75+_0x17ee8f(0x133)};return{'success':![],'message':_0x17ee8f(0x123)+_0x570e75};}async[a2_0x1943ad(0xfe)](_0x2370cb,_0x56904b){const _0x5a33f3=a2_0x1943ad;return await this[_0x5a33f3(0x10a)](_0x2370cb),await this[_0x5a33f3(0xf1)](_0x56904b);}[a2_0x1943ad(0x126)](_0x4b6b50){const _0x399363=a2_0x1943ad;switch(_0x4b6b50[_0x399363(0xf8)]){case enums_1['JobType'][_0x399363(0x111)]:{return(0x0,mappers_1[_0x399363(0x13b)])(_0x4b6b50);}case enums_1[_0x399363(0xf5)][_0x399363(0x136)]:{return(0x0,mappers_1[_0x399363(0x12c)])(_0x4b6b50);}case enums_1['JobType']['PlayVoiceRecorded']:{return(0x0,voice_mapper_1['toPlayVoiceCommand'])(_0x4b6b50);}case enums_1[_0x399363(0xf5)][_0x399363(0x115)]:{return(0x0,textToAudio_mapper_1[_0x399363(0x10f)])(_0x4b6b50);}default:throw new common_1[(_0x399363(0x103))](_0x399363(0x112));}}};__decorate([(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x1943ad(0x131)][a2_0x1943ad(0x11b)]),(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x1943ad(0x131)][a2_0x1943ad(0x10b)]),(0x0,event_emitter_1[a2_0x1943ad(0x11d)])(events_1['EventChangedEvent'][a2_0x1943ad(0x134)]),(0x0,event_emitter_1[a2_0x1943ad(0x11d)])(events_1[a2_0x1943ad(0x114)][a2_0x1943ad(0x11b)]),(0x0,event_emitter_1[a2_0x1943ad(0x11d)])(events_1[a2_0x1943ad(0x114)]['Deleted']),__metadata(a2_0x1943ad(0x10c),Function),__metadata(a2_0x1943ad(0x130),[]),__metadata(a2_0x1943ad(0xf9),Promise)],AgendaService[a2_0x1943ad(0x128)],'rescheduleEvents',null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x1943ad(0x102)])(),__metadata(a2_0x1943ad(0x130),[nestjs_agenda_1[a2_0x1943ad(0x139)]])],AgendaService),exports[a2_0x1943ad(0x139)]=AgendaService;