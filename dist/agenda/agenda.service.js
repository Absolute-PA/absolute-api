'use strict';const a2_0x2bfaef=a2_0x5552;(function(_0x743f86,_0x45f8bf){const _0x3200de=a2_0x5552,_0x51046b=_0x743f86();while(!![]){try{const _0x7b8802=-parseInt(_0x3200de(0x11d))/0x1*(parseInt(_0x3200de(0x165))/0x2)+parseInt(_0x3200de(0x12c))/0x3*(-parseInt(_0x3200de(0x13a))/0x4)+parseInt(_0x3200de(0x121))/0x5+-parseInt(_0x3200de(0x149))/0x6*(parseInt(_0x3200de(0x12b))/0x7)+-parseInt(_0x3200de(0x14f))/0x8*(-parseInt(_0x3200de(0x126))/0x9)+-parseInt(_0x3200de(0x166))/0xa*(-parseInt(_0x3200de(0x14d))/0xb)+-parseInt(_0x3200de(0x161))/0xc*(parseInt(_0x3200de(0x15a))/0xd);if(_0x7b8802===_0x45f8bf)break;else _0x51046b['push'](_0x51046b['shift']());}catch(_0x432082){_0x51046b['push'](_0x51046b['shift']());}}}(a2_0x58f6,0x4458d));function a2_0x58f6(){const _0x17925e=['44820jPmiqO','initialize','JobType','object','cancel','147127nhLpHX','Logger','getJobPayload','rescheduleEvents','1807280wjsjtR','cancelJob','getOwnPropertyDescriptor','./mappers/voice.mapper','log','603IhvjOw','Job\x20type\x20not\x20found','toString','Scheduling\x20events...','scheduleJob','14DrEdrH','3XRPvrL','../common/enums','startDate','jobType','EventChangedEvent','now','PROCESS_CACHE','AgendaService','when','0\x200\x20*\x20*\x20*','../common/events','jobs','decorate','prototype','1845972RnHYVQ','rescheduleJob','CheckEvent','ObjectId','NotFoundException','purge','killProcess','every','OnEvent','PlaySound','Deleted','design:paramtypes','PurgeTempUploadedFiles','PlayTextToAudio','name','255342yRNEOL','../common/job','mongodb','attrs','1012DljJtA','design:returntype','37416lQqbaS','PlayMusic','_id','agendaAgent','length','toPlayVoiceCommand','BackgroundJobType','schedule','defineProperty','metadata','./mappers','143ubvIhV','PlayVoiceRecorded','getJobs','ScheduleChangedEvent','endDate','Injectable','Updated','123792pPDfkF','values','logger','function','2SPQzKG'];a2_0x58f6=function(){return _0x17925e;};return a2_0x58f6();}var __decorate=this&&this['__decorate']||function(_0x517b90,_0x2de0eb,_0x5d44ae,_0x40c814){const _0x1f8c08=a2_0x5552;var _0x4324ac=arguments[_0x1f8c08(0x153)],_0x38d240=_0x4324ac<0x3?_0x2de0eb:_0x40c814===null?_0x40c814=Object[_0x1f8c08(0x123)](_0x2de0eb,_0x5d44ae):_0x40c814,_0x204419;if(typeof Reflect===_0x1f8c08(0x169)&&typeof Reflect[_0x1f8c08(0x138)]==='function')_0x38d240=Reflect['decorate'](_0x517b90,_0x2de0eb,_0x5d44ae,_0x40c814);else{for(var _0x446e19=_0x517b90['length']-0x1;_0x446e19>=0x0;_0x446e19--)if(_0x204419=_0x517b90[_0x446e19])_0x38d240=(_0x4324ac<0x3?_0x204419(_0x38d240):_0x4324ac>0x3?_0x204419(_0x2de0eb,_0x5d44ae,_0x38d240):_0x204419(_0x2de0eb,_0x5d44ae))||_0x38d240;}return _0x4324ac>0x3&&_0x38d240&&Object[_0x1f8c08(0x157)](_0x2de0eb,_0x5d44ae,_0x38d240),_0x38d240;},__metadata=this&&this['__metadata']||function(_0x208f9c,_0x5b139e){const _0x4f9df1=a2_0x5552;if(typeof Reflect===_0x4f9df1(0x169)&&typeof Reflect[_0x4f9df1(0x158)]===_0x4f9df1(0x164))return Reflect['metadata'](_0x208f9c,_0x5b139e);},AgendaService_1;Object[a2_0x2bfaef(0x157)](exports,'__esModule',{'value':!![]}),exports[a2_0x2bfaef(0x133)]=void 0x0;function a2_0x5552(_0x4d3e0d,_0xc6acb4){const _0x58f65c=a2_0x58f6();return a2_0x5552=function(_0x555253,_0x3d6fb1){_0x555253=_0x555253-0x11c;let _0x572987=_0x58f65c[_0x555253];return _0x572987;},a2_0x5552(_0x4d3e0d,_0xc6acb4);}const common_1=require('@nestjs/common'),nestjs_agenda_1=require('@agent-ly/nestjs-agenda'),event_emitter_1=require('@nestjs/event-emitter'),mongodb_1=require(a2_0x2bfaef(0x14b)),enums_1=require(a2_0x2bfaef(0x12d)),events_1=require(a2_0x2bfaef(0x136)),job_1=require(a2_0x2bfaef(0x14a)),dtos_1=require('./dtos'),mappers_1=require(a2_0x2bfaef(0x159)),voice_mapper_1=require(a2_0x2bfaef(0x124)),textToAudio_mapper_1=require('./mappers/textToAudio.mapper');let AgendaService=AgendaService_1=class AgendaService{constructor(_0x1e2cfa){const _0x5a6ae7=a2_0x2bfaef;this[_0x5a6ae7(0x152)]=_0x1e2cfa,this[_0x5a6ae7(0x163)]=new common_1[(_0x5a6ae7(0x11e))](AgendaService_1[_0x5a6ae7(0x148)]),this[_0x5a6ae7(0x167)]();}async[a2_0x2bfaef(0x167)](){const _0x4d163c=a2_0x2bfaef;await this[_0x4d163c(0x152)][_0x4d163c(0x13f)](),this[_0x4d163c(0x152)][_0x4d163c(0x141)](_0x4d163c(0x135),enums_1[_0x4d163c(0x155)][_0x4d163c(0x13c)]),this[_0x4d163c(0x152)][_0x4d163c(0x141)](_0x4d163c(0x135),enums_1[_0x4d163c(0x155)][_0x4d163c(0x146)]),this[_0x4d163c(0x152)][_0x4d163c(0x131)](enums_1['BackgroundJobType']['CheckEvent'],null);}async['rescheduleEvents'](){const _0x2b9681=a2_0x2bfaef;this[_0x2b9681(0x163)][_0x2b9681(0x125)](_0x2b9681(0x129)),await this[_0x2b9681(0x152)][_0x2b9681(0x11c)]({'name':{'$in':Object[_0x2b9681(0x162)](enums_1[_0x2b9681(0x168)])}}),this[_0x2b9681(0x152)][_0x2b9681(0x131)](enums_1['BackgroundJobType'][_0x2b9681(0x13c)],null);}async[a2_0x2bfaef(0x15c)](){const _0x5a3915=a2_0x2bfaef,_0x57650a=await this[_0x5a3915(0x152)][_0x5a3915(0x137)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0x57650a;}async[a2_0x2bfaef(0x12a)](_0xec2c61){const _0x34799d=a2_0x2bfaef,_0x2c3066=this[_0x34799d(0x11f)](_0xec2c61),_0x13013e=(0x0,dtos_1['isScheduleJobDTO'])(_0xec2c61),_0x1d204d=_0x13013e?_0xec2c61[_0x34799d(0x134)]:_0xec2c61[_0x34799d(0x141)];let _0x5ace52;return _0x13013e?_0x5ace52=await this[_0x34799d(0x152)][_0x34799d(0x156)](_0x1d204d,_0xec2c61[_0x34799d(0x12f)],_0x2c3066):_0x5ace52=await this[_0x34799d(0x152)][_0x34799d(0x141)](_0x1d204d,_0xec2c61['jobType'],_0x2c3066,{'startDate':new Date(_0xec2c61[_0x34799d(0x12e)]),'endDate':new Date(_0xec2c61[_0x34799d(0x15e)]),'skipImmediate':!![]}),{'jobId':_0x5ace52[_0x34799d(0x14c)][_0x34799d(0x151)][_0x34799d(0x128)]()};}async[a2_0x2bfaef(0x122)](_0x338e6c){const _0x2764a7=a2_0x2bfaef,_0x1ea528=await this[_0x2764a7(0x152)]['jobs']({'_id':new mongodb_1[(_0x2764a7(0x13d))](_0x338e6c)});if(!_0x1ea528[_0x2764a7(0x153)])return{'success':!![],'message':'Job\x20'+_0x338e6c+'\x20not\x20found'};const _0x17ff80=await this[_0x2764a7(0x152)][_0x2764a7(0x11c)]({'_id':new mongodb_1[(_0x2764a7(0x13d))](_0x338e6c)});job_1[_0x2764a7(0x132)][_0x2764a7(0x140)](_0x338e6c);if(_0x17ff80)return{'success':!![],'message':'Job\x20'+_0x338e6c+'\x20is\x20cancelled'};return{'success':![],'message':'Failed\x20to\x20cancel\x20job\x20'+_0x338e6c};}async[a2_0x2bfaef(0x13b)](_0x19ef17,_0xd0cc47){const _0x8093ed=a2_0x2bfaef;return await this[_0x8093ed(0x122)](_0x19ef17),await this[_0x8093ed(0x12a)](_0xd0cc47);}[a2_0x2bfaef(0x11f)](_0x5e0b91){const _0x3ec24a=a2_0x2bfaef;switch(_0x5e0b91[_0x3ec24a(0x12f)]){case enums_1['JobType'][_0x3ec24a(0x143)]:{return(0x0,mappers_1['toPlaySoundCommand'])(_0x5e0b91);}case enums_1[_0x3ec24a(0x168)][_0x3ec24a(0x150)]:{return(0x0,mappers_1['toPlayMusicCommand'])(_0x5e0b91);}case enums_1[_0x3ec24a(0x168)][_0x3ec24a(0x15b)]:{return(0x0,voice_mapper_1[_0x3ec24a(0x154)])(_0x5e0b91);}case enums_1[_0x3ec24a(0x168)][_0x3ec24a(0x147)]:{return(0x0,textToAudio_mapper_1['toPlayTextToAudioCommand'])(_0x5e0b91);}default:throw new common_1[(_0x3ec24a(0x13e))](_0x3ec24a(0x127));}}};__decorate([(0x0,event_emitter_1[a2_0x2bfaef(0x142)])(events_1[a2_0x2bfaef(0x15d)][a2_0x2bfaef(0x160)]),(0x0,event_emitter_1[a2_0x2bfaef(0x142)])(events_1[a2_0x2bfaef(0x15d)][a2_0x2bfaef(0x144)]),(0x0,event_emitter_1[a2_0x2bfaef(0x142)])(events_1['EventChangedEvent']['Created']),(0x0,event_emitter_1['OnEvent'])(events_1['EventChangedEvent'][a2_0x2bfaef(0x160)]),(0x0,event_emitter_1[a2_0x2bfaef(0x142)])(events_1[a2_0x2bfaef(0x130)][a2_0x2bfaef(0x144)]),__metadata('design:type',Function),__metadata(a2_0x2bfaef(0x145),[]),__metadata(a2_0x2bfaef(0x14e),Promise)],AgendaService[a2_0x2bfaef(0x139)],a2_0x2bfaef(0x120),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x2bfaef(0x15f)])(),__metadata(a2_0x2bfaef(0x145),[nestjs_agenda_1[a2_0x2bfaef(0x133)]])],AgendaService),exports[a2_0x2bfaef(0x133)]=AgendaService;