'use strict';const a2_0x5f576e=a2_0x3c26;(function(_0x3295d8,_0x4f7f63){const _0xd5803e=a2_0x3c26,_0x23e091=_0x3295d8();while(!![]){try{const _0x16790b=parseInt(_0xd5803e(0x191))/0x1+-parseInt(_0xd5803e(0x1a1))/0x2*(-parseInt(_0xd5803e(0x1a4))/0x3)+-parseInt(_0xd5803e(0x18a))/0x4+parseInt(_0xd5803e(0x195))/0x5+parseInt(_0xd5803e(0x192))/0x6+parseInt(_0xd5803e(0x1b1))/0x7+-parseInt(_0xd5803e(0x190))/0x8;if(_0x16790b===_0x4f7f63)break;else _0x23e091['push'](_0x23e091['shift']());}catch(_0x22430b){_0x23e091['push'](_0x23e091['shift']());}}}(a2_0x4f54,0xceb75));var __decorate=this&&this[a2_0x5f576e(0x180)]||function(_0x297550,_0x461131,_0x3305f4,_0x1eb8e8){const _0x475e0c=a2_0x5f576e;var _0x41da34=arguments[_0x475e0c(0x1ca)],_0x2e73fd=_0x41da34<0x3?_0x461131:_0x1eb8e8===null?_0x1eb8e8=Object['getOwnPropertyDescriptor'](_0x461131,_0x3305f4):_0x1eb8e8,_0x29c80d;if(typeof Reflect===_0x475e0c(0x1bb)&&typeof Reflect[_0x475e0c(0x19b)]===_0x475e0c(0x186))_0x2e73fd=Reflect[_0x475e0c(0x19b)](_0x297550,_0x461131,_0x3305f4,_0x1eb8e8);else{for(var _0x4a3478=_0x297550['length']-0x1;_0x4a3478>=0x0;_0x4a3478--)if(_0x29c80d=_0x297550[_0x4a3478])_0x2e73fd=(_0x41da34<0x3?_0x29c80d(_0x2e73fd):_0x41da34>0x3?_0x29c80d(_0x461131,_0x3305f4,_0x2e73fd):_0x29c80d(_0x461131,_0x3305f4))||_0x2e73fd;}return _0x41da34>0x3&&_0x2e73fd&&Object[_0x475e0c(0x1a5)](_0x461131,_0x3305f4,_0x2e73fd),_0x2e73fd;},__metadata=this&&this[a2_0x5f576e(0x1bf)]||function(_0x5a7e0f,_0x5bbd13){const _0x174d23=a2_0x5f576e;if(typeof Reflect===_0x174d23(0x1bb)&&typeof Reflect['metadata']===_0x174d23(0x186))return Reflect['metadata'](_0x5a7e0f,_0x5bbd13);},AgendaService_1;Object[a2_0x5f576e(0x1a5)](exports,a2_0x5f576e(0x1a0),{'value':!![]}),exports['AgendaService']=void 0x0;function a2_0x4f54(){const _0x196d64=['1114133PgcHuK','1759806edNBbC','Updated','PurgeTempUploadedFiles','6880465wiPHCe','now','design:type','killProcess','design:paramtypes','agendaAgent','decorate','../common/enums','AgendaService','\x20not\x20found','toString','__esModule','370978vNCMGF','PlayMusic','endDate','6PAGmwZ','defineProperty','log','schedule','PROCESS_CACHE','cancelJob','PlayVoiceRecorded','@nestjs/common','EventChangedEvent','Logger','ScheduleChangedEvent','Deleted','jobs','9875684CgkxmN','./dtos','getJobPayload','isScheduleJobDTO','logger','rescheduleJob','toPlaySoundCommand','@nestjs/event-emitter','CheckEvent','name','object','./mappers/textToAudio.mapper','Failed\x20to\x20cancel\x20job\x20','./mappers','__metadata','ObjectId','BackgroundJobType','jobType','values','mongodb','rescheduleEvents','Created','\x20is\x20cancelled','purge','../common/events','length','PlayTextToAudio','cancel','__decorate','toPlayTextToAudioCommand','Injectable','JobType','toPlayVoiceCommand','every','function','../common/job','PlaySound','@agent-ly/nestjs-agenda','3896188zVXLyG','OnEvent','Job\x20','0\x200\x20*\x20*\x20*','attrs','scheduleJob','21956488vDEiHT'];a2_0x4f54=function(){return _0x196d64;};return a2_0x4f54();}const common_1=require(a2_0x5f576e(0x1ab)),nestjs_agenda_1=require(a2_0x5f576e(0x189)),event_emitter_1=require(a2_0x5f576e(0x1b8)),mongodb_1=require(a2_0x5f576e(0x1c4)),enums_1=require(a2_0x5f576e(0x19c)),events_1=require(a2_0x5f576e(0x1c9)),job_1=require(a2_0x5f576e(0x187)),dtos_1=require(a2_0x5f576e(0x1b2)),mappers_1=require(a2_0x5f576e(0x1be)),voice_mapper_1=require('./mappers/voice.mapper'),textToAudio_mapper_1=require(a2_0x5f576e(0x1bc));let AgendaService=AgendaService_1=class AgendaService{constructor(_0x4c0c92){const _0x4f3336=a2_0x5f576e;this[_0x4f3336(0x19a)]=_0x4c0c92,this['logger']=new common_1[(_0x4f3336(0x1ad))](AgendaService_1[_0x4f3336(0x1ba)]),this['initialize']();}async['initialize'](){const _0x13a67b=a2_0x5f576e;await this[_0x13a67b(0x19a)][_0x13a67b(0x1c8)](),this['agendaAgent'][_0x13a67b(0x185)](_0x13a67b(0x18d),enums_1[_0x13a67b(0x1c1)][_0x13a67b(0x1b9)]),this[_0x13a67b(0x19a)]['every'](_0x13a67b(0x18d),enums_1['BackgroundJobType'][_0x13a67b(0x194)]),this[_0x13a67b(0x19a)][_0x13a67b(0x196)](enums_1[_0x13a67b(0x1c1)][_0x13a67b(0x1b9)],null);}async[a2_0x5f576e(0x1c5)](){const _0x4e00ff=a2_0x5f576e;this[_0x4e00ff(0x1b5)][_0x4e00ff(0x1a6)]('Scheduling\x20events...'),await this[_0x4e00ff(0x19a)][_0x4e00ff(0x17f)]({'name':{'$in':Object[_0x4e00ff(0x1c3)](enums_1[_0x4e00ff(0x183)])}}),this[_0x4e00ff(0x19a)][_0x4e00ff(0x196)](enums_1[_0x4e00ff(0x1c1)][_0x4e00ff(0x1b9)],null);}async['getJobs'](){const _0x44fc15=a2_0x5f576e,_0xcd59d8=await this[_0x44fc15(0x19a)][_0x44fc15(0x1b0)]({'nextRunAt':{'$exists':!![],'$ne':null}});return _0xcd59d8;}async[a2_0x5f576e(0x18f)](_0x194b4c){const _0x103fea=a2_0x5f576e,_0x35ccd0=this['getJobPayload'](_0x194b4c),_0x1deaa9=(0x0,dtos_1[_0x103fea(0x1b4)])(_0x194b4c),_0x3aed7c=_0x1deaa9?_0x194b4c['when']:_0x194b4c['every'];let _0xe1b03d;return _0x1deaa9?_0xe1b03d=await this[_0x103fea(0x19a)][_0x103fea(0x1a7)](_0x3aed7c,_0x194b4c[_0x103fea(0x1c2)],_0x35ccd0):_0xe1b03d=await this['agendaAgent']['every'](_0x3aed7c,_0x194b4c[_0x103fea(0x1c2)],_0x35ccd0,{'startDate':new Date(_0x194b4c['startDate']),'endDate':new Date(_0x194b4c[_0x103fea(0x1a3)]),'skipImmediate':!![]}),{'jobId':_0xe1b03d[_0x103fea(0x18e)]['_id'][_0x103fea(0x19f)]()};}async['cancelJob'](_0x3f0317){const _0xb0253d=a2_0x5f576e,_0x52694c=await this[_0xb0253d(0x19a)][_0xb0253d(0x1b0)]({'_id':new mongodb_1['ObjectId'](_0x3f0317)});if(!_0x52694c[_0xb0253d(0x1ca)])return{'success':!![],'message':_0xb0253d(0x18c)+_0x3f0317+_0xb0253d(0x19e)};const _0x106337=await this[_0xb0253d(0x19a)]['cancel']({'_id':new mongodb_1[(_0xb0253d(0x1c0))](_0x3f0317)});job_1[_0xb0253d(0x1a8)][_0xb0253d(0x198)](_0x3f0317);if(_0x106337)return{'success':!![],'message':'Job\x20'+_0x3f0317+_0xb0253d(0x1c7)};return{'success':![],'message':_0xb0253d(0x1bd)+_0x3f0317};}async[a2_0x5f576e(0x1b6)](_0x70309b,_0x3f3912){const _0x16c319=a2_0x5f576e;return await this[_0x16c319(0x1a9)](_0x70309b),await this[_0x16c319(0x18f)](_0x3f3912);}[a2_0x5f576e(0x1b3)](_0x5a26db){const _0x4eda45=a2_0x5f576e;switch(_0x5a26db[_0x4eda45(0x1c2)]){case enums_1[_0x4eda45(0x183)][_0x4eda45(0x188)]:{return(0x0,mappers_1[_0x4eda45(0x1b7)])(_0x5a26db);}case enums_1['JobType'][_0x4eda45(0x1a2)]:{return(0x0,mappers_1['toPlayMusicCommand'])(_0x5a26db);}case enums_1[_0x4eda45(0x183)][_0x4eda45(0x1aa)]:{return(0x0,voice_mapper_1[_0x4eda45(0x184)])(_0x5a26db);}case enums_1[_0x4eda45(0x183)][_0x4eda45(0x17e)]:{return(0x0,textToAudio_mapper_1[_0x4eda45(0x181)])(_0x5a26db);}default:throw new common_1['NotFoundException']('Job\x20type\x20not\x20found');}}};function a2_0x3c26(_0x17a8f5,_0x392617){const _0x4f5439=a2_0x4f54();return a2_0x3c26=function(_0x3c26d4,_0x55fcad){_0x3c26d4=_0x3c26d4-0x17e;let _0x8cf929=_0x4f5439[_0x3c26d4];return _0x8cf929;},a2_0x3c26(_0x17a8f5,_0x392617);}__decorate([(0x0,event_emitter_1[a2_0x5f576e(0x18b)])(events_1[a2_0x5f576e(0x1ae)]['Updated']),(0x0,event_emitter_1[a2_0x5f576e(0x18b)])(events_1[a2_0x5f576e(0x1ae)][a2_0x5f576e(0x1af)]),(0x0,event_emitter_1[a2_0x5f576e(0x18b)])(events_1[a2_0x5f576e(0x1ac)][a2_0x5f576e(0x1c6)]),(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x5f576e(0x1ac)][a2_0x5f576e(0x193)]),(0x0,event_emitter_1['OnEvent'])(events_1[a2_0x5f576e(0x1ac)][a2_0x5f576e(0x1af)]),__metadata(a2_0x5f576e(0x197),Function),__metadata(a2_0x5f576e(0x199),[]),__metadata('design:returntype',Promise)],AgendaService['prototype'],a2_0x5f576e(0x1c5),null),AgendaService=AgendaService_1=__decorate([(0x0,common_1[a2_0x5f576e(0x182)])(),__metadata(a2_0x5f576e(0x199),[nestjs_agenda_1[a2_0x5f576e(0x19d)]])],AgendaService),exports[a2_0x5f576e(0x19d)]=AgendaService;