'use strict';const a9_0x27d9bb=a9_0xb561;(function(_0x34dcb2,_0x1694c0){const _0x10853a=a9_0xb561,_0x54314d=_0x34dcb2();while(!![]){try{const _0x14e1dc=parseInt(_0x10853a(0x171))/0x1*(-parseInt(_0x10853a(0x161))/0x2)+-parseInt(_0x10853a(0x13a))/0x3*(parseInt(_0x10853a(0x172))/0x4)+-parseInt(_0x10853a(0x17b))/0x5*(parseInt(_0x10853a(0x167))/0x6)+parseInt(_0x10853a(0x180))/0x7*(-parseInt(_0x10853a(0x189))/0x8)+-parseInt(_0x10853a(0x188))/0x9*(parseInt(_0x10853a(0x17e))/0xa)+parseInt(_0x10853a(0x16d))/0xb*(-parseInt(_0x10853a(0x174))/0xc)+parseInt(_0x10853a(0x159))/0xd;if(_0x14e1dc===_0x1694c0)break;else _0x54314d['push'](_0x54314d['shift']());}catch(_0x10fae5){_0x54314d['push'](_0x54314d['shift']());}}}(a9_0x53da,0x99cf9));function a9_0x53da(){const _0x41bd4a=['55575949OzSVTf','metadata','../common/constants','decorate','AgendaService','__decorate','purgeTempUploadedFiles','setMinutes','24574tjeyCx','NODE_ENV','TMP_UPLOAD_DIR','logger','schedule','\x20-\x20','72vNdnQX','defineProperty','Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20','object','agenda','updateExpiryStatus','55hLlrAz','getSeconds','Define','Logger','18HAyYBI','166972VnSdYB','data','1279056qnpzsj','single','settingService','AuditActor','__esModule','time','Event:\x20','43345fDvpFQ','PlayMusic','Server\x20time:\x20','15850SGvzVJ','design:type','1141jWcKKO','PurgeTempUploadedFiles','checkEvent','env','prototype','forEach','Purging\x20temp\x20uploaded\x20files...','scheduleService','6651ROVLRw','40368wWpSFo','findEligibleSchedule','Processor','function','57AFWwQF','JobProccessor','length','\x20-\x20Schedule:\x20','CheckEvent','Scheduling\x20event:\x20','@agent-ly/nestjs-agenda','Invalid\x20or\x20expired\x20license\x20key!','SettingService','attrs','design:paramtypes','BackgroundJobType','__metadata','PlayVoiceRecorded','design:returntype','../schedule/schedule.service','agendaService','isExpired','events','name','split','JobType','PlaySound','jobType','../common/file','setSeconds','Job','log','Canceling\x20all\x20old\x20background\x20checks...','Events\x20scheduled!','getOwnPropertyDescriptor'];a9_0x53da=function(){return _0x41bd4a;};return a9_0x53da();}var __decorate=this&&this[a9_0x27d9bb(0x15e)]||function(_0x4ad224,_0x23dcb9,_0x4f4cf0,_0x48f211){const _0x311e6f=a9_0x27d9bb;var _0x17c061=arguments[_0x311e6f(0x13c)],_0xe9622d=_0x17c061<0x3?_0x23dcb9:_0x48f211===null?_0x48f211=Object[_0x311e6f(0x158)](_0x23dcb9,_0x4f4cf0):_0x48f211,_0x3b5f9c;if(typeof Reflect===_0x311e6f(0x16a)&&typeof Reflect[_0x311e6f(0x15c)]===_0x311e6f(0x18c))_0xe9622d=Reflect[_0x311e6f(0x15c)](_0x4ad224,_0x23dcb9,_0x4f4cf0,_0x48f211);else{for(var _0x54e4e9=_0x4ad224[_0x311e6f(0x13c)]-0x1;_0x54e4e9>=0x0;_0x54e4e9--)if(_0x3b5f9c=_0x4ad224[_0x54e4e9])_0xe9622d=(_0x17c061<0x3?_0x3b5f9c(_0xe9622d):_0x17c061>0x3?_0x3b5f9c(_0x23dcb9,_0x4f4cf0,_0xe9622d):_0x3b5f9c(_0x23dcb9,_0x4f4cf0))||_0xe9622d;}return _0x17c061>0x3&&_0xe9622d&&Object['defineProperty'](_0x23dcb9,_0x4f4cf0,_0xe9622d),_0xe9622d;},__metadata=this&&this[a9_0x27d9bb(0x146)]||function(_0x247182,_0x5dbb69){const _0x4f8df2=a9_0x27d9bb;if(typeof Reflect===_0x4f8df2(0x16a)&&typeof Reflect['metadata']==='function')return Reflect[_0x4f8df2(0x15a)](_0x247182,_0x5dbb69);},JobProccessor_1;Object[a9_0x27d9bb(0x168)](exports,a9_0x27d9bb(0x178),{'value':!![]}),exports[a9_0x27d9bb(0x13b)]=void 0x0;const common_1=require('@nestjs/common'),agenda_1=require(a9_0x27d9bb(0x16b)),nestjs_agenda_1=require(a9_0x27d9bb(0x140)),enums_1=require('../common/enums'),schedule_service_1=require(a9_0x27d9bb(0x149)),setting_service_1=require('../setting/setting.service'),file_1=require(a9_0x27d9bb(0x152)),constants_1=require(a9_0x27d9bb(0x15b));let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x3ce22f,_0xebcfe3,_0x32c3f7){const _0x5b3ad0=a9_0x27d9bb;this[_0x5b3ad0(0x14a)]=_0x3ce22f,this[_0x5b3ad0(0x187)]=_0xebcfe3,this[_0x5b3ad0(0x176)]=_0x32c3f7,this['logger']=new common_1[(_0x5b3ad0(0x170))](JobProccessor_1[_0x5b3ad0(0x14d)]);}async[a9_0x27d9bb(0x182)](_0x3614f3){const _0x4d58f5=a9_0x27d9bb;this[_0x4d58f5(0x164)]['log'](_0x4d58f5(0x17d)+new Date()+'.\x20Job:\x20'+_0x3614f3[_0x4d58f5(0x143)]['name']);const _0x525bcf=await this['settingService'][_0x4d58f5(0x16c)]();if(_0x525bcf[_0x4d58f5(0x14b)]){this[_0x4d58f5(0x164)][_0x4d58f5(0x155)](_0x4d58f5(0x141));if(process[_0x4d58f5(0x183)][_0x4d58f5(0x162)]!=='development')return;}this['logger']['log'](_0x4d58f5(0x156)),await this[_0x4d58f5(0x14a)]['cancel']({'name':{'$nin':[enums_1[_0x4d58f5(0x145)][_0x4d58f5(0x13e)],enums_1[_0x4d58f5(0x145)][_0x4d58f5(0x181)]]},'type':_0x4d58f5(0x175)}),this[_0x4d58f5(0x164)][_0x4d58f5(0x155)]('Fetching\x20today\x20schedule...');const _0x510fb8=await this[_0x4d58f5(0x187)][_0x4d58f5(0x18a)](new Date());this[_0x4d58f5(0x164)]['log']('Eligible\x20schedule:\x20'+(_0x510fb8===null||_0x510fb8===void 0x0?void 0x0:_0x510fb8[_0x4d58f5(0x14d)]));if(!_0x510fb8||!_0x510fb8['events']||_0x510fb8[_0x4d58f5(0x14c)][_0x4d58f5(0x13c)]===0x0)return;_0x510fb8[_0x4d58f5(0x14c)][_0x4d58f5(0x185)](_0x1e5df5=>{const _0x5bd3ad=_0x4d58f5;this[_0x5bd3ad(0x164)][_0x5bd3ad(0x155)](_0x5bd3ad(0x13f)+_0x1e5df5[_0x5bd3ad(0x179)]+_0x5bd3ad(0x166)+_0x1e5df5[_0x5bd3ad(0x151)]+_0x5bd3ad(0x166)+_0x1e5df5['name']);const _0x4de426=new Date(),_0x1a3852=_0x4de426['getHours'](),_0x47c367=_0x4de426['getMinutes'](),_0x4c3925=_0x4de426[_0x5bd3ad(0x16e)](),[_0x3e5f03,_0x25bd44,_0x5eec61]=_0x1e5df5[_0x5bd3ad(0x179)][_0x5bd3ad(0x14e)](':');if(+_0x3e5f03<_0x1a3852||+_0x3e5f03===_0x1a3852&&+_0x25bd44<_0x47c367||+_0x3e5f03===_0x1a3852&&+_0x25bd44===_0x47c367&&+_0x5eec61<_0x4c3925)return;_0x4de426['setHours'](+_0x3e5f03),_0x4de426[_0x5bd3ad(0x160)](+_0x25bd44),_0x4de426[_0x5bd3ad(0x153)](+_0x5eec61);switch(_0x1e5df5[_0x5bd3ad(0x151)]){case enums_1[_0x5bd3ad(0x14f)][_0x5bd3ad(0x150)]:{const {soundId:_0x920273,durationInSecond:_0x28f9d7}=_0x1e5df5[_0x5bd3ad(0x173)];if(!_0x920273)return;const _0x939924={'soundId':_0x920273,'durationInSecond':_0x28f9d7,'audit':{'actor':enums_1[_0x5bd3ad(0x177)][_0x5bd3ad(0x154)],'name':enums_1[_0x5bd3ad(0x14f)][_0x5bd3ad(0x150)],'message':_0x5bd3ad(0x17a)+_0x1e5df5['name']+_0x5bd3ad(0x13d)+_0x510fb8['name']}};this[_0x5bd3ad(0x14a)][_0x5bd3ad(0x165)](_0x4de426,enums_1[_0x5bd3ad(0x14f)][_0x5bd3ad(0x150)],_0x939924);break;}case enums_1[_0x5bd3ad(0x14f)][_0x5bd3ad(0x17c)]:{const {playlistId:_0x517dac,durationInSecond:_0x63b5b7}=_0x1e5df5['data'];if(!_0x517dac)return;const _0x1cf1bf={'playlistId':_0x517dac,'durationInSecond':_0x63b5b7,'audit':{'actor':enums_1['AuditActor'][_0x5bd3ad(0x154)],'name':enums_1[_0x5bd3ad(0x14f)][_0x5bd3ad(0x17c)],'message':'Event:\x20'+_0x1e5df5[_0x5bd3ad(0x14d)]+_0x5bd3ad(0x13d)+_0x510fb8['name']}};this[_0x5bd3ad(0x14a)][_0x5bd3ad(0x165)](_0x4de426,enums_1[_0x5bd3ad(0x14f)]['PlayMusic'],_0x1cf1bf);break;}case enums_1[_0x5bd3ad(0x14f)][_0x5bd3ad(0x147)]:{const {voiceId:_0x4128b3,durationInSecond:_0x2c47a6}=_0x1e5df5['data'];if(!_0x4128b3)return;const _0xd69b5b={'voiceId':_0x4128b3,'durationInSecond':_0x2c47a6,'audit':{'actor':enums_1[_0x5bd3ad(0x177)]['Job'],'name':enums_1[_0x5bd3ad(0x14f)][_0x5bd3ad(0x147)],'message':'Event:\x20'+_0x1e5df5[_0x5bd3ad(0x14d)]+'\x20-\x20Schedule:\x20'+_0x510fb8[_0x5bd3ad(0x14d)]}};this[_0x5bd3ad(0x14a)][_0x5bd3ad(0x165)](_0x4de426,enums_1['JobType']['PlayVoiceRecorded'],_0xd69b5b);break;}case enums_1[_0x5bd3ad(0x14f)]['PlayTextToAudio']:{const {textToAudioId:_0x234590,durationInSecond:_0x2cf1bb}=_0x1e5df5[_0x5bd3ad(0x173)];if(!_0x234590)return;const _0x7ab0a2={'textToAudioId':_0x234590,'durationInSecond':_0x2cf1bb,'audit':{'actor':enums_1['AuditActor'][_0x5bd3ad(0x154)],'name':enums_1[_0x5bd3ad(0x14f)]['PlayTextToAudio'],'message':'Event:\x20'+_0x1e5df5['name']+'\x20-\x20Schedule:\x20'+_0x510fb8[_0x5bd3ad(0x14d)]}};this[_0x5bd3ad(0x14a)]['schedule'](_0x4de426,enums_1[_0x5bd3ad(0x14f)]['PlayTextToAudio'],_0x7ab0a2);break;}default:return;}}),this['logger'][_0x4d58f5(0x155)](_0x4d58f5(0x157));}async[a9_0x27d9bb(0x15f)](_0x361283){const _0x1ca3ef=a9_0x27d9bb;this[_0x1ca3ef(0x164)][_0x1ca3ef(0x155)](_0x1ca3ef(0x186));const {success:_0x3aee60,message:_0x3307ae}=await(0x0,file_1['deleteFilesInFolder'])(constants_1[_0x1ca3ef(0x163)]);!_0x3aee60&&this[_0x1ca3ef(0x164)]['error'](_0x1ca3ef(0x169)+_0x3307ae);}};function a9_0xb561(_0x155c8a,_0x502878){const _0x53da74=a9_0x53da();return a9_0xb561=function(_0xb56106,_0x136d15){_0xb56106=_0xb56106-0x13a;let _0x4e34b1=_0x53da74[_0xb56106];return _0x4e34b1;},a9_0xb561(_0x155c8a,_0x502878);}__decorate([(0x0,nestjs_agenda_1[a9_0x27d9bb(0x16f)])(enums_1[a9_0x27d9bb(0x145)][a9_0x27d9bb(0x13e)]),__metadata(a9_0x27d9bb(0x17f),Function),__metadata('design:paramtypes',[agenda_1[a9_0x27d9bb(0x154)]]),__metadata('design:returntype',Promise)],JobProccessor[a9_0x27d9bb(0x184)],'checkEvent',null),__decorate([(0x0,nestjs_agenda_1[a9_0x27d9bb(0x16f)])(enums_1[a9_0x27d9bb(0x145)][a9_0x27d9bb(0x181)]),__metadata('design:type',Function),__metadata(a9_0x27d9bb(0x144),[agenda_1['Job']]),__metadata(a9_0x27d9bb(0x148),Promise)],JobProccessor[a9_0x27d9bb(0x184)],a9_0x27d9bb(0x15f),null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x27d9bb(0x18b)])(),__metadata(a9_0x27d9bb(0x144),[nestjs_agenda_1[a9_0x27d9bb(0x15d)],schedule_service_1['ScheduleService'],setting_service_1[a9_0x27d9bb(0x142)]])],JobProccessor),exports[a9_0x27d9bb(0x13b)]=JobProccessor;