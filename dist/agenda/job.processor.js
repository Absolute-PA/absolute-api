'use strict';const a9_0x1071d9=a9_0xa52a;(function(_0x2281b7,_0x393627){const _0x10eb2c=a9_0xa52a,_0x4cee03=_0x2281b7();while(!![]){try{const _0x5d06e3=-parseInt(_0x10eb2c(0x1aa))/0x1+parseInt(_0x10eb2c(0x17d))/0x2*(-parseInt(_0x10eb2c(0x1ac))/0x3)+-parseInt(_0x10eb2c(0x1ad))/0x4+-parseInt(_0x10eb2c(0x195))/0x5+-parseInt(_0x10eb2c(0x1a4))/0x6*(parseInt(_0x10eb2c(0x168))/0x7)+parseInt(_0x10eb2c(0x1af))/0x8+parseInt(_0x10eb2c(0x177))/0x9*(parseInt(_0x10eb2c(0x16d))/0xa);if(_0x5d06e3===_0x393627)break;else _0x4cee03['push'](_0x4cee03['shift']());}catch(_0x35203f){_0x4cee03['push'](_0x4cee03['shift']());}}}(a9_0x12b3,0x6ab87));var __decorate=this&&this['__decorate']||function(_0x59f281,_0x1dd058,_0x38d0d7,_0x344b1){const _0x543c97=a9_0xa52a;var _0xfebcad=arguments['length'],_0x11e76f=_0xfebcad<0x3?_0x1dd058:_0x344b1===null?_0x344b1=Object['getOwnPropertyDescriptor'](_0x1dd058,_0x38d0d7):_0x344b1,_0x150f2e;if(typeof Reflect==='object'&&typeof Reflect[_0x543c97(0x181)]==='function')_0x11e76f=Reflect['decorate'](_0x59f281,_0x1dd058,_0x38d0d7,_0x344b1);else{for(var _0xc69422=_0x59f281[_0x543c97(0x1ae)]-0x1;_0xc69422>=0x0;_0xc69422--)if(_0x150f2e=_0x59f281[_0xc69422])_0x11e76f=(_0xfebcad<0x3?_0x150f2e(_0x11e76f):_0xfebcad>0x3?_0x150f2e(_0x1dd058,_0x38d0d7,_0x11e76f):_0x150f2e(_0x1dd058,_0x38d0d7))||_0x11e76f;}return _0xfebcad>0x3&&_0x11e76f&&Object[_0x543c97(0x1a2)](_0x1dd058,_0x38d0d7,_0x11e76f),_0x11e76f;},__metadata=this&&this[a9_0x1071d9(0x196)]||function(_0x23c63f,_0xb7d70d){const _0x360d33=a9_0x1071d9;if(typeof Reflect===_0x360d33(0x1a7)&&typeof Reflect[_0x360d33(0x16e)]===_0x360d33(0x17c))return Reflect['metadata'](_0x23c63f,_0xb7d70d);},JobProccessor_1;function a9_0x12b3(){const _0x347e31=['PlaySound','forEach','Canceling\x20all\x20old\x20background\x20checks...','SettingService','setHours','split','PlayTextToAudio','purgeTempUploadedFiles','time','isExpired','Processor','prototype','3355875BcaWRA','__metadata','Job','Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20','__esModule','single','development','JobType','scheduleService','getSeconds','PurgeTempUploadedFiles','Event:\x20','jobType','defineProperty','log','728646BVMZKm','cancel','AuditActor','object','../common/enums','design:paramtypes','355350ZoaowD','Server\x20time:\x20','291zxPUaG','1822036TILEJj','length','3386624zdPwef','Logger','events','getHours','deleteFilesInFolder','Purging\x20temp\x20uploaded\x20files...','updateExpiryStatus','AgendaService','\x20-\x20Schedule:\x20','42kaIQzT','agendaService','PlayVoiceRecorded','PlayMusic','data','1125190WKWhmx','metadata','logger','JobProccessor','../schedule/schedule.service','env','name','BackgroundJobType','schedule','design:returntype','198KpBRYP','CheckEvent','getMinutes','settingService','NODE_ENV','function','5174TtjfpH','@agent-ly/nestjs-agenda','Eligible\x20schedule:\x20','setMinutes','decorate','checkEvent','TMP_UPLOAD_DIR','\x20-\x20','Define','design:type','../setting/setting.service','../common/constants'];a9_0x12b3=function(){return _0x347e31;};return a9_0x12b3();}Object[a9_0x1071d9(0x1a2)](exports,a9_0x1071d9(0x199),{'value':!![]}),exports['JobProccessor']=void 0x0;function a9_0xa52a(_0x9aa1c0,_0x2e2a74){const _0x12b327=a9_0x12b3();return a9_0xa52a=function(_0xa52aab,_0xb4934f){_0xa52aab=_0xa52aab-0x160;let _0x325db6=_0x12b327[_0xa52aab];return _0x325db6;},a9_0xa52a(_0x9aa1c0,_0x2e2a74);}const common_1=require('@nestjs/common'),agenda_1=require('agenda'),nestjs_agenda_1=require(a9_0x1071d9(0x17e)),enums_1=require(a9_0x1071d9(0x1a8)),schedule_service_1=require(a9_0x1071d9(0x171)),setting_service_1=require(a9_0x1071d9(0x187)),file_1=require('../common/file'),constants_1=require(a9_0x1071d9(0x188));let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x1961c6,_0x479bcd,_0x51593f){const _0x2fe44e=a9_0x1071d9;this[_0x2fe44e(0x169)]=_0x1961c6,this[_0x2fe44e(0x19d)]=_0x479bcd,this[_0x2fe44e(0x17a)]=_0x51593f,this[_0x2fe44e(0x16f)]=new common_1[(_0x2fe44e(0x160))](JobProccessor_1[_0x2fe44e(0x173)]);}async['checkEvent'](_0xe98d95){const _0x463279=a9_0x1071d9;this[_0x463279(0x16f)]['log'](_0x463279(0x1ab)+new Date()+'.\x20Job:\x20'+_0xe98d95['attrs']['name']);const _0x53125=await this[_0x463279(0x17a)][_0x463279(0x165)]();if(_0x53125[_0x463279(0x192)]){this[_0x463279(0x16f)][_0x463279(0x1a3)]('Invalid\x20or\x20expired\x20license\x20key!');if(process[_0x463279(0x172)][_0x463279(0x17b)]!==_0x463279(0x19b))return;}this[_0x463279(0x16f)]['log'](_0x463279(0x18b)),await this['agendaService'][_0x463279(0x1a5)]({'name':{'$nin':[enums_1[_0x463279(0x174)][_0x463279(0x178)],enums_1[_0x463279(0x174)][_0x463279(0x19f)]]},'type':_0x463279(0x19a)}),this['logger'][_0x463279(0x1a3)]('Fetching\x20today\x20schedule...');const _0x53f24d=await this[_0x463279(0x19d)]['findEligibleSchedule'](new Date());this[_0x463279(0x16f)][_0x463279(0x1a3)](_0x463279(0x17f)+(_0x53f24d===null||_0x53f24d===void 0x0?void 0x0:_0x53f24d[_0x463279(0x173)]));if(!_0x53f24d||!_0x53f24d[_0x463279(0x161)]||_0x53f24d[_0x463279(0x161)][_0x463279(0x1ae)]===0x0)return;_0x53f24d[_0x463279(0x161)][_0x463279(0x18a)](_0x2270f5=>{const _0x1bcf65=_0x463279;this[_0x1bcf65(0x16f)][_0x1bcf65(0x1a3)]('Scheduling\x20event:\x20'+_0x2270f5[_0x1bcf65(0x191)]+_0x1bcf65(0x184)+_0x2270f5[_0x1bcf65(0x1a1)]+'\x20-\x20'+_0x2270f5[_0x1bcf65(0x173)]);const _0x3cf30b=new Date(),_0x3added=_0x3cf30b[_0x1bcf65(0x162)](),_0x4c4983=_0x3cf30b[_0x1bcf65(0x179)](),_0x4fffdb=_0x3cf30b[_0x1bcf65(0x19e)](),[_0xb4e2dc,_0x5cf4cf,_0x586afc]=_0x2270f5[_0x1bcf65(0x191)][_0x1bcf65(0x18e)](':');if(+_0xb4e2dc<_0x3added||+_0xb4e2dc===_0x3added&&+_0x5cf4cf<_0x4c4983||+_0xb4e2dc===_0x3added&&+_0x5cf4cf===_0x4c4983&&+_0x586afc<_0x4fffdb)return;_0x3cf30b[_0x1bcf65(0x18d)](+_0xb4e2dc),_0x3cf30b[_0x1bcf65(0x180)](+_0x5cf4cf),_0x3cf30b['setSeconds'](+_0x586afc);switch(_0x2270f5[_0x1bcf65(0x1a1)]){case enums_1['JobType'][_0x1bcf65(0x189)]:{const {soundId:_0x1a79b4,durationInSecond:_0x117aed}=_0x2270f5['data'];if(!_0x1a79b4)return;const _0x1606e3={'soundId':_0x1a79b4,'durationInSecond':_0x117aed,'audit':{'actor':enums_1['AuditActor'][_0x1bcf65(0x197)],'name':enums_1[_0x1bcf65(0x19c)][_0x1bcf65(0x189)],'message':_0x1bcf65(0x1a0)+_0x2270f5[_0x1bcf65(0x173)]+'\x20-\x20Schedule:\x20'+_0x53f24d[_0x1bcf65(0x173)]}};this[_0x1bcf65(0x169)]['schedule'](_0x3cf30b,enums_1[_0x1bcf65(0x19c)]['PlaySound'],_0x1606e3);break;}case enums_1[_0x1bcf65(0x19c)]['PlayMusic']:{const {playlistId:_0x68e5c3,durationInSecond:_0x120dbb}=_0x2270f5['data'];if(!_0x68e5c3)return;const _0x4ac895={'playlistId':_0x68e5c3,'durationInSecond':_0x120dbb,'audit':{'actor':enums_1[_0x1bcf65(0x1a6)][_0x1bcf65(0x197)],'name':enums_1['JobType'][_0x1bcf65(0x16b)],'message':_0x1bcf65(0x1a0)+_0x2270f5[_0x1bcf65(0x173)]+_0x1bcf65(0x167)+_0x53f24d['name']}};this[_0x1bcf65(0x169)][_0x1bcf65(0x175)](_0x3cf30b,enums_1[_0x1bcf65(0x19c)][_0x1bcf65(0x16b)],_0x4ac895);break;}case enums_1['JobType'][_0x1bcf65(0x16a)]:{const {voiceId:_0x34da58,durationInSecond:_0x2d3bb5}=_0x2270f5[_0x1bcf65(0x16c)];if(!_0x34da58)return;const _0x5ebb4f={'voiceId':_0x34da58,'durationInSecond':_0x2d3bb5,'audit':{'actor':enums_1[_0x1bcf65(0x1a6)][_0x1bcf65(0x197)],'name':enums_1['JobType']['PlayVoiceRecorded'],'message':_0x1bcf65(0x1a0)+_0x2270f5['name']+_0x1bcf65(0x167)+_0x53f24d[_0x1bcf65(0x173)]}};this['agendaService']['schedule'](_0x3cf30b,enums_1['JobType'][_0x1bcf65(0x16a)],_0x5ebb4f);break;}case enums_1[_0x1bcf65(0x19c)][_0x1bcf65(0x18f)]:{const {textToAudioId:_0x5c502b,durationInSecond:_0xf7e866}=_0x2270f5[_0x1bcf65(0x16c)];if(!_0x5c502b)return;const _0x2f0acd={'textToAudioId':_0x5c502b,'durationInSecond':_0xf7e866,'audit':{'actor':enums_1[_0x1bcf65(0x1a6)][_0x1bcf65(0x197)],'name':enums_1[_0x1bcf65(0x19c)]['PlayTextToAudio'],'message':'Event:\x20'+_0x2270f5[_0x1bcf65(0x173)]+'\x20-\x20Schedule:\x20'+_0x53f24d[_0x1bcf65(0x173)]}};this['agendaService'][_0x1bcf65(0x175)](_0x3cf30b,enums_1[_0x1bcf65(0x19c)][_0x1bcf65(0x18f)],_0x2f0acd);break;}default:return;}}),this[_0x463279(0x16f)][_0x463279(0x1a3)]('Events\x20scheduled!');}async[a9_0x1071d9(0x190)](_0x3b67ae){const _0x3fcbd5=a9_0x1071d9;this['logger'][_0x3fcbd5(0x1a3)](_0x3fcbd5(0x164));const {success:_0x11f37f,message:_0x5b32f5}=await(0x0,file_1[_0x3fcbd5(0x163)])(constants_1[_0x3fcbd5(0x183)]);!_0x11f37f&&this[_0x3fcbd5(0x16f)]['error'](_0x3fcbd5(0x198)+_0x5b32f5);}};__decorate([(0x0,nestjs_agenda_1[a9_0x1071d9(0x185)])(enums_1[a9_0x1071d9(0x174)]['CheckEvent']),__metadata(a9_0x1071d9(0x186),Function),__metadata(a9_0x1071d9(0x1a9),[agenda_1[a9_0x1071d9(0x197)]]),__metadata('design:returntype',Promise)],JobProccessor[a9_0x1071d9(0x194)],a9_0x1071d9(0x182),null),__decorate([(0x0,nestjs_agenda_1[a9_0x1071d9(0x185)])(enums_1[a9_0x1071d9(0x174)]['PurgeTempUploadedFiles']),__metadata(a9_0x1071d9(0x186),Function),__metadata(a9_0x1071d9(0x1a9),[agenda_1['Job']]),__metadata(a9_0x1071d9(0x176),Promise)],JobProccessor['prototype'],a9_0x1071d9(0x190),null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x1071d9(0x193)])(),__metadata(a9_0x1071d9(0x1a9),[nestjs_agenda_1[a9_0x1071d9(0x166)],schedule_service_1['ScheduleService'],setting_service_1[a9_0x1071d9(0x18c)]])],JobProccessor),exports[a9_0x1071d9(0x170)]=JobProccessor;