'use strict';const a9_0x183160=a9_0x3809;(function(_0x4a017c,_0x16602c){const _0x479fc8=a9_0x3809,_0x17caa9=_0x4a017c();while(!![]){try{const _0x690ed4=-parseInt(_0x479fc8(0x94))/0x1*(-parseInt(_0x479fc8(0x9b))/0x2)+-parseInt(_0x479fc8(0xaa))/0x3*(-parseInt(_0x479fc8(0x7f))/0x4)+-parseInt(_0x479fc8(0xb0))/0x5+-parseInt(_0x479fc8(0x92))/0x6+parseInt(_0x479fc8(0xab))/0x7*(parseInt(_0x479fc8(0x7e))/0x8)+parseInt(_0x479fc8(0x8b))/0x9+parseInt(_0x479fc8(0xc2))/0xa*(-parseInt(_0x479fc8(0x7a))/0xb);if(_0x690ed4===_0x16602c)break;else _0x17caa9['push'](_0x17caa9['shift']());}catch(_0x22e11a){_0x17caa9['push'](_0x17caa9['shift']());}}}(a9_0x1a42,0x32367));var __decorate=this&&this[a9_0x183160(0x87)]||function(_0x38411d,_0x33432c,_0x937628,_0x410315){const _0x568eac=a9_0x183160;var _0x50a882=arguments[_0x568eac(0xbc)],_0x3e78cc=_0x50a882<0x3?_0x33432c:_0x410315===null?_0x410315=Object[_0x568eac(0x83)](_0x33432c,_0x937628):_0x410315,_0x21c4bb;if(typeof Reflect===_0x568eac(0x7d)&&typeof Reflect['decorate']===_0x568eac(0x97))_0x3e78cc=Reflect['decorate'](_0x38411d,_0x33432c,_0x937628,_0x410315);else{for(var _0x358009=_0x38411d[_0x568eac(0xbc)]-0x1;_0x358009>=0x0;_0x358009--)if(_0x21c4bb=_0x38411d[_0x358009])_0x3e78cc=(_0x50a882<0x3?_0x21c4bb(_0x3e78cc):_0x50a882>0x3?_0x21c4bb(_0x33432c,_0x937628,_0x3e78cc):_0x21c4bb(_0x33432c,_0x937628))||_0x3e78cc;}return _0x50a882>0x3&&_0x3e78cc&&Object[_0x568eac(0xa2)](_0x33432c,_0x937628,_0x3e78cc),_0x3e78cc;},__metadata=this&&this[a9_0x183160(0xa6)]||function(_0x421dde,_0x41c037){const _0xaf7363=a9_0x183160;if(typeof Reflect===_0xaf7363(0x7d)&&typeof Reflect[_0xaf7363(0xbd)]==='function')return Reflect[_0xaf7363(0xbd)](_0x421dde,_0x41c037);},JobProccessor_1;Object[a9_0x183160(0xa2)](exports,a9_0x183160(0x7c),{'value':!![]}),exports[a9_0x183160(0xb8)]=void 0x0;function a9_0x1a42(){const _0x185034=['115030LjDUAL','error','.\x20Job:\x20','deleteFilesInFolder','attrs','Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20','checkEvent','AuditActor','development','SettingService','setSeconds','\x20-\x20','363WcxmbM','prototype','__esModule','object','168472FHpaZC','1308068okLvGe','jobType','JobType','../schedule/schedule.service','getOwnPropertyDescriptor','settingService','log','@agent-ly/nestjs-agenda','__decorate','@nestjs/common','Server\x20time:\x20','AgendaService','731115YJYrtw','design:paramtypes','NODE_ENV','setHours','getHours','Fetching\x20today\x20schedule...','logger','1025808BTaYYP','getSeconds','79lyLHaj','CheckEvent','agendaService','function','split','Processor','design:type','6722gTAnKE','Canceling\x20all\x20old\x20background\x20checks...','data','setMinutes','events','Logger','time','defineProperty','design:returntype','PlaySound','agenda','__metadata','BackgroundJobType','schedule','Job','3cTBvHu','126OtRJdf','PlayTextToAudio','PlayMusic','env','\x20-\x20Schedule:\x20','1482975QYEFCS','name','../common/enums','isExpired','PlayVoiceRecorded','Event:\x20','Define','single','JobProccessor','PurgeTempUploadedFiles','cancel','purgeTempUploadedFiles','length','metadata','Eligible\x20schedule:\x20','updateExpiryStatus','../common/constants','forEach'];a9_0x1a42=function(){return _0x185034;};return a9_0x1a42();}function a9_0x3809(_0x37234a,_0x46d3ab){const _0x1a42e2=a9_0x1a42();return a9_0x3809=function(_0x380929,_0xf23278){_0x380929=_0x380929-0x6f;let _0x57d071=_0x1a42e2[_0x380929];return _0x57d071;},a9_0x3809(_0x37234a,_0x46d3ab);}const common_1=require(a9_0x183160(0x88)),agenda_1=require(a9_0x183160(0xa5)),nestjs_agenda_1=require(a9_0x183160(0x86)),enums_1=require(a9_0x183160(0xb2)),schedule_service_1=require(a9_0x183160(0x82)),setting_service_1=require('../setting/setting.service'),file_1=require('../common/file'),constants_1=require(a9_0x183160(0xc0));let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x1fb231,_0x3e847e,_0x48e7a6){const _0x2e477a=a9_0x183160;this['agendaService']=_0x1fb231,this['scheduleService']=_0x3e847e,this[_0x2e477a(0x84)]=_0x48e7a6,this['logger']=new common_1[(_0x2e477a(0xa0))](JobProccessor_1[_0x2e477a(0xb1)]);}async[a9_0x183160(0x74)](_0x2e755b){const _0x328615=a9_0x183160;this['logger'][_0x328615(0x85)](_0x328615(0x89)+new Date()+_0x328615(0x70)+_0x2e755b[_0x328615(0x72)]['name']);const _0x39e88a=await this[_0x328615(0x84)][_0x328615(0xbf)]();if(_0x39e88a[_0x328615(0xb3)]){this[_0x328615(0x91)][_0x328615(0x85)]('Invalid\x20or\x20expired\x20license\x20key!');if(process[_0x328615(0xae)][_0x328615(0x8d)]!==_0x328615(0x76))return;}this['logger'][_0x328615(0x85)](_0x328615(0x9c)),await this[_0x328615(0x96)][_0x328615(0xba)]({'name':{'$nin':[enums_1[_0x328615(0xa7)][_0x328615(0x95)],enums_1[_0x328615(0xa7)][_0x328615(0xb9)]]},'type':_0x328615(0xb7)}),this[_0x328615(0x91)][_0x328615(0x85)](_0x328615(0x90));const _0x4016cf=await this['scheduleService']['findEligibleSchedule'](new Date());this[_0x328615(0x91)]['log'](_0x328615(0xbe)+(_0x4016cf===null||_0x4016cf===void 0x0?void 0x0:_0x4016cf[_0x328615(0xb1)]));if(!_0x4016cf||!_0x4016cf['events']||_0x4016cf[_0x328615(0x9f)]['length']===0x0)return;_0x4016cf['events'][_0x328615(0xc1)](_0xad3fc0=>{const _0x35a9a0=_0x328615;this['logger'][_0x35a9a0(0x85)]('Scheduling\x20event:\x20'+_0xad3fc0['time']+_0x35a9a0(0x79)+_0xad3fc0[_0x35a9a0(0x80)]+'\x20-\x20'+_0xad3fc0[_0x35a9a0(0xb1)]);const _0x1bf76f=new Date(),_0x18aa9c=_0x1bf76f[_0x35a9a0(0x8f)](),_0x4bef76=_0x1bf76f['getMinutes'](),_0x4cb747=_0x1bf76f[_0x35a9a0(0x93)](),[_0x883b8e,_0x5ea979,_0x56cff3]=_0xad3fc0[_0x35a9a0(0xa1)][_0x35a9a0(0x98)](':');if(+_0x883b8e<_0x18aa9c||+_0x883b8e===_0x18aa9c&&+_0x5ea979<_0x4bef76||+_0x883b8e===_0x18aa9c&&+_0x5ea979===_0x4bef76&&+_0x56cff3<_0x4cb747)return;_0x1bf76f[_0x35a9a0(0x8e)](+_0x883b8e),_0x1bf76f[_0x35a9a0(0x9e)](+_0x5ea979),_0x1bf76f[_0x35a9a0(0x78)](+_0x56cff3);switch(_0xad3fc0[_0x35a9a0(0x80)]){case enums_1[_0x35a9a0(0x81)]['PlaySound']:{const {soundId:_0x58ac4b,durationInSecond:_0x261243}=_0xad3fc0['data'];if(!_0x58ac4b)return;const _0x4e5b95={'soundId':_0x58ac4b,'durationInSecond':_0x261243,'audit':{'actor':enums_1['AuditActor']['Job'],'name':enums_1[_0x35a9a0(0x81)][_0x35a9a0(0xa4)],'message':_0x35a9a0(0xb5)+_0xad3fc0['name']+'\x20-\x20Schedule:\x20'+_0x4016cf[_0x35a9a0(0xb1)]}};this[_0x35a9a0(0x96)][_0x35a9a0(0xa8)](_0x1bf76f,enums_1['JobType'][_0x35a9a0(0xa4)],_0x4e5b95);break;}case enums_1['JobType'][_0x35a9a0(0xad)]:{const {playlistId:_0x436828,durationInSecond:_0x2937ab}=_0xad3fc0[_0x35a9a0(0x9d)];if(!_0x436828)return;const _0x5d867b={'playlistId':_0x436828,'durationInSecond':_0x2937ab,'audit':{'actor':enums_1[_0x35a9a0(0x75)][_0x35a9a0(0xa9)],'name':enums_1['JobType']['PlayMusic'],'message':_0x35a9a0(0xb5)+_0xad3fc0['name']+_0x35a9a0(0xaf)+_0x4016cf['name']}};this[_0x35a9a0(0x96)]['schedule'](_0x1bf76f,enums_1[_0x35a9a0(0x81)]['PlayMusic'],_0x5d867b);break;}case enums_1[_0x35a9a0(0x81)][_0x35a9a0(0xb4)]:{const {voiceId:_0x290688,durationInSecond:_0x553eb3}=_0xad3fc0[_0x35a9a0(0x9d)];if(!_0x290688)return;const _0x24fa8d={'voiceId':_0x290688,'durationInSecond':_0x553eb3,'audit':{'actor':enums_1['AuditActor'][_0x35a9a0(0xa9)],'name':enums_1['JobType'][_0x35a9a0(0xb4)],'message':'Event:\x20'+_0xad3fc0[_0x35a9a0(0xb1)]+_0x35a9a0(0xaf)+_0x4016cf['name']}};this[_0x35a9a0(0x96)][_0x35a9a0(0xa8)](_0x1bf76f,enums_1['JobType'][_0x35a9a0(0xb4)],_0x24fa8d);break;}case enums_1[_0x35a9a0(0x81)][_0x35a9a0(0xac)]:{const {textToAudioId:_0x2a48b2,durationInSecond:_0x10fb6e}=_0xad3fc0[_0x35a9a0(0x9d)];if(!_0x2a48b2)return;const _0x445eec={'textToAudioId':_0x2a48b2,'durationInSecond':_0x10fb6e,'audit':{'actor':enums_1[_0x35a9a0(0x75)][_0x35a9a0(0xa9)],'name':enums_1[_0x35a9a0(0x81)][_0x35a9a0(0xac)],'message':_0x35a9a0(0xb5)+_0xad3fc0[_0x35a9a0(0xb1)]+'\x20-\x20Schedule:\x20'+_0x4016cf['name']}};this[_0x35a9a0(0x96)][_0x35a9a0(0xa8)](_0x1bf76f,enums_1[_0x35a9a0(0x81)][_0x35a9a0(0xac)],_0x445eec);break;}default:return;}}),this[_0x328615(0x91)]['log']('Events\x20scheduled!');}async[a9_0x183160(0xbb)](_0x31a428){const _0x163f0e=a9_0x183160;this[_0x163f0e(0x91)][_0x163f0e(0x85)]('Purging\x20temp\x20uploaded\x20files...');const {success:_0x551ed1,message:_0x4cc359}=await(0x0,file_1[_0x163f0e(0x71)])(constants_1['TMP_UPLOAD_DIR']);!_0x551ed1&&this['logger'][_0x163f0e(0x6f)](_0x163f0e(0x73)+_0x4cc359);}};__decorate([(0x0,nestjs_agenda_1[a9_0x183160(0xb6)])(enums_1[a9_0x183160(0xa7)]['CheckEvent']),__metadata(a9_0x183160(0x9a),Function),__metadata('design:paramtypes',[agenda_1['Job']]),__metadata(a9_0x183160(0xa3),Promise)],JobProccessor[a9_0x183160(0x7b)],'checkEvent',null),__decorate([(0x0,nestjs_agenda_1[a9_0x183160(0xb6)])(enums_1[a9_0x183160(0xa7)]['PurgeTempUploadedFiles']),__metadata('design:type',Function),__metadata(a9_0x183160(0x8c),[agenda_1[a9_0x183160(0xa9)]]),__metadata(a9_0x183160(0xa3),Promise)],JobProccessor['prototype'],a9_0x183160(0xbb),null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x183160(0x99)])(),__metadata(a9_0x183160(0x8c),[nestjs_agenda_1[a9_0x183160(0x8a)],schedule_service_1['ScheduleService'],setting_service_1[a9_0x183160(0x77)]])],JobProccessor),exports[a9_0x183160(0xb8)]=JobProccessor;