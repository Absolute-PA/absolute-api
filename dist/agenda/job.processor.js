'use strict';const a9_0x53b7a7=a9_0x4796;(function(_0x55316c,_0x3a7094){const _0x59ec83=a9_0x4796,_0x45c22d=_0x55316c();while(!![]){try{const _0x53564f=-parseInt(_0x59ec83(0x119))/0x1+parseInt(_0x59ec83(0x120))/0x2+-parseInt(_0x59ec83(0x14e))/0x3*(-parseInt(_0x59ec83(0x14c))/0x4)+parseInt(_0x59ec83(0x110))/0x5+parseInt(_0x59ec83(0x12e))/0x6+-parseInt(_0x59ec83(0x115))/0x7*(parseInt(_0x59ec83(0x142))/0x8)+-parseInt(_0x59ec83(0x12d))/0x9;if(_0x53564f===_0x3a7094)break;else _0x45c22d['push'](_0x45c22d['shift']());}catch(_0x44685b){_0x45c22d['push'](_0x45c22d['shift']());}}}(a9_0x1d7e,0x8fa6a));function a9_0x1d7e(){const _0x4c1469=['ScheduleService','Job','isExpired','PlayMusic','4260501AIhVfh','893916XQwPTt','getHours','setHours','design:type','Purging\x20temp\x20uploaded\x20files...','Processor','object','PlaySound','\x20-\x20Schedule:\x20','data','getSeconds','jobType','cancel','deleteFilesInFolder','setMinutes','Fetching\x20today\x20schedule...','PlayTextToAudio','agendaService','../setting/setting.service','attrs','72loCIOn','Invalid\x20or\x20expired\x20license\x20key!','PurgeTempUploadedFiles','time','purgeTempUploadedFiles','\x20-\x20','env','logger','../schedule/schedule.service','settingService','146428LYQYss','name','39CrUyPY','split','BackgroundJobType','__decorate','Scheduling\x20event:\x20','TMP_UPLOAD_DIR','../common/enums','Event:\x20','AuditActor','.\x20Job:\x20','prototype','log','decorate','findEligibleSchedule','4860370ocrtNZ','design:returntype','CheckEvent','Define','JobType','408177wrASZy','Eligible\x20schedule:\x20','NODE_ENV','PlayVoiceRecorded','360427edLfHc','AgendaService','length','function','events','__esModule','forEach','700116poQjId','scheduleService','design:paramtypes','single','Events\x20scheduled!','schedule','defineProperty','metadata','agenda'];a9_0x1d7e=function(){return _0x4c1469;};return a9_0x1d7e();}var __decorate=this&&this[a9_0x53b7a7(0x151)]||function(_0x1d3b68,_0x4ea5a6,_0x2ca20a,_0x3b47c6){const _0x478842=a9_0x53b7a7;var _0x1203cf=arguments['length'],_0x142b79=_0x1203cf<0x3?_0x4ea5a6:_0x3b47c6===null?_0x3b47c6=Object['getOwnPropertyDescriptor'](_0x4ea5a6,_0x2ca20a):_0x3b47c6,_0x1bbc45;if(typeof Reflect===_0x478842(0x134)&&typeof Reflect[_0x478842(0x10e)]===_0x478842(0x11c))_0x142b79=Reflect[_0x478842(0x10e)](_0x1d3b68,_0x4ea5a6,_0x2ca20a,_0x3b47c6);else{for(var _0x4fea9f=_0x1d3b68['length']-0x1;_0x4fea9f>=0x0;_0x4fea9f--)if(_0x1bbc45=_0x1d3b68[_0x4fea9f])_0x142b79=(_0x1203cf<0x3?_0x1bbc45(_0x142b79):_0x1203cf>0x3?_0x1bbc45(_0x4ea5a6,_0x2ca20a,_0x142b79):_0x1bbc45(_0x4ea5a6,_0x2ca20a))||_0x142b79;}return _0x1203cf>0x3&&_0x142b79&&Object[_0x478842(0x126)](_0x4ea5a6,_0x2ca20a,_0x142b79),_0x142b79;},__metadata=this&&this['__metadata']||function(_0x29ec47,_0x3e7054){const _0x154f76=a9_0x53b7a7;if(typeof Reflect===_0x154f76(0x134)&&typeof Reflect[_0x154f76(0x127)]===_0x154f76(0x11c))return Reflect['metadata'](_0x29ec47,_0x3e7054);},JobProccessor_1;function a9_0x4796(_0x30dc78,_0x4ac94f){const _0x1d7e51=a9_0x1d7e();return a9_0x4796=function(_0x479612,_0x173c68){_0x479612=_0x479612-0x106;let _0x11c178=_0x1d7e51[_0x479612];return _0x11c178;},a9_0x4796(_0x30dc78,_0x4ac94f);}Object[a9_0x53b7a7(0x126)](exports,a9_0x53b7a7(0x11e),{'value':!![]}),exports['JobProccessor']=void 0x0;const common_1=require('@nestjs/common'),agenda_1=require(a9_0x53b7a7(0x128)),nestjs_agenda_1=require('@agent-ly/nestjs-agenda'),enums_1=require(a9_0x53b7a7(0x108)),schedule_service_1=require(a9_0x53b7a7(0x14a)),setting_service_1=require(a9_0x53b7a7(0x140)),file_1=require('../common/file'),constants_1=require('../common/constants');let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x1be94a,_0x1eca07,_0x539446){const _0x1a2d5b=a9_0x53b7a7;this['agendaService']=_0x1be94a,this[_0x1a2d5b(0x121)]=_0x1eca07,this[_0x1a2d5b(0x14b)]=_0x539446,this[_0x1a2d5b(0x149)]=new common_1['Logger'](JobProccessor_1[_0x1a2d5b(0x14d)]);}async['checkEvent'](_0xf4732d){const _0x1ffba1=a9_0x53b7a7;this['logger'][_0x1ffba1(0x10d)]('Server\x20time:\x20'+new Date()+_0x1ffba1(0x10b)+_0xf4732d[_0x1ffba1(0x141)]['name']);const _0x2cc0ac=await this[_0x1ffba1(0x14b)]['updateExpiryStatus']();if(_0x2cc0ac[_0x1ffba1(0x12b)]){this['logger'][_0x1ffba1(0x10d)](_0x1ffba1(0x143));if(process[_0x1ffba1(0x148)][_0x1ffba1(0x117)]!=='development')return;}this[_0x1ffba1(0x149)][_0x1ffba1(0x10d)]('Canceling\x20all\x20old\x20background\x20checks...'),await this[_0x1ffba1(0x13f)][_0x1ffba1(0x13a)]({'name':{'$nin':[enums_1[_0x1ffba1(0x150)][_0x1ffba1(0x112)],enums_1[_0x1ffba1(0x150)][_0x1ffba1(0x144)]]},'type':_0x1ffba1(0x123)}),this[_0x1ffba1(0x149)][_0x1ffba1(0x10d)](_0x1ffba1(0x13d));const _0x3140d6=await this['scheduleService'][_0x1ffba1(0x10f)](new Date());this[_0x1ffba1(0x149)][_0x1ffba1(0x10d)](_0x1ffba1(0x116)+(_0x3140d6===null||_0x3140d6===void 0x0?void 0x0:_0x3140d6[_0x1ffba1(0x14d)]));if(!_0x3140d6||!_0x3140d6[_0x1ffba1(0x11d)]||_0x3140d6[_0x1ffba1(0x11d)][_0x1ffba1(0x11b)]===0x0)return;_0x3140d6[_0x1ffba1(0x11d)][_0x1ffba1(0x11f)](_0x47f0d8=>{const _0x561ae5=_0x1ffba1;this['logger'][_0x561ae5(0x10d)](_0x561ae5(0x106)+_0x47f0d8[_0x561ae5(0x145)]+_0x561ae5(0x147)+_0x47f0d8[_0x561ae5(0x139)]+_0x561ae5(0x147)+_0x47f0d8[_0x561ae5(0x14d)]);const _0x4f780d=new Date(),_0x220d05=_0x4f780d[_0x561ae5(0x12f)](),_0x977997=_0x4f780d['getMinutes'](),_0x1af0ec=_0x4f780d[_0x561ae5(0x138)](),[_0x3cc5cc,_0x3644cd,_0x14e584]=_0x47f0d8[_0x561ae5(0x145)][_0x561ae5(0x14f)](':');if(+_0x3cc5cc<_0x220d05||+_0x3cc5cc===_0x220d05&&+_0x3644cd<_0x977997||+_0x3cc5cc===_0x220d05&&+_0x3644cd===_0x977997&&+_0x14e584<_0x1af0ec)return;_0x4f780d[_0x561ae5(0x130)](+_0x3cc5cc),_0x4f780d[_0x561ae5(0x13c)](+_0x3644cd),_0x4f780d['setSeconds'](+_0x14e584);switch(_0x47f0d8[_0x561ae5(0x139)]){case enums_1[_0x561ae5(0x114)][_0x561ae5(0x135)]:{const {soundId:_0x1886e9,durationInSecond:_0x3ed8da}=_0x47f0d8[_0x561ae5(0x137)];if(!_0x1886e9)return;const _0xab90ad={'soundId':_0x1886e9,'durationInSecond':_0x3ed8da,'audit':{'actor':enums_1['AuditActor']['Job'],'name':enums_1[_0x561ae5(0x114)][_0x561ae5(0x135)],'message':'Event:\x20'+_0x47f0d8[_0x561ae5(0x14d)]+_0x561ae5(0x136)+_0x3140d6['name']}};this[_0x561ae5(0x13f)]['schedule'](_0x4f780d,enums_1[_0x561ae5(0x114)]['PlaySound'],_0xab90ad);break;}case enums_1[_0x561ae5(0x114)][_0x561ae5(0x12c)]:{const {playlistId:_0x17eb97,durationInSecond:_0x4cd1d5}=_0x47f0d8[_0x561ae5(0x137)];if(!_0x17eb97)return;const _0x1e7eea={'playlistId':_0x17eb97,'durationInSecond':_0x4cd1d5,'audit':{'actor':enums_1['AuditActor'][_0x561ae5(0x12a)],'name':enums_1['JobType'][_0x561ae5(0x12c)],'message':_0x561ae5(0x109)+_0x47f0d8['name']+_0x561ae5(0x136)+_0x3140d6[_0x561ae5(0x14d)]}};this[_0x561ae5(0x13f)]['schedule'](_0x4f780d,enums_1['JobType']['PlayMusic'],_0x1e7eea);break;}case enums_1[_0x561ae5(0x114)]['PlayVoiceRecorded']:{const {voiceId:_0x1b10eb,durationInSecond:_0x3b5821}=_0x47f0d8[_0x561ae5(0x137)];if(!_0x1b10eb)return;const _0x483f52={'voiceId':_0x1b10eb,'durationInSecond':_0x3b5821,'audit':{'actor':enums_1[_0x561ae5(0x10a)][_0x561ae5(0x12a)],'name':enums_1[_0x561ae5(0x114)][_0x561ae5(0x118)],'message':'Event:\x20'+_0x47f0d8[_0x561ae5(0x14d)]+'\x20-\x20Schedule:\x20'+_0x3140d6[_0x561ae5(0x14d)]}};this[_0x561ae5(0x13f)]['schedule'](_0x4f780d,enums_1[_0x561ae5(0x114)][_0x561ae5(0x118)],_0x483f52);break;}case enums_1[_0x561ae5(0x114)][_0x561ae5(0x13e)]:{const {textToAudioId:_0x541996,durationInSecond:_0x421857}=_0x47f0d8[_0x561ae5(0x137)];if(!_0x541996)return;const _0x234c0f={'textToAudioId':_0x541996,'durationInSecond':_0x421857,'audit':{'actor':enums_1[_0x561ae5(0x10a)]['Job'],'name':enums_1[_0x561ae5(0x114)][_0x561ae5(0x13e)],'message':'Event:\x20'+_0x47f0d8['name']+_0x561ae5(0x136)+_0x3140d6[_0x561ae5(0x14d)]}};this[_0x561ae5(0x13f)][_0x561ae5(0x125)](_0x4f780d,enums_1[_0x561ae5(0x114)]['PlayTextToAudio'],_0x234c0f);break;}default:return;}}),this[_0x1ffba1(0x149)]['log'](_0x1ffba1(0x124));}async[a9_0x53b7a7(0x146)](_0xfbecaf){const _0x3f93f7=a9_0x53b7a7;this[_0x3f93f7(0x149)][_0x3f93f7(0x10d)](_0x3f93f7(0x132));const {success:_0x59862e,message:_0x4f8b6c}=await(0x0,file_1[_0x3f93f7(0x13b)])(constants_1[_0x3f93f7(0x107)]);!_0x59862e&&this[_0x3f93f7(0x149)]['error']('Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20'+_0x4f8b6c);}};__decorate([(0x0,nestjs_agenda_1['Define'])(enums_1[a9_0x53b7a7(0x150)][a9_0x53b7a7(0x112)]),__metadata('design:type',Function),__metadata('design:paramtypes',[agenda_1[a9_0x53b7a7(0x12a)]]),__metadata(a9_0x53b7a7(0x111),Promise)],JobProccessor[a9_0x53b7a7(0x10c)],'checkEvent',null),__decorate([(0x0,nestjs_agenda_1[a9_0x53b7a7(0x113)])(enums_1['BackgroundJobType'][a9_0x53b7a7(0x144)]),__metadata(a9_0x53b7a7(0x131),Function),__metadata(a9_0x53b7a7(0x122),[agenda_1['Job']]),__metadata(a9_0x53b7a7(0x111),Promise)],JobProccessor[a9_0x53b7a7(0x10c)],'purgeTempUploadedFiles',null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x53b7a7(0x133)])(),__metadata(a9_0x53b7a7(0x122),[nestjs_agenda_1[a9_0x53b7a7(0x11a)],schedule_service_1[a9_0x53b7a7(0x129)],setting_service_1['SettingService']])],JobProccessor),exports['JobProccessor']=JobProccessor;