'use strict';const a9_0x3ce42f=a9_0x3b4e;(function(_0x1523af,_0x558633){const _0x1e8020=a9_0x3b4e,_0x24ce79=_0x1523af();while(!![]){try{const _0x462181=-parseInt(_0x1e8020(0x173))/0x1+-parseInt(_0x1e8020(0x16d))/0x2+parseInt(_0x1e8020(0x1b0))/0x3+parseInt(_0x1e8020(0x1a6))/0x4*(parseInt(_0x1e8020(0x188))/0x5)+-parseInt(_0x1e8020(0x16e))/0x6+parseInt(_0x1e8020(0x187))/0x7+-parseInt(_0x1e8020(0x1b9))/0x8;if(_0x462181===_0x558633)break;else _0x24ce79['push'](_0x24ce79['shift']());}catch(_0x6711a9){_0x24ce79['push'](_0x24ce79['shift']());}}}(a9_0x2748,0x264d2));function a9_0x2748(){const _0x4114b9=['JobType','agendaService','__metadata','isExpired','Job','116OCDBLu','Processor','BackgroundJobType','AuditActor','PlayMusic','NODE_ENV','setHours','function','Define','../common/enums','17646BomXAu','checkEvent','Scheduling\x20event:\x20','time','single','scheduleService','setSeconds','settingService','Eligible\x20schedule:\x20','654344iaMVBX','179890qEJniT','542964LpyNsZ','PlayTextToAudio','defineProperty','\x20-\x20','../common/constants','32801QmNbGc','../common/file','\x20-\x20Schedule:\x20','Canceling\x20all\x20old\x20background\x20checks...','Fetching\x20today\x20schedule...','AgendaService','getMinutes','metadata','getHours','getOwnPropertyDescriptor','jobType','development','decorate','schedule','split','__decorate','data','agenda','@nestjs/common','events','1788724PowaUE','32845NREeVB','Server\x20time:\x20','design:returntype','ScheduleService','log','purgeTempUploadedFiles','PurgeTempUploadedFiles','Invalid\x20or\x20expired\x20license\x20key!','Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20','prototype','Event:\x20','design:type','design:paramtypes','name','PlaySound','JobProccessor','env','length','PlayVoiceRecorded','logger','findEligibleSchedule','CheckEvent','@agent-ly/nestjs-agenda','Purging\x20temp\x20uploaded\x20files...','object'];a9_0x2748=function(){return _0x4114b9;};return a9_0x2748();}function a9_0x3b4e(_0x253d76,_0x3fcbfa){const _0x274842=a9_0x2748();return a9_0x3b4e=function(_0x3b4e84,_0x555290){_0x3b4e84=_0x3b4e84-0x16d;let _0x4c9ae6=_0x274842[_0x3b4e84];return _0x4c9ae6;},a9_0x3b4e(_0x253d76,_0x3fcbfa);}var __decorate=this&&this[a9_0x3ce42f(0x182)]||function(_0x556632,_0x1c8d99,_0x2d5325,_0x37f9c5){const _0x1597e0=a9_0x3ce42f;var _0x352be9=arguments['length'],_0x1b2ad8=_0x352be9<0x3?_0x1c8d99:_0x37f9c5===null?_0x37f9c5=Object[_0x1597e0(0x17c)](_0x1c8d99,_0x2d5325):_0x37f9c5,_0x53cbdf;if(typeof Reflect===_0x1597e0(0x1a0)&&typeof Reflect[_0x1597e0(0x17f)]===_0x1597e0(0x1ad))_0x1b2ad8=Reflect[_0x1597e0(0x17f)](_0x556632,_0x1c8d99,_0x2d5325,_0x37f9c5);else{for(var _0x4f2b6d=_0x556632[_0x1597e0(0x199)]-0x1;_0x4f2b6d>=0x0;_0x4f2b6d--)if(_0x53cbdf=_0x556632[_0x4f2b6d])_0x1b2ad8=(_0x352be9<0x3?_0x53cbdf(_0x1b2ad8):_0x352be9>0x3?_0x53cbdf(_0x1c8d99,_0x2d5325,_0x1b2ad8):_0x53cbdf(_0x1c8d99,_0x2d5325))||_0x1b2ad8;}return _0x352be9>0x3&&_0x1b2ad8&&Object[_0x1597e0(0x170)](_0x1c8d99,_0x2d5325,_0x1b2ad8),_0x1b2ad8;},__metadata=this&&this[a9_0x3ce42f(0x1a3)]||function(_0x23b311,_0x3a5c44){const _0x318335=a9_0x3ce42f;if(typeof Reflect===_0x318335(0x1a0)&&typeof Reflect[_0x318335(0x17a)]===_0x318335(0x1ad))return Reflect[_0x318335(0x17a)](_0x23b311,_0x3a5c44);},JobProccessor_1;Object[a9_0x3ce42f(0x170)](exports,'__esModule',{'value':!![]}),exports[a9_0x3ce42f(0x197)]=void 0x0;const common_1=require(a9_0x3ce42f(0x185)),agenda_1=require(a9_0x3ce42f(0x184)),nestjs_agenda_1=require(a9_0x3ce42f(0x19e)),enums_1=require(a9_0x3ce42f(0x1af)),schedule_service_1=require('../schedule/schedule.service'),setting_service_1=require('../setting/setting.service'),file_1=require(a9_0x3ce42f(0x174)),constants_1=require(a9_0x3ce42f(0x172));let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x52fff0,_0x1e5a39,_0x216bec){const _0x4f5edc=a9_0x3ce42f;this[_0x4f5edc(0x1a2)]=_0x52fff0,this[_0x4f5edc(0x1b5)]=_0x1e5a39,this[_0x4f5edc(0x1b7)]=_0x216bec,this[_0x4f5edc(0x19b)]=new common_1['Logger'](JobProccessor_1[_0x4f5edc(0x195)]);}async['checkEvent'](_0x7c0362){const _0x11a92b=a9_0x3ce42f;this[_0x11a92b(0x19b)]['log'](_0x11a92b(0x189)+new Date()+'.\x20Job:\x20'+_0x7c0362['attrs'][_0x11a92b(0x195)]);const _0x37d941=await this[_0x11a92b(0x1b7)]['updateExpiryStatus']();if(_0x37d941[_0x11a92b(0x1a4)]){this[_0x11a92b(0x19b)]['log'](_0x11a92b(0x18f));if(process[_0x11a92b(0x198)][_0x11a92b(0x1ab)]!==_0x11a92b(0x17e))return;}this[_0x11a92b(0x19b)][_0x11a92b(0x18c)](_0x11a92b(0x176)),await this[_0x11a92b(0x1a2)]['cancel']({'name':{'$nin':[enums_1[_0x11a92b(0x1a8)][_0x11a92b(0x19d)],enums_1[_0x11a92b(0x1a8)][_0x11a92b(0x18e)]]},'type':_0x11a92b(0x1b4)}),this[_0x11a92b(0x19b)]['log'](_0x11a92b(0x177));const _0x13fb6c=await this['scheduleService'][_0x11a92b(0x19c)](new Date());this[_0x11a92b(0x19b)][_0x11a92b(0x18c)](_0x11a92b(0x1b8)+(_0x13fb6c===null||_0x13fb6c===void 0x0?void 0x0:_0x13fb6c[_0x11a92b(0x195)]));if(!_0x13fb6c||!_0x13fb6c[_0x11a92b(0x186)]||_0x13fb6c[_0x11a92b(0x186)][_0x11a92b(0x199)]===0x0)return;_0x13fb6c[_0x11a92b(0x186)]['forEach'](_0x4027f=>{const _0x2a3daa=_0x11a92b;this[_0x2a3daa(0x19b)][_0x2a3daa(0x18c)](_0x2a3daa(0x1b2)+_0x4027f['time']+_0x2a3daa(0x171)+_0x4027f[_0x2a3daa(0x17d)]+'\x20-\x20'+_0x4027f[_0x2a3daa(0x195)]);const _0x1a7d09=new Date(),_0x2c8313=_0x1a7d09[_0x2a3daa(0x17b)](),_0x3a0825=_0x1a7d09[_0x2a3daa(0x179)](),_0x180dd1=_0x1a7d09['getSeconds'](),[_0x40d62a,_0x13feed,_0x11162a]=_0x4027f[_0x2a3daa(0x1b3)][_0x2a3daa(0x181)](':');if(+_0x40d62a<_0x2c8313||+_0x40d62a===_0x2c8313&&+_0x13feed<_0x3a0825||+_0x40d62a===_0x2c8313&&+_0x13feed===_0x3a0825&&+_0x11162a<_0x180dd1)return;_0x1a7d09[_0x2a3daa(0x1ac)](+_0x40d62a),_0x1a7d09['setMinutes'](+_0x13feed),_0x1a7d09[_0x2a3daa(0x1b6)](+_0x11162a);switch(_0x4027f['jobType']){case enums_1[_0x2a3daa(0x1a1)][_0x2a3daa(0x196)]:{const {soundId:_0x4226cf,durationInSecond:_0x2b6ca4}=_0x4027f[_0x2a3daa(0x183)];if(!_0x4226cf)return;const _0x410331={'soundId':_0x4226cf,'durationInSecond':_0x2b6ca4,'audit':{'actor':enums_1[_0x2a3daa(0x1a9)][_0x2a3daa(0x1a5)],'name':enums_1[_0x2a3daa(0x1a1)][_0x2a3daa(0x196)],'message':_0x2a3daa(0x192)+_0x4027f[_0x2a3daa(0x195)]+_0x2a3daa(0x175)+_0x13fb6c[_0x2a3daa(0x195)]}};this['agendaService'][_0x2a3daa(0x180)](_0x1a7d09,enums_1[_0x2a3daa(0x1a1)][_0x2a3daa(0x196)],_0x410331);break;}case enums_1[_0x2a3daa(0x1a1)][_0x2a3daa(0x1aa)]:{const {playlistId:_0x2d23c8,durationInSecond:_0x1eeeec}=_0x4027f['data'];if(!_0x2d23c8)return;const _0x5d617b={'playlistId':_0x2d23c8,'durationInSecond':_0x1eeeec,'audit':{'actor':enums_1[_0x2a3daa(0x1a9)]['Job'],'name':enums_1[_0x2a3daa(0x1a1)][_0x2a3daa(0x1aa)],'message':_0x2a3daa(0x192)+_0x4027f[_0x2a3daa(0x195)]+_0x2a3daa(0x175)+_0x13fb6c[_0x2a3daa(0x195)]}};this['agendaService'][_0x2a3daa(0x180)](_0x1a7d09,enums_1['JobType']['PlayMusic'],_0x5d617b);break;}case enums_1[_0x2a3daa(0x1a1)]['PlayVoiceRecorded']:{const {voiceId:_0x56d0f5,durationInSecond:_0x3d3e44}=_0x4027f[_0x2a3daa(0x183)];if(!_0x56d0f5)return;const _0x2005fd={'voiceId':_0x56d0f5,'durationInSecond':_0x3d3e44,'audit':{'actor':enums_1['AuditActor']['Job'],'name':enums_1[_0x2a3daa(0x1a1)]['PlayVoiceRecorded'],'message':_0x2a3daa(0x192)+_0x4027f[_0x2a3daa(0x195)]+_0x2a3daa(0x175)+_0x13fb6c[_0x2a3daa(0x195)]}};this[_0x2a3daa(0x1a2)][_0x2a3daa(0x180)](_0x1a7d09,enums_1[_0x2a3daa(0x1a1)][_0x2a3daa(0x19a)],_0x2005fd);break;}case enums_1['JobType'][_0x2a3daa(0x16f)]:{const {textToAudioId:_0x2c2f76,durationInSecond:_0x53a521}=_0x4027f[_0x2a3daa(0x183)];if(!_0x2c2f76)return;const _0x583a0d={'textToAudioId':_0x2c2f76,'durationInSecond':_0x53a521,'audit':{'actor':enums_1[_0x2a3daa(0x1a9)][_0x2a3daa(0x1a5)],'name':enums_1[_0x2a3daa(0x1a1)][_0x2a3daa(0x16f)],'message':'Event:\x20'+_0x4027f[_0x2a3daa(0x195)]+_0x2a3daa(0x175)+_0x13fb6c[_0x2a3daa(0x195)]}};this[_0x2a3daa(0x1a2)]['schedule'](_0x1a7d09,enums_1[_0x2a3daa(0x1a1)][_0x2a3daa(0x16f)],_0x583a0d);break;}default:return;}}),this[_0x11a92b(0x19b)][_0x11a92b(0x18c)]('Events\x20scheduled!');}async[a9_0x3ce42f(0x18d)](_0x47d9c4){const _0x558798=a9_0x3ce42f;this[_0x558798(0x19b)][_0x558798(0x18c)](_0x558798(0x19f));const {success:_0x46a8b8,message:_0x5b5500}=await(0x0,file_1['deleteFilesInFolder'])(constants_1['TMP_UPLOAD_DIR']);!_0x46a8b8&&this['logger']['error'](_0x558798(0x190)+_0x5b5500);}};__decorate([(0x0,nestjs_agenda_1['Define'])(enums_1[a9_0x3ce42f(0x1a8)][a9_0x3ce42f(0x19d)]),__metadata(a9_0x3ce42f(0x193),Function),__metadata(a9_0x3ce42f(0x194),[agenda_1[a9_0x3ce42f(0x1a5)]]),__metadata(a9_0x3ce42f(0x18a),Promise)],JobProccessor[a9_0x3ce42f(0x191)],a9_0x3ce42f(0x1b1),null),__decorate([(0x0,nestjs_agenda_1[a9_0x3ce42f(0x1ae)])(enums_1[a9_0x3ce42f(0x1a8)][a9_0x3ce42f(0x18e)]),__metadata('design:type',Function),__metadata(a9_0x3ce42f(0x194),[agenda_1['Job']]),__metadata(a9_0x3ce42f(0x18a),Promise)],JobProccessor['prototype'],a9_0x3ce42f(0x18d),null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x3ce42f(0x1a7)])(),__metadata(a9_0x3ce42f(0x194),[nestjs_agenda_1[a9_0x3ce42f(0x178)],schedule_service_1[a9_0x3ce42f(0x18b)],setting_service_1['SettingService']])],JobProccessor),exports[a9_0x3ce42f(0x197)]=JobProccessor;