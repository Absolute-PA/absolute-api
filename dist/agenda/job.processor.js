'use strict';const a9_0x4cadbe=a9_0x3c3a;(function(_0x5c58dd,_0x512b46){const _0xdffb68=a9_0x3c3a,_0x3b08c6=_0x5c58dd();while(!![]){try{const _0x4e757e=-parseInt(_0xdffb68(0xa6))/0x1+parseInt(_0xdffb68(0x8b))/0x2+parseInt(_0xdffb68(0x80))/0x3+parseInt(_0xdffb68(0xa4))/0x4*(parseInt(_0xdffb68(0x9a))/0x5)+parseInt(_0xdffb68(0xa3))/0x6+parseInt(_0xdffb68(0x71))/0x7*(-parseInt(_0xdffb68(0x6d))/0x8)+-parseInt(_0xdffb68(0x74))/0x9;if(_0x4e757e===_0x512b46)break;else _0x3b08c6['push'](_0x3b08c6['shift']());}catch(_0x2dd168){_0x3b08c6['push'](_0x3b08c6['shift']());}}}(a9_0x1f1d,0xd5d1a));function a9_0x1f1d(){const _0x619810=['purgeTempUploadedFiles','split','data','function','../setting/setting.service','AuditActor','agendaService','104wPrlGH','decorate','attrs','Eligible\x20schedule:\x20','590961vanXmx','time','defineProperty','7694613ijpQco','Server\x20time:\x20','logger','agenda','Processor','checkEvent','getMinutes','design:type','forEach','PlayVoiceRecorded','\x20-\x20Schedule:\x20','../common/enums','137355ehjmIz','../common/constants','design:paramtypes','getSeconds','JobProccessor','design:returntype','__metadata','scheduleService','settingService','@nestjs/common','Fetching\x20today\x20schedule...','2806574Aqqcbo','PlayTextToAudio','Events\x20scheduled!','Logger','schedule','.\x20Job:\x20','setMinutes','PlaySound','getHours','metadata','NODE_ENV','findEligibleSchedule','isExpired','deleteFilesInFolder','Purging\x20temp\x20uploaded\x20files...','145HSqCTb','../schedule/schedule.service','Define','BackgroundJobType','SettingService','Canceling\x20all\x20old\x20background\x20checks...','jobType','PurgeTempUploadedFiles','log','3104826fTeFRk','182536zWOGEt','cancel','461671vXyzmV','name','events','Event:\x20','Job','object','CheckEvent','length','ScheduleService','\x20-\x20','JobType','PlayMusic','getOwnPropertyDescriptor'];a9_0x1f1d=function(){return _0x619810;};return a9_0x1f1d();}function a9_0x3c3a(_0x43d3fb,_0x11523a){const _0x1f1d5a=a9_0x1f1d();return a9_0x3c3a=function(_0x3c3a2c,_0x862a4a){_0x3c3a2c=_0x3c3a2c-0x6c;let _0x12a9bf=_0x1f1d5a[_0x3c3a2c];return _0x12a9bf;},a9_0x3c3a(_0x43d3fb,_0x11523a);}var __decorate=this&&this['__decorate']||function(_0x27bbe4,_0x3a121f,_0x1c2f9a,_0x1e8200){const _0x2de3c5=a9_0x3c3a;var _0x3bd866=arguments['length'],_0x25ab95=_0x3bd866<0x3?_0x3a121f:_0x1e8200===null?_0x1e8200=Object[_0x2de3c5(0xb2)](_0x3a121f,_0x1c2f9a):_0x1e8200,_0x24ef25;if(typeof Reflect===_0x2de3c5(0xab)&&typeof Reflect[_0x2de3c5(0x6e)]===_0x2de3c5(0xb6))_0x25ab95=Reflect[_0x2de3c5(0x6e)](_0x27bbe4,_0x3a121f,_0x1c2f9a,_0x1e8200);else{for(var _0x521893=_0x27bbe4['length']-0x1;_0x521893>=0x0;_0x521893--)if(_0x24ef25=_0x27bbe4[_0x521893])_0x25ab95=(_0x3bd866<0x3?_0x24ef25(_0x25ab95):_0x3bd866>0x3?_0x24ef25(_0x3a121f,_0x1c2f9a,_0x25ab95):_0x24ef25(_0x3a121f,_0x1c2f9a))||_0x25ab95;}return _0x3bd866>0x3&&_0x25ab95&&Object[_0x2de3c5(0x73)](_0x3a121f,_0x1c2f9a,_0x25ab95),_0x25ab95;},__metadata=this&&this[a9_0x4cadbe(0x86)]||function(_0x4bc413,_0x4c3c20){const _0x4efadc=a9_0x4cadbe;if(typeof Reflect===_0x4efadc(0xab)&&typeof Reflect[_0x4efadc(0x94)]===_0x4efadc(0xb6))return Reflect['metadata'](_0x4bc413,_0x4c3c20);},JobProccessor_1;Object[a9_0x4cadbe(0x73)](exports,'__esModule',{'value':!![]}),exports[a9_0x4cadbe(0x84)]=void 0x0;const common_1=require(a9_0x4cadbe(0x89)),agenda_1=require(a9_0x4cadbe(0x77)),nestjs_agenda_1=require('@agent-ly/nestjs-agenda'),enums_1=require(a9_0x4cadbe(0x7f)),schedule_service_1=require(a9_0x4cadbe(0x9b)),setting_service_1=require(a9_0x4cadbe(0xb7)),file_1=require('../common/file'),constants_1=require(a9_0x4cadbe(0x81));let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x16a7a4,_0x45c4ef,_0x1cbcef){const _0x24a6ae=a9_0x4cadbe;this[_0x24a6ae(0x6c)]=_0x16a7a4,this[_0x24a6ae(0x87)]=_0x45c4ef,this['settingService']=_0x1cbcef,this[_0x24a6ae(0x76)]=new common_1[(_0x24a6ae(0x8e))](JobProccessor_1[_0x24a6ae(0xa7)]);}async[a9_0x4cadbe(0x79)](_0x196618){const _0x18292e=a9_0x4cadbe;this[_0x18292e(0x76)][_0x18292e(0xa2)](_0x18292e(0x75)+new Date()+_0x18292e(0x90)+_0x196618[_0x18292e(0x6f)]['name']);const _0x2b0df3=await this[_0x18292e(0x88)]['updateExpiryStatus']();if(_0x2b0df3[_0x18292e(0x97)]){this[_0x18292e(0x76)][_0x18292e(0xa2)]('Invalid\x20or\x20expired\x20license\x20key!');if(process['env'][_0x18292e(0x95)]!=='development')return;}this[_0x18292e(0x76)][_0x18292e(0xa2)](_0x18292e(0x9f)),await this[_0x18292e(0x6c)][_0x18292e(0xa5)]({'name':{'$nin':[enums_1['BackgroundJobType']['CheckEvent'],enums_1[_0x18292e(0x9d)][_0x18292e(0xa1)]]},'type':'single'}),this[_0x18292e(0x76)][_0x18292e(0xa2)](_0x18292e(0x8a));const _0x5c9b81=await this[_0x18292e(0x87)][_0x18292e(0x96)](new Date());this[_0x18292e(0x76)][_0x18292e(0xa2)](_0x18292e(0x70)+(_0x5c9b81===null||_0x5c9b81===void 0x0?void 0x0:_0x5c9b81[_0x18292e(0xa7)]));if(!_0x5c9b81||!_0x5c9b81[_0x18292e(0xa8)]||_0x5c9b81[_0x18292e(0xa8)][_0x18292e(0xad)]===0x0)return;_0x5c9b81[_0x18292e(0xa8)][_0x18292e(0x7c)](_0x36de30=>{const _0x1664d0=_0x18292e;this['logger'][_0x1664d0(0xa2)]('Scheduling\x20event:\x20'+_0x36de30[_0x1664d0(0x72)]+_0x1664d0(0xaf)+_0x36de30[_0x1664d0(0xa0)]+_0x1664d0(0xaf)+_0x36de30['name']);const _0xc8bc8f=new Date(),_0x2e2399=_0xc8bc8f[_0x1664d0(0x93)](),_0x59e380=_0xc8bc8f[_0x1664d0(0x7a)](),_0x219e03=_0xc8bc8f[_0x1664d0(0x83)](),[_0x209a63,_0x2a095f,_0x3d4cd2]=_0x36de30[_0x1664d0(0x72)][_0x1664d0(0xb4)](':');if(+_0x209a63<_0x2e2399||+_0x209a63===_0x2e2399&&+_0x2a095f<_0x59e380||+_0x209a63===_0x2e2399&&+_0x2a095f===_0x59e380&&+_0x3d4cd2<_0x219e03)return;_0xc8bc8f['setHours'](+_0x209a63),_0xc8bc8f[_0x1664d0(0x91)](+_0x2a095f),_0xc8bc8f['setSeconds'](+_0x3d4cd2);switch(_0x36de30[_0x1664d0(0xa0)]){case enums_1['JobType'][_0x1664d0(0x92)]:{const {soundId:_0x12c6e2,durationInSecond:_0x534b46}=_0x36de30['data'];if(!_0x12c6e2)return;const _0x377b4a={'soundId':_0x12c6e2,'durationInSecond':_0x534b46,'audit':{'actor':enums_1['AuditActor'][_0x1664d0(0xaa)],'name':enums_1['JobType'][_0x1664d0(0x92)],'message':_0x1664d0(0xa9)+_0x36de30['name']+'\x20-\x20Schedule:\x20'+_0x5c9b81[_0x1664d0(0xa7)]}};this[_0x1664d0(0x6c)][_0x1664d0(0x8f)](_0xc8bc8f,enums_1[_0x1664d0(0xb0)]['PlaySound'],_0x377b4a);break;}case enums_1['JobType']['PlayMusic']:{const {playlistId:_0x2541b5,durationInSecond:_0x398075}=_0x36de30[_0x1664d0(0xb5)];if(!_0x2541b5)return;const _0x576db4={'playlistId':_0x2541b5,'durationInSecond':_0x398075,'audit':{'actor':enums_1['AuditActor']['Job'],'name':enums_1[_0x1664d0(0xb0)][_0x1664d0(0xb1)],'message':'Event:\x20'+_0x36de30[_0x1664d0(0xa7)]+_0x1664d0(0x7e)+_0x5c9b81[_0x1664d0(0xa7)]}};this[_0x1664d0(0x6c)][_0x1664d0(0x8f)](_0xc8bc8f,enums_1[_0x1664d0(0xb0)]['PlayMusic'],_0x576db4);break;}case enums_1['JobType'][_0x1664d0(0x7d)]:{const {voiceId:_0x24db50,durationInSecond:_0x42a0a7}=_0x36de30[_0x1664d0(0xb5)];if(!_0x24db50)return;const _0x2c1da2={'voiceId':_0x24db50,'durationInSecond':_0x42a0a7,'audit':{'actor':enums_1[_0x1664d0(0xb8)][_0x1664d0(0xaa)],'name':enums_1[_0x1664d0(0xb0)][_0x1664d0(0x7d)],'message':_0x1664d0(0xa9)+_0x36de30[_0x1664d0(0xa7)]+'\x20-\x20Schedule:\x20'+_0x5c9b81[_0x1664d0(0xa7)]}};this['agendaService'][_0x1664d0(0x8f)](_0xc8bc8f,enums_1['JobType'][_0x1664d0(0x7d)],_0x2c1da2);break;}case enums_1[_0x1664d0(0xb0)][_0x1664d0(0x8c)]:{const {textToAudioId:_0x3d681a,durationInSecond:_0x1eabbd}=_0x36de30[_0x1664d0(0xb5)];if(!_0x3d681a)return;const _0x19e9fd={'textToAudioId':_0x3d681a,'durationInSecond':_0x1eabbd,'audit':{'actor':enums_1['AuditActor'][_0x1664d0(0xaa)],'name':enums_1[_0x1664d0(0xb0)][_0x1664d0(0x8c)],'message':_0x1664d0(0xa9)+_0x36de30[_0x1664d0(0xa7)]+_0x1664d0(0x7e)+_0x5c9b81[_0x1664d0(0xa7)]}};this[_0x1664d0(0x6c)][_0x1664d0(0x8f)](_0xc8bc8f,enums_1[_0x1664d0(0xb0)][_0x1664d0(0x8c)],_0x19e9fd);break;}default:return;}}),this['logger']['log'](_0x18292e(0x8d));}async[a9_0x4cadbe(0xb3)](_0x18f14a){const _0x3d9e53=a9_0x4cadbe;this[_0x3d9e53(0x76)][_0x3d9e53(0xa2)](_0x3d9e53(0x99));const {success:_0x152ce3,message:_0x4e0ba4}=await(0x0,file_1[_0x3d9e53(0x98)])(constants_1['TMP_UPLOAD_DIR']);!_0x152ce3&&this['logger']['error']('Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20'+_0x4e0ba4);}};__decorate([(0x0,nestjs_agenda_1['Define'])(enums_1[a9_0x4cadbe(0x9d)][a9_0x4cadbe(0xac)]),__metadata(a9_0x4cadbe(0x7b),Function),__metadata('design:paramtypes',[agenda_1[a9_0x4cadbe(0xaa)]]),__metadata(a9_0x4cadbe(0x85),Promise)],JobProccessor['prototype'],'checkEvent',null),__decorate([(0x0,nestjs_agenda_1[a9_0x4cadbe(0x9c)])(enums_1[a9_0x4cadbe(0x9d)]['PurgeTempUploadedFiles']),__metadata(a9_0x4cadbe(0x7b),Function),__metadata('design:paramtypes',[agenda_1[a9_0x4cadbe(0xaa)]]),__metadata(a9_0x4cadbe(0x85),Promise)],JobProccessor['prototype'],'purgeTempUploadedFiles',null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x4cadbe(0x78)])(),__metadata(a9_0x4cadbe(0x82),[nestjs_agenda_1['AgendaService'],schedule_service_1[a9_0x4cadbe(0xae)],setting_service_1[a9_0x4cadbe(0x9e)]])],JobProccessor),exports[a9_0x4cadbe(0x84)]=JobProccessor;