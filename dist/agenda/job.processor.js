'use strict';const a9_0x4ee14b=a9_0x3bdf;(function(_0x7ca5a6,_0x147682){const _0x1c3431=a9_0x3bdf,_0x3071f6=_0x7ca5a6();while(!![]){try{const _0x3dd357=-parseInt(_0x1c3431(0x194))/0x1*(parseInt(_0x1c3431(0x15c))/0x2)+-parseInt(_0x1c3431(0x17c))/0x3*(parseInt(_0x1c3431(0x152))/0x4)+-parseInt(_0x1c3431(0x171))/0x5+parseInt(_0x1c3431(0x18d))/0x6+-parseInt(_0x1c3431(0x16a))/0x7+parseInt(_0x1c3431(0x19f))/0x8*(parseInt(_0x1c3431(0x173))/0x9)+parseInt(_0x1c3431(0x18a))/0xa*(parseInt(_0x1c3431(0x16b))/0xb);if(_0x3dd357===_0x147682)break;else _0x3071f6['push'](_0x3071f6['shift']());}catch(_0x49c508){_0x3071f6['push'](_0x3071f6['shift']());}}}(a9_0x23f3,0xbf0bf));var __decorate=this&&this[a9_0x4ee14b(0x17d)]||function(_0x39f08f,_0x4970db,_0x402d81,_0x138f70){const _0x52d63b=a9_0x4ee14b;var _0x11d886=arguments[_0x52d63b(0x17e)],_0x5653db=_0x11d886<0x3?_0x4970db:_0x138f70===null?_0x138f70=Object[_0x52d63b(0x193)](_0x4970db,_0x402d81):_0x138f70,_0xa009e9;if(typeof Reflect===_0x52d63b(0x166)&&typeof Reflect[_0x52d63b(0x191)]==='function')_0x5653db=Reflect[_0x52d63b(0x191)](_0x39f08f,_0x4970db,_0x402d81,_0x138f70);else{for(var _0x4f376a=_0x39f08f['length']-0x1;_0x4f376a>=0x0;_0x4f376a--)if(_0xa009e9=_0x39f08f[_0x4f376a])_0x5653db=(_0x11d886<0x3?_0xa009e9(_0x5653db):_0x11d886>0x3?_0xa009e9(_0x4970db,_0x402d81,_0x5653db):_0xa009e9(_0x4970db,_0x402d81))||_0x5653db;}return _0x11d886>0x3&&_0x5653db&&Object[_0x52d63b(0x18c)](_0x4970db,_0x402d81,_0x5653db),_0x5653db;},__metadata=this&&this['__metadata']||function(_0x15f0fe,_0x34ebff){const _0x221c09=a9_0x4ee14b;if(typeof Reflect===_0x221c09(0x166)&&typeof Reflect[_0x221c09(0x170)]==='function')return Reflect['metadata'](_0x15f0fe,_0x34ebff);},JobProccessor_1;Object[a9_0x4ee14b(0x18c)](exports,a9_0x4ee14b(0x181),{'value':!![]}),exports[a9_0x4ee14b(0x157)]=void 0x0;function a9_0x3bdf(_0x4c9fdc,_0x5761bf){const _0x23f342=a9_0x23f3();return a9_0x3bdf=function(_0x3bdf65,_0x11cc99){_0x3bdf65=_0x3bdf65-0x151;let _0x25f892=_0x23f342[_0x3bdf65];return _0x25f892;},a9_0x3bdf(_0x4c9fdc,_0x5761bf);}const common_1=require(a9_0x4ee14b(0x155)),agenda_1=require(a9_0x4ee14b(0x16c)),nestjs_agenda_1=require(a9_0x4ee14b(0x175)),enums_1=require(a9_0x4ee14b(0x18b)),schedule_service_1=require(a9_0x4ee14b(0x15d)),setting_service_1=require(a9_0x4ee14b(0x196)),file_1=require(a9_0x4ee14b(0x178)),constants_1=require('../common/constants');function a9_0x23f3(){const _0xb9501c=['design:returntype','jobType','design:paramtypes','910vgZvUt','../common/enums','defineProperty','5684292XvBWOw','logger','AuditActor','PurgeTempUploadedFiles','decorate','name','getOwnPropertyDescriptor','500XRmVaE','setHours','../setting/setting.service','PlayTextToAudio','agendaService','events','design:type','setSeconds','time','setMinutes','\x20-\x20','32KliceO','AgendaService','purgeTempUploadedFiles','1133168nEgVQW','Purging\x20temp\x20uploaded\x20files...','error','@nestjs/common','Job','JobProccessor','PlayMusic','cancel','split','Eligible\x20schedule:\x20','2012xTeUlc','../schedule/schedule.service','\x20-\x20Schedule:\x20','SettingService','log','attrs','BackgroundJobType','forEach','.\x20Job:\x20','settingService','object','single','Event:\x20','PlaySound','1071224GdXWQn','187011TDAMxw','agenda','data','Scheduling\x20event:\x20','Logger','metadata','5643050vntDgG','updateExpiryStatus','3350601QkKkms','CheckEvent','@agent-ly/nestjs-agenda','Define','getHours','../common/file','Processor','checkEvent','PlayVoiceRecorded','15efWqvj','__decorate','length','Fetching\x20today\x20schedule...','prototype','__esModule','development','scheduleService','schedule','JobType','Canceling\x20all\x20old\x20background\x20checks...'];a9_0x23f3=function(){return _0xb9501c;};return a9_0x23f3();}let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x55d0a5,_0x2de072,_0x9afda8){const _0xf405f4=a9_0x4ee14b;this[_0xf405f4(0x198)]=_0x55d0a5,this['scheduleService']=_0x2de072,this['settingService']=_0x9afda8,this['logger']=new common_1[(_0xf405f4(0x16f))](JobProccessor_1['name']);}async[a9_0x4ee14b(0x17a)](_0xd01147){const _0x2bcf9b=a9_0x4ee14b;this[_0x2bcf9b(0x18e)][_0x2bcf9b(0x160)]('Server\x20time:\x20'+new Date()+_0x2bcf9b(0x164)+_0xd01147[_0x2bcf9b(0x161)][_0x2bcf9b(0x192)]);const _0x25b975=await this[_0x2bcf9b(0x165)][_0x2bcf9b(0x172)]();if(_0x25b975['isExpired']){this[_0x2bcf9b(0x18e)][_0x2bcf9b(0x160)]('Invalid\x20or\x20expired\x20license\x20key!');if(process['env']['NODE_ENV']!==_0x2bcf9b(0x182))return;}this[_0x2bcf9b(0x18e)][_0x2bcf9b(0x160)](_0x2bcf9b(0x186)),await this[_0x2bcf9b(0x198)][_0x2bcf9b(0x159)]({'name':{'$nin':[enums_1[_0x2bcf9b(0x162)]['CheckEvent'],enums_1[_0x2bcf9b(0x162)][_0x2bcf9b(0x190)]]},'type':_0x2bcf9b(0x167)}),this[_0x2bcf9b(0x18e)][_0x2bcf9b(0x160)](_0x2bcf9b(0x17f));const _0x55a960=await this[_0x2bcf9b(0x183)]['findEligibleSchedule'](new Date());this[_0x2bcf9b(0x18e)]['log'](_0x2bcf9b(0x15b)+(_0x55a960===null||_0x55a960===void 0x0?void 0x0:_0x55a960[_0x2bcf9b(0x192)]));if(!_0x55a960||!_0x55a960[_0x2bcf9b(0x199)]||_0x55a960[_0x2bcf9b(0x199)]['length']===0x0)return;_0x55a960[_0x2bcf9b(0x199)][_0x2bcf9b(0x163)](_0x33300e=>{const _0x52595a=_0x2bcf9b;this[_0x52595a(0x18e)]['log'](_0x52595a(0x16e)+_0x33300e[_0x52595a(0x19c)]+'\x20-\x20'+_0x33300e[_0x52595a(0x188)]+_0x52595a(0x19e)+_0x33300e[_0x52595a(0x192)]);const _0x5ab57a=new Date(),_0x429326=_0x5ab57a[_0x52595a(0x177)](),_0xf43c5c=_0x5ab57a['getMinutes'](),_0x5a651e=_0x5ab57a['getSeconds'](),[_0x48287e,_0x2de363,_0xd25754]=_0x33300e[_0x52595a(0x19c)][_0x52595a(0x15a)](':');if(+_0x48287e<_0x429326||+_0x48287e===_0x429326&&+_0x2de363<_0xf43c5c||+_0x48287e===_0x429326&&+_0x2de363===_0xf43c5c&&+_0xd25754<_0x5a651e)return;_0x5ab57a[_0x52595a(0x195)](+_0x48287e),_0x5ab57a[_0x52595a(0x19d)](+_0x2de363),_0x5ab57a[_0x52595a(0x19b)](+_0xd25754);switch(_0x33300e[_0x52595a(0x188)]){case enums_1[_0x52595a(0x185)][_0x52595a(0x169)]:{const {soundId:_0x75a6e,durationInSecond:_0xe210db}=_0x33300e[_0x52595a(0x16d)];if(!_0x75a6e)return;const _0x3a2eb4={'soundId':_0x75a6e,'durationInSecond':_0xe210db,'audit':{'actor':enums_1[_0x52595a(0x18f)][_0x52595a(0x156)],'name':enums_1['JobType'][_0x52595a(0x169)],'message':_0x52595a(0x168)+_0x33300e['name']+_0x52595a(0x15e)+_0x55a960['name']}};this['agendaService']['schedule'](_0x5ab57a,enums_1[_0x52595a(0x185)][_0x52595a(0x169)],_0x3a2eb4);break;}case enums_1[_0x52595a(0x185)][_0x52595a(0x158)]:{const {playlistId:_0x50b5d1,durationInSecond:_0x8b7171}=_0x33300e[_0x52595a(0x16d)];if(!_0x50b5d1)return;const _0x2ac6d0={'playlistId':_0x50b5d1,'durationInSecond':_0x8b7171,'audit':{'actor':enums_1[_0x52595a(0x18f)][_0x52595a(0x156)],'name':enums_1[_0x52595a(0x185)]['PlayMusic'],'message':'Event:\x20'+_0x33300e[_0x52595a(0x192)]+_0x52595a(0x15e)+_0x55a960[_0x52595a(0x192)]}};this[_0x52595a(0x198)][_0x52595a(0x184)](_0x5ab57a,enums_1[_0x52595a(0x185)][_0x52595a(0x158)],_0x2ac6d0);break;}case enums_1[_0x52595a(0x185)][_0x52595a(0x17b)]:{const {voiceId:_0x4c1954,durationInSecond:_0x28094b}=_0x33300e['data'];if(!_0x4c1954)return;const _0x4c18e3={'voiceId':_0x4c1954,'durationInSecond':_0x28094b,'audit':{'actor':enums_1[_0x52595a(0x18f)][_0x52595a(0x156)],'name':enums_1['JobType'][_0x52595a(0x17b)],'message':_0x52595a(0x168)+_0x33300e[_0x52595a(0x192)]+_0x52595a(0x15e)+_0x55a960[_0x52595a(0x192)]}};this[_0x52595a(0x198)]['schedule'](_0x5ab57a,enums_1['JobType'][_0x52595a(0x17b)],_0x4c18e3);break;}case enums_1[_0x52595a(0x185)][_0x52595a(0x197)]:{const {textToAudioId:_0x44ebc8,durationInSecond:_0x4d9b84}=_0x33300e[_0x52595a(0x16d)];if(!_0x44ebc8)return;const _0xd0b223={'textToAudioId':_0x44ebc8,'durationInSecond':_0x4d9b84,'audit':{'actor':enums_1[_0x52595a(0x18f)][_0x52595a(0x156)],'name':enums_1[_0x52595a(0x185)][_0x52595a(0x197)],'message':'Event:\x20'+_0x33300e[_0x52595a(0x192)]+_0x52595a(0x15e)+_0x55a960[_0x52595a(0x192)]}};this[_0x52595a(0x198)]['schedule'](_0x5ab57a,enums_1[_0x52595a(0x185)]['PlayTextToAudio'],_0xd0b223);break;}default:return;}}),this['logger']['log']('Events\x20scheduled!');}async['purgeTempUploadedFiles'](_0x463625){const _0xf956cb=a9_0x4ee14b;this[_0xf956cb(0x18e)][_0xf956cb(0x160)](_0xf956cb(0x153));const {success:_0x15970d,message:_0x5eaff3}=await(0x0,file_1['deleteFilesInFolder'])(constants_1['TMP_UPLOAD_DIR']);!_0x15970d&&this['logger'][_0xf956cb(0x154)]('Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20'+_0x5eaff3);}};__decorate([(0x0,nestjs_agenda_1[a9_0x4ee14b(0x176)])(enums_1[a9_0x4ee14b(0x162)][a9_0x4ee14b(0x174)]),__metadata(a9_0x4ee14b(0x19a),Function),__metadata(a9_0x4ee14b(0x189),[agenda_1[a9_0x4ee14b(0x156)]]),__metadata('design:returntype',Promise)],JobProccessor[a9_0x4ee14b(0x180)],'checkEvent',null),__decorate([(0x0,nestjs_agenda_1[a9_0x4ee14b(0x176)])(enums_1['BackgroundJobType'][a9_0x4ee14b(0x190)]),__metadata(a9_0x4ee14b(0x19a),Function),__metadata(a9_0x4ee14b(0x189),[agenda_1[a9_0x4ee14b(0x156)]]),__metadata(a9_0x4ee14b(0x187),Promise)],JobProccessor[a9_0x4ee14b(0x180)],a9_0x4ee14b(0x151),null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x4ee14b(0x179)])(),__metadata('design:paramtypes',[nestjs_agenda_1[a9_0x4ee14b(0x1a0)],schedule_service_1['ScheduleService'],setting_service_1[a9_0x4ee14b(0x15f)]])],JobProccessor),exports[a9_0x4ee14b(0x157)]=JobProccessor;