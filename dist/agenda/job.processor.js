'use strict';const a9_0x3aa0d2=a9_0x4754;(function(_0x4e5ee1,_0xd7e11f){const _0x1c2082=a9_0x4754,_0xaa1e7f=_0x4e5ee1();while(!![]){try{const _0x28b1c0=parseInt(_0x1c2082(0x1dd))/0x1+-parseInt(_0x1c2082(0x1e2))/0x2*(-parseInt(_0x1c2082(0x1c5))/0x3)+-parseInt(_0x1c2082(0x1c3))/0x4*(parseInt(_0x1c2082(0x1fa))/0x5)+-parseInt(_0x1c2082(0x1d6))/0x6+parseInt(_0x1c2082(0x1cc))/0x7+parseInt(_0x1c2082(0x1d0))/0x8*(parseInt(_0x1c2082(0x1cf))/0x9)+parseInt(_0x1c2082(0x1bf))/0xa*(-parseInt(_0x1c2082(0x1e5))/0xb);if(_0x28b1c0===_0xd7e11f)break;else _0xaa1e7f['push'](_0xaa1e7f['shift']());}catch(_0x289757){_0xaa1e7f['push'](_0xaa1e7f['shift']());}}}(a9_0x2519,0x5de7a));function a9_0x4754(_0x594f32,_0x32ded3){const _0x251911=a9_0x2519();return a9_0x4754=function(_0x4754f1,_0x5540bf){_0x4754f1=_0x4754f1-0x1a9;let _0xd1937d=_0x251911[_0x4754f1];return _0xd1937d;},a9_0x4754(_0x594f32,_0x32ded3);}var __decorate=this&&this[a9_0x3aa0d2(0x1d9)]||function(_0x3ed783,_0x30ebd7,_0x37081f,_0x2445ec){const _0x30d0df=a9_0x3aa0d2;var _0x1f6d6b=arguments[_0x30d0df(0x1ab)],_0x333e8c=_0x1f6d6b<0x3?_0x30ebd7:_0x2445ec===null?_0x2445ec=Object[_0x30d0df(0x1d1)](_0x30ebd7,_0x37081f):_0x2445ec,_0x2a2b37;if(typeof Reflect===_0x30d0df(0x1f5)&&typeof Reflect[_0x30d0df(0x1c8)]===_0x30d0df(0x1b0))_0x333e8c=Reflect[_0x30d0df(0x1c8)](_0x3ed783,_0x30ebd7,_0x37081f,_0x2445ec);else{for(var _0x1253bb=_0x3ed783[_0x30d0df(0x1ab)]-0x1;_0x1253bb>=0x0;_0x1253bb--)if(_0x2a2b37=_0x3ed783[_0x1253bb])_0x333e8c=(_0x1f6d6b<0x3?_0x2a2b37(_0x333e8c):_0x1f6d6b>0x3?_0x2a2b37(_0x30ebd7,_0x37081f,_0x333e8c):_0x2a2b37(_0x30ebd7,_0x37081f))||_0x333e8c;}return _0x1f6d6b>0x3&&_0x333e8c&&Object['defineProperty'](_0x30ebd7,_0x37081f,_0x333e8c),_0x333e8c;},__metadata=this&&this[a9_0x3aa0d2(0x1eb)]||function(_0xccb00,_0x550f6a){const _0x23b354=a9_0x3aa0d2;if(typeof Reflect==='object'&&typeof Reflect[_0x23b354(0x1ac)]===_0x23b354(0x1b0))return Reflect[_0x23b354(0x1ac)](_0xccb00,_0x550f6a);},JobProccessor_1;Object[a9_0x3aa0d2(0x1e3)](exports,a9_0x3aa0d2(0x1ad),{'value':!![]}),exports[a9_0x3aa0d2(0x1ce)]=void 0x0;function a9_0x2519(){const _0x1946af=['../schedule/schedule.service','jobType','4298568DbqXvm','AuditActor','scheduleService','__decorate','setHours','Fetching\x20today\x20schedule...','design:paramtypes','132811ZLLxnq','name','PlaySound','events','settingService','380PXMAnr','defineProperty','development','187chtmCc','SettingService','ScheduleService','Job','.\x20Job:\x20','logger','__metadata','../common/constants','AgendaService','schedule','error','deleteFilesInFolder','../setting/setting.service','agendaService','getMinutes','CheckEvent','object','prototype','split','design:type','TMP_UPLOAD_DIR','3365fkRCPG','agenda','forEach','BackgroundJobType','length','metadata','__esModule','findEligibleSchedule','env','function','NODE_ENV','cancel','design:returntype','checkEvent','Event:\x20','PlayTextToAudio','PlayVoiceRecorded','../common/enums','Eligible\x20schedule:\x20','data','setMinutes','Server\x20time:\x20','\x20-\x20Schedule:\x20','@nestjs/common','110940MAhBiH','Processor','../common/file','single','636ndkCdc','Logger','3543WMoSvo','getSeconds','JobType','decorate','time','Events\x20scheduled!','log','3877041UulQEH','purgeTempUploadedFiles','JobProccessor','4370427OAXGZX','8hSdICd','getOwnPropertyDescriptor','\x20-\x20','isExpired'];a9_0x2519=function(){return _0x1946af;};return a9_0x2519();}const common_1=require(a9_0x3aa0d2(0x1be)),agenda_1=require(a9_0x3aa0d2(0x1fb)),nestjs_agenda_1=require('@agent-ly/nestjs-agenda'),enums_1=require(a9_0x3aa0d2(0x1b8)),schedule_service_1=require(a9_0x3aa0d2(0x1d4)),setting_service_1=require(a9_0x3aa0d2(0x1f1)),file_1=require(a9_0x3aa0d2(0x1c1)),constants_1=require(a9_0x3aa0d2(0x1ec));let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x2e6ab0,_0x145bcb,_0x30e0df){const _0x2834b1=a9_0x3aa0d2;this['agendaService']=_0x2e6ab0,this[_0x2834b1(0x1d8)]=_0x145bcb,this[_0x2834b1(0x1e1)]=_0x30e0df,this[_0x2834b1(0x1ea)]=new common_1[(_0x2834b1(0x1c4))](JobProccessor_1[_0x2834b1(0x1de)]);}async[a9_0x3aa0d2(0x1b4)](_0x138408){const _0x2c68cb=a9_0x3aa0d2;this[_0x2c68cb(0x1ea)][_0x2c68cb(0x1cb)](_0x2c68cb(0x1bc)+new Date()+_0x2c68cb(0x1e9)+_0x138408['attrs'][_0x2c68cb(0x1de)]);const _0x127254=await this[_0x2c68cb(0x1e1)]['updateExpiryStatus']();if(_0x127254[_0x2c68cb(0x1d3)]){this[_0x2c68cb(0x1ea)][_0x2c68cb(0x1cb)]('Invalid\x20or\x20expired\x20license\x20key!');if(process[_0x2c68cb(0x1af)][_0x2c68cb(0x1b1)]!==_0x2c68cb(0x1e4))return;}this[_0x2c68cb(0x1ea)]['log']('Canceling\x20all\x20old\x20background\x20checks...'),await this[_0x2c68cb(0x1f2)][_0x2c68cb(0x1b2)]({'name':{'$nin':[enums_1['BackgroundJobType'][_0x2c68cb(0x1f4)],enums_1[_0x2c68cb(0x1aa)]['PurgeTempUploadedFiles']]},'type':_0x2c68cb(0x1c2)}),this[_0x2c68cb(0x1ea)][_0x2c68cb(0x1cb)](_0x2c68cb(0x1db));const _0x464ebd=await this[_0x2c68cb(0x1d8)][_0x2c68cb(0x1ae)](new Date());this[_0x2c68cb(0x1ea)][_0x2c68cb(0x1cb)](_0x2c68cb(0x1b9)+(_0x464ebd===null||_0x464ebd===void 0x0?void 0x0:_0x464ebd['name']));if(!_0x464ebd||!_0x464ebd[_0x2c68cb(0x1e0)]||_0x464ebd[_0x2c68cb(0x1e0)][_0x2c68cb(0x1ab)]===0x0)return;_0x464ebd[_0x2c68cb(0x1e0)][_0x2c68cb(0x1a9)](_0x2269d7=>{const _0x2bacfe=_0x2c68cb;this[_0x2bacfe(0x1ea)][_0x2bacfe(0x1cb)]('Scheduling\x20event:\x20'+_0x2269d7[_0x2bacfe(0x1c9)]+_0x2bacfe(0x1d2)+_0x2269d7['jobType']+_0x2bacfe(0x1d2)+_0x2269d7[_0x2bacfe(0x1de)]);const _0x3ce411=new Date(),_0x1bddb5=_0x3ce411['getHours'](),_0x41bf47=_0x3ce411[_0x2bacfe(0x1f3)](),_0x119c79=_0x3ce411[_0x2bacfe(0x1c6)](),[_0x4b90c6,_0x1b6314,_0xb1f5b6]=_0x2269d7[_0x2bacfe(0x1c9)][_0x2bacfe(0x1f7)](':');if(+_0x4b90c6<_0x1bddb5||+_0x4b90c6===_0x1bddb5&&+_0x1b6314<_0x41bf47||+_0x4b90c6===_0x1bddb5&&+_0x1b6314===_0x41bf47&&+_0xb1f5b6<_0x119c79)return;_0x3ce411[_0x2bacfe(0x1da)](+_0x4b90c6),_0x3ce411[_0x2bacfe(0x1bb)](+_0x1b6314),_0x3ce411['setSeconds'](+_0xb1f5b6);switch(_0x2269d7[_0x2bacfe(0x1d5)]){case enums_1['JobType'][_0x2bacfe(0x1df)]:{const {soundId:_0x4db5fd,durationInSecond:_0x15a72c}=_0x2269d7['data'];if(!_0x4db5fd)return;const _0x13c47e={'soundId':_0x4db5fd,'durationInSecond':_0x15a72c,'audit':{'actor':enums_1[_0x2bacfe(0x1d7)][_0x2bacfe(0x1e8)],'name':enums_1['JobType'][_0x2bacfe(0x1df)],'message':_0x2bacfe(0x1b5)+_0x2269d7[_0x2bacfe(0x1de)]+_0x2bacfe(0x1bd)+_0x464ebd[_0x2bacfe(0x1de)]}};this[_0x2bacfe(0x1f2)][_0x2bacfe(0x1ee)](_0x3ce411,enums_1[_0x2bacfe(0x1c7)][_0x2bacfe(0x1df)],_0x13c47e);break;}case enums_1[_0x2bacfe(0x1c7)]['PlayMusic']:{const {playlistId:_0x4e0428,durationInSecond:_0x2c4b2b}=_0x2269d7[_0x2bacfe(0x1ba)];if(!_0x4e0428)return;const _0x482aac={'playlistId':_0x4e0428,'durationInSecond':_0x2c4b2b,'audit':{'actor':enums_1[_0x2bacfe(0x1d7)][_0x2bacfe(0x1e8)],'name':enums_1[_0x2bacfe(0x1c7)]['PlayMusic'],'message':_0x2bacfe(0x1b5)+_0x2269d7[_0x2bacfe(0x1de)]+_0x2bacfe(0x1bd)+_0x464ebd['name']}};this[_0x2bacfe(0x1f2)][_0x2bacfe(0x1ee)](_0x3ce411,enums_1[_0x2bacfe(0x1c7)]['PlayMusic'],_0x482aac);break;}case enums_1[_0x2bacfe(0x1c7)][_0x2bacfe(0x1b7)]:{const {voiceId:_0x1a03ba,durationInSecond:_0x4372f0}=_0x2269d7[_0x2bacfe(0x1ba)];if(!_0x1a03ba)return;const _0x350333={'voiceId':_0x1a03ba,'durationInSecond':_0x4372f0,'audit':{'actor':enums_1[_0x2bacfe(0x1d7)][_0x2bacfe(0x1e8)],'name':enums_1[_0x2bacfe(0x1c7)][_0x2bacfe(0x1b7)],'message':_0x2bacfe(0x1b5)+_0x2269d7['name']+_0x2bacfe(0x1bd)+_0x464ebd[_0x2bacfe(0x1de)]}};this[_0x2bacfe(0x1f2)]['schedule'](_0x3ce411,enums_1[_0x2bacfe(0x1c7)][_0x2bacfe(0x1b7)],_0x350333);break;}case enums_1[_0x2bacfe(0x1c7)][_0x2bacfe(0x1b6)]:{const {textToAudioId:_0x3224b4,durationInSecond:_0x3ca6e6}=_0x2269d7[_0x2bacfe(0x1ba)];if(!_0x3224b4)return;const _0x34c6b4={'textToAudioId':_0x3224b4,'durationInSecond':_0x3ca6e6,'audit':{'actor':enums_1['AuditActor']['Job'],'name':enums_1[_0x2bacfe(0x1c7)][_0x2bacfe(0x1b6)],'message':_0x2bacfe(0x1b5)+_0x2269d7[_0x2bacfe(0x1de)]+'\x20-\x20Schedule:\x20'+_0x464ebd[_0x2bacfe(0x1de)]}};this[_0x2bacfe(0x1f2)][_0x2bacfe(0x1ee)](_0x3ce411,enums_1['JobType']['PlayTextToAudio'],_0x34c6b4);break;}default:return;}}),this[_0x2c68cb(0x1ea)][_0x2c68cb(0x1cb)](_0x2c68cb(0x1ca));}async[a9_0x3aa0d2(0x1cd)](_0x7af6ca){const _0x3102f7=a9_0x3aa0d2;this[_0x3102f7(0x1ea)][_0x3102f7(0x1cb)]('Purging\x20temp\x20uploaded\x20files...');const {success:_0x1aa072,message:_0x2dc881}=await(0x0,file_1[_0x3102f7(0x1f0)])(constants_1[_0x3102f7(0x1f9)]);!_0x1aa072&&this[_0x3102f7(0x1ea)][_0x3102f7(0x1ef)]('Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20'+_0x2dc881);}};__decorate([(0x0,nestjs_agenda_1['Define'])(enums_1[a9_0x3aa0d2(0x1aa)][a9_0x3aa0d2(0x1f4)]),__metadata(a9_0x3aa0d2(0x1f8),Function),__metadata(a9_0x3aa0d2(0x1dc),[agenda_1[a9_0x3aa0d2(0x1e8)]]),__metadata(a9_0x3aa0d2(0x1b3),Promise)],JobProccessor[a9_0x3aa0d2(0x1f6)],a9_0x3aa0d2(0x1b4),null),__decorate([(0x0,nestjs_agenda_1['Define'])(enums_1[a9_0x3aa0d2(0x1aa)]['PurgeTempUploadedFiles']),__metadata(a9_0x3aa0d2(0x1f8),Function),__metadata(a9_0x3aa0d2(0x1dc),[agenda_1['Job']]),__metadata(a9_0x3aa0d2(0x1b3),Promise)],JobProccessor['prototype'],a9_0x3aa0d2(0x1cd),null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x3aa0d2(0x1c0)])(),__metadata(a9_0x3aa0d2(0x1dc),[nestjs_agenda_1[a9_0x3aa0d2(0x1ed)],schedule_service_1[a9_0x3aa0d2(0x1e7)],setting_service_1[a9_0x3aa0d2(0x1e6)]])],JobProccessor),exports[a9_0x3aa0d2(0x1ce)]=JobProccessor;