'use strict';function a9_0x3530(){const _0x1f5960=['9ECXgVd','JobType','Logger','@nestjs/common','name','design:paramtypes','1654480xWDZDq','BackgroundJobType','@agent-ly/nestjs-agenda','JobProccessor','purgeTempUploadedFiles','log','isExpired','getSeconds','development','object','PlayVoiceRecorded','.\x20Job:\x20','events','data','setMinutes','deleteFilesInFolder','2277xaLGrh','split','Scheduling\x20event:\x20','Eligible\x20schedule:\x20','cancel','TMP_UPLOAD_DIR','1830873CuxQfT','design:returntype','Events\x20scheduled!','env','agendaService','30985gbaACB','metadata','Processor','prototype','Event:\x20','NODE_ENV','7EEPcjF','time','Purging\x20temp\x20uploaded\x20files...','schedule','__metadata','setSeconds','logger','../common/constants','checkEvent','../schedule/schedule.service','getMinutes','__decorate','PlaySound','setHours','attrs','100896QYtgaP','972pESKwv','CheckEvent','length','scheduleService','jobType','Server\x20time:\x20','settingService','SettingService','Fetching\x20today\x20schedule...','AuditActor','decorate','2354394uLKFwj','Invalid\x20or\x20expired\x20license\x20key!','getOwnPropertyDescriptor','PlayTextToAudio','function','Job','PurgeTempUploadedFiles','defineProperty','5820970WuZSty','design:type','agenda','\x20-\x20','../common/enums','18kuhxGz','88JBUEcC','\x20-\x20Schedule:\x20','Define','PlayMusic','forEach'];a9_0x3530=function(){return _0x1f5960;};return a9_0x3530();}const a9_0x4a70c4=a9_0x5d42;(function(_0x4c8df7,_0x14eca8){const _0x181623=a9_0x5d42,_0x5dee27=_0x4c8df7();while(!![]){try{const _0x2ac088=parseInt(_0x181623(0x1e5))/0x1*(parseInt(_0x181623(0x1fe))/0x2)+parseInt(_0x181623(0x1cb))/0x3+-parseInt(_0x181623(0x1ff))/0x4*(-parseInt(_0x181623(0x1d0))/0x5)+parseInt(_0x181623(0x1f1))/0x6*(-parseInt(_0x181623(0x1d6))/0x7)+-parseInt(_0x181623(0x1b5))/0x8*(parseInt(_0x181623(0x204))/0x9)+-parseInt(_0x181623(0x1f9))/0xa+parseInt(_0x181623(0x1c5))/0xb*(parseInt(_0x181623(0x1e6))/0xc);if(_0x2ac088===_0x14eca8)break;else _0x5dee27['push'](_0x5dee27['shift']());}catch(_0x4c46d3){_0x5dee27['push'](_0x5dee27['shift']());}}}(a9_0x3530,0x77aa6));var __decorate=this&&this[a9_0x4a70c4(0x1e1)]||function(_0x2490b9,_0xf19860,_0x854f55,_0x1e7d45){const _0x16b84e=a9_0x4a70c4;var _0x2afaca=arguments[_0x16b84e(0x1e8)],_0x1c7928=_0x2afaca<0x3?_0xf19860:_0x1e7d45===null?_0x1e7d45=Object[_0x16b84e(0x1f3)](_0xf19860,_0x854f55):_0x1e7d45,_0x30b268;if(typeof Reflect==='object'&&typeof Reflect[_0x16b84e(0x1f0)]===_0x16b84e(0x1f5))_0x1c7928=Reflect[_0x16b84e(0x1f0)](_0x2490b9,_0xf19860,_0x854f55,_0x1e7d45);else{for(var _0x3ec601=_0x2490b9[_0x16b84e(0x1e8)]-0x1;_0x3ec601>=0x0;_0x3ec601--)if(_0x30b268=_0x2490b9[_0x3ec601])_0x1c7928=(_0x2afaca<0x3?_0x30b268(_0x1c7928):_0x2afaca>0x3?_0x30b268(_0xf19860,_0x854f55,_0x1c7928):_0x30b268(_0xf19860,_0x854f55))||_0x1c7928;}return _0x2afaca>0x3&&_0x1c7928&&Object[_0x16b84e(0x1f8)](_0xf19860,_0x854f55,_0x1c7928),_0x1c7928;},__metadata=this&&this[a9_0x4a70c4(0x1da)]||function(_0x21ba40,_0x139b7b){const _0x716c0c=a9_0x4a70c4;if(typeof Reflect===_0x716c0c(0x1be)&&typeof Reflect['metadata']===_0x716c0c(0x1f5))return Reflect[_0x716c0c(0x1d1)](_0x21ba40,_0x139b7b);},JobProccessor_1;function a9_0x5d42(_0x35a8cf,_0x423abb){const _0x353005=a9_0x3530();return a9_0x5d42=function(_0x5d4284,_0x27acb7){_0x5d4284=_0x5d4284-0x1b0;let _0x2e0f99=_0x353005[_0x5d4284];return _0x2e0f99;},a9_0x5d42(_0x35a8cf,_0x423abb);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a9_0x4a70c4(0x1b8)]=void 0x0;const common_1=require(a9_0x4a70c4(0x1b2)),agenda_1=require(a9_0x4a70c4(0x1fb)),nestjs_agenda_1=require(a9_0x4a70c4(0x1b7)),enums_1=require(a9_0x4a70c4(0x1fd)),schedule_service_1=require(a9_0x4a70c4(0x1df)),setting_service_1=require('../setting/setting.service'),file_1=require('../common/file'),constants_1=require(a9_0x4a70c4(0x1dd));let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x1d82a7,_0x3edcb4,_0x2f00fd){const _0x32bb09=a9_0x4a70c4;this['agendaService']=_0x1d82a7,this[_0x32bb09(0x1e9)]=_0x3edcb4,this['settingService']=_0x2f00fd,this[_0x32bb09(0x1dc)]=new common_1[(_0x32bb09(0x1b1))](JobProccessor_1[_0x32bb09(0x1b3)]);}async[a9_0x4a70c4(0x1de)](_0x170edb){const _0x183d47=a9_0x4a70c4;this[_0x183d47(0x1dc)][_0x183d47(0x1ba)](_0x183d47(0x1eb)+new Date()+_0x183d47(0x1c0)+_0x170edb[_0x183d47(0x1e4)][_0x183d47(0x1b3)]);const _0x389eab=await this[_0x183d47(0x1ec)]['updateExpiryStatus']();if(_0x389eab[_0x183d47(0x1bb)]){this[_0x183d47(0x1dc)]['log'](_0x183d47(0x1f2));if(process[_0x183d47(0x1ce)][_0x183d47(0x1d5)]!==_0x183d47(0x1bd))return;}this[_0x183d47(0x1dc)]['log']('Canceling\x20all\x20old\x20background\x20checks...'),await this[_0x183d47(0x1cf)][_0x183d47(0x1c9)]({'name':{'$nin':[enums_1['BackgroundJobType'][_0x183d47(0x1e7)],enums_1['BackgroundJobType'][_0x183d47(0x1f7)]]},'type':'single'}),this[_0x183d47(0x1dc)][_0x183d47(0x1ba)](_0x183d47(0x1ee));const _0x12a8b4=await this['scheduleService']['findEligibleSchedule'](new Date());this[_0x183d47(0x1dc)][_0x183d47(0x1ba)](_0x183d47(0x1c8)+(_0x12a8b4===null||_0x12a8b4===void 0x0?void 0x0:_0x12a8b4['name']));if(!_0x12a8b4||!_0x12a8b4['events']||_0x12a8b4[_0x183d47(0x1c1)]['length']===0x0)return;_0x12a8b4['events'][_0x183d47(0x203)](_0x21c8e2=>{const _0x57d0ea=_0x183d47;this[_0x57d0ea(0x1dc)]['log'](_0x57d0ea(0x1c7)+_0x21c8e2[_0x57d0ea(0x1d7)]+'\x20-\x20'+_0x21c8e2[_0x57d0ea(0x1ea)]+_0x57d0ea(0x1fc)+_0x21c8e2['name']);const _0x44715b=new Date(),_0x261a66=_0x44715b['getHours'](),_0x244b10=_0x44715b[_0x57d0ea(0x1e0)](),_0xfce477=_0x44715b[_0x57d0ea(0x1bc)](),[_0x1dd6e7,_0x56e7c1,_0xac1b05]=_0x21c8e2['time'][_0x57d0ea(0x1c6)](':');if(+_0x1dd6e7<_0x261a66||+_0x1dd6e7===_0x261a66&&+_0x56e7c1<_0x244b10||+_0x1dd6e7===_0x261a66&&+_0x56e7c1===_0x244b10&&+_0xac1b05<_0xfce477)return;_0x44715b[_0x57d0ea(0x1e3)](+_0x1dd6e7),_0x44715b[_0x57d0ea(0x1c3)](+_0x56e7c1),_0x44715b[_0x57d0ea(0x1db)](+_0xac1b05);switch(_0x21c8e2[_0x57d0ea(0x1ea)]){case enums_1['JobType'][_0x57d0ea(0x1e2)]:{const {soundId:_0x23dbed,durationInSecond:_0x32cba6}=_0x21c8e2[_0x57d0ea(0x1c2)];if(!_0x23dbed)return;const _0x1abd53={'soundId':_0x23dbed,'durationInSecond':_0x32cba6,'audit':{'actor':enums_1[_0x57d0ea(0x1ef)][_0x57d0ea(0x1f6)],'name':enums_1[_0x57d0ea(0x1b0)][_0x57d0ea(0x1e2)],'message':_0x57d0ea(0x1d4)+_0x21c8e2[_0x57d0ea(0x1b3)]+_0x57d0ea(0x200)+_0x12a8b4[_0x57d0ea(0x1b3)]}};this[_0x57d0ea(0x1cf)]['schedule'](_0x44715b,enums_1['JobType'][_0x57d0ea(0x1e2)],_0x1abd53);break;}case enums_1['JobType']['PlayMusic']:{const {playlistId:_0x30a645,durationInSecond:_0x397a06}=_0x21c8e2[_0x57d0ea(0x1c2)];if(!_0x30a645)return;const _0x246269={'playlistId':_0x30a645,'durationInSecond':_0x397a06,'audit':{'actor':enums_1[_0x57d0ea(0x1ef)]['Job'],'name':enums_1[_0x57d0ea(0x1b0)][_0x57d0ea(0x202)],'message':_0x57d0ea(0x1d4)+_0x21c8e2[_0x57d0ea(0x1b3)]+_0x57d0ea(0x200)+_0x12a8b4['name']}};this[_0x57d0ea(0x1cf)]['schedule'](_0x44715b,enums_1[_0x57d0ea(0x1b0)]['PlayMusic'],_0x246269);break;}case enums_1[_0x57d0ea(0x1b0)][_0x57d0ea(0x1bf)]:{const {voiceId:_0x44d6b4,durationInSecond:_0x5b828a}=_0x21c8e2[_0x57d0ea(0x1c2)];if(!_0x44d6b4)return;const _0x3fd90d={'voiceId':_0x44d6b4,'durationInSecond':_0x5b828a,'audit':{'actor':enums_1[_0x57d0ea(0x1ef)][_0x57d0ea(0x1f6)],'name':enums_1['JobType']['PlayVoiceRecorded'],'message':_0x57d0ea(0x1d4)+_0x21c8e2[_0x57d0ea(0x1b3)]+_0x57d0ea(0x200)+_0x12a8b4['name']}};this[_0x57d0ea(0x1cf)][_0x57d0ea(0x1d9)](_0x44715b,enums_1[_0x57d0ea(0x1b0)][_0x57d0ea(0x1bf)],_0x3fd90d);break;}case enums_1[_0x57d0ea(0x1b0)]['PlayTextToAudio']:{const {textToAudioId:_0x2a54c4,durationInSecond:_0x2857df}=_0x21c8e2['data'];if(!_0x2a54c4)return;const _0x41ce87={'textToAudioId':_0x2a54c4,'durationInSecond':_0x2857df,'audit':{'actor':enums_1[_0x57d0ea(0x1ef)]['Job'],'name':enums_1[_0x57d0ea(0x1b0)][_0x57d0ea(0x1f4)],'message':_0x57d0ea(0x1d4)+_0x21c8e2[_0x57d0ea(0x1b3)]+_0x57d0ea(0x200)+_0x12a8b4[_0x57d0ea(0x1b3)]}};this[_0x57d0ea(0x1cf)][_0x57d0ea(0x1d9)](_0x44715b,enums_1[_0x57d0ea(0x1b0)][_0x57d0ea(0x1f4)],_0x41ce87);break;}default:return;}}),this[_0x183d47(0x1dc)][_0x183d47(0x1ba)](_0x183d47(0x1cd));}async[a9_0x4a70c4(0x1b9)](_0x480b59){const _0x4dff1d=a9_0x4a70c4;this[_0x4dff1d(0x1dc)]['log'](_0x4dff1d(0x1d8));const {success:_0x74df8c,message:_0xa9dff1}=await(0x0,file_1[_0x4dff1d(0x1c4)])(constants_1[_0x4dff1d(0x1ca)]);!_0x74df8c&&this['logger']['error']('Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20'+_0xa9dff1);}};__decorate([(0x0,nestjs_agenda_1[a9_0x4a70c4(0x201)])(enums_1['BackgroundJobType'][a9_0x4a70c4(0x1e7)]),__metadata(a9_0x4a70c4(0x1fa),Function),__metadata('design:paramtypes',[agenda_1['Job']]),__metadata(a9_0x4a70c4(0x1cc),Promise)],JobProccessor[a9_0x4a70c4(0x1d3)],'checkEvent',null),__decorate([(0x0,nestjs_agenda_1['Define'])(enums_1[a9_0x4a70c4(0x1b6)]['PurgeTempUploadedFiles']),__metadata(a9_0x4a70c4(0x1fa),Function),__metadata(a9_0x4a70c4(0x1b4),[agenda_1[a9_0x4a70c4(0x1f6)]]),__metadata(a9_0x4a70c4(0x1cc),Promise)],JobProccessor[a9_0x4a70c4(0x1d3)],a9_0x4a70c4(0x1b9),null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x4a70c4(0x1d2)])(),__metadata(a9_0x4a70c4(0x1b4),[nestjs_agenda_1['AgendaService'],schedule_service_1['ScheduleService'],setting_service_1[a9_0x4a70c4(0x1ed)]])],JobProccessor),exports[a9_0x4a70c4(0x1b8)]=JobProccessor;