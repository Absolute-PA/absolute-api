'use strict';function a9_0x3b79(_0x22e31a,_0x3a4d35){const _0x568deb=a9_0x568d();return a9_0x3b79=function(_0x3b7985,_0x4f45ce){_0x3b7985=_0x3b7985-0x9a;let _0x3640d1=_0x568deb[_0x3b7985];return _0x3640d1;},a9_0x3b79(_0x22e31a,_0x3a4d35);}const a9_0x7cd6cf=a9_0x3b79;function a9_0x568d(){const _0x43e386=['Purging\x20temp\x20uploaded\x20files...','Job','Logger','Define','getHours','data','Eligible\x20schedule:\x20','72100oFkVMx','AgendaService','getMinutes','2704070tbqGmF','10GALuKN','TMP_UPLOAD_DIR','../common/file','logger','../schedule/schedule.service','1941180sPRKXo','prototype','@agent-ly/nestjs-agenda','5631728RBSQOi','time','design:returntype','AuditActor','3889287saLFaH','PlaySound','Invalid\x20or\x20expired\x20license\x20key!','jobType','\x20-\x20','../setting/setting.service','length','\x20-\x20Schedule:\x20','schedule','Processor','BackgroundJobType','split','function','PlayMusic','agendaService','name','env','__decorate','setMinutes','JobType','3wYVMiD','cancel','updateExpiryStatus','events','6CTcgGC','decorate','Fetching\x20today\x20schedule...','metadata','design:paramtypes','JobProccessor','Event:\x20','defineProperty','getOwnPropertyDescriptor','agenda','PlayVoiceRecorded','settingService','development','purgeTempUploadedFiles','7594JdEkVC','findEligibleSchedule','.\x20Job:\x20','PlayTextToAudio','Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20','PurgeTempUploadedFiles','forEach','scheduleService','isExpired','CheckEvent','ScheduleService','single','attrs','design:type','NODE_ENV','3670856RUxAzc','object','Server\x20time:\x20','log'];a9_0x568d=function(){return _0x43e386;};return a9_0x568d();}(function(_0x92677d,_0x2977d0){const _0x272290=a9_0x3b79,_0x1ff10a=_0x92677d();while(!![]){try{const _0x170d53=parseInt(_0x272290(0xa2))/0x1+parseInt(_0x272290(0xd8))/0x2+-parseInt(_0x272290(0xc6))/0x3*(parseInt(_0x272290(0xab))/0x4)+parseInt(_0x272290(0xa5))/0x5+parseInt(_0x272290(0xca))/0x6*(parseInt(_0x272290(0xe7))/0x7)+-parseInt(_0x272290(0xae))/0x8+-parseInt(_0x272290(0xb2))/0x9*(-parseInt(_0x272290(0xa6))/0xa);if(_0x170d53===_0x2977d0)break;else _0x1ff10a['push'](_0x1ff10a['shift']());}catch(_0x33581a){_0x1ff10a['push'](_0x1ff10a['shift']());}}}(a9_0x568d,0x5dc01));var __decorate=this&&this[a9_0x7cd6cf(0xc3)]||function(_0x3f9a47,_0x701b6f,_0x50d1d8,_0x549f08){const _0x32b5c8=a9_0x7cd6cf;var _0x4f6e26=arguments[_0x32b5c8(0xb8)],_0x149e12=_0x4f6e26<0x3?_0x701b6f:_0x549f08===null?_0x549f08=Object[_0x32b5c8(0xd2)](_0x701b6f,_0x50d1d8):_0x549f08,_0x2a3a1d;if(typeof Reflect==='object'&&typeof Reflect[_0x32b5c8(0xcb)]===_0x32b5c8(0xbe))_0x149e12=Reflect['decorate'](_0x3f9a47,_0x701b6f,_0x50d1d8,_0x549f08);else{for(var _0x5056bf=_0x3f9a47[_0x32b5c8(0xb8)]-0x1;_0x5056bf>=0x0;_0x5056bf--)if(_0x2a3a1d=_0x3f9a47[_0x5056bf])_0x149e12=(_0x4f6e26<0x3?_0x2a3a1d(_0x149e12):_0x4f6e26>0x3?_0x2a3a1d(_0x701b6f,_0x50d1d8,_0x149e12):_0x2a3a1d(_0x701b6f,_0x50d1d8))||_0x149e12;}return _0x4f6e26>0x3&&_0x149e12&&Object[_0x32b5c8(0xd1)](_0x701b6f,_0x50d1d8,_0x149e12),_0x149e12;},__metadata=this&&this['__metadata']||function(_0x32f88a,_0x570449){const _0x114947=a9_0x7cd6cf;if(typeof Reflect===_0x114947(0xe8)&&typeof Reflect[_0x114947(0xcd)]===_0x114947(0xbe))return Reflect['metadata'](_0x32f88a,_0x570449);},JobProccessor_1;Object[a9_0x7cd6cf(0xd1)](exports,'__esModule',{'value':!![]}),exports[a9_0x7cd6cf(0xcf)]=void 0x0;const common_1=require('@nestjs/common'),agenda_1=require(a9_0x7cd6cf(0xd3)),nestjs_agenda_1=require(a9_0x7cd6cf(0xad)),enums_1=require('../common/enums'),schedule_service_1=require(a9_0x7cd6cf(0xaa)),setting_service_1=require(a9_0x7cd6cf(0xb7)),file_1=require(a9_0x7cd6cf(0xa8)),constants_1=require('../common/constants');let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x5b76a8,_0x27c899,_0x4fa417){const _0x515454=a9_0x7cd6cf;this[_0x515454(0xc0)]=_0x5b76a8,this[_0x515454(0xdf)]=_0x27c899,this['settingService']=_0x4fa417,this[_0x515454(0xa9)]=new common_1[(_0x515454(0x9d))](JobProccessor_1['name']);}async['checkEvent'](_0x29c8d1){const _0x16325e=a9_0x7cd6cf;this[_0x16325e(0xa9)][_0x16325e(0x9a)](_0x16325e(0xe9)+new Date()+_0x16325e(0xda)+_0x29c8d1[_0x16325e(0xe4)][_0x16325e(0xc1)]);const _0x3efcd5=await this[_0x16325e(0xd5)][_0x16325e(0xc8)]();if(_0x3efcd5[_0x16325e(0xe0)]){this[_0x16325e(0xa9)][_0x16325e(0x9a)](_0x16325e(0xb4));if(process[_0x16325e(0xc2)][_0x16325e(0xe6)]!==_0x16325e(0xd6))return;}this[_0x16325e(0xa9)][_0x16325e(0x9a)]('Canceling\x20all\x20old\x20background\x20checks...'),await this[_0x16325e(0xc0)][_0x16325e(0xc7)]({'name':{'$nin':[enums_1[_0x16325e(0xbc)][_0x16325e(0xe1)],enums_1['BackgroundJobType'][_0x16325e(0xdd)]]},'type':_0x16325e(0xe3)}),this[_0x16325e(0xa9)][_0x16325e(0x9a)](_0x16325e(0xcc));const _0x9fb22c=await this[_0x16325e(0xdf)][_0x16325e(0xd9)](new Date());this[_0x16325e(0xa9)][_0x16325e(0x9a)](_0x16325e(0xa1)+(_0x9fb22c===null||_0x9fb22c===void 0x0?void 0x0:_0x9fb22c[_0x16325e(0xc1)]));if(!_0x9fb22c||!_0x9fb22c[_0x16325e(0xc9)]||_0x9fb22c[_0x16325e(0xc9)][_0x16325e(0xb8)]===0x0)return;_0x9fb22c['events'][_0x16325e(0xde)](_0x25397e=>{const _0x5e7751=_0x16325e;this[_0x5e7751(0xa9)][_0x5e7751(0x9a)]('Scheduling\x20event:\x20'+_0x25397e[_0x5e7751(0xaf)]+'\x20-\x20'+_0x25397e[_0x5e7751(0xb5)]+_0x5e7751(0xb6)+_0x25397e['name']);const _0x2f186a=new Date(),_0x2ccbd5=_0x2f186a[_0x5e7751(0x9f)](),_0x56444c=_0x2f186a[_0x5e7751(0xa4)](),_0x8f2b84=_0x2f186a['getSeconds'](),[_0x5f1c2d,_0x175f00,_0x18ba61]=_0x25397e[_0x5e7751(0xaf)][_0x5e7751(0xbd)](':');if(+_0x5f1c2d<_0x2ccbd5||+_0x5f1c2d===_0x2ccbd5&&+_0x175f00<_0x56444c||+_0x5f1c2d===_0x2ccbd5&&+_0x175f00===_0x56444c&&+_0x18ba61<_0x8f2b84)return;_0x2f186a['setHours'](+_0x5f1c2d),_0x2f186a[_0x5e7751(0xc4)](+_0x175f00),_0x2f186a['setSeconds'](+_0x18ba61);switch(_0x25397e['jobType']){case enums_1['JobType'][_0x5e7751(0xb3)]:{const {soundId:_0x492f48,durationInSecond:_0x137775}=_0x25397e[_0x5e7751(0xa0)];if(!_0x492f48)return;const _0x53a2fe={'soundId':_0x492f48,'durationInSecond':_0x137775,'audit':{'actor':enums_1[_0x5e7751(0xb1)][_0x5e7751(0x9c)],'name':enums_1[_0x5e7751(0xc5)]['PlaySound'],'message':_0x5e7751(0xd0)+_0x25397e[_0x5e7751(0xc1)]+_0x5e7751(0xb9)+_0x9fb22c['name']}};this[_0x5e7751(0xc0)]['schedule'](_0x2f186a,enums_1['JobType'][_0x5e7751(0xb3)],_0x53a2fe);break;}case enums_1[_0x5e7751(0xc5)]['PlayMusic']:{const {playlistId:_0x24ca3d,durationInSecond:_0x62f56f}=_0x25397e[_0x5e7751(0xa0)];if(!_0x24ca3d)return;const _0x5d38f7={'playlistId':_0x24ca3d,'durationInSecond':_0x62f56f,'audit':{'actor':enums_1[_0x5e7751(0xb1)][_0x5e7751(0x9c)],'name':enums_1['JobType'][_0x5e7751(0xbf)],'message':_0x5e7751(0xd0)+_0x25397e[_0x5e7751(0xc1)]+_0x5e7751(0xb9)+_0x9fb22c[_0x5e7751(0xc1)]}};this['agendaService']['schedule'](_0x2f186a,enums_1[_0x5e7751(0xc5)][_0x5e7751(0xbf)],_0x5d38f7);break;}case enums_1[_0x5e7751(0xc5)]['PlayVoiceRecorded']:{const {voiceId:_0xed2194,durationInSecond:_0x261dd0}=_0x25397e[_0x5e7751(0xa0)];if(!_0xed2194)return;const _0x26ad73={'voiceId':_0xed2194,'durationInSecond':_0x261dd0,'audit':{'actor':enums_1[_0x5e7751(0xb1)]['Job'],'name':enums_1['JobType'][_0x5e7751(0xd4)],'message':_0x5e7751(0xd0)+_0x25397e['name']+_0x5e7751(0xb9)+_0x9fb22c[_0x5e7751(0xc1)]}};this[_0x5e7751(0xc0)][_0x5e7751(0xba)](_0x2f186a,enums_1[_0x5e7751(0xc5)][_0x5e7751(0xd4)],_0x26ad73);break;}case enums_1[_0x5e7751(0xc5)][_0x5e7751(0xdb)]:{const {textToAudioId:_0x20422a,durationInSecond:_0x3f7e37}=_0x25397e['data'];if(!_0x20422a)return;const _0x481f5e={'textToAudioId':_0x20422a,'durationInSecond':_0x3f7e37,'audit':{'actor':enums_1[_0x5e7751(0xb1)][_0x5e7751(0x9c)],'name':enums_1['JobType'][_0x5e7751(0xdb)],'message':_0x5e7751(0xd0)+_0x25397e[_0x5e7751(0xc1)]+_0x5e7751(0xb9)+_0x9fb22c[_0x5e7751(0xc1)]}};this[_0x5e7751(0xc0)][_0x5e7751(0xba)](_0x2f186a,enums_1['JobType'][_0x5e7751(0xdb)],_0x481f5e);break;}default:return;}}),this['logger'][_0x16325e(0x9a)]('Events\x20scheduled!');}async['purgeTempUploadedFiles'](_0x28afa1){const _0x47f089=a9_0x7cd6cf;this[_0x47f089(0xa9)][_0x47f089(0x9a)](_0x47f089(0x9b));const {success:_0x354ce1,message:_0x26608b}=await(0x0,file_1['deleteFilesInFolder'])(constants_1[_0x47f089(0xa7)]);!_0x354ce1&&this[_0x47f089(0xa9)]['error'](_0x47f089(0xdc)+_0x26608b);}};__decorate([(0x0,nestjs_agenda_1[a9_0x7cd6cf(0x9e)])(enums_1[a9_0x7cd6cf(0xbc)][a9_0x7cd6cf(0xe1)]),__metadata(a9_0x7cd6cf(0xe5),Function),__metadata(a9_0x7cd6cf(0xce),[agenda_1[a9_0x7cd6cf(0x9c)]]),__metadata('design:returntype',Promise)],JobProccessor[a9_0x7cd6cf(0xac)],'checkEvent',null),__decorate([(0x0,nestjs_agenda_1[a9_0x7cd6cf(0x9e)])(enums_1[a9_0x7cd6cf(0xbc)][a9_0x7cd6cf(0xdd)]),__metadata(a9_0x7cd6cf(0xe5),Function),__metadata('design:paramtypes',[agenda_1[a9_0x7cd6cf(0x9c)]]),__metadata(a9_0x7cd6cf(0xb0),Promise)],JobProccessor['prototype'],a9_0x7cd6cf(0xd7),null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x7cd6cf(0xbb)])(),__metadata('design:paramtypes',[nestjs_agenda_1[a9_0x7cd6cf(0xa3)],schedule_service_1[a9_0x7cd6cf(0xe2)],setting_service_1['SettingService']])],JobProccessor),exports[a9_0x7cd6cf(0xcf)]=JobProccessor;