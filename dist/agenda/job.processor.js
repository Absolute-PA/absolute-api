'use strict';const a9_0x245f08=a9_0x3176;(function(_0x24f4db,_0x1053c0){const _0x1c2fa6=a9_0x3176,_0x2101ee=_0x24f4db();while(!![]){try{const _0x1bb7a5=-parseInt(_0x1c2fa6(0x1df))/0x1*(-parseInt(_0x1c2fa6(0x202))/0x2)+parseInt(_0x1c2fa6(0x1c9))/0x3+-parseInt(_0x1c2fa6(0x20f))/0x4+parseInt(_0x1c2fa6(0x1dc))/0x5*(-parseInt(_0x1c2fa6(0x1d4))/0x6)+-parseInt(_0x1c2fa6(0x1cf))/0x7*(-parseInt(_0x1c2fa6(0x1cb))/0x8)+-parseInt(_0x1c2fa6(0x1d7))/0x9*(parseInt(_0x1c2fa6(0x1f2))/0xa)+parseInt(_0x1c2fa6(0x1d2))/0xb;if(_0x1bb7a5===_0x1053c0)break;else _0x2101ee['push'](_0x2101ee['shift']());}catch(_0x30a50b){_0x2101ee['push'](_0x2101ee['shift']());}}}(a9_0x14c3,0x5cffb));var __decorate=this&&this[a9_0x245f08(0x200)]||function(_0x37c441,_0x262344,_0x3e6630,_0xed72b0){const _0x5c579d=a9_0x245f08;var _0x4625e9=arguments[_0x5c579d(0x1c8)],_0x2e25d7=_0x4625e9<0x3?_0x262344:_0xed72b0===null?_0xed72b0=Object[_0x5c579d(0x1fc)](_0x262344,_0x3e6630):_0xed72b0,_0x5f3f32;if(typeof Reflect===_0x5c579d(0x216)&&typeof Reflect[_0x5c579d(0x20e)]===_0x5c579d(0x1ee))_0x2e25d7=Reflect[_0x5c579d(0x20e)](_0x37c441,_0x262344,_0x3e6630,_0xed72b0);else{for(var _0x5f8821=_0x37c441[_0x5c579d(0x1c8)]-0x1;_0x5f8821>=0x0;_0x5f8821--)if(_0x5f3f32=_0x37c441[_0x5f8821])_0x2e25d7=(_0x4625e9<0x3?_0x5f3f32(_0x2e25d7):_0x4625e9>0x3?_0x5f3f32(_0x262344,_0x3e6630,_0x2e25d7):_0x5f3f32(_0x262344,_0x3e6630))||_0x2e25d7;}return _0x4625e9>0x3&&_0x2e25d7&&Object['defineProperty'](_0x262344,_0x3e6630,_0x2e25d7),_0x2e25d7;},__metadata=this&&this[a9_0x245f08(0x1eb)]||function(_0x1d6455,_0xe775bf){const _0x7f7104=a9_0x245f08;if(typeof Reflect==='object'&&typeof Reflect[_0x7f7104(0x1ce)]===_0x7f7104(0x1ee))return Reflect[_0x7f7104(0x1ce)](_0x1d6455,_0xe775bf);},JobProccessor_1;Object[a9_0x245f08(0x206)](exports,a9_0x245f08(0x1f8),{'value':!![]}),exports['JobProccessor']=void 0x0;const common_1=require('@nestjs/common'),agenda_1=require('agenda'),nestjs_agenda_1=require(a9_0x245f08(0x1cd)),enums_1=require(a9_0x245f08(0x209)),schedule_service_1=require('../schedule/schedule.service'),setting_service_1=require(a9_0x245f08(0x217)),file_1=require(a9_0x245f08(0x1e1)),constants_1=require('../common/constants');function a9_0x3176(_0x3a5308,_0x5abbee){const _0x14c314=a9_0x14c3();return a9_0x3176=function(_0x317600,_0x473c29){_0x317600=_0x317600-0x1c8;let _0x4bc983=_0x14c314[_0x317600];return _0x4bc983;},a9_0x3176(_0x3a5308,_0x5abbee);}let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x2c7ca5,_0x16e389,_0x175593){const _0x168a60=a9_0x245f08;this[_0x168a60(0x1e7)]=_0x2c7ca5,this[_0x168a60(0x210)]=_0x16e389,this[_0x168a60(0x1db)]=_0x175593,this['logger']=new common_1[(_0x168a60(0x1fe))](JobProccessor_1['name']);}async[a9_0x245f08(0x1ea)](_0x325618){const _0x36445b=a9_0x245f08;this['logger'][_0x36445b(0x215)]('Server\x20time:\x20'+new Date()+_0x36445b(0x1e6)+_0x325618['attrs']['name']);const _0x3013a3=await this[_0x36445b(0x1db)][_0x36445b(0x1e4)]();if(_0x3013a3[_0x36445b(0x1e2)]){this[_0x36445b(0x1cc)][_0x36445b(0x215)]('Invalid\x20or\x20expired\x20license\x20key!');if(process[_0x36445b(0x1e5)]['NODE_ENV']!==_0x36445b(0x1e3))return;}this[_0x36445b(0x1cc)]['log']('Canceling\x20all\x20old\x20background\x20checks...'),await this[_0x36445b(0x1e7)][_0x36445b(0x1f0)]({'name':{'$nin':[enums_1[_0x36445b(0x1ec)]['CheckEvent'],enums_1[_0x36445b(0x1ec)][_0x36445b(0x1fd)]]},'type':_0x36445b(0x20b)}),this['logger'][_0x36445b(0x215)]('Fetching\x20today\x20schedule...');const _0x176602=await this['scheduleService'][_0x36445b(0x1f9)](new Date());this[_0x36445b(0x1cc)][_0x36445b(0x215)](_0x36445b(0x214)+(_0x176602===null||_0x176602===void 0x0?void 0x0:_0x176602[_0x36445b(0x208)]));if(!_0x176602||!_0x176602['events']||_0x176602[_0x36445b(0x201)][_0x36445b(0x1c8)]===0x0)return;_0x176602[_0x36445b(0x201)][_0x36445b(0x20d)](_0x4a952f=>{const _0x310727=_0x36445b;this[_0x310727(0x1cc)][_0x310727(0x215)](_0x310727(0x1e9)+_0x4a952f[_0x310727(0x211)]+'\x20-\x20'+_0x4a952f['jobType']+_0x310727(0x1ff)+_0x4a952f[_0x310727(0x208)]);const _0x2a6568=new Date(),_0x3a7dff=_0x2a6568[_0x310727(0x21a)](),_0x217425=_0x2a6568[_0x310727(0x1d1)](),_0x18467d=_0x2a6568[_0x310727(0x204)](),[_0x22781f,_0x14ea5b,_0x56f4c0]=_0x4a952f[_0x310727(0x211)][_0x310727(0x1dd)](':');if(+_0x22781f<_0x3a7dff||+_0x22781f===_0x3a7dff&&+_0x14ea5b<_0x217425||+_0x22781f===_0x3a7dff&&+_0x14ea5b===_0x217425&&+_0x56f4c0<_0x18467d)return;_0x2a6568[_0x310727(0x205)](+_0x22781f),_0x2a6568['setMinutes'](+_0x14ea5b),_0x2a6568[_0x310727(0x1d8)](+_0x56f4c0);switch(_0x4a952f[_0x310727(0x1f1)]){case enums_1[_0x310727(0x213)][_0x310727(0x1d5)]:{const {soundId:_0x540939,durationInSecond:_0x756a95}=_0x4a952f['data'];if(!_0x540939)return;const _0x2f40ae={'soundId':_0x540939,'durationInSecond':_0x756a95,'audit':{'actor':enums_1[_0x310727(0x1ef)][_0x310727(0x1e0)],'name':enums_1[_0x310727(0x213)]['PlaySound'],'message':_0x310727(0x203)+_0x4a952f[_0x310727(0x208)]+_0x310727(0x1e8)+_0x176602['name']}};this[_0x310727(0x1e7)]['schedule'](_0x2a6568,enums_1[_0x310727(0x213)][_0x310727(0x1d5)],_0x2f40ae);break;}case enums_1['JobType'][_0x310727(0x1d9)]:{const {playlistId:_0x101e7d,durationInSecond:_0x2160c4}=_0x4a952f[_0x310727(0x1f3)];if(!_0x101e7d)return;const _0x4013ba={'playlistId':_0x101e7d,'durationInSecond':_0x2160c4,'audit':{'actor':enums_1[_0x310727(0x1ef)][_0x310727(0x1e0)],'name':enums_1[_0x310727(0x213)][_0x310727(0x1d9)],'message':_0x310727(0x203)+_0x4a952f['name']+'\x20-\x20Schedule:\x20'+_0x176602[_0x310727(0x208)]}};this[_0x310727(0x1e7)][_0x310727(0x212)](_0x2a6568,enums_1[_0x310727(0x213)][_0x310727(0x1d9)],_0x4013ba);break;}case enums_1[_0x310727(0x213)]['PlayVoiceRecorded']:{const {voiceId:_0x473963,durationInSecond:_0x3e9038}=_0x4a952f[_0x310727(0x1f3)];if(!_0x473963)return;const _0xee55c1={'voiceId':_0x473963,'durationInSecond':_0x3e9038,'audit':{'actor':enums_1[_0x310727(0x1ef)]['Job'],'name':enums_1[_0x310727(0x213)]['PlayVoiceRecorded'],'message':_0x310727(0x203)+_0x4a952f[_0x310727(0x208)]+_0x310727(0x1e8)+_0x176602[_0x310727(0x208)]}};this['agendaService'][_0x310727(0x212)](_0x2a6568,enums_1[_0x310727(0x213)][_0x310727(0x1d3)],_0xee55c1);break;}case enums_1['JobType'][_0x310727(0x207)]:{const {textToAudioId:_0x4d3f47,durationInSecond:_0x453ad9}=_0x4a952f['data'];if(!_0x4d3f47)return;const _0x1b4e8c={'textToAudioId':_0x4d3f47,'durationInSecond':_0x453ad9,'audit':{'actor':enums_1['AuditActor'][_0x310727(0x1e0)],'name':enums_1[_0x310727(0x213)]['PlayTextToAudio'],'message':_0x310727(0x203)+_0x4a952f[_0x310727(0x208)]+'\x20-\x20Schedule:\x20'+_0x176602[_0x310727(0x208)]}};this[_0x310727(0x1e7)][_0x310727(0x212)](_0x2a6568,enums_1[_0x310727(0x213)]['PlayTextToAudio'],_0x1b4e8c);break;}default:return;}}),this[_0x36445b(0x1cc)][_0x36445b(0x215)]('Events\x20scheduled!');}async[a9_0x245f08(0x1d0)](_0x5723c7){const _0x5f2e8e=a9_0x245f08;this['logger'][_0x5f2e8e(0x215)](_0x5f2e8e(0x20c));const {success:_0x2a19d5,message:_0x599f3e}=await(0x0,file_1[_0x5f2e8e(0x1fb)])(constants_1[_0x5f2e8e(0x1ed)]);!_0x2a19d5&&this['logger'][_0x5f2e8e(0x1f7)](_0x5f2e8e(0x1da)+_0x599f3e);}};function a9_0x14c3(){const _0x47135b=['getSeconds','setHours','defineProperty','PlayTextToAudio','name','../common/enums','AgendaService','single','Purging\x20temp\x20uploaded\x20files...','forEach','decorate','158560DyKULO','scheduleService','time','schedule','JobType','Eligible\x20schedule:\x20','log','object','../setting/setting.service','Processor','design:paramtypes','getHours','length','344469mQUPPS','Define','11896xQVhUu','logger','@agent-ly/nestjs-agenda','metadata','2149XGAGoh','purgeTempUploadedFiles','getMinutes','10344488LPLJYk','PlayVoiceRecorded','6LayovG','PlaySound','design:returntype','2959947BNeexd','setSeconds','PlayMusic','Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20','settingService','2219615zofhcq','split','JobProccessor','8BBviLq','Job','../common/file','isExpired','development','updateExpiryStatus','env','.\x20Job:\x20','agendaService','\x20-\x20Schedule:\x20','Scheduling\x20event:\x20','checkEvent','__metadata','BackgroundJobType','TMP_UPLOAD_DIR','function','AuditActor','cancel','jobType','20dgZhdk','data','prototype','ScheduleService','CheckEvent','error','__esModule','findEligibleSchedule','design:type','deleteFilesInFolder','getOwnPropertyDescriptor','PurgeTempUploadedFiles','Logger','\x20-\x20','__decorate','events','2628eRSEAo','Event:\x20'];a9_0x14c3=function(){return _0x47135b;};return a9_0x14c3();}__decorate([(0x0,nestjs_agenda_1['Define'])(enums_1['BackgroundJobType'][a9_0x245f08(0x1f6)]),__metadata('design:type',Function),__metadata(a9_0x245f08(0x219),[agenda_1['Job']]),__metadata(a9_0x245f08(0x1d6),Promise)],JobProccessor['prototype'],a9_0x245f08(0x1ea),null),__decorate([(0x0,nestjs_agenda_1[a9_0x245f08(0x1ca)])(enums_1['BackgroundJobType'][a9_0x245f08(0x1fd)]),__metadata(a9_0x245f08(0x1fa),Function),__metadata('design:paramtypes',[agenda_1['Job']]),__metadata('design:returntype',Promise)],JobProccessor[a9_0x245f08(0x1f4)],a9_0x245f08(0x1d0),null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x245f08(0x218)])(),__metadata(a9_0x245f08(0x219),[nestjs_agenda_1[a9_0x245f08(0x20a)],schedule_service_1[a9_0x245f08(0x1f5)],setting_service_1['SettingService']])],JobProccessor),exports[a9_0x245f08(0x1de)]=JobProccessor;