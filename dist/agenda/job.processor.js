'use strict';const a9_0x194de5=a9_0x1a1c;(function(_0x55f7ee,_0x1e1e2a){const _0x30d7d0=a9_0x1a1c,_0x108ccf=_0x55f7ee();while(!![]){try{const _0x56ab50=-parseInt(_0x30d7d0(0x1c0))/0x1+-parseInt(_0x30d7d0(0x1c5))/0x2*(-parseInt(_0x30d7d0(0x1be))/0x3)+parseInt(_0x30d7d0(0x1a5))/0x4*(-parseInt(_0x30d7d0(0x1e4))/0x5)+parseInt(_0x30d7d0(0x1ab))/0x6+-parseInt(_0x30d7d0(0x1a6))/0x7+-parseInt(_0x30d7d0(0x1b2))/0x8+parseInt(_0x30d7d0(0x1ca))/0x9;if(_0x56ab50===_0x1e1e2a)break;else _0x108ccf['push'](_0x108ccf['shift']());}catch(_0x58c410){_0x108ccf['push'](_0x108ccf['shift']());}}}(a9_0x20d5,0x2d972));function a9_0x1a1c(_0x699ea0,_0x5550f5){const _0x20d5dd=a9_0x20d5();return a9_0x1a1c=function(_0x1a1c86,_0x2e3d47){_0x1a1c86=_0x1a1c86-0x1a4;let _0x47dc2a=_0x20d5dd[_0x1a1c86];return _0x47dc2a;},a9_0x1a1c(_0x699ea0,_0x5550f5);}function a9_0x20d5(){const _0x54b4ca=['3ZBogLT','log','222946RndQrQ','function','single','getMinutes','Processor','145738uGliOw','setMinutes','NODE_ENV','Eligible\x20schedule:\x20','BackgroundJobType','4742514VQZLvU','TMP_UPLOAD_DIR','cancel','Job','split','data','Invalid\x20or\x20expired\x20license\x20key!','__decorate','../setting/setting.service','Events\x20scheduled!','PlaySound','agendaService','logger','events','design:returntype','decorate','PlayVoiceRecorded','object','Scheduling\x20event:\x20','__metadata','env','time','Fetching\x20today\x20schedule...','Canceling\x20all\x20old\x20background\x20checks...','schedule','getHours','35UfbMNx','Define','prototype','__esModule','isExpired','CheckEvent','../schedule/schedule.service','\x20-\x20','purgeTempUploadedFiles','Server\x20time:\x20','updateExpiryStatus','JobProccessor','metadata','length','defineProperty','checkEvent','137948sSAtyA','518861RhuRKu','ScheduleService','PlayMusic','jobType','\x20-\x20Schedule:\x20','1255848mcNmko','settingService','agenda','design:paramtypes','getSeconds','AuditActor','name','671256dGDVdq','getOwnPropertyDescriptor','development','@agent-ly/nestjs-agenda','findEligibleSchedule','JobType','Event:\x20','../common/constants','deleteFilesInFolder','Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20','../common/enums','error'];a9_0x20d5=function(){return _0x54b4ca;};return a9_0x20d5();}var __decorate=this&&this[a9_0x194de5(0x1d1)]||function(_0x5bc512,_0x521740,_0x276e1e,_0x2ed4a4){const _0x1fa6f0=a9_0x194de5;var _0x4e8d93=arguments[_0x1fa6f0(0x1f1)],_0x176469=_0x4e8d93<0x3?_0x521740:_0x2ed4a4===null?_0x2ed4a4=Object[_0x1fa6f0(0x1b3)](_0x521740,_0x276e1e):_0x2ed4a4,_0x5b5026;if(typeof Reflect==='object'&&typeof Reflect[_0x1fa6f0(0x1d9)]==='function')_0x176469=Reflect[_0x1fa6f0(0x1d9)](_0x5bc512,_0x521740,_0x276e1e,_0x2ed4a4);else{for(var _0x4aabad=_0x5bc512['length']-0x1;_0x4aabad>=0x0;_0x4aabad--)if(_0x5b5026=_0x5bc512[_0x4aabad])_0x176469=(_0x4e8d93<0x3?_0x5b5026(_0x176469):_0x4e8d93>0x3?_0x5b5026(_0x521740,_0x276e1e,_0x176469):_0x5b5026(_0x521740,_0x276e1e))||_0x176469;}return _0x4e8d93>0x3&&_0x176469&&Object[_0x1fa6f0(0x1f2)](_0x521740,_0x276e1e,_0x176469),_0x176469;},__metadata=this&&this[a9_0x194de5(0x1dd)]||function(_0x20ad2c,_0x34fe7b){const _0x4d7707=a9_0x194de5;if(typeof Reflect===_0x4d7707(0x1db)&&typeof Reflect[_0x4d7707(0x1f0)]===_0x4d7707(0x1c1))return Reflect[_0x4d7707(0x1f0)](_0x20ad2c,_0x34fe7b);},JobProccessor_1;Object[a9_0x194de5(0x1f2)](exports,a9_0x194de5(0x1e7),{'value':!![]}),exports[a9_0x194de5(0x1ef)]=void 0x0;const common_1=require('@nestjs/common'),agenda_1=require(a9_0x194de5(0x1ad)),nestjs_agenda_1=require(a9_0x194de5(0x1b5)),enums_1=require(a9_0x194de5(0x1bc)),schedule_service_1=require(a9_0x194de5(0x1ea)),setting_service_1=require(a9_0x194de5(0x1d2)),file_1=require('../common/file'),constants_1=require(a9_0x194de5(0x1b9));let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x186991,_0x108cd3,_0x328a33){const _0x231a59=a9_0x194de5;this[_0x231a59(0x1d5)]=_0x186991,this['scheduleService']=_0x108cd3,this[_0x231a59(0x1ac)]=_0x328a33,this[_0x231a59(0x1d6)]=new common_1['Logger'](JobProccessor_1['name']);}async[a9_0x194de5(0x1a4)](_0x50a997){const _0x3e2aea=a9_0x194de5;this['logger'][_0x3e2aea(0x1bf)](_0x3e2aea(0x1ed)+new Date()+'.\x20Job:\x20'+_0x50a997['attrs']['name']);const _0xc319a1=await this[_0x3e2aea(0x1ac)][_0x3e2aea(0x1ee)]();if(_0xc319a1[_0x3e2aea(0x1e8)]){this['logger'][_0x3e2aea(0x1bf)](_0x3e2aea(0x1d0));if(process[_0x3e2aea(0x1de)][_0x3e2aea(0x1c7)]!==_0x3e2aea(0x1b4))return;}this[_0x3e2aea(0x1d6)][_0x3e2aea(0x1bf)](_0x3e2aea(0x1e1)),await this['agendaService'][_0x3e2aea(0x1cc)]({'name':{'$nin':[enums_1[_0x3e2aea(0x1c9)][_0x3e2aea(0x1e9)],enums_1[_0x3e2aea(0x1c9)]['PurgeTempUploadedFiles']]},'type':_0x3e2aea(0x1c2)}),this[_0x3e2aea(0x1d6)][_0x3e2aea(0x1bf)](_0x3e2aea(0x1e0));const _0x2ecb94=await this['scheduleService'][_0x3e2aea(0x1b6)](new Date());this[_0x3e2aea(0x1d6)][_0x3e2aea(0x1bf)](_0x3e2aea(0x1c8)+(_0x2ecb94===null||_0x2ecb94===void 0x0?void 0x0:_0x2ecb94[_0x3e2aea(0x1b1)]));if(!_0x2ecb94||!_0x2ecb94['events']||_0x2ecb94[_0x3e2aea(0x1d7)][_0x3e2aea(0x1f1)]===0x0)return;_0x2ecb94[_0x3e2aea(0x1d7)]['forEach'](_0xde37a0=>{const _0x4cd953=_0x3e2aea;this['logger'][_0x4cd953(0x1bf)](_0x4cd953(0x1dc)+_0xde37a0[_0x4cd953(0x1df)]+_0x4cd953(0x1eb)+_0xde37a0[_0x4cd953(0x1a9)]+_0x4cd953(0x1eb)+_0xde37a0[_0x4cd953(0x1b1)]);const _0x14f0d3=new Date(),_0x1ecdfb=_0x14f0d3[_0x4cd953(0x1e3)](),_0x4cf9e2=_0x14f0d3[_0x4cd953(0x1c3)](),_0xb57162=_0x14f0d3[_0x4cd953(0x1af)](),[_0x3da5a7,_0x50f958,_0x5eb102]=_0xde37a0['time'][_0x4cd953(0x1ce)](':');if(+_0x3da5a7<_0x1ecdfb||+_0x3da5a7===_0x1ecdfb&&+_0x50f958<_0x4cf9e2||+_0x3da5a7===_0x1ecdfb&&+_0x50f958===_0x4cf9e2&&+_0x5eb102<_0xb57162)return;_0x14f0d3['setHours'](+_0x3da5a7),_0x14f0d3[_0x4cd953(0x1c6)](+_0x50f958),_0x14f0d3['setSeconds'](+_0x5eb102);switch(_0xde37a0[_0x4cd953(0x1a9)]){case enums_1[_0x4cd953(0x1b7)][_0x4cd953(0x1d4)]:{const {soundId:_0x3b1fdb,durationInSecond:_0x507d61}=_0xde37a0['data'];if(!_0x3b1fdb)return;const _0x4709d2={'soundId':_0x3b1fdb,'durationInSecond':_0x507d61,'audit':{'actor':enums_1[_0x4cd953(0x1b0)][_0x4cd953(0x1cd)],'name':enums_1[_0x4cd953(0x1b7)]['PlaySound'],'message':_0x4cd953(0x1b8)+_0xde37a0[_0x4cd953(0x1b1)]+_0x4cd953(0x1aa)+_0x2ecb94[_0x4cd953(0x1b1)]}};this[_0x4cd953(0x1d5)][_0x4cd953(0x1e2)](_0x14f0d3,enums_1[_0x4cd953(0x1b7)][_0x4cd953(0x1d4)],_0x4709d2);break;}case enums_1[_0x4cd953(0x1b7)][_0x4cd953(0x1a8)]:{const {playlistId:_0x8d148e,durationInSecond:_0x2ce318}=_0xde37a0[_0x4cd953(0x1cf)];if(!_0x8d148e)return;const _0x5750ce={'playlistId':_0x8d148e,'durationInSecond':_0x2ce318,'audit':{'actor':enums_1[_0x4cd953(0x1b0)][_0x4cd953(0x1cd)],'name':enums_1[_0x4cd953(0x1b7)]['PlayMusic'],'message':_0x4cd953(0x1b8)+_0xde37a0[_0x4cd953(0x1b1)]+'\x20-\x20Schedule:\x20'+_0x2ecb94[_0x4cd953(0x1b1)]}};this[_0x4cd953(0x1d5)][_0x4cd953(0x1e2)](_0x14f0d3,enums_1['JobType'][_0x4cd953(0x1a8)],_0x5750ce);break;}case enums_1[_0x4cd953(0x1b7)][_0x4cd953(0x1da)]:{const {voiceId:_0x5ee6da,durationInSecond:_0x57c48c}=_0xde37a0[_0x4cd953(0x1cf)];if(!_0x5ee6da)return;const _0x13d4e1={'voiceId':_0x5ee6da,'durationInSecond':_0x57c48c,'audit':{'actor':enums_1['AuditActor'][_0x4cd953(0x1cd)],'name':enums_1[_0x4cd953(0x1b7)]['PlayVoiceRecorded'],'message':_0x4cd953(0x1b8)+_0xde37a0[_0x4cd953(0x1b1)]+_0x4cd953(0x1aa)+_0x2ecb94[_0x4cd953(0x1b1)]}};this[_0x4cd953(0x1d5)]['schedule'](_0x14f0d3,enums_1[_0x4cd953(0x1b7)][_0x4cd953(0x1da)],_0x13d4e1);break;}case enums_1[_0x4cd953(0x1b7)]['PlayTextToAudio']:{const {textToAudioId:_0x69844c,durationInSecond:_0x4a11f3}=_0xde37a0[_0x4cd953(0x1cf)];if(!_0x69844c)return;const _0x1a632e={'textToAudioId':_0x69844c,'durationInSecond':_0x4a11f3,'audit':{'actor':enums_1[_0x4cd953(0x1b0)][_0x4cd953(0x1cd)],'name':enums_1[_0x4cd953(0x1b7)]['PlayTextToAudio'],'message':_0x4cd953(0x1b8)+_0xde37a0[_0x4cd953(0x1b1)]+'\x20-\x20Schedule:\x20'+_0x2ecb94['name']}};this[_0x4cd953(0x1d5)][_0x4cd953(0x1e2)](_0x14f0d3,enums_1[_0x4cd953(0x1b7)]['PlayTextToAudio'],_0x1a632e);break;}default:return;}}),this[_0x3e2aea(0x1d6)]['log'](_0x3e2aea(0x1d3));}async[a9_0x194de5(0x1ec)](_0xe7fc6e){const _0x14cd78=a9_0x194de5;this[_0x14cd78(0x1d6)]['log']('Purging\x20temp\x20uploaded\x20files...');const {success:_0x3b35b0,message:_0x1b6357}=await(0x0,file_1[_0x14cd78(0x1ba)])(constants_1[_0x14cd78(0x1cb)]);!_0x3b35b0&&this[_0x14cd78(0x1d6)][_0x14cd78(0x1bd)](_0x14cd78(0x1bb)+_0x1b6357);}};__decorate([(0x0,nestjs_agenda_1[a9_0x194de5(0x1e5)])(enums_1[a9_0x194de5(0x1c9)][a9_0x194de5(0x1e9)]),__metadata('design:type',Function),__metadata(a9_0x194de5(0x1ae),[agenda_1[a9_0x194de5(0x1cd)]]),__metadata(a9_0x194de5(0x1d8),Promise)],JobProccessor[a9_0x194de5(0x1e6)],a9_0x194de5(0x1a4),null),__decorate([(0x0,nestjs_agenda_1[a9_0x194de5(0x1e5)])(enums_1[a9_0x194de5(0x1c9)]['PurgeTempUploadedFiles']),__metadata('design:type',Function),__metadata(a9_0x194de5(0x1ae),[agenda_1[a9_0x194de5(0x1cd)]]),__metadata(a9_0x194de5(0x1d8),Promise)],JobProccessor[a9_0x194de5(0x1e6)],a9_0x194de5(0x1ec),null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x194de5(0x1c4)])(),__metadata('design:paramtypes',[nestjs_agenda_1['AgendaService'],schedule_service_1[a9_0x194de5(0x1a7)],setting_service_1['SettingService']])],JobProccessor),exports['JobProccessor']=JobProccessor;