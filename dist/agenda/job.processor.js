'use strict';function a9_0x354e(){const _0x42c8ea=['settingService','2384940vGoQxl','\x20-\x20Schedule:\x20','getOwnPropertyDescriptor','JobProccessor','PlayVoiceRecorded','purgeTempUploadedFiles','time','1165965syrdYX','739231IrHlZc','getHours','Job','design:returntype','Scheduling\x20event:\x20','\x20-\x20','attrs','defineProperty','PlayMusic','agendaService','PlaySound','metadata','JobType','ScheduleService','function','PurgeTempUploadedFiles','getMinutes','Event:\x20','cancel','../common/constants','setHours','prototype','Processor','NODE_ENV','162783rfqRUF','error','CheckEvent','design:type','events','TMP_UPLOAD_DIR','schedule','Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20','BackgroundJobType','deleteFilesInFolder','@nestjs/common','834086NMaZmk','2428377HOXhYO','isExpired','design:paramtypes','findEligibleSchedule','PlayTextToAudio','checkEvent','log','SettingService','split','object','name','14370184UXtZdq','data','../schedule/schedule.service','decorate','logger','Purging\x20temp\x20uploaded\x20files...','../setting/setting.service','env','setMinutes','length','__decorate','Invalid\x20or\x20expired\x20license\x20key!','AgendaService','agenda','Define','Events\x20scheduled!','../common/file','../common/enums','AuditActor','scheduleService','__metadata','.\x20Job:\x20','jobType','4pnMBoJ'];a9_0x354e=function(){return _0x42c8ea;};return a9_0x354e();}const a9_0x49bbb3=a9_0x5196;(function(_0x10a2df,_0x357684){const _0x38fda3=a9_0x5196,_0xc0fc6c=_0x10a2df();while(!![]){try{const _0x316155=-parseInt(_0x38fda3(0x1e4))/0x1+-parseInt(_0x38fda3(0x207))/0x2+-parseInt(_0x38fda3(0x1fc))/0x3+parseInt(_0x38fda3(0x1da))/0x4*(-parseInt(_0x38fda3(0x1e3))/0x5)+parseInt(_0x38fda3(0x1dc))/0x6+-parseInt(_0x38fda3(0x208))/0x7+parseInt(_0x38fda3(0x1c3))/0x8;if(_0x316155===_0x357684)break;else _0xc0fc6c['push'](_0xc0fc6c['shift']());}catch(_0x4d6c63){_0xc0fc6c['push'](_0xc0fc6c['shift']());}}}(a9_0x354e,0x626b4));function a9_0x5196(_0x572a8,_0x13f62f){const _0x354e02=a9_0x354e();return a9_0x5196=function(_0x519612,_0x41e07c){_0x519612=_0x519612-0x1c0;let _0x4e57e0=_0x354e02[_0x519612];return _0x4e57e0;},a9_0x5196(_0x572a8,_0x13f62f);}var __decorate=this&&this[a9_0x49bbb3(0x1cd)]||function(_0xa6007f,_0x19c9e8,_0x10c834,_0x34336e){const _0x4ff247=a9_0x49bbb3;var _0x2e797e=arguments[_0x4ff247(0x1cc)],_0x5dce81=_0x2e797e<0x3?_0x19c9e8:_0x34336e===null?_0x34336e=Object[_0x4ff247(0x1de)](_0x19c9e8,_0x10c834):_0x34336e,_0x57a6a2;if(typeof Reflect===_0x4ff247(0x1c1)&&typeof Reflect[_0x4ff247(0x1c6)]===_0x4ff247(0x1f2))_0x5dce81=Reflect[_0x4ff247(0x1c6)](_0xa6007f,_0x19c9e8,_0x10c834,_0x34336e);else{for(var _0x1dab3a=_0xa6007f[_0x4ff247(0x1cc)]-0x1;_0x1dab3a>=0x0;_0x1dab3a--)if(_0x57a6a2=_0xa6007f[_0x1dab3a])_0x5dce81=(_0x2e797e<0x3?_0x57a6a2(_0x5dce81):_0x2e797e>0x3?_0x57a6a2(_0x19c9e8,_0x10c834,_0x5dce81):_0x57a6a2(_0x19c9e8,_0x10c834))||_0x5dce81;}return _0x2e797e>0x3&&_0x5dce81&&Object['defineProperty'](_0x19c9e8,_0x10c834,_0x5dce81),_0x5dce81;},__metadata=this&&this[a9_0x49bbb3(0x1d7)]||function(_0x1bfdf8,_0x15c135){const _0x2ff4f4=a9_0x49bbb3;if(typeof Reflect===_0x2ff4f4(0x1c1)&&typeof Reflect['metadata']===_0x2ff4f4(0x1f2))return Reflect[_0x2ff4f4(0x1ef)](_0x1bfdf8,_0x15c135);},JobProccessor_1;Object[a9_0x49bbb3(0x1eb)](exports,'__esModule',{'value':!![]}),exports['JobProccessor']=void 0x0;const common_1=require(a9_0x49bbb3(0x206)),agenda_1=require(a9_0x49bbb3(0x1d0)),nestjs_agenda_1=require('@agent-ly/nestjs-agenda'),enums_1=require(a9_0x49bbb3(0x1d4)),schedule_service_1=require(a9_0x49bbb3(0x1c5)),setting_service_1=require(a9_0x49bbb3(0x1c9)),file_1=require(a9_0x49bbb3(0x1d3)),constants_1=require(a9_0x49bbb3(0x1f7));let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0xdabba9,_0x55fceb,_0x10cab5){const _0x4ac412=a9_0x49bbb3;this['agendaService']=_0xdabba9,this[_0x4ac412(0x1d6)]=_0x55fceb,this['settingService']=_0x10cab5,this[_0x4ac412(0x1c7)]=new common_1['Logger'](JobProccessor_1[_0x4ac412(0x1c2)]);}async['checkEvent'](_0x22b90b){const _0x58a0f2=a9_0x49bbb3;this[_0x58a0f2(0x1c7)][_0x58a0f2(0x20e)]('Server\x20time:\x20'+new Date()+_0x58a0f2(0x1d8)+_0x22b90b[_0x58a0f2(0x1ea)][_0x58a0f2(0x1c2)]);const _0x56af49=await this[_0x58a0f2(0x1db)]['updateExpiryStatus']();if(_0x56af49[_0x58a0f2(0x209)]){this[_0x58a0f2(0x1c7)][_0x58a0f2(0x20e)](_0x58a0f2(0x1ce));if(process[_0x58a0f2(0x1ca)][_0x58a0f2(0x1fb)]!=='development')return;}this[_0x58a0f2(0x1c7)][_0x58a0f2(0x20e)]('Canceling\x20all\x20old\x20background\x20checks...'),await this[_0x58a0f2(0x1ed)][_0x58a0f2(0x1f6)]({'name':{'$nin':[enums_1[_0x58a0f2(0x204)]['CheckEvent'],enums_1[_0x58a0f2(0x204)][_0x58a0f2(0x1f3)]]},'type':'single'}),this['logger'][_0x58a0f2(0x20e)]('Fetching\x20today\x20schedule...');const _0xa41215=await this['scheduleService'][_0x58a0f2(0x20b)](new Date());this[_0x58a0f2(0x1c7)]['log']('Eligible\x20schedule:\x20'+(_0xa41215===null||_0xa41215===void 0x0?void 0x0:_0xa41215[_0x58a0f2(0x1c2)]));if(!_0xa41215||!_0xa41215[_0x58a0f2(0x200)]||_0xa41215['events'][_0x58a0f2(0x1cc)]===0x0)return;_0xa41215[_0x58a0f2(0x200)]['forEach'](_0x1a1176=>{const _0x5debf6=_0x58a0f2;this[_0x5debf6(0x1c7)]['log'](_0x5debf6(0x1e8)+_0x1a1176[_0x5debf6(0x1e2)]+'\x20-\x20'+_0x1a1176[_0x5debf6(0x1d9)]+_0x5debf6(0x1e9)+_0x1a1176['name']);const _0x1f058f=new Date(),_0x514635=_0x1f058f[_0x5debf6(0x1e5)](),_0x461d5c=_0x1f058f[_0x5debf6(0x1f4)](),_0x1d00e5=_0x1f058f['getSeconds'](),[_0x3a19bf,_0x349697,_0x1ede70]=_0x1a1176[_0x5debf6(0x1e2)][_0x5debf6(0x1c0)](':');if(+_0x3a19bf<_0x514635||+_0x3a19bf===_0x514635&&+_0x349697<_0x461d5c||+_0x3a19bf===_0x514635&&+_0x349697===_0x461d5c&&+_0x1ede70<_0x1d00e5)return;_0x1f058f[_0x5debf6(0x1f8)](+_0x3a19bf),_0x1f058f[_0x5debf6(0x1cb)](+_0x349697),_0x1f058f['setSeconds'](+_0x1ede70);switch(_0x1a1176[_0x5debf6(0x1d9)]){case enums_1[_0x5debf6(0x1f0)][_0x5debf6(0x1ee)]:{const {soundId:_0x1a9dc9,durationInSecond:_0x134bb4}=_0x1a1176[_0x5debf6(0x1c4)];if(!_0x1a9dc9)return;const _0x48e664={'soundId':_0x1a9dc9,'durationInSecond':_0x134bb4,'audit':{'actor':enums_1[_0x5debf6(0x1d5)]['Job'],'name':enums_1['JobType'][_0x5debf6(0x1ee)],'message':_0x5debf6(0x1f5)+_0x1a1176[_0x5debf6(0x1c2)]+_0x5debf6(0x1dd)+_0xa41215['name']}};this[_0x5debf6(0x1ed)]['schedule'](_0x1f058f,enums_1[_0x5debf6(0x1f0)]['PlaySound'],_0x48e664);break;}case enums_1[_0x5debf6(0x1f0)]['PlayMusic']:{const {playlistId:_0xc6bf6f,durationInSecond:_0x76d779}=_0x1a1176[_0x5debf6(0x1c4)];if(!_0xc6bf6f)return;const _0x5079c2={'playlistId':_0xc6bf6f,'durationInSecond':_0x76d779,'audit':{'actor':enums_1['AuditActor']['Job'],'name':enums_1[_0x5debf6(0x1f0)][_0x5debf6(0x1ec)],'message':_0x5debf6(0x1f5)+_0x1a1176[_0x5debf6(0x1c2)]+_0x5debf6(0x1dd)+_0xa41215['name']}};this['agendaService'][_0x5debf6(0x202)](_0x1f058f,enums_1[_0x5debf6(0x1f0)]['PlayMusic'],_0x5079c2);break;}case enums_1[_0x5debf6(0x1f0)]['PlayVoiceRecorded']:{const {voiceId:_0x588675,durationInSecond:_0x4ea81f}=_0x1a1176['data'];if(!_0x588675)return;const _0x2de4cd={'voiceId':_0x588675,'durationInSecond':_0x4ea81f,'audit':{'actor':enums_1[_0x5debf6(0x1d5)][_0x5debf6(0x1e6)],'name':enums_1[_0x5debf6(0x1f0)][_0x5debf6(0x1e0)],'message':_0x5debf6(0x1f5)+_0x1a1176[_0x5debf6(0x1c2)]+_0x5debf6(0x1dd)+_0xa41215[_0x5debf6(0x1c2)]}};this[_0x5debf6(0x1ed)]['schedule'](_0x1f058f,enums_1[_0x5debf6(0x1f0)][_0x5debf6(0x1e0)],_0x2de4cd);break;}case enums_1[_0x5debf6(0x1f0)][_0x5debf6(0x20c)]:{const {textToAudioId:_0x10928b,durationInSecond:_0x5e854d}=_0x1a1176[_0x5debf6(0x1c4)];if(!_0x10928b)return;const _0x38bbd2={'textToAudioId':_0x10928b,'durationInSecond':_0x5e854d,'audit':{'actor':enums_1[_0x5debf6(0x1d5)][_0x5debf6(0x1e6)],'name':enums_1[_0x5debf6(0x1f0)]['PlayTextToAudio'],'message':_0x5debf6(0x1f5)+_0x1a1176[_0x5debf6(0x1c2)]+'\x20-\x20Schedule:\x20'+_0xa41215[_0x5debf6(0x1c2)]}};this[_0x5debf6(0x1ed)][_0x5debf6(0x202)](_0x1f058f,enums_1[_0x5debf6(0x1f0)][_0x5debf6(0x20c)],_0x38bbd2);break;}default:return;}}),this[_0x58a0f2(0x1c7)][_0x58a0f2(0x20e)](_0x58a0f2(0x1d2));}async[a9_0x49bbb3(0x1e1)](_0x304580){const _0x33bc15=a9_0x49bbb3;this['logger'][_0x33bc15(0x20e)](_0x33bc15(0x1c8));const {success:_0x2a4dd4,message:_0x8818e2}=await(0x0,file_1[_0x33bc15(0x205)])(constants_1[_0x33bc15(0x201)]);!_0x2a4dd4&&this[_0x33bc15(0x1c7)][_0x33bc15(0x1fd)](_0x33bc15(0x203)+_0x8818e2);}};__decorate([(0x0,nestjs_agenda_1[a9_0x49bbb3(0x1d1)])(enums_1[a9_0x49bbb3(0x204)][a9_0x49bbb3(0x1fe)]),__metadata(a9_0x49bbb3(0x1ff),Function),__metadata(a9_0x49bbb3(0x20a),[agenda_1[a9_0x49bbb3(0x1e6)]]),__metadata(a9_0x49bbb3(0x1e7),Promise)],JobProccessor[a9_0x49bbb3(0x1f9)],a9_0x49bbb3(0x20d),null),__decorate([(0x0,nestjs_agenda_1[a9_0x49bbb3(0x1d1)])(enums_1[a9_0x49bbb3(0x204)]['PurgeTempUploadedFiles']),__metadata(a9_0x49bbb3(0x1ff),Function),__metadata('design:paramtypes',[agenda_1['Job']]),__metadata(a9_0x49bbb3(0x1e7),Promise)],JobProccessor['prototype'],a9_0x49bbb3(0x1e1),null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x49bbb3(0x1fa)])(),__metadata('design:paramtypes',[nestjs_agenda_1[a9_0x49bbb3(0x1cf)],schedule_service_1[a9_0x49bbb3(0x1f1)],setting_service_1[a9_0x49bbb3(0x20f)]])],JobProccessor),exports[a9_0x49bbb3(0x1df)]=JobProccessor;