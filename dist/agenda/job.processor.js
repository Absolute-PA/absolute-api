'use strict';const a9_0x1f9600=a9_0x303a;(function(_0x455e91,_0x1c0555){const _0x30d7a7=a9_0x303a,_0x1179fd=_0x455e91();while(!![]){try{const _0x2c3bd7=parseInt(_0x30d7a7(0x1a4))/0x1+parseInt(_0x30d7a7(0x1bc))/0x2*(parseInt(_0x30d7a7(0x187))/0x3)+parseInt(_0x30d7a7(0x1bb))/0x4*(-parseInt(_0x30d7a7(0x1a0))/0x5)+parseInt(_0x30d7a7(0x17f))/0x6*(parseInt(_0x30d7a7(0x176))/0x7)+-parseInt(_0x30d7a7(0x1aa))/0x8+parseInt(_0x30d7a7(0x171))/0x9+parseInt(_0x30d7a7(0x175))/0xa*(-parseInt(_0x30d7a7(0x19f))/0xb);if(_0x2c3bd7===_0x1c0555)break;else _0x1179fd['push'](_0x1179fd['shift']());}catch(_0x332dff){_0x1179fd['push'](_0x1179fd['shift']());}}}(a9_0x5e6d,0xc9913));var __decorate=this&&this[a9_0x1f9600(0x1b0)]||function(_0x4735a3,_0x3b4c28,_0x1c456c,_0x96ba37){const _0x46c14b=a9_0x1f9600;var _0x1a4a0b=arguments['length'],_0x333105=_0x1a4a0b<0x3?_0x3b4c28:_0x96ba37===null?_0x96ba37=Object[_0x46c14b(0x1b1)](_0x3b4c28,_0x1c456c):_0x96ba37,_0xc4ddca;if(typeof Reflect===_0x46c14b(0x1a7)&&typeof Reflect['decorate']===_0x46c14b(0x173))_0x333105=Reflect[_0x46c14b(0x190)](_0x4735a3,_0x3b4c28,_0x1c456c,_0x96ba37);else{for(var _0x46e8d6=_0x4735a3[_0x46c14b(0x188)]-0x1;_0x46e8d6>=0x0;_0x46e8d6--)if(_0xc4ddca=_0x4735a3[_0x46e8d6])_0x333105=(_0x1a4a0b<0x3?_0xc4ddca(_0x333105):_0x1a4a0b>0x3?_0xc4ddca(_0x3b4c28,_0x1c456c,_0x333105):_0xc4ddca(_0x3b4c28,_0x1c456c))||_0x333105;}return _0x1a4a0b>0x3&&_0x333105&&Object[_0x46c14b(0x1bf)](_0x3b4c28,_0x1c456c,_0x333105),_0x333105;},__metadata=this&&this[a9_0x1f9600(0x1a9)]||function(_0x43cc0c,_0x593790){const _0x2f1804=a9_0x1f9600;if(typeof Reflect===_0x2f1804(0x1a7)&&typeof Reflect[_0x2f1804(0x193)]===_0x2f1804(0x173))return Reflect['metadata'](_0x43cc0c,_0x593790);},JobProccessor_1;function a9_0x303a(_0x3159a6,_0x1f88ae){const _0x5e6ddb=a9_0x5e6d();return a9_0x303a=function(_0x303a49,_0x5b2c56){_0x303a49=_0x303a49-0x171;let _0x2805b9=_0x5e6ddb[_0x303a49];return _0x2805b9;},a9_0x303a(_0x3159a6,_0x1f88ae);}function a9_0x5e6d(){const _0x565e72=['env','758207nvkYPe','Processor','Job','object','SettingService','__metadata','1553952PyNcYN','Purging\x20temp\x20uploaded\x20files...','setSeconds','PlayVoiceRecorded','PlayMusic','setMinutes','__decorate','getOwnPropertyDescriptor','schedule','AuditActor','__esModule','BackgroundJobType','prototype','JobType','Eligible\x20schedule:\x20','PlaySound','Event:\x20','136EDaznX','6IPpvtR','isExpired','purgeTempUploadedFiles','defineProperty','logger','deleteFilesInFolder','4289400VwOzbq','@nestjs/common','function','data','13270yiUXtB','14FuyuBv','design:returntype','PurgeTempUploadedFiles','../setting/setting.service','ScheduleService','agendaService','CheckEvent','JobProccessor','NODE_ENV','416016bTmxEl','log','getSeconds','TMP_UPLOAD_DIR','\x20-\x20Schedule:\x20','cancel','checkEvent','split','1441677ZayoWK','length','scheduleService','development','name','time','\x20-\x20','settingService','@agent-ly/nestjs-agenda','decorate','PlayTextToAudio','Server\x20time:\x20','metadata','findEligibleSchedule','Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20','../common/constants','single','getHours','../schedule/schedule.service','events','Invalid\x20or\x20expired\x20license\x20key!','design:paramtypes','Define','jobType','10747ocjxtG','73355kWbTGR','agenda','forEach'];a9_0x5e6d=function(){return _0x565e72;};return a9_0x5e6d();}Object[a9_0x1f9600(0x1bf)](exports,a9_0x1f9600(0x1b4),{'value':!![]}),exports[a9_0x1f9600(0x17d)]=void 0x0;const common_1=require(a9_0x1f9600(0x172)),agenda_1=require(a9_0x1f9600(0x1a1)),nestjs_agenda_1=require(a9_0x1f9600(0x18f)),enums_1=require('../common/enums'),schedule_service_1=require(a9_0x1f9600(0x199)),setting_service_1=require(a9_0x1f9600(0x179)),file_1=require('../common/file'),constants_1=require(a9_0x1f9600(0x196));let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x5a4ae5,_0x561a75,_0x48ef20){const _0x4249ae=a9_0x1f9600;this[_0x4249ae(0x17b)]=_0x5a4ae5,this[_0x4249ae(0x189)]=_0x561a75,this[_0x4249ae(0x18e)]=_0x48ef20,this[_0x4249ae(0x1c0)]=new common_1['Logger'](JobProccessor_1[_0x4249ae(0x18b)]);}async[a9_0x1f9600(0x185)](_0x55e42c){const _0x5e02b1=a9_0x1f9600;this['logger'][_0x5e02b1(0x180)](_0x5e02b1(0x192)+new Date()+'.\x20Job:\x20'+_0x55e42c['attrs'][_0x5e02b1(0x18b)]);const _0x5fe8d9=await this[_0x5e02b1(0x18e)]['updateExpiryStatus']();if(_0x5fe8d9[_0x5e02b1(0x1bd)]){this['logger']['log'](_0x5e02b1(0x19b));if(process[_0x5e02b1(0x1a3)][_0x5e02b1(0x17e)]!==_0x5e02b1(0x18a))return;}this[_0x5e02b1(0x1c0)]['log']('Canceling\x20all\x20old\x20background\x20checks...'),await this['agendaService'][_0x5e02b1(0x184)]({'name':{'$nin':[enums_1[_0x5e02b1(0x1b5)][_0x5e02b1(0x17c)],enums_1['BackgroundJobType'][_0x5e02b1(0x178)]]},'type':_0x5e02b1(0x197)}),this['logger'][_0x5e02b1(0x180)]('Fetching\x20today\x20schedule...');const _0x3d4805=await this['scheduleService'][_0x5e02b1(0x194)](new Date());this[_0x5e02b1(0x1c0)][_0x5e02b1(0x180)](_0x5e02b1(0x1b8)+(_0x3d4805===null||_0x3d4805===void 0x0?void 0x0:_0x3d4805[_0x5e02b1(0x18b)]));if(!_0x3d4805||!_0x3d4805[_0x5e02b1(0x19a)]||_0x3d4805[_0x5e02b1(0x19a)]['length']===0x0)return;_0x3d4805[_0x5e02b1(0x19a)][_0x5e02b1(0x1a2)](_0x448308=>{const _0x3a31fa=_0x5e02b1;this[_0x3a31fa(0x1c0)][_0x3a31fa(0x180)]('Scheduling\x20event:\x20'+_0x448308[_0x3a31fa(0x18c)]+_0x3a31fa(0x18d)+_0x448308[_0x3a31fa(0x19e)]+_0x3a31fa(0x18d)+_0x448308[_0x3a31fa(0x18b)]);const _0x35c23c=new Date(),_0x3329e0=_0x35c23c[_0x3a31fa(0x198)](),_0x33c655=_0x35c23c['getMinutes'](),_0x3d6c3b=_0x35c23c[_0x3a31fa(0x181)](),[_0x3e6f52,_0x3c7031,_0x89c4fb]=_0x448308[_0x3a31fa(0x18c)][_0x3a31fa(0x186)](':');if(+_0x3e6f52<_0x3329e0||+_0x3e6f52===_0x3329e0&&+_0x3c7031<_0x33c655||+_0x3e6f52===_0x3329e0&&+_0x3c7031===_0x33c655&&+_0x89c4fb<_0x3d6c3b)return;_0x35c23c['setHours'](+_0x3e6f52),_0x35c23c[_0x3a31fa(0x1af)](+_0x3c7031),_0x35c23c[_0x3a31fa(0x1ac)](+_0x89c4fb);switch(_0x448308[_0x3a31fa(0x19e)]){case enums_1[_0x3a31fa(0x1b7)][_0x3a31fa(0x1b9)]:{const {soundId:_0x3bb6f9,durationInSecond:_0x43d544}=_0x448308[_0x3a31fa(0x174)];if(!_0x3bb6f9)return;const _0x45d90b={'soundId':_0x3bb6f9,'durationInSecond':_0x43d544,'audit':{'actor':enums_1['AuditActor'][_0x3a31fa(0x1a6)],'name':enums_1[_0x3a31fa(0x1b7)][_0x3a31fa(0x1b9)],'message':_0x3a31fa(0x1ba)+_0x448308[_0x3a31fa(0x18b)]+_0x3a31fa(0x183)+_0x3d4805[_0x3a31fa(0x18b)]}};this['agendaService']['schedule'](_0x35c23c,enums_1[_0x3a31fa(0x1b7)]['PlaySound'],_0x45d90b);break;}case enums_1[_0x3a31fa(0x1b7)][_0x3a31fa(0x1ae)]:{const {playlistId:_0x5b355e,durationInSecond:_0x1eb2a3}=_0x448308[_0x3a31fa(0x174)];if(!_0x5b355e)return;const _0x5496c8={'playlistId':_0x5b355e,'durationInSecond':_0x1eb2a3,'audit':{'actor':enums_1[_0x3a31fa(0x1b3)]['Job'],'name':enums_1['JobType'][_0x3a31fa(0x1ae)],'message':'Event:\x20'+_0x448308[_0x3a31fa(0x18b)]+'\x20-\x20Schedule:\x20'+_0x3d4805['name']}};this[_0x3a31fa(0x17b)][_0x3a31fa(0x1b2)](_0x35c23c,enums_1[_0x3a31fa(0x1b7)][_0x3a31fa(0x1ae)],_0x5496c8);break;}case enums_1[_0x3a31fa(0x1b7)]['PlayVoiceRecorded']:{const {voiceId:_0x3cddcf,durationInSecond:_0x571ae6}=_0x448308[_0x3a31fa(0x174)];if(!_0x3cddcf)return;const _0x5d1298={'voiceId':_0x3cddcf,'durationInSecond':_0x571ae6,'audit':{'actor':enums_1[_0x3a31fa(0x1b3)][_0x3a31fa(0x1a6)],'name':enums_1[_0x3a31fa(0x1b7)]['PlayVoiceRecorded'],'message':_0x3a31fa(0x1ba)+_0x448308['name']+_0x3a31fa(0x183)+_0x3d4805[_0x3a31fa(0x18b)]}};this[_0x3a31fa(0x17b)][_0x3a31fa(0x1b2)](_0x35c23c,enums_1[_0x3a31fa(0x1b7)][_0x3a31fa(0x1ad)],_0x5d1298);break;}case enums_1[_0x3a31fa(0x1b7)][_0x3a31fa(0x191)]:{const {textToAudioId:_0x242bf9,durationInSecond:_0x450292}=_0x448308[_0x3a31fa(0x174)];if(!_0x242bf9)return;const _0x3b9020={'textToAudioId':_0x242bf9,'durationInSecond':_0x450292,'audit':{'actor':enums_1[_0x3a31fa(0x1b3)][_0x3a31fa(0x1a6)],'name':enums_1['JobType'][_0x3a31fa(0x191)],'message':_0x3a31fa(0x1ba)+_0x448308[_0x3a31fa(0x18b)]+_0x3a31fa(0x183)+_0x3d4805['name']}};this['agendaService'][_0x3a31fa(0x1b2)](_0x35c23c,enums_1['JobType'][_0x3a31fa(0x191)],_0x3b9020);break;}default:return;}}),this[_0x5e02b1(0x1c0)][_0x5e02b1(0x180)]('Events\x20scheduled!');}async[a9_0x1f9600(0x1be)](_0x1538b8){const _0x4bf53c=a9_0x1f9600;this[_0x4bf53c(0x1c0)][_0x4bf53c(0x180)](_0x4bf53c(0x1ab));const {success:_0x283905,message:_0x5528af}=await(0x0,file_1[_0x4bf53c(0x1c1)])(constants_1[_0x4bf53c(0x182)]);!_0x283905&&this['logger']['error'](_0x4bf53c(0x195)+_0x5528af);}};__decorate([(0x0,nestjs_agenda_1['Define'])(enums_1[a9_0x1f9600(0x1b5)][a9_0x1f9600(0x17c)]),__metadata('design:type',Function),__metadata('design:paramtypes',[agenda_1[a9_0x1f9600(0x1a6)]]),__metadata(a9_0x1f9600(0x177),Promise)],JobProccessor[a9_0x1f9600(0x1b6)],a9_0x1f9600(0x185),null),__decorate([(0x0,nestjs_agenda_1[a9_0x1f9600(0x19d)])(enums_1[a9_0x1f9600(0x1b5)][a9_0x1f9600(0x178)]),__metadata('design:type',Function),__metadata(a9_0x1f9600(0x19c),[agenda_1[a9_0x1f9600(0x1a6)]]),__metadata('design:returntype',Promise)],JobProccessor['prototype'],'purgeTempUploadedFiles',null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x1f9600(0x1a5)])(),__metadata(a9_0x1f9600(0x19c),[nestjs_agenda_1['AgendaService'],schedule_service_1[a9_0x1f9600(0x17a)],setting_service_1[a9_0x1f9600(0x1a8)]])],JobProccessor),exports[a9_0x1f9600(0x17d)]=JobProccessor;