'use strict';function a9_0x4ee9(_0x238e18,_0x3fbd99){const _0x59ba8c=a9_0x59ba();return a9_0x4ee9=function(_0x4ee998,_0x46496b){_0x4ee998=_0x4ee998-0x8c;let _0x3fca33=_0x59ba8c[_0x4ee998];return _0x3fca33;},a9_0x4ee9(_0x238e18,_0x3fbd99);}const a9_0x243ac8=a9_0x4ee9;(function(_0x347857,_0x1d588b){const _0x1aae24=a9_0x4ee9,_0x21d9b8=_0x347857();while(!![]){try{const _0x5acdc9=parseInt(_0x1aae24(0xce))/0x1+-parseInt(_0x1aae24(0xbb))/0x2+parseInt(_0x1aae24(0xbc))/0x3+parseInt(_0x1aae24(0x96))/0x4+-parseInt(_0x1aae24(0xc6))/0x5*(parseInt(_0x1aae24(0x91))/0x6)+-parseInt(_0x1aae24(0xcd))/0x7+parseInt(_0x1aae24(0x8e))/0x8;if(_0x5acdc9===_0x1d588b)break;else _0x21d9b8['push'](_0x21d9b8['shift']());}catch(_0x3d250d){_0x21d9b8['push'](_0x21d9b8['shift']());}}}(a9_0x59ba,0xb8467));var __decorate=this&&this[a9_0x243ac8(0xa1)]||function(_0x389bfc,_0x2d7693,_0xb2022f,_0x523cfa){const _0x455e9a=a9_0x243ac8;var _0x4d1d68=arguments[_0x455e9a(0xb2)],_0xaa2d19=_0x4d1d68<0x3?_0x2d7693:_0x523cfa===null?_0x523cfa=Object['getOwnPropertyDescriptor'](_0x2d7693,_0xb2022f):_0x523cfa,_0x1fd99d;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x455e9a(0x95))_0xaa2d19=Reflect[_0x455e9a(0xd1)](_0x389bfc,_0x2d7693,_0xb2022f,_0x523cfa);else{for(var _0x5799f0=_0x389bfc[_0x455e9a(0xb2)]-0x1;_0x5799f0>=0x0;_0x5799f0--)if(_0x1fd99d=_0x389bfc[_0x5799f0])_0xaa2d19=(_0x4d1d68<0x3?_0x1fd99d(_0xaa2d19):_0x4d1d68>0x3?_0x1fd99d(_0x2d7693,_0xb2022f,_0xaa2d19):_0x1fd99d(_0x2d7693,_0xb2022f))||_0xaa2d19;}return _0x4d1d68>0x3&&_0xaa2d19&&Object[_0x455e9a(0xda)](_0x2d7693,_0xb2022f,_0xaa2d19),_0xaa2d19;},__metadata=this&&this[a9_0x243ac8(0x8d)]||function(_0xe7cee8,_0x52b73c){const _0x316c22=a9_0x243ac8;if(typeof Reflect==='object'&&typeof Reflect[_0x316c22(0x9f)]==='function')return Reflect['metadata'](_0xe7cee8,_0x52b73c);},JobProccessor_1;Object[a9_0x243ac8(0xda)](exports,a9_0x243ac8(0xa4),{'value':!![]}),exports[a9_0x243ac8(0xd6)]=void 0x0;function a9_0x59ba(){const _0x4059b8=['768864ulRhiI','time','log','571734TYdtOs','updateExpiryStatus','Server\x20time:\x20','logger','function','2679980mxzEDC','events','purgeTempUploadedFiles','single','Canceling\x20all\x20old\x20background\x20checks...','PlaySound','PlayMusic','cancel','design:returntype','metadata','design:paramtypes','__decorate','Scheduling\x20event:\x20','getMinutes','__esModule','agendaService','checkEvent','data','jobType','../setting/setting.service','setSeconds','AgendaService','deleteFilesInFolder','PlayTextToAudio','getHours','TMP_UPLOAD_DIR','getSeconds','AuditActor','length','Job','prototype','\x20-\x20Schedule:\x20','@nestjs/common','\x20-\x20','setMinutes','Purging\x20temp\x20uploaded\x20files...','PlayVoiceRecorded','1103790vrUQkR','3301836QkEvln','Events\x20scheduled!','SettingService','CheckEvent','Eligible\x20schedule:\x20','.\x20Job:\x20','Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20','../common/file','development','attrs','60USqPTK','Invalid\x20or\x20expired\x20license\x20key!','Event:\x20','NODE_ENV','Define','Processor','../schedule/schedule.service','1777062NLfJCQ','837305pWJXnv','schedule','env','decorate','@agent-ly/nestjs-agenda','name','setHours','BackgroundJobType','JobProccessor','split','scheduleService','settingService','defineProperty','design:type','agenda','../common/enums','PurgeTempUploadedFiles','JobType','forEach','__metadata'];a9_0x59ba=function(){return _0x4059b8;};return a9_0x59ba();}const common_1=require(a9_0x243ac8(0xb6)),agenda_1=require(a9_0x243ac8(0xdc)),nestjs_agenda_1=require(a9_0x243ac8(0xd2)),enums_1=require(a9_0x243ac8(0xdd)),schedule_service_1=require(a9_0x243ac8(0xcc)),setting_service_1=require(a9_0x243ac8(0xa9)),file_1=require(a9_0x243ac8(0xc3)),constants_1=require('../common/constants');let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x2acd57,_0x4ede93,_0x273e85){const _0x158478=a9_0x243ac8;this[_0x158478(0xa5)]=_0x2acd57,this[_0x158478(0xd8)]=_0x4ede93,this[_0x158478(0xd9)]=_0x273e85,this[_0x158478(0x94)]=new common_1['Logger'](JobProccessor_1[_0x158478(0xd3)]);}async[a9_0x243ac8(0xa6)](_0x4ba4d1){const _0x561bcd=a9_0x243ac8;this[_0x561bcd(0x94)][_0x561bcd(0x90)](_0x561bcd(0x93)+new Date()+_0x561bcd(0xc1)+_0x4ba4d1[_0x561bcd(0xc5)][_0x561bcd(0xd3)]);const _0x943e87=await this[_0x561bcd(0xd9)][_0x561bcd(0x92)]();if(_0x943e87['isExpired']){this[_0x561bcd(0x94)][_0x561bcd(0x90)](_0x561bcd(0xc7));if(process[_0x561bcd(0xd0)][_0x561bcd(0xc9)]!==_0x561bcd(0xc4))return;}this[_0x561bcd(0x94)][_0x561bcd(0x90)](_0x561bcd(0x9a)),await this[_0x561bcd(0xa5)][_0x561bcd(0x9d)]({'name':{'$nin':[enums_1[_0x561bcd(0xd5)][_0x561bcd(0xbf)],enums_1[_0x561bcd(0xd5)][_0x561bcd(0xde)]]},'type':_0x561bcd(0x99)}),this['logger']['log']('Fetching\x20today\x20schedule...');const _0xb5c247=await this['scheduleService']['findEligibleSchedule'](new Date());this[_0x561bcd(0x94)][_0x561bcd(0x90)](_0x561bcd(0xc0)+(_0xb5c247===null||_0xb5c247===void 0x0?void 0x0:_0xb5c247['name']));if(!_0xb5c247||!_0xb5c247[_0x561bcd(0x97)]||_0xb5c247['events'][_0x561bcd(0xb2)]===0x0)return;_0xb5c247[_0x561bcd(0x97)][_0x561bcd(0x8c)](_0x19ee36=>{const _0x28cde3=_0x561bcd;this['logger'][_0x28cde3(0x90)](_0x28cde3(0xa2)+_0x19ee36['time']+_0x28cde3(0xb7)+_0x19ee36[_0x28cde3(0xa8)]+_0x28cde3(0xb7)+_0x19ee36[_0x28cde3(0xd3)]);const _0x394c4a=new Date(),_0x1e8d49=_0x394c4a[_0x28cde3(0xae)](),_0x581629=_0x394c4a[_0x28cde3(0xa3)](),_0x533b55=_0x394c4a[_0x28cde3(0xb0)](),[_0x2eee79,_0x1c6085,_0x59a8cb]=_0x19ee36[_0x28cde3(0x8f)][_0x28cde3(0xd7)](':');if(+_0x2eee79<_0x1e8d49||+_0x2eee79===_0x1e8d49&&+_0x1c6085<_0x581629||+_0x2eee79===_0x1e8d49&&+_0x1c6085===_0x581629&&+_0x59a8cb<_0x533b55)return;_0x394c4a[_0x28cde3(0xd4)](+_0x2eee79),_0x394c4a[_0x28cde3(0xb8)](+_0x1c6085),_0x394c4a[_0x28cde3(0xaa)](+_0x59a8cb);switch(_0x19ee36[_0x28cde3(0xa8)]){case enums_1[_0x28cde3(0xdf)][_0x28cde3(0x9b)]:{const {soundId:_0x365df9,durationInSecond:_0x3b9eaf}=_0x19ee36['data'];if(!_0x365df9)return;const _0x212ad0={'soundId':_0x365df9,'durationInSecond':_0x3b9eaf,'audit':{'actor':enums_1['AuditActor'][_0x28cde3(0xb3)],'name':enums_1[_0x28cde3(0xdf)][_0x28cde3(0x9b)],'message':'Event:\x20'+_0x19ee36['name']+_0x28cde3(0xb5)+_0xb5c247[_0x28cde3(0xd3)]}};this[_0x28cde3(0xa5)][_0x28cde3(0xcf)](_0x394c4a,enums_1[_0x28cde3(0xdf)][_0x28cde3(0x9b)],_0x212ad0);break;}case enums_1[_0x28cde3(0xdf)][_0x28cde3(0x9c)]:{const {playlistId:_0x24348a,durationInSecond:_0x516945}=_0x19ee36[_0x28cde3(0xa7)];if(!_0x24348a)return;const _0x5594e7={'playlistId':_0x24348a,'durationInSecond':_0x516945,'audit':{'actor':enums_1[_0x28cde3(0xb1)][_0x28cde3(0xb3)],'name':enums_1['JobType']['PlayMusic'],'message':_0x28cde3(0xc8)+_0x19ee36[_0x28cde3(0xd3)]+_0x28cde3(0xb5)+_0xb5c247[_0x28cde3(0xd3)]}};this[_0x28cde3(0xa5)]['schedule'](_0x394c4a,enums_1[_0x28cde3(0xdf)]['PlayMusic'],_0x5594e7);break;}case enums_1[_0x28cde3(0xdf)][_0x28cde3(0xba)]:{const {voiceId:_0x1c0264,durationInSecond:_0x906b43}=_0x19ee36['data'];if(!_0x1c0264)return;const _0x57aff2={'voiceId':_0x1c0264,'durationInSecond':_0x906b43,'audit':{'actor':enums_1[_0x28cde3(0xb1)][_0x28cde3(0xb3)],'name':enums_1[_0x28cde3(0xdf)]['PlayVoiceRecorded'],'message':_0x28cde3(0xc8)+_0x19ee36[_0x28cde3(0xd3)]+_0x28cde3(0xb5)+_0xb5c247['name']}};this[_0x28cde3(0xa5)][_0x28cde3(0xcf)](_0x394c4a,enums_1[_0x28cde3(0xdf)][_0x28cde3(0xba)],_0x57aff2);break;}case enums_1[_0x28cde3(0xdf)]['PlayTextToAudio']:{const {textToAudioId:_0x80f734,durationInSecond:_0x2c7d8c}=_0x19ee36[_0x28cde3(0xa7)];if(!_0x80f734)return;const _0x133c6f={'textToAudioId':_0x80f734,'durationInSecond':_0x2c7d8c,'audit':{'actor':enums_1[_0x28cde3(0xb1)][_0x28cde3(0xb3)],'name':enums_1[_0x28cde3(0xdf)][_0x28cde3(0xad)],'message':'Event:\x20'+_0x19ee36[_0x28cde3(0xd3)]+'\x20-\x20Schedule:\x20'+_0xb5c247[_0x28cde3(0xd3)]}};this[_0x28cde3(0xa5)][_0x28cde3(0xcf)](_0x394c4a,enums_1['JobType'][_0x28cde3(0xad)],_0x133c6f);break;}default:return;}}),this['logger'][_0x561bcd(0x90)](_0x561bcd(0xbd));}async[a9_0x243ac8(0x98)](_0x16cd1a){const _0x3afdfc=a9_0x243ac8;this[_0x3afdfc(0x94)]['log'](_0x3afdfc(0xb9));const {success:_0x2c0f0c,message:_0x2a2fa7}=await(0x0,file_1[_0x3afdfc(0xac)])(constants_1[_0x3afdfc(0xaf)]);!_0x2c0f0c&&this['logger']['error'](_0x3afdfc(0xc2)+_0x2a2fa7);}};__decorate([(0x0,nestjs_agenda_1['Define'])(enums_1[a9_0x243ac8(0xd5)]['CheckEvent']),__metadata(a9_0x243ac8(0xdb),Function),__metadata(a9_0x243ac8(0xa0),[agenda_1[a9_0x243ac8(0xb3)]]),__metadata(a9_0x243ac8(0x9e),Promise)],JobProccessor[a9_0x243ac8(0xb4)],'checkEvent',null),__decorate([(0x0,nestjs_agenda_1[a9_0x243ac8(0xca)])(enums_1[a9_0x243ac8(0xd5)][a9_0x243ac8(0xde)]),__metadata('design:type',Function),__metadata(a9_0x243ac8(0xa0),[agenda_1[a9_0x243ac8(0xb3)]]),__metadata(a9_0x243ac8(0x9e),Promise)],JobProccessor['prototype'],'purgeTempUploadedFiles',null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x243ac8(0xcb)])(),__metadata('design:paramtypes',[nestjs_agenda_1[a9_0x243ac8(0xab)],schedule_service_1['ScheduleService'],setting_service_1[a9_0x243ac8(0xbe)]])],JobProccessor),exports[a9_0x243ac8(0xd6)]=JobProccessor;