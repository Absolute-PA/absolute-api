'use strict';const a9_0x13d4bc=a9_0xefbe;(function(_0x1215c1,_0x569bdd){const _0x3ab0ea=a9_0xefbe,_0x290c24=_0x1215c1();while(!![]){try{const _0x427916=parseInt(_0x3ab0ea(0x1b1))/0x1+-parseInt(_0x3ab0ea(0x18f))/0x2*(parseInt(_0x3ab0ea(0x1be))/0x3)+-parseInt(_0x3ab0ea(0x1d6))/0x4*(-parseInt(_0x3ab0ea(0x196))/0x5)+parseInt(_0x3ab0ea(0x194))/0x6+-parseInt(_0x3ab0ea(0x1cb))/0x7+parseInt(_0x3ab0ea(0x190))/0x8+parseInt(_0x3ab0ea(0x1c4))/0x9;if(_0x427916===_0x569bdd)break;else _0x290c24['push'](_0x290c24['shift']());}catch(_0x2d2530){_0x290c24['push'](_0x290c24['shift']());}}}(a9_0x12f1,0x8e3c4));var __decorate=this&&this['__decorate']||function(_0x1de262,_0x18bba6,_0x9b64ac,_0x4f2229){const _0x31d425=a9_0xefbe;var _0x58fc86=arguments['length'],_0x48356d=_0x58fc86<0x3?_0x18bba6:_0x4f2229===null?_0x4f2229=Object[_0x31d425(0x1dc)](_0x18bba6,_0x9b64ac):_0x4f2229,_0x2f88ea;if(typeof Reflect===_0x31d425(0x1b6)&&typeof Reflect[_0x31d425(0x1b7)]===_0x31d425(0x1da))_0x48356d=Reflect[_0x31d425(0x1b7)](_0x1de262,_0x18bba6,_0x9b64ac,_0x4f2229);else{for(var _0x3d66a5=_0x1de262['length']-0x1;_0x3d66a5>=0x0;_0x3d66a5--)if(_0x2f88ea=_0x1de262[_0x3d66a5])_0x48356d=(_0x58fc86<0x3?_0x2f88ea(_0x48356d):_0x58fc86>0x3?_0x2f88ea(_0x18bba6,_0x9b64ac,_0x48356d):_0x2f88ea(_0x18bba6,_0x9b64ac))||_0x48356d;}return _0x58fc86>0x3&&_0x48356d&&Object['defineProperty'](_0x18bba6,_0x9b64ac,_0x48356d),_0x48356d;},__metadata=this&&this['__metadata']||function(_0x296bec,_0xb07db){const _0x2acf0c=a9_0xefbe;if(typeof Reflect===_0x2acf0c(0x1b6)&&typeof Reflect['metadata']===_0x2acf0c(0x1da))return Reflect['metadata'](_0x296bec,_0xb07db);},JobProccessor_1;Object[a9_0x13d4bc(0x1c8)](exports,a9_0x13d4bc(0x192),{'value':!![]}),exports[a9_0x13d4bc(0x1ad)]=void 0x0;const common_1=require(a9_0x13d4bc(0x19c)),agenda_1=require(a9_0x13d4bc(0x1ab)),nestjs_agenda_1=require(a9_0x13d4bc(0x1c1)),enums_1=require(a9_0x13d4bc(0x1bf)),schedule_service_1=require(a9_0x13d4bc(0x1b3)),setting_service_1=require(a9_0x13d4bc(0x19a)),file_1=require(a9_0x13d4bc(0x1d9)),constants_1=require('../common/constants');function a9_0xefbe(_0x3b9758,_0x46906a){const _0x12f109=a9_0x12f1();return a9_0xefbe=function(_0xefbef8,_0x599659){_0xefbef8=_0xefbef8-0x18f;let _0x22810e=_0x12f109[_0xefbef8];return _0x22810e;},a9_0xefbe(_0x3b9758,_0x46906a);}let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x42fbec,_0x243869,_0x91b941){const _0x47e69d=a9_0x13d4bc;this['agendaService']=_0x42fbec,this[_0x47e69d(0x1db)]=_0x243869,this[_0x47e69d(0x1b8)]=_0x91b941,this[_0x47e69d(0x1a0)]=new common_1[(_0x47e69d(0x1bb))](JobProccessor_1[_0x47e69d(0x1d1)]);}async[a9_0x13d4bc(0x1c5)](_0x57d495){const _0x309fd6=a9_0x13d4bc;this[_0x309fd6(0x1a0)]['log'](_0x309fd6(0x1b0)+new Date()+_0x309fd6(0x1a2)+_0x57d495[_0x309fd6(0x1ba)][_0x309fd6(0x1d1)]);const _0x227b34=await this[_0x309fd6(0x1b8)][_0x309fd6(0x1d3)]();if(_0x227b34['isExpired']){this[_0x309fd6(0x1a0)][_0x309fd6(0x1cf)](_0x309fd6(0x1b9));if(process['env'][_0x309fd6(0x1b2)]!==_0x309fd6(0x1b5))return;}this['logger'][_0x309fd6(0x1cf)]('Canceling\x20all\x20old\x20background\x20checks...'),await this['agendaService']['cancel']({'name':{'$nin':[enums_1[_0x309fd6(0x1cd)][_0x309fd6(0x19f)],enums_1[_0x309fd6(0x1cd)]['PurgeTempUploadedFiles']]},'type':_0x309fd6(0x1a7)}),this[_0x309fd6(0x1a0)][_0x309fd6(0x1cf)]('Fetching\x20today\x20schedule...');const _0xb1e4b5=await this[_0x309fd6(0x1db)]['findEligibleSchedule'](new Date());this[_0x309fd6(0x1a0)]['log'](_0x309fd6(0x1d2)+(_0xb1e4b5===null||_0xb1e4b5===void 0x0?void 0x0:_0xb1e4b5[_0x309fd6(0x1d1)]));if(!_0xb1e4b5||!_0xb1e4b5[_0x309fd6(0x193)]||_0xb1e4b5[_0x309fd6(0x193)][_0x309fd6(0x1a5)]===0x0)return;_0xb1e4b5[_0x309fd6(0x193)][_0x309fd6(0x1cc)](_0x3a19c9=>{const _0x38f9b8=_0x309fd6;this[_0x38f9b8(0x1a0)][_0x38f9b8(0x1cf)]('Scheduling\x20event:\x20'+_0x3a19c9[_0x38f9b8(0x1c9)]+_0x38f9b8(0x1c7)+_0x3a19c9[_0x38f9b8(0x1d4)]+'\x20-\x20'+_0x3a19c9[_0x38f9b8(0x1d1)]);const _0xb066d8=new Date(),_0x49d477=_0xb066d8[_0x38f9b8(0x1d0)](),_0x1e5be6=_0xb066d8[_0x38f9b8(0x1ca)](),_0x293a19=_0xb066d8['getSeconds'](),[_0x1f860f,_0x279e8f,_0x34be07]=_0x3a19c9[_0x38f9b8(0x1c9)][_0x38f9b8(0x195)](':');if(+_0x1f860f<_0x49d477||+_0x1f860f===_0x49d477&&+_0x279e8f<_0x1e5be6||+_0x1f860f===_0x49d477&&+_0x279e8f===_0x1e5be6&&+_0x34be07<_0x293a19)return;_0xb066d8[_0x38f9b8(0x1a6)](+_0x1f860f),_0xb066d8[_0x38f9b8(0x1c0)](+_0x279e8f),_0xb066d8[_0x38f9b8(0x1bc)](+_0x34be07);switch(_0x3a19c9[_0x38f9b8(0x1d4)]){case enums_1[_0x38f9b8(0x1bd)][_0x38f9b8(0x198)]:{const {soundId:_0x3fbdfe,durationInSecond:_0xbf5033}=_0x3a19c9['data'];if(!_0x3fbdfe)return;const _0x217c41={'soundId':_0x3fbdfe,'durationInSecond':_0xbf5033,'audit':{'actor':enums_1[_0x38f9b8(0x1c2)][_0x38f9b8(0x1c6)],'name':enums_1['JobType']['PlaySound'],'message':_0x38f9b8(0x1b4)+_0x3a19c9['name']+'\x20-\x20Schedule:\x20'+_0xb1e4b5['name']}};this[_0x38f9b8(0x1d7)][_0x38f9b8(0x1ce)](_0xb066d8,enums_1['JobType'][_0x38f9b8(0x198)],_0x217c41);break;}case enums_1[_0x38f9b8(0x1bd)][_0x38f9b8(0x1af)]:{const {playlistId:_0x25f9ed,durationInSecond:_0x2b4047}=_0x3a19c9[_0x38f9b8(0x1a3)];if(!_0x25f9ed)return;const _0x1f2c8e={'playlistId':_0x25f9ed,'durationInSecond':_0x2b4047,'audit':{'actor':enums_1[_0x38f9b8(0x1c2)][_0x38f9b8(0x1c6)],'name':enums_1['JobType'][_0x38f9b8(0x1af)],'message':'Event:\x20'+_0x3a19c9[_0x38f9b8(0x1d1)]+'\x20-\x20Schedule:\x20'+_0xb1e4b5[_0x38f9b8(0x1d1)]}};this[_0x38f9b8(0x1d7)]['schedule'](_0xb066d8,enums_1['JobType']['PlayMusic'],_0x1f2c8e);break;}case enums_1[_0x38f9b8(0x1bd)][_0x38f9b8(0x1ac)]:{const {voiceId:_0x30411e,durationInSecond:_0x3f63a}=_0x3a19c9[_0x38f9b8(0x1a3)];if(!_0x30411e)return;const _0x5e7974={'voiceId':_0x30411e,'durationInSecond':_0x3f63a,'audit':{'actor':enums_1[_0x38f9b8(0x1c2)][_0x38f9b8(0x1c6)],'name':enums_1['JobType']['PlayVoiceRecorded'],'message':'Event:\x20'+_0x3a19c9['name']+_0x38f9b8(0x1a8)+_0xb1e4b5[_0x38f9b8(0x1d1)]}};this[_0x38f9b8(0x1d7)]['schedule'](_0xb066d8,enums_1['JobType'][_0x38f9b8(0x1ac)],_0x5e7974);break;}case enums_1['JobType'][_0x38f9b8(0x197)]:{const {textToAudioId:_0x58be58,durationInSecond:_0x71deb5}=_0x3a19c9['data'];if(!_0x58be58)return;const _0x5f0bbc={'textToAudioId':_0x58be58,'durationInSecond':_0x71deb5,'audit':{'actor':enums_1[_0x38f9b8(0x1c2)][_0x38f9b8(0x1c6)],'name':enums_1[_0x38f9b8(0x1bd)]['PlayTextToAudio'],'message':_0x38f9b8(0x1b4)+_0x3a19c9['name']+'\x20-\x20Schedule:\x20'+_0xb1e4b5[_0x38f9b8(0x1d1)]}};this['agendaService']['schedule'](_0xb066d8,enums_1[_0x38f9b8(0x1bd)][_0x38f9b8(0x197)],_0x5f0bbc);break;}default:return;}}),this[_0x309fd6(0x1a0)][_0x309fd6(0x1cf)]('Events\x20scheduled!');}async[a9_0x13d4bc(0x1a9)](_0x5c68f1){const _0x274577=a9_0x13d4bc;this['logger'][_0x274577(0x1cf)](_0x274577(0x1d5));const {success:_0x598977,message:_0x13c36f}=await(0x0,file_1['deleteFilesInFolder'])(constants_1['TMP_UPLOAD_DIR']);!_0x598977&&this[_0x274577(0x1a0)]['error'](_0x274577(0x1c3)+_0x13c36f);}};function a9_0x12f1(){const _0x5e76c0=['updateExpiryStatus','jobType','Purging\x20temp\x20uploaded\x20files...','13876PCQwXg','agendaService','Define','../common/file','function','scheduleService','getOwnPropertyDescriptor','2112166OoAvdZ','982896SfQswY','PurgeTempUploadedFiles','__esModule','events','2199006Nimjgd','split','535VUVfUd','PlayTextToAudio','PlaySound','design:paramtypes','../setting/setting.service','design:returntype','@nestjs/common','design:type','prototype','CheckEvent','logger','AgendaService','.\x20Job:\x20','data','ScheduleService','length','setHours','single','\x20-\x20Schedule:\x20','purgeTempUploadedFiles','SettingService','agenda','PlayVoiceRecorded','JobProccessor','Processor','PlayMusic','Server\x20time:\x20','857098pqzmTd','NODE_ENV','../schedule/schedule.service','Event:\x20','development','object','decorate','settingService','Invalid\x20or\x20expired\x20license\x20key!','attrs','Logger','setSeconds','JobType','3keEsRP','../common/enums','setMinutes','@agent-ly/nestjs-agenda','AuditActor','Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20','5631516XsBwUp','checkEvent','Job','\x20-\x20','defineProperty','time','getMinutes','4932823OpTlEp','forEach','BackgroundJobType','schedule','log','getHours','name','Eligible\x20schedule:\x20'];a9_0x12f1=function(){return _0x5e76c0;};return a9_0x12f1();}__decorate([(0x0,nestjs_agenda_1[a9_0x13d4bc(0x1d8)])(enums_1[a9_0x13d4bc(0x1cd)]['CheckEvent']),__metadata(a9_0x13d4bc(0x19d),Function),__metadata(a9_0x13d4bc(0x199),[agenda_1['Job']]),__metadata(a9_0x13d4bc(0x19b),Promise)],JobProccessor[a9_0x13d4bc(0x19e)],a9_0x13d4bc(0x1c5),null),__decorate([(0x0,nestjs_agenda_1[a9_0x13d4bc(0x1d8)])(enums_1[a9_0x13d4bc(0x1cd)][a9_0x13d4bc(0x191)]),__metadata(a9_0x13d4bc(0x19d),Function),__metadata(a9_0x13d4bc(0x199),[agenda_1['Job']]),__metadata(a9_0x13d4bc(0x19b),Promise)],JobProccessor['prototype'],a9_0x13d4bc(0x1a9),null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x13d4bc(0x1ae)])(),__metadata(a9_0x13d4bc(0x199),[nestjs_agenda_1[a9_0x13d4bc(0x1a1)],schedule_service_1[a9_0x13d4bc(0x1a4)],setting_service_1[a9_0x13d4bc(0x1aa)]])],JobProccessor),exports[a9_0x13d4bc(0x1ad)]=JobProccessor;