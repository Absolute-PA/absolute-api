'use strict';const a9_0xa38a20=a9_0x5257;(function(_0x1a026f,_0x2ca6ef){const _0x48a341=a9_0x5257,_0x2a99bb=_0x1a026f();while(!![]){try{const _0x36bf58=-parseInt(_0x48a341(0x14d))/0x1*(parseInt(_0x48a341(0x187))/0x2)+-parseInt(_0x48a341(0x169))/0x3*(-parseInt(_0x48a341(0x15a))/0x4)+-parseInt(_0x48a341(0x165))/0x5+-parseInt(_0x48a341(0x176))/0x6+-parseInt(_0x48a341(0x16c))/0x7*(-parseInt(_0x48a341(0x14a))/0x8)+parseInt(_0x48a341(0x162))/0x9+-parseInt(_0x48a341(0x18b))/0xa;if(_0x36bf58===_0x2ca6ef)break;else _0x2a99bb['push'](_0x2a99bb['shift']());}catch(_0x2109cc){_0x2a99bb['push'](_0x2a99bb['shift']());}}}(a9_0x1740,0x61145));function a9_0x1740(){const _0x570e71=['decorate','design:returntype','Server\x20time:\x20','setMinutes','@nestjs/common','4762521XqXhVv','agendaService','prototype','2249625LExqNE','attrs','object','setSeconds','1376007MRjgYP','deleteFilesInFolder','Job','2234162aruaZj','JobProccessor','metadata','__decorate','__esModule','setHours','schedule','Define','settingService','design:paramtypes','556338QANiBv','findEligibleSchedule','function','.\x20Job:\x20','env','scheduleService','Invalid\x20or\x20expired\x20license\x20key!','\x20-\x20Schedule:\x20','SettingService','../schedule/schedule.service','PlayVoiceRecorded','split','name','single','defineProperty','Purging\x20temp\x20uploaded\x20files...','events','146qUIZli','jobType','logger','isExpired','3905270JYdZOe','PlayMusic','JobType','BackgroundJobType','error','PlayTextToAudio','development','CheckEvent','log','AuditActor','cancel','length','purgeTempUploadedFiles','Logger','getHours','AgendaService','16WRZLIB','getOwnPropertyDescriptor','PurgeTempUploadedFiles','4046pfetmc','getMinutes','Event:\x20','../common/file','design:type','PlaySound','Canceling\x20all\x20old\x20background\x20checks...','Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20','Processor','data','checkEvent','NODE_ENV','@agent-ly/nestjs-agenda','4kdhZud','time','Events\x20scheduled!'];a9_0x1740=function(){return _0x570e71;};return a9_0x1740();}var __decorate=this&&this[a9_0xa38a20(0x16f)]||function(_0x21ceea,_0x31fb5a,_0x418d15,_0x522a98){const _0x46e443=a9_0xa38a20;var _0x126918=arguments['length'],_0x5879f9=_0x126918<0x3?_0x31fb5a:_0x522a98===null?_0x522a98=Object[_0x46e443(0x14b)](_0x31fb5a,_0x418d15):_0x522a98,_0x4b5c13;if(typeof Reflect===_0x46e443(0x167)&&typeof Reflect[_0x46e443(0x15d)]===_0x46e443(0x178))_0x5879f9=Reflect[_0x46e443(0x15d)](_0x21ceea,_0x31fb5a,_0x418d15,_0x522a98);else{for(var _0x161dff=_0x21ceea['length']-0x1;_0x161dff>=0x0;_0x161dff--)if(_0x4b5c13=_0x21ceea[_0x161dff])_0x5879f9=(_0x126918<0x3?_0x4b5c13(_0x5879f9):_0x126918>0x3?_0x4b5c13(_0x31fb5a,_0x418d15,_0x5879f9):_0x4b5c13(_0x31fb5a,_0x418d15))||_0x5879f9;}return _0x126918>0x3&&_0x5879f9&&Object[_0x46e443(0x184)](_0x31fb5a,_0x418d15,_0x5879f9),_0x5879f9;},__metadata=this&&this['__metadata']||function(_0x3b48c8,_0x1122e2){const _0x263ca6=a9_0xa38a20;if(typeof Reflect===_0x263ca6(0x167)&&typeof Reflect[_0x263ca6(0x16e)]===_0x263ca6(0x178))return Reflect[_0x263ca6(0x16e)](_0x3b48c8,_0x1122e2);},JobProccessor_1;function a9_0x5257(_0x220ebc,_0x427c18){const _0x174063=a9_0x1740();return a9_0x5257=function(_0x5257bf,_0x13fed5){_0x5257bf=_0x5257bf-0x149;let _0x2f53da=_0x174063[_0x5257bf];return _0x2f53da;},a9_0x5257(_0x220ebc,_0x427c18);}Object[a9_0xa38a20(0x184)](exports,a9_0xa38a20(0x170),{'value':!![]}),exports[a9_0xa38a20(0x16d)]=void 0x0;const common_1=require(a9_0xa38a20(0x161)),agenda_1=require('agenda'),nestjs_agenda_1=require(a9_0xa38a20(0x159)),enums_1=require('../common/enums'),schedule_service_1=require(a9_0xa38a20(0x17f)),setting_service_1=require('../setting/setting.service'),file_1=require(a9_0xa38a20(0x150)),constants_1=require('../common/constants');let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x330594,_0x510edd,_0x3cc781){const _0x246c06=a9_0xa38a20;this[_0x246c06(0x163)]=_0x330594,this['scheduleService']=_0x510edd,this[_0x246c06(0x174)]=_0x3cc781,this[_0x246c06(0x189)]=new common_1[(_0x246c06(0x198))](JobProccessor_1[_0x246c06(0x182)]);}async[a9_0xa38a20(0x157)](_0x360440){const _0x3ffa7c=a9_0xa38a20;this[_0x3ffa7c(0x189)][_0x3ffa7c(0x193)](_0x3ffa7c(0x15f)+new Date()+_0x3ffa7c(0x179)+_0x360440[_0x3ffa7c(0x166)]['name']);const _0x1319a3=await this[_0x3ffa7c(0x174)]['updateExpiryStatus']();if(_0x1319a3[_0x3ffa7c(0x18a)]){this['logger'][_0x3ffa7c(0x193)](_0x3ffa7c(0x17c));if(process[_0x3ffa7c(0x17a)][_0x3ffa7c(0x158)]!==_0x3ffa7c(0x191))return;}this[_0x3ffa7c(0x189)][_0x3ffa7c(0x193)](_0x3ffa7c(0x153)),await this[_0x3ffa7c(0x163)][_0x3ffa7c(0x195)]({'name':{'$nin':[enums_1[_0x3ffa7c(0x18e)]['CheckEvent'],enums_1[_0x3ffa7c(0x18e)][_0x3ffa7c(0x14c)]]},'type':_0x3ffa7c(0x183)}),this[_0x3ffa7c(0x189)][_0x3ffa7c(0x193)]('Fetching\x20today\x20schedule...');const _0x4cecca=await this[_0x3ffa7c(0x17b)][_0x3ffa7c(0x177)](new Date());this['logger'][_0x3ffa7c(0x193)]('Eligible\x20schedule:\x20'+(_0x4cecca===null||_0x4cecca===void 0x0?void 0x0:_0x4cecca['name']));if(!_0x4cecca||!_0x4cecca[_0x3ffa7c(0x186)]||_0x4cecca['events'][_0x3ffa7c(0x196)]===0x0)return;_0x4cecca[_0x3ffa7c(0x186)]['forEach'](_0x595649=>{const _0x5450d6=_0x3ffa7c;this[_0x5450d6(0x189)][_0x5450d6(0x193)]('Scheduling\x20event:\x20'+_0x595649[_0x5450d6(0x15b)]+'\x20-\x20'+_0x595649[_0x5450d6(0x188)]+'\x20-\x20'+_0x595649['name']);const _0x2182b7=new Date(),_0x104bc4=_0x2182b7[_0x5450d6(0x199)](),_0x170d64=_0x2182b7[_0x5450d6(0x14e)](),_0xf31305=_0x2182b7['getSeconds'](),[_0x3447,_0x1631b3,_0x1d57c8]=_0x595649[_0x5450d6(0x15b)][_0x5450d6(0x181)](':');if(+_0x3447<_0x104bc4||+_0x3447===_0x104bc4&&+_0x1631b3<_0x170d64||+_0x3447===_0x104bc4&&+_0x1631b3===_0x170d64&&+_0x1d57c8<_0xf31305)return;_0x2182b7[_0x5450d6(0x171)](+_0x3447),_0x2182b7[_0x5450d6(0x160)](+_0x1631b3),_0x2182b7[_0x5450d6(0x168)](+_0x1d57c8);switch(_0x595649['jobType']){case enums_1[_0x5450d6(0x18d)][_0x5450d6(0x152)]:{const {soundId:_0x2dcd5c,durationInSecond:_0x157abf}=_0x595649[_0x5450d6(0x156)];if(!_0x2dcd5c)return;const _0x42755f={'soundId':_0x2dcd5c,'durationInSecond':_0x157abf,'audit':{'actor':enums_1[_0x5450d6(0x194)]['Job'],'name':enums_1[_0x5450d6(0x18d)][_0x5450d6(0x152)],'message':_0x5450d6(0x14f)+_0x595649[_0x5450d6(0x182)]+'\x20-\x20Schedule:\x20'+_0x4cecca[_0x5450d6(0x182)]}};this[_0x5450d6(0x163)][_0x5450d6(0x172)](_0x2182b7,enums_1[_0x5450d6(0x18d)]['PlaySound'],_0x42755f);break;}case enums_1['JobType'][_0x5450d6(0x18c)]:{const {playlistId:_0x4f5572,durationInSecond:_0x222b27}=_0x595649['data'];if(!_0x4f5572)return;const _0x13f3ce={'playlistId':_0x4f5572,'durationInSecond':_0x222b27,'audit':{'actor':enums_1[_0x5450d6(0x194)][_0x5450d6(0x16b)],'name':enums_1[_0x5450d6(0x18d)][_0x5450d6(0x18c)],'message':_0x5450d6(0x14f)+_0x595649[_0x5450d6(0x182)]+_0x5450d6(0x17d)+_0x4cecca[_0x5450d6(0x182)]}};this[_0x5450d6(0x163)][_0x5450d6(0x172)](_0x2182b7,enums_1['JobType'][_0x5450d6(0x18c)],_0x13f3ce);break;}case enums_1[_0x5450d6(0x18d)][_0x5450d6(0x180)]:{const {voiceId:_0x8d6369,durationInSecond:_0x5a6d6e}=_0x595649[_0x5450d6(0x156)];if(!_0x8d6369)return;const _0x3b7301={'voiceId':_0x8d6369,'durationInSecond':_0x5a6d6e,'audit':{'actor':enums_1[_0x5450d6(0x194)][_0x5450d6(0x16b)],'name':enums_1['JobType']['PlayVoiceRecorded'],'message':_0x5450d6(0x14f)+_0x595649[_0x5450d6(0x182)]+_0x5450d6(0x17d)+_0x4cecca[_0x5450d6(0x182)]}};this[_0x5450d6(0x163)][_0x5450d6(0x172)](_0x2182b7,enums_1['JobType']['PlayVoiceRecorded'],_0x3b7301);break;}case enums_1['JobType']['PlayTextToAudio']:{const {textToAudioId:_0x226161,durationInSecond:_0x348754}=_0x595649[_0x5450d6(0x156)];if(!_0x226161)return;const _0x28eb02={'textToAudioId':_0x226161,'durationInSecond':_0x348754,'audit':{'actor':enums_1[_0x5450d6(0x194)][_0x5450d6(0x16b)],'name':enums_1['JobType']['PlayTextToAudio'],'message':'Event:\x20'+_0x595649[_0x5450d6(0x182)]+_0x5450d6(0x17d)+_0x4cecca[_0x5450d6(0x182)]}};this['agendaService']['schedule'](_0x2182b7,enums_1[_0x5450d6(0x18d)][_0x5450d6(0x190)],_0x28eb02);break;}default:return;}}),this[_0x3ffa7c(0x189)][_0x3ffa7c(0x193)](_0x3ffa7c(0x15c));}async[a9_0xa38a20(0x197)](_0x381681){const _0x3110fc=a9_0xa38a20;this[_0x3110fc(0x189)][_0x3110fc(0x193)](_0x3110fc(0x185));const {success:_0x1fa651,message:_0xcd6b67}=await(0x0,file_1[_0x3110fc(0x16a)])(constants_1['TMP_UPLOAD_DIR']);!_0x1fa651&&this[_0x3110fc(0x189)][_0x3110fc(0x18f)](_0x3110fc(0x154)+_0xcd6b67);}};__decorate([(0x0,nestjs_agenda_1[a9_0xa38a20(0x173)])(enums_1[a9_0xa38a20(0x18e)][a9_0xa38a20(0x192)]),__metadata('design:type',Function),__metadata('design:paramtypes',[agenda_1[a9_0xa38a20(0x16b)]]),__metadata('design:returntype',Promise)],JobProccessor['prototype'],'checkEvent',null),__decorate([(0x0,nestjs_agenda_1[a9_0xa38a20(0x173)])(enums_1[a9_0xa38a20(0x18e)][a9_0xa38a20(0x14c)]),__metadata(a9_0xa38a20(0x151),Function),__metadata(a9_0xa38a20(0x175),[agenda_1['Job']]),__metadata(a9_0xa38a20(0x15e),Promise)],JobProccessor[a9_0xa38a20(0x164)],a9_0xa38a20(0x197),null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0xa38a20(0x155)])(),__metadata('design:paramtypes',[nestjs_agenda_1[a9_0xa38a20(0x149)],schedule_service_1['ScheduleService'],setting_service_1[a9_0xa38a20(0x17e)]])],JobProccessor),exports['JobProccessor']=JobProccessor;