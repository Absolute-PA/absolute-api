'use strict';const a9_0x39df21=a9_0x42af;(function(_0x168d53,_0x3e714c){const _0x5f4071=a9_0x42af,_0x358bae=_0x168d53();while(!![]){try{const _0x4c498a=parseInt(_0x5f4071(0x1c0))/0x1*(-parseInt(_0x5f4071(0x205))/0x2)+-parseInt(_0x5f4071(0x1eb))/0x3+-parseInt(_0x5f4071(0x208))/0x4*(-parseInt(_0x5f4071(0x1e4))/0x5)+-parseInt(_0x5f4071(0x1d3))/0x6*(parseInt(_0x5f4071(0x1d1))/0x7)+-parseInt(_0x5f4071(0x1ee))/0x8*(parseInt(_0x5f4071(0x1d8))/0x9)+-parseInt(_0x5f4071(0x1fd))/0xa*(-parseInt(_0x5f4071(0x1e8))/0xb)+parseInt(_0x5f4071(0x200))/0xc;if(_0x4c498a===_0x3e714c)break;else _0x358bae['push'](_0x358bae['shift']());}catch(_0x5bbc2b){_0x358bae['push'](_0x358bae['shift']());}}}(a9_0x2d83,0x7b02f));function a9_0x2d83(){const _0xe006ab=['Event:\x20','agendaService','function','log','Fetching\x20today\x20schedule...','../common/enums','isExpired','Events\x20scheduled!','logger','PlayVoiceRecorded','Invalid\x20or\x20expired\x20license\x20key!','287MTmPMA','deleteFilesInFolder','95826cWFwQa','setMinutes','schedule','@nestjs/common','Canceling\x20all\x20old\x20background\x20checks...','126qOPyoJ','JobProccessor','\x20-\x20','design:type','Logger','design:paramtypes','../schedule/schedule.service','setHours','Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20','data','../setting/setting.service','AuditActor','115pqTagX','PurgeTempUploadedFiles','purgeTempUploadedFiles','attrs','55dyNdAM','name','BackgroundJobType','459009CMxESQ','SettingService','PlaySound','148552WJdljh','Server\x20time:\x20','setSeconds','AgendaService','defineProperty','Job','findEligibleSchedule','PlayMusic','env','checkEvent','getMinutes','Eligible\x20schedule:\x20','metadata','events','NODE_ENV','244810pybVKF','PlayTextToAudio','design:returntype','12773616mOsGkP','prototype','TMP_UPLOAD_DIR','.\x20Job:\x20','Scheduling\x20event:\x20','10aWbfsk','CheckEvent','getHours','152756RZvPhe','\x20-\x20Schedule:\x20','length','__metadata','forEach','cancel','updateExpiryStatus','split','Define','object','jobType','agenda','98717AsCsqh','time','scheduleService','ScheduleService','JobType','error'];a9_0x2d83=function(){return _0xe006ab;};return a9_0x2d83();}function a9_0x42af(_0x12501a,_0x438cf1){const _0x2d83a0=a9_0x2d83();return a9_0x42af=function(_0x42afc4,_0x2a1138){_0x42afc4=_0x42afc4-0x1b5;let _0x11870d=_0x2d83a0[_0x42afc4];return _0x11870d;},a9_0x42af(_0x12501a,_0x438cf1);}var __decorate=this&&this['__decorate']||function(_0x5292c8,_0x17be42,_0x4ca062,_0xae51b4){const _0x368e30=a9_0x42af;var _0x424b47=arguments['length'],_0x4a3ef4=_0x424b47<0x3?_0x17be42:_0xae51b4===null?_0xae51b4=Object['getOwnPropertyDescriptor'](_0x17be42,_0x4ca062):_0xae51b4,_0x33be84;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x368e30(0x1c8))_0x4a3ef4=Reflect['decorate'](_0x5292c8,_0x17be42,_0x4ca062,_0xae51b4);else{for(var _0x544d8b=_0x5292c8[_0x368e30(0x1b6)]-0x1;_0x544d8b>=0x0;_0x544d8b--)if(_0x33be84=_0x5292c8[_0x544d8b])_0x4a3ef4=(_0x424b47<0x3?_0x33be84(_0x4a3ef4):_0x424b47>0x3?_0x33be84(_0x17be42,_0x4ca062,_0x4a3ef4):_0x33be84(_0x17be42,_0x4ca062))||_0x4a3ef4;}return _0x424b47>0x3&&_0x4a3ef4&&Object[_0x368e30(0x1f2)](_0x17be42,_0x4ca062,_0x4a3ef4),_0x4a3ef4;},__metadata=this&&this[a9_0x39df21(0x1b7)]||function(_0x25afa1,_0x9fa01f){const _0x4289a8=a9_0x39df21;if(typeof Reflect===_0x4289a8(0x1bd)&&typeof Reflect[_0x4289a8(0x1fa)]===_0x4289a8(0x1c8))return Reflect[_0x4289a8(0x1fa)](_0x25afa1,_0x9fa01f);},JobProccessor_1;Object[a9_0x39df21(0x1f2)](exports,'__esModule',{'value':!![]}),exports['JobProccessor']=void 0x0;const common_1=require(a9_0x39df21(0x1d6)),agenda_1=require(a9_0x39df21(0x1bf)),nestjs_agenda_1=require('@agent-ly/nestjs-agenda'),enums_1=require(a9_0x39df21(0x1cb)),schedule_service_1=require(a9_0x39df21(0x1de)),setting_service_1=require(a9_0x39df21(0x1e2)),file_1=require('../common/file'),constants_1=require('../common/constants');let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x19d33f,_0x2bb620,_0xcfce2d){const _0xabb9c7=a9_0x39df21;this[_0xabb9c7(0x1c7)]=_0x19d33f,this[_0xabb9c7(0x1c2)]=_0x2bb620,this['settingService']=_0xcfce2d,this[_0xabb9c7(0x1ce)]=new common_1[(_0xabb9c7(0x1dc))](JobProccessor_1[_0xabb9c7(0x1e9)]);}async[a9_0x39df21(0x1f7)](_0x1d5844){const _0x53d013=a9_0x39df21;this[_0x53d013(0x1ce)][_0x53d013(0x1c9)](_0x53d013(0x1ef)+new Date()+_0x53d013(0x203)+_0x1d5844[_0x53d013(0x1e7)][_0x53d013(0x1e9)]);const _0x58e477=await this['settingService'][_0x53d013(0x1ba)]();if(_0x58e477[_0x53d013(0x1cc)]){this[_0x53d013(0x1ce)][_0x53d013(0x1c9)](_0x53d013(0x1d0));if(process[_0x53d013(0x1f6)][_0x53d013(0x1fc)]!=='development')return;}this[_0x53d013(0x1ce)]['log'](_0x53d013(0x1d7)),await this[_0x53d013(0x1c7)][_0x53d013(0x1b9)]({'name':{'$nin':[enums_1[_0x53d013(0x1ea)][_0x53d013(0x206)],enums_1[_0x53d013(0x1ea)][_0x53d013(0x1e5)]]},'type':'single'}),this[_0x53d013(0x1ce)][_0x53d013(0x1c9)](_0x53d013(0x1ca));const _0x49cfcc=await this[_0x53d013(0x1c2)][_0x53d013(0x1f4)](new Date());this[_0x53d013(0x1ce)][_0x53d013(0x1c9)](_0x53d013(0x1f9)+(_0x49cfcc===null||_0x49cfcc===void 0x0?void 0x0:_0x49cfcc[_0x53d013(0x1e9)]));if(!_0x49cfcc||!_0x49cfcc['events']||_0x49cfcc['events'][_0x53d013(0x1b6)]===0x0)return;_0x49cfcc[_0x53d013(0x1fb)][_0x53d013(0x1b8)](_0x4b7799=>{const _0x3cda34=_0x53d013;this[_0x3cda34(0x1ce)][_0x3cda34(0x1c9)](_0x3cda34(0x204)+_0x4b7799[_0x3cda34(0x1c1)]+_0x3cda34(0x1da)+_0x4b7799['jobType']+_0x3cda34(0x1da)+_0x4b7799[_0x3cda34(0x1e9)]);const _0x4d9f51=new Date(),_0x380306=_0x4d9f51[_0x3cda34(0x207)](),_0x25f903=_0x4d9f51[_0x3cda34(0x1f8)](),_0x3d3eac=_0x4d9f51['getSeconds'](),[_0xbb6f2,_0x342cca,_0x31911b]=_0x4b7799[_0x3cda34(0x1c1)][_0x3cda34(0x1bb)](':');if(+_0xbb6f2<_0x380306||+_0xbb6f2===_0x380306&&+_0x342cca<_0x25f903||+_0xbb6f2===_0x380306&&+_0x342cca===_0x25f903&&+_0x31911b<_0x3d3eac)return;_0x4d9f51[_0x3cda34(0x1df)](+_0xbb6f2),_0x4d9f51[_0x3cda34(0x1d4)](+_0x342cca),_0x4d9f51[_0x3cda34(0x1f0)](+_0x31911b);switch(_0x4b7799[_0x3cda34(0x1be)]){case enums_1[_0x3cda34(0x1c4)][_0x3cda34(0x1ed)]:{const {soundId:_0x1ed73b,durationInSecond:_0x34a463}=_0x4b7799[_0x3cda34(0x1e1)];if(!_0x1ed73b)return;const _0x2ddd6b={'soundId':_0x1ed73b,'durationInSecond':_0x34a463,'audit':{'actor':enums_1[_0x3cda34(0x1e3)]['Job'],'name':enums_1[_0x3cda34(0x1c4)][_0x3cda34(0x1ed)],'message':_0x3cda34(0x1c6)+_0x4b7799[_0x3cda34(0x1e9)]+_0x3cda34(0x1b5)+_0x49cfcc[_0x3cda34(0x1e9)]}};this['agendaService'][_0x3cda34(0x1d5)](_0x4d9f51,enums_1[_0x3cda34(0x1c4)]['PlaySound'],_0x2ddd6b);break;}case enums_1[_0x3cda34(0x1c4)][_0x3cda34(0x1f5)]:{const {playlistId:_0x1f99fa,durationInSecond:_0x33b2ae}=_0x4b7799[_0x3cda34(0x1e1)];if(!_0x1f99fa)return;const _0x2af12d={'playlistId':_0x1f99fa,'durationInSecond':_0x33b2ae,'audit':{'actor':enums_1[_0x3cda34(0x1e3)][_0x3cda34(0x1f3)],'name':enums_1[_0x3cda34(0x1c4)][_0x3cda34(0x1f5)],'message':'Event:\x20'+_0x4b7799[_0x3cda34(0x1e9)]+_0x3cda34(0x1b5)+_0x49cfcc['name']}};this[_0x3cda34(0x1c7)]['schedule'](_0x4d9f51,enums_1[_0x3cda34(0x1c4)][_0x3cda34(0x1f5)],_0x2af12d);break;}case enums_1[_0x3cda34(0x1c4)][_0x3cda34(0x1cf)]:{const {voiceId:_0x416eb7,durationInSecond:_0x553496}=_0x4b7799[_0x3cda34(0x1e1)];if(!_0x416eb7)return;const _0x4cc1f7={'voiceId':_0x416eb7,'durationInSecond':_0x553496,'audit':{'actor':enums_1[_0x3cda34(0x1e3)]['Job'],'name':enums_1[_0x3cda34(0x1c4)][_0x3cda34(0x1cf)],'message':_0x3cda34(0x1c6)+_0x4b7799[_0x3cda34(0x1e9)]+_0x3cda34(0x1b5)+_0x49cfcc[_0x3cda34(0x1e9)]}};this[_0x3cda34(0x1c7)][_0x3cda34(0x1d5)](_0x4d9f51,enums_1[_0x3cda34(0x1c4)][_0x3cda34(0x1cf)],_0x4cc1f7);break;}case enums_1[_0x3cda34(0x1c4)]['PlayTextToAudio']:{const {textToAudioId:_0x5b28dc,durationInSecond:_0x20eff6}=_0x4b7799[_0x3cda34(0x1e1)];if(!_0x5b28dc)return;const _0x18a4e0={'textToAudioId':_0x5b28dc,'durationInSecond':_0x20eff6,'audit':{'actor':enums_1['AuditActor'][_0x3cda34(0x1f3)],'name':enums_1[_0x3cda34(0x1c4)]['PlayTextToAudio'],'message':_0x3cda34(0x1c6)+_0x4b7799[_0x3cda34(0x1e9)]+_0x3cda34(0x1b5)+_0x49cfcc[_0x3cda34(0x1e9)]}};this['agendaService'][_0x3cda34(0x1d5)](_0x4d9f51,enums_1[_0x3cda34(0x1c4)][_0x3cda34(0x1fe)],_0x18a4e0);break;}default:return;}}),this['logger'][_0x53d013(0x1c9)](_0x53d013(0x1cd));}async[a9_0x39df21(0x1e6)](_0x2458e5){const _0x17e6ea=a9_0x39df21;this['logger'][_0x17e6ea(0x1c9)]('Purging\x20temp\x20uploaded\x20files...');const {success:_0x5902c1,message:_0x3a9808}=await(0x0,file_1[_0x17e6ea(0x1d2)])(constants_1[_0x17e6ea(0x202)]);!_0x5902c1&&this[_0x17e6ea(0x1ce)][_0x17e6ea(0x1c5)](_0x17e6ea(0x1e0)+_0x3a9808);}};__decorate([(0x0,nestjs_agenda_1[a9_0x39df21(0x1bc)])(enums_1[a9_0x39df21(0x1ea)][a9_0x39df21(0x206)]),__metadata('design:type',Function),__metadata('design:paramtypes',[agenda_1[a9_0x39df21(0x1f3)]]),__metadata(a9_0x39df21(0x1ff),Promise)],JobProccessor[a9_0x39df21(0x201)],a9_0x39df21(0x1f7),null),__decorate([(0x0,nestjs_agenda_1['Define'])(enums_1[a9_0x39df21(0x1ea)]['PurgeTempUploadedFiles']),__metadata(a9_0x39df21(0x1db),Function),__metadata(a9_0x39df21(0x1dd),[agenda_1[a9_0x39df21(0x1f3)]]),__metadata(a9_0x39df21(0x1ff),Promise)],JobProccessor[a9_0x39df21(0x201)],a9_0x39df21(0x1e6),null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1['Processor'])(),__metadata(a9_0x39df21(0x1dd),[nestjs_agenda_1[a9_0x39df21(0x1f1)],schedule_service_1[a9_0x39df21(0x1c3)],setting_service_1[a9_0x39df21(0x1ec)]])],JobProccessor),exports[a9_0x39df21(0x1d9)]=JobProccessor;