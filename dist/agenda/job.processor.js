'use strict';const a9_0x11932b=a9_0x486c;(function(_0x1fa345,_0x2aca70){const _0x3034d3=a9_0x486c,_0x2222ad=_0x1fa345();while(!![]){try{const _0x51cb00=-parseInt(_0x3034d3(0x1d0))/0x1+-parseInt(_0x3034d3(0x1bd))/0x2+-parseInt(_0x3034d3(0x1b2))/0x3+-parseInt(_0x3034d3(0x1b4))/0x4*(parseInt(_0x3034d3(0x1a7))/0x5)+parseInt(_0x3034d3(0x1ba))/0x6+parseInt(_0x3034d3(0x1a5))/0x7+parseInt(_0x3034d3(0x19f))/0x8*(parseInt(_0x3034d3(0x1b1))/0x9);if(_0x51cb00===_0x2aca70)break;else _0x2222ad['push'](_0x2222ad['shift']());}catch(_0x5a8cb0){_0x2222ad['push'](_0x2222ad['shift']());}}}(a9_0x2e01,0x1f00e));function a9_0x486c(_0x219e52,_0x1cc6c1){const _0x2e01b2=a9_0x2e01();return a9_0x486c=function(_0x486cb1,_0x3e123a){_0x486cb1=_0x486cb1-0x192;let _0x37b407=_0x2e01b2[_0x486cb1];return _0x37b407;},a9_0x486c(_0x219e52,_0x1cc6c1);}var __decorate=this&&this[a9_0x11932b(0x1bc)]||function(_0x13a7a6,_0x19449c,_0x2f8a0f,_0x9f83cc){const _0x1ac74a=a9_0x11932b;var _0xcc084f=arguments[_0x1ac74a(0x1d8)],_0x457c44=_0xcc084f<0x3?_0x19449c:_0x9f83cc===null?_0x9f83cc=Object[_0x1ac74a(0x198)](_0x19449c,_0x2f8a0f):_0x9f83cc,_0x40753c;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x1ac74a(0x1cb))_0x457c44=Reflect[_0x1ac74a(0x1c5)](_0x13a7a6,_0x19449c,_0x2f8a0f,_0x9f83cc);else{for(var _0x2864f9=_0x13a7a6[_0x1ac74a(0x1d8)]-0x1;_0x2864f9>=0x0;_0x2864f9--)if(_0x40753c=_0x13a7a6[_0x2864f9])_0x457c44=(_0xcc084f<0x3?_0x40753c(_0x457c44):_0xcc084f>0x3?_0x40753c(_0x19449c,_0x2f8a0f,_0x457c44):_0x40753c(_0x19449c,_0x2f8a0f))||_0x457c44;}return _0xcc084f>0x3&&_0x457c44&&Object[_0x1ac74a(0x1d3)](_0x19449c,_0x2f8a0f,_0x457c44),_0x457c44;},__metadata=this&&this[a9_0x11932b(0x1e0)]||function(_0x54134d,_0x203514){const _0x2f52e4=a9_0x11932b;if(typeof Reflect===_0x2f52e4(0x1c8)&&typeof Reflect['metadata']===_0x2f52e4(0x1cb))return Reflect[_0x2f52e4(0x195)](_0x54134d,_0x203514);},JobProccessor_1;Object[a9_0x11932b(0x1d3)](exports,a9_0x11932b(0x1be),{'value':!![]}),exports['JobProccessor']=void 0x0;function a9_0x2e01(){const _0x3fd45a=['__esModule','Events\x20scheduled!','logger','Scheduling\x20event:\x20','Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20','error','AuditActor','decorate','Define','deleteFilesInFolder','object','NODE_ENV','\x20-\x20Schedule:\x20','function','JobProccessor','isExpired','../schedule/schedule.service','purgeTempUploadedFiles','165182EhSyZH','setMinutes','events','defineProperty','Invalid\x20or\x20expired\x20license\x20key!','cancel','prototype','PlayMusic','length','SettingService','../common/constants','AgendaService','Logger','JobType','design:paramtypes','.\x20Job:\x20','__metadata','design:type','design:returntype','schedule','updateExpiryStatus','metadata','Event:\x20','single','getOwnPropertyDescriptor','findEligibleSchedule','PlaySound','data','\x20-\x20','Canceling\x20all\x20old\x20background\x20checks...','scheduleService','216RFmVtG','../common/enums','name','time','PlayTextToAudio','CheckEvent','722792YHqXRx','@nestjs/common','45Qormqz','Server\x20time:\x20','BackgroundJobType','PurgeTempUploadedFiles','setSeconds','split','log','agendaService','Processor','agenda','144108yrjbKb','201828uyrdTk','env','88276NxOyUS','getHours','Job','TMP_UPLOAD_DIR','ScheduleService','PlayVoiceRecorded','490158obLHrA','attrs','__decorate','118408jPvAJw'];a9_0x2e01=function(){return _0x3fd45a;};return a9_0x2e01();}const common_1=require(a9_0x11932b(0x1a6)),agenda_1=require(a9_0x11932b(0x1b0)),nestjs_agenda_1=require('@agent-ly/nestjs-agenda'),enums_1=require(a9_0x11932b(0x1a0)),schedule_service_1=require(a9_0x11932b(0x1ce)),setting_service_1=require('../setting/setting.service'),file_1=require('../common/file'),constants_1=require(a9_0x11932b(0x1da));let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x1c88b8,_0x269c13,_0x201e83){const _0x5db3fc=a9_0x11932b;this[_0x5db3fc(0x1ae)]=_0x1c88b8,this[_0x5db3fc(0x19e)]=_0x269c13,this['settingService']=_0x201e83,this[_0x5db3fc(0x1c0)]=new common_1[(_0x5db3fc(0x1dc))](JobProccessor_1[_0x5db3fc(0x1a1)]);}async['checkEvent'](_0x4d48e8){const _0x2a24cd=a9_0x11932b;this['logger'][_0x2a24cd(0x1ad)](_0x2a24cd(0x1a8)+new Date()+_0x2a24cd(0x1df)+_0x4d48e8[_0x2a24cd(0x1bb)][_0x2a24cd(0x1a1)]);const _0x126e0c=await this['settingService'][_0x2a24cd(0x194)]();if(_0x126e0c[_0x2a24cd(0x1cd)]){this[_0x2a24cd(0x1c0)][_0x2a24cd(0x1ad)](_0x2a24cd(0x1d4));if(process[_0x2a24cd(0x1b3)][_0x2a24cd(0x1c9)]!=='development')return;}this[_0x2a24cd(0x1c0)]['log'](_0x2a24cd(0x19d)),await this[_0x2a24cd(0x1ae)][_0x2a24cd(0x1d5)]({'name':{'$nin':[enums_1[_0x2a24cd(0x1a9)][_0x2a24cd(0x1a4)],enums_1[_0x2a24cd(0x1a9)][_0x2a24cd(0x1aa)]]},'type':_0x2a24cd(0x197)}),this[_0x2a24cd(0x1c0)]['log']('Fetching\x20today\x20schedule...');const _0x5800d3=await this['scheduleService'][_0x2a24cd(0x199)](new Date());this[_0x2a24cd(0x1c0)][_0x2a24cd(0x1ad)]('Eligible\x20schedule:\x20'+(_0x5800d3===null||_0x5800d3===void 0x0?void 0x0:_0x5800d3[_0x2a24cd(0x1a1)]));if(!_0x5800d3||!_0x5800d3[_0x2a24cd(0x1d2)]||_0x5800d3['events']['length']===0x0)return;_0x5800d3[_0x2a24cd(0x1d2)]['forEach'](_0x178db2=>{const _0x17cc73=_0x2a24cd;this[_0x17cc73(0x1c0)][_0x17cc73(0x1ad)](_0x17cc73(0x1c1)+_0x178db2[_0x17cc73(0x1a2)]+_0x17cc73(0x19c)+_0x178db2['jobType']+_0x17cc73(0x19c)+_0x178db2[_0x17cc73(0x1a1)]);const _0x4c225e=new Date(),_0x3d51d6=_0x4c225e[_0x17cc73(0x1b5)](),_0x399512=_0x4c225e['getMinutes'](),_0x64ad38=_0x4c225e['getSeconds'](),[_0xab260c,_0x282f55,_0x2c08d6]=_0x178db2[_0x17cc73(0x1a2)][_0x17cc73(0x1ac)](':');if(+_0xab260c<_0x3d51d6||+_0xab260c===_0x3d51d6&&+_0x282f55<_0x399512||+_0xab260c===_0x3d51d6&&+_0x282f55===_0x399512&&+_0x2c08d6<_0x64ad38)return;_0x4c225e['setHours'](+_0xab260c),_0x4c225e[_0x17cc73(0x1d1)](+_0x282f55),_0x4c225e[_0x17cc73(0x1ab)](+_0x2c08d6);switch(_0x178db2['jobType']){case enums_1[_0x17cc73(0x1dd)][_0x17cc73(0x19a)]:{const {soundId:_0x14a99e,durationInSecond:_0x2d98f9}=_0x178db2['data'];if(!_0x14a99e)return;const _0x466115={'soundId':_0x14a99e,'durationInSecond':_0x2d98f9,'audit':{'actor':enums_1[_0x17cc73(0x1c4)][_0x17cc73(0x1b6)],'name':enums_1[_0x17cc73(0x1dd)][_0x17cc73(0x19a)],'message':'Event:\x20'+_0x178db2['name']+_0x17cc73(0x1ca)+_0x5800d3['name']}};this[_0x17cc73(0x1ae)][_0x17cc73(0x193)](_0x4c225e,enums_1[_0x17cc73(0x1dd)][_0x17cc73(0x19a)],_0x466115);break;}case enums_1[_0x17cc73(0x1dd)][_0x17cc73(0x1d7)]:{const {playlistId:_0x5e7c32,durationInSecond:_0x2216c3}=_0x178db2[_0x17cc73(0x19b)];if(!_0x5e7c32)return;const _0x3cfd85={'playlistId':_0x5e7c32,'durationInSecond':_0x2216c3,'audit':{'actor':enums_1[_0x17cc73(0x1c4)][_0x17cc73(0x1b6)],'name':enums_1[_0x17cc73(0x1dd)][_0x17cc73(0x1d7)],'message':'Event:\x20'+_0x178db2['name']+_0x17cc73(0x1ca)+_0x5800d3[_0x17cc73(0x1a1)]}};this[_0x17cc73(0x1ae)]['schedule'](_0x4c225e,enums_1['JobType'][_0x17cc73(0x1d7)],_0x3cfd85);break;}case enums_1[_0x17cc73(0x1dd)][_0x17cc73(0x1b9)]:{const {voiceId:_0x5b3791,durationInSecond:_0x426714}=_0x178db2[_0x17cc73(0x19b)];if(!_0x5b3791)return;const _0x104e1d={'voiceId':_0x5b3791,'durationInSecond':_0x426714,'audit':{'actor':enums_1[_0x17cc73(0x1c4)][_0x17cc73(0x1b6)],'name':enums_1[_0x17cc73(0x1dd)][_0x17cc73(0x1b9)],'message':_0x17cc73(0x196)+_0x178db2[_0x17cc73(0x1a1)]+_0x17cc73(0x1ca)+_0x5800d3['name']}};this[_0x17cc73(0x1ae)][_0x17cc73(0x193)](_0x4c225e,enums_1['JobType']['PlayVoiceRecorded'],_0x104e1d);break;}case enums_1[_0x17cc73(0x1dd)][_0x17cc73(0x1a3)]:{const {textToAudioId:_0x57fa32,durationInSecond:_0x228259}=_0x178db2[_0x17cc73(0x19b)];if(!_0x57fa32)return;const _0x1b75d7={'textToAudioId':_0x57fa32,'durationInSecond':_0x228259,'audit':{'actor':enums_1[_0x17cc73(0x1c4)][_0x17cc73(0x1b6)],'name':enums_1[_0x17cc73(0x1dd)]['PlayTextToAudio'],'message':'Event:\x20'+_0x178db2[_0x17cc73(0x1a1)]+_0x17cc73(0x1ca)+_0x5800d3['name']}};this[_0x17cc73(0x1ae)][_0x17cc73(0x193)](_0x4c225e,enums_1['JobType'][_0x17cc73(0x1a3)],_0x1b75d7);break;}default:return;}}),this[_0x2a24cd(0x1c0)][_0x2a24cd(0x1ad)](_0x2a24cd(0x1bf));}async[a9_0x11932b(0x1cf)](_0x491f50){const _0x9e8d4d=a9_0x11932b;this[_0x9e8d4d(0x1c0)][_0x9e8d4d(0x1ad)]('Purging\x20temp\x20uploaded\x20files...');const {success:_0x463294,message:_0x5ab7fe}=await(0x0,file_1[_0x9e8d4d(0x1c7)])(constants_1[_0x9e8d4d(0x1b7)]);!_0x463294&&this[_0x9e8d4d(0x1c0)][_0x9e8d4d(0x1c3)](_0x9e8d4d(0x1c2)+_0x5ab7fe);}};__decorate([(0x0,nestjs_agenda_1['Define'])(enums_1[a9_0x11932b(0x1a9)][a9_0x11932b(0x1a4)]),__metadata(a9_0x11932b(0x1e1),Function),__metadata(a9_0x11932b(0x1de),[agenda_1['Job']]),__metadata(a9_0x11932b(0x192),Promise)],JobProccessor[a9_0x11932b(0x1d6)],'checkEvent',null),__decorate([(0x0,nestjs_agenda_1[a9_0x11932b(0x1c6)])(enums_1[a9_0x11932b(0x1a9)][a9_0x11932b(0x1aa)]),__metadata(a9_0x11932b(0x1e1),Function),__metadata(a9_0x11932b(0x1de),[agenda_1[a9_0x11932b(0x1b6)]]),__metadata(a9_0x11932b(0x192),Promise)],JobProccessor[a9_0x11932b(0x1d6)],'purgeTempUploadedFiles',null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x11932b(0x1af)])(),__metadata(a9_0x11932b(0x1de),[nestjs_agenda_1[a9_0x11932b(0x1db)],schedule_service_1[a9_0x11932b(0x1b8)],setting_service_1[a9_0x11932b(0x1d9)]])],JobProccessor),exports[a9_0x11932b(0x1cc)]=JobProccessor;