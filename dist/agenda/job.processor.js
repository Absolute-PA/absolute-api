'use strict';function a9_0x3a72(){const _0x575a94=['updateExpiryStatus','single','JobProccessor','ScheduleService','schedule','log','getSeconds','826067OZUtYx','Eligible\x20schedule:\x20','Define','../common/file','forEach','Invalid\x20or\x20expired\x20license\x20key!','AuditActor','object','Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20','development','AgendaService','Job','getHours','../common/enums','settingService','Scheduling\x20event:\x20','1123554NDXVDp','7pqScie','function','416098aHilsu','data','design:type','split','1527414deLqed','PlayVoiceRecorded','PurgeTempUploadedFiles','106385nhtmNT','4248392BEeSiD','PlayTextToAudio','Processor','agenda','purgeTempUploadedFiles','deleteFilesInFolder','\x20-\x20','metadata','Event:\x20','../setting/setting.service','__esModule','prototype','decorate','cancel','agendaService','name','JobType','logger','getMinutes','jobType','9QuFUEd','__decorate','Server\x20time:\x20','setHours','TMP_UPLOAD_DIR','PlayMusic','length','defineProperty','design:returntype','Logger','design:paramtypes','time','attrs','CheckEvent','30ECVgEl','../common/constants','getOwnPropertyDescriptor','events','145689LkWbDL','NODE_ENV','4AvDmfo','.\x20Job:\x20','checkEvent','scheduleService','Fetching\x20today\x20schedule...','BackgroundJobType','__metadata','PlaySound'];a9_0x3a72=function(){return _0x575a94;};return a9_0x3a72();}function a9_0x3a0d(_0x53b0cf,_0x382ea4){const _0x3a72f5=a9_0x3a72();return a9_0x3a0d=function(_0x3a0d75,_0x4debdb){_0x3a0d75=_0x3a0d75-0xc2;let _0x2173a4=_0x3a72f5[_0x3a0d75];return _0x2173a4;},a9_0x3a0d(_0x53b0cf,_0x382ea4);}const a9_0x17545f=a9_0x3a0d;(function(_0x4c9be9,_0x2258ff){const _0x56b60e=a9_0x3a0d,_0x1ca22d=_0x4c9be9();while(!![]){try{const _0x11ccab=-parseInt(_0x56b60e(0x108))/0x1+-parseInt(_0x56b60e(0xda))/0x2+parseInt(_0x56b60e(0xd7))/0x3+-parseInt(_0x56b60e(0x10a))/0x4*(parseInt(_0x56b60e(0xe1))/0x5)+-parseInt(_0x56b60e(0xde))/0x6*(-parseInt(_0x56b60e(0xd8))/0x7)+parseInt(_0x56b60e(0xe2))/0x8*(parseInt(_0x56b60e(0xf6))/0x9)+parseInt(_0x56b60e(0x104))/0xa*(-parseInt(_0x56b60e(0xc7))/0xb);if(_0x11ccab===_0x2258ff)break;else _0x1ca22d['push'](_0x1ca22d['shift']());}catch(_0x5869ef){_0x1ca22d['push'](_0x1ca22d['shift']());}}}(a9_0x3a72,0x88ad6));var __decorate=this&&this[a9_0x17545f(0xf7)]||function(_0x21aaf1,_0x564b84,_0x42e927,_0x51d10b){const _0x510119=a9_0x17545f;var _0x16034d=arguments[_0x510119(0xfc)],_0x4a8961=_0x16034d<0x3?_0x564b84:_0x51d10b===null?_0x51d10b=Object[_0x510119(0x106)](_0x564b84,_0x42e927):_0x51d10b,_0x10cb27;if(typeof Reflect==='object'&&typeof Reflect[_0x510119(0xee)]==='function')_0x4a8961=Reflect['decorate'](_0x21aaf1,_0x564b84,_0x42e927,_0x51d10b);else{for(var _0x77e03d=_0x21aaf1['length']-0x1;_0x77e03d>=0x0;_0x77e03d--)if(_0x10cb27=_0x21aaf1[_0x77e03d])_0x4a8961=(_0x16034d<0x3?_0x10cb27(_0x4a8961):_0x16034d>0x3?_0x10cb27(_0x564b84,_0x42e927,_0x4a8961):_0x10cb27(_0x564b84,_0x42e927))||_0x4a8961;}return _0x16034d>0x3&&_0x4a8961&&Object[_0x510119(0xfd)](_0x564b84,_0x42e927,_0x4a8961),_0x4a8961;},__metadata=this&&this[a9_0x17545f(0x110)]||function(_0x2d1d62,_0x302d33){const _0x608a92=a9_0x17545f;if(typeof Reflect===_0x608a92(0xce)&&typeof Reflect['metadata']===_0x608a92(0xd9))return Reflect[_0x608a92(0xe9)](_0x2d1d62,_0x302d33);},JobProccessor_1;Object[a9_0x17545f(0xfd)](exports,a9_0x17545f(0xec),{'value':!![]}),exports[a9_0x17545f(0xc2)]=void 0x0;const common_1=require('@nestjs/common'),agenda_1=require(a9_0x17545f(0xe5)),nestjs_agenda_1=require('@agent-ly/nestjs-agenda'),enums_1=require(a9_0x17545f(0xd4)),schedule_service_1=require('../schedule/schedule.service'),setting_service_1=require(a9_0x17545f(0xeb)),file_1=require(a9_0x17545f(0xca)),constants_1=require(a9_0x17545f(0x105));let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x5b67d5,_0x26535f,_0x4a454d){const _0x2392d6=a9_0x17545f;this[_0x2392d6(0xf0)]=_0x5b67d5,this[_0x2392d6(0x10d)]=_0x26535f,this[_0x2392d6(0xd5)]=_0x4a454d,this['logger']=new common_1[(_0x2392d6(0xff))](JobProccessor_1[_0x2392d6(0xf1)]);}async['checkEvent'](_0x2918e4){const _0x5371e9=a9_0x17545f;this[_0x5371e9(0xf3)][_0x5371e9(0xc5)](_0x5371e9(0xf8)+new Date()+_0x5371e9(0x10b)+_0x2918e4[_0x5371e9(0x102)]['name']);const _0x143815=await this[_0x5371e9(0xd5)][_0x5371e9(0x112)]();if(_0x143815['isExpired']){this[_0x5371e9(0xf3)]['log'](_0x5371e9(0xcc));if(process['env'][_0x5371e9(0x109)]!==_0x5371e9(0xd0))return;}this['logger'][_0x5371e9(0xc5)]('Canceling\x20all\x20old\x20background\x20checks...'),await this[_0x5371e9(0xf0)][_0x5371e9(0xef)]({'name':{'$nin':[enums_1['BackgroundJobType']['CheckEvent'],enums_1[_0x5371e9(0x10f)][_0x5371e9(0xe0)]]},'type':_0x5371e9(0x113)}),this[_0x5371e9(0xf3)]['log'](_0x5371e9(0x10e));const _0x1f0bf7=await this[_0x5371e9(0x10d)]['findEligibleSchedule'](new Date());this['logger'][_0x5371e9(0xc5)](_0x5371e9(0xc8)+(_0x1f0bf7===null||_0x1f0bf7===void 0x0?void 0x0:_0x1f0bf7['name']));if(!_0x1f0bf7||!_0x1f0bf7[_0x5371e9(0x107)]||_0x1f0bf7[_0x5371e9(0x107)]['length']===0x0)return;_0x1f0bf7[_0x5371e9(0x107)][_0x5371e9(0xcb)](_0x4a79f9=>{const _0x2a6e58=_0x5371e9;this[_0x2a6e58(0xf3)]['log'](_0x2a6e58(0xd6)+_0x4a79f9[_0x2a6e58(0x101)]+_0x2a6e58(0xe8)+_0x4a79f9[_0x2a6e58(0xf5)]+_0x2a6e58(0xe8)+_0x4a79f9[_0x2a6e58(0xf1)]);const _0x539499=new Date(),_0x348002=_0x539499[_0x2a6e58(0xd3)](),_0x3654dc=_0x539499[_0x2a6e58(0xf4)](),_0x211be9=_0x539499[_0x2a6e58(0xc6)](),[_0xb4a0f3,_0xe0d729,_0x1e21ed]=_0x4a79f9[_0x2a6e58(0x101)][_0x2a6e58(0xdd)](':');if(+_0xb4a0f3<_0x348002||+_0xb4a0f3===_0x348002&&+_0xe0d729<_0x3654dc||+_0xb4a0f3===_0x348002&&+_0xe0d729===_0x3654dc&&+_0x1e21ed<_0x211be9)return;_0x539499[_0x2a6e58(0xf9)](+_0xb4a0f3),_0x539499['setMinutes'](+_0xe0d729),_0x539499['setSeconds'](+_0x1e21ed);switch(_0x4a79f9[_0x2a6e58(0xf5)]){case enums_1[_0x2a6e58(0xf2)][_0x2a6e58(0x111)]:{const {soundId:_0x53d6a7,durationInSecond:_0x25d7ef}=_0x4a79f9[_0x2a6e58(0xdb)];if(!_0x53d6a7)return;const _0x5ca2b9={'soundId':_0x53d6a7,'durationInSecond':_0x25d7ef,'audit':{'actor':enums_1[_0x2a6e58(0xcd)][_0x2a6e58(0xd2)],'name':enums_1[_0x2a6e58(0xf2)][_0x2a6e58(0x111)],'message':_0x2a6e58(0xea)+_0x4a79f9[_0x2a6e58(0xf1)]+'\x20-\x20Schedule:\x20'+_0x1f0bf7[_0x2a6e58(0xf1)]}};this[_0x2a6e58(0xf0)][_0x2a6e58(0xc4)](_0x539499,enums_1[_0x2a6e58(0xf2)]['PlaySound'],_0x5ca2b9);break;}case enums_1[_0x2a6e58(0xf2)][_0x2a6e58(0xfb)]:{const {playlistId:_0x30355a,durationInSecond:_0x4c1d1b}=_0x4a79f9[_0x2a6e58(0xdb)];if(!_0x30355a)return;const _0x2dbc57={'playlistId':_0x30355a,'durationInSecond':_0x4c1d1b,'audit':{'actor':enums_1['AuditActor'][_0x2a6e58(0xd2)],'name':enums_1[_0x2a6e58(0xf2)][_0x2a6e58(0xfb)],'message':_0x2a6e58(0xea)+_0x4a79f9['name']+'\x20-\x20Schedule:\x20'+_0x1f0bf7[_0x2a6e58(0xf1)]}};this[_0x2a6e58(0xf0)]['schedule'](_0x539499,enums_1[_0x2a6e58(0xf2)]['PlayMusic'],_0x2dbc57);break;}case enums_1[_0x2a6e58(0xf2)]['PlayVoiceRecorded']:{const {voiceId:_0x11669d,durationInSecond:_0x2b004d}=_0x4a79f9[_0x2a6e58(0xdb)];if(!_0x11669d)return;const _0x1bddf7={'voiceId':_0x11669d,'durationInSecond':_0x2b004d,'audit':{'actor':enums_1['AuditActor'][_0x2a6e58(0xd2)],'name':enums_1[_0x2a6e58(0xf2)][_0x2a6e58(0xdf)],'message':_0x2a6e58(0xea)+_0x4a79f9[_0x2a6e58(0xf1)]+'\x20-\x20Schedule:\x20'+_0x1f0bf7[_0x2a6e58(0xf1)]}};this['agendaService']['schedule'](_0x539499,enums_1['JobType'][_0x2a6e58(0xdf)],_0x1bddf7);break;}case enums_1[_0x2a6e58(0xf2)][_0x2a6e58(0xe3)]:{const {textToAudioId:_0x2d49bf,durationInSecond:_0x407370}=_0x4a79f9[_0x2a6e58(0xdb)];if(!_0x2d49bf)return;const _0x1c6a7f={'textToAudioId':_0x2d49bf,'durationInSecond':_0x407370,'audit':{'actor':enums_1[_0x2a6e58(0xcd)][_0x2a6e58(0xd2)],'name':enums_1[_0x2a6e58(0xf2)][_0x2a6e58(0xe3)],'message':_0x2a6e58(0xea)+_0x4a79f9['name']+'\x20-\x20Schedule:\x20'+_0x1f0bf7[_0x2a6e58(0xf1)]}};this[_0x2a6e58(0xf0)][_0x2a6e58(0xc4)](_0x539499,enums_1[_0x2a6e58(0xf2)][_0x2a6e58(0xe3)],_0x1c6a7f);break;}default:return;}}),this['logger'][_0x5371e9(0xc5)]('Events\x20scheduled!');}async[a9_0x17545f(0xe6)](_0x7e5da6){const _0x358985=a9_0x17545f;this[_0x358985(0xf3)][_0x358985(0xc5)]('Purging\x20temp\x20uploaded\x20files...');const {success:_0x34c505,message:_0x2d7f48}=await(0x0,file_1[_0x358985(0xe7)])(constants_1[_0x358985(0xfa)]);!_0x34c505&&this[_0x358985(0xf3)]['error'](_0x358985(0xcf)+_0x2d7f48);}};__decorate([(0x0,nestjs_agenda_1[a9_0x17545f(0xc9)])(enums_1[a9_0x17545f(0x10f)][a9_0x17545f(0x103)]),__metadata(a9_0x17545f(0xdc),Function),__metadata('design:paramtypes',[agenda_1[a9_0x17545f(0xd2)]]),__metadata(a9_0x17545f(0xfe),Promise)],JobProccessor[a9_0x17545f(0xed)],a9_0x17545f(0x10c),null),__decorate([(0x0,nestjs_agenda_1['Define'])(enums_1[a9_0x17545f(0x10f)][a9_0x17545f(0xe0)]),__metadata('design:type',Function),__metadata('design:paramtypes',[agenda_1[a9_0x17545f(0xd2)]]),__metadata(a9_0x17545f(0xfe),Promise)],JobProccessor[a9_0x17545f(0xed)],a9_0x17545f(0xe6),null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x17545f(0xe4)])(),__metadata(a9_0x17545f(0x100),[nestjs_agenda_1[a9_0x17545f(0xd1)],schedule_service_1[a9_0x17545f(0xc3)],setting_service_1['SettingService']])],JobProccessor),exports['JobProccessor']=JobProccessor;