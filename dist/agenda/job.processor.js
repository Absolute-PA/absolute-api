'use strict';const a9_0x6a19b9=a9_0x8d4e;(function(_0x15f6db,_0x33adf0){const _0x326719=a9_0x8d4e,_0x7ddff3=_0x15f6db();while(!![]){try{const _0x4ce626=-parseInt(_0x326719(0x141))/0x1+-parseInt(_0x326719(0x13c))/0x2+-parseInt(_0x326719(0xf4))/0x3+-parseInt(_0x326719(0xf3))/0x4+parseInt(_0x326719(0x100))/0x5+-parseInt(_0x326719(0x126))/0x6+parseInt(_0x326719(0x127))/0x7*(parseInt(_0x326719(0x142))/0x8);if(_0x4ce626===_0x33adf0)break;else _0x7ddff3['push'](_0x7ddff3['shift']());}catch(_0x210e68){_0x7ddff3['push'](_0x7ddff3['shift']());}}}(a9_0x4825,0x2dcdb));function a9_0x8d4e(_0x1c04df,_0x45ff93){const _0x4825fa=a9_0x4825();return a9_0x8d4e=function(_0x8d4e28,_0x185014){_0x8d4e28=_0x8d4e28-0xf2;let _0x1b62b8=_0x4825fa[_0x8d4e28];return _0x1b62b8;},a9_0x8d4e(_0x1c04df,_0x45ff93);}function a9_0x4825(){const _0x3c4b12=['PurgeTempUploadedFiles','../setting/setting.service','Eligible\x20schedule:\x20','deleteFilesInFolder','single','BackgroundJobType','settingService','Processor','setHours','PlaySound','metadata','__metadata','log','object','time','TMP_UPLOAD_DIR','NODE_ENV','409878YrZAtI','119hoYqJk','Scheduling\x20event:\x20','development','getMinutes','getSeconds','Canceling\x20all\x20old\x20background\x20checks...','CheckEvent','PlayTextToAudio','data','schedule','findEligibleSchedule','events','AuditActor','../common/constants','@nestjs/common','../common/file','ScheduleService','Job','design:returntype','Event:\x20','Fetching\x20today\x20schedule...','649886xpbEGW','getHours','\x20-\x20Schedule:\x20','Purging\x20temp\x20uploaded\x20files...','Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20','59288ATDrof','357912ewAaVo','cancel','785956MbRHEl','574335uMiCmd','Define','checkEvent','JobType','.\x20Job:\x20','__esModule','forEach','__decorate','design:type','jobType','JobProccessor','@agent-ly/nestjs-agenda','1337630zgeVdI','error','PlayMusic','design:paramtypes','setSeconds','agendaService','decorate','agenda','function','PlayVoiceRecorded','purgeTempUploadedFiles','length','split','Events\x20scheduled!','logger','Server\x20time:\x20','defineProperty','SettingService','name','\x20-\x20','../schedule/schedule.service'];a9_0x4825=function(){return _0x3c4b12;};return a9_0x4825();}var __decorate=this&&this[a9_0x6a19b9(0xfb)]||function(_0x557a8d,_0x23b7af,_0x3cc56d,_0x31998f){const _0x2265ea=a9_0x6a19b9;var _0x5ad94c=arguments[_0x2265ea(0x10b)],_0x196a2d=_0x5ad94c<0x3?_0x23b7af:_0x31998f===null?_0x31998f=Object['getOwnPropertyDescriptor'](_0x23b7af,_0x3cc56d):_0x31998f,_0x21b250;if(typeof Reflect===_0x2265ea(0x122)&&typeof Reflect['decorate']==='function')_0x196a2d=Reflect[_0x2265ea(0x106)](_0x557a8d,_0x23b7af,_0x3cc56d,_0x31998f);else{for(var _0x302c38=_0x557a8d[_0x2265ea(0x10b)]-0x1;_0x302c38>=0x0;_0x302c38--)if(_0x21b250=_0x557a8d[_0x302c38])_0x196a2d=(_0x5ad94c<0x3?_0x21b250(_0x196a2d):_0x5ad94c>0x3?_0x21b250(_0x23b7af,_0x3cc56d,_0x196a2d):_0x21b250(_0x23b7af,_0x3cc56d))||_0x196a2d;}return _0x5ad94c>0x3&&_0x196a2d&&Object[_0x2265ea(0x110)](_0x23b7af,_0x3cc56d,_0x196a2d),_0x196a2d;},__metadata=this&&this[a9_0x6a19b9(0x120)]||function(_0x4fe5d1,_0x3b6ff4){const _0x5d2995=a9_0x6a19b9;if(typeof Reflect===_0x5d2995(0x122)&&typeof Reflect[_0x5d2995(0x11f)]===_0x5d2995(0x108))return Reflect[_0x5d2995(0x11f)](_0x4fe5d1,_0x3b6ff4);},JobProccessor_1;Object[a9_0x6a19b9(0x110)](exports,a9_0x6a19b9(0xf9),{'value':!![]}),exports[a9_0x6a19b9(0xfe)]=void 0x0;const common_1=require(a9_0x6a19b9(0x135)),agenda_1=require(a9_0x6a19b9(0x107)),nestjs_agenda_1=require(a9_0x6a19b9(0xff)),enums_1=require('../common/enums'),schedule_service_1=require(a9_0x6a19b9(0x114)),setting_service_1=require(a9_0x6a19b9(0x116)),file_1=require(a9_0x6a19b9(0x136)),constants_1=require(a9_0x6a19b9(0x134));let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x5a9dbb,_0x517ca1,_0x4c38ba){const _0x415047=a9_0x6a19b9;this[_0x415047(0x105)]=_0x5a9dbb,this['scheduleService']=_0x517ca1,this['settingService']=_0x4c38ba,this['logger']=new common_1['Logger'](JobProccessor_1['name']);}async[a9_0x6a19b9(0xf6)](_0x22dad1){const _0x222489=a9_0x6a19b9;this[_0x222489(0x10e)][_0x222489(0x121)](_0x222489(0x10f)+new Date()+_0x222489(0xf8)+_0x22dad1['attrs']['name']);const _0xebec86=await this[_0x222489(0x11b)]['updateExpiryStatus']();if(_0xebec86['isExpired']){this[_0x222489(0x10e)][_0x222489(0x121)]('Invalid\x20or\x20expired\x20license\x20key!');if(process['env'][_0x222489(0x125)]!==_0x222489(0x129))return;}this[_0x222489(0x10e)]['log'](_0x222489(0x12c)),await this[_0x222489(0x105)][_0x222489(0xf2)]({'name':{'$nin':[enums_1[_0x222489(0x11a)]['CheckEvent'],enums_1[_0x222489(0x11a)]['PurgeTempUploadedFiles']]},'type':_0x222489(0x119)}),this[_0x222489(0x10e)][_0x222489(0x121)](_0x222489(0x13b));const _0xbd5f72=await this['scheduleService'][_0x222489(0x131)](new Date());this[_0x222489(0x10e)][_0x222489(0x121)](_0x222489(0x117)+(_0xbd5f72===null||_0xbd5f72===void 0x0?void 0x0:_0xbd5f72[_0x222489(0x112)]));if(!_0xbd5f72||!_0xbd5f72[_0x222489(0x132)]||_0xbd5f72[_0x222489(0x132)][_0x222489(0x10b)]===0x0)return;_0xbd5f72['events'][_0x222489(0xfa)](_0x387b19=>{const _0x30f67b=_0x222489;this[_0x30f67b(0x10e)]['log'](_0x30f67b(0x128)+_0x387b19[_0x30f67b(0x123)]+'\x20-\x20'+_0x387b19[_0x30f67b(0xfd)]+_0x30f67b(0x113)+_0x387b19[_0x30f67b(0x112)]);const _0x38369a=new Date(),_0x4d55a9=_0x38369a[_0x30f67b(0x13d)](),_0x431bad=_0x38369a[_0x30f67b(0x12a)](),_0xddb420=_0x38369a[_0x30f67b(0x12b)](),[_0x267597,_0x446857,_0x570454]=_0x387b19[_0x30f67b(0x123)][_0x30f67b(0x10c)](':');if(+_0x267597<_0x4d55a9||+_0x267597===_0x4d55a9&&+_0x446857<_0x431bad||+_0x267597===_0x4d55a9&&+_0x446857===_0x431bad&&+_0x570454<_0xddb420)return;_0x38369a[_0x30f67b(0x11d)](+_0x267597),_0x38369a['setMinutes'](+_0x446857),_0x38369a[_0x30f67b(0x104)](+_0x570454);switch(_0x387b19['jobType']){case enums_1[_0x30f67b(0xf7)]['PlaySound']:{const {soundId:_0x2fa28d,durationInSecond:_0x3af2f7}=_0x387b19[_0x30f67b(0x12f)];if(!_0x2fa28d)return;const _0x866844={'soundId':_0x2fa28d,'durationInSecond':_0x3af2f7,'audit':{'actor':enums_1[_0x30f67b(0x133)][_0x30f67b(0x138)],'name':enums_1['JobType'][_0x30f67b(0x11e)],'message':_0x30f67b(0x13a)+_0x387b19[_0x30f67b(0x112)]+_0x30f67b(0x13e)+_0xbd5f72[_0x30f67b(0x112)]}};this['agendaService'][_0x30f67b(0x130)](_0x38369a,enums_1['JobType']['PlaySound'],_0x866844);break;}case enums_1['JobType']['PlayMusic']:{const {playlistId:_0x4647b0,durationInSecond:_0x599898}=_0x387b19[_0x30f67b(0x12f)];if(!_0x4647b0)return;const _0x3e3c45={'playlistId':_0x4647b0,'durationInSecond':_0x599898,'audit':{'actor':enums_1['AuditActor']['Job'],'name':enums_1[_0x30f67b(0xf7)][_0x30f67b(0x102)],'message':_0x30f67b(0x13a)+_0x387b19[_0x30f67b(0x112)]+'\x20-\x20Schedule:\x20'+_0xbd5f72['name']}};this[_0x30f67b(0x105)][_0x30f67b(0x130)](_0x38369a,enums_1[_0x30f67b(0xf7)][_0x30f67b(0x102)],_0x3e3c45);break;}case enums_1[_0x30f67b(0xf7)]['PlayVoiceRecorded']:{const {voiceId:_0x332771,durationInSecond:_0x137dcf}=_0x387b19['data'];if(!_0x332771)return;const _0x44b747={'voiceId':_0x332771,'durationInSecond':_0x137dcf,'audit':{'actor':enums_1['AuditActor'][_0x30f67b(0x138)],'name':enums_1[_0x30f67b(0xf7)][_0x30f67b(0x109)],'message':'Event:\x20'+_0x387b19[_0x30f67b(0x112)]+'\x20-\x20Schedule:\x20'+_0xbd5f72[_0x30f67b(0x112)]}};this[_0x30f67b(0x105)][_0x30f67b(0x130)](_0x38369a,enums_1[_0x30f67b(0xf7)][_0x30f67b(0x109)],_0x44b747);break;}case enums_1[_0x30f67b(0xf7)][_0x30f67b(0x12e)]:{const {textToAudioId:_0x331bc7,durationInSecond:_0x58228d}=_0x387b19[_0x30f67b(0x12f)];if(!_0x331bc7)return;const _0x5835f6={'textToAudioId':_0x331bc7,'durationInSecond':_0x58228d,'audit':{'actor':enums_1[_0x30f67b(0x133)][_0x30f67b(0x138)],'name':enums_1[_0x30f67b(0xf7)][_0x30f67b(0x12e)],'message':'Event:\x20'+_0x387b19[_0x30f67b(0x112)]+'\x20-\x20Schedule:\x20'+_0xbd5f72[_0x30f67b(0x112)]}};this[_0x30f67b(0x105)][_0x30f67b(0x130)](_0x38369a,enums_1[_0x30f67b(0xf7)][_0x30f67b(0x12e)],_0x5835f6);break;}default:return;}}),this[_0x222489(0x10e)]['log'](_0x222489(0x10d));}async[a9_0x6a19b9(0x10a)](_0x2cf1c9){const _0x44974f=a9_0x6a19b9;this['logger'][_0x44974f(0x121)](_0x44974f(0x13f));const {success:_0x5af694,message:_0x47ce15}=await(0x0,file_1[_0x44974f(0x118)])(constants_1[_0x44974f(0x124)]);!_0x5af694&&this[_0x44974f(0x10e)][_0x44974f(0x101)](_0x44974f(0x140)+_0x47ce15);}};__decorate([(0x0,nestjs_agenda_1[a9_0x6a19b9(0xf5)])(enums_1['BackgroundJobType'][a9_0x6a19b9(0x12d)]),__metadata(a9_0x6a19b9(0xfc),Function),__metadata(a9_0x6a19b9(0x103),[agenda_1[a9_0x6a19b9(0x138)]]),__metadata(a9_0x6a19b9(0x139),Promise)],JobProccessor['prototype'],a9_0x6a19b9(0xf6),null),__decorate([(0x0,nestjs_agenda_1[a9_0x6a19b9(0xf5)])(enums_1[a9_0x6a19b9(0x11a)][a9_0x6a19b9(0x115)]),__metadata('design:type',Function),__metadata(a9_0x6a19b9(0x103),[agenda_1[a9_0x6a19b9(0x138)]]),__metadata(a9_0x6a19b9(0x139),Promise)],JobProccessor['prototype'],'purgeTempUploadedFiles',null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x6a19b9(0x11c)])(),__metadata(a9_0x6a19b9(0x103),[nestjs_agenda_1['AgendaService'],schedule_service_1[a9_0x6a19b9(0x137)],setting_service_1[a9_0x6a19b9(0x111)]])],JobProccessor),exports[a9_0x6a19b9(0xfe)]=JobProccessor;