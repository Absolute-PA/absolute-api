'use strict';const a9_0xa20de9=a9_0x4884;function a9_0x35cc(){const _0x41ba9f=['ScheduleService','env','Define','PurgeTempUploadedFiles','getHours','name','PlayTextToAudio','Events\x20scheduled!','jobType','SettingService','setSeconds','setMinutes','getOwnPropertyDescriptor','536159BFqgYt','object','metadata','cancel','../common/constants','304115tZMdhx','1020987zImqAq','3108787vUCLSe','prototype','5545880qyrTVQ','isExpired','716REfSsP','findEligibleSchedule','Job','__metadata','Processor','Fetching\x20today\x20schedule...','decorate','AuditActor','Event:\x20','length','forEach','time','@nestjs/common','deleteFilesInFolder','Scheduling\x20event:\x20','error','development','__decorate','function','getMinutes','settingService','BackgroundJobType','scheduleService','agendaService','design:paramtypes','checkEvent','JobType','PlaySound','.\x20Job:\x20','schedule','events','JobProccessor','7505WLdoQa','PlayMusic','PlayVoiceRecorded','design:type','data','log','getSeconds','logger','split','24QFTDzY','10kdoUEg','../setting/setting.service','defineProperty','\x20-\x20Schedule:\x20','2gTAvuV','CheckEvent','2169621bPiBsQ','AgendaService','Canceling\x20all\x20old\x20background\x20checks...','12ZyRcpH','@agent-ly/nestjs-agenda','design:returntype','../common/enums'];a9_0x35cc=function(){return _0x41ba9f;};return a9_0x35cc();}(function(_0xc7352a,_0x4a0606){const _0x3ca3ad=a9_0x4884,_0x29ae47=_0xc7352a();while(!![]){try{const _0x49309c=parseInt(_0x3ca3ad(0x1e6))/0x1*(-parseInt(_0x3ca3ad(0x1d0))/0x2)+parseInt(_0x3ca3ad(0x1ec))/0x3+parseInt(_0x3ca3ad(0x1f1))/0x4*(-parseInt(_0x3ca3ad(0x1c2))/0x5)+-parseInt(_0x3ca3ad(0x1cb))/0x6*(-parseInt(_0x3ca3ad(0x1eb))/0x7)+parseInt(_0x3ca3ad(0x1ef))/0x8+parseInt(_0x3ca3ad(0x1d2))/0x9*(parseInt(_0x3ca3ad(0x1cc))/0xa)+parseInt(_0x3ca3ad(0x1ed))/0xb*(-parseInt(_0x3ca3ad(0x1d5))/0xc);if(_0x49309c===_0x4a0606)break;else _0x29ae47['push'](_0x29ae47['shift']());}catch(_0x485e35){_0x29ae47['push'](_0x29ae47['shift']());}}}(a9_0x35cc,0x581fe));var __decorate=this&&this[a9_0xa20de9(0x1b3)]||function(_0x571eb2,_0x5e5a46,_0x3933e0,_0xca2d9b){const _0x5bc744=a9_0xa20de9;var _0x122a91=arguments[_0x5bc744(0x1ab)],_0x4f7c42=_0x122a91<0x3?_0x5e5a46:_0xca2d9b===null?_0xca2d9b=Object[_0x5bc744(0x1e5)](_0x5e5a46,_0x3933e0):_0xca2d9b,_0x2013ee;if(typeof Reflect===_0x5bc744(0x1e7)&&typeof Reflect[_0x5bc744(0x1a8)]===_0x5bc744(0x1b4))_0x4f7c42=Reflect['decorate'](_0x571eb2,_0x5e5a46,_0x3933e0,_0xca2d9b);else{for(var _0x109227=_0x571eb2[_0x5bc744(0x1ab)]-0x1;_0x109227>=0x0;_0x109227--)if(_0x2013ee=_0x571eb2[_0x109227])_0x4f7c42=(_0x122a91<0x3?_0x2013ee(_0x4f7c42):_0x122a91>0x3?_0x2013ee(_0x5e5a46,_0x3933e0,_0x4f7c42):_0x2013ee(_0x5e5a46,_0x3933e0))||_0x4f7c42;}return _0x122a91>0x3&&_0x4f7c42&&Object['defineProperty'](_0x5e5a46,_0x3933e0,_0x4f7c42),_0x4f7c42;},__metadata=this&&this[a9_0xa20de9(0x1f4)]||function(_0x5b4823,_0x19b0c9){const _0x1f3100=a9_0xa20de9;if(typeof Reflect==='object'&&typeof Reflect[_0x1f3100(0x1e8)]===_0x1f3100(0x1b4))return Reflect[_0x1f3100(0x1e8)](_0x5b4823,_0x19b0c9);},JobProccessor_1;function a9_0x4884(_0x27f8e4,_0x38fb0a){const _0x35cc7e=a9_0x35cc();return a9_0x4884=function(_0x48847a,_0x2c1f21){_0x48847a=_0x48847a-0x1a7;let _0x4af835=_0x35cc7e[_0x48847a];return _0x4af835;},a9_0x4884(_0x27f8e4,_0x38fb0a);}Object[a9_0xa20de9(0x1ce)](exports,'__esModule',{'value':!![]}),exports[a9_0xa20de9(0x1c1)]=void 0x0;const common_1=require(a9_0xa20de9(0x1ae)),agenda_1=require('agenda'),nestjs_agenda_1=require(a9_0xa20de9(0x1d6)),enums_1=require(a9_0xa20de9(0x1d8)),schedule_service_1=require('../schedule/schedule.service'),setting_service_1=require(a9_0xa20de9(0x1cd)),file_1=require('../common/file'),constants_1=require(a9_0xa20de9(0x1ea));let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x548018,_0x53ef4c,_0x145b78){const _0x35ccee=a9_0xa20de9;this[_0x35ccee(0x1b9)]=_0x548018,this[_0x35ccee(0x1b8)]=_0x53ef4c,this[_0x35ccee(0x1b6)]=_0x145b78,this[_0x35ccee(0x1c9)]=new common_1['Logger'](JobProccessor_1[_0x35ccee(0x1de)]);}async[a9_0xa20de9(0x1bb)](_0xa917fe){const _0x580b88=a9_0xa20de9;this[_0x580b88(0x1c9)]['log']('Server\x20time:\x20'+new Date()+_0x580b88(0x1be)+_0xa917fe['attrs'][_0x580b88(0x1de)]);const _0x58932f=await this[_0x580b88(0x1b6)]['updateExpiryStatus']();if(_0x58932f[_0x580b88(0x1f0)]){this['logger']['log']('Invalid\x20or\x20expired\x20license\x20key!');if(process[_0x580b88(0x1da)]['NODE_ENV']!==_0x580b88(0x1b2))return;}this['logger'][_0x580b88(0x1c7)](_0x580b88(0x1d4)),await this['agendaService'][_0x580b88(0x1e9)]({'name':{'$nin':[enums_1[_0x580b88(0x1b7)][_0x580b88(0x1d1)],enums_1['BackgroundJobType'][_0x580b88(0x1dc)]]},'type':'single'}),this[_0x580b88(0x1c9)][_0x580b88(0x1c7)](_0x580b88(0x1a7));const _0x74009a=await this[_0x580b88(0x1b8)][_0x580b88(0x1f2)](new Date());this[_0x580b88(0x1c9)][_0x580b88(0x1c7)]('Eligible\x20schedule:\x20'+(_0x74009a===null||_0x74009a===void 0x0?void 0x0:_0x74009a[_0x580b88(0x1de)]));if(!_0x74009a||!_0x74009a[_0x580b88(0x1c0)]||_0x74009a[_0x580b88(0x1c0)][_0x580b88(0x1ab)]===0x0)return;_0x74009a['events'][_0x580b88(0x1ac)](_0x52656f=>{const _0x593a1b=_0x580b88;this[_0x593a1b(0x1c9)][_0x593a1b(0x1c7)](_0x593a1b(0x1b0)+_0x52656f['time']+'\x20-\x20'+_0x52656f[_0x593a1b(0x1e1)]+'\x20-\x20'+_0x52656f['name']);const _0x22b350=new Date(),_0x3d1cb7=_0x22b350[_0x593a1b(0x1dd)](),_0x59d08f=_0x22b350[_0x593a1b(0x1b5)](),_0x376095=_0x22b350[_0x593a1b(0x1c8)](),[_0x385cf4,_0x280da5,_0x5a928d]=_0x52656f[_0x593a1b(0x1ad)][_0x593a1b(0x1ca)](':');if(+_0x385cf4<_0x3d1cb7||+_0x385cf4===_0x3d1cb7&&+_0x280da5<_0x59d08f||+_0x385cf4===_0x3d1cb7&&+_0x280da5===_0x59d08f&&+_0x5a928d<_0x376095)return;_0x22b350['setHours'](+_0x385cf4),_0x22b350[_0x593a1b(0x1e4)](+_0x280da5),_0x22b350[_0x593a1b(0x1e3)](+_0x5a928d);switch(_0x52656f[_0x593a1b(0x1e1)]){case enums_1['JobType'][_0x593a1b(0x1bd)]:{const {soundId:_0x122608,durationInSecond:_0x4af342}=_0x52656f[_0x593a1b(0x1c6)];if(!_0x122608)return;const _0x160843={'soundId':_0x122608,'durationInSecond':_0x4af342,'audit':{'actor':enums_1['AuditActor'][_0x593a1b(0x1f3)],'name':enums_1[_0x593a1b(0x1bc)]['PlaySound'],'message':_0x593a1b(0x1aa)+_0x52656f[_0x593a1b(0x1de)]+_0x593a1b(0x1cf)+_0x74009a[_0x593a1b(0x1de)]}};this['agendaService'][_0x593a1b(0x1bf)](_0x22b350,enums_1[_0x593a1b(0x1bc)][_0x593a1b(0x1bd)],_0x160843);break;}case enums_1[_0x593a1b(0x1bc)]['PlayMusic']:{const {playlistId:_0x3d30b5,durationInSecond:_0x235b80}=_0x52656f[_0x593a1b(0x1c6)];if(!_0x3d30b5)return;const _0x158c23={'playlistId':_0x3d30b5,'durationInSecond':_0x235b80,'audit':{'actor':enums_1[_0x593a1b(0x1a9)][_0x593a1b(0x1f3)],'name':enums_1[_0x593a1b(0x1bc)][_0x593a1b(0x1c3)],'message':'Event:\x20'+_0x52656f[_0x593a1b(0x1de)]+_0x593a1b(0x1cf)+_0x74009a[_0x593a1b(0x1de)]}};this[_0x593a1b(0x1b9)][_0x593a1b(0x1bf)](_0x22b350,enums_1[_0x593a1b(0x1bc)][_0x593a1b(0x1c3)],_0x158c23);break;}case enums_1['JobType'][_0x593a1b(0x1c4)]:{const {voiceId:_0x390f67,durationInSecond:_0x50b670}=_0x52656f[_0x593a1b(0x1c6)];if(!_0x390f67)return;const _0x156ea7={'voiceId':_0x390f67,'durationInSecond':_0x50b670,'audit':{'actor':enums_1[_0x593a1b(0x1a9)][_0x593a1b(0x1f3)],'name':enums_1[_0x593a1b(0x1bc)][_0x593a1b(0x1c4)],'message':_0x593a1b(0x1aa)+_0x52656f['name']+_0x593a1b(0x1cf)+_0x74009a[_0x593a1b(0x1de)]}};this[_0x593a1b(0x1b9)][_0x593a1b(0x1bf)](_0x22b350,enums_1['JobType'][_0x593a1b(0x1c4)],_0x156ea7);break;}case enums_1[_0x593a1b(0x1bc)]['PlayTextToAudio']:{const {textToAudioId:_0x51c0b4,durationInSecond:_0x1f390b}=_0x52656f[_0x593a1b(0x1c6)];if(!_0x51c0b4)return;const _0x330fb3={'textToAudioId':_0x51c0b4,'durationInSecond':_0x1f390b,'audit':{'actor':enums_1[_0x593a1b(0x1a9)][_0x593a1b(0x1f3)],'name':enums_1[_0x593a1b(0x1bc)][_0x593a1b(0x1df)],'message':'Event:\x20'+_0x52656f[_0x593a1b(0x1de)]+_0x593a1b(0x1cf)+_0x74009a['name']}};this[_0x593a1b(0x1b9)][_0x593a1b(0x1bf)](_0x22b350,enums_1[_0x593a1b(0x1bc)][_0x593a1b(0x1df)],_0x330fb3);break;}default:return;}}),this[_0x580b88(0x1c9)][_0x580b88(0x1c7)](_0x580b88(0x1e0));}async['purgeTempUploadedFiles'](_0x5924ab){const _0x5d37ac=a9_0xa20de9;this[_0x5d37ac(0x1c9)][_0x5d37ac(0x1c7)]('Purging\x20temp\x20uploaded\x20files...');const {success:_0x3d8248,message:_0x5c6f0a}=await(0x0,file_1[_0x5d37ac(0x1af)])(constants_1['TMP_UPLOAD_DIR']);!_0x3d8248&&this[_0x5d37ac(0x1c9)][_0x5d37ac(0x1b1)]('Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20'+_0x5c6f0a);}};__decorate([(0x0,nestjs_agenda_1[a9_0xa20de9(0x1db)])(enums_1[a9_0xa20de9(0x1b7)]['CheckEvent']),__metadata('design:type',Function),__metadata(a9_0xa20de9(0x1ba),[agenda_1[a9_0xa20de9(0x1f3)]]),__metadata(a9_0xa20de9(0x1d7),Promise)],JobProccessor[a9_0xa20de9(0x1ee)],'checkEvent',null),__decorate([(0x0,nestjs_agenda_1[a9_0xa20de9(0x1db)])(enums_1['BackgroundJobType'][a9_0xa20de9(0x1dc)]),__metadata(a9_0xa20de9(0x1c5),Function),__metadata(a9_0xa20de9(0x1ba),[agenda_1[a9_0xa20de9(0x1f3)]]),__metadata(a9_0xa20de9(0x1d7),Promise)],JobProccessor['prototype'],'purgeTempUploadedFiles',null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0xa20de9(0x1f5)])(),__metadata(a9_0xa20de9(0x1ba),[nestjs_agenda_1[a9_0xa20de9(0x1d3)],schedule_service_1[a9_0xa20de9(0x1d9)],setting_service_1[a9_0xa20de9(0x1e2)]])],JobProccessor),exports['JobProccessor']=JobProccessor;