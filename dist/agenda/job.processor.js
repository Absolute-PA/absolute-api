'use strict';const a9_0x5e27d2=a9_0x28b1;(function(_0x4d4ed5,_0x394125){const _0x5c090b=a9_0x28b1,_0x2a956b=_0x4d4ed5();while(!![]){try{const _0x8876d7=parseInt(_0x5c090b(0x73))/0x1*(parseInt(_0x5c090b(0x71))/0x2)+-parseInt(_0x5c090b(0x7b))/0x3*(parseInt(_0x5c090b(0x8a))/0x4)+-parseInt(_0x5c090b(0xba))/0x5*(-parseInt(_0x5c090b(0xb6))/0x6)+-parseInt(_0x5c090b(0xa3))/0x7*(parseInt(_0x5c090b(0x9b))/0x8)+-parseInt(_0x5c090b(0x72))/0x9*(parseInt(_0x5c090b(0x7e))/0xa)+parseInt(_0x5c090b(0x85))/0xb*(parseInt(_0x5c090b(0x90))/0xc)+parseInt(_0x5c090b(0x9e))/0xd;if(_0x8876d7===_0x394125)break;else _0x2a956b['push'](_0x2a956b['shift']());}catch(_0x5d55fb){_0x2a956b['push'](_0x2a956b['shift']());}}}(a9_0x4e4c,0x5b5f9));function a9_0x28b1(_0x45a940,_0x43f042){const _0x4e4c74=a9_0x4e4c();return a9_0x28b1=function(_0x28b12e,_0x2dbb36){_0x28b12e=_0x28b12e-0x6a;let _0x2a2b98=_0x4e4c74[_0x28b12e];return _0x2a2b98;},a9_0x28b1(_0x45a940,_0x43f042);}var __decorate=this&&this[a9_0x5e27d2(0xbd)]||function(_0x38def4,_0x336f14,_0x3d8b99,_0x2962aa){const _0x542ab5=a9_0x5e27d2;var _0xaa0ac2=arguments[_0x542ab5(0x7c)],_0x133c18=_0xaa0ac2<0x3?_0x336f14:_0x2962aa===null?_0x2962aa=Object[_0x542ab5(0xa4)](_0x336f14,_0x3d8b99):_0x2962aa,_0x254fd8;if(typeof Reflect===_0x542ab5(0xbc)&&typeof Reflect[_0x542ab5(0x91)]==='function')_0x133c18=Reflect['decorate'](_0x38def4,_0x336f14,_0x3d8b99,_0x2962aa);else{for(var _0x5aadaf=_0x38def4[_0x542ab5(0x7c)]-0x1;_0x5aadaf>=0x0;_0x5aadaf--)if(_0x254fd8=_0x38def4[_0x5aadaf])_0x133c18=(_0xaa0ac2<0x3?_0x254fd8(_0x133c18):_0xaa0ac2>0x3?_0x254fd8(_0x336f14,_0x3d8b99,_0x133c18):_0x254fd8(_0x336f14,_0x3d8b99))||_0x133c18;}return _0xaa0ac2>0x3&&_0x133c18&&Object['defineProperty'](_0x336f14,_0x3d8b99,_0x133c18),_0x133c18;},__metadata=this&&this[a9_0x5e27d2(0x99)]||function(_0xf51912,_0x339469){const _0x1a8710=a9_0x5e27d2;if(typeof Reflect==='object'&&typeof Reflect[_0x1a8710(0x81)]==='function')return Reflect[_0x1a8710(0x81)](_0xf51912,_0x339469);},JobProccessor_1;Object[a9_0x5e27d2(0xb0)](exports,'__esModule',{'value':!![]}),exports[a9_0x5e27d2(0xb7)]=void 0x0;function a9_0x4e4c(){const _0x9153e9=['7635588dPBFFm','decorate','PlayTextToAudio','forEach','design:type','@nestjs/common','findEligibleSchedule','Define','PlaySound','__metadata','Canceling\x20all\x20old\x20background\x20checks...','16tzWxVD','../setting/setting.service','NODE_ENV','4761068CiHufi','log','.\x20Job:\x20','split','TMP_UPLOAD_DIR','2521995KEFFke','getOwnPropertyDescriptor','Processor','JobType','settingService','cancel','attrs','../common/file','AuditActor','Server\x20time:\x20','error','design:paramtypes','design:returntype','defineProperty','../common/constants','SettingService','purgeTempUploadedFiles','\x20-\x20','Event:\x20','1114584fniWjx','JobProccessor','PlayVoiceRecorded','schedule','10DnqZYh','deleteFilesInFolder','object','__decorate','AgendaService','env','PurgeTempUploadedFiles','getMinutes','Logger','agendaService','Eligible\x20schedule:\x20','PlayMusic','Job','822OvygrR','9cnqZvY','1103weYfeq','development','\x20-\x20Schedule:\x20','events','logger','data','checkEvent','ScheduleService','270093GIDsKP','length','Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20','6425300wGQbWE','updateExpiryStatus','agenda','metadata','Purging\x20temp\x20uploaded\x20files...','name','BackgroundJobType','11vVbGku','jobType','getHours','CheckEvent','Invalid\x20or\x20expired\x20license\x20key!','4OaSkbs','@agent-ly/nestjs-agenda','single','scheduleService','Scheduling\x20event:\x20','prototype'];a9_0x4e4c=function(){return _0x9153e9;};return a9_0x4e4c();}const common_1=require(a9_0x5e27d2(0x95)),agenda_1=require(a9_0x5e27d2(0x80)),nestjs_agenda_1=require(a9_0x5e27d2(0x8b)),enums_1=require('../common/enums'),schedule_service_1=require('../schedule/schedule.service'),setting_service_1=require(a9_0x5e27d2(0x9c)),file_1=require(a9_0x5e27d2(0xaa)),constants_1=require(a9_0x5e27d2(0xb1));let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x3ec98e,_0x13f2ea,_0x18b9b2){const _0x18e6c8=a9_0x5e27d2;this[_0x18e6c8(0x6d)]=_0x3ec98e,this['scheduleService']=_0x13f2ea,this[_0x18e6c8(0xa7)]=_0x18b9b2,this[_0x18e6c8(0x77)]=new common_1[(_0x18e6c8(0x6c))](JobProccessor_1[_0x18e6c8(0x83)]);}async[a9_0x5e27d2(0x79)](_0x1199b9){const _0x745ced=a9_0x5e27d2;this[_0x745ced(0x77)][_0x745ced(0x9f)](_0x745ced(0xac)+new Date()+_0x745ced(0xa0)+_0x1199b9[_0x745ced(0xa9)][_0x745ced(0x83)]);const _0x5442d9=await this[_0x745ced(0xa7)][_0x745ced(0x7f)]();if(_0x5442d9['isExpired']){this[_0x745ced(0x77)]['log'](_0x745ced(0x89));if(process[_0x745ced(0xbf)][_0x745ced(0x9d)]!==_0x745ced(0x74))return;}this['logger']['log'](_0x745ced(0x9a)),await this['agendaService'][_0x745ced(0xa8)]({'name':{'$nin':[enums_1[_0x745ced(0x84)][_0x745ced(0x88)],enums_1['BackgroundJobType'][_0x745ced(0x6a)]]},'type':_0x745ced(0x8c)}),this[_0x745ced(0x77)]['log']('Fetching\x20today\x20schedule...');const _0x5dc1b3=await this[_0x745ced(0x8d)][_0x745ced(0x96)](new Date());this['logger']['log'](_0x745ced(0x6e)+(_0x5dc1b3===null||_0x5dc1b3===void 0x0?void 0x0:_0x5dc1b3['name']));if(!_0x5dc1b3||!_0x5dc1b3[_0x745ced(0x76)]||_0x5dc1b3['events']['length']===0x0)return;_0x5dc1b3[_0x745ced(0x76)][_0x745ced(0x93)](_0x26aaee=>{const _0x1ee0b2=_0x745ced;this[_0x1ee0b2(0x77)][_0x1ee0b2(0x9f)](_0x1ee0b2(0x8e)+_0x26aaee['time']+_0x1ee0b2(0xb4)+_0x26aaee['jobType']+_0x1ee0b2(0xb4)+_0x26aaee[_0x1ee0b2(0x83)]);const _0x200a3d=new Date(),_0x4fd92b=_0x200a3d[_0x1ee0b2(0x87)](),_0x3d9b2b=_0x200a3d[_0x1ee0b2(0x6b)](),_0x3b086b=_0x200a3d['getSeconds'](),[_0xe7673e,_0x3da509,_0x4fe030]=_0x26aaee['time'][_0x1ee0b2(0xa1)](':');if(+_0xe7673e<_0x4fd92b||+_0xe7673e===_0x4fd92b&&+_0x3da509<_0x3d9b2b||+_0xe7673e===_0x4fd92b&&+_0x3da509===_0x3d9b2b&&+_0x4fe030<_0x3b086b)return;_0x200a3d['setHours'](+_0xe7673e),_0x200a3d['setMinutes'](+_0x3da509),_0x200a3d['setSeconds'](+_0x4fe030);switch(_0x26aaee[_0x1ee0b2(0x86)]){case enums_1[_0x1ee0b2(0xa6)][_0x1ee0b2(0x98)]:{const {soundId:_0x4d476c,durationInSecond:_0x59c2c0}=_0x26aaee['data'];if(!_0x4d476c)return;const _0x2e8594={'soundId':_0x4d476c,'durationInSecond':_0x59c2c0,'audit':{'actor':enums_1['AuditActor'][_0x1ee0b2(0x70)],'name':enums_1[_0x1ee0b2(0xa6)][_0x1ee0b2(0x98)],'message':_0x1ee0b2(0xb5)+_0x26aaee['name']+_0x1ee0b2(0x75)+_0x5dc1b3[_0x1ee0b2(0x83)]}};this[_0x1ee0b2(0x6d)][_0x1ee0b2(0xb9)](_0x200a3d,enums_1[_0x1ee0b2(0xa6)]['PlaySound'],_0x2e8594);break;}case enums_1[_0x1ee0b2(0xa6)]['PlayMusic']:{const {playlistId:_0x3f177b,durationInSecond:_0x12dd95}=_0x26aaee[_0x1ee0b2(0x78)];if(!_0x3f177b)return;const _0x330964={'playlistId':_0x3f177b,'durationInSecond':_0x12dd95,'audit':{'actor':enums_1['AuditActor'][_0x1ee0b2(0x70)],'name':enums_1[_0x1ee0b2(0xa6)][_0x1ee0b2(0x6f)],'message':_0x1ee0b2(0xb5)+_0x26aaee[_0x1ee0b2(0x83)]+_0x1ee0b2(0x75)+_0x5dc1b3[_0x1ee0b2(0x83)]}};this['agendaService'][_0x1ee0b2(0xb9)](_0x200a3d,enums_1[_0x1ee0b2(0xa6)]['PlayMusic'],_0x330964);break;}case enums_1['JobType'][_0x1ee0b2(0xb8)]:{const {voiceId:_0x2215a6,durationInSecond:_0x2f5f76}=_0x26aaee[_0x1ee0b2(0x78)];if(!_0x2215a6)return;const _0x52bcb0={'voiceId':_0x2215a6,'durationInSecond':_0x2f5f76,'audit':{'actor':enums_1[_0x1ee0b2(0xab)][_0x1ee0b2(0x70)],'name':enums_1[_0x1ee0b2(0xa6)][_0x1ee0b2(0xb8)],'message':'Event:\x20'+_0x26aaee['name']+_0x1ee0b2(0x75)+_0x5dc1b3['name']}};this[_0x1ee0b2(0x6d)][_0x1ee0b2(0xb9)](_0x200a3d,enums_1[_0x1ee0b2(0xa6)]['PlayVoiceRecorded'],_0x52bcb0);break;}case enums_1[_0x1ee0b2(0xa6)][_0x1ee0b2(0x92)]:{const {textToAudioId:_0x373fd3,durationInSecond:_0x163524}=_0x26aaee[_0x1ee0b2(0x78)];if(!_0x373fd3)return;const _0xc8cdc3={'textToAudioId':_0x373fd3,'durationInSecond':_0x163524,'audit':{'actor':enums_1[_0x1ee0b2(0xab)][_0x1ee0b2(0x70)],'name':enums_1[_0x1ee0b2(0xa6)][_0x1ee0b2(0x92)],'message':_0x1ee0b2(0xb5)+_0x26aaee[_0x1ee0b2(0x83)]+_0x1ee0b2(0x75)+_0x5dc1b3[_0x1ee0b2(0x83)]}};this['agendaService'][_0x1ee0b2(0xb9)](_0x200a3d,enums_1[_0x1ee0b2(0xa6)][_0x1ee0b2(0x92)],_0xc8cdc3);break;}default:return;}}),this[_0x745ced(0x77)][_0x745ced(0x9f)]('Events\x20scheduled!');}async[a9_0x5e27d2(0xb3)](_0x279d08){const _0x4bd5d0=a9_0x5e27d2;this[_0x4bd5d0(0x77)][_0x4bd5d0(0x9f)](_0x4bd5d0(0x82));const {success:_0x529ed7,message:_0xe89c4f}=await(0x0,file_1[_0x4bd5d0(0xbb)])(constants_1[_0x4bd5d0(0xa2)]);!_0x529ed7&&this[_0x4bd5d0(0x77)][_0x4bd5d0(0xad)](_0x4bd5d0(0x7d)+_0xe89c4f);}};__decorate([(0x0,nestjs_agenda_1[a9_0x5e27d2(0x97)])(enums_1['BackgroundJobType'][a9_0x5e27d2(0x88)]),__metadata('design:type',Function),__metadata('design:paramtypes',[agenda_1[a9_0x5e27d2(0x70)]]),__metadata(a9_0x5e27d2(0xaf),Promise)],JobProccessor[a9_0x5e27d2(0x8f)],a9_0x5e27d2(0x79),null),__decorate([(0x0,nestjs_agenda_1[a9_0x5e27d2(0x97)])(enums_1[a9_0x5e27d2(0x84)]['PurgeTempUploadedFiles']),__metadata(a9_0x5e27d2(0x94),Function),__metadata(a9_0x5e27d2(0xae),[agenda_1['Job']]),__metadata(a9_0x5e27d2(0xaf),Promise)],JobProccessor[a9_0x5e27d2(0x8f)],a9_0x5e27d2(0xb3),null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x5e27d2(0xa5)])(),__metadata(a9_0x5e27d2(0xae),[nestjs_agenda_1[a9_0x5e27d2(0xbe)],schedule_service_1[a9_0x5e27d2(0x7a)],setting_service_1[a9_0x5e27d2(0xb2)]])],JobProccessor),exports['JobProccessor']=JobProccessor;