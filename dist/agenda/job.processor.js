'use strict';const a9_0x21f992=a9_0x433b;(function(_0x2fad28,_0x14d997){const _0x1b9afe=a9_0x433b,_0xb05a5e=_0x2fad28();while(!![]){try{const _0x264b9a=-parseInt(_0x1b9afe(0x18a))/0x1+parseInt(_0x1b9afe(0x167))/0x2*(parseInt(_0x1b9afe(0x163))/0x3)+-parseInt(_0x1b9afe(0x18b))/0x4*(-parseInt(_0x1b9afe(0x1a0))/0x5)+-parseInt(_0x1b9afe(0x166))/0x6*(-parseInt(_0x1b9afe(0x185))/0x7)+parseInt(_0x1b9afe(0x170))/0x8+-parseInt(_0x1b9afe(0x197))/0x9+parseInt(_0x1b9afe(0x175))/0xa*(-parseInt(_0x1b9afe(0x18c))/0xb);if(_0x264b9a===_0x14d997)break;else _0xb05a5e['push'](_0xb05a5e['shift']());}catch(_0x57679b){_0xb05a5e['push'](_0xb05a5e['shift']());}}}(a9_0x2bde,0x21daa));var __decorate=this&&this[a9_0x21f992(0x16b)]||function(_0x40cd6d,_0x35e4af,_0x11ca9d,_0x14b4d8){const _0x3a36a3=a9_0x21f992;var _0x25d7b3=arguments[_0x3a36a3(0x1a4)],_0x3da072=_0x25d7b3<0x3?_0x35e4af:_0x14b4d8===null?_0x14b4d8=Object['getOwnPropertyDescriptor'](_0x35e4af,_0x11ca9d):_0x14b4d8,_0x18ce95;if(typeof Reflect===_0x3a36a3(0x173)&&typeof Reflect[_0x3a36a3(0x17b)]===_0x3a36a3(0x16d))_0x3da072=Reflect['decorate'](_0x40cd6d,_0x35e4af,_0x11ca9d,_0x14b4d8);else{for(var _0x57d94a=_0x40cd6d[_0x3a36a3(0x1a4)]-0x1;_0x57d94a>=0x0;_0x57d94a--)if(_0x18ce95=_0x40cd6d[_0x57d94a])_0x3da072=(_0x25d7b3<0x3?_0x18ce95(_0x3da072):_0x25d7b3>0x3?_0x18ce95(_0x35e4af,_0x11ca9d,_0x3da072):_0x18ce95(_0x35e4af,_0x11ca9d))||_0x3da072;}return _0x25d7b3>0x3&&_0x3da072&&Object[_0x3a36a3(0x196)](_0x35e4af,_0x11ca9d,_0x3da072),_0x3da072;},__metadata=this&&this[a9_0x21f992(0x177)]||function(_0x33f781,_0x42a06b){const _0x13cb86=a9_0x21f992;if(typeof Reflect===_0x13cb86(0x173)&&typeof Reflect[_0x13cb86(0x192)]===_0x13cb86(0x16d))return Reflect[_0x13cb86(0x192)](_0x33f781,_0x42a06b);},JobProccessor_1;Object['defineProperty'](exports,a9_0x21f992(0x17a),{'value':!![]}),exports['JobProccessor']=void 0x0;const common_1=require(a9_0x21f992(0x187)),agenda_1=require(a9_0x21f992(0x1b1)),nestjs_agenda_1=require('@agent-ly/nestjs-agenda'),enums_1=require(a9_0x21f992(0x168)),schedule_service_1=require(a9_0x21f992(0x182)),setting_service_1=require(a9_0x21f992(0x18d)),file_1=require(a9_0x21f992(0x16a)),constants_1=require(a9_0x21f992(0x1b2));function a9_0x433b(_0x447108,_0x41e89d){const _0x2bde89=a9_0x2bde();return a9_0x433b=function(_0x433bfa,_0x44bac8){_0x433bfa=_0x433bfa-0x15e;let _0x52496f=_0x2bde89[_0x433bfa];return _0x52496f;},a9_0x433b(_0x447108,_0x41e89d);}function a9_0x2bde(){const _0x4b9dbd=['@nestjs/common','single','Logger','50810Easqeo','85256NMieEU','44UainJP','../setting/setting.service','findEligibleSchedule','Fetching\x20today\x20schedule...','error','forEach','metadata','log','Define','data','defineProperty','2085894hVbFvY','getHours','name','design:paramtypes','purgeTempUploadedFiles','AuditActor','Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20','PurgeTempUploadedFiles','\x20-\x20Schedule:\x20','10jzAAYK','prototype','time','updateExpiryStatus','length','Job','JobType','PlayMusic','ScheduleService','scheduleService','setSeconds','env','JobProccessor','BackgroundJobType','Scheduling\x20event:\x20','Eligible\x20schedule:\x20','design:type','agenda','../common/constants','Events\x20scheduled!','cancel','Server\x20time:\x20','split','logger','attrs','events','PlaySound','3fkpjXX','development','Purging\x20temp\x20uploaded\x20files...','28872eNrKIE','361898LvzkGl','../common/enums','\x20-\x20','../common/file','__decorate','setMinutes','function','agendaService','NODE_ENV','1521896YfAVZU','TMP_UPLOAD_DIR','CheckEvent','object','deleteFilesInFolder','282180LMYCfK','Event:\x20','__metadata','settingService','checkEvent','__esModule','decorate','PlayVoiceRecorded','schedule','SettingService','jobType','getMinutes','setHours','../schedule/schedule.service','design:returntype','AgendaService','175aTFdYR','.\x20Job:\x20'];a9_0x2bde=function(){return _0x4b9dbd;};return a9_0x2bde();}let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x17eecc,_0x113f9d,_0x405394){const _0x370e8b=a9_0x21f992;this[_0x370e8b(0x16e)]=_0x17eecc,this[_0x370e8b(0x1a9)]=_0x113f9d,this[_0x370e8b(0x178)]=_0x405394,this[_0x370e8b(0x15f)]=new common_1[(_0x370e8b(0x189))](JobProccessor_1[_0x370e8b(0x199)]);}async[a9_0x21f992(0x179)](_0x99f270){const _0xab0f46=a9_0x21f992;this[_0xab0f46(0x15f)]['log'](_0xab0f46(0x1b5)+new Date()+_0xab0f46(0x186)+_0x99f270[_0xab0f46(0x160)][_0xab0f46(0x199)]);const _0x208135=await this['settingService'][_0xab0f46(0x1a3)]();if(_0x208135['isExpired']){this[_0xab0f46(0x15f)][_0xab0f46(0x193)]('Invalid\x20or\x20expired\x20license\x20key!');if(process[_0xab0f46(0x1ab)][_0xab0f46(0x16f)]!==_0xab0f46(0x164))return;}this[_0xab0f46(0x15f)]['log']('Canceling\x20all\x20old\x20background\x20checks...'),await this['agendaService'][_0xab0f46(0x1b4)]({'name':{'$nin':[enums_1['BackgroundJobType'][_0xab0f46(0x172)],enums_1[_0xab0f46(0x1ad)][_0xab0f46(0x19e)]]},'type':_0xab0f46(0x188)}),this[_0xab0f46(0x15f)][_0xab0f46(0x193)](_0xab0f46(0x18f));const _0x1d1e76=await this[_0xab0f46(0x1a9)][_0xab0f46(0x18e)](new Date());this['logger'][_0xab0f46(0x193)](_0xab0f46(0x1af)+(_0x1d1e76===null||_0x1d1e76===void 0x0?void 0x0:_0x1d1e76[_0xab0f46(0x199)]));if(!_0x1d1e76||!_0x1d1e76[_0xab0f46(0x161)]||_0x1d1e76[_0xab0f46(0x161)][_0xab0f46(0x1a4)]===0x0)return;_0x1d1e76[_0xab0f46(0x161)][_0xab0f46(0x191)](_0x51e5b1=>{const _0x14a093=_0xab0f46;this[_0x14a093(0x15f)][_0x14a093(0x193)](_0x14a093(0x1ae)+_0x51e5b1['time']+_0x14a093(0x169)+_0x51e5b1[_0x14a093(0x17f)]+_0x14a093(0x169)+_0x51e5b1['name']);const _0x407684=new Date(),_0x343e09=_0x407684[_0x14a093(0x198)](),_0x1dc2f9=_0x407684[_0x14a093(0x180)](),_0x33a831=_0x407684['getSeconds'](),[_0x5b9900,_0x253e24,_0x234580]=_0x51e5b1[_0x14a093(0x1a2)][_0x14a093(0x15e)](':');if(+_0x5b9900<_0x343e09||+_0x5b9900===_0x343e09&&+_0x253e24<_0x1dc2f9||+_0x5b9900===_0x343e09&&+_0x253e24===_0x1dc2f9&&+_0x234580<_0x33a831)return;_0x407684[_0x14a093(0x181)](+_0x5b9900),_0x407684[_0x14a093(0x16c)](+_0x253e24),_0x407684[_0x14a093(0x1aa)](+_0x234580);switch(_0x51e5b1[_0x14a093(0x17f)]){case enums_1[_0x14a093(0x1a6)]['PlaySound']:{const {soundId:_0x3ff68d,durationInSecond:_0x5d1929}=_0x51e5b1[_0x14a093(0x195)];if(!_0x3ff68d)return;const _0x5d4f85={'soundId':_0x3ff68d,'durationInSecond':_0x5d1929,'audit':{'actor':enums_1[_0x14a093(0x19c)][_0x14a093(0x1a5)],'name':enums_1[_0x14a093(0x1a6)][_0x14a093(0x162)],'message':_0x14a093(0x176)+_0x51e5b1['name']+_0x14a093(0x19f)+_0x1d1e76[_0x14a093(0x199)]}};this[_0x14a093(0x16e)][_0x14a093(0x17d)](_0x407684,enums_1[_0x14a093(0x1a6)][_0x14a093(0x162)],_0x5d4f85);break;}case enums_1[_0x14a093(0x1a6)][_0x14a093(0x1a7)]:{const {playlistId:_0x22fab5,durationInSecond:_0x36f2a2}=_0x51e5b1[_0x14a093(0x195)];if(!_0x22fab5)return;const _0xe8bc92={'playlistId':_0x22fab5,'durationInSecond':_0x36f2a2,'audit':{'actor':enums_1[_0x14a093(0x19c)][_0x14a093(0x1a5)],'name':enums_1['JobType'][_0x14a093(0x1a7)],'message':_0x14a093(0x176)+_0x51e5b1['name']+_0x14a093(0x19f)+_0x1d1e76[_0x14a093(0x199)]}};this[_0x14a093(0x16e)][_0x14a093(0x17d)](_0x407684,enums_1[_0x14a093(0x1a6)][_0x14a093(0x1a7)],_0xe8bc92);break;}case enums_1[_0x14a093(0x1a6)][_0x14a093(0x17c)]:{const {voiceId:_0x19b225,durationInSecond:_0x2864ad}=_0x51e5b1[_0x14a093(0x195)];if(!_0x19b225)return;const _0x3ef042={'voiceId':_0x19b225,'durationInSecond':_0x2864ad,'audit':{'actor':enums_1[_0x14a093(0x19c)][_0x14a093(0x1a5)],'name':enums_1[_0x14a093(0x1a6)]['PlayVoiceRecorded'],'message':_0x14a093(0x176)+_0x51e5b1[_0x14a093(0x199)]+_0x14a093(0x19f)+_0x1d1e76['name']}};this[_0x14a093(0x16e)][_0x14a093(0x17d)](_0x407684,enums_1[_0x14a093(0x1a6)]['PlayVoiceRecorded'],_0x3ef042);break;}case enums_1[_0x14a093(0x1a6)]['PlayTextToAudio']:{const {textToAudioId:_0x104670,durationInSecond:_0x352261}=_0x51e5b1['data'];if(!_0x104670)return;const _0x493051={'textToAudioId':_0x104670,'durationInSecond':_0x352261,'audit':{'actor':enums_1[_0x14a093(0x19c)][_0x14a093(0x1a5)],'name':enums_1['JobType']['PlayTextToAudio'],'message':_0x14a093(0x176)+_0x51e5b1[_0x14a093(0x199)]+_0x14a093(0x19f)+_0x1d1e76[_0x14a093(0x199)]}};this[_0x14a093(0x16e)]['schedule'](_0x407684,enums_1[_0x14a093(0x1a6)]['PlayTextToAudio'],_0x493051);break;}default:return;}}),this[_0xab0f46(0x15f)][_0xab0f46(0x193)](_0xab0f46(0x1b3));}async['purgeTempUploadedFiles'](_0x19e61d){const _0x59649b=a9_0x21f992;this[_0x59649b(0x15f)][_0x59649b(0x193)](_0x59649b(0x165));const {success:_0x571197,message:_0x26e52e}=await(0x0,file_1[_0x59649b(0x174)])(constants_1[_0x59649b(0x171)]);!_0x571197&&this['logger'][_0x59649b(0x190)](_0x59649b(0x19d)+_0x26e52e);}};__decorate([(0x0,nestjs_agenda_1['Define'])(enums_1['BackgroundJobType'][a9_0x21f992(0x172)]),__metadata(a9_0x21f992(0x1b0),Function),__metadata(a9_0x21f992(0x19a),[agenda_1[a9_0x21f992(0x1a5)]]),__metadata(a9_0x21f992(0x183),Promise)],JobProccessor[a9_0x21f992(0x1a1)],'checkEvent',null),__decorate([(0x0,nestjs_agenda_1[a9_0x21f992(0x194)])(enums_1[a9_0x21f992(0x1ad)][a9_0x21f992(0x19e)]),__metadata(a9_0x21f992(0x1b0),Function),__metadata(a9_0x21f992(0x19a),[agenda_1[a9_0x21f992(0x1a5)]]),__metadata(a9_0x21f992(0x183),Promise)],JobProccessor[a9_0x21f992(0x1a1)],a9_0x21f992(0x19b),null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1['Processor'])(),__metadata(a9_0x21f992(0x19a),[nestjs_agenda_1[a9_0x21f992(0x184)],schedule_service_1[a9_0x21f992(0x1a8)],setting_service_1[a9_0x21f992(0x17e)]])],JobProccessor),exports[a9_0x21f992(0x1ac)]=JobProccessor;