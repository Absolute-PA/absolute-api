'use strict';const a9_0x21d290=a9_0xdc78;(function(_0x3e803a,_0x161bd5){const _0x1647f7=a9_0xdc78,_0x170157=_0x3e803a();while(!![]){try{const _0x50aa20=-parseInt(_0x1647f7(0x1e4))/0x1*(-parseInt(_0x1647f7(0x201))/0x2)+parseInt(_0x1647f7(0x1c4))/0x3*(parseInt(_0x1647f7(0x207))/0x4)+parseInt(_0x1647f7(0x210))/0x5+parseInt(_0x1647f7(0x1e2))/0x6*(-parseInt(_0x1647f7(0x20e))/0x7)+-parseInt(_0x1647f7(0x1da))/0x8*(parseInt(_0x1647f7(0x1f1))/0x9)+parseInt(_0x1647f7(0x1d5))/0xa*(parseInt(_0x1647f7(0x1ef))/0xb)+-parseInt(_0x1647f7(0x1cc))/0xc*(parseInt(_0x1647f7(0x206))/0xd);if(_0x50aa20===_0x161bd5)break;else _0x170157['push'](_0x170157['shift']());}catch(_0x36aa84){_0x170157['push'](_0x170157['shift']());}}}(a9_0x2618,0xe2c24));var __decorate=this&&this[a9_0x21d290(0x1cf)]||function(_0x2f6e56,_0x166ffe,_0x1e4393,_0x497741){const _0x241a71=a9_0x21d290;var _0x486b6b=arguments[_0x241a71(0x1db)],_0x429c32=_0x486b6b<0x3?_0x166ffe:_0x497741===null?_0x497741=Object[_0x241a71(0x1d8)](_0x166ffe,_0x1e4393):_0x497741,_0x3c8d5b;if(typeof Reflect===_0x241a71(0x1d4)&&typeof Reflect[_0x241a71(0x1dd)]==='function')_0x429c32=Reflect[_0x241a71(0x1dd)](_0x2f6e56,_0x166ffe,_0x1e4393,_0x497741);else{for(var _0x51d8ba=_0x2f6e56['length']-0x1;_0x51d8ba>=0x0;_0x51d8ba--)if(_0x3c8d5b=_0x2f6e56[_0x51d8ba])_0x429c32=(_0x486b6b<0x3?_0x3c8d5b(_0x429c32):_0x486b6b>0x3?_0x3c8d5b(_0x166ffe,_0x1e4393,_0x429c32):_0x3c8d5b(_0x166ffe,_0x1e4393))||_0x429c32;}return _0x486b6b>0x3&&_0x429c32&&Object[_0x241a71(0x213)](_0x166ffe,_0x1e4393,_0x429c32),_0x429c32;},__metadata=this&&this['__metadata']||function(_0x37b041,_0x3da03c){const _0x145564=a9_0x21d290;if(typeof Reflect===_0x145564(0x1d4)&&typeof Reflect['metadata']===_0x145564(0x202))return Reflect[_0x145564(0x1d7)](_0x37b041,_0x3da03c);},JobProccessor_1;Object[a9_0x21d290(0x213)](exports,a9_0x21d290(0x1ee),{'value':!![]}),exports[a9_0x21d290(0x209)]=void 0x0;function a9_0x2618(){const _0x10126e=['getSeconds','Event:\x20','Processor','Invalid\x20or\x20expired\x20license\x20key!','Job','Scheduling\x20event:\x20','jobType','agendaService','__esModule','1444454IuWxgZ','\x20-\x20','64413qtOBYZ','design:type','CheckEvent','PurgeTempUploadedFiles','cancel','ScheduleService','getMinutes','PlayTextToAudio','AuditActor','purgeTempUploadedFiles','env','prototype','AgendaService','single','design:paramtypes','schedule','46406hLqalI','function','JobType','TMP_UPLOAD_DIR','development','3546491bwPhxx','4mwQAHj','time','JobProccessor','PlayMusic','PlayVoiceRecorded','PlaySound','scheduleService','147595AzOaaT','Canceling\x20all\x20old\x20background\x20checks...','2402590wRtJpU','BackgroundJobType','data','defineProperty','613239sTmPIL','Eligible\x20schedule:\x20','\x20-\x20Schedule:\x20','isExpired','log','NODE_ENV','Server\x20time:\x20','getHours','12okEyuW','logger','name','__decorate','../setting/setting.service','Logger','setHours','Fetching\x20today\x20schedule...','object','20hVwXxG','SettingService','metadata','getOwnPropertyDescriptor','error','1336FZOMXp','length','forEach','decorate','design:returntype','Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20','events','Define','96TFPSeG','agenda','77wkIxrX','checkEvent'];a9_0x2618=function(){return _0x10126e;};return a9_0x2618();}const common_1=require('@nestjs/common'),agenda_1=require(a9_0x21d290(0x1e3)),nestjs_agenda_1=require('@agent-ly/nestjs-agenda'),enums_1=require('../common/enums'),schedule_service_1=require('../schedule/schedule.service'),setting_service_1=require(a9_0x21d290(0x1d0)),file_1=require('../common/file'),constants_1=require('../common/constants');let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x17ac29,_0x1064e9,_0x2be16d){const _0x161b99=a9_0x21d290;this[_0x161b99(0x1ed)]=_0x17ac29,this[_0x161b99(0x20d)]=_0x1064e9,this['settingService']=_0x2be16d,this[_0x161b99(0x1cd)]=new common_1[(_0x161b99(0x1d1))](JobProccessor_1[_0x161b99(0x1ce)]);}async[a9_0x21d290(0x1e5)](_0x223586){const _0x51623f=a9_0x21d290;this['logger'][_0x51623f(0x1c8)](_0x51623f(0x1ca)+new Date()+'.\x20Job:\x20'+_0x223586['attrs'][_0x51623f(0x1ce)]);const _0x2ba0ba=await this['settingService']['updateExpiryStatus']();if(_0x2ba0ba[_0x51623f(0x1c7)]){this['logger'][_0x51623f(0x1c8)](_0x51623f(0x1e9));if(process[_0x51623f(0x1fb)][_0x51623f(0x1c9)]!==_0x51623f(0x205))return;}this[_0x51623f(0x1cd)][_0x51623f(0x1c8)](_0x51623f(0x20f)),await this[_0x51623f(0x1ed)][_0x51623f(0x1f5)]({'name':{'$nin':[enums_1[_0x51623f(0x211)][_0x51623f(0x1f3)],enums_1[_0x51623f(0x211)][_0x51623f(0x1f4)]]},'type':_0x51623f(0x1fe)}),this['logger'][_0x51623f(0x1c8)](_0x51623f(0x1d3));const _0x27ab60=await this[_0x51623f(0x20d)]['findEligibleSchedule'](new Date());this[_0x51623f(0x1cd)]['log'](_0x51623f(0x1c5)+(_0x27ab60===null||_0x27ab60===void 0x0?void 0x0:_0x27ab60['name']));if(!_0x27ab60||!_0x27ab60['events']||_0x27ab60[_0x51623f(0x1e0)][_0x51623f(0x1db)]===0x0)return;_0x27ab60['events'][_0x51623f(0x1dc)](_0x25aac3=>{const _0x305cc9=_0x51623f;this[_0x305cc9(0x1cd)][_0x305cc9(0x1c8)](_0x305cc9(0x1eb)+_0x25aac3[_0x305cc9(0x208)]+_0x305cc9(0x1f0)+_0x25aac3[_0x305cc9(0x1ec)]+_0x305cc9(0x1f0)+_0x25aac3['name']);const _0x3f3f24=new Date(),_0x3e6a2f=_0x3f3f24[_0x305cc9(0x1cb)](),_0x513649=_0x3f3f24[_0x305cc9(0x1f7)](),_0x5e2851=_0x3f3f24[_0x305cc9(0x1e6)](),[_0x3ad633,_0x5969ff,_0x26482c]=_0x25aac3[_0x305cc9(0x208)]['split'](':');if(+_0x3ad633<_0x3e6a2f||+_0x3ad633===_0x3e6a2f&&+_0x5969ff<_0x513649||+_0x3ad633===_0x3e6a2f&&+_0x5969ff===_0x513649&&+_0x26482c<_0x5e2851)return;_0x3f3f24[_0x305cc9(0x1d2)](+_0x3ad633),_0x3f3f24['setMinutes'](+_0x5969ff),_0x3f3f24['setSeconds'](+_0x26482c);switch(_0x25aac3[_0x305cc9(0x1ec)]){case enums_1[_0x305cc9(0x203)][_0x305cc9(0x20c)]:{const {soundId:_0x3a7413,durationInSecond:_0x49dad9}=_0x25aac3[_0x305cc9(0x212)];if(!_0x3a7413)return;const _0x9d15e1={'soundId':_0x3a7413,'durationInSecond':_0x49dad9,'audit':{'actor':enums_1[_0x305cc9(0x1f9)][_0x305cc9(0x1ea)],'name':enums_1[_0x305cc9(0x203)][_0x305cc9(0x20c)],'message':_0x305cc9(0x1e7)+_0x25aac3[_0x305cc9(0x1ce)]+_0x305cc9(0x1c6)+_0x27ab60[_0x305cc9(0x1ce)]}};this['agendaService'][_0x305cc9(0x200)](_0x3f3f24,enums_1[_0x305cc9(0x203)]['PlaySound'],_0x9d15e1);break;}case enums_1['JobType'][_0x305cc9(0x20a)]:{const {playlistId:_0x15a38b,durationInSecond:_0xd271ea}=_0x25aac3[_0x305cc9(0x212)];if(!_0x15a38b)return;const _0xb91a2b={'playlistId':_0x15a38b,'durationInSecond':_0xd271ea,'audit':{'actor':enums_1['AuditActor']['Job'],'name':enums_1['JobType'][_0x305cc9(0x20a)],'message':_0x305cc9(0x1e7)+_0x25aac3[_0x305cc9(0x1ce)]+_0x305cc9(0x1c6)+_0x27ab60[_0x305cc9(0x1ce)]}};this[_0x305cc9(0x1ed)][_0x305cc9(0x200)](_0x3f3f24,enums_1['JobType'][_0x305cc9(0x20a)],_0xb91a2b);break;}case enums_1[_0x305cc9(0x203)][_0x305cc9(0x20b)]:{const {voiceId:_0x2fb2fc,durationInSecond:_0x16c58b}=_0x25aac3['data'];if(!_0x2fb2fc)return;const _0x1879c4={'voiceId':_0x2fb2fc,'durationInSecond':_0x16c58b,'audit':{'actor':enums_1[_0x305cc9(0x1f9)]['Job'],'name':enums_1[_0x305cc9(0x203)][_0x305cc9(0x20b)],'message':'Event:\x20'+_0x25aac3[_0x305cc9(0x1ce)]+_0x305cc9(0x1c6)+_0x27ab60[_0x305cc9(0x1ce)]}};this[_0x305cc9(0x1ed)][_0x305cc9(0x200)](_0x3f3f24,enums_1['JobType'][_0x305cc9(0x20b)],_0x1879c4);break;}case enums_1['JobType'][_0x305cc9(0x1f8)]:{const {textToAudioId:_0x1d8ed9,durationInSecond:_0x758bb1}=_0x25aac3[_0x305cc9(0x212)];if(!_0x1d8ed9)return;const _0x422b6e={'textToAudioId':_0x1d8ed9,'durationInSecond':_0x758bb1,'audit':{'actor':enums_1[_0x305cc9(0x1f9)]['Job'],'name':enums_1[_0x305cc9(0x203)][_0x305cc9(0x1f8)],'message':_0x305cc9(0x1e7)+_0x25aac3[_0x305cc9(0x1ce)]+_0x305cc9(0x1c6)+_0x27ab60[_0x305cc9(0x1ce)]}};this['agendaService'][_0x305cc9(0x200)](_0x3f3f24,enums_1[_0x305cc9(0x203)]['PlayTextToAudio'],_0x422b6e);break;}default:return;}}),this[_0x51623f(0x1cd)][_0x51623f(0x1c8)]('Events\x20scheduled!');}async[a9_0x21d290(0x1fa)](_0x33cc0d){const _0x34daf1=a9_0x21d290;this[_0x34daf1(0x1cd)]['log']('Purging\x20temp\x20uploaded\x20files...');const {success:_0x58b9e5,message:_0x2c8f0b}=await(0x0,file_1['deleteFilesInFolder'])(constants_1[_0x34daf1(0x204)]);!_0x58b9e5&&this[_0x34daf1(0x1cd)][_0x34daf1(0x1d9)](_0x34daf1(0x1df)+_0x2c8f0b);}};function a9_0xdc78(_0xe26dd2,_0x456276){const _0x2618ba=a9_0x2618();return a9_0xdc78=function(_0xdc781,_0x95a27d){_0xdc781=_0xdc781-0x1c4;let _0x1ce255=_0x2618ba[_0xdc781];return _0x1ce255;},a9_0xdc78(_0xe26dd2,_0x456276);}__decorate([(0x0,nestjs_agenda_1['Define'])(enums_1[a9_0x21d290(0x211)][a9_0x21d290(0x1f3)]),__metadata(a9_0x21d290(0x1f2),Function),__metadata(a9_0x21d290(0x1ff),[agenda_1['Job']]),__metadata(a9_0x21d290(0x1de),Promise)],JobProccessor[a9_0x21d290(0x1fc)],a9_0x21d290(0x1e5),null),__decorate([(0x0,nestjs_agenda_1[a9_0x21d290(0x1e1)])(enums_1['BackgroundJobType'][a9_0x21d290(0x1f4)]),__metadata('design:type',Function),__metadata(a9_0x21d290(0x1ff),[agenda_1[a9_0x21d290(0x1ea)]]),__metadata(a9_0x21d290(0x1de),Promise)],JobProccessor['prototype'],a9_0x21d290(0x1fa),null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x21d290(0x1e8)])(),__metadata('design:paramtypes',[nestjs_agenda_1[a9_0x21d290(0x1fd)],schedule_service_1[a9_0x21d290(0x1f6)],setting_service_1[a9_0x21d290(0x1d6)]])],JobProccessor),exports[a9_0x21d290(0x209)]=JobProccessor;