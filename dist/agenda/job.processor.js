'use strict';const a9_0x3e5c98=a9_0x2a29;(function(_0xca13c3,_0x2094a3){const _0x5e968d=a9_0x2a29,_0x2eb95c=_0xca13c3();while(!![]){try{const _0x56dcde=parseInt(_0x5e968d(0x200))/0x1*(-parseInt(_0x5e968d(0x1f9))/0x2)+-parseInt(_0x5e968d(0x1eb))/0x3+-parseInt(_0x5e968d(0x1de))/0x4+parseInt(_0x5e968d(0x217))/0x5*(-parseInt(_0x5e968d(0x1e0))/0x6)+parseInt(_0x5e968d(0x1e2))/0x7+parseInt(_0x5e968d(0x22f))/0x8*(parseInt(_0x5e968d(0x22d))/0x9)+-parseInt(_0x5e968d(0x1fd))/0xa*(-parseInt(_0x5e968d(0x20c))/0xb);if(_0x56dcde===_0x2094a3)break;else _0x2eb95c['push'](_0x2eb95c['shift']());}catch(_0x140c40){_0x2eb95c['push'](_0x2eb95c['shift']());}}}(a9_0x7707,0xba997));var __decorate=this&&this['__decorate']||function(_0x4f064e,_0x4e8e81,_0x4bd55b,_0x37c0ab){const _0x4aed33=a9_0x2a29;var _0x37da4c=arguments[_0x4aed33(0x1e8)],_0x583ec7=_0x37da4c<0x3?_0x4e8e81:_0x37c0ab===null?_0x37c0ab=Object[_0x4aed33(0x1fa)](_0x4e8e81,_0x4bd55b):_0x37c0ab,_0x2414ad;if(typeof Reflect===_0x4aed33(0x229)&&typeof Reflect[_0x4aed33(0x21d)]==='function')_0x583ec7=Reflect[_0x4aed33(0x21d)](_0x4f064e,_0x4e8e81,_0x4bd55b,_0x37c0ab);else{for(var _0xa2470d=_0x4f064e[_0x4aed33(0x1e8)]-0x1;_0xa2470d>=0x0;_0xa2470d--)if(_0x2414ad=_0x4f064e[_0xa2470d])_0x583ec7=(_0x37da4c<0x3?_0x2414ad(_0x583ec7):_0x37da4c>0x3?_0x2414ad(_0x4e8e81,_0x4bd55b,_0x583ec7):_0x2414ad(_0x4e8e81,_0x4bd55b))||_0x583ec7;}return _0x37da4c>0x3&&_0x583ec7&&Object[_0x4aed33(0x224)](_0x4e8e81,_0x4bd55b,_0x583ec7),_0x583ec7;},__metadata=this&&this[a9_0x3e5c98(0x1f1)]||function(_0x54626d,_0x2b3c06){const _0x449b3e=a9_0x3e5c98;if(typeof Reflect===_0x449b3e(0x229)&&typeof Reflect[_0x449b3e(0x213)]===_0x449b3e(0x1f5))return Reflect['metadata'](_0x54626d,_0x2b3c06);},JobProccessor_1;Object[a9_0x3e5c98(0x224)](exports,a9_0x3e5c98(0x1ef),{'value':!![]}),exports[a9_0x3e5c98(0x214)]=void 0x0;function a9_0x2a29(_0x484f94,_0x2f59fd){const _0x7707e6=a9_0x7707();return a9_0x2a29=function(_0x2a29dc,_0x404cf5){_0x2a29dc=_0x2a29dc-0x1de;let _0x46d0c9=_0x7707e6[_0x2a29dc];return _0x46d0c9;},a9_0x2a29(_0x484f94,_0x2f59fd);}const common_1=require(a9_0x3e5c98(0x1ea)),agenda_1=require(a9_0x3e5c98(0x1f4)),nestjs_agenda_1=require('@agent-ly/nestjs-agenda'),enums_1=require(a9_0x3e5c98(0x1e1)),schedule_service_1=require(a9_0x3e5c98(0x20b)),setting_service_1=require('../setting/setting.service'),file_1=require(a9_0x3e5c98(0x21a)),constants_1=require(a9_0x3e5c98(0x222));let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x35434c,_0x3f32e0,_0x40529c){const _0x3c5118=a9_0x3e5c98;this[_0x3c5118(0x228)]=_0x35434c,this['scheduleService']=_0x3f32e0,this[_0x3c5118(0x1f3)]=_0x40529c,this[_0x3c5118(0x209)]=new common_1[(_0x3c5118(0x210))](JobProccessor_1[_0x3c5118(0x205)]);}async[a9_0x3e5c98(0x1ec)](_0x4c13b2){const _0x40ad0a=a9_0x3e5c98;this[_0x40ad0a(0x209)][_0x40ad0a(0x1f8)]('Server\x20time:\x20'+new Date()+_0x40ad0a(0x202)+_0x4c13b2[_0x40ad0a(0x1fb)][_0x40ad0a(0x205)]);const _0x3c1a2e=await this[_0x40ad0a(0x1f3)][_0x40ad0a(0x1f0)]();if(_0x3c1a2e[_0x40ad0a(0x1f2)]){this['logger'][_0x40ad0a(0x1f8)]('Invalid\x20or\x20expired\x20license\x20key!');if(process[_0x40ad0a(0x20e)]['NODE_ENV']!==_0x40ad0a(0x1ed))return;}this[_0x40ad0a(0x209)][_0x40ad0a(0x1f8)](_0x40ad0a(0x1e3)),await this['agendaService'][_0x40ad0a(0x21c)]({'name':{'$nin':[enums_1[_0x40ad0a(0x1ff)]['CheckEvent'],enums_1[_0x40ad0a(0x1ff)][_0x40ad0a(0x230)]]},'type':_0x40ad0a(0x1e5)}),this[_0x40ad0a(0x209)][_0x40ad0a(0x1f8)]('Fetching\x20today\x20schedule...');const _0x389f46=await this[_0x40ad0a(0x207)]['findEligibleSchedule'](new Date());this[_0x40ad0a(0x209)]['log'](_0x40ad0a(0x201)+(_0x389f46===null||_0x389f46===void 0x0?void 0x0:_0x389f46['name']));if(!_0x389f46||!_0x389f46['events']||_0x389f46[_0x40ad0a(0x20f)]['length']===0x0)return;_0x389f46[_0x40ad0a(0x20f)][_0x40ad0a(0x22c)](_0x137aee=>{const _0x13a9d8=_0x40ad0a;this['logger'][_0x13a9d8(0x1f8)](_0x13a9d8(0x206)+_0x137aee[_0x13a9d8(0x1f7)]+_0x13a9d8(0x21b)+_0x137aee[_0x13a9d8(0x204)]+'\x20-\x20'+_0x137aee['name']);const _0xb95f81=new Date(),_0x313aba=_0xb95f81[_0x13a9d8(0x218)](),_0x185080=_0xb95f81['getMinutes'](),_0x3a7c75=_0xb95f81[_0x13a9d8(0x216)](),[_0x3dc13f,_0x17d1d6,_0x52f679]=_0x137aee[_0x13a9d8(0x1f7)][_0x13a9d8(0x215)](':');if(+_0x3dc13f<_0x313aba||+_0x3dc13f===_0x313aba&&+_0x17d1d6<_0x185080||+_0x3dc13f===_0x313aba&&+_0x17d1d6===_0x185080&&+_0x52f679<_0x3a7c75)return;_0xb95f81[_0x13a9d8(0x223)](+_0x3dc13f),_0xb95f81[_0x13a9d8(0x221)](+_0x17d1d6),_0xb95f81[_0x13a9d8(0x226)](+_0x52f679);switch(_0x137aee[_0x13a9d8(0x204)]){case enums_1[_0x13a9d8(0x1fe)][_0x13a9d8(0x220)]:{const {soundId:_0x3dc7c2,durationInSecond:_0x518efe}=_0x137aee[_0x13a9d8(0x232)];if(!_0x3dc7c2)return;const _0x487b30={'soundId':_0x3dc7c2,'durationInSecond':_0x518efe,'audit':{'actor':enums_1[_0x13a9d8(0x219)][_0x13a9d8(0x1fc)],'name':enums_1[_0x13a9d8(0x1fe)][_0x13a9d8(0x220)],'message':_0x13a9d8(0x20a)+_0x137aee[_0x13a9d8(0x205)]+'\x20-\x20Schedule:\x20'+_0x389f46[_0x13a9d8(0x205)]}};this[_0x13a9d8(0x228)]['schedule'](_0xb95f81,enums_1[_0x13a9d8(0x1fe)][_0x13a9d8(0x220)],_0x487b30);break;}case enums_1['JobType'][_0x13a9d8(0x22e)]:{const {playlistId:_0x68928e,durationInSecond:_0x257196}=_0x137aee['data'];if(!_0x68928e)return;const _0x3fe542={'playlistId':_0x68928e,'durationInSecond':_0x257196,'audit':{'actor':enums_1['AuditActor'][_0x13a9d8(0x1fc)],'name':enums_1[_0x13a9d8(0x1fe)]['PlayMusic'],'message':_0x13a9d8(0x20a)+_0x137aee[_0x13a9d8(0x205)]+_0x13a9d8(0x20d)+_0x389f46[_0x13a9d8(0x205)]}};this[_0x13a9d8(0x228)][_0x13a9d8(0x21f)](_0xb95f81,enums_1[_0x13a9d8(0x1fe)][_0x13a9d8(0x22e)],_0x3fe542);break;}case enums_1['JobType']['PlayVoiceRecorded']:{const {voiceId:_0x28af75,durationInSecond:_0x310481}=_0x137aee[_0x13a9d8(0x232)];if(!_0x28af75)return;const _0x14624b={'voiceId':_0x28af75,'durationInSecond':_0x310481,'audit':{'actor':enums_1[_0x13a9d8(0x219)][_0x13a9d8(0x1fc)],'name':enums_1[_0x13a9d8(0x1fe)][_0x13a9d8(0x1e4)],'message':_0x13a9d8(0x20a)+_0x137aee[_0x13a9d8(0x205)]+_0x13a9d8(0x20d)+_0x389f46[_0x13a9d8(0x205)]}};this['agendaService'][_0x13a9d8(0x21f)](_0xb95f81,enums_1['JobType'][_0x13a9d8(0x1e4)],_0x14624b);break;}case enums_1[_0x13a9d8(0x1fe)]['PlayTextToAudio']:{const {textToAudioId:_0x378b92,durationInSecond:_0x4bf2e0}=_0x137aee[_0x13a9d8(0x232)];if(!_0x378b92)return;const _0x2cb152={'textToAudioId':_0x378b92,'durationInSecond':_0x4bf2e0,'audit':{'actor':enums_1['AuditActor'][_0x13a9d8(0x1fc)],'name':enums_1[_0x13a9d8(0x1fe)]['PlayTextToAudio'],'message':_0x13a9d8(0x20a)+_0x137aee[_0x13a9d8(0x205)]+'\x20-\x20Schedule:\x20'+_0x389f46[_0x13a9d8(0x205)]}};this[_0x13a9d8(0x228)][_0x13a9d8(0x21f)](_0xb95f81,enums_1[_0x13a9d8(0x1fe)]['PlayTextToAudio'],_0x2cb152);break;}default:return;}}),this[_0x40ad0a(0x209)][_0x40ad0a(0x1f8)](_0x40ad0a(0x21e));}async[a9_0x3e5c98(0x227)](_0x2fdbb9){const _0x1775d8=a9_0x3e5c98;this['logger']['log'](_0x1775d8(0x211));const {success:_0x2a43f9,message:_0x3dcbae}=await(0x0,file_1[_0x1775d8(0x1ee)])(constants_1[_0x1775d8(0x1df)]);!_0x2a43f9&&this['logger'][_0x1775d8(0x208)](_0x1775d8(0x22b)+_0x3dcbae);}};__decorate([(0x0,nestjs_agenda_1[a9_0x3e5c98(0x1e9)])(enums_1[a9_0x3e5c98(0x1ff)][a9_0x3e5c98(0x212)]),__metadata(a9_0x3e5c98(0x203),Function),__metadata('design:paramtypes',[agenda_1[a9_0x3e5c98(0x1fc)]]),__metadata(a9_0x3e5c98(0x1f6),Promise)],JobProccessor[a9_0x3e5c98(0x1e7)],a9_0x3e5c98(0x1ec),null),__decorate([(0x0,nestjs_agenda_1[a9_0x3e5c98(0x1e9)])(enums_1[a9_0x3e5c98(0x1ff)][a9_0x3e5c98(0x230)]),__metadata(a9_0x3e5c98(0x203),Function),__metadata(a9_0x3e5c98(0x231),[agenda_1['Job']]),__metadata(a9_0x3e5c98(0x1f6),Promise)],JobProccessor[a9_0x3e5c98(0x1e7)],a9_0x3e5c98(0x227),null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x3e5c98(0x225)])(),__metadata(a9_0x3e5c98(0x231),[nestjs_agenda_1[a9_0x3e5c98(0x1e6)],schedule_service_1['ScheduleService'],setting_service_1[a9_0x3e5c98(0x22a)]])],JobProccessor),exports['JobProccessor']=JobProccessor;function a9_0x7707(){const _0x5c4359=['function','design:returntype','time','log','2810gikEBs','getOwnPropertyDescriptor','attrs','Job','10GdzOkN','JobType','BackgroundJobType','5CiTMiI','Eligible\x20schedule:\x20','.\x20Job:\x20','design:type','jobType','name','Scheduling\x20event:\x20','scheduleService','error','logger','Event:\x20','../schedule/schedule.service','22571934jWknyv','\x20-\x20Schedule:\x20','env','events','Logger','Purging\x20temp\x20uploaded\x20files...','CheckEvent','metadata','JobProccessor','split','getSeconds','5295245ZSLSRE','getHours','AuditActor','../common/file','\x20-\x20','cancel','decorate','Events\x20scheduled!','schedule','PlaySound','setMinutes','../common/constants','setHours','defineProperty','Processor','setSeconds','purgeTempUploadedFiles','agendaService','object','SettingService','Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20','forEach','6443127cJMuEG','PlayMusic','16zNqnTt','PurgeTempUploadedFiles','design:paramtypes','data','4139764YbNjZc','TMP_UPLOAD_DIR','6wKgcXD','../common/enums','2784320yUsgnh','Canceling\x20all\x20old\x20background\x20checks...','PlayVoiceRecorded','single','AgendaService','prototype','length','Define','@nestjs/common','3048702QJBwvo','checkEvent','development','deleteFilesInFolder','__esModule','updateExpiryStatus','__metadata','isExpired','settingService','agenda'];a9_0x7707=function(){return _0x5c4359;};return a9_0x7707();}