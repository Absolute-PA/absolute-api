'use strict';function a9_0x5c1e(_0x244829,_0x846178){const _0x4f80d9=a9_0x4f80();return a9_0x5c1e=function(_0x5c1e45,_0x4ec770){_0x5c1e45=_0x5c1e45-0xa0;let _0x5c1ec0=_0x4f80d9[_0x5c1e45];return _0x5c1ec0;},a9_0x5c1e(_0x244829,_0x846178);}function a9_0x4f80(){const _0x22dab8=['CheckEvent','findEligibleSchedule','logger','SettingService','split','828744SdTSkw','1452440mAjTsW','design:type','JobType','BackgroundJobType','checkEvent','agendaService','cancel','Invalid\x20or\x20expired\x20license\x20key!','prototype','settingService','AuditActor','jobType','data','PlayVoiceRecorded','../common/enums','__decorate','AgendaService','updateExpiryStatus','@nestjs/common','setMinutes','getSeconds','design:returntype','decorate','../schedule/schedule.service','Processor','deleteFilesInFolder','1194048OyYFQn','PurgeTempUploadedFiles','Job','single','PlayTextToAudio','defineProperty','name','JobProccessor','isExpired','purgeTempUploadedFiles','forEach','events','PlayMusic','Purging\x20temp\x20uploaded\x20files...','Define','Server\x20time:\x20','length','schedule','getMinutes','log','object','1151490KIFcwn','getHours','Fetching\x20today\x20schedule...','.\x20Job:\x20','Events\x20scheduled!','ScheduleService','agenda','1743175JBlcuT','9fbbMAq','development','setHours','\x20-\x20Schedule:\x20','__metadata','metadata','PlaySound','3418728oCcpVt','scheduleService','attrs','Canceling\x20all\x20old\x20background\x20checks...','time','design:paramtypes','error','Event:\x20','../common/constants','@agent-ly/nestjs-agenda','function','6103671SkKPSy'];a9_0x4f80=function(){return _0x22dab8;};return a9_0x4f80();}const a9_0x9363db=a9_0x5c1e;(function(_0x27e6c2,_0x534920){const _0x5cb882=a9_0x5c1e,_0x2a55cb=_0x27e6c2();while(!![]){try{const _0x5ee62d=parseInt(_0x5cb882(0xc0))/0x1+-parseInt(_0x5cb882(0xd5))/0x2+parseInt(_0x5cb882(0xdd))/0x3*(-parseInt(_0x5cb882(0xa6))/0x4)+-parseInt(_0x5cb882(0xdc))/0x5+parseInt(_0x5cb882(0xa5))/0x6+parseInt(_0x5cb882(0xef))/0x7+parseInt(_0x5cb882(0xe4))/0x8;if(_0x5ee62d===_0x534920)break;else _0x2a55cb['push'](_0x2a55cb['shift']());}catch(_0x5ecd3f){_0x2a55cb['push'](_0x2a55cb['shift']());}}}(a9_0x4f80,0x96d1c));var __decorate=this&&this[a9_0x9363db(0xb5)]||function(_0xd4199e,_0x34025f,_0x21cad6,_0x2249a0){const _0xbbed55=a9_0x9363db;var _0x21bd47=arguments[_0xbbed55(0xd0)],_0xd4408f=_0x21bd47<0x3?_0x34025f:_0x2249a0===null?_0x2249a0=Object['getOwnPropertyDescriptor'](_0x34025f,_0x21cad6):_0x2249a0,_0xc4ef19;if(typeof Reflect===_0xbbed55(0xd4)&&typeof Reflect[_0xbbed55(0xbc)]===_0xbbed55(0xee))_0xd4408f=Reflect[_0xbbed55(0xbc)](_0xd4199e,_0x34025f,_0x21cad6,_0x2249a0);else{for(var _0x23afe1=_0xd4199e['length']-0x1;_0x23afe1>=0x0;_0x23afe1--)if(_0xc4ef19=_0xd4199e[_0x23afe1])_0xd4408f=(_0x21bd47<0x3?_0xc4ef19(_0xd4408f):_0x21bd47>0x3?_0xc4ef19(_0x34025f,_0x21cad6,_0xd4408f):_0xc4ef19(_0x34025f,_0x21cad6))||_0xd4408f;}return _0x21bd47>0x3&&_0xd4408f&&Object[_0xbbed55(0xc5)](_0x34025f,_0x21cad6,_0xd4408f),_0xd4408f;},__metadata=this&&this[a9_0x9363db(0xe1)]||function(_0x1397a4,_0x2bd8af){const _0x217883=a9_0x9363db;if(typeof Reflect===_0x217883(0xd4)&&typeof Reflect[_0x217883(0xe2)]===_0x217883(0xee))return Reflect[_0x217883(0xe2)](_0x1397a4,_0x2bd8af);},JobProccessor_1;Object[a9_0x9363db(0xc5)](exports,'__esModule',{'value':!![]}),exports[a9_0x9363db(0xc7)]=void 0x0;const common_1=require(a9_0x9363db(0xb8)),agenda_1=require(a9_0x9363db(0xdb)),nestjs_agenda_1=require(a9_0x9363db(0xed)),enums_1=require(a9_0x9363db(0xb4)),schedule_service_1=require(a9_0x9363db(0xbd)),setting_service_1=require('../setting/setting.service'),file_1=require('../common/file'),constants_1=require(a9_0x9363db(0xec));let JobProccessor=JobProccessor_1=class JobProccessor{constructor(_0x35064c,_0x1a1c0c,_0x2bcfa4){const _0x3c0fef=a9_0x9363db;this['agendaService']=_0x35064c,this[_0x3c0fef(0xe5)]=_0x1a1c0c,this['settingService']=_0x2bcfa4,this[_0x3c0fef(0xa2)]=new common_1['Logger'](JobProccessor_1[_0x3c0fef(0xc6)]);}async[a9_0x9363db(0xaa)](_0x38cd3c){const _0x482d73=a9_0x9363db;this[_0x482d73(0xa2)][_0x482d73(0xd3)](_0x482d73(0xcf)+new Date()+_0x482d73(0xd8)+_0x38cd3c[_0x482d73(0xe6)][_0x482d73(0xc6)]);const _0x34e1b8=await this[_0x482d73(0xaf)][_0x482d73(0xb7)]();if(_0x34e1b8[_0x482d73(0xc8)]){this[_0x482d73(0xa2)][_0x482d73(0xd3)](_0x482d73(0xad));if(process['env']['NODE_ENV']!==_0x482d73(0xde))return;}this[_0x482d73(0xa2)][_0x482d73(0xd3)](_0x482d73(0xe7)),await this[_0x482d73(0xab)][_0x482d73(0xac)]({'name':{'$nin':[enums_1[_0x482d73(0xa9)][_0x482d73(0xa0)],enums_1[_0x482d73(0xa9)][_0x482d73(0xc1)]]},'type':_0x482d73(0xc3)}),this[_0x482d73(0xa2)][_0x482d73(0xd3)](_0x482d73(0xd7));const _0x16c27f=await this[_0x482d73(0xe5)][_0x482d73(0xa1)](new Date());this[_0x482d73(0xa2)][_0x482d73(0xd3)]('Eligible\x20schedule:\x20'+(_0x16c27f===null||_0x16c27f===void 0x0?void 0x0:_0x16c27f[_0x482d73(0xc6)]));if(!_0x16c27f||!_0x16c27f[_0x482d73(0xcb)]||_0x16c27f[_0x482d73(0xcb)][_0x482d73(0xd0)]===0x0)return;_0x16c27f[_0x482d73(0xcb)][_0x482d73(0xca)](_0x2ff5d4=>{const _0x451927=_0x482d73;this[_0x451927(0xa2)][_0x451927(0xd3)]('Scheduling\x20event:\x20'+_0x2ff5d4['time']+'\x20-\x20'+_0x2ff5d4[_0x451927(0xb1)]+'\x20-\x20'+_0x2ff5d4[_0x451927(0xc6)]);const _0x344d20=new Date(),_0xd0627d=_0x344d20[_0x451927(0xd6)](),_0x36207f=_0x344d20[_0x451927(0xd2)](),_0x2725b7=_0x344d20[_0x451927(0xba)](),[_0x2df502,_0x386d8d,_0x42e4e4]=_0x2ff5d4[_0x451927(0xe8)][_0x451927(0xa4)](':');if(+_0x2df502<_0xd0627d||+_0x2df502===_0xd0627d&&+_0x386d8d<_0x36207f||+_0x2df502===_0xd0627d&&+_0x386d8d===_0x36207f&&+_0x42e4e4<_0x2725b7)return;_0x344d20[_0x451927(0xdf)](+_0x2df502),_0x344d20[_0x451927(0xb9)](+_0x386d8d),_0x344d20['setSeconds'](+_0x42e4e4);switch(_0x2ff5d4[_0x451927(0xb1)]){case enums_1[_0x451927(0xa8)][_0x451927(0xe3)]:{const {soundId:_0xcbb210,durationInSecond:_0x4e0a0f}=_0x2ff5d4[_0x451927(0xb2)];if(!_0xcbb210)return;const _0x7cc8c8={'soundId':_0xcbb210,'durationInSecond':_0x4e0a0f,'audit':{'actor':enums_1[_0x451927(0xb0)][_0x451927(0xc2)],'name':enums_1[_0x451927(0xa8)][_0x451927(0xe3)],'message':_0x451927(0xeb)+_0x2ff5d4[_0x451927(0xc6)]+_0x451927(0xe0)+_0x16c27f['name']}};this[_0x451927(0xab)][_0x451927(0xd1)](_0x344d20,enums_1[_0x451927(0xa8)]['PlaySound'],_0x7cc8c8);break;}case enums_1['JobType'][_0x451927(0xcc)]:{const {playlistId:_0x46479e,durationInSecond:_0x58fca8}=_0x2ff5d4['data'];if(!_0x46479e)return;const _0x3c21cb={'playlistId':_0x46479e,'durationInSecond':_0x58fca8,'audit':{'actor':enums_1['AuditActor']['Job'],'name':enums_1[_0x451927(0xa8)]['PlayMusic'],'message':_0x451927(0xeb)+_0x2ff5d4[_0x451927(0xc6)]+_0x451927(0xe0)+_0x16c27f['name']}};this[_0x451927(0xab)]['schedule'](_0x344d20,enums_1[_0x451927(0xa8)]['PlayMusic'],_0x3c21cb);break;}case enums_1[_0x451927(0xa8)][_0x451927(0xb3)]:{const {voiceId:_0x362744,durationInSecond:_0x439596}=_0x2ff5d4[_0x451927(0xb2)];if(!_0x362744)return;const _0x2671f6={'voiceId':_0x362744,'durationInSecond':_0x439596,'audit':{'actor':enums_1['AuditActor'][_0x451927(0xc2)],'name':enums_1['JobType']['PlayVoiceRecorded'],'message':_0x451927(0xeb)+_0x2ff5d4[_0x451927(0xc6)]+_0x451927(0xe0)+_0x16c27f[_0x451927(0xc6)]}};this[_0x451927(0xab)]['schedule'](_0x344d20,enums_1['JobType'][_0x451927(0xb3)],_0x2671f6);break;}case enums_1[_0x451927(0xa8)][_0x451927(0xc4)]:{const {textToAudioId:_0x4a38ec,durationInSecond:_0x2114e6}=_0x2ff5d4[_0x451927(0xb2)];if(!_0x4a38ec)return;const _0x48f9d5={'textToAudioId':_0x4a38ec,'durationInSecond':_0x2114e6,'audit':{'actor':enums_1[_0x451927(0xb0)][_0x451927(0xc2)],'name':enums_1['JobType'][_0x451927(0xc4)],'message':_0x451927(0xeb)+_0x2ff5d4[_0x451927(0xc6)]+'\x20-\x20Schedule:\x20'+_0x16c27f[_0x451927(0xc6)]}};this[_0x451927(0xab)][_0x451927(0xd1)](_0x344d20,enums_1['JobType'][_0x451927(0xc4)],_0x48f9d5);break;}default:return;}}),this[_0x482d73(0xa2)][_0x482d73(0xd3)](_0x482d73(0xd9));}async[a9_0x9363db(0xc9)](_0x485b18){const _0x55c08c=a9_0x9363db;this[_0x55c08c(0xa2)][_0x55c08c(0xd3)](_0x55c08c(0xcd));const {success:_0x427bd1,message:_0x1116ad}=await(0x0,file_1[_0x55c08c(0xbf)])(constants_1['TMP_UPLOAD_DIR']);!_0x427bd1&&this[_0x55c08c(0xa2)][_0x55c08c(0xea)]('Failed\x20to\x20purge\x20temp\x20uploaded\x20files:\x20'+_0x1116ad);}};__decorate([(0x0,nestjs_agenda_1[a9_0x9363db(0xce)])(enums_1[a9_0x9363db(0xa9)][a9_0x9363db(0xa0)]),__metadata(a9_0x9363db(0xa7),Function),__metadata(a9_0x9363db(0xe9),[agenda_1[a9_0x9363db(0xc2)]]),__metadata(a9_0x9363db(0xbb),Promise)],JobProccessor['prototype'],a9_0x9363db(0xaa),null),__decorate([(0x0,nestjs_agenda_1[a9_0x9363db(0xce)])(enums_1['BackgroundJobType']['PurgeTempUploadedFiles']),__metadata('design:type',Function),__metadata('design:paramtypes',[agenda_1[a9_0x9363db(0xc2)]]),__metadata(a9_0x9363db(0xbb),Promise)],JobProccessor[a9_0x9363db(0xae)],'purgeTempUploadedFiles',null),JobProccessor=JobProccessor_1=__decorate([(0x0,nestjs_agenda_1[a9_0x9363db(0xbe)])(),__metadata('design:paramtypes',[nestjs_agenda_1[a9_0x9363db(0xb6)],schedule_service_1[a9_0x9363db(0xda)],setting_service_1[a9_0x9363db(0xa3)]])],JobProccessor),exports[a9_0x9363db(0xc7)]=JobProccessor;