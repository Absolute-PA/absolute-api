'use strict';const a141_0x46a3d4=a141_0x54bc;(function(_0x29174f,_0x12ec90){const _0xfb1278=a141_0x54bc,_0x2f3773=_0x29174f();while(!![]){try{const _0x24a9a9=-parseInt(_0xfb1278(0x101))/0x1*(-parseInt(_0xfb1278(0x115))/0x2)+-parseInt(_0xfb1278(0xd2))/0x3*(parseInt(_0xfb1278(0xef))/0x4)+-parseInt(_0xfb1278(0x113))/0x5+parseInt(_0xfb1278(0xf4))/0x6*(parseInt(_0xfb1278(0xf5))/0x7)+parseInt(_0xfb1278(0xe2))/0x8+-parseInt(_0xfb1278(0xdd))/0x9+parseInt(_0xfb1278(0xdc))/0xa*(parseInt(_0xfb1278(0x114))/0xb);if(_0x24a9a9===_0x12ec90)break;else _0x2f3773['push'](_0x2f3773['shift']());}catch(_0x248750){_0x2f3773['push'](_0x2f3773['shift']());}}}(a141_0x4960,0x4165e));var __decorate=this&&this[a141_0x46a3d4(0xed)]||function(_0x4f6d3c,_0x1183fd,_0x437bc6,_0x18b8f1){const _0x5a2534=a141_0x46a3d4;var _0x1ea6b8=arguments[_0x5a2534(0x112)],_0x209332=_0x1ea6b8<0x3?_0x1183fd:_0x18b8f1===null?_0x18b8f1=Object['getOwnPropertyDescriptor'](_0x1183fd,_0x437bc6):_0x18b8f1,_0x5926b2;if(typeof Reflect===_0x5a2534(0xe0)&&typeof Reflect[_0x5a2534(0x111)]===_0x5a2534(0xe7))_0x209332=Reflect[_0x5a2534(0x111)](_0x4f6d3c,_0x1183fd,_0x437bc6,_0x18b8f1);else{for(var _0x2044a4=_0x4f6d3c['length']-0x1;_0x2044a4>=0x0;_0x2044a4--)if(_0x5926b2=_0x4f6d3c[_0x2044a4])_0x209332=(_0x1ea6b8<0x3?_0x5926b2(_0x209332):_0x1ea6b8>0x3?_0x5926b2(_0x1183fd,_0x437bc6,_0x209332):_0x5926b2(_0x1183fd,_0x437bc6))||_0x209332;}return _0x1ea6b8>0x3&&_0x209332&&Object[_0x5a2534(0xfc)](_0x1183fd,_0x437bc6,_0x209332),_0x209332;},__metadata=this&&this['__metadata']||function(_0x190ec4,_0x28afc5){const _0x503958=a141_0x46a3d4;if(typeof Reflect===_0x503958(0xe0)&&typeof Reflect[_0x503958(0xe9)]===_0x503958(0xe7))return Reflect[_0x503958(0xe9)](_0x190ec4,_0x28afc5);},StreamingService_1;Object[a141_0x46a3d4(0xfc)](exports,a141_0x46a3d4(0x100),{'value':!![]}),exports['StreamingService']=void 0x0;const common_1=require(a141_0x46a3d4(0xf2)),child_process_1=require(a141_0x46a3d4(0xd8)),fs_1=require('fs'),puppeteer_1=require(a141_0x46a3d4(0xec)),streaming_gateway_1=require(a141_0x46a3d4(0xe1)),user_service_1=require(a141_0x46a3d4(0xd6)),jwt_1=require(a141_0x46a3d4(0x10a));function a141_0x54bc(_0x362790,_0x1cf7ea){const _0x496081=a141_0x4960();return a141_0x54bc=function(_0x54bcc5,_0x176b2e){_0x54bcc5=_0x54bcc5-0xcb;let _0x4a882e=_0x496081[_0x54bcc5];return _0x4a882e;},a141_0x54bc(_0x362790,_0x1cf7ea);}function a141_0x4960(){const _0x192339=['userService','defineProperty','code','openNewpage','env','__esModule','7723vvQEaN','prototype','jwtService','JwtService','spawn','stderr\x20data:\x20','createStreamFromFile','stdout','setCookie','@nestjs/jwt','design:type','openServerUIStream','UserService','design:paramtypes','EPIPE','stdin','decorate','length','2396350WnQsjc','1133253KabYqe','44SvIxix','Inject','mpg123','log','error','Server\x20stream\x20browser\x20already\x20open','page','body','256317ymBJlU','close','Error\x20when\x20open\x20page','streamingGateway','../user/user.service','playStreamAudioAsync','child_process','stopStreamAudio','closeServerUIStream','reconnectPeer','100LXkPiv','3488076GjgxrK','includes','focus','object','./streaming.gateway','1112328ipnDeD','Error\x20when\x20close\x20page','spawnMpgPlayer','grep\x20process\x20exited\x20with\x20code\x20','getMasterUserAccessToken','function','kill','metadata','data','logger','../helpers/puppeteer','__decorate','browser','20QcyxBr','accessToken','stderr','@nestjs/common','pipe','1336332gHUmuj','7CpZjYv','STREAM_SERVER_URL','childProcess','stdout\x20data:\x20','StreamingGateway','exit'];a141_0x4960=function(){return _0x192339;};return a141_0x4960();}let StreamingService=StreamingService_1=class StreamingService{constructor(_0x4aa0cc,_0x4f4af2){const _0x3c2943=a141_0x46a3d4;this['userService']=_0x4aa0cc,this[_0x3c2943(0x103)]=_0x4f4af2,this['logger']=new common_1['Logger'](StreamingService_1['name']);}[a141_0x46a3d4(0xe4)](){const _0x15305e=a141_0x46a3d4;if(!this[_0x15305e(0xf7)])this[_0x15305e(0xf7)]=(0x0,child_process_1[_0x15305e(0x105)])(_0x15305e(0xcc),['-']);}async['playStreamAudio'](_0x5b15c8){const _0x3d436e=a141_0x46a3d4;this[_0x3d436e(0xe4)](),_0x5b15c8['pipe'](this[_0x3d436e(0xf7)][_0x3d436e(0x110)]),this['childProcess'][_0x3d436e(0x108)]['on']('error',_0x26fea8=>{const _0x40c1a9=_0x3d436e;_0x26fea8[_0x40c1a9(0xfd)]==_0x40c1a9(0x10f)&&process['exit'](0x0);}),this[_0x3d436e(0xf7)][_0x3d436e(0x110)]['on'](_0x3d436e(0xce),_0x54f14f=>{const _0x5933bb=_0x3d436e;this[_0x5933bb(0xeb)][_0x5933bb(0xcd)](_0x54f14f);}),this['childProcess'][_0x3d436e(0x108)]['on']('data',_0xad425f=>{const _0x2c45ea=_0x3d436e;this[_0x2c45ea(0xeb)]['log']('stdout\x20data:\x20'+_0xad425f);}),this[_0x3d436e(0xf7)][_0x3d436e(0xf1)]['on']('data',_0x22fb9a=>{const _0x52323d=_0x3d436e;this['logger'][_0x52323d(0xcd)](_0x52323d(0x106)+_0x22fb9a);}),this[_0x3d436e(0xf7)]['on']('exit',_0x1ec5b9=>{const _0x3143be=_0x3d436e;this['logger'][_0x3143be(0xcd)]('exit'),this[_0x3143be(0xf7)][_0x3143be(0xe8)](),this['childProcess']=null,_0x1ec5b9!==0x0&&this[_0x3143be(0xeb)][_0x3143be(0xcd)](_0x3143be(0xe5)+_0x1ec5b9);});return;}[a141_0x46a3d4(0xd7)](_0x7a9a0e){const _0xea680c=a141_0x46a3d4,_0x56ed1=new Promise((_0xf466fd,_0x2ec2b8)=>{const _0x22049a=a141_0x54bc;this[_0x22049a(0xe4)](),_0x7a9a0e[_0x22049a(0xf3)](this[_0x22049a(0xf7)][_0x22049a(0x110)]),this[_0x22049a(0xf7)][_0x22049a(0x108)]['on'](_0x22049a(0xce),_0x574642=>{const _0x5d94b3=_0x22049a;_0x574642[_0x5d94b3(0xfd)]=='EPIPE'&&process[_0x5d94b3(0xfa)](0x0);}),this['childProcess'][_0x22049a(0x110)]['on'](_0x22049a(0xce),_0x1c64f5=>{const _0x52b09b=_0x22049a;this['logger'][_0x52b09b(0xcd)](_0x1c64f5);}),this[_0x22049a(0xf7)][_0x22049a(0x108)]['on']('data',_0x4da0f8=>{const _0x24fad1=_0x22049a;this['logger'][_0x24fad1(0xcd)](_0x24fad1(0xf8)+_0x4da0f8);}),this[_0x22049a(0xf7)][_0x22049a(0xf1)]['on'](_0x22049a(0xea),_0x378132=>{const _0x454e95=_0x22049a;this[_0x454e95(0xeb)]['log'](_0x454e95(0x106)+_0x378132);}),this[_0x22049a(0xf7)]['on'](_0x22049a(0xfa),_0x20dc9f=>{const _0x27e357=_0x22049a;_0xf466fd(!![]),this[_0x27e357(0xeb)][_0x27e357(0xcd)](_0x27e357(0xfa)),this[_0x27e357(0xf7)][_0x27e357(0xe8)](),this['childProcess']=null,_0x20dc9f!==0x0&&this[_0x27e357(0xeb)][_0x27e357(0xcd)](_0x27e357(0xe5)+_0x20dc9f);});});return{'process':this[_0xea680c(0xf7)],'promise':_0x56ed1};}[a141_0x46a3d4(0x107)](_0x448b35){return(0x0,fs_1['createReadStream'])(_0x448b35);}async[a141_0x46a3d4(0xd9)](){const _0x22ef50=a141_0x46a3d4;this[_0x22ef50(0xf7)][_0x22ef50(0xe8)]();}async[a141_0x46a3d4(0x10c)](){const _0x5065ff=a141_0x46a3d4;try{const _0x1548d2=process[_0x5065ff(0xff)]['STREAM_SERVER_URL']+'/stream';!this[_0x5065ff(0xee)]&&(this[_0x5065ff(0xee)]=await(0x0,puppeteer_1['launchBrowser'])());const _0x58721e=await(0x0,puppeteer_1['getBrowserUrls'])(this[_0x5065ff(0xee)]);if(_0x58721e[_0x5065ff(0xde)](_0x1548d2)){console[_0x5065ff(0xcd)](_0x5065ff(0xcf)),this[_0x5065ff(0xd5)][_0x5065ff(0xdb)]();return;}const _0x57082d=this[_0x5065ff(0xd0)]||await(0x0,puppeteer_1[_0x5065ff(0xfe)])(this[_0x5065ff(0xee)]),_0x4feeb2=await this[_0x5065ff(0xfb)][_0x5065ff(0xe6)]();await _0x57082d[_0x5065ff(0x109)]({'name':_0x5065ff(0xf0),'url':process['env'][_0x5065ff(0xf6)],'value':_0x4feeb2}),await _0x57082d['goto'](_0x1548d2),await _0x57082d[_0x5065ff(0xdf)](_0x5065ff(0xd1));}catch(_0x388175){console['log'](_0x388175,_0x5065ff(0xd4));}}async[a141_0x46a3d4(0xda)](){const _0x2bc81b=a141_0x46a3d4;try{this[_0x2bc81b(0xd0)]&&(await this[_0x2bc81b(0xd0)][_0x2bc81b(0xd3)](),this[_0x2bc81b(0xd0)]=null);}catch(_0xe688c4){console['log'](_0xe688c4,_0x2bc81b(0xe3));}}};__decorate([(0x0,common_1[a141_0x46a3d4(0xcb)])(streaming_gateway_1['StreamingGateway']),__metadata(a141_0x46a3d4(0x10b),streaming_gateway_1[a141_0x46a3d4(0xf9)])],StreamingService[a141_0x46a3d4(0x102)],a141_0x46a3d4(0xd5),void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(a141_0x46a3d4(0x10e),[user_service_1[a141_0x46a3d4(0x10d)],jwt_1[a141_0x46a3d4(0x104)]])],StreamingService),exports['StreamingService']=StreamingService;