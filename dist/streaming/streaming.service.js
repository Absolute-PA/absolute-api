'use strict';function a138_0x19da(){const _0x3f0ba5=['33515KrHPzv','pipe','createReadStream','log','getOwnPropertyDescriptor','function','closeServerUIStream','prototype','length','__esModule','stdout','41043QcvFkO','code','openNewpage','stderr\x20data:\x20','playStreamAudioAsync','stopStreamAudio','child_process','exit','reconnectPeer','StreamingGateway','stdin','spawnMpgPlayer','focus','jwtService','7sRydZH','UserService','@nestjs/jwt','762376zjzvsb','114YIumiw','error','/stream','decorate','createStreamFromFile','grep\x20process\x20exited\x20with\x20code\x20','setCookie','126382uDONNc','name','logger','getBrowserUrls','JwtService','spawn','458352VvPZTL','Logger','playStreamAudio','openServerUIStream','STREAM_SERVER_URL','defineProperty','837903AIWRVk','Inject','close','__decorate','getMasterUserAccessToken','childProcess','data','object','stdout\x20data:\x20','stderr','Injectable','env','9Oexktt','Error\x20when\x20open\x20page','kill','streamingGateway','970590hNBwDo','browser','mpg123','EPIPE','launchBrowser','9TlRzgo','design:type','userService','page'];a138_0x19da=function(){return _0x3f0ba5;};return a138_0x19da();}const a138_0x3bcd19=a138_0x21fa;(function(_0x594bf7,_0x4daf3b){const _0x2b1d54=a138_0x21fa,_0x340d53=_0x594bf7();while(!![]){try{const _0x3419a8=parseInt(_0x2b1d54(0x156))/0x1+parseInt(_0x2b1d54(0x16f))/0x2*(parseInt(_0x2b1d54(0x187))/0x3)+parseInt(_0x2b1d54(0x175))/0x4+-parseInt(_0x2b1d54(0x194))/0x5*(parseInt(_0x2b1d54(0x168))/0x6)+parseInt(_0x2b1d54(0x164))/0x7*(-parseInt(_0x2b1d54(0x167))/0x8)+parseInt(_0x2b1d54(0x190))/0x9*(-parseInt(_0x2b1d54(0x18b))/0xa)+parseInt(_0x2b1d54(0x17b))/0xb;if(_0x3419a8===_0x4daf3b)break;else _0x340d53['push'](_0x340d53['shift']());}catch(_0x4fd66e){_0x340d53['push'](_0x340d53['shift']());}}}(a138_0x19da,0x18d20));var __decorate=this&&this[a138_0x3bcd19(0x17e)]||function(_0x40c585,_0x5286b3,_0x3e0d60,_0x4930df){const _0x4c1db3=a138_0x3bcd19;var _0x4a9abc=arguments[_0x4c1db3(0x19c)],_0x1cb28f=_0x4a9abc<0x3?_0x5286b3:_0x4930df===null?_0x4930df=Object[_0x4c1db3(0x198)](_0x5286b3,_0x3e0d60):_0x4930df,_0xfb86dd;if(typeof Reflect===_0x4c1db3(0x182)&&typeof Reflect[_0x4c1db3(0x16b)]===_0x4c1db3(0x199))_0x1cb28f=Reflect['decorate'](_0x40c585,_0x5286b3,_0x3e0d60,_0x4930df);else{for(var _0x49006d=_0x40c585[_0x4c1db3(0x19c)]-0x1;_0x49006d>=0x0;_0x49006d--)if(_0xfb86dd=_0x40c585[_0x49006d])_0x1cb28f=(_0x4a9abc<0x3?_0xfb86dd(_0x1cb28f):_0x4a9abc>0x3?_0xfb86dd(_0x5286b3,_0x3e0d60,_0x1cb28f):_0xfb86dd(_0x5286b3,_0x3e0d60))||_0x1cb28f;}return _0x4a9abc>0x3&&_0x1cb28f&&Object[_0x4c1db3(0x17a)](_0x5286b3,_0x3e0d60,_0x1cb28f),_0x1cb28f;},__metadata=this&&this['__metadata']||function(_0x21a266,_0x53f733){const _0x76e19d=a138_0x3bcd19;if(typeof Reflect===_0x76e19d(0x182)&&typeof Reflect['metadata']==='function')return Reflect['metadata'](_0x21a266,_0x53f733);},StreamingService_1;function a138_0x21fa(_0x4efe0d,_0x26dc23){const _0x19da90=a138_0x19da();return a138_0x21fa=function(_0x21fa9a,_0x51700f){_0x21fa9a=_0x21fa9a-0x156;let _0x3b57bf=_0x19da90[_0x21fa9a];return _0x3b57bf;},a138_0x21fa(_0x4efe0d,_0x26dc23);}Object[a138_0x3bcd19(0x17a)](exports,a138_0x3bcd19(0x19d),{'value':!![]}),exports['StreamingService']=void 0x0;const common_1=require('@nestjs/common'),child_process_1=require(a138_0x3bcd19(0x15c)),fs_1=require('fs'),puppeteer_1=require('../helpers/puppeteer'),streaming_gateway_1=require('./streaming.gateway'),user_service_1=require('../user/user.service'),jwt_1=require(a138_0x3bcd19(0x166));let StreamingService=StreamingService_1=class StreamingService{constructor(_0x31948e,_0x54115a){const _0x35e692=a138_0x3bcd19;this[_0x35e692(0x192)]=_0x31948e,this[_0x35e692(0x163)]=_0x54115a,this[_0x35e692(0x171)]=new common_1[(_0x35e692(0x176))](StreamingService_1[_0x35e692(0x170)]);}[a138_0x3bcd19(0x161)](){const _0x2e0552=a138_0x3bcd19;if(!this['childProcess'])this['childProcess']=(0x0,child_process_1[_0x2e0552(0x174)])(_0x2e0552(0x18d),['-']);}async[a138_0x3bcd19(0x177)](_0x2b6a94){const _0x369dcd=a138_0x3bcd19;this['spawnMpgPlayer'](),_0x2b6a94[_0x369dcd(0x195)](this['childProcess'][_0x369dcd(0x160)]),this['childProcess'][_0x369dcd(0x19e)]['on'](_0x369dcd(0x169),_0x2d83c6=>{const _0x199ac4=_0x369dcd;_0x2d83c6[_0x199ac4(0x157)]==_0x199ac4(0x18e)&&process['exit'](0x0);}),this[_0x369dcd(0x180)][_0x369dcd(0x160)]['on'](_0x369dcd(0x169),_0x4fbfad=>{const _0xd6691f=_0x369dcd;this[_0xd6691f(0x171)][_0xd6691f(0x197)](_0x4fbfad);}),this[_0x369dcd(0x180)][_0x369dcd(0x19e)]['on'](_0x369dcd(0x181),_0x5107fb=>{const _0x245df0=_0x369dcd;this[_0x245df0(0x171)][_0x245df0(0x197)](_0x245df0(0x183)+_0x5107fb);}),this[_0x369dcd(0x180)]['stderr']['on'](_0x369dcd(0x181),_0x44a2b5=>{const _0x365a4a=_0x369dcd;this[_0x365a4a(0x171)][_0x365a4a(0x197)](_0x365a4a(0x159)+_0x44a2b5);}),this[_0x369dcd(0x180)]['on']('exit',_0x189f4b=>{const _0x24275c=_0x369dcd;this[_0x24275c(0x171)]['log']('exit'),this['childProcess'][_0x24275c(0x189)](),this['childProcess']=null,_0x189f4b!==0x0&&this[_0x24275c(0x171)]['log'](_0x24275c(0x16d)+_0x189f4b);});return;}[a138_0x3bcd19(0x15a)](_0x34e4ea){const _0x502d61=a138_0x3bcd19,_0x3072fb=new Promise((_0x25da4e,_0x1e2631)=>{const _0x6d1f18=a138_0x21fa;this[_0x6d1f18(0x161)](),_0x34e4ea[_0x6d1f18(0x195)](this['childProcess'][_0x6d1f18(0x160)]),this[_0x6d1f18(0x180)][_0x6d1f18(0x19e)]['on']('error',_0x5ddaa1=>{const _0x26fedc=_0x6d1f18;_0x5ddaa1[_0x26fedc(0x157)]=='EPIPE'&&process[_0x26fedc(0x15d)](0x0);}),this[_0x6d1f18(0x180)]['stdin']['on'](_0x6d1f18(0x169),_0x56b756=>{const _0x17beac=_0x6d1f18;this['logger'][_0x17beac(0x197)](_0x56b756);}),this['childProcess']['stdout']['on'](_0x6d1f18(0x181),_0x31821a=>{const _0x1b3ad9=_0x6d1f18;this[_0x1b3ad9(0x171)][_0x1b3ad9(0x197)]('stdout\x20data:\x20'+_0x31821a);}),this[_0x6d1f18(0x180)][_0x6d1f18(0x184)]['on']('data',_0x433eda=>{const _0x413f6f=_0x6d1f18;this[_0x413f6f(0x171)][_0x413f6f(0x197)]('stderr\x20data:\x20'+_0x433eda);}),this['childProcess']['on']('exit',_0x2ec9fb=>{const _0x4a053c=_0x6d1f18;_0x25da4e(!![]),this[_0x4a053c(0x171)][_0x4a053c(0x197)](_0x4a053c(0x15d)),this[_0x4a053c(0x180)][_0x4a053c(0x189)](),this['childProcess']=null,_0x2ec9fb!==0x0&&this[_0x4a053c(0x171)]['log'](_0x4a053c(0x16d)+_0x2ec9fb);});});return{'process':this[_0x502d61(0x180)],'promise':_0x3072fb};}[a138_0x3bcd19(0x16c)](_0xcb868c){const _0x587095=a138_0x3bcd19;return(0x0,fs_1[_0x587095(0x196)])(_0xcb868c);}async[a138_0x3bcd19(0x15b)](){const _0x22139a=a138_0x3bcd19;this[_0x22139a(0x180)][_0x22139a(0x189)]();}async[a138_0x3bcd19(0x178)](){const _0x588a37=a138_0x3bcd19;try{const _0x4c09f5=process[_0x588a37(0x186)][_0x588a37(0x179)]+_0x588a37(0x16a);!this[_0x588a37(0x18c)]&&(this[_0x588a37(0x18c)]=await(0x0,puppeteer_1[_0x588a37(0x18f)])());const _0x36c25b=await(0x0,puppeteer_1[_0x588a37(0x172)])(this['browser']);if(_0x36c25b['includes'](_0x4c09f5)){console[_0x588a37(0x197)]('Server\x20stream\x20browser\x20already\x20open'),this[_0x588a37(0x18a)][_0x588a37(0x15e)]();return;}const _0x1c7bfb=this[_0x588a37(0x193)]||await(0x0,puppeteer_1[_0x588a37(0x158)])(this[_0x588a37(0x18c)]),_0x53d3f5=await this[_0x588a37(0x192)][_0x588a37(0x17f)]();await _0x1c7bfb[_0x588a37(0x16e)]({'name':'accessToken','url':process['env']['STREAM_SERVER_URL'],'value':_0x53d3f5}),await _0x1c7bfb['goto'](_0x4c09f5),await _0x1c7bfb[_0x588a37(0x162)]('body');}catch(_0x320fff){console[_0x588a37(0x197)](_0x320fff,_0x588a37(0x188));}}async[a138_0x3bcd19(0x19a)](){const _0x6be491=a138_0x3bcd19;try{this['page']&&(await this[_0x6be491(0x193)][_0x6be491(0x17d)](),this[_0x6be491(0x193)]=null);}catch(_0x4a481f){console[_0x6be491(0x197)](_0x4a481f,'Error\x20when\x20close\x20page');}}};__decorate([(0x0,common_1[a138_0x3bcd19(0x17c)])(streaming_gateway_1['StreamingGateway']),__metadata(a138_0x3bcd19(0x191),streaming_gateway_1[a138_0x3bcd19(0x15f)])],StreamingService[a138_0x3bcd19(0x19b)],a138_0x3bcd19(0x18a),void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a138_0x3bcd19(0x185)])(),__metadata('design:paramtypes',[user_service_1[a138_0x3bcd19(0x165)],jwt_1[a138_0x3bcd19(0x173)]])],StreamingService),exports['StreamingService']=StreamingService;