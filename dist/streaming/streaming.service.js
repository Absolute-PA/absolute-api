'use strict';const a138_0x3b5322=a138_0x3ca1;(function(_0x1a2417,_0x290900){const _0x240f61=a138_0x3ca1,_0x362c64=_0x1a2417();while(!![]){try{const _0xc40bb8=parseInt(_0x240f61(0x20c))/0x1*(parseInt(_0x240f61(0x1f7))/0x2)+parseInt(_0x240f61(0x224))/0x3+parseInt(_0x240f61(0x229))/0x4+-parseInt(_0x240f61(0x235))/0x5*(-parseInt(_0x240f61(0x21c))/0x6)+-parseInt(_0x240f61(0x20d))/0x7+parseInt(_0x240f61(0x225))/0x8+-parseInt(_0x240f61(0x1f6))/0x9;if(_0xc40bb8===_0x290900)break;else _0x362c64['push'](_0x362c64['shift']());}catch(_0xe9e65c){_0x362c64['push'](_0x362c64['shift']());}}}(a138_0xb6c7,0xe8b3d));var __decorate=this&&this['__decorate']||function(_0x3ec798,_0x4e95c2,_0x3feb86,_0x166035){const _0x4eb299=a138_0x3ca1;var _0x1e5f21=arguments['length'],_0x354e91=_0x1e5f21<0x3?_0x4e95c2:_0x166035===null?_0x166035=Object[_0x4eb299(0x234)](_0x4e95c2,_0x3feb86):_0x166035,_0x1f6ada;if(typeof Reflect===_0x4eb299(0x21a)&&typeof Reflect[_0x4eb299(0x22d)]===_0x4eb299(0x223))_0x354e91=Reflect[_0x4eb299(0x22d)](_0x3ec798,_0x4e95c2,_0x3feb86,_0x166035);else{for(var _0x2bd83f=_0x3ec798[_0x4eb299(0x1f8)]-0x1;_0x2bd83f>=0x0;_0x2bd83f--)if(_0x1f6ada=_0x3ec798[_0x2bd83f])_0x354e91=(_0x1e5f21<0x3?_0x1f6ada(_0x354e91):_0x1e5f21>0x3?_0x1f6ada(_0x4e95c2,_0x3feb86,_0x354e91):_0x1f6ada(_0x4e95c2,_0x3feb86))||_0x354e91;}return _0x1e5f21>0x3&&_0x354e91&&Object[_0x4eb299(0x21b)](_0x4e95c2,_0x3feb86,_0x354e91),_0x354e91;},__metadata=this&&this[a138_0x3b5322(0x216)]||function(_0x16a040,_0x202b06){const _0x5cde05=a138_0x3b5322;if(typeof Reflect==='object'&&typeof Reflect[_0x5cde05(0x22a)]===_0x5cde05(0x223))return Reflect['metadata'](_0x16a040,_0x202b06);},StreamingService_1;Object[a138_0x3b5322(0x21b)](exports,a138_0x3b5322(0x233),{'value':!![]}),exports[a138_0x3b5322(0x208)]=void 0x0;const common_1=require(a138_0x3b5322(0x206)),child_process_1=require(a138_0x3b5322(0x221)),fs_1=require('fs'),puppeteer_1=require('../helpers/puppeteer'),streaming_gateway_1=require('./streaming.gateway'),user_service_1=require(a138_0x3b5322(0x22f)),jwt_1=require('@nestjs/jwt');function a138_0xb6c7(){const _0xa3b948=['../user/user.service','stderr','UserService','data','__esModule','getOwnPropertyDescriptor','16195dCUZnC','logger','Injectable','userService','Error\x20when\x20open\x20page','12052881SYMNiA','2FRVEUN','length','/stream','streamingGateway','stderr\x20data:\x20','STREAM_SERVER_URL','JwtService','browser','openNewpage','spawn','Logger','stopStreamAudio','prototype','stdout','childProcess','@nestjs/common','Inject','StreamingService','spawnMpgPlayer','Error\x20when\x20close\x20page','goto','563361VgVGsw','10700214ESCTXS','name','close','Server\x20stream\x20browser\x20already\x20open','exit','getMasterUserAccessToken','stdin','stdout\x20data:\x20','createReadStream','__metadata','accessToken','kill','code','object','defineProperty','1440oOZnev','setCookie','createStreamFromFile','reconnectPeer','EPIPE','child_process','error','function','3186270UjWGZp','6079864sMAedI','design:paramtypes','log','env','2632664VOPIQI','metadata','StreamingGateway','page','decorate','closeServerUIStream'];a138_0xb6c7=function(){return _0xa3b948;};return a138_0xb6c7();}let StreamingService=StreamingService_1=class StreamingService{constructor(_0x2b885c,_0x33c340){const _0x7d9301=a138_0x3b5322;this[_0x7d9301(0x1f4)]=_0x2b885c,this['jwtService']=_0x33c340,this[_0x7d9301(0x236)]=new common_1[(_0x7d9301(0x201))](StreamingService_1[_0x7d9301(0x20e)]);}[a138_0x3b5322(0x209)](){const _0x5ea009=a138_0x3b5322;if(!this['childProcess'])this['childProcess']=(0x0,child_process_1[_0x5ea009(0x200)])('mpg123',['-']);}async['playStreamAudio'](_0x5d80f8){const _0x40950e=a138_0x3b5322;this[_0x40950e(0x209)](),_0x5d80f8['pipe'](this[_0x40950e(0x205)]['stdin']),this[_0x40950e(0x205)][_0x40950e(0x204)]['on']('error',_0x1fb91e=>{const _0x378659=_0x40950e;_0x1fb91e[_0x378659(0x219)]==_0x378659(0x220)&&process[_0x378659(0x211)](0x0);}),this[_0x40950e(0x205)][_0x40950e(0x213)]['on'](_0x40950e(0x222),_0x3583d5=>{const _0x509606=_0x40950e;this[_0x509606(0x236)][_0x509606(0x227)](_0x3583d5);}),this['childProcess'][_0x40950e(0x204)]['on'](_0x40950e(0x232),_0x2d59da=>{const _0x3a1f02=_0x40950e;this['logger'][_0x3a1f02(0x227)](_0x3a1f02(0x214)+_0x2d59da);}),this[_0x40950e(0x205)][_0x40950e(0x230)]['on'](_0x40950e(0x232),_0x1b4c1e=>{const _0x2c3037=_0x40950e;this[_0x2c3037(0x236)][_0x2c3037(0x227)](_0x2c3037(0x1fb)+_0x1b4c1e);}),this['childProcess']['on'](_0x40950e(0x211),_0xdca31c=>{const _0x342845=_0x40950e;this[_0x342845(0x236)][_0x342845(0x227)](_0x342845(0x211)),this[_0x342845(0x205)][_0x342845(0x218)](),this[_0x342845(0x205)]=null,_0xdca31c!==0x0&&this[_0x342845(0x236)][_0x342845(0x227)]('grep\x20process\x20exited\x20with\x20code\x20'+_0xdca31c);});return;}['playStreamAudioAsync'](_0x1a3e8a){const _0x211016=a138_0x3b5322,_0x5f5fd8=new Promise((_0x3670e9,_0x234aba)=>{const _0x4dbab0=a138_0x3ca1;this['spawnMpgPlayer'](),_0x1a3e8a['pipe'](this[_0x4dbab0(0x205)][_0x4dbab0(0x213)]),this[_0x4dbab0(0x205)][_0x4dbab0(0x204)]['on']('error',_0x2e52a8=>{const _0x2bd728=_0x4dbab0;_0x2e52a8[_0x2bd728(0x219)]==_0x2bd728(0x220)&&process[_0x2bd728(0x211)](0x0);}),this[_0x4dbab0(0x205)]['stdin']['on'](_0x4dbab0(0x222),_0x89d88f=>{const _0x37c151=_0x4dbab0;this[_0x37c151(0x236)][_0x37c151(0x227)](_0x89d88f);}),this[_0x4dbab0(0x205)]['stdout']['on'](_0x4dbab0(0x232),_0x7ec77a=>{const _0xf9dfcd=_0x4dbab0;this[_0xf9dfcd(0x236)]['log'](_0xf9dfcd(0x214)+_0x7ec77a);}),this[_0x4dbab0(0x205)][_0x4dbab0(0x230)]['on'](_0x4dbab0(0x232),_0x3168e3=>{const _0x29b97f=_0x4dbab0;this[_0x29b97f(0x236)]['log']('stderr\x20data:\x20'+_0x3168e3);}),this[_0x4dbab0(0x205)]['on'](_0x4dbab0(0x211),_0x136409=>{const _0xdd65d8=_0x4dbab0;_0x3670e9(!![]),this[_0xdd65d8(0x236)]['log'](_0xdd65d8(0x211)),this[_0xdd65d8(0x205)]['kill'](),this[_0xdd65d8(0x205)]=null,_0x136409!==0x0&&this['logger'][_0xdd65d8(0x227)]('grep\x20process\x20exited\x20with\x20code\x20'+_0x136409);});});return{'process':this[_0x211016(0x205)],'promise':_0x5f5fd8};}[a138_0x3b5322(0x21e)](_0x2f040e){const _0x45152d=a138_0x3b5322;return(0x0,fs_1[_0x45152d(0x215)])(_0x2f040e);}async[a138_0x3b5322(0x202)](){const _0x1d1a2c=a138_0x3b5322;this[_0x1d1a2c(0x205)][_0x1d1a2c(0x218)]();}async['openServerUIStream'](){const _0x295c1f=a138_0x3b5322;try{const _0x481f44=process[_0x295c1f(0x228)][_0x295c1f(0x1fc)]+_0x295c1f(0x1f9);!this[_0x295c1f(0x1fe)]&&(this[_0x295c1f(0x1fe)]=await(0x0,puppeteer_1['launchBrowser'])());const _0x55e3ef=await(0x0,puppeteer_1['getBrowserUrls'])(this[_0x295c1f(0x1fe)]);if(_0x55e3ef['includes'](_0x481f44)){console[_0x295c1f(0x227)](_0x295c1f(0x210)),this[_0x295c1f(0x1fa)][_0x295c1f(0x21f)]();return;}const _0x24b8b7=this[_0x295c1f(0x22c)]||await(0x0,puppeteer_1[_0x295c1f(0x1ff)])(this['browser']),_0xa52a30=await this[_0x295c1f(0x1f4)][_0x295c1f(0x212)]();await _0x24b8b7[_0x295c1f(0x21d)]({'name':_0x295c1f(0x217),'url':process[_0x295c1f(0x228)][_0x295c1f(0x1fc)],'value':_0xa52a30}),await _0x24b8b7[_0x295c1f(0x20b)](_0x481f44),await _0x24b8b7['focus']('body');}catch(_0x3098a8){console[_0x295c1f(0x227)](_0x3098a8,_0x295c1f(0x1f5));}}async[a138_0x3b5322(0x22e)](){const _0x236ab8=a138_0x3b5322;try{this['page']&&(await this['page'][_0x236ab8(0x20f)](),this[_0x236ab8(0x22c)]=null);}catch(_0x58bf0a){console['log'](_0x58bf0a,_0x236ab8(0x20a));}}};function a138_0x3ca1(_0x5e7373,_0x2d0a3d){const _0xb6c7b0=a138_0xb6c7();return a138_0x3ca1=function(_0x3ca122,_0x255e4a){_0x3ca122=_0x3ca122-0x1f3;let _0x3398c1=_0xb6c7b0[_0x3ca122];return _0x3398c1;},a138_0x3ca1(_0x5e7373,_0x2d0a3d);}__decorate([(0x0,common_1[a138_0x3b5322(0x207)])(streaming_gateway_1['StreamingGateway']),__metadata('design:type',streaming_gateway_1[a138_0x3b5322(0x22b)])],StreamingService[a138_0x3b5322(0x203)],a138_0x3b5322(0x1fa),void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a138_0x3b5322(0x1f3)])(),__metadata(a138_0x3b5322(0x226),[user_service_1[a138_0x3b5322(0x231)],jwt_1[a138_0x3b5322(0x1fd)]])],StreamingService),exports[a138_0x3b5322(0x208)]=StreamingService;