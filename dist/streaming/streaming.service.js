'use strict';const a141_0x353c87=a141_0x409f;function a141_0x5e5f(){const _0x1a60c3=['__esModule','body','StreamingGateway','2688200rxbwgb','Server\x20stream\x20browser\x20already\x20open','UserService','reconnectPeer','@nestjs/common','439113mJNhsq','page','function','error','exit','5VkiVKz','code','JwtService','setCookie','log','Logger','close','STREAM_SERVER_URL','14XuWhmF','openServerUIStream','data','stopStreamAudio','goto','139336KSfSpW','getBrowserUrls','kill','Error\x20when\x20close\x20page','child_process','prototype','EPIPE','jwtService','2727834YeLEsw','openNewpage','childProcess','../user/user.service','userService','design:type','getOwnPropertyDescriptor','length','focus','getMasterUserAccessToken','launchBrowser','stdin','__decorate','logger','stderr','5360704necYbr','stderr\x20data:\x20','mpg123','closeServerUIStream','metadata','grep\x20process\x20exited\x20with\x20code\x20','streamingGateway','pipe','12537490yDhshu','@nestjs/jwt','spawnMpgPlayer','./streaming.gateway','createReadStream','createStreamFromFile','accessToken','name','262158KJplDj','Injectable','Inject','decorate','browser','198modoqX','Error\x20when\x20open\x20page','/stream','spawn','env','object','StreamingService','playStreamAudio','includes','stdout','stdout\x20data:\x20'];a141_0x5e5f=function(){return _0x1a60c3;};return a141_0x5e5f();}(function(_0x251e2a,_0x43e423){const _0xd19086=a141_0x409f,_0x541ee0=_0x251e2a();while(!![]){try{const _0x4a569a=-parseInt(_0xd19086(0x143))/0x1*(parseInt(_0xd19086(0x126))/0x2)+-parseInt(_0xd19086(0x13e))/0x3+parseInt(_0xd19086(0x116))/0x4+-parseInt(_0xd19086(0x139))/0x5+-parseInt(_0xd19086(0x158))/0x6*(parseInt(_0xd19086(0x14b))/0x7)+parseInt(_0xd19086(0x150))/0x8*(parseInt(_0xd19086(0x12b))/0x9)+parseInt(_0xd19086(0x11e))/0xa;if(_0x4a569a===_0x43e423)break;else _0x541ee0['push'](_0x541ee0['shift']());}catch(_0x1d5f90){_0x541ee0['push'](_0x541ee0['shift']());}}}(a141_0x5e5f,0xb1d5f));var __decorate=this&&this[a141_0x353c87(0x113)]||function(_0x25d018,_0x5afa2e,_0x52e090,_0x52bde1){const _0x12e137=a141_0x353c87;var _0x44739f=arguments[_0x12e137(0x10e)],_0x10e29b=_0x44739f<0x3?_0x5afa2e:_0x52bde1===null?_0x52bde1=Object[_0x12e137(0x10d)](_0x5afa2e,_0x52e090):_0x52bde1,_0x3fd388;if(typeof Reflect===_0x12e137(0x130)&&typeof Reflect['decorate']==='function')_0x10e29b=Reflect[_0x12e137(0x129)](_0x25d018,_0x5afa2e,_0x52e090,_0x52bde1);else{for(var _0x1734bf=_0x25d018[_0x12e137(0x10e)]-0x1;_0x1734bf>=0x0;_0x1734bf--)if(_0x3fd388=_0x25d018[_0x1734bf])_0x10e29b=(_0x44739f<0x3?_0x3fd388(_0x10e29b):_0x44739f>0x3?_0x3fd388(_0x5afa2e,_0x52e090,_0x10e29b):_0x3fd388(_0x5afa2e,_0x52e090))||_0x10e29b;}return _0x44739f>0x3&&_0x10e29b&&Object['defineProperty'](_0x5afa2e,_0x52e090,_0x10e29b),_0x10e29b;},__metadata=this&&this['__metadata']||function(_0x4b7a41,_0x5381cb){const _0x1612f5=a141_0x353c87;if(typeof Reflect==='object'&&typeof Reflect[_0x1612f5(0x11a)]===_0x1612f5(0x140))return Reflect[_0x1612f5(0x11a)](_0x4b7a41,_0x5381cb);},StreamingService_1;Object['defineProperty'](exports,a141_0x353c87(0x136),{'value':!![]}),exports[a141_0x353c87(0x131)]=void 0x0;const common_1=require(a141_0x353c87(0x13d)),child_process_1=require(a141_0x353c87(0x154)),fs_1=require('fs'),puppeteer_1=require('../helpers/puppeteer'),streaming_gateway_1=require(a141_0x353c87(0x121)),user_service_1=require(a141_0x353c87(0x15b)),jwt_1=require(a141_0x353c87(0x11f));function a141_0x409f(_0x5ae02b,_0x45dcd6){const _0x5e5f04=a141_0x5e5f();return a141_0x409f=function(_0x409f17,_0x4bb6b9){_0x409f17=_0x409f17-0x10c;let _0x2f3869=_0x5e5f04[_0x409f17];return _0x2f3869;},a141_0x409f(_0x5ae02b,_0x45dcd6);}let StreamingService=StreamingService_1=class StreamingService{constructor(_0x47f9fe,_0x3d3ed7){const _0x54085f=a141_0x353c87;this[_0x54085f(0x15c)]=_0x47f9fe,this[_0x54085f(0x157)]=_0x3d3ed7,this[_0x54085f(0x114)]=new common_1[(_0x54085f(0x148))](StreamingService_1[_0x54085f(0x125)]);}[a141_0x353c87(0x120)](){const _0x164287=a141_0x353c87;if(!this[_0x164287(0x15a)])this['childProcess']=(0x0,child_process_1[_0x164287(0x12e)])(_0x164287(0x118),['-']);}async[a141_0x353c87(0x132)](_0x53e25b){const _0x41e396=a141_0x353c87;this[_0x41e396(0x120)](),_0x53e25b[_0x41e396(0x11d)](this[_0x41e396(0x15a)][_0x41e396(0x112)]),this['childProcess']['stdout']['on']('error',_0x52b1e6=>{const _0x1c49c9=_0x41e396;_0x52b1e6[_0x1c49c9(0x144)]=='EPIPE'&&process[_0x1c49c9(0x142)](0x0);}),this[_0x41e396(0x15a)][_0x41e396(0x112)]['on'](_0x41e396(0x141),_0x5e46d6=>{const _0x3da7cf=_0x41e396;this['logger'][_0x3da7cf(0x147)](_0x5e46d6);}),this[_0x41e396(0x15a)][_0x41e396(0x134)]['on']('data',_0x30add4=>{const _0x3fe697=_0x41e396;this['logger'][_0x3fe697(0x147)]('stdout\x20data:\x20'+_0x30add4);}),this[_0x41e396(0x15a)][_0x41e396(0x115)]['on']('data',_0x934f0d=>{const _0x5c4db3=_0x41e396;this[_0x5c4db3(0x114)][_0x5c4db3(0x147)](_0x5c4db3(0x117)+_0x934f0d);}),this[_0x41e396(0x15a)]['on'](_0x41e396(0x142),_0x38cbcd=>{const _0x1fa58d=_0x41e396;this['logger'][_0x1fa58d(0x147)](_0x1fa58d(0x142)),this[_0x1fa58d(0x15a)][_0x1fa58d(0x152)](),this[_0x1fa58d(0x15a)]=null,_0x38cbcd!==0x0&&this[_0x1fa58d(0x114)][_0x1fa58d(0x147)]('grep\x20process\x20exited\x20with\x20code\x20'+_0x38cbcd);});return;}['playStreamAudioAsync'](_0x1ebbb8){const _0x4a8878=a141_0x353c87,_0x9b596b=new Promise((_0x33dc74,_0x59476b)=>{const _0x564cdc=a141_0x409f;this['spawnMpgPlayer'](),_0x1ebbb8[_0x564cdc(0x11d)](this[_0x564cdc(0x15a)][_0x564cdc(0x112)]),this[_0x564cdc(0x15a)][_0x564cdc(0x134)]['on'](_0x564cdc(0x141),_0x190e74=>{const _0xf31427=_0x564cdc;_0x190e74['code']==_0xf31427(0x156)&&process[_0xf31427(0x142)](0x0);}),this[_0x564cdc(0x15a)]['stdin']['on']('error',_0x1c066d=>{const _0x447d97=_0x564cdc;this[_0x447d97(0x114)][_0x447d97(0x147)](_0x1c066d);}),this[_0x564cdc(0x15a)]['stdout']['on'](_0x564cdc(0x14d),_0xdfae14=>{const _0x29b59b=_0x564cdc;this[_0x29b59b(0x114)][_0x29b59b(0x147)](_0x29b59b(0x135)+_0xdfae14);}),this[_0x564cdc(0x15a)][_0x564cdc(0x115)]['on']('data',_0x5940fd=>{const _0x5d0b11=_0x564cdc;this[_0x5d0b11(0x114)]['log'](_0x5d0b11(0x117)+_0x5940fd);}),this[_0x564cdc(0x15a)]['on'](_0x564cdc(0x142),_0x17b794=>{const _0x2eacb8=_0x564cdc;_0x33dc74(!![]),this[_0x2eacb8(0x114)][_0x2eacb8(0x147)](_0x2eacb8(0x142)),this[_0x2eacb8(0x15a)][_0x2eacb8(0x152)](),this[_0x2eacb8(0x15a)]=null,_0x17b794!==0x0&&this[_0x2eacb8(0x114)][_0x2eacb8(0x147)](_0x2eacb8(0x11b)+_0x17b794);});});return{'process':this[_0x4a8878(0x15a)],'promise':_0x9b596b};}[a141_0x353c87(0x123)](_0x53f311){const _0x53cc4d=a141_0x353c87;return(0x0,fs_1[_0x53cc4d(0x122)])(_0x53f311);}async[a141_0x353c87(0x14e)](){const _0x25590e=a141_0x353c87;this[_0x25590e(0x15a)]['kill']();}async[a141_0x353c87(0x14c)](){const _0x569366=a141_0x353c87;try{const _0x4f6b2c=process[_0x569366(0x12f)][_0x569366(0x14a)]+_0x569366(0x12d);!this[_0x569366(0x12a)]&&(this[_0x569366(0x12a)]=await(0x0,puppeteer_1[_0x569366(0x111)])());const _0x332d10=await(0x0,puppeteer_1[_0x569366(0x151)])(this[_0x569366(0x12a)]);if(_0x332d10[_0x569366(0x133)](_0x4f6b2c)){console['log'](_0x569366(0x13a)),this[_0x569366(0x11c)][_0x569366(0x13c)]();return;}const _0x11c099=this[_0x569366(0x13f)]||await(0x0,puppeteer_1[_0x569366(0x159)])(this[_0x569366(0x12a)]),_0xb70df3=await this[_0x569366(0x15c)][_0x569366(0x110)]();await _0x11c099[_0x569366(0x146)]({'name':_0x569366(0x124),'url':process['env'][_0x569366(0x14a)],'value':_0xb70df3}),await _0x11c099[_0x569366(0x14f)](_0x4f6b2c),await _0x11c099[_0x569366(0x10f)](_0x569366(0x137));}catch(_0x45816b){console[_0x569366(0x147)](_0x45816b,_0x569366(0x12c));}}async[a141_0x353c87(0x119)](){const _0x2cad2c=a141_0x353c87;try{this[_0x2cad2c(0x13f)]&&(await this['page'][_0x2cad2c(0x149)](),this[_0x2cad2c(0x13f)]=null);}catch(_0x4bc8d4){console[_0x2cad2c(0x147)](_0x4bc8d4,_0x2cad2c(0x153));}}};__decorate([(0x0,common_1[a141_0x353c87(0x128)])(streaming_gateway_1[a141_0x353c87(0x138)]),__metadata(a141_0x353c87(0x10c),streaming_gateway_1['StreamingGateway'])],StreamingService[a141_0x353c87(0x155)],a141_0x353c87(0x11c),void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a141_0x353c87(0x127)])(),__metadata('design:paramtypes',[user_service_1[a141_0x353c87(0x13b)],jwt_1[a141_0x353c87(0x145)]])],StreamingService),exports[a141_0x353c87(0x131)]=StreamingService;