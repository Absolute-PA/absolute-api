'use strict';const a138_0x4f4286=a138_0x54c4;(function(_0x27d879,_0x5c990c){const _0x51a0f0=a138_0x54c4,_0x128c79=_0x27d879();while(!![]){try{const _0x5a1832=parseInt(_0x51a0f0(0x113))/0x1*(parseInt(_0x51a0f0(0xf0))/0x2)+-parseInt(_0x51a0f0(0xff))/0x3+-parseInt(_0x51a0f0(0x100))/0x4+-parseInt(_0x51a0f0(0xf2))/0x5+parseInt(_0x51a0f0(0x125))/0x6+-parseInt(_0x51a0f0(0x112))/0x7+parseInt(_0x51a0f0(0x137))/0x8;if(_0x5a1832===_0x5c990c)break;else _0x128c79['push'](_0x128c79['shift']());}catch(_0x16a778){_0x128c79['push'](_0x128c79['shift']());}}}(a138_0x30b4,0xc471c));function a138_0x30b4(){const _0x2a6905=['StreamingGateway','JwtService','spawnMpgPlayer','stdin','data','UserService','child_process','stderr','1281624Bvxcgv','Logger','prototype','grep\x20process\x20exited\x20with\x20code\x20','streamingGateway','function','setCookie','@nestjs/common','design:paramtypes','body','/stream','stdout\x20data:\x20','__decorate','browser','error','getMasterUserAccessToken','playStreamAudio','@nestjs/jwt','18377280jHOiAv','closeServerUIStream','2062960tBazsc','exit','180680tWiDyk','design:type','stderr\x20data:\x20','goto','./streaming.gateway','reconnectPeer','EPIPE','Server\x20stream\x20browser\x20already\x20open','STREAM_SERVER_URL','object','jwtService','Injectable','decorate','3935109MANdOf','1843288uXwKJB','spawn','stdout','metadata','page','kill','log','createReadStream','StreamingService','stopStreamAudio','openServerUIStream','Inject','code','launchBrowser','defineProperty','Error\x20when\x20open\x20page','pipe','length','6502629kTbmCR','1XvOJJy','logger','accessToken','userService','env','childProcess','createStreamFromFile','Error\x20when\x20close\x20page','playStreamAudioAsync','../helpers/puppeteer'];a138_0x30b4=function(){return _0x2a6905;};return a138_0x30b4();}function a138_0x54c4(_0x2ffa7f,_0x2fdf42){const _0x30b443=a138_0x30b4();return a138_0x54c4=function(_0x54c48c,_0x1f4db9){_0x54c48c=_0x54c48c-0xf0;let _0x1d07cb=_0x30b443[_0x54c48c];return _0x1d07cb;},a138_0x54c4(_0x2ffa7f,_0x2fdf42);}var __decorate=this&&this[a138_0x4f4286(0x131)]||function(_0x1c6477,_0x36dcc0,_0x37af77,_0x1e769b){const _0x2b6d9d=a138_0x4f4286;var _0x599f98=arguments['length'],_0x1eb646=_0x599f98<0x3?_0x36dcc0:_0x1e769b===null?_0x1e769b=Object['getOwnPropertyDescriptor'](_0x36dcc0,_0x37af77):_0x1e769b,_0x295929;if(typeof Reflect===_0x2b6d9d(0xfb)&&typeof Reflect['decorate']==='function')_0x1eb646=Reflect[_0x2b6d9d(0xfe)](_0x1c6477,_0x36dcc0,_0x37af77,_0x1e769b);else{for(var _0xcb0ba0=_0x1c6477[_0x2b6d9d(0x111)]-0x1;_0xcb0ba0>=0x0;_0xcb0ba0--)if(_0x295929=_0x1c6477[_0xcb0ba0])_0x1eb646=(_0x599f98<0x3?_0x295929(_0x1eb646):_0x599f98>0x3?_0x295929(_0x36dcc0,_0x37af77,_0x1eb646):_0x295929(_0x36dcc0,_0x37af77))||_0x1eb646;}return _0x599f98>0x3&&_0x1eb646&&Object[_0x2b6d9d(0x10e)](_0x36dcc0,_0x37af77,_0x1eb646),_0x1eb646;},__metadata=this&&this['__metadata']||function(_0x4bc354,_0x4204f3){const _0x4e029c=a138_0x4f4286;if(typeof Reflect===_0x4e029c(0xfb)&&typeof Reflect[_0x4e029c(0x103)]===_0x4e029c(0x12a))return Reflect['metadata'](_0x4bc354,_0x4204f3);},StreamingService_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a138_0x4f4286(0x108)]=void 0x0;const common_1=require(a138_0x4f4286(0x12c)),child_process_1=require(a138_0x4f4286(0x123)),fs_1=require('fs'),puppeteer_1=require(a138_0x4f4286(0x11c)),streaming_gateway_1=require(a138_0x4f4286(0xf6)),user_service_1=require('../user/user.service'),jwt_1=require(a138_0x4f4286(0x136));let StreamingService=StreamingService_1=class StreamingService{constructor(_0x46856f,_0x4813e5){const _0x5a4fb9=a138_0x4f4286;this[_0x5a4fb9(0x116)]=_0x46856f,this[_0x5a4fb9(0xfc)]=_0x4813e5,this[_0x5a4fb9(0x114)]=new common_1[(_0x5a4fb9(0x126))](StreamingService_1['name']);}[a138_0x4f4286(0x11f)](){const _0x18ebfc=a138_0x4f4286;if(!this[_0x18ebfc(0x118)])this['childProcess']=(0x0,child_process_1[_0x18ebfc(0x101)])('mpg123',['-']);}async[a138_0x4f4286(0x135)](_0x4d4d97){const _0x2639a6=a138_0x4f4286;this['spawnMpgPlayer'](),_0x4d4d97[_0x2639a6(0x110)](this[_0x2639a6(0x118)][_0x2639a6(0x120)]),this[_0x2639a6(0x118)][_0x2639a6(0x102)]['on'](_0x2639a6(0x133),_0x2e7df9=>{const _0x655e21=_0x2639a6;_0x2e7df9[_0x655e21(0x10c)]==_0x655e21(0xf8)&&process[_0x655e21(0xf1)](0x0);}),this[_0x2639a6(0x118)][_0x2639a6(0x120)]['on'](_0x2639a6(0x133),_0x42a210=>{const _0x383b76=_0x2639a6;this[_0x383b76(0x114)][_0x383b76(0x106)](_0x42a210);}),this[_0x2639a6(0x118)][_0x2639a6(0x102)]['on'](_0x2639a6(0x121),_0x4a6dcd=>{const _0x4c7cbe=_0x2639a6;this['logger'][_0x4c7cbe(0x106)]('stdout\x20data:\x20'+_0x4a6dcd);}),this[_0x2639a6(0x118)][_0x2639a6(0x124)]['on']('data',_0x35195b=>{const _0x57fb4a=_0x2639a6;this[_0x57fb4a(0x114)][_0x57fb4a(0x106)](_0x57fb4a(0xf4)+_0x35195b);}),this[_0x2639a6(0x118)]['on'](_0x2639a6(0xf1),_0x4ada18=>{const _0x2d96b4=_0x2639a6;this[_0x2d96b4(0x114)]['log'](_0x2d96b4(0xf1)),this[_0x2d96b4(0x118)][_0x2d96b4(0x105)](),this['childProcess']=null,_0x4ada18!==0x0&&this['logger'][_0x2d96b4(0x106)](_0x2d96b4(0x128)+_0x4ada18);});return;}[a138_0x4f4286(0x11b)](_0x562134){const _0xbe826d=a138_0x4f4286,_0x228982=new Promise((_0x26bbf0,_0xfdd59b)=>{const _0x2f52a2=a138_0x54c4;this[_0x2f52a2(0x11f)](),_0x562134[_0x2f52a2(0x110)](this[_0x2f52a2(0x118)]['stdin']),this[_0x2f52a2(0x118)][_0x2f52a2(0x102)]['on'](_0x2f52a2(0x133),_0x2efac6=>{const _0x5849ba=_0x2f52a2;_0x2efac6[_0x5849ba(0x10c)]==_0x5849ba(0xf8)&&process[_0x5849ba(0xf1)](0x0);}),this[_0x2f52a2(0x118)]['stdin']['on'](_0x2f52a2(0x133),_0x42022d=>{const _0x55aadd=_0x2f52a2;this[_0x55aadd(0x114)][_0x55aadd(0x106)](_0x42022d);}),this[_0x2f52a2(0x118)][_0x2f52a2(0x102)]['on'](_0x2f52a2(0x121),_0x319cb3=>{const _0xb7b156=_0x2f52a2;this[_0xb7b156(0x114)]['log'](_0xb7b156(0x130)+_0x319cb3);}),this[_0x2f52a2(0x118)][_0x2f52a2(0x124)]['on']('data',_0x2446cb=>{const _0x271086=_0x2f52a2;this[_0x271086(0x114)][_0x271086(0x106)]('stderr\x20data:\x20'+_0x2446cb);}),this['childProcess']['on'](_0x2f52a2(0xf1),_0x131542=>{const _0x17de17=_0x2f52a2;_0x26bbf0(!![]),this['logger'][_0x17de17(0x106)]('exit'),this[_0x17de17(0x118)][_0x17de17(0x105)](),this[_0x17de17(0x118)]=null,_0x131542!==0x0&&this[_0x17de17(0x114)]['log'](_0x17de17(0x128)+_0x131542);});});return{'process':this[_0xbe826d(0x118)],'promise':_0x228982};}[a138_0x4f4286(0x119)](_0x413e13){const _0xc400ba=a138_0x4f4286;return(0x0,fs_1[_0xc400ba(0x107)])(_0x413e13);}async[a138_0x4f4286(0x109)](){const _0x31f044=a138_0x4f4286;this['childProcess'][_0x31f044(0x105)]();}async[a138_0x4f4286(0x10a)](){const _0x5919f6=a138_0x4f4286;try{const _0x5566f8=process[_0x5919f6(0x117)][_0x5919f6(0xfa)]+_0x5919f6(0x12f);!this[_0x5919f6(0x132)]&&(this[_0x5919f6(0x132)]=await(0x0,puppeteer_1[_0x5919f6(0x10d)])());const _0x2d453b=await(0x0,puppeteer_1['getBrowserUrls'])(this[_0x5919f6(0x132)]);if(_0x2d453b['includes'](_0x5566f8)){console[_0x5919f6(0x106)](_0x5919f6(0xf9)),this[_0x5919f6(0x129)][_0x5919f6(0xf7)]();return;}const _0x285785=this['page']||await(0x0,puppeteer_1['openNewpage'])(this['browser']),_0x25a334=await this['userService'][_0x5919f6(0x134)]();await _0x285785[_0x5919f6(0x12b)]({'name':_0x5919f6(0x115),'url':process[_0x5919f6(0x117)][_0x5919f6(0xfa)],'value':_0x25a334}),await _0x285785[_0x5919f6(0xf5)](_0x5566f8),await _0x285785['focus'](_0x5919f6(0x12e));}catch(_0x1adbb0){console[_0x5919f6(0x106)](_0x1adbb0,_0x5919f6(0x10f));}}async[a138_0x4f4286(0x138)](){const _0x11009b=a138_0x4f4286;try{this[_0x11009b(0x104)]&&(await this[_0x11009b(0x104)]['close'](),this[_0x11009b(0x104)]=null);}catch(_0x1a8411){console['log'](_0x1a8411,_0x11009b(0x11a));}}};__decorate([(0x0,common_1[a138_0x4f4286(0x10b)])(streaming_gateway_1['StreamingGateway']),__metadata(a138_0x4f4286(0xf3),streaming_gateway_1[a138_0x4f4286(0x11d)])],StreamingService[a138_0x4f4286(0x127)],a138_0x4f4286(0x129),void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a138_0x4f4286(0xfd)])(),__metadata(a138_0x4f4286(0x12d),[user_service_1[a138_0x4f4286(0x122)],jwt_1[a138_0x4f4286(0x11e)]])],StreamingService),exports[a138_0x4f4286(0x108)]=StreamingService;