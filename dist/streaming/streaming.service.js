'use strict';const a141_0x6ba905=a141_0x1706;(function(_0x1f2177,_0x255c11){const _0x46285a=a141_0x1706,_0x4db044=_0x1f2177();while(!![]){try{const _0x56036f=parseInt(_0x46285a(0x122))/0x1*(-parseInt(_0x46285a(0x11d))/0x2)+-parseInt(_0x46285a(0x116))/0x3*(-parseInt(_0x46285a(0x104))/0x4)+parseInt(_0x46285a(0x107))/0x5+parseInt(_0x46285a(0x10b))/0x6+parseInt(_0x46285a(0x109))/0x7*(-parseInt(_0x46285a(0xf8))/0x8)+-parseInt(_0x46285a(0xf0))/0x9+parseInt(_0x46285a(0x118))/0xa;if(_0x56036f===_0x255c11)break;else _0x4db044['push'](_0x4db044['shift']());}catch(_0x8c4f4c){_0x4db044['push'](_0x4db044['shift']());}}}(a141_0xf29a,0x29d13));var __decorate=this&&this[a141_0x6ba905(0xf7)]||function(_0x5c57f9,_0x4a1cf0,_0x24a881,_0x337f2a){const _0x5c6d0a=a141_0x6ba905;var _0x2c3b1a=arguments['length'],_0x1c259f=_0x2c3b1a<0x3?_0x4a1cf0:_0x337f2a===null?_0x337f2a=Object['getOwnPropertyDescriptor'](_0x4a1cf0,_0x24a881):_0x337f2a,_0x132463;if(typeof Reflect===_0x5c6d0a(0x10e)&&typeof Reflect[_0x5c6d0a(0x12b)]===_0x5c6d0a(0x12f))_0x1c259f=Reflect[_0x5c6d0a(0x12b)](_0x5c57f9,_0x4a1cf0,_0x24a881,_0x337f2a);else{for(var _0x582ff5=_0x5c57f9[_0x5c6d0a(0xfe)]-0x1;_0x582ff5>=0x0;_0x582ff5--)if(_0x132463=_0x5c57f9[_0x582ff5])_0x1c259f=(_0x2c3b1a<0x3?_0x132463(_0x1c259f):_0x2c3b1a>0x3?_0x132463(_0x4a1cf0,_0x24a881,_0x1c259f):_0x132463(_0x4a1cf0,_0x24a881))||_0x1c259f;}return _0x2c3b1a>0x3&&_0x1c259f&&Object[_0x5c6d0a(0xfa)](_0x4a1cf0,_0x24a881,_0x1c259f),_0x1c259f;},__metadata=this&&this[a141_0x6ba905(0xfc)]||function(_0x3c187a,_0x122b96){const _0x400672=a141_0x6ba905;if(typeof Reflect===_0x400672(0x10e)&&typeof Reflect[_0x400672(0x101)]===_0x400672(0x12f))return Reflect[_0x400672(0x101)](_0x3c187a,_0x122b96);},StreamingService_1;function a141_0x1706(_0x585704,_0x5e1227){const _0xf29a43=a141_0xf29a();return a141_0x1706=function(_0x1706ab,_0x2fb3b7){_0x1706ab=_0x1706ab-0xf0;let _0x436c4e=_0xf29a43[_0x1706ab];return _0x436c4e;},a141_0x1706(_0x585704,_0x5e1227);}Object[a141_0x6ba905(0xfa)](exports,a141_0x6ba905(0xf9),{'value':!![]}),exports['StreamingService']=void 0x0;const common_1=require(a141_0x6ba905(0x105)),child_process_1=require('child_process'),fs_1=require('fs'),puppeteer_1=require(a141_0x6ba905(0xf5)),streaming_gateway_1=require(a141_0x6ba905(0x11e)),user_service_1=require(a141_0x6ba905(0x108)),jwt_1=require('@nestjs/jwt');let StreamingService=StreamingService_1=class StreamingService{constructor(_0x40d9d8,_0x45b4c6){const _0x11216b=a141_0x6ba905;this[_0x11216b(0x12a)]=_0x40d9d8,this['jwtService']=_0x45b4c6,this[_0x11216b(0x11f)]=new common_1[(_0x11216b(0x128))](StreamingService_1['name']);}[a141_0x6ba905(0x119)](){const _0x2e78c7=a141_0x6ba905;if(!this[_0x2e78c7(0x10a)])this[_0x2e78c7(0x10a)]=(0x0,child_process_1[_0x2e78c7(0x114)])(_0x2e78c7(0x124),['-']);}async[a141_0x6ba905(0x127)](_0x5e101a){const _0x5755f2=a141_0x6ba905;this[_0x5755f2(0x119)](),_0x5e101a['pipe'](this[_0x5755f2(0x10a)][_0x5755f2(0x12e)]),this[_0x5755f2(0x10a)][_0x5755f2(0x121)]['on'](_0x5755f2(0x112),_0x3b4977=>{const _0x8d41a7=_0x5755f2;_0x3b4977[_0x8d41a7(0xf4)]=='EPIPE'&&process[_0x8d41a7(0x129)](0x0);}),this[_0x5755f2(0x10a)][_0x5755f2(0x12e)]['on'](_0x5755f2(0x112),_0x4cd4fc=>{const _0x3de02e=_0x5755f2;this['logger'][_0x3de02e(0x103)](_0x4cd4fc);}),this['childProcess'][_0x5755f2(0x121)]['on'](_0x5755f2(0xfd),_0x4af20b=>{const _0x329a09=_0x5755f2;this[_0x329a09(0x11f)][_0x329a09(0x103)](_0x329a09(0x120)+_0x4af20b);}),this['childProcess'][_0x5755f2(0x11b)]['on'](_0x5755f2(0xfd),_0x23168c=>{const _0x382226=_0x5755f2;this['logger'][_0x382226(0x103)]('stderr\x20data:\x20'+_0x23168c);}),this[_0x5755f2(0x10a)]['on']('exit',_0x4c60d4=>{const _0x55d9b4=_0x5755f2;this[_0x55d9b4(0x11f)][_0x55d9b4(0x103)](_0x55d9b4(0x129)),this[_0x55d9b4(0x10a)]['kill'](),this[_0x55d9b4(0x10a)]=null,_0x4c60d4!==0x0&&this['logger'][_0x55d9b4(0x103)](_0x55d9b4(0x132)+_0x4c60d4);});return;}['playStreamAudioAsync'](_0x2a42b8){const _0x2b3982=a141_0x6ba905,_0x4bebf7=new Promise((_0x16076c,_0x5526c6)=>{const _0x57c76b=a141_0x1706;this[_0x57c76b(0x119)](),_0x2a42b8[_0x57c76b(0x117)](this[_0x57c76b(0x10a)]['stdin']),this[_0x57c76b(0x10a)]['stdout']['on'](_0x57c76b(0x112),_0x2bd68a=>{const _0x2d1a3f=_0x57c76b;_0x2bd68a[_0x2d1a3f(0xf4)]==_0x2d1a3f(0x115)&&process[_0x2d1a3f(0x129)](0x0);}),this[_0x57c76b(0x10a)]['stdin']['on'](_0x57c76b(0x112),_0xed1beb=>{const _0x5b5d92=_0x57c76b;this['logger'][_0x5b5d92(0x103)](_0xed1beb);}),this['childProcess']['stdout']['on'](_0x57c76b(0xfd),_0xd17c06=>{const _0x258638=_0x57c76b;this[_0x258638(0x11f)][_0x258638(0x103)](_0x258638(0x120)+_0xd17c06);}),this[_0x57c76b(0x10a)]['stderr']['on']('data',_0x44ffe1=>{const _0x1518bd=_0x57c76b;this['logger'][_0x1518bd(0x103)](_0x1518bd(0x110)+_0x44ffe1);}),this[_0x57c76b(0x10a)]['on'](_0x57c76b(0x129),_0x1e57c9=>{const _0x5c8a18=_0x57c76b;_0x16076c(!![]),this[_0x5c8a18(0x11f)]['log'](_0x5c8a18(0x129)),this[_0x5c8a18(0x10a)][_0x5c8a18(0x10d)](),this['childProcess']=null,_0x1e57c9!==0x0&&this['logger'][_0x5c8a18(0x103)](_0x5c8a18(0x132)+_0x1e57c9);});});return{'process':this[_0x2b3982(0x10a)],'promise':_0x4bebf7};}['createStreamFromFile'](_0x21d999){return(0x0,fs_1['createReadStream'])(_0x21d999);}async[a141_0x6ba905(0x11a)](){const _0x38fa5d=a141_0x6ba905;this['childProcess'][_0x38fa5d(0x10d)]();}async[a141_0x6ba905(0x130)](){const _0xcf9536=a141_0x6ba905;try{const _0x1d5f95=process[_0xcf9536(0x133)][_0xcf9536(0xf2)]+_0xcf9536(0x100);!this[_0xcf9536(0x131)]&&(this[_0xcf9536(0x131)]=await(0x0,puppeteer_1['launchBrowser'])());const _0x26e937=await(0x0,puppeteer_1['getBrowserUrls'])(this[_0xcf9536(0x131)]);if(_0x26e937['includes'](_0x1d5f95)){console['log'](_0xcf9536(0xf3)),this[_0xcf9536(0xfb)]['reconnectPeer']();return;}const _0xe6ff38=this['page']||await(0x0,puppeteer_1['openNewpage'])(this[_0xcf9536(0x131)]),_0x57a59d=await this[_0xcf9536(0x12a)]['getMasterUserAccessToken']();await _0xe6ff38[_0xcf9536(0x113)]({'name':_0xcf9536(0x123),'url':process[_0xcf9536(0x133)][_0xcf9536(0xf2)],'value':_0x57a59d}),await _0xe6ff38['goto'](_0x1d5f95),await _0xe6ff38[_0xcf9536(0x11c)](_0xcf9536(0x106));}catch(_0x198f62){console[_0xcf9536(0x103)](_0x198f62,_0xcf9536(0x102));}}async['closeServerUIStream'](){const _0x6f5d2=a141_0x6ba905;try{this[_0x6f5d2(0x125)]&&(await this['page'][_0x6f5d2(0x10c)](),this[_0x6f5d2(0x125)]=null);}catch(_0x45d44a){console[_0x6f5d2(0x103)](_0x45d44a,_0x6f5d2(0xf1));}}};__decorate([(0x0,common_1['Inject'])(streaming_gateway_1[a141_0x6ba905(0x111)]),__metadata(a141_0x6ba905(0x12d),streaming_gateway_1[a141_0x6ba905(0x111)])],StreamingService['prototype'],'streamingGateway',void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a141_0x6ba905(0x12c)])(),__metadata(a141_0x6ba905(0xff),[user_service_1[a141_0x6ba905(0xf6)],jwt_1[a141_0x6ba905(0x126)]])],StreamingService),exports[a141_0x6ba905(0x10f)]=StreamingService;function a141_0xf29a(){const _0x3e201d=['699680qtELrL','spawnMpgPlayer','stopStreamAudio','stderr','focus','296BKSEsr','./streaming.gateway','logger','stdout\x20data:\x20','stdout','403LIUeNI','accessToken','mpg123','page','JwtService','playStreamAudio','Logger','exit','userService','decorate','Injectable','design:type','stdin','function','openServerUIStream','browser','grep\x20process\x20exited\x20with\x20code\x20','env','1865484OxqUyb','Error\x20when\x20close\x20page','STREAM_SERVER_URL','Server\x20stream\x20browser\x20already\x20open','code','../helpers/puppeteer','UserService','__decorate','1370632VeHleH','__esModule','defineProperty','streamingGateway','__metadata','data','length','design:paramtypes','/stream','metadata','Error\x20when\x20open\x20page','log','4tbkMre','@nestjs/common','body','833110nNidAE','../user/user.service','7sBGBlh','childProcess','1867446hIDWTr','close','kill','object','StreamingService','stderr\x20data:\x20','StreamingGateway','error','setCookie','spawn','EPIPE','185103mLhMFw','pipe'];a141_0xf29a=function(){return _0x3e201d;};return a141_0xf29a();}