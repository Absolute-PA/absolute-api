'use strict';const a141_0x37aa50=a141_0x390e;(function(_0x4e945f,_0xe567d8){const _0x3b00fa=a141_0x390e,_0x423af6=_0x4e945f();while(!![]){try{const _0x4714ff=-parseInt(_0x3b00fa(0xd4))/0x1+parseInt(_0x3b00fa(0x100))/0x2+-parseInt(_0x3b00fa(0x11c))/0x3*(parseInt(_0x3b00fa(0xe7))/0x4)+parseInt(_0x3b00fa(0xde))/0x5*(parseInt(_0x3b00fa(0xfb))/0x6)+parseInt(_0x3b00fa(0xe5))/0x7*(parseInt(_0x3b00fa(0xd7))/0x8)+-parseInt(_0x3b00fa(0x105))/0x9*(parseInt(_0x3b00fa(0x104))/0xa)+-parseInt(_0x3b00fa(0x102))/0xb;if(_0x4714ff===_0xe567d8)break;else _0x423af6['push'](_0x423af6['shift']());}catch(_0x825011){_0x423af6['push'](_0x423af6['shift']());}}}(a141_0x3742,0x7c465));var __decorate=this&&this[a141_0x37aa50(0x11b)]||function(_0x1c7014,_0x218136,_0x992ece,_0x2260ff){const _0x4cc160=a141_0x37aa50;var _0x5ae1e1=arguments[_0x4cc160(0xf9)],_0xc19168=_0x5ae1e1<0x3?_0x218136:_0x2260ff===null?_0x2260ff=Object[_0x4cc160(0xdc)](_0x218136,_0x992ece):_0x2260ff,_0x51c60d;if(typeof Reflect===_0x4cc160(0xf7)&&typeof Reflect['decorate']===_0x4cc160(0x10e))_0xc19168=Reflect[_0x4cc160(0xf4)](_0x1c7014,_0x218136,_0x992ece,_0x2260ff);else{for(var _0x1bb604=_0x1c7014[_0x4cc160(0xf9)]-0x1;_0x1bb604>=0x0;_0x1bb604--)if(_0x51c60d=_0x1c7014[_0x1bb604])_0xc19168=(_0x5ae1e1<0x3?_0x51c60d(_0xc19168):_0x5ae1e1>0x3?_0x51c60d(_0x218136,_0x992ece,_0xc19168):_0x51c60d(_0x218136,_0x992ece))||_0xc19168;}return _0x5ae1e1>0x3&&_0xc19168&&Object[_0x4cc160(0x10f)](_0x218136,_0x992ece,_0xc19168),_0xc19168;},__metadata=this&&this[a141_0x37aa50(0x111)]||function(_0x13ed08,_0x4d40e7){const _0x1baa1c=a141_0x37aa50;if(typeof Reflect===_0x1baa1c(0xf7)&&typeof Reflect[_0x1baa1c(0xe8)]===_0x1baa1c(0x10e))return Reflect[_0x1baa1c(0xe8)](_0x13ed08,_0x4d40e7);},StreamingService_1;Object['defineProperty'](exports,a141_0x37aa50(0xdf),{'value':!![]}),exports[a141_0x37aa50(0xe4)]=void 0x0;function a141_0x3742(){const _0xc7b8f5=['function','defineProperty','env','__metadata','body','getBrowserUrls','../helpers/puppeteer','Logger','error','prototype','page','@nestjs/common','EPIPE','__decorate','237yqFENX','exit','STREAM_SERVER_URL','browser','Server\x20stream\x20browser\x20already\x20open','stopStreamAudio','spawnMpgPlayer','735939ANDbqE','playStreamAudioAsync','UserService','6728WuyfXl','launchBrowser','Inject','code','closeServerUIStream','getOwnPropertyDescriptor','jwtService','2500475SMujDa','__esModule','grep\x20process\x20exited\x20with\x20code\x20','StreamingGateway','stdout','data','StreamingService','3374RinuMf','userService','1064ZPsymn','metadata','pipe','kill','child_process','openNewpage','Error\x20when\x20close\x20page','Injectable','reconnectPeer','playStreamAudio','log','/stream','design:type','decorate','streamingGateway','./streaming.gateway','object','childProcess','length','stderr\x20data:\x20','6azmXnj','design:paramtypes','goto','stdout\x20data:\x20','spawn','1736256OePlWo','stdin','3559413shFSDo','name','20OeICnu','828090OndmAo','setCookie','stderr','logger','createStreamFromFile','accessToken','JwtService','../user/user.service','getMasterUserAccessToken'];a141_0x3742=function(){return _0xc7b8f5;};return a141_0x3742();}const common_1=require(a141_0x37aa50(0x119)),child_process_1=require(a141_0x37aa50(0xeb)),fs_1=require('fs'),puppeteer_1=require(a141_0x37aa50(0x114)),streaming_gateway_1=require(a141_0x37aa50(0xf6)),user_service_1=require(a141_0x37aa50(0x10c)),jwt_1=require('@nestjs/jwt');function a141_0x390e(_0x26a4db,_0x504a01){const _0x3742b1=a141_0x3742();return a141_0x390e=function(_0x390ef0,_0x8d329b){_0x390ef0=_0x390ef0-0xd0;let _0x1ca1ce=_0x3742b1[_0x390ef0];return _0x1ca1ce;},a141_0x390e(_0x26a4db,_0x504a01);}let StreamingService=StreamingService_1=class StreamingService{constructor(_0x1cbe55,_0x80bd68){const _0x59700a=a141_0x37aa50;this[_0x59700a(0xe6)]=_0x1cbe55,this[_0x59700a(0xdd)]=_0x80bd68,this[_0x59700a(0x108)]=new common_1[(_0x59700a(0x115))](StreamingService_1[_0x59700a(0x103)]);}[a141_0x37aa50(0xd3)](){const _0x5ea722=a141_0x37aa50;if(!this['childProcess'])this[_0x5ea722(0xf8)]=(0x0,child_process_1[_0x5ea722(0xff)])('mpg123',['-']);}async[a141_0x37aa50(0xf0)](_0xdebde2){const _0x5ae0eb=a141_0x37aa50;this[_0x5ae0eb(0xd3)](),_0xdebde2['pipe'](this[_0x5ae0eb(0xf8)][_0x5ae0eb(0x101)]),this[_0x5ae0eb(0xf8)][_0x5ae0eb(0xe2)]['on'](_0x5ae0eb(0x116),_0x41c297=>{const _0x476545=_0x5ae0eb;_0x41c297['code']==_0x476545(0x11a)&&process[_0x476545(0x11d)](0x0);}),this[_0x5ae0eb(0xf8)][_0x5ae0eb(0x101)]['on'](_0x5ae0eb(0x116),_0x1f7e1c=>{const _0x59c574=_0x5ae0eb;this['logger'][_0x59c574(0xf1)](_0x1f7e1c);}),this[_0x5ae0eb(0xf8)][_0x5ae0eb(0xe2)]['on']('data',_0x16ba4c=>{const _0x5a9832=_0x5ae0eb;this[_0x5a9832(0x108)][_0x5a9832(0xf1)](_0x5a9832(0xfe)+_0x16ba4c);}),this[_0x5ae0eb(0xf8)][_0x5ae0eb(0x107)]['on'](_0x5ae0eb(0xe3),_0x2ab932=>{const _0x5643e0=_0x5ae0eb;this[_0x5643e0(0x108)]['log']('stderr\x20data:\x20'+_0x2ab932);}),this[_0x5ae0eb(0xf8)]['on'](_0x5ae0eb(0x11d),_0x485004=>{const _0x40421c=_0x5ae0eb;this['logger']['log'](_0x40421c(0x11d)),this[_0x40421c(0xf8)]['kill'](),this[_0x40421c(0xf8)]=null,_0x485004!==0x0&&this[_0x40421c(0x108)][_0x40421c(0xf1)](_0x40421c(0xe0)+_0x485004);});return;}[a141_0x37aa50(0xd5)](_0x2747e4){const _0x54e73b=new Promise((_0x478dd5,_0x5ced28)=>{const _0x261662=a141_0x390e;this[_0x261662(0xd3)](),_0x2747e4[_0x261662(0xe9)](this[_0x261662(0xf8)][_0x261662(0x101)]),this[_0x261662(0xf8)]['stdout']['on'](_0x261662(0x116),_0x1283b5=>{const _0x4cc8b7=_0x261662;_0x1283b5[_0x4cc8b7(0xda)]==_0x4cc8b7(0x11a)&&process['exit'](0x0);}),this['childProcess'][_0x261662(0x101)]['on'](_0x261662(0x116),_0x29e568=>{this['logger']['log'](_0x29e568);}),this['childProcess'][_0x261662(0xe2)]['on'](_0x261662(0xe3),_0x16813c=>{const _0x2c193d=_0x261662;this[_0x2c193d(0x108)][_0x2c193d(0xf1)](_0x2c193d(0xfe)+_0x16813c);}),this['childProcess'][_0x261662(0x107)]['on'](_0x261662(0xe3),_0x298746=>{const _0x510edb=_0x261662;this[_0x510edb(0x108)][_0x510edb(0xf1)](_0x510edb(0xfa)+_0x298746);}),this[_0x261662(0xf8)]['on'](_0x261662(0x11d),_0x35e7e6=>{const _0x2cfe1f=_0x261662;_0x478dd5(!![]),this[_0x2cfe1f(0x108)][_0x2cfe1f(0xf1)]('exit'),this['childProcess'][_0x2cfe1f(0xea)](),this[_0x2cfe1f(0xf8)]=null,_0x35e7e6!==0x0&&this['logger'][_0x2cfe1f(0xf1)](_0x2cfe1f(0xe0)+_0x35e7e6);});});return{'process':this['childProcess'],'promise':_0x54e73b};}[a141_0x37aa50(0x109)](_0x3aa9de){return(0x0,fs_1['createReadStream'])(_0x3aa9de);}async[a141_0x37aa50(0xd2)](){const _0x4ea0ae=a141_0x37aa50;this['childProcess'][_0x4ea0ae(0xea)]();}async['openServerUIStream'](){const _0x1c005a=a141_0x37aa50;try{const _0x1fa85b=process[_0x1c005a(0x110)][_0x1c005a(0x11e)]+_0x1c005a(0xf2);!this[_0x1c005a(0xd0)]&&(this['browser']=await(0x0,puppeteer_1[_0x1c005a(0xd8)])());const _0x545230=await(0x0,puppeteer_1[_0x1c005a(0x113)])(this[_0x1c005a(0xd0)]);if(_0x545230['includes'](_0x1fa85b)){console[_0x1c005a(0xf1)](_0x1c005a(0xd1)),this[_0x1c005a(0xf5)][_0x1c005a(0xef)]();return;}const _0x30361d=this[_0x1c005a(0x118)]||await(0x0,puppeteer_1[_0x1c005a(0xec)])(this['browser']),_0x22c6c3=await this['userService'][_0x1c005a(0x10d)]();await _0x30361d[_0x1c005a(0x106)]({'name':_0x1c005a(0x10a),'url':process[_0x1c005a(0x110)][_0x1c005a(0x11e)],'value':_0x22c6c3}),await _0x30361d[_0x1c005a(0xfd)](_0x1fa85b),await _0x30361d['focus'](_0x1c005a(0x112));}catch(_0x1c3e3d){console[_0x1c005a(0xf1)](_0x1c3e3d,'Error\x20when\x20open\x20page');}}async[a141_0x37aa50(0xdb)](){const _0x90730=a141_0x37aa50;try{this[_0x90730(0x118)]&&(await this['page']['close'](),this[_0x90730(0x118)]=null);}catch(_0x4d2bdf){console[_0x90730(0xf1)](_0x4d2bdf,_0x90730(0xed));}}};__decorate([(0x0,common_1[a141_0x37aa50(0xd9)])(streaming_gateway_1[a141_0x37aa50(0xe1)]),__metadata(a141_0x37aa50(0xf3),streaming_gateway_1[a141_0x37aa50(0xe1)])],StreamingService[a141_0x37aa50(0x117)],a141_0x37aa50(0xf5),void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a141_0x37aa50(0xee)])(),__metadata(a141_0x37aa50(0xfc),[user_service_1[a141_0x37aa50(0xd6)],jwt_1[a141_0x37aa50(0x10b)]])],StreamingService),exports[a141_0x37aa50(0xe4)]=StreamingService;