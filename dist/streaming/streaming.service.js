'use strict';function a138_0x1eda(_0x452225,_0x3aae38){const _0x316fcf=a138_0x316f();return a138_0x1eda=function(_0x1eda9d,_0x243875){_0x1eda9d=_0x1eda9d-0xea;let _0x474a7c=_0x316fcf[_0x1eda9d];return _0x474a7c;},a138_0x1eda(_0x452225,_0x3aae38);}const a138_0x6f0085=a138_0x1eda;(function(_0x3331ed,_0x3654fa){const _0x21318f=a138_0x1eda,_0x328550=_0x3331ed();while(!![]){try{const _0x503a55=-parseInt(_0x21318f(0x128))/0x1+parseInt(_0x21318f(0xf9))/0x2+-parseInt(_0x21318f(0x126))/0x3+parseInt(_0x21318f(0x10e))/0x4+parseInt(_0x21318f(0xfa))/0x5+-parseInt(_0x21318f(0x129))/0x6+parseInt(_0x21318f(0xf4))/0x7;if(_0x503a55===_0x3654fa)break;else _0x328550['push'](_0x328550['shift']());}catch(_0xb69e0c){_0x328550['push'](_0x328550['shift']());}}}(a138_0x316f,0xeafe6));var __decorate=this&&this[a138_0x6f0085(0xed)]||function(_0x3f9d45,_0xebcc39,_0x492e18,_0xa053e9){const _0x2e651e=a138_0x6f0085;var _0x4651f1=arguments[_0x2e651e(0xf5)],_0x31d3ff=_0x4651f1<0x3?_0xebcc39:_0xa053e9===null?_0xa053e9=Object[_0x2e651e(0x108)](_0xebcc39,_0x492e18):_0xa053e9,_0x42cc42;if(typeof Reflect===_0x2e651e(0x109)&&typeof Reflect['decorate']===_0x2e651e(0x12e))_0x31d3ff=Reflect['decorate'](_0x3f9d45,_0xebcc39,_0x492e18,_0xa053e9);else{for(var _0x37793d=_0x3f9d45[_0x2e651e(0xf5)]-0x1;_0x37793d>=0x0;_0x37793d--)if(_0x42cc42=_0x3f9d45[_0x37793d])_0x31d3ff=(_0x4651f1<0x3?_0x42cc42(_0x31d3ff):_0x4651f1>0x3?_0x42cc42(_0xebcc39,_0x492e18,_0x31d3ff):_0x42cc42(_0xebcc39,_0x492e18))||_0x31d3ff;}return _0x4651f1>0x3&&_0x31d3ff&&Object[_0x2e651e(0x130)](_0xebcc39,_0x492e18,_0x31d3ff),_0x31d3ff;},__metadata=this&&this['__metadata']||function(_0x288bb4,_0x101d00){const _0x84417c=a138_0x6f0085;if(typeof Reflect===_0x84417c(0x109)&&typeof Reflect['metadata']===_0x84417c(0x12e))return Reflect[_0x84417c(0x12c)](_0x288bb4,_0x101d00);},StreamingService_1;Object[a138_0x6f0085(0x130)](exports,a138_0x6f0085(0x11c),{'value':!![]}),exports[a138_0x6f0085(0x122)]=void 0x0;const common_1=require(a138_0x6f0085(0x12a)),child_process_1=require(a138_0x6f0085(0x113)),fs_1=require('fs'),puppeteer_1=require(a138_0x6f0085(0xf3)),streaming_gateway_1=require('./streaming.gateway'),user_service_1=require(a138_0x6f0085(0x10a)),jwt_1=require('@nestjs/jwt');let StreamingService=StreamingService_1=class StreamingService{constructor(_0x27abe0,_0x3e3325){const _0x22ed04=a138_0x6f0085;this['userService']=_0x27abe0,this[_0x22ed04(0xf1)]=_0x3e3325,this[_0x22ed04(0x124)]=new common_1[(_0x22ed04(0x10b))](StreamingService_1[_0x22ed04(0x11b)]);}[a138_0x6f0085(0x125)](){const _0x389ba7=a138_0x6f0085;if(!this[_0x389ba7(0xf6)])this[_0x389ba7(0xf6)]=(0x0,child_process_1['spawn'])(_0x389ba7(0x115),['-']);}async[a138_0x6f0085(0x100)](_0x7e66ee){const _0x2169f5=a138_0x6f0085;this[_0x2169f5(0x125)](),_0x7e66ee['pipe'](this[_0x2169f5(0xf6)][_0x2169f5(0x121)]),this[_0x2169f5(0xf6)][_0x2169f5(0x11e)]['on'](_0x2169f5(0xef),_0x106463=>{const _0x4274dc=_0x2169f5;_0x106463[_0x4274dc(0xf2)]==_0x4274dc(0x106)&&process['exit'](0x0);}),this['childProcess'][_0x2169f5(0x121)]['on'](_0x2169f5(0xef),_0x4ab41c=>{const _0x1c82d6=_0x2169f5;this[_0x1c82d6(0x124)][_0x1c82d6(0x10d)](_0x4ab41c);}),this['childProcess'][_0x2169f5(0x11e)]['on'](_0x2169f5(0x103),_0x40915e=>{const _0x5d7dca=_0x2169f5;this['logger'][_0x5d7dca(0x10d)](_0x5d7dca(0x10c)+_0x40915e);}),this[_0x2169f5(0xf6)]['stderr']['on']('data',_0x2ec00c=>{const _0x31d8ef=_0x2169f5;this[_0x31d8ef(0x124)]['log'](_0x31d8ef(0x11d)+_0x2ec00c);}),this[_0x2169f5(0xf6)]['on'](_0x2169f5(0xf8),_0x26d9ee=>{const _0x76f30=_0x2169f5;this['logger'][_0x76f30(0x10d)](_0x76f30(0xf8)),this[_0x76f30(0xf6)][_0x76f30(0x12b)](),this['childProcess']=null,_0x26d9ee!==0x0&&this[_0x76f30(0x124)][_0x76f30(0x10d)](_0x76f30(0xff)+_0x26d9ee);});return;}[a138_0x6f0085(0x12f)](_0x3ba7f7){const _0x56edd6=a138_0x6f0085,_0x22a64e=new Promise((_0x5d65b2,_0x110f19)=>{const _0x1c5fe8=a138_0x1eda;this[_0x1c5fe8(0x125)](),_0x3ba7f7[_0x1c5fe8(0xf7)](this[_0x1c5fe8(0xf6)][_0x1c5fe8(0x121)]),this[_0x1c5fe8(0xf6)][_0x1c5fe8(0x11e)]['on']('error',_0x347335=>{const _0x3f5398=_0x1c5fe8;_0x347335[_0x3f5398(0xf2)]==_0x3f5398(0x106)&&process[_0x3f5398(0xf8)](0x0);}),this['childProcess'][_0x1c5fe8(0x121)]['on'](_0x1c5fe8(0xef),_0x3fdd57=>{const _0x5daba3=_0x1c5fe8;this['logger'][_0x5daba3(0x10d)](_0x3fdd57);}),this[_0x1c5fe8(0xf6)]['stdout']['on'](_0x1c5fe8(0x103),_0x2170b2=>{const _0x31aa1b=_0x1c5fe8;this[_0x31aa1b(0x124)][_0x31aa1b(0x10d)]('stdout\x20data:\x20'+_0x2170b2);}),this[_0x1c5fe8(0xf6)][_0x1c5fe8(0xec)]['on']('data',_0x414d59=>{const _0x82ec0a=_0x1c5fe8;this['logger'][_0x82ec0a(0x10d)](_0x82ec0a(0x11d)+_0x414d59);}),this[_0x1c5fe8(0xf6)]['on'](_0x1c5fe8(0xf8),_0x3e8853=>{const _0x383138=_0x1c5fe8;_0x5d65b2(!![]),this[_0x383138(0x124)][_0x383138(0x10d)]('exit'),this[_0x383138(0xf6)]['kill'](),this[_0x383138(0xf6)]=null,_0x3e8853!==0x0&&this['logger'][_0x383138(0x10d)](_0x383138(0xff)+_0x3e8853);});});return{'process':this[_0x56edd6(0xf6)],'promise':_0x22a64e};}[a138_0x6f0085(0xee)](_0x4c6e5e){const _0x33745a=a138_0x6f0085;return(0x0,fs_1[_0x33745a(0x11f)])(_0x4c6e5e);}async['stopStreamAudio'](){const _0x3931f0=a138_0x6f0085;this[_0x3931f0(0xf6)]['kill']();}async[a138_0x6f0085(0x102)](){const _0x2c521c=a138_0x6f0085;try{const _0x11f8df=process[_0x2c521c(0x127)][_0x2c521c(0x111)]+_0x2c521c(0x101);!this[_0x2c521c(0xea)]&&(this[_0x2c521c(0xea)]=await(0x0,puppeteer_1[_0x2c521c(0xfc)])());const _0x291a90=await(0x0,puppeteer_1[_0x2c521c(0x119)])(this[_0x2c521c(0xea)]);if(_0x291a90[_0x2c521c(0x107)](_0x11f8df)){console[_0x2c521c(0x10d)](_0x2c521c(0x123)),this[_0x2c521c(0x117)][_0x2c521c(0x105)]();return;}const _0x474779=this['page']||await(0x0,puppeteer_1['openNewpage'])(this[_0x2c521c(0xea)]),_0x1b9157=await this[_0x2c521c(0x104)][_0x2c521c(0xfe)]();await _0x474779[_0x2c521c(0x12d)]({'name':_0x2c521c(0x120),'url':process[_0x2c521c(0x127)]['STREAM_SERVER_URL'],'value':_0x1b9157}),await _0x474779[_0x2c521c(0xfd)](_0x11f8df),await _0x474779[_0x2c521c(0x10f)]('body');}catch(_0x320e37){console[_0x2c521c(0x10d)](_0x320e37,'Error\x20when\x20open\x20page');}}async[a138_0x6f0085(0x118)](){const _0x3bdb87=a138_0x6f0085;try{this[_0x3bdb87(0x114)]&&(await this[_0x3bdb87(0x114)][_0x3bdb87(0x116)](),this[_0x3bdb87(0x114)]=null);}catch(_0x3d6312){console[_0x3bdb87(0x10d)](_0x3d6312,_0x3bdb87(0xeb));}}};function a138_0x316f(){const _0x3a9bf7=['page','mpg123','close','streamingGateway','closeServerUIStream','getBrowserUrls','design:type','name','__esModule','stderr\x20data:\x20','stdout','createReadStream','accessToken','stdin','StreamingService','Server\x20stream\x20browser\x20already\x20open','logger','spawnMpgPlayer','4853022XTtApz','env','1565915lZKAgv','5424132oGhPiX','@nestjs/common','kill','metadata','setCookie','function','playStreamAudioAsync','defineProperty','browser','Error\x20when\x20close\x20page','stderr','__decorate','createStreamFromFile','error','UserService','jwtService','code','../helpers/puppeteer','12712014cgFlfo','length','childProcess','pipe','exit','1178960VnzlSx','6885910IxgvPk','Injectable','launchBrowser','goto','getMasterUserAccessToken','grep\x20process\x20exited\x20with\x20code\x20','playStreamAudio','/stream','openServerUIStream','data','userService','reconnectPeer','EPIPE','includes','getOwnPropertyDescriptor','object','../user/user.service','Logger','stdout\x20data:\x20','log','5069924BoPtOM','focus','Inject','STREAM_SERVER_URL','StreamingGateway','child_process'];a138_0x316f=function(){return _0x3a9bf7;};return a138_0x316f();}__decorate([(0x0,common_1[a138_0x6f0085(0x110)])(streaming_gateway_1[a138_0x6f0085(0x112)]),__metadata(a138_0x6f0085(0x11a),streaming_gateway_1[a138_0x6f0085(0x112)])],StreamingService['prototype'],'streamingGateway',void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a138_0x6f0085(0xfb)])(),__metadata('design:paramtypes',[user_service_1[a138_0x6f0085(0xf0)],jwt_1['JwtService']])],StreamingService),exports[a138_0x6f0085(0x122)]=StreamingService;