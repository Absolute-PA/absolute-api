'use strict';const a138_0x5db677=a138_0x32be;(function(_0x6522ca,_0x35628a){const _0x2d47ec=a138_0x32be,_0x3d928f=_0x6522ca();while(!![]){try{const _0x56a2dd=parseInt(_0x2d47ec(0x121))/0x1*(parseInt(_0x2d47ec(0x120))/0x2)+-parseInt(_0x2d47ec(0x138))/0x3+parseInt(_0x2d47ec(0x127))/0x4*(parseInt(_0x2d47ec(0x12f))/0x5)+parseInt(_0x2d47ec(0x110))/0x6+-parseInt(_0x2d47ec(0x13e))/0x7+parseInt(_0x2d47ec(0x104))/0x8*(-parseInt(_0x2d47ec(0x128))/0x9)+parseInt(_0x2d47ec(0x129))/0xa;if(_0x56a2dd===_0x35628a)break;else _0x3d928f['push'](_0x3d928f['shift']());}catch(_0x4c950b){_0x3d928f['push'](_0x3d928f['shift']());}}}(a138_0x16d8,0x6f546));function a138_0x16d8(){const _0x5c277a=['Error\x20when\x20close\x20page','4043340hfvLOe','function','prototype','stdout\x20data:\x20','jwtService','stderr\x20data:\x20','pipe','child_process','streamingGateway','close','UserService','getOwnPropertyDescriptor','stdin','StreamingService','JwtService','focus','64SSRGMk','/stream','./streaming.gateway','stdout','childProcess','env','Injectable','browser','log','STREAM_SERVER_URL','exit','Server\x20stream\x20browser\x20already\x20open','4283592NBKMIn','page','Error\x20when\x20open\x20page','logger','openNewpage','createStreamFromFile','mpg123','design:paramtypes','playStreamAudio','decorate','data','StreamingGateway','defineProperty','setCookie','error','createReadStream','2DipEkX','241622sdMbpK','openServerUIStream','goto','design:type','kill','playStreamAudioAsync','4cSBTPE','176760vMtrod','6545090sbuKGb','spawn','stderr','stopStreamAudio','spawnMpgPlayer','code','920525CiqROS','__metadata','reconnectPeer','@nestjs/jwt','object','../user/user.service','metadata','__esModule','grep\x20process\x20exited\x20with\x20code\x20','1810266UXnWZJ','includes','getMasterUserAccessToken','accessToken','Inject'];a138_0x16d8=function(){return _0x5c277a;};return a138_0x16d8();}var __decorate=this&&this['__decorate']||function(_0x313e1d,_0x1d3c1d,_0xa17ad3,_0x24918d){const _0x54f8c5=a138_0x32be;var _0x150d39=arguments['length'],_0x1dad54=_0x150d39<0x3?_0x1d3c1d:_0x24918d===null?_0x24918d=Object[_0x54f8c5(0xff)](_0x1d3c1d,_0xa17ad3):_0x24918d,_0x332060;if(typeof Reflect===_0x54f8c5(0x133)&&typeof Reflect[_0x54f8c5(0x119)]===_0x54f8c5(0x13f))_0x1dad54=Reflect[_0x54f8c5(0x119)](_0x313e1d,_0x1d3c1d,_0xa17ad3,_0x24918d);else{for(var _0x199846=_0x313e1d['length']-0x1;_0x199846>=0x0;_0x199846--)if(_0x332060=_0x313e1d[_0x199846])_0x1dad54=(_0x150d39<0x3?_0x332060(_0x1dad54):_0x150d39>0x3?_0x332060(_0x1d3c1d,_0xa17ad3,_0x1dad54):_0x332060(_0x1d3c1d,_0xa17ad3))||_0x1dad54;}return _0x150d39>0x3&&_0x1dad54&&Object[_0x54f8c5(0x11c)](_0x1d3c1d,_0xa17ad3,_0x1dad54),_0x1dad54;},__metadata=this&&this[a138_0x5db677(0x130)]||function(_0x3cb7bc,_0x367b47){const _0x54c35a=a138_0x5db677;if(typeof Reflect===_0x54c35a(0x133)&&typeof Reflect[_0x54c35a(0x135)]===_0x54c35a(0x13f))return Reflect[_0x54c35a(0x135)](_0x3cb7bc,_0x367b47);},StreamingService_1;Object['defineProperty'](exports,a138_0x5db677(0x136),{'value':!![]}),exports[a138_0x5db677(0x101)]=void 0x0;const common_1=require('@nestjs/common'),child_process_1=require(a138_0x5db677(0x145)),fs_1=require('fs'),puppeteer_1=require('../helpers/puppeteer'),streaming_gateway_1=require(a138_0x5db677(0x106)),user_service_1=require(a138_0x5db677(0x134)),jwt_1=require(a138_0x5db677(0x132));let StreamingService=StreamingService_1=class StreamingService{constructor(_0x5b48ca,_0x145475){const _0x44f9e4=a138_0x5db677;this['userService']=_0x5b48ca,this[_0x44f9e4(0x142)]=_0x145475,this[_0x44f9e4(0x113)]=new common_1['Logger'](StreamingService_1['name']);}['spawnMpgPlayer'](){const _0x272443=a138_0x5db677;if(!this['childProcess'])this['childProcess']=(0x0,child_process_1[_0x272443(0x12a)])(_0x272443(0x116),['-']);}async[a138_0x5db677(0x118)](_0x589e1e){const _0x2a7b94=a138_0x5db677;this[_0x2a7b94(0x12d)](),_0x589e1e[_0x2a7b94(0x144)](this['childProcess'][_0x2a7b94(0x100)]),this[_0x2a7b94(0x108)][_0x2a7b94(0x107)]['on'](_0x2a7b94(0x11e),_0x244120=>{const _0x127ded=_0x2a7b94;_0x244120['code']=='EPIPE'&&process[_0x127ded(0x10e)](0x0);}),this['childProcess'][_0x2a7b94(0x100)]['on'](_0x2a7b94(0x11e),_0x30a2ac=>{const _0x3cd7d7=_0x2a7b94;this[_0x3cd7d7(0x113)][_0x3cd7d7(0x10c)](_0x30a2ac);}),this[_0x2a7b94(0x108)][_0x2a7b94(0x107)]['on'](_0x2a7b94(0x11a),_0x14aefa=>{const _0x1dda2a=_0x2a7b94;this[_0x1dda2a(0x113)][_0x1dda2a(0x10c)](_0x1dda2a(0x141)+_0x14aefa);}),this[_0x2a7b94(0x108)][_0x2a7b94(0x12b)]['on'](_0x2a7b94(0x11a),_0x5b653f=>{const _0x131338=_0x2a7b94;this[_0x131338(0x113)][_0x131338(0x10c)](_0x131338(0x143)+_0x5b653f);}),this[_0x2a7b94(0x108)]['on']('exit',_0x4b1d87=>{const _0x4c7584=_0x2a7b94;this['logger'][_0x4c7584(0x10c)](_0x4c7584(0x10e)),this[_0x4c7584(0x108)][_0x4c7584(0x125)](),this[_0x4c7584(0x108)]=null,_0x4b1d87!==0x0&&this[_0x4c7584(0x113)][_0x4c7584(0x10c)](_0x4c7584(0x137)+_0x4b1d87);});return;}[a138_0x5db677(0x126)](_0x13ac7e){const _0x763ec1=a138_0x5db677,_0x7f4fa3=new Promise((_0x1b9e0f,_0x3a00ec)=>{const _0x2d549f=a138_0x32be;this[_0x2d549f(0x12d)](),_0x13ac7e[_0x2d549f(0x144)](this['childProcess'][_0x2d549f(0x100)]),this['childProcess']['stdout']['on'](_0x2d549f(0x11e),_0x2f4664=>{const _0x4ec0a6=_0x2d549f;_0x2f4664[_0x4ec0a6(0x12e)]=='EPIPE'&&process['exit'](0x0);}),this[_0x2d549f(0x108)]['stdin']['on'](_0x2d549f(0x11e),_0x1e4916=>{const _0x2ff888=_0x2d549f;this[_0x2ff888(0x113)][_0x2ff888(0x10c)](_0x1e4916);}),this[_0x2d549f(0x108)][_0x2d549f(0x107)]['on'](_0x2d549f(0x11a),_0x4b8a0a=>{const _0xd30216=_0x2d549f;this[_0xd30216(0x113)][_0xd30216(0x10c)]('stdout\x20data:\x20'+_0x4b8a0a);}),this['childProcess'][_0x2d549f(0x12b)]['on']('data',_0x476f05=>{const _0x183627=_0x2d549f;this[_0x183627(0x113)][_0x183627(0x10c)](_0x183627(0x143)+_0x476f05);}),this[_0x2d549f(0x108)]['on'](_0x2d549f(0x10e),_0x5e574b=>{const _0x5e3fc4=_0x2d549f;_0x1b9e0f(!![]),this[_0x5e3fc4(0x113)][_0x5e3fc4(0x10c)]('exit'),this[_0x5e3fc4(0x108)][_0x5e3fc4(0x125)](),this[_0x5e3fc4(0x108)]=null,_0x5e574b!==0x0&&this[_0x5e3fc4(0x113)]['log'](_0x5e3fc4(0x137)+_0x5e574b);});});return{'process':this[_0x763ec1(0x108)],'promise':_0x7f4fa3};}[a138_0x5db677(0x115)](_0x4ebfff){const _0x4cfd7a=a138_0x5db677;return(0x0,fs_1[_0x4cfd7a(0x11f)])(_0x4ebfff);}async[a138_0x5db677(0x12c)](){this['childProcess']['kill']();}async[a138_0x5db677(0x122)](){const _0x342a77=a138_0x5db677;try{const _0x3e9b89=process['env'][_0x342a77(0x10d)]+_0x342a77(0x105);!this['browser']&&(this[_0x342a77(0x10b)]=await(0x0,puppeteer_1['launchBrowser'])());const _0x3e4e19=await(0x0,puppeteer_1['getBrowserUrls'])(this[_0x342a77(0x10b)]);if(_0x3e4e19[_0x342a77(0x139)](_0x3e9b89)){console[_0x342a77(0x10c)](_0x342a77(0x10f)),this['streamingGateway'][_0x342a77(0x131)]();return;}const _0x212b7d=this[_0x342a77(0x111)]||await(0x0,puppeteer_1[_0x342a77(0x114)])(this['browser']),_0x254926=await this['userService'][_0x342a77(0x13a)]();await _0x212b7d[_0x342a77(0x11d)]({'name':_0x342a77(0x13b),'url':process[_0x342a77(0x109)]['STREAM_SERVER_URL'],'value':_0x254926}),await _0x212b7d[_0x342a77(0x123)](_0x3e9b89),await _0x212b7d[_0x342a77(0x103)]('body');}catch(_0x33bafa){console[_0x342a77(0x10c)](_0x33bafa,_0x342a77(0x112));}}async['closeServerUIStream'](){const _0x258037=a138_0x5db677;try{this['page']&&(await this[_0x258037(0x111)][_0x258037(0x147)](),this[_0x258037(0x111)]=null);}catch(_0xf19add){console[_0x258037(0x10c)](_0xf19add,_0x258037(0x13d));}}};function a138_0x32be(_0x40e85a,_0x5926a4){const _0x16d837=a138_0x16d8();return a138_0x32be=function(_0x32be4f,_0x25add8){_0x32be4f=_0x32be4f-0xff;let _0x2051b2=_0x16d837[_0x32be4f];return _0x2051b2;},a138_0x32be(_0x40e85a,_0x5926a4);}__decorate([(0x0,common_1[a138_0x5db677(0x13c)])(streaming_gateway_1[a138_0x5db677(0x11b)]),__metadata(a138_0x5db677(0x124),streaming_gateway_1['StreamingGateway'])],StreamingService[a138_0x5db677(0x140)],a138_0x5db677(0x146),void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a138_0x5db677(0x10a)])(),__metadata(a138_0x5db677(0x117),[user_service_1[a138_0x5db677(0x148)],jwt_1[a138_0x5db677(0x102)]])],StreamingService),exports[a138_0x5db677(0x101)]=StreamingService;