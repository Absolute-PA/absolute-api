'use strict';const a138_0xc0fd73=a138_0x4660;(function(_0x1db1ee,_0x4c4cdc){const _0xb7a3bd=a138_0x4660,_0x5375eb=_0x1db1ee();while(!![]){try{const _0x4032a9=parseInt(_0xb7a3bd(0x1c3))/0x1*(parseInt(_0xb7a3bd(0x1c5))/0x2)+parseInt(_0xb7a3bd(0x1a5))/0x3+-parseInt(_0xb7a3bd(0x1d0))/0x4*(parseInt(_0xb7a3bd(0x1e3))/0x5)+parseInt(_0xb7a3bd(0x1ad))/0x6+-parseInt(_0xb7a3bd(0x1e1))/0x7*(-parseInt(_0xb7a3bd(0x1be))/0x8)+parseInt(_0xb7a3bd(0x1b1))/0x9*(-parseInt(_0xb7a3bd(0x1e4))/0xa)+parseInt(_0xb7a3bd(0x1c0))/0xb;if(_0x4032a9===_0x4c4cdc)break;else _0x5375eb['push'](_0x5375eb['shift']());}catch(_0x38cfd8){_0x5375eb['push'](_0x5375eb['shift']());}}}(a138_0x57ce,0x50db1));function a138_0x57ce(){const _0x102a1e=['focus','decorate','Error\x20when\x20open\x20page','spawn','exit','663411wmpvuW','includes','object','Error\x20when\x20close\x20page','browser','Inject','error','grep\x20process\x20exited\x20with\x20code\x20','3773118epnVcg','setCookie','createReadStream','JwtService','12537zJcAFq','userService','../user/user.service','reconnectPeer','StreamingService','kill','goto','defineProperty','getBrowserUrls','UserService','log','design:type','streamingGateway','8IXSnCB','Logger','7347142AzRmYr','stderr','stdin','184QYHARU','openServerUIStream','74TtMlSD','child_process','closeServerUIStream','@nestjs/common','childProcess','getOwnPropertyDescriptor','stderr\x20data:\x20','__esModule','StreamingGateway','data','env','236PYQLtG','stdout\x20data:\x20','createStreamFromFile','page','getMasterUserAccessToken','stopStreamAudio','__decorate','design:paramtypes','length','STREAM_SERVER_URL','metadata','Injectable','code','name','EPIPE','pipe','./streaming.gateway','243019AOtuPq','playStreamAudio','54980MKqAXY','4160WtBkob','jwtService','logger','spawnMpgPlayer','accessToken','prototype','stdout'];a138_0x57ce=function(){return _0x102a1e;};return a138_0x57ce();}var __decorate=this&&this[a138_0xc0fd73(0x1d6)]||function(_0x57268b,_0x1d79cd,_0x52cc83,_0xdf770a){const _0x37870b=a138_0xc0fd73;var _0x518bd9=arguments[_0x37870b(0x1d8)],_0x754a50=_0x518bd9<0x3?_0x1d79cd:_0xdf770a===null?_0xdf770a=Object[_0x37870b(0x1ca)](_0x1d79cd,_0x52cc83):_0xdf770a,_0x437cf2;if(typeof Reflect==='object'&&typeof Reflect[_0x37870b(0x1a1)]==='function')_0x754a50=Reflect['decorate'](_0x57268b,_0x1d79cd,_0x52cc83,_0xdf770a);else{for(var _0x26919d=_0x57268b[_0x37870b(0x1d8)]-0x1;_0x26919d>=0x0;_0x26919d--)if(_0x437cf2=_0x57268b[_0x26919d])_0x754a50=(_0x518bd9<0x3?_0x437cf2(_0x754a50):_0x518bd9>0x3?_0x437cf2(_0x1d79cd,_0x52cc83,_0x754a50):_0x437cf2(_0x1d79cd,_0x52cc83))||_0x754a50;}return _0x518bd9>0x3&&_0x754a50&&Object[_0x37870b(0x1b8)](_0x1d79cd,_0x52cc83,_0x754a50),_0x754a50;},__metadata=this&&this['__metadata']||function(_0x39720b,_0x572a3b){const _0x4fac7c=a138_0xc0fd73;if(typeof Reflect===_0x4fac7c(0x1a7)&&typeof Reflect[_0x4fac7c(0x1da)]==='function')return Reflect[_0x4fac7c(0x1da)](_0x39720b,_0x572a3b);},StreamingService_1;Object[a138_0xc0fd73(0x1b8)](exports,a138_0xc0fd73(0x1cc),{'value':!![]}),exports[a138_0xc0fd73(0x1b5)]=void 0x0;const common_1=require(a138_0xc0fd73(0x1c8)),child_process_1=require(a138_0xc0fd73(0x1c6)),fs_1=require('fs'),puppeteer_1=require('../helpers/puppeteer'),streaming_gateway_1=require(a138_0xc0fd73(0x1e0)),user_service_1=require(a138_0xc0fd73(0x1b3)),jwt_1=require('@nestjs/jwt');let StreamingService=StreamingService_1=class StreamingService{constructor(_0x815fb9,_0xc1835a){const _0x17d55d=a138_0xc0fd73;this[_0x17d55d(0x1b2)]=_0x815fb9,this[_0x17d55d(0x19a)]=_0xc1835a,this[_0x17d55d(0x19b)]=new common_1[(_0x17d55d(0x1bf))](StreamingService_1[_0x17d55d(0x1dd)]);}[a138_0xc0fd73(0x19c)](){const _0x36ab7b=a138_0xc0fd73;if(!this[_0x36ab7b(0x1c9)])this[_0x36ab7b(0x1c9)]=(0x0,child_process_1[_0x36ab7b(0x1a3)])('mpg123',['-']);}async[a138_0xc0fd73(0x1e2)](_0x53c253){const _0x40b432=a138_0xc0fd73;this[_0x40b432(0x19c)](),_0x53c253[_0x40b432(0x1df)](this[_0x40b432(0x1c9)][_0x40b432(0x1c2)]),this[_0x40b432(0x1c9)][_0x40b432(0x19f)]['on'](_0x40b432(0x1ab),_0x447f22=>{const _0x2670c9=_0x40b432;_0x447f22[_0x2670c9(0x1dc)]==_0x2670c9(0x1de)&&process['exit'](0x0);}),this[_0x40b432(0x1c9)][_0x40b432(0x1c2)]['on'](_0x40b432(0x1ab),_0x187bca=>{const _0x3afe56=_0x40b432;this['logger'][_0x3afe56(0x1bb)](_0x187bca);}),this['childProcess'][_0x40b432(0x19f)]['on'](_0x40b432(0x1ce),_0x3662ff=>{const _0x391bcf=_0x40b432;this[_0x391bcf(0x19b)][_0x391bcf(0x1bb)](_0x391bcf(0x1d1)+_0x3662ff);}),this[_0x40b432(0x1c9)][_0x40b432(0x1c1)]['on'](_0x40b432(0x1ce),_0xe86c67=>{const _0x439b27=_0x40b432;this['logger'][_0x439b27(0x1bb)]('stderr\x20data:\x20'+_0xe86c67);}),this[_0x40b432(0x1c9)]['on'](_0x40b432(0x1a4),_0x42aa8c=>{const _0x4fbc50=_0x40b432;this['logger'][_0x4fbc50(0x1bb)](_0x4fbc50(0x1a4)),this[_0x4fbc50(0x1c9)][_0x4fbc50(0x1b6)](),this['childProcess']=null,_0x42aa8c!==0x0&&this[_0x4fbc50(0x19b)][_0x4fbc50(0x1bb)](_0x4fbc50(0x1ac)+_0x42aa8c);});return;}['playStreamAudioAsync'](_0x5088b8){const _0x82594=a138_0xc0fd73,_0x30e935=new Promise((_0x449708,_0x666f60)=>{const _0x3df4a9=a138_0x4660;this[_0x3df4a9(0x19c)](),_0x5088b8['pipe'](this[_0x3df4a9(0x1c9)][_0x3df4a9(0x1c2)]),this['childProcess']['stdout']['on'](_0x3df4a9(0x1ab),_0xb5084=>{const _0x15f4b3=_0x3df4a9;_0xb5084[_0x15f4b3(0x1dc)]=='EPIPE'&&process[_0x15f4b3(0x1a4)](0x0);}),this['childProcess'][_0x3df4a9(0x1c2)]['on']('error',_0x5eb656=>{this['logger']['log'](_0x5eb656);}),this['childProcess']['stdout']['on'](_0x3df4a9(0x1ce),_0x23d32b=>{const _0x5db724=_0x3df4a9;this[_0x5db724(0x19b)][_0x5db724(0x1bb)](_0x5db724(0x1d1)+_0x23d32b);}),this[_0x3df4a9(0x1c9)]['stderr']['on'](_0x3df4a9(0x1ce),_0x331ed9=>{const _0x649f8b=_0x3df4a9;this['logger'][_0x649f8b(0x1bb)](_0x649f8b(0x1cb)+_0x331ed9);}),this['childProcess']['on'](_0x3df4a9(0x1a4),_0x41ad0f=>{const _0x32a250=_0x3df4a9;_0x449708(!![]),this[_0x32a250(0x19b)][_0x32a250(0x1bb)](_0x32a250(0x1a4)),this['childProcess'][_0x32a250(0x1b6)](),this[_0x32a250(0x1c9)]=null,_0x41ad0f!==0x0&&this['logger']['log']('grep\x20process\x20exited\x20with\x20code\x20'+_0x41ad0f);});});return{'process':this[_0x82594(0x1c9)],'promise':_0x30e935};}[a138_0xc0fd73(0x1d2)](_0x362528){const _0x128af5=a138_0xc0fd73;return(0x0,fs_1[_0x128af5(0x1af)])(_0x362528);}async[a138_0xc0fd73(0x1d5)](){const _0x2c41ae=a138_0xc0fd73;this[_0x2c41ae(0x1c9)][_0x2c41ae(0x1b6)]();}async[a138_0xc0fd73(0x1c4)](){const _0x175271=a138_0xc0fd73;try{const _0xefd348=process[_0x175271(0x1cf)][_0x175271(0x1d9)]+'/stream';!this[_0x175271(0x1a9)]&&(this[_0x175271(0x1a9)]=await(0x0,puppeteer_1['launchBrowser'])());const _0x33d890=await(0x0,puppeteer_1[_0x175271(0x1b9)])(this[_0x175271(0x1a9)]);if(_0x33d890[_0x175271(0x1a6)](_0xefd348)){console[_0x175271(0x1bb)]('Server\x20stream\x20browser\x20already\x20open'),this['streamingGateway'][_0x175271(0x1b4)]();return;}const _0x25b923=this['page']||await(0x0,puppeteer_1['openNewpage'])(this[_0x175271(0x1a9)]),_0x271b8d=await this[_0x175271(0x1b2)][_0x175271(0x1d4)]();await _0x25b923[_0x175271(0x1ae)]({'name':_0x175271(0x19d),'url':process[_0x175271(0x1cf)][_0x175271(0x1d9)],'value':_0x271b8d}),await _0x25b923[_0x175271(0x1b7)](_0xefd348),await _0x25b923[_0x175271(0x1a0)]('body');}catch(_0x1c598b){console[_0x175271(0x1bb)](_0x1c598b,_0x175271(0x1a2));}}async[a138_0xc0fd73(0x1c7)](){const _0x5ce6e5=a138_0xc0fd73;try{this[_0x5ce6e5(0x1d3)]&&(await this[_0x5ce6e5(0x1d3)]['close'](),this['page']=null);}catch(_0x22b33b){console[_0x5ce6e5(0x1bb)](_0x22b33b,_0x5ce6e5(0x1a8));}}};function a138_0x4660(_0x2beceb,_0x51ed50){const _0x57ce92=a138_0x57ce();return a138_0x4660=function(_0x4660e2,_0x370010){_0x4660e2=_0x4660e2-0x19a;let _0x4cb3cc=_0x57ce92[_0x4660e2];return _0x4cb3cc;},a138_0x4660(_0x2beceb,_0x51ed50);}__decorate([(0x0,common_1[a138_0xc0fd73(0x1aa)])(streaming_gateway_1[a138_0xc0fd73(0x1cd)]),__metadata(a138_0xc0fd73(0x1bc),streaming_gateway_1[a138_0xc0fd73(0x1cd)])],StreamingService[a138_0xc0fd73(0x19e)],a138_0xc0fd73(0x1bd),void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a138_0xc0fd73(0x1db)])(),__metadata(a138_0xc0fd73(0x1d7),[user_service_1[a138_0xc0fd73(0x1ba)],jwt_1[a138_0xc0fd73(0x1b0)]])],StreamingService),exports[a138_0xc0fd73(0x1b5)]=StreamingService;