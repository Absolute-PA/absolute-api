'use strict';const a141_0x560070=a141_0x1a1e;function a141_0x1714(){const _0x3ce160=['2AAhDMu','stdout','../user/user.service','81CGWmKY','closeServerUIStream','spawnMpgPlayer','length','2457RFkbil','getMasterUserAccessToken','42779ayFfnn','Error\x20when\x20close\x20page','stopStreamAudio','getBrowserUrls','Injectable','exit','JwtService','Inject','createReadStream','__metadata','kill','data','design:paramtypes','logger','log','launchBrowser','stderr\x20data:\x20','163016hnxrhI','STREAM_SERVER_URL','Server\x20stream\x20browser\x20already\x20open','includes','EPIPE','accessToken','536509SdFdgr','body','__decorate','jwtService','981669rXOiHi','browser','name','36npkQrp','27uDaEgW','code','playStreamAudioAsync','../helpers/puppeteer','child_process','childProcess','67842rCoowQ','mpg123','metadata','close','env','StreamingGateway','Error\x20when\x20open\x20page','userService','decorate','function','/stream','spawn','page','80qLDDAO','object','grep\x20process\x20exited\x20with\x20code\x20','error','streamingGateway','goto','getOwnPropertyDescriptor','4864pYeiZh','__esModule','Logger','1158190xiwcxJ','stdin','focus','252JgUTBM','StreamingService'];a141_0x1714=function(){return _0x3ce160;};return a141_0x1714();}function a141_0x1a1e(_0x5f16de,_0x597e7f){const _0x171482=a141_0x1714();return a141_0x1a1e=function(_0x1a1ea5,_0x5120dc){_0x1a1ea5=_0x1a1ea5-0x169;let _0x2d4118=_0x171482[_0x1a1ea5];return _0x2d4118;},a141_0x1a1e(_0x5f16de,_0x597e7f);}(function(_0x193669,_0x4075d7){const _0x546412=a141_0x1a1e,_0x4be916=_0x193669();while(!![]){try{const _0x2d960c=-parseInt(_0x546412(0x172))/0x1*(-parseInt(_0x546412(0x19c))/0x2)+parseInt(_0x546412(0x17a))/0x3*(parseInt(_0x546412(0x16c))/0x4)+parseInt(_0x546412(0x18d))/0x5*(parseInt(_0x546412(0x180))/0x6)+-parseInt(_0x546412(0x1a3))/0x7*(parseInt(_0x546412(0x194))/0x8)+-parseInt(_0x546412(0x19f))/0x9*(-parseInt(_0x546412(0x197))/0xa)+parseInt(_0x546412(0x1a5))/0xb*(-parseInt(_0x546412(0x179))/0xc)+parseInt(_0x546412(0x176))/0xd*(-parseInt(_0x546412(0x19a))/0xe);if(_0x2d960c===_0x4075d7)break;else _0x4be916['push'](_0x4be916['shift']());}catch(_0x4ae233){_0x4be916['push'](_0x4be916['shift']());}}}(a141_0x1714,0x8463d));var __decorate=this&&this[a141_0x560070(0x174)]||function(_0x38f781,_0xd64e46,_0x232f37,_0x45405c){const _0xbb716f=a141_0x560070;var _0x2a2460=arguments[_0xbb716f(0x1a2)],_0x11fb48=_0x2a2460<0x3?_0xd64e46:_0x45405c===null?_0x45405c=Object[_0xbb716f(0x193)](_0xd64e46,_0x232f37):_0x45405c,_0x3ba6e3;if(typeof Reflect===_0xbb716f(0x18e)&&typeof Reflect[_0xbb716f(0x188)]===_0xbb716f(0x189))_0x11fb48=Reflect[_0xbb716f(0x188)](_0x38f781,_0xd64e46,_0x232f37,_0x45405c);else{for(var _0x287645=_0x38f781['length']-0x1;_0x287645>=0x0;_0x287645--)if(_0x3ba6e3=_0x38f781[_0x287645])_0x11fb48=(_0x2a2460<0x3?_0x3ba6e3(_0x11fb48):_0x2a2460>0x3?_0x3ba6e3(_0xd64e46,_0x232f37,_0x11fb48):_0x3ba6e3(_0xd64e46,_0x232f37))||_0x11fb48;}return _0x2a2460>0x3&&_0x11fb48&&Object['defineProperty'](_0xd64e46,_0x232f37,_0x11fb48),_0x11fb48;},__metadata=this&&this[a141_0x560070(0x1ae)]||function(_0x3dbead,_0x83b467){const _0x2ac491=a141_0x560070;if(typeof Reflect===_0x2ac491(0x18e)&&typeof Reflect[_0x2ac491(0x182)]==='function')return Reflect[_0x2ac491(0x182)](_0x3dbead,_0x83b467);},StreamingService_1;Object['defineProperty'](exports,a141_0x560070(0x195),{'value':!![]}),exports[a141_0x560070(0x19b)]=void 0x0;const common_1=require('@nestjs/common'),child_process_1=require(a141_0x560070(0x17e)),fs_1=require('fs'),puppeteer_1=require(a141_0x560070(0x17d)),streaming_gateway_1=require('./streaming.gateway'),user_service_1=require(a141_0x560070(0x19e)),jwt_1=require('@nestjs/jwt');let StreamingService=StreamingService_1=class StreamingService{constructor(_0x246182,_0xd06503){const _0x1b114e=a141_0x560070;this[_0x1b114e(0x187)]=_0x246182,this[_0x1b114e(0x175)]=_0xd06503,this[_0x1b114e(0x1b2)]=new common_1[(_0x1b114e(0x196))](StreamingService_1[_0x1b114e(0x178)]);}[a141_0x560070(0x1a1)](){const _0x5665e5=a141_0x560070;if(!this['childProcess'])this[_0x5665e5(0x17f)]=(0x0,child_process_1[_0x5665e5(0x18b)])(_0x5665e5(0x181),['-']);}async['playStreamAudio'](_0x6fe0e0){const _0x62749a=a141_0x560070;this[_0x62749a(0x1a1)](),_0x6fe0e0['pipe'](this[_0x62749a(0x17f)][_0x62749a(0x198)]),this[_0x62749a(0x17f)]['stdout']['on'](_0x62749a(0x190),_0x5d0c51=>{const _0x157ca0=_0x62749a;_0x5d0c51[_0x157ca0(0x17b)]==_0x157ca0(0x170)&&process[_0x157ca0(0x1aa)](0x0);}),this['childProcess'][_0x62749a(0x198)]['on']('error',_0x4aebec=>{const _0x2d659e=_0x62749a;this[_0x2d659e(0x1b2)][_0x2d659e(0x169)](_0x4aebec);}),this['childProcess'][_0x62749a(0x19d)]['on'](_0x62749a(0x1b0),_0x188b9a=>{const _0x44cddb=_0x62749a;this['logger'][_0x44cddb(0x169)]('stdout\x20data:\x20'+_0x188b9a);}),this['childProcess']['stderr']['on']('data',_0x46a133=>{const _0x3bdc42=_0x62749a;this[_0x3bdc42(0x1b2)][_0x3bdc42(0x169)](_0x3bdc42(0x16b)+_0x46a133);}),this[_0x62749a(0x17f)]['on'](_0x62749a(0x1aa),_0x5409b7=>{const _0x412ea0=_0x62749a;this[_0x412ea0(0x1b2)][_0x412ea0(0x169)](_0x412ea0(0x1aa)),this[_0x412ea0(0x17f)][_0x412ea0(0x1af)](),this[_0x412ea0(0x17f)]=null,_0x5409b7!==0x0&&this[_0x412ea0(0x1b2)][_0x412ea0(0x169)](_0x412ea0(0x18f)+_0x5409b7);});return;}[a141_0x560070(0x17c)](_0x23bba8){const _0x1e43a5=a141_0x560070,_0x34a53f=new Promise((_0x4154d6,_0x54209d)=>{const _0x328698=a141_0x1a1e;this[_0x328698(0x1a1)](),_0x23bba8['pipe'](this[_0x328698(0x17f)][_0x328698(0x198)]),this['childProcess'][_0x328698(0x19d)]['on']('error',_0x409b6b=>{const _0x7f7026=_0x328698;_0x409b6b[_0x7f7026(0x17b)]==_0x7f7026(0x170)&&process[_0x7f7026(0x1aa)](0x0);}),this[_0x328698(0x17f)][_0x328698(0x198)]['on']('error',_0x9cbb0a=>{const _0x51d0c1=_0x328698;this['logger'][_0x51d0c1(0x169)](_0x9cbb0a);}),this['childProcess'][_0x328698(0x19d)]['on'](_0x328698(0x1b0),_0xcf3f78=>{const _0x3de6c5=_0x328698;this[_0x3de6c5(0x1b2)][_0x3de6c5(0x169)]('stdout\x20data:\x20'+_0xcf3f78);}),this['childProcess']['stderr']['on']('data',_0x205559=>{const _0x465f68=_0x328698;this['logger'][_0x465f68(0x169)](_0x465f68(0x16b)+_0x205559);}),this[_0x328698(0x17f)]['on'](_0x328698(0x1aa),_0x34d725=>{const _0x5e314b=_0x328698;_0x4154d6(!![]),this[_0x5e314b(0x1b2)][_0x5e314b(0x169)](_0x5e314b(0x1aa)),this['childProcess']['kill'](),this[_0x5e314b(0x17f)]=null,_0x34d725!==0x0&&this[_0x5e314b(0x1b2)][_0x5e314b(0x169)](_0x5e314b(0x18f)+_0x34d725);});});return{'process':this[_0x1e43a5(0x17f)],'promise':_0x34a53f};}['createStreamFromFile'](_0x3d5c7c){const _0x5634ec=a141_0x560070;return(0x0,fs_1[_0x5634ec(0x1ad)])(_0x3d5c7c);}async[a141_0x560070(0x1a7)](){const _0xc07a1b=a141_0x560070;this[_0xc07a1b(0x17f)][_0xc07a1b(0x1af)]();}async['openServerUIStream'](){const _0xecd200=a141_0x560070;try{const _0x5af281=process['env'][_0xecd200(0x16d)]+_0xecd200(0x18a);!this[_0xecd200(0x177)]&&(this['browser']=await(0x0,puppeteer_1[_0xecd200(0x16a)])());const _0x2ac1d4=await(0x0,puppeteer_1[_0xecd200(0x1a8)])(this[_0xecd200(0x177)]);if(_0x2ac1d4[_0xecd200(0x16f)](_0x5af281)){console['log'](_0xecd200(0x16e)),this[_0xecd200(0x191)]['reconnectPeer']();return;}const _0x31f70b=this[_0xecd200(0x18c)]||await(0x0,puppeteer_1['openNewpage'])(this[_0xecd200(0x177)]),_0x22668c=await this[_0xecd200(0x187)][_0xecd200(0x1a4)]();await _0x31f70b['setCookie']({'name':_0xecd200(0x171),'url':process[_0xecd200(0x184)]['STREAM_SERVER_URL'],'value':_0x22668c}),await _0x31f70b[_0xecd200(0x192)](_0x5af281),await _0x31f70b[_0xecd200(0x199)](_0xecd200(0x173));}catch(_0x1809fe){console[_0xecd200(0x169)](_0x1809fe,_0xecd200(0x186));}}async[a141_0x560070(0x1a0)](){const _0x380d25=a141_0x560070;try{this[_0x380d25(0x18c)]&&(await this[_0x380d25(0x18c)][_0x380d25(0x183)](),this[_0x380d25(0x18c)]=null);}catch(_0x3f9e12){console[_0x380d25(0x169)](_0x3f9e12,_0x380d25(0x1a6));}}};__decorate([(0x0,common_1[a141_0x560070(0x1ac)])(streaming_gateway_1[a141_0x560070(0x185)]),__metadata('design:type',streaming_gateway_1['StreamingGateway'])],StreamingService['prototype'],a141_0x560070(0x191),void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a141_0x560070(0x1a9)])(),__metadata(a141_0x560070(0x1b1),[user_service_1['UserService'],jwt_1[a141_0x560070(0x1ab)]])],StreamingService),exports[a141_0x560070(0x19b)]=StreamingService;