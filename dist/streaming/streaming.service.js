'use strict';const a138_0x49f952=a138_0x3e21;(function(_0x719c62,_0x345084){const _0x1cb52d=a138_0x3e21,_0x253455=_0x719c62();while(!![]){try{const _0x2a5c03=parseInt(_0x1cb52d(0x18d))/0x1+-parseInt(_0x1cb52d(0x1ad))/0x2+parseInt(_0x1cb52d(0x182))/0x3*(-parseInt(_0x1cb52d(0x17e))/0x4)+-parseInt(_0x1cb52d(0x1b9))/0x5*(parseInt(_0x1cb52d(0x1a2))/0x6)+parseInt(_0x1cb52d(0x1c2))/0x7*(parseInt(_0x1cb52d(0x185))/0x8)+-parseInt(_0x1cb52d(0x192))/0x9+parseInt(_0x1cb52d(0x1a7))/0xa;if(_0x2a5c03===_0x345084)break;else _0x253455['push'](_0x253455['shift']());}catch(_0x230d0b){_0x253455['push'](_0x253455['shift']());}}}(a138_0x2da9,0x8cf38));function a138_0x3e21(_0x4cedfc,_0x102e24){const _0x2da931=a138_0x2da9();return a138_0x3e21=function(_0x3e21f9,_0x5c98f1){_0x3e21f9=_0x3e21f9-0x17e;let _0x352fe9=_0x2da931[_0x3e21f9];return _0x352fe9;},a138_0x3e21(_0x4cedfc,_0x102e24);}function a138_0x2da9(){const _0x300aeb=['stderr\x20data:\x20','57qWhIFt','@nestjs/common','__metadata','8BggXrQ','name','stdout\x20data:\x20','design:paramtypes','/stream','grep\x20process\x20exited\x20with\x20code\x20','openNewpage','stdin','128614LFTJFG','playStreamAudio','spawn','StreamingGateway','log','8451396KgDDYJ','accessToken','../helpers/puppeteer','data','childProcess','jwtService','logger','__esModule','design:type','function','StreamingService','userService','decorate','object','prototype','streamingGateway','6IBzjYP','Injectable','Error\x20when\x20close\x20page','mpg123','exit','26810890UDGyXO','Logger','spawnMpgPlayer','stderr','Server\x20stream\x20browser\x20already\x20open','reconnectPeer','768878loaAzY','env','page','focus','__decorate','pipe','error','child_process','JwtService','defineProperty','@nestjs/jwt','stdout','3815695QzPGww','goto','body','kill','Error\x20when\x20open\x20page','EPIPE','stopStreamAudio','createStreamFromFile','../user/user.service','4706898KtllXo','Inject','launchBrowser','includes','browser','getOwnPropertyDescriptor','172244ujzTgQ','UserService','close'];a138_0x2da9=function(){return _0x300aeb;};return a138_0x2da9();}var __decorate=this&&this[a138_0x49f952(0x1b1)]||function(_0x12620b,_0x1b1df1,_0x3d0b13,_0x529ad){const _0xd2f54=a138_0x49f952;var _0x4d12af=arguments['length'],_0x46f266=_0x4d12af<0x3?_0x1b1df1:_0x529ad===null?_0x529ad=Object[_0xd2f54(0x1c7)](_0x1b1df1,_0x3d0b13):_0x529ad,_0x76202d;if(typeof Reflect===_0xd2f54(0x19f)&&typeof Reflect['decorate']===_0xd2f54(0x19b))_0x46f266=Reflect[_0xd2f54(0x19e)](_0x12620b,_0x1b1df1,_0x3d0b13,_0x529ad);else{for(var _0x3afc6f=_0x12620b['length']-0x1;_0x3afc6f>=0x0;_0x3afc6f--)if(_0x76202d=_0x12620b[_0x3afc6f])_0x46f266=(_0x4d12af<0x3?_0x76202d(_0x46f266):_0x4d12af>0x3?_0x76202d(_0x1b1df1,_0x3d0b13,_0x46f266):_0x76202d(_0x1b1df1,_0x3d0b13))||_0x46f266;}return _0x4d12af>0x3&&_0x46f266&&Object[_0xd2f54(0x1b6)](_0x1b1df1,_0x3d0b13,_0x46f266),_0x46f266;},__metadata=this&&this[a138_0x49f952(0x184)]||function(_0x17ad6f,_0x11a098){const _0x57f6ec=a138_0x49f952;if(typeof Reflect===_0x57f6ec(0x19f)&&typeof Reflect['metadata']===_0x57f6ec(0x19b))return Reflect['metadata'](_0x17ad6f,_0x11a098);},StreamingService_1;Object[a138_0x49f952(0x1b6)](exports,a138_0x49f952(0x199),{'value':!![]}),exports['StreamingService']=void 0x0;const common_1=require(a138_0x49f952(0x183)),child_process_1=require(a138_0x49f952(0x1b4)),fs_1=require('fs'),puppeteer_1=require(a138_0x49f952(0x194)),streaming_gateway_1=require('./streaming.gateway'),user_service_1=require(a138_0x49f952(0x1c1)),jwt_1=require(a138_0x49f952(0x1b7));let StreamingService=StreamingService_1=class StreamingService{constructor(_0x2299cb,_0x226173){const _0x21d391=a138_0x49f952;this[_0x21d391(0x19d)]=_0x2299cb,this[_0x21d391(0x197)]=_0x226173,this[_0x21d391(0x198)]=new common_1[(_0x21d391(0x1a8))](StreamingService_1[_0x21d391(0x186)]);}[a138_0x49f952(0x1a9)](){const _0x57a40d=a138_0x49f952;if(!this['childProcess'])this[_0x57a40d(0x196)]=(0x0,child_process_1[_0x57a40d(0x18f)])(_0x57a40d(0x1a5),['-']);}async[a138_0x49f952(0x18e)](_0x5f09bf){const _0x303d69=a138_0x49f952;this['spawnMpgPlayer'](),_0x5f09bf[_0x303d69(0x1b2)](this[_0x303d69(0x196)][_0x303d69(0x18c)]),this[_0x303d69(0x196)][_0x303d69(0x1b8)]['on'](_0x303d69(0x1b3),_0x220bf1=>{const _0x3b093b=_0x303d69;_0x220bf1['code']==_0x3b093b(0x1be)&&process[_0x3b093b(0x1a6)](0x0);}),this[_0x303d69(0x196)][_0x303d69(0x18c)]['on'](_0x303d69(0x1b3),_0x74589e=>{this['logger']['log'](_0x74589e);}),this[_0x303d69(0x196)]['stdout']['on'](_0x303d69(0x195),_0x3b28b8=>{const _0x590c3f=_0x303d69;this[_0x590c3f(0x198)]['log'](_0x590c3f(0x187)+_0x3b28b8);}),this[_0x303d69(0x196)]['stderr']['on'](_0x303d69(0x195),_0x132374=>{const _0x34ed3c=_0x303d69;this[_0x34ed3c(0x198)][_0x34ed3c(0x191)]('stderr\x20data:\x20'+_0x132374);}),this[_0x303d69(0x196)]['on']('exit',_0x14dd3a=>{const _0x1dfb19=_0x303d69;this[_0x1dfb19(0x198)][_0x1dfb19(0x191)](_0x1dfb19(0x1a6)),this[_0x1dfb19(0x196)][_0x1dfb19(0x1bc)](),this[_0x1dfb19(0x196)]=null,_0x14dd3a!==0x0&&this[_0x1dfb19(0x198)]['log'](_0x1dfb19(0x18a)+_0x14dd3a);});return;}['playStreamAudioAsync'](_0x3ea1a2){const _0x4d655f=a138_0x49f952,_0x1d0fe3=new Promise((_0x41028c,_0xafacb9)=>{const _0x30ab5c=a138_0x3e21;this[_0x30ab5c(0x1a9)](),_0x3ea1a2[_0x30ab5c(0x1b2)](this[_0x30ab5c(0x196)]['stdin']),this[_0x30ab5c(0x196)][_0x30ab5c(0x1b8)]['on'](_0x30ab5c(0x1b3),_0x4506fb=>{const _0x49295a=_0x30ab5c;_0x4506fb['code']=='EPIPE'&&process[_0x49295a(0x1a6)](0x0);}),this[_0x30ab5c(0x196)]['stdin']['on'](_0x30ab5c(0x1b3),_0x302b99=>{const _0x3a16ef=_0x30ab5c;this[_0x3a16ef(0x198)]['log'](_0x302b99);}),this[_0x30ab5c(0x196)][_0x30ab5c(0x1b8)]['on'](_0x30ab5c(0x195),_0x59dbb9=>{this['logger']['log']('stdout\x20data:\x20'+_0x59dbb9);}),this[_0x30ab5c(0x196)][_0x30ab5c(0x1aa)]['on'](_0x30ab5c(0x195),_0x280c92=>{const _0x469286=_0x30ab5c;this[_0x469286(0x198)][_0x469286(0x191)](_0x469286(0x181)+_0x280c92);}),this[_0x30ab5c(0x196)]['on'](_0x30ab5c(0x1a6),_0x4aa563=>{const _0x20398b=_0x30ab5c;_0x41028c(!![]),this[_0x20398b(0x198)][_0x20398b(0x191)](_0x20398b(0x1a6)),this[_0x20398b(0x196)][_0x20398b(0x1bc)](),this[_0x20398b(0x196)]=null,_0x4aa563!==0x0&&this[_0x20398b(0x198)][_0x20398b(0x191)](_0x20398b(0x18a)+_0x4aa563);});});return{'process':this[_0x4d655f(0x196)],'promise':_0x1d0fe3};}[a138_0x49f952(0x1c0)](_0x394821){return(0x0,fs_1['createReadStream'])(_0x394821);}async[a138_0x49f952(0x1bf)](){const _0x52eef9=a138_0x49f952;this[_0x52eef9(0x196)][_0x52eef9(0x1bc)]();}async['openServerUIStream'](){const _0x3bbebb=a138_0x49f952;try{const _0x2d2e4d=process['env']['STREAM_SERVER_URL']+_0x3bbebb(0x189);!this[_0x3bbebb(0x1c6)]&&(this[_0x3bbebb(0x1c6)]=await(0x0,puppeteer_1[_0x3bbebb(0x1c4)])());const _0x15dbc2=await(0x0,puppeteer_1['getBrowserUrls'])(this['browser']);if(_0x15dbc2[_0x3bbebb(0x1c5)](_0x2d2e4d)){console[_0x3bbebb(0x191)](_0x3bbebb(0x1ab)),this[_0x3bbebb(0x1a1)][_0x3bbebb(0x1ac)]();return;}const _0x4e5106=this[_0x3bbebb(0x1af)]||await(0x0,puppeteer_1[_0x3bbebb(0x18b)])(this[_0x3bbebb(0x1c6)]),_0x128f78=await this[_0x3bbebb(0x19d)]['getMasterUserAccessToken']();await _0x4e5106['setCookie']({'name':_0x3bbebb(0x193),'url':process[_0x3bbebb(0x1ae)]['STREAM_SERVER_URL'],'value':_0x128f78}),await _0x4e5106[_0x3bbebb(0x1ba)](_0x2d2e4d),await _0x4e5106[_0x3bbebb(0x1b0)](_0x3bbebb(0x1bb));}catch(_0x11fcf8){console[_0x3bbebb(0x191)](_0x11fcf8,_0x3bbebb(0x1bd));}}async['closeServerUIStream'](){const _0x5047d0=a138_0x49f952;try{this['page']&&(await this[_0x5047d0(0x1af)][_0x5047d0(0x180)](),this[_0x5047d0(0x1af)]=null);}catch(_0x4a0046){console[_0x5047d0(0x191)](_0x4a0046,_0x5047d0(0x1a4));}}};__decorate([(0x0,common_1[a138_0x49f952(0x1c3)])(streaming_gateway_1[a138_0x49f952(0x190)]),__metadata(a138_0x49f952(0x19a),streaming_gateway_1['StreamingGateway'])],StreamingService[a138_0x49f952(0x1a0)],'streamingGateway',void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a138_0x49f952(0x1a3)])(),__metadata(a138_0x49f952(0x188),[user_service_1[a138_0x49f952(0x17f)],jwt_1[a138_0x49f952(0x1b5)]])],StreamingService),exports[a138_0x49f952(0x19c)]=StreamingService;