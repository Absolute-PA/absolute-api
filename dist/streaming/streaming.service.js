'use strict';const a138_0x115097=a138_0x19d9;(function(_0x55505b,_0x1bc2e4){const _0x220485=a138_0x19d9,_0xc12c8b=_0x55505b();while(!![]){try{const _0x412d28=-parseInt(_0x220485(0x17f))/0x1*(parseInt(_0x220485(0x1ae))/0x2)+parseInt(_0x220485(0x1a6))/0x3+-parseInt(_0x220485(0x199))/0x4*(-parseInt(_0x220485(0x1a3))/0x5)+-parseInt(_0x220485(0x197))/0x6*(-parseInt(_0x220485(0x185))/0x7)+parseInt(_0x220485(0x19f))/0x8+parseInt(_0x220485(0x177))/0x9*(-parseInt(_0x220485(0x175))/0xa)+-parseInt(_0x220485(0x1a8))/0xb;if(_0x412d28===_0x1bc2e4)break;else _0xc12c8b['push'](_0xc12c8b['shift']());}catch(_0x425fcc){_0xc12c8b['push'](_0xc12c8b['shift']());}}}(a138_0x32a4,0x80537));function a138_0x19d9(_0x32f6ca,_0x20e09d){const _0x32a4d7=a138_0x32a4();return a138_0x19d9=function(_0x19d970,_0x44d8b8){_0x19d970=_0x19d970-0x16c;let _0x2a7909=_0x32a4d7[_0x19d970];return _0x2a7909;},a138_0x19d9(_0x32f6ca,_0x20e09d);}var __decorate=this&&this[a138_0x115097(0x18f)]||function(_0x4f7333,_0xeab857,_0xad2bac,_0x3f2ccd){const _0x3365bb=a138_0x115097;var _0x2d7166=arguments[_0x3365bb(0x1ad)],_0x3ddb45=_0x2d7166<0x3?_0xeab857:_0x3f2ccd===null?_0x3f2ccd=Object[_0x3365bb(0x1a2)](_0xeab857,_0xad2bac):_0x3f2ccd,_0x3e6880;if(typeof Reflect===_0x3365bb(0x18e)&&typeof Reflect[_0x3365bb(0x191)]==='function')_0x3ddb45=Reflect[_0x3365bb(0x191)](_0x4f7333,_0xeab857,_0xad2bac,_0x3f2ccd);else{for(var _0x4c3c92=_0x4f7333[_0x3365bb(0x1ad)]-0x1;_0x4c3c92>=0x0;_0x4c3c92--)if(_0x3e6880=_0x4f7333[_0x4c3c92])_0x3ddb45=(_0x2d7166<0x3?_0x3e6880(_0x3ddb45):_0x2d7166>0x3?_0x3e6880(_0xeab857,_0xad2bac,_0x3ddb45):_0x3e6880(_0xeab857,_0xad2bac))||_0x3ddb45;}return _0x2d7166>0x3&&_0x3ddb45&&Object['defineProperty'](_0xeab857,_0xad2bac,_0x3ddb45),_0x3ddb45;},__metadata=this&&this[a138_0x115097(0x1b3)]||function(_0x1ac710,_0x54a617){const _0x2cc6c0=a138_0x115097;if(typeof Reflect===_0x2cc6c0(0x18e)&&typeof Reflect[_0x2cc6c0(0x170)]===_0x2cc6c0(0x181))return Reflect['metadata'](_0x1ac710,_0x54a617);},StreamingService_1;function a138_0x32a4(){const _0x350f78=['userService','Server\x20stream\x20browser\x20already\x20open','exit','246oVNoaM','closeServerUIStream','2178052akidkS','getMasterUserAccessToken','focus','pipe','StreamingGateway','Error\x20when\x20close\x20page','6530768AeirkH','/stream','data','getOwnPropertyDescriptor','5lrEKrW','JwtService','@nestjs/jwt','1497717AiyTcc','stderr\x20data:\x20','10737661ytKVMp','page','getBrowserUrls','reconnectPeer','grep\x20process\x20exited\x20with\x20code\x20','length','2aDtWpb','stopStreamAudio','spawnMpgPlayer','stdout','child_process','__metadata','env','error','defineProperty','design:paramtypes','StreamingService','__esModule','UserService','metadata','kill','../helpers/puppeteer','code','STREAM_SERVER_URL','190phxart','streamingGateway','222192lymAKE','name','includes','logger','stderr','close','@nestjs/common','playStreamAudioAsync','801871pSuVCF','spawn','function','jwtService','createReadStream','../user/user.service','155813qSFgST','childProcess','prototype','stdin','log','openServerUIStream','Logger','Inject','playStreamAudio','object','__decorate','accessToken','decorate','browser','EPIPE'];a138_0x32a4=function(){return _0x350f78;};return a138_0x32a4();}Object[a138_0x115097(0x1b6)](exports,a138_0x115097(0x16e),{'value':!![]}),exports[a138_0x115097(0x16d)]=void 0x0;const common_1=require(a138_0x115097(0x17d)),child_process_1=require(a138_0x115097(0x1b2)),fs_1=require('fs'),puppeteer_1=require(a138_0x115097(0x172)),streaming_gateway_1=require('./streaming.gateway'),user_service_1=require(a138_0x115097(0x184)),jwt_1=require(a138_0x115097(0x1a5));let StreamingService=StreamingService_1=class StreamingService{constructor(_0x1b82e5,_0x5282b1){const _0x44245f=a138_0x115097;this[_0x44245f(0x194)]=_0x1b82e5,this[_0x44245f(0x182)]=_0x5282b1,this[_0x44245f(0x17a)]=new common_1[(_0x44245f(0x18b))](StreamingService_1[_0x44245f(0x178)]);}[a138_0x115097(0x1b0)](){const _0x230c43=a138_0x115097;if(!this[_0x230c43(0x186)])this['childProcess']=(0x0,child_process_1[_0x230c43(0x180)])('mpg123',['-']);}async[a138_0x115097(0x18d)](_0x48863d){const _0x5937c9=a138_0x115097;this[_0x5937c9(0x1b0)](),_0x48863d[_0x5937c9(0x19c)](this[_0x5937c9(0x186)][_0x5937c9(0x188)]),this[_0x5937c9(0x186)][_0x5937c9(0x1b1)]['on'](_0x5937c9(0x1b5),_0x1840ce=>{const _0x229f85=_0x5937c9;_0x1840ce[_0x229f85(0x173)]==_0x229f85(0x193)&&process[_0x229f85(0x196)](0x0);}),this['childProcess'][_0x5937c9(0x188)]['on'](_0x5937c9(0x1b5),_0x2f3f8b=>{const _0x390aaf=_0x5937c9;this[_0x390aaf(0x17a)][_0x390aaf(0x189)](_0x2f3f8b);}),this[_0x5937c9(0x186)]['stdout']['on'](_0x5937c9(0x1a1),_0x28dbe5=>{const _0x2050ad=_0x5937c9;this['logger'][_0x2050ad(0x189)]('stdout\x20data:\x20'+_0x28dbe5);}),this[_0x5937c9(0x186)]['stderr']['on'](_0x5937c9(0x1a1),_0x33d942=>{const _0x10c843=_0x5937c9;this['logger'][_0x10c843(0x189)]('stderr\x20data:\x20'+_0x33d942);}),this[_0x5937c9(0x186)]['on'](_0x5937c9(0x196),_0x385af4=>{const _0x3b97f2=_0x5937c9;this[_0x3b97f2(0x17a)][_0x3b97f2(0x189)]('exit'),this[_0x3b97f2(0x186)][_0x3b97f2(0x171)](),this[_0x3b97f2(0x186)]=null,_0x385af4!==0x0&&this['logger']['log'](_0x3b97f2(0x1ac)+_0x385af4);});return;}[a138_0x115097(0x17e)](_0x64e451){const _0x4b20dc=new Promise((_0x44a269,_0x562a88)=>{const _0x45f285=a138_0x19d9;this['spawnMpgPlayer'](),_0x64e451['pipe'](this[_0x45f285(0x186)][_0x45f285(0x188)]),this['childProcess'][_0x45f285(0x1b1)]['on'](_0x45f285(0x1b5),_0x17ed51=>{const _0x51dbbf=_0x45f285;_0x17ed51['code']==_0x51dbbf(0x193)&&process[_0x51dbbf(0x196)](0x0);}),this[_0x45f285(0x186)][_0x45f285(0x188)]['on'](_0x45f285(0x1b5),_0x5c3883=>{const _0x22c668=_0x45f285;this[_0x22c668(0x17a)][_0x22c668(0x189)](_0x5c3883);}),this[_0x45f285(0x186)][_0x45f285(0x1b1)]['on']('data',_0x357813=>{const _0x117aaa=_0x45f285;this[_0x117aaa(0x17a)][_0x117aaa(0x189)]('stdout\x20data:\x20'+_0x357813);}),this[_0x45f285(0x186)][_0x45f285(0x17b)]['on'](_0x45f285(0x1a1),_0x363b3c=>{const _0x4ab92e=_0x45f285;this[_0x4ab92e(0x17a)][_0x4ab92e(0x189)](_0x4ab92e(0x1a7)+_0x363b3c);}),this['childProcess']['on'](_0x45f285(0x196),_0x1416e9=>{const _0x4ebde6=_0x45f285;_0x44a269(!![]),this[_0x4ebde6(0x17a)][_0x4ebde6(0x189)](_0x4ebde6(0x196)),this[_0x4ebde6(0x186)][_0x4ebde6(0x171)](),this[_0x4ebde6(0x186)]=null,_0x1416e9!==0x0&&this[_0x4ebde6(0x17a)][_0x4ebde6(0x189)](_0x4ebde6(0x1ac)+_0x1416e9);});});return{'process':this['childProcess'],'promise':_0x4b20dc};}['createStreamFromFile'](_0x469df4){const _0x164dac=a138_0x115097;return(0x0,fs_1[_0x164dac(0x183)])(_0x469df4);}async[a138_0x115097(0x1af)](){this['childProcess']['kill']();}async[a138_0x115097(0x18a)](){const _0x48d5a8=a138_0x115097;try{const _0x5e94db=process[_0x48d5a8(0x1b4)]['STREAM_SERVER_URL']+_0x48d5a8(0x1a0);!this[_0x48d5a8(0x192)]&&(this[_0x48d5a8(0x192)]=await(0x0,puppeteer_1['launchBrowser'])());const _0x501b7f=await(0x0,puppeteer_1[_0x48d5a8(0x1aa)])(this[_0x48d5a8(0x192)]);if(_0x501b7f[_0x48d5a8(0x179)](_0x5e94db)){console[_0x48d5a8(0x189)](_0x48d5a8(0x195)),this[_0x48d5a8(0x176)][_0x48d5a8(0x1ab)]();return;}const _0x1e58f6=this[_0x48d5a8(0x1a9)]||await(0x0,puppeteer_1['openNewpage'])(this[_0x48d5a8(0x192)]),_0x44ce48=await this['userService'][_0x48d5a8(0x19a)]();await _0x1e58f6['setCookie']({'name':_0x48d5a8(0x190),'url':process['env'][_0x48d5a8(0x174)],'value':_0x44ce48}),await _0x1e58f6['goto'](_0x5e94db),await _0x1e58f6[_0x48d5a8(0x19b)]('body');}catch(_0x3492bd){console['log'](_0x3492bd,'Error\x20when\x20open\x20page');}}async[a138_0x115097(0x198)](){const _0x5a9953=a138_0x115097;try{this[_0x5a9953(0x1a9)]&&(await this[_0x5a9953(0x1a9)][_0x5a9953(0x17c)](),this[_0x5a9953(0x1a9)]=null);}catch(_0xd0bfa7){console['log'](_0xd0bfa7,_0x5a9953(0x19e));}}};__decorate([(0x0,common_1[a138_0x115097(0x18c)])(streaming_gateway_1[a138_0x115097(0x19d)]),__metadata('design:type',streaming_gateway_1['StreamingGateway'])],StreamingService[a138_0x115097(0x187)],'streamingGateway',void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(a138_0x115097(0x16c),[user_service_1[a138_0x115097(0x16f)],jwt_1[a138_0x115097(0x1a4)]])],StreamingService),exports[a138_0x115097(0x16d)]=StreamingService;