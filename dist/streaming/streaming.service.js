'use strict';function a138_0x44ad(){const _0x5dc1f5=['1495557bkoXtA','STREAM_SERVER_URL','prototype','child_process','reconnectPeer','Server\x20stream\x20browser\x20already\x20open','data','8tIecNc','@nestjs/common','length','playStreamAudio','defineProperty','stopStreamAudio','5482125oblMqV','function','createReadStream','Error\x20when\x20open\x20page','EPIPE','../helpers/puppeteer','stdout\x20data:\x20','spawn','userService','close','error','logger','./streaming.gateway','page','kill','focus','playStreamAudioAsync','log','Injectable','spawnMpgPlayer','/stream','1765768MGjxPR','578250NqKcGD','jwtService','metadata','Error\x20when\x20close\x20page','StreamingService','name','stdin','Logger','includes','Inject','@nestjs/jwt','closeServerUIStream','goto','getBrowserUrls','JwtService','env','stderr','pipe','code','stdout','grep\x20process\x20exited\x20with\x20code\x20','__esModule','StreamingGateway','createStreamFromFile','../user/user.service','7aSEOpD','mpg123','object','exit','streamingGateway','childProcess','5030574wsNspL','1909685RqGovP','openServerUIStream','decorate','UserService','design:type','launchBrowser','accessToken','browser','5419640YnclsZ'];a138_0x44ad=function(){return _0x5dc1f5;};return a138_0x44ad();}const a138_0x2bf8db=a138_0x2238;function a138_0x2238(_0x2e0d08,_0x19bc4f){const _0x44aded=a138_0x44ad();return a138_0x2238=function(_0x223896,_0x33c47b){_0x223896=_0x223896-0x162;let _0x323fc2=_0x44aded[_0x223896];return _0x323fc2;},a138_0x2238(_0x2e0d08,_0x19bc4f);}(function(_0x280e73,_0x4617e9){const _0x41eb40=a138_0x2238,_0x4ac980=_0x280e73();while(!![]){try{const _0x57949c=parseInt(_0x41eb40(0x179))/0x1+parseInt(_0x41eb40(0x178))/0x2+parseInt(_0x41eb40(0x1a2))/0x3+-parseInt(_0x41eb40(0x1a9))/0x4*(-parseInt(_0x41eb40(0x199))/0x5)+-parseInt(_0x41eb40(0x198))/0x6+-parseInt(_0x41eb40(0x192))/0x7*(parseInt(_0x41eb40(0x1a1))/0x8)+-parseInt(_0x41eb40(0x163))/0x9;if(_0x57949c===_0x4617e9)break;else _0x4ac980['push'](_0x4ac980['shift']());}catch(_0x4aa429){_0x4ac980['push'](_0x4ac980['shift']());}}}(a138_0x44ad,0x921f6));var __decorate=this&&this['__decorate']||function(_0x3be97b,_0x551dd2,_0x4b5b20,_0x10bdd3){const _0x1f42ce=a138_0x2238;var _0xbc13a9=arguments[_0x1f42ce(0x1ab)],_0x2d58db=_0xbc13a9<0x3?_0x551dd2:_0x10bdd3===null?_0x10bdd3=Object['getOwnPropertyDescriptor'](_0x551dd2,_0x4b5b20):_0x10bdd3,_0x253b34;if(typeof Reflect===_0x1f42ce(0x194)&&typeof Reflect[_0x1f42ce(0x19b)]===_0x1f42ce(0x164))_0x2d58db=Reflect[_0x1f42ce(0x19b)](_0x3be97b,_0x551dd2,_0x4b5b20,_0x10bdd3);else{for(var _0x2744c1=_0x3be97b[_0x1f42ce(0x1ab)]-0x1;_0x2744c1>=0x0;_0x2744c1--)if(_0x253b34=_0x3be97b[_0x2744c1])_0x2d58db=(_0xbc13a9<0x3?_0x253b34(_0x2d58db):_0xbc13a9>0x3?_0x253b34(_0x551dd2,_0x4b5b20,_0x2d58db):_0x253b34(_0x551dd2,_0x4b5b20))||_0x2d58db;}return _0xbc13a9>0x3&&_0x2d58db&&Object[_0x1f42ce(0x1ad)](_0x551dd2,_0x4b5b20,_0x2d58db),_0x2d58db;},__metadata=this&&this['__metadata']||function(_0x18f5b7,_0x419a58){const _0x485fb4=a138_0x2238;if(typeof Reflect===_0x485fb4(0x194)&&typeof Reflect[_0x485fb4(0x17b)]===_0x485fb4(0x164))return Reflect[_0x485fb4(0x17b)](_0x18f5b7,_0x419a58);},StreamingService_1;Object[a138_0x2bf8db(0x1ad)](exports,a138_0x2bf8db(0x18e),{'value':!![]}),exports[a138_0x2bf8db(0x17d)]=void 0x0;const common_1=require(a138_0x2bf8db(0x1aa)),child_process_1=require(a138_0x2bf8db(0x1a5)),fs_1=require('fs'),puppeteer_1=require(a138_0x2bf8db(0x168)),streaming_gateway_1=require(a138_0x2bf8db(0x16f)),user_service_1=require(a138_0x2bf8db(0x191)),jwt_1=require(a138_0x2bf8db(0x183));let StreamingService=StreamingService_1=class StreamingService{constructor(_0x44713f,_0x444c4b){const _0x321573=a138_0x2bf8db;this[_0x321573(0x16b)]=_0x44713f,this[_0x321573(0x17a)]=_0x444c4b,this[_0x321573(0x16e)]=new common_1[(_0x321573(0x180))](StreamingService_1[_0x321573(0x17e)]);}['spawnMpgPlayer'](){const _0x409479=a138_0x2bf8db;if(!this[_0x409479(0x197)])this[_0x409479(0x197)]=(0x0,child_process_1[_0x409479(0x16a)])(_0x409479(0x193),['-']);}async[a138_0x2bf8db(0x1ac)](_0x482fe3){const _0x3512aa=a138_0x2bf8db;this['spawnMpgPlayer'](),_0x482fe3[_0x3512aa(0x18a)](this[_0x3512aa(0x197)]['stdin']),this['childProcess'][_0x3512aa(0x18c)]['on'](_0x3512aa(0x16d),_0x506f06=>{const _0x1f8ea5=_0x3512aa;_0x506f06[_0x1f8ea5(0x18b)]==_0x1f8ea5(0x167)&&process[_0x1f8ea5(0x195)](0x0);}),this['childProcess'][_0x3512aa(0x17f)]['on']('error',_0x7291ad=>{const _0x397025=_0x3512aa;this[_0x397025(0x16e)][_0x397025(0x174)](_0x7291ad);}),this['childProcess'][_0x3512aa(0x18c)]['on'](_0x3512aa(0x1a8),_0xc5fd6a=>{const _0xf15875=_0x3512aa;this[_0xf15875(0x16e)][_0xf15875(0x174)](_0xf15875(0x169)+_0xc5fd6a);}),this['childProcess'][_0x3512aa(0x189)]['on'](_0x3512aa(0x1a8),_0x1ad8b0=>{const _0x1e1628=_0x3512aa;this[_0x1e1628(0x16e)][_0x1e1628(0x174)]('stderr\x20data:\x20'+_0x1ad8b0);}),this[_0x3512aa(0x197)]['on'](_0x3512aa(0x195),_0x40f314=>{const _0x429134=_0x3512aa;this['logger'][_0x429134(0x174)](_0x429134(0x195)),this[_0x429134(0x197)][_0x429134(0x171)](),this[_0x429134(0x197)]=null,_0x40f314!==0x0&&this[_0x429134(0x16e)][_0x429134(0x174)](_0x429134(0x18d)+_0x40f314);});return;}[a138_0x2bf8db(0x173)](_0x79a65b){const _0x4bbeea=new Promise((_0x3b9bd9,_0x30d6cf)=>{const _0x1fc9cd=a138_0x2238;this[_0x1fc9cd(0x176)](),_0x79a65b['pipe'](this['childProcess'][_0x1fc9cd(0x17f)]),this['childProcess']['stdout']['on'](_0x1fc9cd(0x16d),_0x59ac63=>{const _0x2ad55f=_0x1fc9cd;_0x59ac63[_0x2ad55f(0x18b)]==_0x2ad55f(0x167)&&process[_0x2ad55f(0x195)](0x0);}),this['childProcess'][_0x1fc9cd(0x17f)]['on'](_0x1fc9cd(0x16d),_0x5c3cef=>{const _0xa05f66=_0x1fc9cd;this[_0xa05f66(0x16e)][_0xa05f66(0x174)](_0x5c3cef);}),this[_0x1fc9cd(0x197)][_0x1fc9cd(0x18c)]['on']('data',_0x396d70=>{const _0x2e5bf6=_0x1fc9cd;this['logger'][_0x2e5bf6(0x174)]('stdout\x20data:\x20'+_0x396d70);}),this[_0x1fc9cd(0x197)]['stderr']['on'](_0x1fc9cd(0x1a8),_0x4dfc01=>{const _0x1c459d=_0x1fc9cd;this[_0x1c459d(0x16e)]['log']('stderr\x20data:\x20'+_0x4dfc01);}),this['childProcess']['on'](_0x1fc9cd(0x195),_0x525601=>{const _0x19e9fa=_0x1fc9cd;_0x3b9bd9(!![]),this['logger'][_0x19e9fa(0x174)](_0x19e9fa(0x195)),this[_0x19e9fa(0x197)][_0x19e9fa(0x171)](),this[_0x19e9fa(0x197)]=null,_0x525601!==0x0&&this[_0x19e9fa(0x16e)]['log']('grep\x20process\x20exited\x20with\x20code\x20'+_0x525601);});});return{'process':this['childProcess'],'promise':_0x4bbeea};}[a138_0x2bf8db(0x190)](_0x3e3c4e){const _0x1ef97f=a138_0x2bf8db;return(0x0,fs_1[_0x1ef97f(0x165)])(_0x3e3c4e);}async[a138_0x2bf8db(0x162)](){const _0x263e4b=a138_0x2bf8db;this[_0x263e4b(0x197)][_0x263e4b(0x171)]();}async[a138_0x2bf8db(0x19a)](){const _0x3ca445=a138_0x2bf8db;try{const _0x492743=process[_0x3ca445(0x188)]['STREAM_SERVER_URL']+_0x3ca445(0x177);!this[_0x3ca445(0x1a0)]&&(this[_0x3ca445(0x1a0)]=await(0x0,puppeteer_1[_0x3ca445(0x19e)])());const _0x5350e1=await(0x0,puppeteer_1[_0x3ca445(0x186)])(this[_0x3ca445(0x1a0)]);if(_0x5350e1[_0x3ca445(0x181)](_0x492743)){console[_0x3ca445(0x174)](_0x3ca445(0x1a7)),this[_0x3ca445(0x196)][_0x3ca445(0x1a6)]();return;}const _0x14f7af=this[_0x3ca445(0x170)]||await(0x0,puppeteer_1['openNewpage'])(this[_0x3ca445(0x1a0)]),_0x192336=await this[_0x3ca445(0x16b)]['getMasterUserAccessToken']();await _0x14f7af['setCookie']({'name':_0x3ca445(0x19f),'url':process[_0x3ca445(0x188)][_0x3ca445(0x1a3)],'value':_0x192336}),await _0x14f7af[_0x3ca445(0x185)](_0x492743),await _0x14f7af[_0x3ca445(0x172)]('body');}catch(_0x532851){console[_0x3ca445(0x174)](_0x532851,_0x3ca445(0x166));}}async[a138_0x2bf8db(0x184)](){const _0x40d51c=a138_0x2bf8db;try{this[_0x40d51c(0x170)]&&(await this['page'][_0x40d51c(0x16c)](),this[_0x40d51c(0x170)]=null);}catch(_0x4a6457){console[_0x40d51c(0x174)](_0x4a6457,_0x40d51c(0x17c));}}};__decorate([(0x0,common_1[a138_0x2bf8db(0x182)])(streaming_gateway_1['StreamingGateway']),__metadata(a138_0x2bf8db(0x19d),streaming_gateway_1[a138_0x2bf8db(0x18f)])],StreamingService[a138_0x2bf8db(0x1a4)],'streamingGateway',void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a138_0x2bf8db(0x175)])(),__metadata('design:paramtypes',[user_service_1[a138_0x2bf8db(0x19c)],jwt_1[a138_0x2bf8db(0x187)]])],StreamingService),exports[a138_0x2bf8db(0x17d)]=StreamingService;