'use strict';const a141_0x5061cb=a141_0x8176;(function(_0x5b890f,_0xfc5d1b){const _0x39de9d=a141_0x8176,_0x28fe9a=_0x5b890f();while(!![]){try{const _0x4b7f19=parseInt(_0x39de9d(0x1dd))/0x1+-parseInt(_0x39de9d(0x1b7))/0x2+-parseInt(_0x39de9d(0x1e8))/0x3*(-parseInt(_0x39de9d(0x1c1))/0x4)+parseInt(_0x39de9d(0x1c6))/0x5+-parseInt(_0x39de9d(0x1e3))/0x6*(-parseInt(_0x39de9d(0x1d3))/0x7)+-parseInt(_0x39de9d(0x1d0))/0x8+-parseInt(_0x39de9d(0x1e0))/0x9;if(_0x4b7f19===_0xfc5d1b)break;else _0x28fe9a['push'](_0x28fe9a['shift']());}catch(_0x15e1e2){_0x28fe9a['push'](_0x28fe9a['shift']());}}}(a141_0x5de1,0xa3d0b));function a141_0x5de1(){const _0x51da5b=['1573528jvKNkT','length','log','91qvzafC','stderr\x20data:\x20','pipe','env','getMasterUserAccessToken','body','jwtService','openNewpage','logger','stopStreamAudio','670770dJKGNp','playStreamAudioAsync','exit','6410592hQlfer','spawnMpgPlayer','page','476706gWxTLg','userService','Server\x20stream\x20browser\x20already\x20open','openServerUIStream','Injectable','3sRxnId','grep\x20process\x20exited\x20with\x20code\x20','closeServerUIStream','Logger','setCookie','STREAM_SERVER_URL','Error\x20when\x20open\x20page','__metadata','stdout','browser','decorate','close','UserService','spawn','stdin','metadata','streamingGateway','object','@nestjs/common','kill','childProcess','code','data','function','2550758dqRgvy','StreamingService','StreamingGateway','/stream','../helpers/puppeteer','error','./streaming.gateway','stderr','Inject','Error\x20when\x20close\x20page','188348AbDFHy','stdout\x20data:\x20','EPIPE','playStreamAudio','@nestjs/jwt','5523125hyZQAy','includes','accessToken','goto','name','focus','child_process','createStreamFromFile','JwtService','__decorate'];a141_0x5de1=function(){return _0x51da5b;};return a141_0x5de1();}function a141_0x8176(_0x9e0382,_0x40b11e){const _0x5de161=a141_0x5de1();return a141_0x8176=function(_0x81760f,_0x588075){_0x81760f=_0x81760f-0x1a7;let _0x3cb579=_0x5de161[_0x81760f];return _0x3cb579;},a141_0x8176(_0x9e0382,_0x40b11e);}var __decorate=this&&this[a141_0x5061cb(0x1cf)]||function(_0x748e0b,_0x243ace,_0x3576c5,_0xf7a519){const _0x5dc1de=a141_0x5061cb;var _0x3c1198=arguments[_0x5dc1de(0x1d1)],_0x218b90=_0x3c1198<0x3?_0x243ace:_0xf7a519===null?_0xf7a519=Object['getOwnPropertyDescriptor'](_0x243ace,_0x3576c5):_0xf7a519,_0x53e798;if(typeof Reflect===_0x5dc1de(0x1b0)&&typeof Reflect[_0x5dc1de(0x1a9)]===_0x5dc1de(0x1b6))_0x218b90=Reflect[_0x5dc1de(0x1a9)](_0x748e0b,_0x243ace,_0x3576c5,_0xf7a519);else{for(var _0x54f56e=_0x748e0b['length']-0x1;_0x54f56e>=0x0;_0x54f56e--)if(_0x53e798=_0x748e0b[_0x54f56e])_0x218b90=(_0x3c1198<0x3?_0x53e798(_0x218b90):_0x3c1198>0x3?_0x53e798(_0x243ace,_0x3576c5,_0x218b90):_0x53e798(_0x243ace,_0x3576c5))||_0x218b90;}return _0x3c1198>0x3&&_0x218b90&&Object['defineProperty'](_0x243ace,_0x3576c5,_0x218b90),_0x218b90;},__metadata=this&&this[a141_0x5061cb(0x1ef)]||function(_0x2e6fc8,_0x2c53c1){const _0x57b588=a141_0x5061cb;if(typeof Reflect===_0x57b588(0x1b0)&&typeof Reflect['metadata']===_0x57b588(0x1b6))return Reflect[_0x57b588(0x1ae)](_0x2e6fc8,_0x2c53c1);},StreamingService_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a141_0x5061cb(0x1b8)]=void 0x0;const common_1=require(a141_0x5061cb(0x1b1)),child_process_1=require(a141_0x5061cb(0x1cc)),fs_1=require('fs'),puppeteer_1=require(a141_0x5061cb(0x1bb)),streaming_gateway_1=require(a141_0x5061cb(0x1bd)),user_service_1=require('../user/user.service'),jwt_1=require(a141_0x5061cb(0x1c5));let StreamingService=StreamingService_1=class StreamingService{constructor(_0x59d5e2,_0x64dda6){const _0x535b69=a141_0x5061cb;this[_0x535b69(0x1e4)]=_0x59d5e2,this[_0x535b69(0x1d9)]=_0x64dda6,this['logger']=new common_1[(_0x535b69(0x1eb))](StreamingService_1[_0x535b69(0x1ca)]);}[a141_0x5061cb(0x1e1)](){const _0x2488d4=a141_0x5061cb;if(!this[_0x2488d4(0x1b3)])this['childProcess']=(0x0,child_process_1[_0x2488d4(0x1ac)])('mpg123',['-']);}async[a141_0x5061cb(0x1c4)](_0x58d3e4){const _0x583054=a141_0x5061cb;this[_0x583054(0x1e1)](),_0x58d3e4[_0x583054(0x1d5)](this[_0x583054(0x1b3)][_0x583054(0x1ad)]),this[_0x583054(0x1b3)][_0x583054(0x1a7)]['on'](_0x583054(0x1bc),_0x4c79f7=>{const _0xa81462=_0x583054;_0x4c79f7[_0xa81462(0x1b4)]==_0xa81462(0x1c3)&&process[_0xa81462(0x1df)](0x0);}),this[_0x583054(0x1b3)][_0x583054(0x1ad)]['on'](_0x583054(0x1bc),_0x722acd=>{const _0x498161=_0x583054;this['logger'][_0x498161(0x1d2)](_0x722acd);}),this[_0x583054(0x1b3)][_0x583054(0x1a7)]['on'](_0x583054(0x1b5),_0x3028a3=>{const _0x17eb89=_0x583054;this[_0x17eb89(0x1db)][_0x17eb89(0x1d2)](_0x17eb89(0x1c2)+_0x3028a3);}),this[_0x583054(0x1b3)][_0x583054(0x1be)]['on'](_0x583054(0x1b5),_0x130023=>{const _0x47a173=_0x583054;this[_0x47a173(0x1db)][_0x47a173(0x1d2)](_0x47a173(0x1d4)+_0x130023);}),this['childProcess']['on'](_0x583054(0x1df),_0x715da8=>{const _0xddefab=_0x583054;this[_0xddefab(0x1db)][_0xddefab(0x1d2)](_0xddefab(0x1df)),this['childProcess']['kill'](),this[_0xddefab(0x1b3)]=null,_0x715da8!==0x0&&this[_0xddefab(0x1db)][_0xddefab(0x1d2)](_0xddefab(0x1e9)+_0x715da8);});return;}[a141_0x5061cb(0x1de)](_0x257a84){const _0x347977=a141_0x5061cb,_0x1dc2c7=new Promise((_0x4a51a5,_0x135458)=>{const _0x486a82=a141_0x8176;this[_0x486a82(0x1e1)](),_0x257a84[_0x486a82(0x1d5)](this['childProcess'][_0x486a82(0x1ad)]),this[_0x486a82(0x1b3)][_0x486a82(0x1a7)]['on'](_0x486a82(0x1bc),_0x1366ca=>{const _0x5da7d5=_0x486a82;_0x1366ca['code']==_0x5da7d5(0x1c3)&&process[_0x5da7d5(0x1df)](0x0);}),this[_0x486a82(0x1b3)][_0x486a82(0x1ad)]['on'](_0x486a82(0x1bc),_0x545830=>{const _0x4a9360=_0x486a82;this[_0x4a9360(0x1db)][_0x4a9360(0x1d2)](_0x545830);}),this[_0x486a82(0x1b3)]['stdout']['on']('data',_0x3cb34d=>{const _0x2b101f=_0x486a82;this[_0x2b101f(0x1db)][_0x2b101f(0x1d2)](_0x2b101f(0x1c2)+_0x3cb34d);}),this[_0x486a82(0x1b3)][_0x486a82(0x1be)]['on'](_0x486a82(0x1b5),_0x3ea18d=>{const _0x1bb760=_0x486a82;this[_0x1bb760(0x1db)]['log'](_0x1bb760(0x1d4)+_0x3ea18d);}),this['childProcess']['on'](_0x486a82(0x1df),_0x403af6=>{const _0x59bc30=_0x486a82;_0x4a51a5(!![]),this[_0x59bc30(0x1db)][_0x59bc30(0x1d2)](_0x59bc30(0x1df)),this['childProcess'][_0x59bc30(0x1b2)](),this['childProcess']=null,_0x403af6!==0x0&&this[_0x59bc30(0x1db)][_0x59bc30(0x1d2)]('grep\x20process\x20exited\x20with\x20code\x20'+_0x403af6);});});return{'process':this[_0x347977(0x1b3)],'promise':_0x1dc2c7};}[a141_0x5061cb(0x1cd)](_0x29ac78){return(0x0,fs_1['createReadStream'])(_0x29ac78);}async[a141_0x5061cb(0x1dc)](){const _0x1d475b=a141_0x5061cb;this[_0x1d475b(0x1b3)]['kill']();}async[a141_0x5061cb(0x1e6)](){const _0x319e82=a141_0x5061cb;try{const _0x143d5a=process[_0x319e82(0x1d6)][_0x319e82(0x1ed)]+_0x319e82(0x1ba);!this[_0x319e82(0x1a8)]&&(this['browser']=await(0x0,puppeteer_1['launchBrowser'])());const _0x54f6f5=await(0x0,puppeteer_1['getBrowserUrls'])(this['browser']);if(_0x54f6f5[_0x319e82(0x1c7)](_0x143d5a)){console[_0x319e82(0x1d2)](_0x319e82(0x1e5)),this[_0x319e82(0x1af)]['reconnectPeer']();return;}const _0x531e3e=this[_0x319e82(0x1e2)]||await(0x0,puppeteer_1[_0x319e82(0x1da)])(this['browser']),_0x8d7bee=await this[_0x319e82(0x1e4)][_0x319e82(0x1d7)]();await _0x531e3e[_0x319e82(0x1ec)]({'name':_0x319e82(0x1c8),'url':process[_0x319e82(0x1d6)]['STREAM_SERVER_URL'],'value':_0x8d7bee}),await _0x531e3e[_0x319e82(0x1c9)](_0x143d5a),await _0x531e3e[_0x319e82(0x1cb)](_0x319e82(0x1d8));}catch(_0x5e5ac7){console[_0x319e82(0x1d2)](_0x5e5ac7,_0x319e82(0x1ee));}}async[a141_0x5061cb(0x1ea)](){const _0x4478a4=a141_0x5061cb;try{this[_0x4478a4(0x1e2)]&&(await this['page'][_0x4478a4(0x1aa)](),this[_0x4478a4(0x1e2)]=null);}catch(_0x2dfa0a){console[_0x4478a4(0x1d2)](_0x2dfa0a,_0x4478a4(0x1c0));}}};__decorate([(0x0,common_1[a141_0x5061cb(0x1bf)])(streaming_gateway_1[a141_0x5061cb(0x1b9)]),__metadata('design:type',streaming_gateway_1[a141_0x5061cb(0x1b9)])],StreamingService['prototype'],a141_0x5061cb(0x1af),void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a141_0x5061cb(0x1e7)])(),__metadata('design:paramtypes',[user_service_1[a141_0x5061cb(0x1ab)],jwt_1[a141_0x5061cb(0x1ce)]])],StreamingService),exports['StreamingService']=StreamingService;