'use strict';function a141_0xd97d(){const _0x116d91=['setCookie','goto','data','includes','spawnMpgPlayer','37639572QnmYZx','openNewpage','length','@nestjs/common','openServerUIStream','77WsrDUj','stdout','closeServerUIStream','stdin','Error\x20when\x20close\x20page','Error\x20when\x20open\x20page','exit','getMasterUserAccessToken','getBrowserUrls','getOwnPropertyDescriptor','function','object','playStreamAudioAsync','STREAM_SERVER_URL','__decorate','browser','prototype','kill','Server\x20stream\x20browser\x20already\x20open','error','58498dsoWIz','mpg123','page','stdout\x20data:\x20','Injectable','pipe','2319898SszPDP','logger','UserService','@nestjs/jwt','13dxoXeA','childProcess','__esModule','jwtService','8JEpOSu','9067887AKWcsX','streamingGateway','stopStreamAudio','327945EPrEnN','decorate','Logger','2066450gbgSHo','40HRmDux','env','spawn','EPIPE','JwtService','1086MjrhJT','stderr','createReadStream','grep\x20process\x20exited\x20with\x20code\x20','log','defineProperty','playStreamAudio','22885CacPPX','stderr\x20data:\x20','child_process','StreamingGateway','/stream','metadata','reconnectPeer','StreamingService'];a141_0xd97d=function(){return _0x116d91;};return a141_0xd97d();}const a141_0x1a895d=a141_0x2c78;(function(_0xe38bf7,_0x4ba3b0){const _0x1090be=a141_0x2c78,_0xb781bf=_0xe38bf7();while(!![]){try{const _0x8bdc92=-parseInt(_0x1090be(0x168))/0x1*(parseInt(_0x1090be(0x15e))/0x2)+parseInt(_0x1090be(0x170))/0x3*(-parseInt(_0x1090be(0x174))/0x4)+-parseInt(_0x1090be(0x180))/0x5*(parseInt(_0x1090be(0x179))/0x6)+parseInt(_0x1090be(0x164))/0x7+parseInt(_0x1090be(0x16c))/0x8*(parseInt(_0x1090be(0x16d))/0x9)+parseInt(_0x1090be(0x173))/0xa*(-parseInt(_0x1090be(0x14a))/0xb)+parseInt(_0x1090be(0x145))/0xc;if(_0x8bdc92===_0x4ba3b0)break;else _0xb781bf['push'](_0xb781bf['shift']());}catch(_0x33150e){_0xb781bf['push'](_0xb781bf['shift']());}}}(a141_0xd97d,0xb18d1));var __decorate=this&&this[a141_0x1a895d(0x158)]||function(_0x2f3d5a,_0x4c9513,_0xee9ff4,_0x20a0b4){const _0xd097c=a141_0x1a895d;var _0x216083=arguments[_0xd097c(0x147)],_0x56aaf9=_0x216083<0x3?_0x4c9513:_0x20a0b4===null?_0x20a0b4=Object[_0xd097c(0x153)](_0x4c9513,_0xee9ff4):_0x20a0b4,_0x3a87e6;if(typeof Reflect===_0xd097c(0x155)&&typeof Reflect['decorate']==='function')_0x56aaf9=Reflect[_0xd097c(0x171)](_0x2f3d5a,_0x4c9513,_0xee9ff4,_0x20a0b4);else{for(var _0x592d66=_0x2f3d5a[_0xd097c(0x147)]-0x1;_0x592d66>=0x0;_0x592d66--)if(_0x3a87e6=_0x2f3d5a[_0x592d66])_0x56aaf9=(_0x216083<0x3?_0x3a87e6(_0x56aaf9):_0x216083>0x3?_0x3a87e6(_0x4c9513,_0xee9ff4,_0x56aaf9):_0x3a87e6(_0x4c9513,_0xee9ff4))||_0x56aaf9;}return _0x216083>0x3&&_0x56aaf9&&Object['defineProperty'](_0x4c9513,_0xee9ff4,_0x56aaf9),_0x56aaf9;},__metadata=this&&this['__metadata']||function(_0x1df12d,_0x5dd419){const _0x2a759c=a141_0x1a895d;if(typeof Reflect===_0x2a759c(0x155)&&typeof Reflect['metadata']===_0x2a759c(0x154))return Reflect[_0x2a759c(0x13d)](_0x1df12d,_0x5dd419);},StreamingService_1;Object[a141_0x1a895d(0x17e)](exports,a141_0x1a895d(0x16a),{'value':!![]}),exports[a141_0x1a895d(0x13f)]=void 0x0;const common_1=require(a141_0x1a895d(0x148)),child_process_1=require(a141_0x1a895d(0x182)),fs_1=require('fs'),puppeteer_1=require('../helpers/puppeteer'),streaming_gateway_1=require('./streaming.gateway'),user_service_1=require('../user/user.service'),jwt_1=require(a141_0x1a895d(0x167));function a141_0x2c78(_0x52b7a6,_0x37571){const _0xd97ddc=a141_0xd97d();return a141_0x2c78=function(_0x2c780f,_0x5f4d2d){_0x2c780f=_0x2c780f-0x13c;let _0xb2eea5=_0xd97ddc[_0x2c780f];return _0xb2eea5;},a141_0x2c78(_0x52b7a6,_0x37571);}let StreamingService=StreamingService_1=class StreamingService{constructor(_0x4d8409,_0x2e99b6){const _0x54da4e=a141_0x1a895d;this['userService']=_0x4d8409,this[_0x54da4e(0x16b)]=_0x2e99b6,this[_0x54da4e(0x165)]=new common_1[(_0x54da4e(0x172))](StreamingService_1['name']);}[a141_0x1a895d(0x144)](){const _0x1b3114=a141_0x1a895d;if(!this[_0x1b3114(0x169)])this[_0x1b3114(0x169)]=(0x0,child_process_1[_0x1b3114(0x176)])(_0x1b3114(0x15f),['-']);}async[a141_0x1a895d(0x17f)](_0x5118ad){const _0x5e4420=a141_0x1a895d;this[_0x5e4420(0x144)](),_0x5118ad[_0x5e4420(0x163)](this[_0x5e4420(0x169)][_0x5e4420(0x14d)]),this[_0x5e4420(0x169)]['stdout']['on'](_0x5e4420(0x15d),_0x51377a=>{const _0x2e33c3=_0x5e4420;_0x51377a['code']==_0x2e33c3(0x177)&&process[_0x2e33c3(0x150)](0x0);}),this[_0x5e4420(0x169)][_0x5e4420(0x14d)]['on']('error',_0xf77fa4=>{const _0x15e91a=_0x5e4420;this[_0x15e91a(0x165)][_0x15e91a(0x17d)](_0xf77fa4);}),this[_0x5e4420(0x169)][_0x5e4420(0x14b)]['on'](_0x5e4420(0x142),_0xba965b=>{const _0x2652fe=_0x5e4420;this['logger'][_0x2652fe(0x17d)](_0x2652fe(0x161)+_0xba965b);}),this[_0x5e4420(0x169)][_0x5e4420(0x17a)]['on'](_0x5e4420(0x142),_0xd7ec83=>{const _0x458285=_0x5e4420;this[_0x458285(0x165)]['log'](_0x458285(0x181)+_0xd7ec83);}),this[_0x5e4420(0x169)]['on'](_0x5e4420(0x150),_0x578ada=>{const _0x346d52=_0x5e4420;this[_0x346d52(0x165)][_0x346d52(0x17d)](_0x346d52(0x150)),this[_0x346d52(0x169)]['kill'](),this['childProcess']=null,_0x578ada!==0x0&&this[_0x346d52(0x165)][_0x346d52(0x17d)](_0x346d52(0x17c)+_0x578ada);});return;}[a141_0x1a895d(0x156)](_0x333a0d){const _0x503721=a141_0x1a895d,_0x17ca36=new Promise((_0x1628af,_0x491c62)=>{const _0x4dfa26=a141_0x2c78;this[_0x4dfa26(0x144)](),_0x333a0d[_0x4dfa26(0x163)](this[_0x4dfa26(0x169)]['stdin']),this[_0x4dfa26(0x169)][_0x4dfa26(0x14b)]['on'](_0x4dfa26(0x15d),_0x5f4843=>{const _0x4d9ca1=_0x4dfa26;_0x5f4843['code']==_0x4d9ca1(0x177)&&process[_0x4d9ca1(0x150)](0x0);}),this[_0x4dfa26(0x169)][_0x4dfa26(0x14d)]['on'](_0x4dfa26(0x15d),_0x2044ca=>{const _0x436d16=_0x4dfa26;this[_0x436d16(0x165)][_0x436d16(0x17d)](_0x2044ca);}),this[_0x4dfa26(0x169)][_0x4dfa26(0x14b)]['on'](_0x4dfa26(0x142),_0x27aa91=>{const _0x5a8dae=_0x4dfa26;this[_0x5a8dae(0x165)][_0x5a8dae(0x17d)](_0x5a8dae(0x161)+_0x27aa91);}),this[_0x4dfa26(0x169)][_0x4dfa26(0x17a)]['on']('data',_0x339ed0=>{const _0x561269=_0x4dfa26;this['logger']['log'](_0x561269(0x181)+_0x339ed0);}),this['childProcess']['on'](_0x4dfa26(0x150),_0x4e8896=>{const _0x4175a5=_0x4dfa26;_0x1628af(!![]),this[_0x4175a5(0x165)][_0x4175a5(0x17d)](_0x4175a5(0x150)),this[_0x4175a5(0x169)]['kill'](),this[_0x4175a5(0x169)]=null,_0x4e8896!==0x0&&this[_0x4175a5(0x165)][_0x4175a5(0x17d)](_0x4175a5(0x17c)+_0x4e8896);});});return{'process':this[_0x503721(0x169)],'promise':_0x17ca36};}['createStreamFromFile'](_0x459148){const _0x4d4d79=a141_0x1a895d;return(0x0,fs_1[_0x4d4d79(0x17b)])(_0x459148);}async[a141_0x1a895d(0x16f)](){const _0x2ae197=a141_0x1a895d;this[_0x2ae197(0x169)][_0x2ae197(0x15b)]();}async[a141_0x1a895d(0x149)](){const _0x4a95da=a141_0x1a895d;try{const _0x1c6eb8=process[_0x4a95da(0x175)]['STREAM_SERVER_URL']+_0x4a95da(0x13c);!this[_0x4a95da(0x159)]&&(this[_0x4a95da(0x159)]=await(0x0,puppeteer_1['launchBrowser'])());const _0x557e98=await(0x0,puppeteer_1[_0x4a95da(0x152)])(this['browser']);if(_0x557e98[_0x4a95da(0x143)](_0x1c6eb8)){console[_0x4a95da(0x17d)](_0x4a95da(0x15c)),this[_0x4a95da(0x16e)][_0x4a95da(0x13e)]();return;}const _0x516333=this[_0x4a95da(0x160)]||await(0x0,puppeteer_1[_0x4a95da(0x146)])(this[_0x4a95da(0x159)]),_0x28b964=await this['userService'][_0x4a95da(0x151)]();await _0x516333[_0x4a95da(0x140)]({'name':'accessToken','url':process[_0x4a95da(0x175)][_0x4a95da(0x157)],'value':_0x28b964}),await _0x516333[_0x4a95da(0x141)](_0x1c6eb8),await _0x516333['focus']('body');}catch(_0x4aeba2){console[_0x4a95da(0x17d)](_0x4aeba2,_0x4a95da(0x14f));}}async[a141_0x1a895d(0x14c)](){const _0x282316=a141_0x1a895d;try{this[_0x282316(0x160)]&&(await this['page']['close'](),this['page']=null);}catch(_0x1b4e3d){console[_0x282316(0x17d)](_0x1b4e3d,_0x282316(0x14e));}}};__decorate([(0x0,common_1['Inject'])(streaming_gateway_1[a141_0x1a895d(0x183)]),__metadata('design:type',streaming_gateway_1[a141_0x1a895d(0x183)])],StreamingService[a141_0x1a895d(0x15a)],'streamingGateway',void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a141_0x1a895d(0x162)])(),__metadata('design:paramtypes',[user_service_1[a141_0x1a895d(0x166)],jwt_1[a141_0x1a895d(0x178)]])],StreamingService),exports[a141_0x1a895d(0x13f)]=StreamingService;