'use strict';function a141_0x32c6(_0x5ad6f0,_0x3b083b){const _0x57547a=a141_0x5754();return a141_0x32c6=function(_0x32c6ce,_0x4864ea){_0x32c6ce=_0x32c6ce-0x17a;let _0x5090ba=_0x57547a[_0x32c6ce];return _0x5090ba;},a141_0x32c6(_0x5ad6f0,_0x3b083b);}const a141_0x1538a9=a141_0x32c6;(function(_0x5360fb,_0x57db31){const _0x24f5bf=a141_0x32c6,_0x472869=_0x5360fb();while(!![]){try{const _0x1e73c0=parseInt(_0x24f5bf(0x17e))/0x1+parseInt(_0x24f5bf(0x185))/0x2+-parseInt(_0x24f5bf(0x19d))/0x3+-parseInt(_0x24f5bf(0x17f))/0x4*(-parseInt(_0x24f5bf(0x1ab))/0x5)+parseInt(_0x24f5bf(0x1c2))/0x6*(parseInt(_0x24f5bf(0x1c5))/0x7)+parseInt(_0x24f5bf(0x1a8))/0x8*(parseInt(_0x24f5bf(0x1bd))/0x9)+-parseInt(_0x24f5bf(0x1ba))/0xa;if(_0x1e73c0===_0x57db31)break;else _0x472869['push'](_0x472869['shift']());}catch(_0x2509f3){_0x472869['push'](_0x472869['shift']());}}}(a141_0x5754,0x8ffd7));var __decorate=this&&this['__decorate']||function(_0x3d780d,_0x3f3980,_0x3367a2,_0x41bac5){const _0x2e7175=a141_0x32c6;var _0x21542d=arguments[_0x2e7175(0x187)],_0x11ff37=_0x21542d<0x3?_0x3f3980:_0x41bac5===null?_0x41bac5=Object[_0x2e7175(0x19e)](_0x3f3980,_0x3367a2):_0x41bac5,_0x1ae22a;if(typeof Reflect===_0x2e7175(0x1af)&&typeof Reflect[_0x2e7175(0x191)]===_0x2e7175(0x19c))_0x11ff37=Reflect['decorate'](_0x3d780d,_0x3f3980,_0x3367a2,_0x41bac5);else{for(var _0x9da674=_0x3d780d[_0x2e7175(0x187)]-0x1;_0x9da674>=0x0;_0x9da674--)if(_0x1ae22a=_0x3d780d[_0x9da674])_0x11ff37=(_0x21542d<0x3?_0x1ae22a(_0x11ff37):_0x21542d>0x3?_0x1ae22a(_0x3f3980,_0x3367a2,_0x11ff37):_0x1ae22a(_0x3f3980,_0x3367a2))||_0x11ff37;}return _0x21542d>0x3&&_0x11ff37&&Object[_0x2e7175(0x1b5)](_0x3f3980,_0x3367a2,_0x11ff37),_0x11ff37;},__metadata=this&&this[a141_0x1538a9(0x1ac)]||function(_0x1bf1b6,_0x5841c2){const _0x3f54f3=a141_0x1538a9;if(typeof Reflect===_0x3f54f3(0x1af)&&typeof Reflect[_0x3f54f3(0x184)]==='function')return Reflect[_0x3f54f3(0x184)](_0x1bf1b6,_0x5841c2);},StreamingService_1;Object[a141_0x1538a9(0x1b5)](exports,a141_0x1538a9(0x1a0),{'value':!![]}),exports['StreamingService']=void 0x0;const common_1=require(a141_0x1538a9(0x19b)),child_process_1=require('child_process'),fs_1=require('fs'),puppeteer_1=require(a141_0x1538a9(0x1c4)),streaming_gateway_1=require(a141_0x1538a9(0x19a)),user_service_1=require(a141_0x1538a9(0x18b)),jwt_1=require(a141_0x1538a9(0x198));let StreamingService=StreamingService_1=class StreamingService{constructor(_0x3e3805,_0x1179c0){const _0x2af286=a141_0x1538a9;this[_0x2af286(0x1a1)]=_0x3e3805,this[_0x2af286(0x1a3)]=_0x1179c0,this['logger']=new common_1['Logger'](StreamingService_1[_0x2af286(0x1a4)]);}[a141_0x1538a9(0x196)](){const _0x20f50a=a141_0x1538a9;if(!this['childProcess'])this[_0x20f50a(0x180)]=(0x0,child_process_1[_0x20f50a(0x1a6)])('mpg123',['-']);}async['playStreamAudio'](_0x522f12){const _0x43694d=a141_0x1538a9;this[_0x43694d(0x196)](),_0x522f12[_0x43694d(0x1b8)](this['childProcess']['stdin']),this[_0x43694d(0x180)]['stdout']['on'](_0x43694d(0x1bb),_0x1bf3f1=>{const _0x5aea32=_0x43694d;_0x1bf3f1['code']==_0x5aea32(0x19f)&&process[_0x5aea32(0x1b1)](0x0);}),this['childProcess'][_0x43694d(0x1b4)]['on'](_0x43694d(0x1bb),_0x58eccd=>{const _0x27e212=_0x43694d;this[_0x27e212(0x1c3)][_0x27e212(0x1b9)](_0x58eccd);}),this['childProcess']['stdout']['on'](_0x43694d(0x1aa),_0x5b8312=>{const _0x5a495a=_0x43694d;this[_0x5a495a(0x1c3)][_0x5a495a(0x1b9)](_0x5a495a(0x189)+_0x5b8312);}),this[_0x43694d(0x180)]['stderr']['on']('data',_0x8167ee=>{const _0x3ff7ee=_0x43694d;this[_0x3ff7ee(0x1c3)][_0x3ff7ee(0x1b9)](_0x3ff7ee(0x1c1)+_0x8167ee);}),this[_0x43694d(0x180)]['on'](_0x43694d(0x1b1),_0x3e81f8=>{const _0x2fbb41=_0x43694d;this[_0x2fbb41(0x1c3)][_0x2fbb41(0x1b9)](_0x2fbb41(0x1b1)),this[_0x2fbb41(0x180)]['kill'](),this[_0x2fbb41(0x180)]=null,_0x3e81f8!==0x0&&this['logger'][_0x2fbb41(0x1b9)](_0x2fbb41(0x18f)+_0x3e81f8);});return;}[a141_0x1538a9(0x188)](_0x2dd9ef){const _0x4393e0=a141_0x1538a9,_0x5c2024=new Promise((_0x2283cd,_0xa2d236)=>{const _0xe75fe2=a141_0x32c6;this['spawnMpgPlayer'](),_0x2dd9ef['pipe'](this[_0xe75fe2(0x180)]['stdin']),this[_0xe75fe2(0x180)]['stdout']['on'](_0xe75fe2(0x1bb),_0x1e21d9=>{const _0x40bba0=_0xe75fe2;_0x1e21d9[_0x40bba0(0x18d)]==_0x40bba0(0x19f)&&process['exit'](0x0);}),this[_0xe75fe2(0x180)]['stdin']['on']('error',_0x5d874e=>{const _0x22f8f0=_0xe75fe2;this['logger'][_0x22f8f0(0x1b9)](_0x5d874e);}),this[_0xe75fe2(0x180)][_0xe75fe2(0x199)]['on'](_0xe75fe2(0x1aa),_0x309199=>{const _0xbb6f25=_0xe75fe2;this[_0xbb6f25(0x1c3)][_0xbb6f25(0x1b9)](_0xbb6f25(0x189)+_0x309199);}),this[_0xe75fe2(0x180)][_0xe75fe2(0x181)]['on'](_0xe75fe2(0x1aa),_0x3fb68c=>{const _0x181ded=_0xe75fe2;this['logger'][_0x181ded(0x1b9)](_0x181ded(0x1c1)+_0x3fb68c);}),this[_0xe75fe2(0x180)]['on'](_0xe75fe2(0x1b1),_0x597d2f=>{const _0x27487a=_0xe75fe2;_0x2283cd(!![]),this[_0x27487a(0x1c3)]['log'](_0x27487a(0x1b1)),this[_0x27487a(0x180)][_0x27487a(0x1c0)](),this[_0x27487a(0x180)]=null,_0x597d2f!==0x0&&this[_0x27487a(0x1c3)][_0x27487a(0x1b9)](_0x27487a(0x18f)+_0x597d2f);});});return{'process':this[_0x4393e0(0x180)],'promise':_0x5c2024};}[a141_0x1538a9(0x192)](_0x3ae33d){const _0x239473=a141_0x1538a9;return(0x0,fs_1[_0x239473(0x18e)])(_0x3ae33d);}async[a141_0x1538a9(0x190)](){const _0x21f166=a141_0x1538a9;this[_0x21f166(0x180)][_0x21f166(0x1c0)]();}async[a141_0x1538a9(0x194)](){const _0x298892=a141_0x1538a9;try{const _0x57f015=process[_0x298892(0x1b3)][_0x298892(0x1ad)]+'/stream';!this[_0x298892(0x197)]&&(this[_0x298892(0x197)]=await(0x0,puppeteer_1[_0x298892(0x1a2)])());const _0x3617dd=await(0x0,puppeteer_1[_0x298892(0x1ae)])(this[_0x298892(0x197)]);if(_0x3617dd[_0x298892(0x1bf)](_0x57f015)){console[_0x298892(0x1b9)](_0x298892(0x1b0)),this[_0x298892(0x1bc)][_0x298892(0x1a9)]();return;}const _0x1d3179=this[_0x298892(0x1b6)]||await(0x0,puppeteer_1[_0x298892(0x17d)])(this[_0x298892(0x197)]),_0x555aa9=await this['userService'][_0x298892(0x195)]();await _0x1d3179['setCookie']({'name':_0x298892(0x17c),'url':process[_0x298892(0x1b3)][_0x298892(0x1ad)],'value':_0x555aa9}),await _0x1d3179[_0x298892(0x186)](_0x57f015),await _0x1d3179[_0x298892(0x183)]('body');}catch(_0xd88d4d){console[_0x298892(0x1b9)](_0xd88d4d,_0x298892(0x193));}}async['closeServerUIStream'](){const _0x4a97ad=a141_0x1538a9;try{this[_0x4a97ad(0x1b6)]&&(await this[_0x4a97ad(0x1b6)][_0x4a97ad(0x1a5)](),this[_0x4a97ad(0x1b6)]=null);}catch(_0x482e6f){console['log'](_0x482e6f,_0x4a97ad(0x1b7));}}};__decorate([(0x0,common_1[a141_0x1538a9(0x1a7)])(streaming_gateway_1[a141_0x1538a9(0x182)]),__metadata(a141_0x1538a9(0x18a),streaming_gateway_1['StreamingGateway'])],StreamingService[a141_0x1538a9(0x17a)],a141_0x1538a9(0x1bc),void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a141_0x1538a9(0x1be)])(),__metadata(a141_0x1538a9(0x1b2),[user_service_1[a141_0x1538a9(0x18c)],jwt_1[a141_0x1538a9(0x17b)]])],StreamingService),exports['StreamingService']=StreamingService;function a141_0x5754(){const _0x9200b9=['Error\x20when\x20open\x20page','openServerUIStream','getMasterUserAccessToken','spawnMpgPlayer','browser','@nestjs/jwt','stdout','./streaming.gateway','@nestjs/common','function','2744910JLaBcq','getOwnPropertyDescriptor','EPIPE','__esModule','userService','launchBrowser','jwtService','name','close','spawn','Inject','632BmueJl','reconnectPeer','data','10dtePio','__metadata','STREAM_SERVER_URL','getBrowserUrls','object','Server\x20stream\x20browser\x20already\x20open','exit','design:paramtypes','env','stdin','defineProperty','page','Error\x20when\x20close\x20page','pipe','log','25928300vRAsrD','error','streamingGateway','131256YZcGmF','Injectable','includes','kill','stderr\x20data:\x20','19782jtjNVm','logger','../helpers/puppeteer','2422tBNTtI','prototype','JwtService','accessToken','openNewpage','1166789enbqns','845608UjnDkV','childProcess','stderr','StreamingGateway','focus','metadata','430184HCOvpr','goto','length','playStreamAudioAsync','stdout\x20data:\x20','design:type','../user/user.service','UserService','code','createReadStream','grep\x20process\x20exited\x20with\x20code\x20','stopStreamAudio','decorate','createStreamFromFile'];a141_0x5754=function(){return _0x9200b9;};return a141_0x5754();}