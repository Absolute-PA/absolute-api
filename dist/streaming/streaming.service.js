'use strict';const a141_0x5768b3=a141_0x317c;(function(_0x431962,_0x7c721b){const _0x46f8eb=a141_0x317c,_0x21baf2=_0x431962();while(!![]){try{const _0x48e95d=parseInt(_0x46f8eb(0x1cf))/0x1*(-parseInt(_0x46f8eb(0x1a3))/0x2)+parseInt(_0x46f8eb(0x1a5))/0x3*(parseInt(_0x46f8eb(0x1cb))/0x4)+parseInt(_0x46f8eb(0x18e))/0x5+parseInt(_0x46f8eb(0x1c9))/0x6*(-parseInt(_0x46f8eb(0x1a6))/0x7)+-parseInt(_0x46f8eb(0x1c5))/0x8*(parseInt(_0x46f8eb(0x1ac))/0x9)+-parseInt(_0x46f8eb(0x1bb))/0xa+-parseInt(_0x46f8eb(0x1ba))/0xb*(-parseInt(_0x46f8eb(0x198))/0xc);if(_0x48e95d===_0x7c721b)break;else _0x21baf2['push'](_0x21baf2['shift']());}catch(_0x15ff95){_0x21baf2['push'](_0x21baf2['shift']());}}}(a141_0x1e44,0x20251));var __decorate=this&&this[a141_0x5768b3(0x1c7)]||function(_0x4010f7,_0x4499e8,_0x4c1d00,_0x4c5d75){const _0x5da71f=a141_0x5768b3;var _0x280e23=arguments[_0x5da71f(0x1c8)],_0x3d2a35=_0x280e23<0x3?_0x4499e8:_0x4c5d75===null?_0x4c5d75=Object['getOwnPropertyDescriptor'](_0x4499e8,_0x4c1d00):_0x4c5d75,_0x1f2341;if(typeof Reflect===_0x5da71f(0x1b3)&&typeof Reflect['decorate']===_0x5da71f(0x1a4))_0x3d2a35=Reflect['decorate'](_0x4010f7,_0x4499e8,_0x4c1d00,_0x4c5d75);else{for(var _0x297efb=_0x4010f7[_0x5da71f(0x1c8)]-0x1;_0x297efb>=0x0;_0x297efb--)if(_0x1f2341=_0x4010f7[_0x297efb])_0x3d2a35=(_0x280e23<0x3?_0x1f2341(_0x3d2a35):_0x280e23>0x3?_0x1f2341(_0x4499e8,_0x4c1d00,_0x3d2a35):_0x1f2341(_0x4499e8,_0x4c1d00))||_0x3d2a35;}return _0x280e23>0x3&&_0x3d2a35&&Object[_0x5da71f(0x19e)](_0x4499e8,_0x4c1d00,_0x3d2a35),_0x3d2a35;},__metadata=this&&this['__metadata']||function(_0x1ff728,_0x165614){const _0x28b018=a141_0x5768b3;if(typeof Reflect===_0x28b018(0x1b3)&&typeof Reflect['metadata']===_0x28b018(0x1a4))return Reflect[_0x28b018(0x190)](_0x1ff728,_0x165614);},StreamingService_1;Object['defineProperty'](exports,a141_0x5768b3(0x1af),{'value':!![]}),exports[a141_0x5768b3(0x1b1)]=void 0x0;function a141_0x1e44(){const _0x4ffcc8=['14241vZiNRE','47327XeNLzN','prototype','Injectable','body','log','logger','9hWCxFa','grep\x20process\x20exited\x20with\x20code\x20','stdin','__esModule','exit','StreamingService','close','object','stopStreamAudio','@nestjs/common','playStreamAudio','../helpers/puppeteer','Error\x20when\x20open\x20page','openNewpage','405812JJfUBp','2628080WewBdi','StreamingGateway','data','jwtService','stdout','EPIPE','launchBrowser','spawnMpgPlayer','Server\x20stream\x20browser\x20already\x20open','accessToken','765976VtcbZt','UserService','__decorate','length','30vascWW','closeServerUIStream','172USzrTE','browser','/stream','kill','1583GmlHRi','Error\x20when\x20close\x20page','env','error','childProcess','812445icAKPK','code','metadata','@nestjs/jwt','playStreamAudioAsync','getMasterUserAccessToken','pipe','mpg123','child_process','page','96dURebt','createReadStream','stderr\x20data:\x20','STREAM_SERVER_URL','setCookie','createStreamFromFile','defineProperty','stderr','userService','stdout\x20data:\x20','getBrowserUrls','174HPtlkg','function'];a141_0x1e44=function(){return _0x4ffcc8;};return a141_0x1e44();}const common_1=require(a141_0x5768b3(0x1b5)),child_process_1=require(a141_0x5768b3(0x196)),fs_1=require('fs'),puppeteer_1=require(a141_0x5768b3(0x1b7)),streaming_gateway_1=require('./streaming.gateway'),user_service_1=require('../user/user.service'),jwt_1=require(a141_0x5768b3(0x191));function a141_0x317c(_0x4351c2,_0x3c31a3){const _0x1e4407=a141_0x1e44();return a141_0x317c=function(_0x317c03,_0x2c8a94){_0x317c03=_0x317c03-0x18a;let _0x183b26=_0x1e4407[_0x317c03];return _0x183b26;},a141_0x317c(_0x4351c2,_0x3c31a3);}let StreamingService=StreamingService_1=class StreamingService{constructor(_0x565fbd,_0x4cdce7){const _0x171e79=a141_0x5768b3;this[_0x171e79(0x1a0)]=_0x565fbd,this[_0x171e79(0x1be)]=_0x4cdce7,this[_0x171e79(0x1ab)]=new common_1['Logger'](StreamingService_1['name']);}[a141_0x5768b3(0x1c2)](){const _0x2abbfd=a141_0x5768b3;if(!this[_0x2abbfd(0x18d)])this[_0x2abbfd(0x18d)]=(0x0,child_process_1['spawn'])(_0x2abbfd(0x195),['-']);}async[a141_0x5768b3(0x1b6)](_0x27a0c0){const _0x5b8c80=a141_0x5768b3;this[_0x5b8c80(0x1c2)](),_0x27a0c0[_0x5b8c80(0x194)](this[_0x5b8c80(0x18d)][_0x5b8c80(0x1ae)]),this[_0x5b8c80(0x18d)][_0x5b8c80(0x1bf)]['on'](_0x5b8c80(0x18c),_0x1b7637=>{const _0x553a29=_0x5b8c80;_0x1b7637[_0x553a29(0x18f)]==_0x553a29(0x1c0)&&process[_0x553a29(0x1b0)](0x0);}),this[_0x5b8c80(0x18d)][_0x5b8c80(0x1ae)]['on'](_0x5b8c80(0x18c),_0xef2e71=>{const _0x4c69b1=_0x5b8c80;this['logger'][_0x4c69b1(0x1aa)](_0xef2e71);}),this['childProcess']['stdout']['on'](_0x5b8c80(0x1bd),_0x101730=>{const _0x33f3e2=_0x5b8c80;this[_0x33f3e2(0x1ab)][_0x33f3e2(0x1aa)](_0x33f3e2(0x1a1)+_0x101730);}),this[_0x5b8c80(0x18d)]['stderr']['on'](_0x5b8c80(0x1bd),_0x3defd4=>{const _0x2820f3=_0x5b8c80;this[_0x2820f3(0x1ab)]['log'](_0x2820f3(0x19a)+_0x3defd4);}),this[_0x5b8c80(0x18d)]['on'](_0x5b8c80(0x1b0),_0xe356d5=>{const _0x1e7ce5=_0x5b8c80;this[_0x1e7ce5(0x1ab)][_0x1e7ce5(0x1aa)](_0x1e7ce5(0x1b0)),this['childProcess'][_0x1e7ce5(0x1ce)](),this[_0x1e7ce5(0x18d)]=null,_0xe356d5!==0x0&&this[_0x1e7ce5(0x1ab)][_0x1e7ce5(0x1aa)](_0x1e7ce5(0x1ad)+_0xe356d5);});return;}[a141_0x5768b3(0x192)](_0x18457d){const _0x475e96=a141_0x5768b3,_0x2dd0e9=new Promise((_0x3abd07,_0x360ab6)=>{const _0x198206=a141_0x317c;this[_0x198206(0x1c2)](),_0x18457d['pipe'](this[_0x198206(0x18d)][_0x198206(0x1ae)]),this[_0x198206(0x18d)][_0x198206(0x1bf)]['on']('error',_0x28d2ea=>{const _0x54bd6c=_0x198206;_0x28d2ea[_0x54bd6c(0x18f)]==_0x54bd6c(0x1c0)&&process['exit'](0x0);}),this[_0x198206(0x18d)][_0x198206(0x1ae)]['on'](_0x198206(0x18c),_0x176fd4=>{const _0x54ae51=_0x198206;this[_0x54ae51(0x1ab)][_0x54ae51(0x1aa)](_0x176fd4);}),this['childProcess'][_0x198206(0x1bf)]['on']('data',_0x265d73=>{const _0x2fccaa=_0x198206;this[_0x2fccaa(0x1ab)]['log'](_0x2fccaa(0x1a1)+_0x265d73);}),this[_0x198206(0x18d)][_0x198206(0x19f)]['on'](_0x198206(0x1bd),_0x993918=>{const _0x496750=_0x198206;this[_0x496750(0x1ab)][_0x496750(0x1aa)](_0x496750(0x19a)+_0x993918);}),this['childProcess']['on'](_0x198206(0x1b0),_0x299550=>{const _0x396b2b=_0x198206;_0x3abd07(!![]),this['logger']['log'](_0x396b2b(0x1b0)),this['childProcess'][_0x396b2b(0x1ce)](),this[_0x396b2b(0x18d)]=null,_0x299550!==0x0&&this[_0x396b2b(0x1ab)][_0x396b2b(0x1aa)](_0x396b2b(0x1ad)+_0x299550);});});return{'process':this[_0x475e96(0x18d)],'promise':_0x2dd0e9};}[a141_0x5768b3(0x19d)](_0x408a2a){const _0x4a3c13=a141_0x5768b3;return(0x0,fs_1[_0x4a3c13(0x199)])(_0x408a2a);}async[a141_0x5768b3(0x1b4)](){const _0xfb6f8a=a141_0x5768b3;this[_0xfb6f8a(0x18d)][_0xfb6f8a(0x1ce)]();}async['openServerUIStream'](){const _0x168774=a141_0x5768b3;try{const _0x1b5a03=process[_0x168774(0x18b)][_0x168774(0x19b)]+_0x168774(0x1cd);!this[_0x168774(0x1cc)]&&(this[_0x168774(0x1cc)]=await(0x0,puppeteer_1[_0x168774(0x1c1)])());const _0x4cf944=await(0x0,puppeteer_1[_0x168774(0x1a2)])(this['browser']);if(_0x4cf944['includes'](_0x1b5a03)){console[_0x168774(0x1aa)](_0x168774(0x1c3)),this['streamingGateway']['reconnectPeer']();return;}const _0x174b35=this[_0x168774(0x197)]||await(0x0,puppeteer_1[_0x168774(0x1b9)])(this[_0x168774(0x1cc)]),_0x3407d3=await this[_0x168774(0x1a0)][_0x168774(0x193)]();await _0x174b35[_0x168774(0x19c)]({'name':_0x168774(0x1c4),'url':process[_0x168774(0x18b)][_0x168774(0x19b)],'value':_0x3407d3}),await _0x174b35['goto'](_0x1b5a03),await _0x174b35['focus'](_0x168774(0x1a9));}catch(_0x56117a){console[_0x168774(0x1aa)](_0x56117a,_0x168774(0x1b8));}}async[a141_0x5768b3(0x1ca)](){const _0x4c4571=a141_0x5768b3;try{this[_0x4c4571(0x197)]&&(await this['page'][_0x4c4571(0x1b2)](),this[_0x4c4571(0x197)]=null);}catch(_0x40a512){console[_0x4c4571(0x1aa)](_0x40a512,_0x4c4571(0x18a));}}};__decorate([(0x0,common_1['Inject'])(streaming_gateway_1[a141_0x5768b3(0x1bc)]),__metadata('design:type',streaming_gateway_1[a141_0x5768b3(0x1bc)])],StreamingService[a141_0x5768b3(0x1a7)],'streamingGateway',void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a141_0x5768b3(0x1a8)])(),__metadata('design:paramtypes',[user_service_1[a141_0x5768b3(0x1c6)],jwt_1['JwtService']])],StreamingService),exports['StreamingService']=StreamingService;