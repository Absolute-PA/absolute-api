'use strict';function a141_0x1878(_0x3adb95,_0x4997bc){const _0x3d7836=a141_0x3d78();return a141_0x1878=function(_0x1878b8,_0x3f84c1){_0x1878b8=_0x1878b8-0x91;let _0x3a0162=_0x3d7836[_0x1878b8];return _0x3a0162;},a141_0x1878(_0x3adb95,_0x4997bc);}const a141_0x21f32f=a141_0x1878;(function(_0x1f6e02,_0x4cdcdb){const _0x1456ae=a141_0x1878,_0x487879=_0x1f6e02();while(!![]){try{const _0x1b7224=parseInt(_0x1456ae(0xc3))/0x1+-parseInt(_0x1456ae(0xcb))/0x2*(parseInt(_0x1456ae(0xd3))/0x3)+parseInt(_0x1456ae(0xa2))/0x4*(-parseInt(_0x1456ae(0xb3))/0x5)+parseInt(_0x1456ae(0xa0))/0x6+-parseInt(_0x1456ae(0xc0))/0x7+-parseInt(_0x1456ae(0xd4))/0x8+parseInt(_0x1456ae(0xbd))/0x9;if(_0x1b7224===_0x4cdcdb)break;else _0x487879['push'](_0x487879['shift']());}catch(_0x78ea75){_0x487879['push'](_0x487879['shift']());}}}(a141_0x3d78,0xa13f0));var __decorate=this&&this[a141_0x21f32f(0x96)]||function(_0x27be6a,_0x244dec,_0x31ad93,_0x1a2166){const _0x38dc69=a141_0x21f32f;var _0x3b7793=arguments['length'],_0x2835e2=_0x3b7793<0x3?_0x244dec:_0x1a2166===null?_0x1a2166=Object[_0x38dc69(0x9c)](_0x244dec,_0x31ad93):_0x1a2166,_0x36fbff;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x2835e2=Reflect[_0x38dc69(0xa6)](_0x27be6a,_0x244dec,_0x31ad93,_0x1a2166);else{for(var _0x5ecd83=_0x27be6a[_0x38dc69(0x98)]-0x1;_0x5ecd83>=0x0;_0x5ecd83--)if(_0x36fbff=_0x27be6a[_0x5ecd83])_0x2835e2=(_0x3b7793<0x3?_0x36fbff(_0x2835e2):_0x3b7793>0x3?_0x36fbff(_0x244dec,_0x31ad93,_0x2835e2):_0x36fbff(_0x244dec,_0x31ad93))||_0x2835e2;}return _0x3b7793>0x3&&_0x2835e2&&Object[_0x38dc69(0x97)](_0x244dec,_0x31ad93,_0x2835e2),_0x2835e2;},__metadata=this&&this['__metadata']||function(_0x332c31,_0x1e1b6b){const _0x1d9b03=a141_0x21f32f;if(typeof Reflect===_0x1d9b03(0xc2)&&typeof Reflect['metadata']===_0x1d9b03(0xb2))return Reflect['metadata'](_0x332c31,_0x1e1b6b);},StreamingService_1;Object[a141_0x21f32f(0x97)](exports,a141_0x21f32f(0x93),{'value':!![]}),exports['StreamingService']=void 0x0;function a141_0x3d78(){const _0x269055=['getOwnPropertyDescriptor','browser','createStreamFromFile','child_process','2982516AtisqD','createReadStream','363416xhNBVE','exit','stdout','launchBrowser','decorate','getBrowserUrls','userService','env','@nestjs/jwt','Error\x20when\x20close\x20page','error','code','mpg123','page','openServerUIStream','../helpers/puppeteer','function','65gStSuw','pipe','spawnMpgPlayer','reconnectPeer','StreamingGateway','stderr','StreamingService','close','prototype','stdout\x20data:\x20','22889781wIaOdf','getMasterUserAccessToken','UserService','1181320ujNmjt','stdin','object','1201461RtWOZl','EPIPE','log','playStreamAudioAsync','data','name','grep\x20process\x20exited\x20with\x20code\x20','playStreamAudio','2XpzQSU','@nestjs/common','kill','goto','setCookie','STREAM_SERVER_URL','streamingGateway','accessToken','3234243BXjQnd','9227592IFfHJw','openNewpage','design:type','__esModule','stderr\x20data:\x20','childProcess','__decorate','defineProperty','length','body','logger','design:paramtypes'];a141_0x3d78=function(){return _0x269055;};return a141_0x3d78();}const common_1=require(a141_0x21f32f(0xcc)),child_process_1=require(a141_0x21f32f(0x9f)),fs_1=require('fs'),puppeteer_1=require(a141_0x21f32f(0xb1)),streaming_gateway_1=require('./streaming.gateway'),user_service_1=require('../user/user.service'),jwt_1=require(a141_0x21f32f(0xaa));let StreamingService=StreamingService_1=class StreamingService{constructor(_0x22f136,_0x8eabde){const _0x4ab320=a141_0x21f32f;this[_0x4ab320(0xa8)]=_0x22f136,this['jwtService']=_0x8eabde,this[_0x4ab320(0x9a)]=new common_1['Logger'](StreamingService_1[_0x4ab320(0xc8)]);}[a141_0x21f32f(0xb5)](){const _0x5c84e9=a141_0x21f32f;if(!this[_0x5c84e9(0x95)])this[_0x5c84e9(0x95)]=(0x0,child_process_1['spawn'])(_0x5c84e9(0xae),['-']);}async[a141_0x21f32f(0xca)](_0x2b03b0){const _0x177ea5=a141_0x21f32f;this[_0x177ea5(0xb5)](),_0x2b03b0['pipe'](this['childProcess'][_0x177ea5(0xc1)]),this[_0x177ea5(0x95)][_0x177ea5(0xa4)]['on'](_0x177ea5(0xac),_0x35268f=>{const _0x3953c0=_0x177ea5;_0x35268f[_0x3953c0(0xad)]==_0x3953c0(0xc4)&&process[_0x3953c0(0xa3)](0x0);}),this['childProcess']['stdin']['on'](_0x177ea5(0xac),_0x544153=>{const _0x124c71=_0x177ea5;this[_0x124c71(0x9a)]['log'](_0x544153);}),this[_0x177ea5(0x95)][_0x177ea5(0xa4)]['on'](_0x177ea5(0xc7),_0x2b3deb=>{const _0x35bb4d=_0x177ea5;this['logger'][_0x35bb4d(0xc5)]('stdout\x20data:\x20'+_0x2b3deb);}),this['childProcess'][_0x177ea5(0xb8)]['on'](_0x177ea5(0xc7),_0x333cf4=>{const _0x166d99=_0x177ea5;this[_0x166d99(0x9a)][_0x166d99(0xc5)](_0x166d99(0x94)+_0x333cf4);}),this[_0x177ea5(0x95)]['on'](_0x177ea5(0xa3),_0x2f6bed=>{const _0x1d17ea=_0x177ea5;this[_0x1d17ea(0x9a)][_0x1d17ea(0xc5)](_0x1d17ea(0xa3)),this[_0x1d17ea(0x95)][_0x1d17ea(0xcd)](),this[_0x1d17ea(0x95)]=null,_0x2f6bed!==0x0&&this[_0x1d17ea(0x9a)][_0x1d17ea(0xc5)](_0x1d17ea(0xc9)+_0x2f6bed);});return;}[a141_0x21f32f(0xc6)](_0xb20fea){const _0x50836b=a141_0x21f32f,_0x1e05e0=new Promise((_0x27e0d7,_0x1d3385)=>{const _0x5000d9=a141_0x1878;this[_0x5000d9(0xb5)](),_0xb20fea[_0x5000d9(0xb4)](this[_0x5000d9(0x95)][_0x5000d9(0xc1)]),this['childProcess'][_0x5000d9(0xa4)]['on']('error',_0x1ccc67=>{const _0x43fd5f=_0x5000d9;_0x1ccc67[_0x43fd5f(0xad)]=='EPIPE'&&process['exit'](0x0);}),this['childProcess']['stdin']['on'](_0x5000d9(0xac),_0x588a9a=>{const _0x545992=_0x5000d9;this[_0x545992(0x9a)][_0x545992(0xc5)](_0x588a9a);}),this[_0x5000d9(0x95)][_0x5000d9(0xa4)]['on'](_0x5000d9(0xc7),_0x4ac079=>{const _0x3f8503=_0x5000d9;this[_0x3f8503(0x9a)][_0x3f8503(0xc5)](_0x3f8503(0xbc)+_0x4ac079);}),this[_0x5000d9(0x95)][_0x5000d9(0xb8)]['on']('data',_0x5085e5=>{const _0x452a47=_0x5000d9;this['logger'][_0x452a47(0xc5)](_0x452a47(0x94)+_0x5085e5);}),this['childProcess']['on'](_0x5000d9(0xa3),_0x110a8d=>{const _0xbbbfeb=_0x5000d9;_0x27e0d7(!![]),this[_0xbbbfeb(0x9a)]['log'](_0xbbbfeb(0xa3)),this[_0xbbbfeb(0x95)][_0xbbbfeb(0xcd)](),this[_0xbbbfeb(0x95)]=null,_0x110a8d!==0x0&&this['logger'][_0xbbbfeb(0xc5)]('grep\x20process\x20exited\x20with\x20code\x20'+_0x110a8d);});});return{'process':this[_0x50836b(0x95)],'promise':_0x1e05e0};}[a141_0x21f32f(0x9e)](_0x22a8b8){const _0x10d798=a141_0x21f32f;return(0x0,fs_1[_0x10d798(0xa1)])(_0x22a8b8);}async['stopStreamAudio'](){const _0x4142f2=a141_0x21f32f;this[_0x4142f2(0x95)][_0x4142f2(0xcd)]();}async[a141_0x21f32f(0xb0)](){const _0x539737=a141_0x21f32f;try{const _0x23400c=process[_0x539737(0xa9)][_0x539737(0xd0)]+'/stream';!this['browser']&&(this['browser']=await(0x0,puppeteer_1[_0x539737(0xa5)])());const _0x2f053f=await(0x0,puppeteer_1[_0x539737(0xa7)])(this[_0x539737(0x9d)]);if(_0x2f053f['includes'](_0x23400c)){console['log']('Server\x20stream\x20browser\x20already\x20open'),this[_0x539737(0xd1)][_0x539737(0xb6)]();return;}const _0x5d529e=this[_0x539737(0xaf)]||await(0x0,puppeteer_1[_0x539737(0x91)])(this[_0x539737(0x9d)]),_0x59ff2a=await this[_0x539737(0xa8)][_0x539737(0xbe)]();await _0x5d529e[_0x539737(0xcf)]({'name':_0x539737(0xd2),'url':process[_0x539737(0xa9)]['STREAM_SERVER_URL'],'value':_0x59ff2a}),await _0x5d529e[_0x539737(0xce)](_0x23400c),await _0x5d529e['focus'](_0x539737(0x99));}catch(_0x2602f1){console[_0x539737(0xc5)](_0x2602f1,'Error\x20when\x20open\x20page');}}async['closeServerUIStream'](){const _0x978733=a141_0x21f32f;try{this['page']&&(await this[_0x978733(0xaf)][_0x978733(0xba)](),this[_0x978733(0xaf)]=null);}catch(_0x384132){console[_0x978733(0xc5)](_0x384132,_0x978733(0xab));}}};__decorate([(0x0,common_1['Inject'])(streaming_gateway_1[a141_0x21f32f(0xb7)]),__metadata(a141_0x21f32f(0x92),streaming_gateway_1[a141_0x21f32f(0xb7)])],StreamingService[a141_0x21f32f(0xbb)],'streamingGateway',void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(a141_0x21f32f(0x9b),[user_service_1[a141_0x21f32f(0xbf)],jwt_1['JwtService']])],StreamingService),exports[a141_0x21f32f(0xb9)]=StreamingService;