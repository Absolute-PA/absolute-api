'use strict';function a138_0x161c(_0x2a2589,_0x4580aa){const _0x46f0e4=a138_0x46f0();return a138_0x161c=function(_0x161c20,_0x5991f8){_0x161c20=_0x161c20-0x179;let _0x185c6f=_0x46f0e4[_0x161c20];return _0x185c6f;},a138_0x161c(_0x2a2589,_0x4580aa);}const a138_0x50cc81=a138_0x161c;(function(_0x54cedf,_0x3a4d6e){const _0x564ced=a138_0x161c,_0x1ec472=_0x54cedf();while(!![]){try{const _0x522268=parseInt(_0x564ced(0x17a))/0x1*(-parseInt(_0x564ced(0x186))/0x2)+-parseInt(_0x564ced(0x1bf))/0x3*(parseInt(_0x564ced(0x19a))/0x4)+-parseInt(_0x564ced(0x1a6))/0x5+-parseInt(_0x564ced(0x1bb))/0x6+parseInt(_0x564ced(0x1b6))/0x7+-parseInt(_0x564ced(0x1b0))/0x8+-parseInt(_0x564ced(0x17e))/0x9*(-parseInt(_0x564ced(0x1b2))/0xa);if(_0x522268===_0x3a4d6e)break;else _0x1ec472['push'](_0x1ec472['shift']());}catch(_0x543b0e){_0x1ec472['push'](_0x1ec472['shift']());}}}(a138_0x46f0,0xb6d10));function a138_0x46f0(){const _0x244382=['design:paramtypes','506499Wmhrok','playStreamAudioAsync','stderr\x20data:\x20','focus','function','3862134YssypR','../user/user.service','stdout\x20data:\x20','createReadStream','15555pCSMuU','kill','1JeWPkl','close','metadata','childProcess','216EzURgD','Logger','userService','object','reconnectPeer','env','spawn','StreamingGateway','2296772DdguBk','length','stderr','createStreamFromFile','Error\x20when\x20open\x20page','decorate','browser','error','exit','logger','StreamingService','Server\x20stream\x20browser\x20already\x20open','code','stdout','EPIPE','page','includes','streamingGateway','launchBrowser','../helpers/puppeteer','548kgpXyp','__esModule','__decorate','__metadata','pipe','STREAM_SERVER_URL','spawnMpgPlayer','log','openNewpage','stdin','design:type','data','101535EBTsBc','Inject','stopStreamAudio','/stream','closeServerUIStream','grep\x20process\x20exited\x20with\x20code\x20','child_process','openServerUIStream','goto','playStreamAudio','342448JnXKZH','name','1350830uSxvjT','getBrowserUrls','defineProperty'];a138_0x46f0=function(){return _0x244382;};return a138_0x46f0();}var __decorate=this&&this[a138_0x50cc81(0x19c)]||function(_0x1b4f2d,_0x5ec96c,_0xf94eb6,_0x53d1a6){const _0x449c56=a138_0x50cc81;var _0x5081de=arguments['length'],_0x72b8f5=_0x5081de<0x3?_0x5ec96c:_0x53d1a6===null?_0x53d1a6=Object['getOwnPropertyDescriptor'](_0x5ec96c,_0xf94eb6):_0x53d1a6,_0x6c459e;if(typeof Reflect===_0x449c56(0x181)&&typeof Reflect[_0x449c56(0x18b)]===_0x449c56(0x1ba))_0x72b8f5=Reflect[_0x449c56(0x18b)](_0x1b4f2d,_0x5ec96c,_0xf94eb6,_0x53d1a6);else{for(var _0x536669=_0x1b4f2d[_0x449c56(0x187)]-0x1;_0x536669>=0x0;_0x536669--)if(_0x6c459e=_0x1b4f2d[_0x536669])_0x72b8f5=(_0x5081de<0x3?_0x6c459e(_0x72b8f5):_0x5081de>0x3?_0x6c459e(_0x5ec96c,_0xf94eb6,_0x72b8f5):_0x6c459e(_0x5ec96c,_0xf94eb6))||_0x72b8f5;}return _0x5081de>0x3&&_0x72b8f5&&Object[_0x449c56(0x1b4)](_0x5ec96c,_0xf94eb6,_0x72b8f5),_0x72b8f5;},__metadata=this&&this[a138_0x50cc81(0x19d)]||function(_0x3f8c90,_0x3d59fa){const _0x117272=a138_0x50cc81;if(typeof Reflect===_0x117272(0x181)&&typeof Reflect[_0x117272(0x17c)]===_0x117272(0x1ba))return Reflect['metadata'](_0x3f8c90,_0x3d59fa);},StreamingService_1;Object[a138_0x50cc81(0x1b4)](exports,a138_0x50cc81(0x19b),{'value':!![]}),exports[a138_0x50cc81(0x190)]=void 0x0;const common_1=require('@nestjs/common'),child_process_1=require(a138_0x50cc81(0x1ac)),fs_1=require('fs'),puppeteer_1=require(a138_0x50cc81(0x199)),streaming_gateway_1=require('./streaming.gateway'),user_service_1=require(a138_0x50cc81(0x1bc)),jwt_1=require('@nestjs/jwt');let StreamingService=StreamingService_1=class StreamingService{constructor(_0x2417e7,_0x4dca5c){const _0x90d4a6=a138_0x50cc81;this['userService']=_0x2417e7,this['jwtService']=_0x4dca5c,this['logger']=new common_1[(_0x90d4a6(0x17f))](StreamingService_1[_0x90d4a6(0x1b1)]);}[a138_0x50cc81(0x1a0)](){const _0x413ac1=a138_0x50cc81;if(!this[_0x413ac1(0x17d)])this[_0x413ac1(0x17d)]=(0x0,child_process_1[_0x413ac1(0x184)])('mpg123',['-']);}async[a138_0x50cc81(0x1af)](_0x142474){const _0x1be083=a138_0x50cc81;this['spawnMpgPlayer'](),_0x142474[_0x1be083(0x19e)](this[_0x1be083(0x17d)][_0x1be083(0x1a3)]),this[_0x1be083(0x17d)][_0x1be083(0x193)]['on']('error',_0x44bbdf=>{const _0x58010d=_0x1be083;_0x44bbdf[_0x58010d(0x192)]==_0x58010d(0x194)&&process[_0x58010d(0x18e)](0x0);}),this[_0x1be083(0x17d)][_0x1be083(0x1a3)]['on'](_0x1be083(0x18d),_0x2805be=>{const _0x189cf5=_0x1be083;this[_0x189cf5(0x18f)][_0x189cf5(0x1a1)](_0x2805be);}),this['childProcess']['stdout']['on'](_0x1be083(0x1a5),_0x43b750=>{const _0x300a7d=_0x1be083;this['logger'][_0x300a7d(0x1a1)]('stdout\x20data:\x20'+_0x43b750);}),this[_0x1be083(0x17d)]['stderr']['on']('data',_0x7426ef=>{this['logger']['log']('stderr\x20data:\x20'+_0x7426ef);}),this['childProcess']['on']('exit',_0x8870b8=>{const _0x435fb8=_0x1be083;this[_0x435fb8(0x18f)][_0x435fb8(0x1a1)](_0x435fb8(0x18e)),this[_0x435fb8(0x17d)][_0x435fb8(0x179)](),this[_0x435fb8(0x17d)]=null,_0x8870b8!==0x0&&this[_0x435fb8(0x18f)]['log'](_0x435fb8(0x1ab)+_0x8870b8);});return;}[a138_0x50cc81(0x1b7)](_0x52f0e7){const _0x5466e3=new Promise((_0x53d785,_0x3fe3f7)=>{const _0x22e487=a138_0x161c;this[_0x22e487(0x1a0)](),_0x52f0e7[_0x22e487(0x19e)](this[_0x22e487(0x17d)][_0x22e487(0x1a3)]),this[_0x22e487(0x17d)][_0x22e487(0x193)]['on'](_0x22e487(0x18d),_0x21d7ce=>{const _0x3b2a06=_0x22e487;_0x21d7ce[_0x3b2a06(0x192)]==_0x3b2a06(0x194)&&process[_0x3b2a06(0x18e)](0x0);}),this[_0x22e487(0x17d)]['stdin']['on'](_0x22e487(0x18d),_0x13dc0e=>{const _0x5ebf6f=_0x22e487;this[_0x5ebf6f(0x18f)][_0x5ebf6f(0x1a1)](_0x13dc0e);}),this[_0x22e487(0x17d)][_0x22e487(0x193)]['on'](_0x22e487(0x1a5),_0x15ebd7=>{const _0x5d2128=_0x22e487;this['logger'][_0x5d2128(0x1a1)](_0x5d2128(0x1bd)+_0x15ebd7);}),this[_0x22e487(0x17d)][_0x22e487(0x188)]['on']('data',_0x34aaef=>{const _0x1ed2b4=_0x22e487;this['logger'][_0x1ed2b4(0x1a1)](_0x1ed2b4(0x1b8)+_0x34aaef);}),this[_0x22e487(0x17d)]['on'](_0x22e487(0x18e),_0x1468f2=>{const _0x1b82a0=_0x22e487;_0x53d785(!![]),this[_0x1b82a0(0x18f)][_0x1b82a0(0x1a1)]('exit'),this[_0x1b82a0(0x17d)][_0x1b82a0(0x179)](),this[_0x1b82a0(0x17d)]=null,_0x1468f2!==0x0&&this[_0x1b82a0(0x18f)][_0x1b82a0(0x1a1)](_0x1b82a0(0x1ab)+_0x1468f2);});});return{'process':this['childProcess'],'promise':_0x5466e3};}[a138_0x50cc81(0x189)](_0x1e1535){const _0x2846bd=a138_0x50cc81;return(0x0,fs_1[_0x2846bd(0x1be)])(_0x1e1535);}async[a138_0x50cc81(0x1a8)](){const _0x29bc55=a138_0x50cc81;this[_0x29bc55(0x17d)][_0x29bc55(0x179)]();}async[a138_0x50cc81(0x1ad)](){const _0x3c7a1e=a138_0x50cc81;try{const _0x287ae0=process[_0x3c7a1e(0x183)]['STREAM_SERVER_URL']+_0x3c7a1e(0x1a9);!this['browser']&&(this[_0x3c7a1e(0x18c)]=await(0x0,puppeteer_1[_0x3c7a1e(0x198)])());const _0x5547f9=await(0x0,puppeteer_1[_0x3c7a1e(0x1b3)])(this[_0x3c7a1e(0x18c)]);if(_0x5547f9[_0x3c7a1e(0x196)](_0x287ae0)){console[_0x3c7a1e(0x1a1)](_0x3c7a1e(0x191)),this[_0x3c7a1e(0x197)][_0x3c7a1e(0x182)]();return;}const _0xee411b=this[_0x3c7a1e(0x195)]||await(0x0,puppeteer_1[_0x3c7a1e(0x1a2)])(this['browser']),_0x180cc5=await this[_0x3c7a1e(0x180)]['getMasterUserAccessToken']();await _0xee411b['setCookie']({'name':'accessToken','url':process[_0x3c7a1e(0x183)][_0x3c7a1e(0x19f)],'value':_0x180cc5}),await _0xee411b[_0x3c7a1e(0x1ae)](_0x287ae0),await _0xee411b[_0x3c7a1e(0x1b9)]('body');}catch(_0x216c99){console[_0x3c7a1e(0x1a1)](_0x216c99,_0x3c7a1e(0x18a));}}async[a138_0x50cc81(0x1aa)](){const _0xdeb27=a138_0x50cc81;try{this[_0xdeb27(0x195)]&&(await this[_0xdeb27(0x195)][_0xdeb27(0x17b)](),this[_0xdeb27(0x195)]=null);}catch(_0x5a8cde){console[_0xdeb27(0x1a1)](_0x5a8cde,'Error\x20when\x20close\x20page');}}};__decorate([(0x0,common_1[a138_0x50cc81(0x1a7)])(streaming_gateway_1['StreamingGateway']),__metadata(a138_0x50cc81(0x1a4),streaming_gateway_1[a138_0x50cc81(0x185)])],StreamingService['prototype'],a138_0x50cc81(0x197),void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(a138_0x50cc81(0x1b5),[user_service_1['UserService'],jwt_1['JwtService']])],StreamingService),exports[a138_0x50cc81(0x190)]=StreamingService;