'use strict';const a138_0x20bc41=a138_0x8d1d;(function(_0x23eb36,_0x2adef6){const _0x5b0312=a138_0x8d1d,_0x5a2e64=_0x23eb36();while(!![]){try{const _0x52e512=-parseInt(_0x5b0312(0x16e))/0x1+parseInt(_0x5b0312(0x164))/0x2+parseInt(_0x5b0312(0x15e))/0x3+parseInt(_0x5b0312(0x166))/0x4*(parseInt(_0x5b0312(0x16c))/0x5)+-parseInt(_0x5b0312(0x18d))/0x6*(parseInt(_0x5b0312(0x178))/0x7)+-parseInt(_0x5b0312(0x190))/0x8+-parseInt(_0x5b0312(0x17d))/0x9*(-parseInt(_0x5b0312(0x18a))/0xa);if(_0x52e512===_0x2adef6)break;else _0x5a2e64['push'](_0x5a2e64['shift']());}catch(_0x27bc25){_0x5a2e64['push'](_0x5a2e64['shift']());}}}(a138_0xed99,0x74b47));function a138_0x8d1d(_0x4edf1b,_0x448ad8){const _0xed9926=a138_0xed99();return a138_0x8d1d=function(_0x8d1d91,_0x434df1){_0x8d1d91=_0x8d1d91-0x152;let _0x31e15b=_0xed9926[_0x8d1d91];return _0x31e15b;},a138_0x8d1d(_0x4edf1b,_0x448ad8);}var __decorate=this&&this['__decorate']||function(_0x3aba96,_0x384a7d,_0x56dbe3,_0x4e5fec){const _0x28f525=a138_0x8d1d;var _0x19d6eb=arguments[_0x28f525(0x172)],_0x33326a=_0x19d6eb<0x3?_0x384a7d:_0x4e5fec===null?_0x4e5fec=Object[_0x28f525(0x18b)](_0x384a7d,_0x56dbe3):_0x4e5fec,_0x4d1367;if(typeof Reflect===_0x28f525(0x158)&&typeof Reflect[_0x28f525(0x16f)]===_0x28f525(0x15d))_0x33326a=Reflect['decorate'](_0x3aba96,_0x384a7d,_0x56dbe3,_0x4e5fec);else{for(var _0x19f7ab=_0x3aba96[_0x28f525(0x172)]-0x1;_0x19f7ab>=0x0;_0x19f7ab--)if(_0x4d1367=_0x3aba96[_0x19f7ab])_0x33326a=(_0x19d6eb<0x3?_0x4d1367(_0x33326a):_0x19d6eb>0x3?_0x4d1367(_0x384a7d,_0x56dbe3,_0x33326a):_0x4d1367(_0x384a7d,_0x56dbe3))||_0x33326a;}return _0x19d6eb>0x3&&_0x33326a&&Object[_0x28f525(0x185)](_0x384a7d,_0x56dbe3,_0x33326a),_0x33326a;},__metadata=this&&this['__metadata']||function(_0x3faeba,_0x3bb810){const _0x44f259=a138_0x8d1d;if(typeof Reflect==='object'&&typeof Reflect[_0x44f259(0x15c)]===_0x44f259(0x15d))return Reflect[_0x44f259(0x15c)](_0x3faeba,_0x3bb810);},StreamingService_1;function a138_0xed99(){const _0x5e2340=['StreamingService','page','playStreamAudio','exit','focus','@nestjs/jwt','prototype','object','accessToken','createStreamFromFile','design:paramtypes','metadata','function','1552704EAYcuu','browser','goto','@nestjs/common','userService','close','698556iQqOpa','stdin','4PpWmNn','mpg123','childProcess','log','data','openNewpage','3863185sjneeo','streamingGateway','884593ZnWgMz','decorate','Server\x20stream\x20browser\x20already\x20open','StreamingGateway','length','JwtService','__esModule','Logger','stdout\x20data:\x20','createReadStream','70KJwuor','code','child_process','spawn','error','93987AyRkEb','reconnectPeer','kill','env','launchBrowser','stopStreamAudio','stderr','STREAM_SERVER_URL','defineProperty','Error\x20when\x20close\x20page','name','jwtService','playStreamAudioAsync','710ICIebT','getOwnPropertyDescriptor','stdout','393096HbOzfZ','logger','body','2905280aPmYcZ','EPIPE','spawnMpgPlayer','getBrowserUrls','Inject'];a138_0xed99=function(){return _0x5e2340;};return a138_0xed99();}Object[a138_0x20bc41(0x185)](exports,a138_0x20bc41(0x174),{'value':!![]}),exports['StreamingService']=void 0x0;const common_1=require(a138_0x20bc41(0x161)),child_process_1=require(a138_0x20bc41(0x17a)),fs_1=require('fs'),puppeteer_1=require('../helpers/puppeteer'),streaming_gateway_1=require('./streaming.gateway'),user_service_1=require('../user/user.service'),jwt_1=require(a138_0x20bc41(0x156));let StreamingService=StreamingService_1=class StreamingService{constructor(_0xe1cd90,_0x118521){const _0x3c9e2c=a138_0x20bc41;this['userService']=_0xe1cd90,this[_0x3c9e2c(0x188)]=_0x118521,this[_0x3c9e2c(0x18e)]=new common_1[(_0x3c9e2c(0x175))](StreamingService_1[_0x3c9e2c(0x187)]);}[a138_0x20bc41(0x192)](){const _0x4c477d=a138_0x20bc41;if(!this['childProcess'])this[_0x4c477d(0x168)]=(0x0,child_process_1[_0x4c477d(0x17b)])(_0x4c477d(0x167),['-']);}async[a138_0x20bc41(0x153)](_0x105b8a){const _0x3e9be7=a138_0x20bc41;this[_0x3e9be7(0x192)](),_0x105b8a['pipe'](this[_0x3e9be7(0x168)][_0x3e9be7(0x165)]),this[_0x3e9be7(0x168)]['stdout']['on'](_0x3e9be7(0x17c),_0x1ef482=>{const _0x1bfd8f=_0x3e9be7;_0x1ef482['code']==_0x1bfd8f(0x191)&&process[_0x1bfd8f(0x154)](0x0);}),this[_0x3e9be7(0x168)][_0x3e9be7(0x165)]['on'](_0x3e9be7(0x17c),_0x3043d2=>{this['logger']['log'](_0x3043d2);}),this[_0x3e9be7(0x168)][_0x3e9be7(0x18c)]['on']('data',_0x110171=>{const _0x6af76a=_0x3e9be7;this[_0x6af76a(0x18e)]['log']('stdout\x20data:\x20'+_0x110171);}),this[_0x3e9be7(0x168)][_0x3e9be7(0x183)]['on'](_0x3e9be7(0x16a),_0x3bb292=>{this['logger']['log']('stderr\x20data:\x20'+_0x3bb292);}),this[_0x3e9be7(0x168)]['on']('exit',_0x2ee810=>{const _0x442653=_0x3e9be7;this[_0x442653(0x18e)]['log'](_0x442653(0x154)),this[_0x442653(0x168)]['kill'](),this[_0x442653(0x168)]=null,_0x2ee810!==0x0&&this[_0x442653(0x18e)][_0x442653(0x169)]('grep\x20process\x20exited\x20with\x20code\x20'+_0x2ee810);});return;}[a138_0x20bc41(0x189)](_0x251189){const _0x1daf5f=new Promise((_0x10829d,_0x39fad9)=>{const _0x1d0f11=a138_0x8d1d;this[_0x1d0f11(0x192)](),_0x251189['pipe'](this['childProcess'][_0x1d0f11(0x165)]),this[_0x1d0f11(0x168)]['stdout']['on'](_0x1d0f11(0x17c),_0x5a4050=>{const _0x5db712=_0x1d0f11;_0x5a4050[_0x5db712(0x179)]=='EPIPE'&&process[_0x5db712(0x154)](0x0);}),this['childProcess'][_0x1d0f11(0x165)]['on']('error',_0x248f8a=>{const _0x2abba8=_0x1d0f11;this[_0x2abba8(0x18e)][_0x2abba8(0x169)](_0x248f8a);}),this[_0x1d0f11(0x168)][_0x1d0f11(0x18c)]['on']('data',_0x146dbd=>{const _0x408535=_0x1d0f11;this['logger'][_0x408535(0x169)](_0x408535(0x176)+_0x146dbd);}),this[_0x1d0f11(0x168)][_0x1d0f11(0x183)]['on']('data',_0x191fa2=>{const _0x5a09ff=_0x1d0f11;this['logger'][_0x5a09ff(0x169)]('stderr\x20data:\x20'+_0x191fa2);}),this[_0x1d0f11(0x168)]['on'](_0x1d0f11(0x154),_0x8665c5=>{const _0x268630=_0x1d0f11;_0x10829d(!![]),this['logger'][_0x268630(0x169)](_0x268630(0x154)),this[_0x268630(0x168)][_0x268630(0x17f)](),this[_0x268630(0x168)]=null,_0x8665c5!==0x0&&this['logger'][_0x268630(0x169)]('grep\x20process\x20exited\x20with\x20code\x20'+_0x8665c5);});});return{'process':this['childProcess'],'promise':_0x1daf5f};}[a138_0x20bc41(0x15a)](_0x1c2d49){const _0xe5f335=a138_0x20bc41;return(0x0,fs_1[_0xe5f335(0x177)])(_0x1c2d49);}async[a138_0x20bc41(0x182)](){const _0x12cafc=a138_0x20bc41;this['childProcess'][_0x12cafc(0x17f)]();}async['openServerUIStream'](){const _0x7dde55=a138_0x20bc41;try{const _0xc5d068=process[_0x7dde55(0x180)][_0x7dde55(0x184)]+'/stream';!this['browser']&&(this['browser']=await(0x0,puppeteer_1[_0x7dde55(0x181)])());const _0x37969b=await(0x0,puppeteer_1[_0x7dde55(0x193)])(this[_0x7dde55(0x15f)]);if(_0x37969b['includes'](_0xc5d068)){console[_0x7dde55(0x169)](_0x7dde55(0x170)),this[_0x7dde55(0x16d)][_0x7dde55(0x17e)]();return;}const _0x2254e6=this['page']||await(0x0,puppeteer_1[_0x7dde55(0x16b)])(this['browser']),_0x1be039=await this[_0x7dde55(0x162)]['getMasterUserAccessToken']();await _0x2254e6['setCookie']({'name':_0x7dde55(0x159),'url':process[_0x7dde55(0x180)][_0x7dde55(0x184)],'value':_0x1be039}),await _0x2254e6[_0x7dde55(0x160)](_0xc5d068),await _0x2254e6[_0x7dde55(0x155)](_0x7dde55(0x18f));}catch(_0x31881e){console[_0x7dde55(0x169)](_0x31881e,'Error\x20when\x20open\x20page');}}async['closeServerUIStream'](){const _0x4d210a=a138_0x20bc41;try{this[_0x4d210a(0x152)]&&(await this[_0x4d210a(0x152)][_0x4d210a(0x163)](),this[_0x4d210a(0x152)]=null);}catch(_0x4d7d2e){console['log'](_0x4d7d2e,_0x4d210a(0x186));}}};__decorate([(0x0,common_1[a138_0x20bc41(0x194)])(streaming_gateway_1['StreamingGateway']),__metadata('design:type',streaming_gateway_1[a138_0x20bc41(0x171)])],StreamingService[a138_0x20bc41(0x157)],'streamingGateway',void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(a138_0x20bc41(0x15b),[user_service_1['UserService'],jwt_1[a138_0x20bc41(0x173)]])],StreamingService),exports[a138_0x20bc41(0x195)]=StreamingService;