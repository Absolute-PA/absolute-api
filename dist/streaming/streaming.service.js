'use strict';const a138_0x1e8581=a138_0x5d5a;function a138_0x120b(){const _0x4ef026=['length','StreamingGateway','@nestjs/jwt','EPIPE','stdout','1008110FEKPjN','4358898dPjzsT','design:paramtypes','grep\x20process\x20exited\x20with\x20code\x20','pipe','10dxQHcd','page','design:type','name','spawn','Injectable','error','openNewpage','mpg123','close','metadata','/stream','Logger','1321851IxZnCV','./streaming.gateway','openServerUIStream','StreamingService','env','getMasterUserAccessToken','UserService','object','spawnMpgPlayer','Inject','log','decorate','338384YsBbpm','browser','2JageuV','JwtService','exit','stopStreamAudio','2938608SCuSAj','12LlcSNn','3447598gAniVD','streamingGateway','../user/user.service','userService','playStreamAudio','body','accessToken','setCookie','kill','@nestjs/common','Error\x20when\x20close\x20page','stdout\x20data:\x20','function','__decorate','defineProperty','jwtService','logger','childProcess','929675LTogYB','stderr','launchBrowser','STREAM_SERVER_URL','goto','focus','../helpers/puppeteer','child_process','data','Server\x20stream\x20browser\x20already\x20open','getBrowserUrls','playStreamAudioAsync','stderr\x20data:\x20','code','stdin'];a138_0x120b=function(){return _0x4ef026;};return a138_0x120b();}(function(_0x5b849f,_0x1ff00b){const _0x6236af=a138_0x5d5a,_0x49e818=_0x5b849f();while(!![]){try{const _0x266abb=parseInt(_0x6236af(0xe7))/0x1+parseInt(_0x6236af(0xcf))/0x2*(parseInt(_0x6236af(0xc1))/0x3)+parseInt(_0x6236af(0xcd))/0x4+-parseInt(_0x6236af(0xaf))/0x5*(-parseInt(_0x6236af(0xd4))/0x6)+-parseInt(_0x6236af(0xd5))/0x7+-parseInt(_0x6236af(0xd3))/0x8+parseInt(_0x6236af(0xb0))/0x9*(-parseInt(_0x6236af(0xb4))/0xa);if(_0x266abb===_0x1ff00b)break;else _0x49e818['push'](_0x49e818['shift']());}catch(_0x302d36){_0x49e818['push'](_0x49e818['shift']());}}}(a138_0x120b,0x7d7b2));var __decorate=this&&this[a138_0x1e8581(0xe2)]||function(_0x6e40a5,_0x243f92,_0x4a5a83,_0x4d97b0){const _0x255e2e=a138_0x1e8581;var _0x4f5f63=arguments[_0x255e2e(0xaa)],_0x31e636=_0x4f5f63<0x3?_0x243f92:_0x4d97b0===null?_0x4d97b0=Object['getOwnPropertyDescriptor'](_0x243f92,_0x4a5a83):_0x4d97b0,_0x57e225;if(typeof Reflect===_0x255e2e(0xc8)&&typeof Reflect[_0x255e2e(0xcc)]==='function')_0x31e636=Reflect[_0x255e2e(0xcc)](_0x6e40a5,_0x243f92,_0x4a5a83,_0x4d97b0);else{for(var _0x2cb726=_0x6e40a5[_0x255e2e(0xaa)]-0x1;_0x2cb726>=0x0;_0x2cb726--)if(_0x57e225=_0x6e40a5[_0x2cb726])_0x31e636=(_0x4f5f63<0x3?_0x57e225(_0x31e636):_0x4f5f63>0x3?_0x57e225(_0x243f92,_0x4a5a83,_0x31e636):_0x57e225(_0x243f92,_0x4a5a83))||_0x31e636;}return _0x4f5f63>0x3&&_0x31e636&&Object[_0x255e2e(0xe3)](_0x243f92,_0x4a5a83,_0x31e636),_0x31e636;},__metadata=this&&this['__metadata']||function(_0x4d456d,_0x1c2dd3){const _0x41a62b=a138_0x1e8581;if(typeof Reflect==='object'&&typeof Reflect[_0x41a62b(0xbe)]===_0x41a62b(0xe1))return Reflect[_0x41a62b(0xbe)](_0x4d456d,_0x1c2dd3);},StreamingService_1;function a138_0x5d5a(_0xd94c3f,_0x503aac){const _0x120b2d=a138_0x120b();return a138_0x5d5a=function(_0x5d5aab,_0x587c2c){_0x5d5aab=_0x5d5aab-0xa2;let _0x5e2be6=_0x120b2d[_0x5d5aab];return _0x5e2be6;},a138_0x5d5a(_0xd94c3f,_0x503aac);}Object[a138_0x1e8581(0xe3)](exports,'__esModule',{'value':!![]}),exports[a138_0x1e8581(0xc4)]=void 0x0;const common_1=require(a138_0x1e8581(0xde)),child_process_1=require(a138_0x1e8581(0xa2)),fs_1=require('fs'),puppeteer_1=require(a138_0x1e8581(0xed)),streaming_gateway_1=require(a138_0x1e8581(0xc2)),user_service_1=require(a138_0x1e8581(0xd7)),jwt_1=require(a138_0x1e8581(0xac));let StreamingService=StreamingService_1=class StreamingService{constructor(_0x526f81,_0x2f8834){const _0x5ae62d=a138_0x1e8581;this[_0x5ae62d(0xd8)]=_0x526f81,this[_0x5ae62d(0xe4)]=_0x2f8834,this[_0x5ae62d(0xe5)]=new common_1[(_0x5ae62d(0xc0))](StreamingService_1[_0x5ae62d(0xb7)]);}[a138_0x1e8581(0xc9)](){const _0x16285f=a138_0x1e8581;if(!this['childProcess'])this['childProcess']=(0x0,child_process_1[_0x16285f(0xb8)])(_0x16285f(0xbc),['-']);}async[a138_0x1e8581(0xd9)](_0x155c03){const _0xf8b7d9=a138_0x1e8581;this['spawnMpgPlayer'](),_0x155c03[_0xf8b7d9(0xb3)](this[_0xf8b7d9(0xe6)][_0xf8b7d9(0xa9)]),this[_0xf8b7d9(0xe6)][_0xf8b7d9(0xae)]['on'](_0xf8b7d9(0xba),_0x3a7cd8=>{const _0x416b7f=_0xf8b7d9;_0x3a7cd8['code']==_0x416b7f(0xad)&&process[_0x416b7f(0xd1)](0x0);}),this[_0xf8b7d9(0xe6)][_0xf8b7d9(0xa9)]['on'](_0xf8b7d9(0xba),_0x5ba0d8=>{const _0x3a7c52=_0xf8b7d9;this['logger'][_0x3a7c52(0xcb)](_0x5ba0d8);}),this[_0xf8b7d9(0xe6)]['stdout']['on'](_0xf8b7d9(0xa3),_0x3fa43d=>{const _0xbffa30=_0xf8b7d9;this[_0xbffa30(0xe5)]['log'](_0xbffa30(0xe0)+_0x3fa43d);}),this['childProcess'][_0xf8b7d9(0xe8)]['on'](_0xf8b7d9(0xa3),_0x3c1a91=>{const _0x5938be=_0xf8b7d9;this[_0x5938be(0xe5)][_0x5938be(0xcb)](_0x5938be(0xa7)+_0x3c1a91);}),this[_0xf8b7d9(0xe6)]['on'](_0xf8b7d9(0xd1),_0x200bac=>{const _0x4decc4=_0xf8b7d9;this[_0x4decc4(0xe5)][_0x4decc4(0xcb)](_0x4decc4(0xd1)),this[_0x4decc4(0xe6)][_0x4decc4(0xdd)](),this['childProcess']=null,_0x200bac!==0x0&&this[_0x4decc4(0xe5)]['log'](_0x4decc4(0xb2)+_0x200bac);});return;}[a138_0x1e8581(0xa6)](_0x148f30){const _0x10f6d1=a138_0x1e8581,_0x531002=new Promise((_0x5c2f3b,_0x1b1b8b)=>{const _0x92c066=a138_0x5d5a;this[_0x92c066(0xc9)](),_0x148f30[_0x92c066(0xb3)](this[_0x92c066(0xe6)][_0x92c066(0xa9)]),this['childProcess'][_0x92c066(0xae)]['on'](_0x92c066(0xba),_0x19d5d1=>{const _0x47c8f7=_0x92c066;_0x19d5d1[_0x47c8f7(0xa8)]=='EPIPE'&&process[_0x47c8f7(0xd1)](0x0);}),this[_0x92c066(0xe6)][_0x92c066(0xa9)]['on'](_0x92c066(0xba),_0x52aa05=>{const _0x2a2f82=_0x92c066;this[_0x2a2f82(0xe5)][_0x2a2f82(0xcb)](_0x52aa05);}),this[_0x92c066(0xe6)][_0x92c066(0xae)]['on'](_0x92c066(0xa3),_0x2d42c3=>{const _0x34e30f=_0x92c066;this[_0x34e30f(0xe5)][_0x34e30f(0xcb)](_0x34e30f(0xe0)+_0x2d42c3);}),this['childProcess'][_0x92c066(0xe8)]['on'](_0x92c066(0xa3),_0x2f701d=>{const _0x1cb494=_0x92c066;this[_0x1cb494(0xe5)][_0x1cb494(0xcb)](_0x1cb494(0xa7)+_0x2f701d);}),this[_0x92c066(0xe6)]['on'](_0x92c066(0xd1),_0x213824=>{const _0x68b551=_0x92c066;_0x5c2f3b(!![]),this[_0x68b551(0xe5)]['log']('exit'),this[_0x68b551(0xe6)]['kill'](),this[_0x68b551(0xe6)]=null,_0x213824!==0x0&&this[_0x68b551(0xe5)]['log'](_0x68b551(0xb2)+_0x213824);});});return{'process':this[_0x10f6d1(0xe6)],'promise':_0x531002};}['createStreamFromFile'](_0x8d25bc){return(0x0,fs_1['createReadStream'])(_0x8d25bc);}async[a138_0x1e8581(0xd2)](){const _0x508afd=a138_0x1e8581;this[_0x508afd(0xe6)][_0x508afd(0xdd)]();}async[a138_0x1e8581(0xc3)](){const _0x5b01d0=a138_0x1e8581;try{const _0x515a12=process[_0x5b01d0(0xc5)]['STREAM_SERVER_URL']+_0x5b01d0(0xbf);!this['browser']&&(this[_0x5b01d0(0xce)]=await(0x0,puppeteer_1[_0x5b01d0(0xe9)])());const _0x61fe2a=await(0x0,puppeteer_1[_0x5b01d0(0xa5)])(this[_0x5b01d0(0xce)]);if(_0x61fe2a['includes'](_0x515a12)){console['log'](_0x5b01d0(0xa4)),this[_0x5b01d0(0xd6)]['reconnectPeer']();return;}const _0x1faa1b=this[_0x5b01d0(0xb5)]||await(0x0,puppeteer_1[_0x5b01d0(0xbb)])(this['browser']),_0x439149=await this[_0x5b01d0(0xd8)][_0x5b01d0(0xc6)]();await _0x1faa1b[_0x5b01d0(0xdc)]({'name':_0x5b01d0(0xdb),'url':process[_0x5b01d0(0xc5)][_0x5b01d0(0xea)],'value':_0x439149}),await _0x1faa1b[_0x5b01d0(0xeb)](_0x515a12),await _0x1faa1b[_0x5b01d0(0xec)](_0x5b01d0(0xda));}catch(_0x46664c){console[_0x5b01d0(0xcb)](_0x46664c,'Error\x20when\x20open\x20page');}}async['closeServerUIStream'](){const _0x373b0f=a138_0x1e8581;try{this[_0x373b0f(0xb5)]&&(await this[_0x373b0f(0xb5)][_0x373b0f(0xbd)](),this[_0x373b0f(0xb5)]=null);}catch(_0x1a924a){console[_0x373b0f(0xcb)](_0x1a924a,_0x373b0f(0xdf));}}};__decorate([(0x0,common_1[a138_0x1e8581(0xca)])(streaming_gateway_1['StreamingGateway']),__metadata(a138_0x1e8581(0xb6),streaming_gateway_1[a138_0x1e8581(0xab)])],StreamingService['prototype'],a138_0x1e8581(0xd6),void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a138_0x1e8581(0xb9)])(),__metadata(a138_0x1e8581(0xb1),[user_service_1[a138_0x1e8581(0xc7)],jwt_1[a138_0x1e8581(0xd0)]])],StreamingService),exports['StreamingService']=StreamingService;