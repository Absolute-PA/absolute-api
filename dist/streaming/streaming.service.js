'use strict';const a138_0x4dffb8=a138_0x18a7;(function(_0xb415ec,_0x144f86){const _0x38134c=a138_0x18a7,_0x4d9f6a=_0xb415ec();while(!![]){try{const _0x29065=-parseInt(_0x38134c(0x106))/0x1*(parseInt(_0x38134c(0x100))/0x2)+-parseInt(_0x38134c(0x134))/0x3+parseInt(_0x38134c(0x107))/0x4*(parseInt(_0x38134c(0x124))/0x5)+parseInt(_0x38134c(0x114))/0x6*(parseInt(_0x38134c(0x103))/0x7)+parseInt(_0x38134c(0x111))/0x8+-parseInt(_0x38134c(0x11c))/0x9+parseInt(_0x38134c(0x105))/0xa;if(_0x29065===_0x144f86)break;else _0x4d9f6a['push'](_0x4d9f6a['shift']());}catch(_0x18a456){_0x4d9f6a['push'](_0x4d9f6a['shift']());}}}(a138_0x14ef,0x2cf16));var __decorate=this&&this[a138_0x4dffb8(0x12e)]||function(_0x4d7fce,_0x14055f,_0x1fa395,_0xd00c8a){const _0x245221=a138_0x4dffb8;var _0x50a56b=arguments[_0x245221(0x12f)],_0x14950a=_0x50a56b<0x3?_0x14055f:_0xd00c8a===null?_0xd00c8a=Object[_0x245221(0x12a)](_0x14055f,_0x1fa395):_0xd00c8a,_0x4ab80c;if(typeof Reflect===_0x245221(0x128)&&typeof Reflect[_0x245221(0x113)]===_0x245221(0x131))_0x14950a=Reflect[_0x245221(0x113)](_0x4d7fce,_0x14055f,_0x1fa395,_0xd00c8a);else{for(var _0x57de7e=_0x4d7fce[_0x245221(0x12f)]-0x1;_0x57de7e>=0x0;_0x57de7e--)if(_0x4ab80c=_0x4d7fce[_0x57de7e])_0x14950a=(_0x50a56b<0x3?_0x4ab80c(_0x14950a):_0x50a56b>0x3?_0x4ab80c(_0x14055f,_0x1fa395,_0x14950a):_0x4ab80c(_0x14055f,_0x1fa395))||_0x14950a;}return _0x50a56b>0x3&&_0x14950a&&Object[_0x245221(0xf4)](_0x14055f,_0x1fa395,_0x14950a),_0x14950a;},__metadata=this&&this[a138_0x4dffb8(0x123)]||function(_0x382d30,_0x384fc5){const _0x1734eb=a138_0x4dffb8;if(typeof Reflect==='object'&&typeof Reflect[_0x1734eb(0x11e)]===_0x1734eb(0x131))return Reflect[_0x1734eb(0x11e)](_0x382d30,_0x384fc5);},StreamingService_1;Object['defineProperty'](exports,a138_0x4dffb8(0x12d),{'value':!![]}),exports[a138_0x4dffb8(0x10b)]=void 0x0;const common_1=require('@nestjs/common'),child_process_1=require(a138_0x4dffb8(0x102)),fs_1=require('fs'),puppeteer_1=require(a138_0x4dffb8(0x11d)),streaming_gateway_1=require('./streaming.gateway'),user_service_1=require(a138_0x4dffb8(0x11f)),jwt_1=require(a138_0x4dffb8(0x12c));let StreamingService=StreamingService_1=class StreamingService{constructor(_0x1ca04d,_0xa3e24e){const _0x13359d=a138_0x4dffb8;this[_0x13359d(0x122)]=_0x1ca04d,this[_0x13359d(0x11a)]=_0xa3e24e,this[_0x13359d(0x129)]=new common_1['Logger'](StreamingService_1[_0x13359d(0xfd)]);}[a138_0x4dffb8(0x104)](){const _0x3d636b=a138_0x4dffb8;if(!this[_0x3d636b(0x11b)])this[_0x3d636b(0x11b)]=(0x0,child_process_1['spawn'])(_0x3d636b(0xff),['-']);}async['playStreamAudio'](_0x34a707){const _0x460b9f=a138_0x4dffb8;this[_0x460b9f(0x104)](),_0x34a707[_0x460b9f(0x132)](this[_0x460b9f(0x11b)][_0x460b9f(0x117)]),this['childProcess']['stdout']['on'](_0x460b9f(0xfe),_0x54c8c7=>{const _0x3a72d6=_0x460b9f;_0x54c8c7['code']==_0x3a72d6(0x10a)&&process[_0x3a72d6(0xf5)](0x0);}),this[_0x460b9f(0x11b)]['stdin']['on']('error',_0xa8f24c=>{const _0x3ca7eb=_0x460b9f;this[_0x3ca7eb(0x129)][_0x3ca7eb(0x109)](_0xa8f24c);}),this[_0x460b9f(0x11b)][_0x460b9f(0x112)]['on'](_0x460b9f(0x10c),_0x6462ad=>{const _0x1dbf00=_0x460b9f;this[_0x1dbf00(0x129)][_0x1dbf00(0x109)](_0x1dbf00(0x108)+_0x6462ad);}),this[_0x460b9f(0x11b)][_0x460b9f(0xf8)]['on']('data',_0x49df6a=>{const _0x3df60c=_0x460b9f;this[_0x3df60c(0x129)][_0x3df60c(0x109)](_0x3df60c(0x121)+_0x49df6a);}),this[_0x460b9f(0x11b)]['on'](_0x460b9f(0xf5),_0x7f0399=>{const _0x150ba9=_0x460b9f;this[_0x150ba9(0x129)]['log']('exit'),this[_0x150ba9(0x11b)]['kill'](),this[_0x150ba9(0x11b)]=null,_0x7f0399!==0x0&&this[_0x150ba9(0x129)][_0x150ba9(0x109)](_0x150ba9(0x116)+_0x7f0399);});return;}[a138_0x4dffb8(0x126)](_0x476ac3){const _0x22fb75=a138_0x4dffb8,_0x5e8c5c=new Promise((_0x35a695,_0x44ddb4)=>{const _0x168c89=a138_0x18a7;this['spawnMpgPlayer'](),_0x476ac3[_0x168c89(0x132)](this[_0x168c89(0x11b)]['stdin']),this[_0x168c89(0x11b)][_0x168c89(0x112)]['on'](_0x168c89(0xfe),_0x4c0c2a=>{const _0x131cd5=_0x168c89;_0x4c0c2a[_0x131cd5(0x135)]==_0x131cd5(0x10a)&&process[_0x131cd5(0xf5)](0x0);}),this['childProcess'][_0x168c89(0x117)]['on']('error',_0x195f27=>{const _0x47fad9=_0x168c89;this[_0x47fad9(0x129)]['log'](_0x195f27);}),this[_0x168c89(0x11b)][_0x168c89(0x112)]['on'](_0x168c89(0x10c),_0x469afe=>{const _0x2f99c1=_0x168c89;this['logger'][_0x2f99c1(0x109)](_0x2f99c1(0x108)+_0x469afe);}),this[_0x168c89(0x11b)][_0x168c89(0xf8)]['on'](_0x168c89(0x10c),_0x22ed89=>{const _0x1f0405=_0x168c89;this[_0x1f0405(0x129)][_0x1f0405(0x109)](_0x1f0405(0x121)+_0x22ed89);}),this[_0x168c89(0x11b)]['on'](_0x168c89(0xf5),_0x2775ab=>{const _0x48df7d=_0x168c89;_0x35a695(!![]),this[_0x48df7d(0x129)][_0x48df7d(0x109)]('exit'),this[_0x48df7d(0x11b)][_0x48df7d(0x118)](),this[_0x48df7d(0x11b)]=null,_0x2775ab!==0x0&&this[_0x48df7d(0x129)][_0x48df7d(0x109)](_0x48df7d(0x116)+_0x2775ab);});});return{'process':this[_0x22fb75(0x11b)],'promise':_0x5e8c5c};}['createStreamFromFile'](_0x55e716){const _0x8d452c=a138_0x4dffb8;return(0x0,fs_1[_0x8d452c(0xfc)])(_0x55e716);}async['stopStreamAudio'](){const _0x54d83=a138_0x4dffb8;this[_0x54d83(0x11b)]['kill']();}async[a138_0x4dffb8(0xf7)](){const _0x4fbcf9=a138_0x4dffb8;try{const _0x5cc403=process[_0x4fbcf9(0x101)][_0x4fbcf9(0x127)]+'/stream';!this[_0x4fbcf9(0xfb)]&&(this[_0x4fbcf9(0xfb)]=await(0x0,puppeteer_1['launchBrowser'])());const _0x3071ae=await(0x0,puppeteer_1[_0x4fbcf9(0x120)])(this[_0x4fbcf9(0xfb)]);if(_0x3071ae['includes'](_0x5cc403)){console[_0x4fbcf9(0x109)](_0x4fbcf9(0x125)),this['streamingGateway'][_0x4fbcf9(0xf6)]();return;}const _0x2d4152=this['page']||await(0x0,puppeteer_1[_0x4fbcf9(0xf0)])(this[_0x4fbcf9(0xfb)]),_0x1ed2b5=await this[_0x4fbcf9(0x122)][_0x4fbcf9(0xf1)]();await _0x2d4152[_0x4fbcf9(0x10d)]({'name':_0x4fbcf9(0x119),'url':process[_0x4fbcf9(0x101)][_0x4fbcf9(0x127)],'value':_0x1ed2b5}),await _0x2d4152['goto'](_0x5cc403),await _0x2d4152['focus'](_0x4fbcf9(0x110));}catch(_0x10f806){console[_0x4fbcf9(0x109)](_0x10f806,_0x4fbcf9(0x130));}}async[a138_0x4dffb8(0x133)](){const _0x22b684=a138_0x4dffb8;try{this[_0x22b684(0x10f)]&&(await this['page']['close'](),this['page']=null);}catch(_0x28cf77){console['log'](_0x28cf77,'Error\x20when\x20close\x20page');}}};function a138_0x14ef(){const _0x154063=['STREAM_SERVER_URL','object','logger','getOwnPropertyDescriptor','design:paramtypes','@nestjs/jwt','__esModule','__decorate','length','Error\x20when\x20open\x20page','function','pipe','closeServerUIStream','954432hrcKBd','code','openNewpage','getMasterUserAccessToken','StreamingGateway','UserService','defineProperty','exit','reconnectPeer','openServerUIStream','stderr','JwtService','prototype','browser','createReadStream','name','error','mpg123','8484WfYNrk','env','child_process','10129dmDVxb','spawnMpgPlayer','2928980yNofHj','17RFnWnh','20RdewcN','stdout\x20data:\x20','log','EPIPE','StreamingService','data','setCookie','streamingGateway','page','body','1042648cCDnMF','stdout','decorate','666WVSYzH','Inject','grep\x20process\x20exited\x20with\x20code\x20','stdin','kill','accessToken','jwtService','childProcess','1485243YoBOQI','../helpers/puppeteer','metadata','../user/user.service','getBrowserUrls','stderr\x20data:\x20','userService','__metadata','155525DIiEfI','Server\x20stream\x20browser\x20already\x20open','playStreamAudioAsync'];a138_0x14ef=function(){return _0x154063;};return a138_0x14ef();}function a138_0x18a7(_0x50d5a5,_0x332212){const _0x14efd5=a138_0x14ef();return a138_0x18a7=function(_0x18a7dc,_0x29821f){_0x18a7dc=_0x18a7dc-0xf0;let _0xba7bcb=_0x14efd5[_0x18a7dc];return _0xba7bcb;},a138_0x18a7(_0x50d5a5,_0x332212);}__decorate([(0x0,common_1[a138_0x4dffb8(0x115)])(streaming_gateway_1[a138_0x4dffb8(0xf2)]),__metadata('design:type',streaming_gateway_1['StreamingGateway'])],StreamingService[a138_0x4dffb8(0xfa)],a138_0x4dffb8(0x10e),void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(a138_0x4dffb8(0x12b),[user_service_1[a138_0x4dffb8(0xf3)],jwt_1[a138_0x4dffb8(0xf9)]])],StreamingService),exports[a138_0x4dffb8(0x10b)]=StreamingService;