'use strict';const a138_0x4191ba=a138_0x27a7;(function(_0x26d43a,_0x55af2b){const _0x48777d=a138_0x27a7,_0x2efc00=_0x26d43a();while(!![]){try{const _0x8b6f12=-parseInt(_0x48777d(0x12b))/0x1*(-parseInt(_0x48777d(0x108))/0x2)+parseInt(_0x48777d(0x133))/0x3+-parseInt(_0x48777d(0x101))/0x4+-parseInt(_0x48777d(0x114))/0x5+parseInt(_0x48777d(0xf5))/0x6*(-parseInt(_0x48777d(0xfd))/0x7)+parseInt(_0x48777d(0x12d))/0x8*(parseInt(_0x48777d(0xee))/0x9)+parseInt(_0x48777d(0x136))/0xa*(parseInt(_0x48777d(0xf3))/0xb);if(_0x8b6f12===_0x55af2b)break;else _0x2efc00['push'](_0x2efc00['shift']());}catch(_0x1fb53a){_0x2efc00['push'](_0x2efc00['shift']());}}}(a138_0x3e26,0x6fa5e));function a138_0x3e26(){const _0xe6d97e=['1119396yMOjsQ','grep\x20process\x20exited\x20with\x20code\x20','StreamingGateway','EPIPE','openNewpage','streamingGateway','Error\x20when\x20open\x20page','3148zYXSyv','body','code','kill','../user/user.service','defineProperty','error','/stream','design:paramtypes','goto','decorate','object','1637770cGyIgR','page','Error\x20when\x20close\x20page','getMasterUserAccessToken','stderr','env','playStreamAudio','STREAM_SERVER_URL','mpg123','createStreamFromFile','launchBrowser','setCookie','__decorate','length','@nestjs/jwt','close','pipe','reconnectPeer','JwtService','stopStreamAudio','prototype','Injectable','child_process','179lZTupq','../helpers/puppeteer','368uOcNxy','@nestjs/common','closeServerUIStream','openServerUIStream','data','log','294069BhVewn','focus','spawn','541720UZmwhT','createReadStream','./streaming.gateway','stdout','logger','includes','158409IQoPok','stdin','playStreamAudioAsync','childProcess','exit','154RucufR','metadata','1059732sjhqEz','__metadata','getOwnPropertyDescriptor','browser','jwtService','stdout\x20data:\x20','Server\x20stream\x20browser\x20already\x20open','getBrowserUrls','35atGuMj','Inject','spawnMpgPlayer','StreamingService'];a138_0x3e26=function(){return _0xe6d97e;};return a138_0x3e26();}var __decorate=this&&this[a138_0x4191ba(0x120)]||function(_0xd5a0ec,_0x12d3c5,_0x5a25f7,_0x1043a5){const _0x5533ff=a138_0x4191ba;var _0x365595=arguments['length'],_0x224762=_0x365595<0x3?_0x12d3c5:_0x1043a5===null?_0x1043a5=Object[_0x5533ff(0xf7)](_0x12d3c5,_0x5a25f7):_0x1043a5,_0x145787;if(typeof Reflect===_0x5533ff(0x113)&&typeof Reflect['decorate']==='function')_0x224762=Reflect[_0x5533ff(0x112)](_0xd5a0ec,_0x12d3c5,_0x5a25f7,_0x1043a5);else{for(var _0x36251a=_0xd5a0ec[_0x5533ff(0x121)]-0x1;_0x36251a>=0x0;_0x36251a--)if(_0x145787=_0xd5a0ec[_0x36251a])_0x224762=(_0x365595<0x3?_0x145787(_0x224762):_0x365595>0x3?_0x145787(_0x12d3c5,_0x5a25f7,_0x224762):_0x145787(_0x12d3c5,_0x5a25f7))||_0x224762;}return _0x365595>0x3&&_0x224762&&Object[_0x5533ff(0x10d)](_0x12d3c5,_0x5a25f7,_0x224762),_0x224762;},__metadata=this&&this[a138_0x4191ba(0xf6)]||function(_0x1c32c7,_0x53cc99){const _0x5b2fb2=a138_0x4191ba;if(typeof Reflect===_0x5b2fb2(0x113)&&typeof Reflect[_0x5b2fb2(0xf4)]==='function')return Reflect[_0x5b2fb2(0xf4)](_0x1c32c7,_0x53cc99);},StreamingService_1;Object[a138_0x4191ba(0x10d)](exports,'__esModule',{'value':!![]}),exports[a138_0x4191ba(0x100)]=void 0x0;const common_1=require(a138_0x4191ba(0x12e)),child_process_1=require(a138_0x4191ba(0x12a)),fs_1=require('fs'),puppeteer_1=require(a138_0x4191ba(0x12c)),streaming_gateway_1=require(a138_0x4191ba(0x138)),user_service_1=require(a138_0x4191ba(0x10c)),jwt_1=require(a138_0x4191ba(0x122));function a138_0x27a7(_0x570764,_0x456db8){const _0x3e2677=a138_0x3e26();return a138_0x27a7=function(_0x27a734,_0x50205c){_0x27a734=_0x27a734-0xed;let _0x192847=_0x3e2677[_0x27a734];return _0x192847;},a138_0x27a7(_0x570764,_0x456db8);}let StreamingService=StreamingService_1=class StreamingService{constructor(_0x3f9e52,_0x2cbc91){const _0x258d2d=a138_0x4191ba;this['userService']=_0x3f9e52,this[_0x258d2d(0xf9)]=_0x2cbc91,this[_0x258d2d(0x13a)]=new common_1['Logger'](StreamingService_1['name']);}[a138_0x4191ba(0xff)](){const _0x4423aa=a138_0x4191ba;if(!this[_0x4423aa(0xf1)])this['childProcess']=(0x0,child_process_1[_0x4423aa(0x135)])(_0x4423aa(0x11c),['-']);}async[a138_0x4191ba(0x11a)](_0xce72ec){const _0x300271=a138_0x4191ba;this[_0x300271(0xff)](),_0xce72ec['pipe'](this[_0x300271(0xf1)][_0x300271(0xef)]),this[_0x300271(0xf1)][_0x300271(0x139)]['on']('error',_0x4a6615=>{const _0x41e3b8=_0x300271;_0x4a6615[_0x41e3b8(0x10a)]==_0x41e3b8(0x104)&&process[_0x41e3b8(0xf2)](0x0);}),this[_0x300271(0xf1)][_0x300271(0xef)]['on'](_0x300271(0x10e),_0x367aad=>{const _0x31fba8=_0x300271;this[_0x31fba8(0x13a)]['log'](_0x367aad);}),this['childProcess'][_0x300271(0x139)]['on'](_0x300271(0x131),_0x25a825=>{const _0x184de8=_0x300271;this[_0x184de8(0x13a)][_0x184de8(0x132)](_0x184de8(0xfa)+_0x25a825);}),this[_0x300271(0xf1)][_0x300271(0x118)]['on'](_0x300271(0x131),_0x54a72c=>{const _0x15cadd=_0x300271;this[_0x15cadd(0x13a)][_0x15cadd(0x132)]('stderr\x20data:\x20'+_0x54a72c);}),this[_0x300271(0xf1)]['on']('exit',_0x27343e=>{const _0x54699c=_0x300271;this[_0x54699c(0x13a)]['log'](_0x54699c(0xf2)),this['childProcess']['kill'](),this[_0x54699c(0xf1)]=null,_0x27343e!==0x0&&this['logger'][_0x54699c(0x132)](_0x54699c(0x102)+_0x27343e);});return;}[a138_0x4191ba(0xf0)](_0x597611){const _0x343731=a138_0x4191ba,_0x4ba4eb=new Promise((_0x51529c,_0x278f7f)=>{const _0x215957=a138_0x27a7;this[_0x215957(0xff)](),_0x597611[_0x215957(0x124)](this[_0x215957(0xf1)][_0x215957(0xef)]),this[_0x215957(0xf1)][_0x215957(0x139)]['on'](_0x215957(0x10e),_0x5da76f=>{const _0x2908d8=_0x215957;_0x5da76f[_0x2908d8(0x10a)]==_0x2908d8(0x104)&&process[_0x2908d8(0xf2)](0x0);}),this['childProcess'][_0x215957(0xef)]['on']('error',_0x5f1bf7=>{const _0x4bcbf9=_0x215957;this[_0x4bcbf9(0x13a)][_0x4bcbf9(0x132)](_0x5f1bf7);}),this[_0x215957(0xf1)][_0x215957(0x139)]['on'](_0x215957(0x131),_0xa66999=>{const _0x138791=_0x215957;this[_0x138791(0x13a)]['log'](_0x138791(0xfa)+_0xa66999);}),this[_0x215957(0xf1)][_0x215957(0x118)]['on'](_0x215957(0x131),_0x413868=>{const _0x4047f9=_0x215957;this[_0x4047f9(0x13a)]['log']('stderr\x20data:\x20'+_0x413868);}),this[_0x215957(0xf1)]['on'](_0x215957(0xf2),_0x136847=>{const _0x2d6a4e=_0x215957;_0x51529c(!![]),this[_0x2d6a4e(0x13a)][_0x2d6a4e(0x132)](_0x2d6a4e(0xf2)),this[_0x2d6a4e(0xf1)]['kill'](),this['childProcess']=null,_0x136847!==0x0&&this[_0x2d6a4e(0x13a)][_0x2d6a4e(0x132)](_0x2d6a4e(0x102)+_0x136847);});});return{'process':this[_0x343731(0xf1)],'promise':_0x4ba4eb};}[a138_0x4191ba(0x11d)](_0xf2258d){const _0x1493fc=a138_0x4191ba;return(0x0,fs_1[_0x1493fc(0x137)])(_0xf2258d);}async[a138_0x4191ba(0x127)](){const _0x1a9d68=a138_0x4191ba;this[_0x1a9d68(0xf1)][_0x1a9d68(0x10b)]();}async[a138_0x4191ba(0x130)](){const _0x4df874=a138_0x4191ba;try{const _0x283633=process[_0x4df874(0x119)][_0x4df874(0x11b)]+_0x4df874(0x10f);!this[_0x4df874(0xf8)]&&(this[_0x4df874(0xf8)]=await(0x0,puppeteer_1[_0x4df874(0x11e)])());const _0x322e94=await(0x0,puppeteer_1[_0x4df874(0xfc)])(this[_0x4df874(0xf8)]);if(_0x322e94[_0x4df874(0xed)](_0x283633)){console[_0x4df874(0x132)](_0x4df874(0xfb)),this['streamingGateway'][_0x4df874(0x125)]();return;}const _0xa239cf=this[_0x4df874(0x115)]||await(0x0,puppeteer_1[_0x4df874(0x105)])(this[_0x4df874(0xf8)]),_0x292fcc=await this['userService'][_0x4df874(0x117)]();await _0xa239cf[_0x4df874(0x11f)]({'name':'accessToken','url':process[_0x4df874(0x119)][_0x4df874(0x11b)],'value':_0x292fcc}),await _0xa239cf[_0x4df874(0x111)](_0x283633),await _0xa239cf[_0x4df874(0x134)](_0x4df874(0x109));}catch(_0x2169c6){console[_0x4df874(0x132)](_0x2169c6,_0x4df874(0x107));}}async[a138_0x4191ba(0x12f)](){const _0x1bb687=a138_0x4191ba;try{this['page']&&(await this[_0x1bb687(0x115)][_0x1bb687(0x123)](),this[_0x1bb687(0x115)]=null);}catch(_0x247f17){console[_0x1bb687(0x132)](_0x247f17,_0x1bb687(0x116));}}};__decorate([(0x0,common_1[a138_0x4191ba(0xfe)])(streaming_gateway_1[a138_0x4191ba(0x103)]),__metadata('design:type',streaming_gateway_1[a138_0x4191ba(0x103)])],StreamingService[a138_0x4191ba(0x128)],a138_0x4191ba(0x106),void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a138_0x4191ba(0x129)])(),__metadata(a138_0x4191ba(0x110),[user_service_1['UserService'],jwt_1[a138_0x4191ba(0x126)]])],StreamingService),exports[a138_0x4191ba(0x100)]=StreamingService;