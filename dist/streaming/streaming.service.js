'use strict';const a138_0x7b218e=a138_0x4aa2;(function(_0x2e3094,_0x184da7){const _0x1cf7b0=a138_0x4aa2,_0x14896c=_0x2e3094();while(!![]){try{const _0x16e4f7=-parseInt(_0x1cf7b0(0x12f))/0x1*(parseInt(_0x1cf7b0(0x153))/0x2)+-parseInt(_0x1cf7b0(0x161))/0x3*(parseInt(_0x1cf7b0(0x159))/0x4)+parseInt(_0x1cf7b0(0x142))/0x5*(-parseInt(_0x1cf7b0(0x13f))/0x6)+parseInt(_0x1cf7b0(0x126))/0x7+parseInt(_0x1cf7b0(0x129))/0x8*(-parseInt(_0x1cf7b0(0x16f))/0x9)+parseInt(_0x1cf7b0(0x157))/0xa*(parseInt(_0x1cf7b0(0x14a))/0xb)+parseInt(_0x1cf7b0(0x164))/0xc*(parseInt(_0x1cf7b0(0x15f))/0xd);if(_0x16e4f7===_0x184da7)break;else _0x14896c['push'](_0x14896c['shift']());}catch(_0xfba71e){_0x14896c['push'](_0x14896c['shift']());}}}(a138_0x1e15,0x2b717));function a138_0x4aa2(_0x57ba9a,_0x4dba99){const _0x1e1578=a138_0x1e15();return a138_0x4aa2=function(_0x4aa272,_0x500ea6){_0x4aa272=_0x4aa272-0x124;let _0x404d48=_0x1e1578[_0x4aa272];return _0x404d48;},a138_0x4aa2(_0x57ba9a,_0x4dba99);}var __decorate=this&&this[a138_0x7b218e(0x125)]||function(_0x44ee09,_0x25e63a,_0xf481f3,_0x33128b){const _0x2c8c35=a138_0x7b218e;var _0x4e0eb4=arguments['length'],_0x108e88=_0x4e0eb4<0x3?_0x25e63a:_0x33128b===null?_0x33128b=Object['getOwnPropertyDescriptor'](_0x25e63a,_0xf481f3):_0x33128b,_0x58e0b0;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x2c8c35(0x145))_0x108e88=Reflect[_0x2c8c35(0x14c)](_0x44ee09,_0x25e63a,_0xf481f3,_0x33128b);else{for(var _0x4820aa=_0x44ee09[_0x2c8c35(0x149)]-0x1;_0x4820aa>=0x0;_0x4820aa--)if(_0x58e0b0=_0x44ee09[_0x4820aa])_0x108e88=(_0x4e0eb4<0x3?_0x58e0b0(_0x108e88):_0x4e0eb4>0x3?_0x58e0b0(_0x25e63a,_0xf481f3,_0x108e88):_0x58e0b0(_0x25e63a,_0xf481f3))||_0x108e88;}return _0x4e0eb4>0x3&&_0x108e88&&Object[_0x2c8c35(0x162)](_0x25e63a,_0xf481f3,_0x108e88),_0x108e88;},__metadata=this&&this[a138_0x7b218e(0x12b)]||function(_0x536894,_0x1e5068){const _0x33cb0d=a138_0x7b218e;if(typeof Reflect===_0x33cb0d(0x144)&&typeof Reflect[_0x33cb0d(0x156)]===_0x33cb0d(0x145))return Reflect[_0x33cb0d(0x156)](_0x536894,_0x1e5068);},StreamingService_1;Object[a138_0x7b218e(0x162)](exports,a138_0x7b218e(0x158),{'value':!![]}),exports['StreamingService']=void 0x0;const common_1=require('@nestjs/common'),child_process_1=require('child_process'),fs_1=require('fs'),puppeteer_1=require(a138_0x7b218e(0x166)),streaming_gateway_1=require(a138_0x7b218e(0x165)),user_service_1=require('../user/user.service'),jwt_1=require(a138_0x7b218e(0x137));let StreamingService=StreamingService_1=class StreamingService{constructor(_0x6799f,_0x5be81d){const _0x4d98f9=a138_0x7b218e;this['userService']=_0x6799f,this[_0x4d98f9(0x12a)]=_0x5be81d,this[_0x4d98f9(0x139)]=new common_1[(_0x4d98f9(0x13c))](StreamingService_1[_0x4d98f9(0x13b)]);}[a138_0x7b218e(0x13d)](){const _0x4e682b=a138_0x7b218e;if(!this[_0x4e682b(0x16d)])this[_0x4e682b(0x16d)]=(0x0,child_process_1[_0x4e682b(0x160)])('mpg123',['-']);}async[a138_0x7b218e(0x14e)](_0x4dac26){const _0x6a3726=a138_0x7b218e;this[_0x6a3726(0x13d)](),_0x4dac26[_0x6a3726(0x132)](this['childProcess'][_0x6a3726(0x15d)]),this[_0x6a3726(0x16d)]['stdout']['on'](_0x6a3726(0x14f),_0x22d0de=>{const _0x192051=_0x6a3726;_0x22d0de[_0x192051(0x124)]==_0x192051(0x148)&&process[_0x192051(0x147)](0x0);}),this['childProcess']['stdin']['on']('error',_0x4f8a9a=>{const _0x449576=_0x6a3726;this[_0x449576(0x139)]['log'](_0x4f8a9a);}),this[_0x6a3726(0x16d)]['stdout']['on'](_0x6a3726(0x167),_0x3f99be=>{const _0x19cdc8=_0x6a3726;this['logger'][_0x19cdc8(0x154)](_0x19cdc8(0x146)+_0x3f99be);}),this[_0x6a3726(0x16d)][_0x6a3726(0x170)]['on']('data',_0x21fbb1=>{const _0x37dc6f=_0x6a3726;this['logger'][_0x37dc6f(0x154)](_0x37dc6f(0x140)+_0x21fbb1);}),this['childProcess']['on']('exit',_0x57f39c=>{const _0x4f471e=_0x6a3726;this[_0x4f471e(0x139)][_0x4f471e(0x154)](_0x4f471e(0x147)),this[_0x4f471e(0x16d)][_0x4f471e(0x128)](),this[_0x4f471e(0x16d)]=null,_0x57f39c!==0x0&&this[_0x4f471e(0x139)]['log']('grep\x20process\x20exited\x20with\x20code\x20'+_0x57f39c);});return;}[a138_0x7b218e(0x169)](_0x4163ad){const _0xadcec9=a138_0x7b218e,_0xf710dd=new Promise((_0x289344,_0x42d616)=>{const _0x20f74c=a138_0x4aa2;this[_0x20f74c(0x13d)](),_0x4163ad[_0x20f74c(0x132)](this[_0x20f74c(0x16d)][_0x20f74c(0x15d)]),this[_0x20f74c(0x16d)][_0x20f74c(0x12c)]['on'](_0x20f74c(0x14f),_0x19a9ba=>{const _0x386f1b=_0x20f74c;_0x19a9ba[_0x386f1b(0x124)]==_0x386f1b(0x148)&&process[_0x386f1b(0x147)](0x0);}),this['childProcess'][_0x20f74c(0x15d)]['on'](_0x20f74c(0x14f),_0xec6b7=>{const _0x2cb6a7=_0x20f74c;this[_0x2cb6a7(0x139)][_0x2cb6a7(0x154)](_0xec6b7);}),this[_0x20f74c(0x16d)][_0x20f74c(0x12c)]['on']('data',_0x2ed9e6=>{this['logger']['log']('stdout\x20data:\x20'+_0x2ed9e6);}),this['childProcess']['stderr']['on']('data',_0x3f7f23=>{const _0x2f93a4=_0x20f74c;this[_0x2f93a4(0x139)][_0x2f93a4(0x154)](_0x2f93a4(0x140)+_0x3f7f23);}),this[_0x20f74c(0x16d)]['on']('exit',_0x2abb17=>{const _0x49d367=_0x20f74c;_0x289344(!![]),this['logger'][_0x49d367(0x154)]('exit'),this[_0x49d367(0x16d)][_0x49d367(0x128)](),this[_0x49d367(0x16d)]=null,_0x2abb17!==0x0&&this[_0x49d367(0x139)][_0x49d367(0x154)](_0x49d367(0x16b)+_0x2abb17);});});return{'process':this[_0xadcec9(0x16d)],'promise':_0xf710dd};}[a138_0x7b218e(0x127)](_0x3648b0){const _0x139d5b=a138_0x7b218e;return(0x0,fs_1[_0x139d5b(0x151)])(_0x3648b0);}async[a138_0x7b218e(0x163)](){const _0x351282=a138_0x7b218e;this['childProcess'][_0x351282(0x128)]();}async[a138_0x7b218e(0x15e)](){const _0x1d7d3a=a138_0x7b218e;try{const _0x4cedfe=process[_0x1d7d3a(0x12d)][_0x1d7d3a(0x131)]+_0x1d7d3a(0x155);!this[_0x1d7d3a(0x16e)]&&(this[_0x1d7d3a(0x16e)]=await(0x0,puppeteer_1[_0x1d7d3a(0x136)])());const _0x103909=await(0x0,puppeteer_1[_0x1d7d3a(0x13a)])(this[_0x1d7d3a(0x16e)]);if(_0x103909[_0x1d7d3a(0x141)](_0x4cedfe)){console[_0x1d7d3a(0x154)](_0x1d7d3a(0x133)),this[_0x1d7d3a(0x135)][_0x1d7d3a(0x14b)]();return;}const _0xb30546=this[_0x1d7d3a(0x15b)]||await(0x0,puppeteer_1['openNewpage'])(this[_0x1d7d3a(0x16e)]),_0x28a829=await this['userService']['getMasterUserAccessToken']();await _0xb30546[_0x1d7d3a(0x172)]({'name':_0x1d7d3a(0x12e),'url':process[_0x1d7d3a(0x12d)][_0x1d7d3a(0x131)],'value':_0x28a829}),await _0xb30546[_0x1d7d3a(0x134)](_0x4cedfe),await _0xb30546[_0x1d7d3a(0x138)](_0x1d7d3a(0x171));}catch(_0x1f342b){console[_0x1d7d3a(0x154)](_0x1f342b,_0x1d7d3a(0x15a));}}async['closeServerUIStream'](){const _0x25b504=a138_0x7b218e;try{this[_0x25b504(0x15b)]&&(await this[_0x25b504(0x15b)][_0x25b504(0x150)](),this[_0x25b504(0x15b)]=null);}catch(_0x56e228){console[_0x25b504(0x154)](_0x56e228,_0x25b504(0x13e));}}};function a138_0x1e15(){const _0x58bc83=['../helpers/puppeteer','data','Injectable','playStreamAudioAsync','Inject','grep\x20process\x20exited\x20with\x20code\x20','design:type','childProcess','browser','445977MiYjWu','stderr','body','setCookie','code','__decorate','1422617NUALab','createStreamFromFile','kill','40FztYqf','jwtService','__metadata','stdout','env','accessToken','8193hmUDJM','prototype','STREAM_SERVER_URL','pipe','Server\x20stream\x20browser\x20already\x20open','goto','streamingGateway','launchBrowser','@nestjs/jwt','focus','logger','getBrowserUrls','name','Logger','spawnMpgPlayer','Error\x20when\x20close\x20page','2088498oVkIFB','stderr\x20data:\x20','includes','5ozloXh','UserService','object','function','stdout\x20data:\x20','exit','EPIPE','length','13783kcpOyQ','reconnectPeer','decorate','StreamingGateway','playStreamAudio','error','close','createReadStream','StreamingService','66wXcodE','log','/stream','metadata','2630JUqfGh','__esModule','4zJSnyN','Error\x20when\x20open\x20page','page','JwtService','stdin','openServerUIStream','26BUTPCv','spawn','472782YnNbia','defineProperty','stopStreamAudio','4013904hFlFqA','./streaming.gateway'];a138_0x1e15=function(){return _0x58bc83;};return a138_0x1e15();}__decorate([(0x0,common_1[a138_0x7b218e(0x16a)])(streaming_gateway_1['StreamingGateway']),__metadata(a138_0x7b218e(0x16c),streaming_gateway_1[a138_0x7b218e(0x14d)])],StreamingService[a138_0x7b218e(0x130)],'streamingGateway',void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a138_0x7b218e(0x168)])(),__metadata('design:paramtypes',[user_service_1[a138_0x7b218e(0x143)],jwt_1[a138_0x7b218e(0x15c)]])],StreamingService),exports[a138_0x7b218e(0x152)]=StreamingService;