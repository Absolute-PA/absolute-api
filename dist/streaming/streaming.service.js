'use strict';function a138_0x4246(){const _0x356b97=['defineProperty','8511410AvtLTo','body','design:paramtypes','__esModule','logger','../user/user.service','child_process','__metadata','includes','goto','playStreamAudioAsync','createStreamFromFile','stdout\x20data:\x20','userService','STREAM_SERVER_URL','function','stdout','accessToken','pipe','getBrowserUrls','metadata','JwtService','grep\x20process\x20exited\x20with\x20code\x20','childProcess','stopStreamAudio','18140499nXpFET','mpg123','error','openNewpage','474666wUgmST','focus','stdin','208QAfYph','closeServerUIStream','EPIPE','browser','Error\x20when\x20open\x20page','StreamingService','stderr','code','decorate','exit','log','data','kill','jwtService','153684NHFcjG','length','page','createReadStream','spawn','env','98BoFHPs','Inject','getOwnPropertyDescriptor','prototype','StreamingGateway','3628084dhGoNG','streamingGateway','playStreamAudio','5hwiEia','__decorate','reconnectPeer','spawnMpgPlayer','object','Server\x20stream\x20browser\x20already\x20open','getMasterUserAccessToken','1288105EjpKAh','12mhPTPK','11ZhXOpD','close','974cAsdns','stderr\x20data:\x20','@nestjs/jwt','9294hfErfQ'];a138_0x4246=function(){return _0x356b97;};return a138_0x4246();}const a138_0x34bdad=a138_0x30fe;(function(_0x3d30ba,_0x23c75f){const _0x3313e2=a138_0x30fe,_0x1a97bf=_0x3d30ba();while(!![]){try{const _0x4124eb=parseInt(_0x3313e2(0xe6))/0x1+-parseInt(_0x3313e2(0x9e))/0x2*(-parseInt(_0x3313e2(0xa1))/0x3)+-parseInt(_0x3313e2(0xdc))/0x4*(-parseInt(_0x3313e2(0xdf))/0x5)+-parseInt(_0x3313e2(0xc0))/0x6*(parseInt(_0x3313e2(0xd7))/0x7)+-parseInt(_0x3313e2(0xc3))/0x8*(-parseInt(_0x3313e2(0xd1))/0x9)+parseInt(_0x3313e2(0xa3))/0xa*(-parseInt(_0x3313e2(0xe8))/0xb)+parseInt(_0x3313e2(0xe7))/0xc*(-parseInt(_0x3313e2(0xbc))/0xd);if(_0x4124eb===_0x23c75f)break;else _0x1a97bf['push'](_0x1a97bf['shift']());}catch(_0xbb7b83){_0x1a97bf['push'](_0x1a97bf['shift']());}}}(a138_0x4246,0xc1c6e));var __decorate=this&&this[a138_0x34bdad(0xe0)]||function(_0x402b72,_0x4c0977,_0x59aa84,_0x74eedb){const _0x3bab41=a138_0x34bdad;var _0x12d215=arguments[_0x3bab41(0xd2)],_0x19fcea=_0x12d215<0x3?_0x4c0977:_0x74eedb===null?_0x74eedb=Object[_0x3bab41(0xd9)](_0x4c0977,_0x59aa84):_0x74eedb,_0x5803f9;if(typeof Reflect===_0x3bab41(0xe3)&&typeof Reflect['decorate']===_0x3bab41(0xb2))_0x19fcea=Reflect[_0x3bab41(0xcb)](_0x402b72,_0x4c0977,_0x59aa84,_0x74eedb);else{for(var _0x3ed63f=_0x402b72[_0x3bab41(0xd2)]-0x1;_0x3ed63f>=0x0;_0x3ed63f--)if(_0x5803f9=_0x402b72[_0x3ed63f])_0x19fcea=(_0x12d215<0x3?_0x5803f9(_0x19fcea):_0x12d215>0x3?_0x5803f9(_0x4c0977,_0x59aa84,_0x19fcea):_0x5803f9(_0x4c0977,_0x59aa84))||_0x19fcea;}return _0x12d215>0x3&&_0x19fcea&&Object[_0x3bab41(0xa2)](_0x4c0977,_0x59aa84,_0x19fcea),_0x19fcea;},__metadata=this&&this[a138_0x34bdad(0xaa)]||function(_0x5a1bcc,_0x4a852e){const _0x47f7cd=a138_0x34bdad;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x47f7cd(0xb2))return Reflect[_0x47f7cd(0xb7)](_0x5a1bcc,_0x4a852e);},StreamingService_1;Object[a138_0x34bdad(0xa2)](exports,a138_0x34bdad(0xa6),{'value':!![]}),exports[a138_0x34bdad(0xc8)]=void 0x0;function a138_0x30fe(_0xfb723,_0x1a9080){const _0x424680=a138_0x4246();return a138_0x30fe=function(_0x30fe05,_0x48a7b7){_0x30fe05=_0x30fe05-0x9d;let _0x5b6142=_0x424680[_0x30fe05];return _0x5b6142;},a138_0x30fe(_0xfb723,_0x1a9080);}const common_1=require('@nestjs/common'),child_process_1=require(a138_0x34bdad(0xa9)),fs_1=require('fs'),puppeteer_1=require('../helpers/puppeteer'),streaming_gateway_1=require('./streaming.gateway'),user_service_1=require(a138_0x34bdad(0xa8)),jwt_1=require(a138_0x34bdad(0xa0));let StreamingService=StreamingService_1=class StreamingService{constructor(_0x423947,_0x53415c){const _0x27a283=a138_0x34bdad;this[_0x27a283(0xb0)]=_0x423947,this[_0x27a283(0xd0)]=_0x53415c,this[_0x27a283(0xa7)]=new common_1['Logger'](StreamingService_1['name']);}[a138_0x34bdad(0xe2)](){const _0x1a2f76=a138_0x34bdad;if(!this[_0x1a2f76(0xba)])this[_0x1a2f76(0xba)]=(0x0,child_process_1[_0x1a2f76(0xd5)])(_0x1a2f76(0xbd),['-']);}async[a138_0x34bdad(0xde)](_0x221abb){const _0x2d3070=a138_0x34bdad;this[_0x2d3070(0xe2)](),_0x221abb[_0x2d3070(0xb5)](this[_0x2d3070(0xba)][_0x2d3070(0xc2)]),this[_0x2d3070(0xba)][_0x2d3070(0xb3)]['on']('error',_0x28e334=>{_0x28e334['code']=='EPIPE'&&process['exit'](0x0);}),this[_0x2d3070(0xba)][_0x2d3070(0xc2)]['on'](_0x2d3070(0xbe),_0x5dab88=>{const _0x681d35=_0x2d3070;this[_0x681d35(0xa7)][_0x681d35(0xcd)](_0x5dab88);}),this[_0x2d3070(0xba)]['stdout']['on'](_0x2d3070(0xce),_0x15aa55=>{const _0x4018b8=_0x2d3070;this[_0x4018b8(0xa7)]['log'](_0x4018b8(0xaf)+_0x15aa55);}),this[_0x2d3070(0xba)][_0x2d3070(0xc9)]['on'](_0x2d3070(0xce),_0x21490e=>{const _0x5119f5=_0x2d3070;this[_0x5119f5(0xa7)][_0x5119f5(0xcd)](_0x5119f5(0x9f)+_0x21490e);}),this['childProcess']['on']('exit',_0x31f12f=>{const _0xf4d64a=_0x2d3070;this[_0xf4d64a(0xa7)][_0xf4d64a(0xcd)](_0xf4d64a(0xcc)),this[_0xf4d64a(0xba)]['kill'](),this[_0xf4d64a(0xba)]=null,_0x31f12f!==0x0&&this[_0xf4d64a(0xa7)][_0xf4d64a(0xcd)](_0xf4d64a(0xb9)+_0x31f12f);});return;}[a138_0x34bdad(0xad)](_0x3e910d){const _0x4fa0e5=a138_0x34bdad,_0x1f90b3=new Promise((_0x5a3e5e,_0x539f4b)=>{const _0x15c6a8=a138_0x30fe;this[_0x15c6a8(0xe2)](),_0x3e910d[_0x15c6a8(0xb5)](this[_0x15c6a8(0xba)]['stdin']),this['childProcess']['stdout']['on']('error',_0x1f3019=>{const _0x5abd8c=_0x15c6a8;_0x1f3019[_0x5abd8c(0xca)]==_0x5abd8c(0xc5)&&process[_0x5abd8c(0xcc)](0x0);}),this['childProcess']['stdin']['on'](_0x15c6a8(0xbe),_0x224048=>{const _0x16e211=_0x15c6a8;this['logger'][_0x16e211(0xcd)](_0x224048);}),this[_0x15c6a8(0xba)]['stdout']['on'](_0x15c6a8(0xce),_0xb47a10=>{const _0x161dc5=_0x15c6a8;this[_0x161dc5(0xa7)][_0x161dc5(0xcd)]('stdout\x20data:\x20'+_0xb47a10);}),this[_0x15c6a8(0xba)][_0x15c6a8(0xc9)]['on'](_0x15c6a8(0xce),_0xf43073=>{const _0x5bc6bd=_0x15c6a8;this[_0x5bc6bd(0xa7)][_0x5bc6bd(0xcd)](_0x5bc6bd(0x9f)+_0xf43073);}),this[_0x15c6a8(0xba)]['on']('exit',_0x3ee6ca=>{const _0x56c558=_0x15c6a8;_0x5a3e5e(!![]),this[_0x56c558(0xa7)]['log'](_0x56c558(0xcc)),this[_0x56c558(0xba)][_0x56c558(0xcf)](),this[_0x56c558(0xba)]=null,_0x3ee6ca!==0x0&&this['logger'][_0x56c558(0xcd)](_0x56c558(0xb9)+_0x3ee6ca);});});return{'process':this[_0x4fa0e5(0xba)],'promise':_0x1f90b3};}[a138_0x34bdad(0xae)](_0x203dc4){const _0x274855=a138_0x34bdad;return(0x0,fs_1[_0x274855(0xd4)])(_0x203dc4);}async[a138_0x34bdad(0xbb)](){const _0xd0caec=a138_0x34bdad;this[_0xd0caec(0xba)]['kill']();}async['openServerUIStream'](){const _0x357881=a138_0x34bdad;try{const _0x1d54c4=process[_0x357881(0xd6)]['STREAM_SERVER_URL']+'/stream';!this[_0x357881(0xc6)]&&(this['browser']=await(0x0,puppeteer_1['launchBrowser'])());const _0x397a87=await(0x0,puppeteer_1[_0x357881(0xb6)])(this[_0x357881(0xc6)]);if(_0x397a87[_0x357881(0xab)](_0x1d54c4)){console[_0x357881(0xcd)](_0x357881(0xe4)),this[_0x357881(0xdd)][_0x357881(0xe1)]();return;}const _0x45d5ec=this['page']||await(0x0,puppeteer_1[_0x357881(0xbf)])(this['browser']),_0x18e72b=await this[_0x357881(0xb0)][_0x357881(0xe5)]();await _0x45d5ec['setCookie']({'name':_0x357881(0xb4),'url':process[_0x357881(0xd6)][_0x357881(0xb1)],'value':_0x18e72b}),await _0x45d5ec[_0x357881(0xac)](_0x1d54c4),await _0x45d5ec[_0x357881(0xc1)](_0x357881(0xa4));}catch(_0x55b0ec){console[_0x357881(0xcd)](_0x55b0ec,_0x357881(0xc7));}}async[a138_0x34bdad(0xc4)](){const _0x36c687=a138_0x34bdad;try{this['page']&&(await this[_0x36c687(0xd3)][_0x36c687(0x9d)](),this[_0x36c687(0xd3)]=null);}catch(_0x21d77b){console[_0x36c687(0xcd)](_0x21d77b,'Error\x20when\x20close\x20page');}}};__decorate([(0x0,common_1[a138_0x34bdad(0xd8)])(streaming_gateway_1[a138_0x34bdad(0xdb)]),__metadata('design:type',streaming_gateway_1[a138_0x34bdad(0xdb)])],StreamingService[a138_0x34bdad(0xda)],a138_0x34bdad(0xdd),void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(a138_0x34bdad(0xa5),[user_service_1['UserService'],jwt_1[a138_0x34bdad(0xb8)]])],StreamingService),exports[a138_0x34bdad(0xc8)]=StreamingService;