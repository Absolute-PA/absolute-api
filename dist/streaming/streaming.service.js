'use strict';const a141_0xfe355=a141_0x32d3;function a141_0x32d3(_0x32db5e,_0x451569){const _0x33857b=a141_0x3385();return a141_0x32d3=function(_0x32d3b2,_0x2fbbf8){_0x32d3b2=_0x32d3b2-0x100;let _0x999b63=_0x33857b[_0x32d3b2];return _0x999b63;},a141_0x32d3(_0x32db5e,_0x451569);}(function(_0x338062,_0x33f9e4){const _0x59660c=a141_0x32d3,_0x16ae70=_0x338062();while(!![]){try{const _0x2cd2e8=-parseInt(_0x59660c(0x137))/0x1+parseInt(_0x59660c(0x105))/0x2+-parseInt(_0x59660c(0x13b))/0x3+parseInt(_0x59660c(0x142))/0x4*(-parseInt(_0x59660c(0x103))/0x5)+parseInt(_0x59660c(0x138))/0x6*(-parseInt(_0x59660c(0x113))/0x7)+parseInt(_0x59660c(0x136))/0x8+parseInt(_0x59660c(0x118))/0x9*(parseInt(_0x59660c(0x10d))/0xa);if(_0x2cd2e8===_0x33f9e4)break;else _0x16ae70['push'](_0x16ae70['shift']());}catch(_0x4a77eb){_0x16ae70['push'](_0x16ae70['shift']());}}}(a141_0x3385,0xd898a));var __decorate=this&&this[a141_0xfe355(0x116)]||function(_0x20d31b,_0x20e8c3,_0x4eaa85,_0x47599a){const _0x22151e=a141_0xfe355;var _0xf3f23f=arguments[_0x22151e(0x144)],_0x4ab993=_0xf3f23f<0x3?_0x20e8c3:_0x47599a===null?_0x47599a=Object[_0x22151e(0x128)](_0x20e8c3,_0x4eaa85):_0x47599a,_0x4dc6e1;if(typeof Reflect===_0x22151e(0x129)&&typeof Reflect[_0x22151e(0x147)]===_0x22151e(0x11f))_0x4ab993=Reflect['decorate'](_0x20d31b,_0x20e8c3,_0x4eaa85,_0x47599a);else{for(var _0x1aa69a=_0x20d31b[_0x22151e(0x144)]-0x1;_0x1aa69a>=0x0;_0x1aa69a--)if(_0x4dc6e1=_0x20d31b[_0x1aa69a])_0x4ab993=(_0xf3f23f<0x3?_0x4dc6e1(_0x4ab993):_0xf3f23f>0x3?_0x4dc6e1(_0x20e8c3,_0x4eaa85,_0x4ab993):_0x4dc6e1(_0x20e8c3,_0x4eaa85))||_0x4ab993;}return _0xf3f23f>0x3&&_0x4ab993&&Object[_0x22151e(0x141)](_0x20e8c3,_0x4eaa85,_0x4ab993),_0x4ab993;},__metadata=this&&this[a141_0xfe355(0x110)]||function(_0x3111d3,_0x423e12){const _0x3790fd=a141_0xfe355;if(typeof Reflect===_0x3790fd(0x129)&&typeof Reflect[_0x3790fd(0x139)]===_0x3790fd(0x11f))return Reflect[_0x3790fd(0x139)](_0x3111d3,_0x423e12);},StreamingService_1;Object['defineProperty'](exports,a141_0xfe355(0x145),{'value':!![]}),exports['StreamingService']=void 0x0;function a141_0x3385(){const _0x349394=['__metadata','stdout\x20data:\x20','grep\x20process\x20exited\x20with\x20code\x20','1701182Mjxcdg','page','close','__decorate','stderr','9984591xQmYuY','design:paramtypes','child_process','playStreamAudioAsync','name','code','spawnMpgPlayer','function','kill','mpg123','StreamingService','data','error','streamingGateway','Injectable','closeServerUIStream','getOwnPropertyDescriptor','object','/stream','Error\x20when\x20close\x20page','browser','spawn','../helpers/puppeteer','exit','childProcess','@nestjs/common','log','goto','userService','prototype','6166536nZFCqD','630592MTYRsO','12OXeRtv','metadata','env','4668636kmobQi','jwtService','design:type','STREAM_SERVER_URL','stdout','EPIPE','defineProperty','143124qHWRIi','Error\x20when\x20open\x20page','length','__esModule','logger','decorate','createReadStream','stdin','getBrowserUrls','Server\x20stream\x20browser\x20already\x20open','openServerUIStream','35fLgTZX','Logger','1641772pcjRUu','StreamingGateway','pipe','stderr\x20data:\x20','openNewpage','playStreamAudio','setCookie','body','20VtWeNs','./streaming.gateway','UserService'];a141_0x3385=function(){return _0x349394;};return a141_0x3385();}const common_1=require(a141_0xfe355(0x131)),child_process_1=require(a141_0xfe355(0x11a)),fs_1=require('fs'),puppeteer_1=require(a141_0xfe355(0x12e)),streaming_gateway_1=require(a141_0xfe355(0x10e)),user_service_1=require('../user/user.service'),jwt_1=require('@nestjs/jwt');let StreamingService=StreamingService_1=class StreamingService{constructor(_0x4abf92,_0x4dcb7d){const _0x55dc57=a141_0xfe355;this['userService']=_0x4abf92,this[_0x55dc57(0x13c)]=_0x4dcb7d,this[_0x55dc57(0x146)]=new common_1[(_0x55dc57(0x104))](StreamingService_1[_0x55dc57(0x11c)]);}['spawnMpgPlayer'](){const _0x4d5da6=a141_0xfe355;if(!this[_0x4d5da6(0x130)])this[_0x4d5da6(0x130)]=(0x0,child_process_1[_0x4d5da6(0x12d)])(_0x4d5da6(0x121),['-']);}async[a141_0xfe355(0x10a)](_0x1edf2b){const _0x37ef7e=a141_0xfe355;this[_0x37ef7e(0x11e)](),_0x1edf2b['pipe'](this['childProcess']['stdin']),this['childProcess'][_0x37ef7e(0x13f)]['on'](_0x37ef7e(0x124),_0x245c67=>{const _0x25a6ac=_0x37ef7e;_0x245c67[_0x25a6ac(0x11d)]==_0x25a6ac(0x140)&&process[_0x25a6ac(0x12f)](0x0);}),this[_0x37ef7e(0x130)][_0x37ef7e(0x149)]['on'](_0x37ef7e(0x124),_0x2dc391=>{const _0x13ed43=_0x37ef7e;this[_0x13ed43(0x146)]['log'](_0x2dc391);}),this['childProcess'][_0x37ef7e(0x13f)]['on'](_0x37ef7e(0x123),_0x2c3797=>{const _0x218e7d=_0x37ef7e;this[_0x218e7d(0x146)][_0x218e7d(0x132)](_0x218e7d(0x111)+_0x2c3797);}),this[_0x37ef7e(0x130)][_0x37ef7e(0x117)]['on'](_0x37ef7e(0x123),_0x95cb0b=>{const _0x4300b4=_0x37ef7e;this[_0x4300b4(0x146)][_0x4300b4(0x132)](_0x4300b4(0x108)+_0x95cb0b);}),this[_0x37ef7e(0x130)]['on'](_0x37ef7e(0x12f),_0x1ec8ac=>{const _0x1dbe42=_0x37ef7e;this[_0x1dbe42(0x146)][_0x1dbe42(0x132)](_0x1dbe42(0x12f)),this['childProcess']['kill'](),this[_0x1dbe42(0x130)]=null,_0x1ec8ac!==0x0&&this[_0x1dbe42(0x146)][_0x1dbe42(0x132)]('grep\x20process\x20exited\x20with\x20code\x20'+_0x1ec8ac);});return;}[a141_0xfe355(0x11b)](_0x140512){const _0x5b58f7=a141_0xfe355,_0xf58293=new Promise((_0x16e5f1,_0x54f8ce)=>{const _0x139f85=a141_0x32d3;this[_0x139f85(0x11e)](),_0x140512[_0x139f85(0x107)](this[_0x139f85(0x130)][_0x139f85(0x149)]),this[_0x139f85(0x130)][_0x139f85(0x13f)]['on']('error',_0xb01181=>{const _0x5e0fd3=_0x139f85;_0xb01181[_0x5e0fd3(0x11d)]==_0x5e0fd3(0x140)&&process['exit'](0x0);}),this[_0x139f85(0x130)][_0x139f85(0x149)]['on'](_0x139f85(0x124),_0x565441=>{const _0x2c1353=_0x139f85;this[_0x2c1353(0x146)]['log'](_0x565441);}),this[_0x139f85(0x130)]['stdout']['on'](_0x139f85(0x123),_0x2ac89f=>{const _0x1377b9=_0x139f85;this[_0x1377b9(0x146)]['log']('stdout\x20data:\x20'+_0x2ac89f);}),this['childProcess'][_0x139f85(0x117)]['on'](_0x139f85(0x123),_0x58e59f=>{const _0x2c32c=_0x139f85;this[_0x2c32c(0x146)][_0x2c32c(0x132)]('stderr\x20data:\x20'+_0x58e59f);}),this[_0x139f85(0x130)]['on']('exit',_0x242974=>{const _0x5bf498=_0x139f85;_0x16e5f1(!![]),this[_0x5bf498(0x146)][_0x5bf498(0x132)](_0x5bf498(0x12f)),this[_0x5bf498(0x130)][_0x5bf498(0x120)](),this[_0x5bf498(0x130)]=null,_0x242974!==0x0&&this[_0x5bf498(0x146)][_0x5bf498(0x132)](_0x5bf498(0x112)+_0x242974);});});return{'process':this[_0x5b58f7(0x130)],'promise':_0xf58293};}['createStreamFromFile'](_0x2c7ce2){const _0x3bb7a2=a141_0xfe355;return(0x0,fs_1[_0x3bb7a2(0x148)])(_0x2c7ce2);}async['stopStreamAudio'](){const _0x444790=a141_0xfe355;this[_0x444790(0x130)]['kill']();}async[a141_0xfe355(0x102)](){const _0xff3cf5=a141_0xfe355;try{const _0x447bba=process[_0xff3cf5(0x13a)][_0xff3cf5(0x13e)]+_0xff3cf5(0x12a);!this['browser']&&(this[_0xff3cf5(0x12c)]=await(0x0,puppeteer_1['launchBrowser'])());const _0x2a4f8a=await(0x0,puppeteer_1[_0xff3cf5(0x100)])(this['browser']);if(_0x2a4f8a['includes'](_0x447bba)){console[_0xff3cf5(0x132)](_0xff3cf5(0x101)),this[_0xff3cf5(0x125)]['reconnectPeer']();return;}const _0x5002dc=this[_0xff3cf5(0x114)]||await(0x0,puppeteer_1[_0xff3cf5(0x109)])(this[_0xff3cf5(0x12c)]),_0x1d46a7=await this[_0xff3cf5(0x134)]['getMasterUserAccessToken']();await _0x5002dc[_0xff3cf5(0x10b)]({'name':'accessToken','url':process[_0xff3cf5(0x13a)]['STREAM_SERVER_URL'],'value':_0x1d46a7}),await _0x5002dc[_0xff3cf5(0x133)](_0x447bba),await _0x5002dc['focus'](_0xff3cf5(0x10c));}catch(_0x19ea01){console[_0xff3cf5(0x132)](_0x19ea01,_0xff3cf5(0x143));}}async[a141_0xfe355(0x127)](){const _0x126c65=a141_0xfe355;try{this[_0x126c65(0x114)]&&(await this[_0x126c65(0x114)][_0x126c65(0x115)](),this[_0x126c65(0x114)]=null);}catch(_0x43c26e){console[_0x126c65(0x132)](_0x43c26e,_0x126c65(0x12b));}}};__decorate([(0x0,common_1['Inject'])(streaming_gateway_1[a141_0xfe355(0x106)]),__metadata(a141_0xfe355(0x13d),streaming_gateway_1[a141_0xfe355(0x106)])],StreamingService[a141_0xfe355(0x135)],a141_0xfe355(0x125),void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a141_0xfe355(0x126)])(),__metadata(a141_0xfe355(0x119),[user_service_1[a141_0xfe355(0x10f)],jwt_1['JwtService']])],StreamingService),exports[a141_0xfe355(0x122)]=StreamingService;