'use strict';const a141_0x452c85=a141_0x3044;(function(_0x2f839a,_0x3e86fe){const _0x1e05af=a141_0x3044,_0x23384d=_0x2f839a();while(!![]){try{const _0x47b4cc=parseInt(_0x1e05af(0xe3))/0x1+parseInt(_0x1e05af(0xdc))/0x2+parseInt(_0x1e05af(0xd3))/0x3+-parseInt(_0x1e05af(0x104))/0x4*(-parseInt(_0x1e05af(0x10f))/0x5)+parseInt(_0x1e05af(0x105))/0x6+-parseInt(_0x1e05af(0xf9))/0x7*(parseInt(_0x1e05af(0xff))/0x8)+-parseInt(_0x1e05af(0x100))/0x9;if(_0x47b4cc===_0x3e86fe)break;else _0x23384d['push'](_0x23384d['shift']());}catch(_0x35d0dc){_0x23384d['push'](_0x23384d['shift']());}}}(a141_0xa7b8,0xd73bc));var __decorate=this&&this['__decorate']||function(_0x1a5dbc,_0x113605,_0x3863d2,_0x3ea21c){const _0x3d4fc2=a141_0x3044;var _0x2be851=arguments[_0x3d4fc2(0xef)],_0x580feb=_0x2be851<0x3?_0x113605:_0x3ea21c===null?_0x3ea21c=Object[_0x3d4fc2(0xe5)](_0x113605,_0x3863d2):_0x3ea21c,_0x48f54f;if(typeof Reflect===_0x3d4fc2(0xfe)&&typeof Reflect[_0x3d4fc2(0xeb)]==='function')_0x580feb=Reflect[_0x3d4fc2(0xeb)](_0x1a5dbc,_0x113605,_0x3863d2,_0x3ea21c);else{for(var _0xdc3985=_0x1a5dbc[_0x3d4fc2(0xef)]-0x1;_0xdc3985>=0x0;_0xdc3985--)if(_0x48f54f=_0x1a5dbc[_0xdc3985])_0x580feb=(_0x2be851<0x3?_0x48f54f(_0x580feb):_0x2be851>0x3?_0x48f54f(_0x113605,_0x3863d2,_0x580feb):_0x48f54f(_0x113605,_0x3863d2))||_0x580feb;}return _0x2be851>0x3&&_0x580feb&&Object[_0x3d4fc2(0x108)](_0x113605,_0x3863d2,_0x580feb),_0x580feb;},__metadata=this&&this[a141_0x452c85(0xf0)]||function(_0x5c66a2,_0x1f4753){const _0x425d6c=a141_0x452c85;if(typeof Reflect===_0x425d6c(0xfe)&&typeof Reflect[_0x425d6c(0x102)]===_0x425d6c(0x106))return Reflect[_0x425d6c(0x102)](_0x5c66a2,_0x1f4753);},StreamingService_1;Object[a141_0x452c85(0x108)](exports,a141_0x452c85(0x111),{'value':!![]}),exports['StreamingService']=void 0x0;function a141_0xa7b8(){const _0x46a4dd=['28432719DtJzCS','createReadStream','metadata','stdout','34792FSWznX','7073484fShAeU','function','EPIPE','defineProperty','@nestjs/jwt','grep\x20process\x20exited\x20with\x20code\x20','spawn','body','../user/user.service','mpg123','285ceRhBP','streamingGateway','__esModule','Server\x20stream\x20browser\x20already\x20open','data','focus','spawnMpgPlayer','page','../helpers/puppeteer','error','1763046rWxyDR','stopStreamAudio','exit','JwtService','logger','Inject','prototype','createStreamFromFile','closeServerUIStream','2157866brzvOR','/stream','design:type','setCookie','getBrowserUrls','playStreamAudio','StreamingGateway','1653972JORmGu','Logger','getOwnPropertyDescriptor','childProcess','stdin','launchBrowser','stderr\x20data:\x20','code','decorate','pipe','goto','openServerUIStream','length','__metadata','playStreamAudioAsync','userService','stdout\x20data:\x20','kill','design:paramtypes','Error\x20when\x20close\x20page','stderr','jwtService','13363AMfSnB','close','STREAM_SERVER_URL','browser','log','object','4000SjUJwk'];a141_0xa7b8=function(){return _0x46a4dd;};return a141_0xa7b8();}function a141_0x3044(_0x2b5f70,_0x38d1b8){const _0xa7b8c3=a141_0xa7b8();return a141_0x3044=function(_0x304431,_0x59579b){_0x304431=_0x304431-0xd3;let _0x195b0a=_0xa7b8c3[_0x304431];return _0x195b0a;},a141_0x3044(_0x2b5f70,_0x38d1b8);}const common_1=require('@nestjs/common'),child_process_1=require('child_process'),fs_1=require('fs'),puppeteer_1=require(a141_0x452c85(0x117)),streaming_gateway_1=require('./streaming.gateway'),user_service_1=require(a141_0x452c85(0x10d)),jwt_1=require(a141_0x452c85(0x109));let StreamingService=StreamingService_1=class StreamingService{constructor(_0x2a2dc1,_0x5ce607){const _0x550426=a141_0x452c85;this[_0x550426(0xf2)]=_0x2a2dc1,this[_0x550426(0xf8)]=_0x5ce607,this[_0x550426(0xd7)]=new common_1[(_0x550426(0xe4))](StreamingService_1['name']);}[a141_0x452c85(0x115)](){const _0x32fda8=a141_0x452c85;if(!this[_0x32fda8(0xe6)])this[_0x32fda8(0xe6)]=(0x0,child_process_1[_0x32fda8(0x10b)])(_0x32fda8(0x10e),['-']);}async[a141_0x452c85(0xe1)](_0x1e9be9){const _0x9b47a7=a141_0x452c85;this[_0x9b47a7(0x115)](),_0x1e9be9[_0x9b47a7(0xec)](this['childProcess'][_0x9b47a7(0xe7)]),this[_0x9b47a7(0xe6)][_0x9b47a7(0x103)]['on'](_0x9b47a7(0x118),_0x57f5ec=>{const _0xd62a3d=_0x9b47a7;_0x57f5ec[_0xd62a3d(0xea)]==_0xd62a3d(0x107)&&process[_0xd62a3d(0xd5)](0x0);}),this[_0x9b47a7(0xe6)][_0x9b47a7(0xe7)]['on'](_0x9b47a7(0x118),_0x3ecda6=>{const _0x2c39b5=_0x9b47a7;this[_0x2c39b5(0xd7)][_0x2c39b5(0xfd)](_0x3ecda6);}),this[_0x9b47a7(0xe6)]['stdout']['on'](_0x9b47a7(0x113),_0x50ed7f=>{const _0x1cf84a=_0x9b47a7;this[_0x1cf84a(0xd7)][_0x1cf84a(0xfd)](_0x1cf84a(0xf3)+_0x50ed7f);}),this[_0x9b47a7(0xe6)]['stderr']['on'](_0x9b47a7(0x113),_0x21912e=>{const _0x3917f8=_0x9b47a7;this[_0x3917f8(0xd7)]['log'](_0x3917f8(0xe9)+_0x21912e);}),this['childProcess']['on']('exit',_0x29d2bc=>{const _0xdae085=_0x9b47a7;this[_0xdae085(0xd7)][_0xdae085(0xfd)](_0xdae085(0xd5)),this[_0xdae085(0xe6)][_0xdae085(0xf4)](),this[_0xdae085(0xe6)]=null,_0x29d2bc!==0x0&&this[_0xdae085(0xd7)][_0xdae085(0xfd)]('grep\x20process\x20exited\x20with\x20code\x20'+_0x29d2bc);});return;}[a141_0x452c85(0xf1)](_0x541d26){const _0x27ae5c=a141_0x452c85,_0x205c05=new Promise((_0x1a20c9,_0x269764)=>{const _0x75f48c=a141_0x3044;this[_0x75f48c(0x115)](),_0x541d26[_0x75f48c(0xec)](this[_0x75f48c(0xe6)][_0x75f48c(0xe7)]),this[_0x75f48c(0xe6)][_0x75f48c(0x103)]['on']('error',_0x22f8a5=>{const _0x39953d=_0x75f48c;_0x22f8a5[_0x39953d(0xea)]==_0x39953d(0x107)&&process['exit'](0x0);}),this[_0x75f48c(0xe6)][_0x75f48c(0xe7)]['on'](_0x75f48c(0x118),_0x244b61=>{const _0x341039=_0x75f48c;this[_0x341039(0xd7)][_0x341039(0xfd)](_0x244b61);}),this['childProcess'][_0x75f48c(0x103)]['on'](_0x75f48c(0x113),_0x1c9874=>{const _0x36a281=_0x75f48c;this[_0x36a281(0xd7)][_0x36a281(0xfd)](_0x36a281(0xf3)+_0x1c9874);}),this[_0x75f48c(0xe6)][_0x75f48c(0xf7)]['on'](_0x75f48c(0x113),_0x92bd2a=>{const _0x14c204=_0x75f48c;this['logger']['log'](_0x14c204(0xe9)+_0x92bd2a);}),this[_0x75f48c(0xe6)]['on'](_0x75f48c(0xd5),_0x4fa4c9=>{const _0x52b7b4=_0x75f48c;_0x1a20c9(!![]),this[_0x52b7b4(0xd7)]['log'](_0x52b7b4(0xd5)),this[_0x52b7b4(0xe6)][_0x52b7b4(0xf4)](),this[_0x52b7b4(0xe6)]=null,_0x4fa4c9!==0x0&&this[_0x52b7b4(0xd7)][_0x52b7b4(0xfd)](_0x52b7b4(0x10a)+_0x4fa4c9);});});return{'process':this[_0x27ae5c(0xe6)],'promise':_0x205c05};}[a141_0x452c85(0xda)](_0x3922de){const _0x55d449=a141_0x452c85;return(0x0,fs_1[_0x55d449(0x101)])(_0x3922de);}async[a141_0x452c85(0xd4)](){const _0x5a887a=a141_0x452c85;this[_0x5a887a(0xe6)][_0x5a887a(0xf4)]();}async[a141_0x452c85(0xee)](){const _0x41e0fc=a141_0x452c85;try{const _0x347c80=process['env'][_0x41e0fc(0xfb)]+_0x41e0fc(0xdd);!this[_0x41e0fc(0xfc)]&&(this['browser']=await(0x0,puppeteer_1[_0x41e0fc(0xe8)])());const _0x1bbc5a=await(0x0,puppeteer_1[_0x41e0fc(0xe0)])(this[_0x41e0fc(0xfc)]);if(_0x1bbc5a['includes'](_0x347c80)){console[_0x41e0fc(0xfd)](_0x41e0fc(0x112)),this['streamingGateway']['reconnectPeer']();return;}const _0x25758f=this['page']||await(0x0,puppeteer_1['openNewpage'])(this[_0x41e0fc(0xfc)]),_0x1b1b9c=await this[_0x41e0fc(0xf2)]['getMasterUserAccessToken']();await _0x25758f[_0x41e0fc(0xdf)]({'name':'accessToken','url':process['env'][_0x41e0fc(0xfb)],'value':_0x1b1b9c}),await _0x25758f[_0x41e0fc(0xed)](_0x347c80),await _0x25758f[_0x41e0fc(0x114)](_0x41e0fc(0x10c));}catch(_0x331bcf){console[_0x41e0fc(0xfd)](_0x331bcf,'Error\x20when\x20open\x20page');}}async[a141_0x452c85(0xdb)](){const _0x41ac3f=a141_0x452c85;try{this[_0x41ac3f(0x116)]&&(await this['page'][_0x41ac3f(0xfa)](),this[_0x41ac3f(0x116)]=null);}catch(_0xe64d7e){console[_0x41ac3f(0xfd)](_0xe64d7e,_0x41ac3f(0xf6));}}};__decorate([(0x0,common_1[a141_0x452c85(0xd8)])(streaming_gateway_1[a141_0x452c85(0xe2)]),__metadata(a141_0x452c85(0xde),streaming_gateway_1[a141_0x452c85(0xe2)])],StreamingService[a141_0x452c85(0xd9)],a141_0x452c85(0x110),void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(a141_0x452c85(0xf5),[user_service_1['UserService'],jwt_1[a141_0x452c85(0xd6)]])],StreamingService),exports['StreamingService']=StreamingService;