'use strict';const a138_0x56249b=a138_0x5d20;(function(_0x89eed6,_0x530f0d){const _0x1ae493=a138_0x5d20,_0x24dd59=_0x89eed6();while(!![]){try{const _0x32e0f4=-parseInt(_0x1ae493(0xd6))/0x1*(parseInt(_0x1ae493(0xde))/0x2)+-parseInt(_0x1ae493(0xe5))/0x3*(-parseInt(_0x1ae493(0xa8))/0x4)+-parseInt(_0x1ae493(0xbf))/0x5*(parseInt(_0x1ae493(0xae))/0x6)+-parseInt(_0x1ae493(0xe6))/0x7+-parseInt(_0x1ae493(0xd4))/0x8+parseInt(_0x1ae493(0xd0))/0x9*(-parseInt(_0x1ae493(0xb9))/0xa)+-parseInt(_0x1ae493(0xd3))/0xb*(-parseInt(_0x1ae493(0xeb))/0xc);if(_0x32e0f4===_0x530f0d)break;else _0x24dd59['push'](_0x24dd59['shift']());}catch(_0x565bef){_0x24dd59['push'](_0x24dd59['shift']());}}}(a138_0x24fd,0x8721f));var __decorate=this&&this['__decorate']||function(_0x49049b,_0x4d5baf,_0x128654,_0x91138){const _0x5856f4=a138_0x5d20;var _0x3ece4f=arguments[_0x5856f4(0xdb)],_0x3bfe8b=_0x3ece4f<0x3?_0x4d5baf:_0x91138===null?_0x91138=Object[_0x5856f4(0xba)](_0x4d5baf,_0x128654):_0x91138,_0x4e1130;if(typeof Reflect===_0x5856f4(0xa9)&&typeof Reflect[_0x5856f4(0xc9)]===_0x5856f4(0xda))_0x3bfe8b=Reflect[_0x5856f4(0xc9)](_0x49049b,_0x4d5baf,_0x128654,_0x91138);else{for(var _0x37c549=_0x49049b[_0x5856f4(0xdb)]-0x1;_0x37c549>=0x0;_0x37c549--)if(_0x4e1130=_0x49049b[_0x37c549])_0x3bfe8b=(_0x3ece4f<0x3?_0x4e1130(_0x3bfe8b):_0x3ece4f>0x3?_0x4e1130(_0x4d5baf,_0x128654,_0x3bfe8b):_0x4e1130(_0x4d5baf,_0x128654))||_0x3bfe8b;}return _0x3ece4f>0x3&&_0x3bfe8b&&Object[_0x5856f4(0xb2)](_0x4d5baf,_0x128654,_0x3bfe8b),_0x3bfe8b;},__metadata=this&&this[a138_0x56249b(0xbd)]||function(_0xf94991,_0x3f5e42){const _0x41569=a138_0x56249b;if(typeof Reflect===_0x41569(0xa9)&&typeof Reflect[_0x41569(0xd5)]===_0x41569(0xda))return Reflect[_0x41569(0xd5)](_0xf94991,_0x3f5e42);},StreamingService_1;Object['defineProperty'](exports,a138_0x56249b(0xd9),{'value':!![]}),exports[a138_0x56249b(0xc0)]=void 0x0;const common_1=require(a138_0x56249b(0xa7)),child_process_1=require('child_process'),fs_1=require('fs'),puppeteer_1=require(a138_0x56249b(0xb5)),streaming_gateway_1=require(a138_0x56249b(0xb0)),user_service_1=require('../user/user.service'),jwt_1=require(a138_0x56249b(0xdc));function a138_0x24fd(){const _0x1d160f=['object','stopStreamAudio','userService','kill','Inject','12KcVRWF','STREAM_SERVER_URL','./streaming.gateway','stderr\x20data:\x20','defineProperty','exit','accessToken','../helpers/puppeteer','StreamingGateway','body','closeServerUIStream','4680JDUYur','getOwnPropertyDescriptor','error','EPIPE','__metadata','stdin','11360BfkadP','StreamingService','page','prototype','JwtService','focus','Error\x20when\x20open\x20page','stderr','streamingGateway','grep\x20process\x20exited\x20with\x20code\x20','decorate','/stream','data','Logger','includes','UserService','mpg123','11682XpXjeq','Error\x20when\x20close\x20page','name','22VdsJfT','1537624neRMmX','metadata','217UPnjEO','setCookie','createReadStream','__esModule','function','length','@nestjs/jwt','pipe','982CQOkZC','code','jwtService','playStreamAudioAsync','close','browser','Server\x20stream\x20browser\x20already\x20open','15GnSsLM','687085zqcMDl','logger','playStreamAudio','reconnectPeer','stdout\x20data:\x20','5069916OhPcEP','childProcess','openNewpage','getMasterUserAccessToken','spawn','createStreamFromFile','env','Injectable','stdout','goto','getBrowserUrls','log','@nestjs/common','573944bbGfWX'];a138_0x24fd=function(){return _0x1d160f;};return a138_0x24fd();}function a138_0x5d20(_0x22f529,_0x2a3e0c){const _0x24fdaa=a138_0x24fd();return a138_0x5d20=function(_0x5d2079,_0x23100e){_0x5d2079=_0x5d2079-0xa0;let _0x99802e=_0x24fdaa[_0x5d2079];return _0x99802e;},a138_0x5d20(_0x22f529,_0x2a3e0c);}let StreamingService=StreamingService_1=class StreamingService{constructor(_0x170ac4,_0x3b0b52){const _0x5c61d7=a138_0x56249b;this[_0x5c61d7(0xab)]=_0x170ac4,this[_0x5c61d7(0xe0)]=_0x3b0b52,this[_0x5c61d7(0xe7)]=new common_1[(_0x5c61d7(0xcc))](StreamingService_1[_0x5c61d7(0xd2)]);}['spawnMpgPlayer'](){const _0x1a79b1=a138_0x56249b;if(!this[_0x1a79b1(0xec)])this['childProcess']=(0x0,child_process_1[_0x1a79b1(0xef)])(_0x1a79b1(0xcf),['-']);}async[a138_0x56249b(0xe8)](_0x247680){const _0x106681=a138_0x56249b;this['spawnMpgPlayer'](),_0x247680['pipe'](this[_0x106681(0xec)][_0x106681(0xbe)]),this[_0x106681(0xec)][_0x106681(0xa3)]['on']('error',_0x57b9b0=>{const _0xadc351=_0x106681;_0x57b9b0[_0xadc351(0xdf)]==_0xadc351(0xbc)&&process[_0xadc351(0xb3)](0x0);}),this[_0x106681(0xec)][_0x106681(0xbe)]['on'](_0x106681(0xbb),_0x4c6bce=>{const _0x5ca63d=_0x106681;this['logger'][_0x5ca63d(0xa6)](_0x4c6bce);}),this['childProcess'][_0x106681(0xa3)]['on'](_0x106681(0xcb),_0x450d14=>{const _0x12c90b=_0x106681;this[_0x12c90b(0xe7)][_0x12c90b(0xa6)](_0x12c90b(0xea)+_0x450d14);}),this[_0x106681(0xec)][_0x106681(0xc6)]['on'](_0x106681(0xcb),_0x431870=>{const _0x3a9e17=_0x106681;this[_0x3a9e17(0xe7)][_0x3a9e17(0xa6)](_0x3a9e17(0xb1)+_0x431870);}),this['childProcess']['on'](_0x106681(0xb3),_0x308baa=>{const _0x4e3ae3=_0x106681;this[_0x4e3ae3(0xe7)][_0x4e3ae3(0xa6)](_0x4e3ae3(0xb3)),this[_0x4e3ae3(0xec)]['kill'](),this['childProcess']=null,_0x308baa!==0x0&&this[_0x4e3ae3(0xe7)][_0x4e3ae3(0xa6)](_0x4e3ae3(0xc8)+_0x308baa);});return;}[a138_0x56249b(0xe1)](_0x473039){const _0x2bd1f2=a138_0x56249b,_0x4a513d=new Promise((_0x95dc9,_0x1a79ef)=>{const _0x4adb32=a138_0x5d20;this['spawnMpgPlayer'](),_0x473039[_0x4adb32(0xdd)](this[_0x4adb32(0xec)][_0x4adb32(0xbe)]),this[_0x4adb32(0xec)][_0x4adb32(0xa3)]['on'](_0x4adb32(0xbb),_0x1ecbcb=>{const _0x147085=_0x4adb32;_0x1ecbcb[_0x147085(0xdf)]==_0x147085(0xbc)&&process[_0x147085(0xb3)](0x0);}),this['childProcess'][_0x4adb32(0xbe)]['on'](_0x4adb32(0xbb),_0x801e7=>{const _0x168046=_0x4adb32;this[_0x168046(0xe7)]['log'](_0x801e7);}),this[_0x4adb32(0xec)][_0x4adb32(0xa3)]['on'](_0x4adb32(0xcb),_0x3d4bf3=>{const _0x3d7003=_0x4adb32;this['logger'][_0x3d7003(0xa6)](_0x3d7003(0xea)+_0x3d4bf3);}),this[_0x4adb32(0xec)]['stderr']['on'](_0x4adb32(0xcb),_0x4efc14=>{const _0x56c32e=_0x4adb32;this[_0x56c32e(0xe7)]['log']('stderr\x20data:\x20'+_0x4efc14);}),this[_0x4adb32(0xec)]['on']('exit',_0x2c83af=>{const _0x5a7ed2=_0x4adb32;_0x95dc9(!![]),this[_0x5a7ed2(0xe7)][_0x5a7ed2(0xa6)]('exit'),this[_0x5a7ed2(0xec)][_0x5a7ed2(0xac)](),this['childProcess']=null,_0x2c83af!==0x0&&this[_0x5a7ed2(0xe7)][_0x5a7ed2(0xa6)](_0x5a7ed2(0xc8)+_0x2c83af);});});return{'process':this[_0x2bd1f2(0xec)],'promise':_0x4a513d};}[a138_0x56249b(0xa0)](_0x10834f){const _0x43f4ef=a138_0x56249b;return(0x0,fs_1[_0x43f4ef(0xd8)])(_0x10834f);}async[a138_0x56249b(0xaa)](){const _0x1dabb0=a138_0x56249b;this[_0x1dabb0(0xec)]['kill']();}async['openServerUIStream'](){const _0x2dc96d=a138_0x56249b;try{const _0x423c3f=process['env'][_0x2dc96d(0xaf)]+_0x2dc96d(0xca);!this[_0x2dc96d(0xe3)]&&(this[_0x2dc96d(0xe3)]=await(0x0,puppeteer_1['launchBrowser'])());const _0x64cfa1=await(0x0,puppeteer_1[_0x2dc96d(0xa5)])(this['browser']);if(_0x64cfa1[_0x2dc96d(0xcd)](_0x423c3f)){console[_0x2dc96d(0xa6)](_0x2dc96d(0xe4)),this['streamingGateway'][_0x2dc96d(0xe9)]();return;}const _0x5a6591=this[_0x2dc96d(0xc1)]||await(0x0,puppeteer_1[_0x2dc96d(0xed)])(this[_0x2dc96d(0xe3)]),_0xf85557=await this[_0x2dc96d(0xab)][_0x2dc96d(0xee)]();await _0x5a6591[_0x2dc96d(0xd7)]({'name':_0x2dc96d(0xb4),'url':process[_0x2dc96d(0xa1)][_0x2dc96d(0xaf)],'value':_0xf85557}),await _0x5a6591[_0x2dc96d(0xa4)](_0x423c3f),await _0x5a6591[_0x2dc96d(0xc4)](_0x2dc96d(0xb7));}catch(_0x575a0a){console[_0x2dc96d(0xa6)](_0x575a0a,_0x2dc96d(0xc5));}}async[a138_0x56249b(0xb8)](){const _0x26a984=a138_0x56249b;try{this['page']&&(await this[_0x26a984(0xc1)][_0x26a984(0xe2)](),this['page']=null);}catch(_0x2b8236){console['log'](_0x2b8236,_0x26a984(0xd1));}}};__decorate([(0x0,common_1[a138_0x56249b(0xad)])(streaming_gateway_1[a138_0x56249b(0xb6)]),__metadata('design:type',streaming_gateway_1['StreamingGateway'])],StreamingService[a138_0x56249b(0xc2)],a138_0x56249b(0xc7),void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a138_0x56249b(0xa2)])(),__metadata('design:paramtypes',[user_service_1[a138_0x56249b(0xce)],jwt_1[a138_0x56249b(0xc3)]])],StreamingService),exports[a138_0x56249b(0xc0)]=StreamingService;