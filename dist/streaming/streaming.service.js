'use strict';const a138_0x10573d=a138_0x36b0;(function(_0x4dc1a6,_0x29fb33){const _0x47d5d3=a138_0x36b0,_0x1e9cf7=_0x4dc1a6();while(!![]){try{const _0x502553=-parseInt(_0x47d5d3(0xbe))/0x1*(parseInt(_0x47d5d3(0xbf))/0x2)+-parseInt(_0x47d5d3(0xd2))/0x3*(-parseInt(_0x47d5d3(0xc9))/0x4)+-parseInt(_0x47d5d3(0xed))/0x5*(parseInt(_0x47d5d3(0xd3))/0x6)+-parseInt(_0x47d5d3(0xee))/0x7*(-parseInt(_0x47d5d3(0xd9))/0x8)+parseInt(_0x47d5d3(0xc1))/0x9+-parseInt(_0x47d5d3(0xbc))/0xa*(-parseInt(_0x47d5d3(0xdd))/0xb)+parseInt(_0x47d5d3(0xdc))/0xc*(parseInt(_0x47d5d3(0xf6))/0xd);if(_0x502553===_0x29fb33)break;else _0x1e9cf7['push'](_0x1e9cf7['shift']());}catch(_0x381325){_0x1e9cf7['push'](_0x1e9cf7['shift']());}}}(a138_0x1f8f,0x7590f));function a138_0x36b0(_0x271e17,_0xa7f88a){const _0x1f8f1d=a138_0x1f8f();return a138_0x36b0=function(_0x36b06e,_0x464e9c){_0x36b06e=_0x36b06e-0xbc;let _0x1b07c9=_0x1f8f1d[_0x36b06e];return _0x1b07c9;},a138_0x36b0(_0x271e17,_0xa7f88a);}var __decorate=this&&this['__decorate']||function(_0x3c89bf,_0x379c3e,_0x5c06bf,_0xf9f002){const _0x255836=a138_0x36b0;var _0x3903cc=arguments[_0x255836(0xf2)],_0x322dab=_0x3903cc<0x3?_0x379c3e:_0xf9f002===null?_0xf9f002=Object['getOwnPropertyDescriptor'](_0x379c3e,_0x5c06bf):_0xf9f002,_0x462e2c;if(typeof Reflect==='object'&&typeof Reflect[_0x255836(0xf1)]===_0x255836(0xe8))_0x322dab=Reflect[_0x255836(0xf1)](_0x3c89bf,_0x379c3e,_0x5c06bf,_0xf9f002);else{for(var _0x1c6d7a=_0x3c89bf[_0x255836(0xf2)]-0x1;_0x1c6d7a>=0x0;_0x1c6d7a--)if(_0x462e2c=_0x3c89bf[_0x1c6d7a])_0x322dab=(_0x3903cc<0x3?_0x462e2c(_0x322dab):_0x3903cc>0x3?_0x462e2c(_0x379c3e,_0x5c06bf,_0x322dab):_0x462e2c(_0x379c3e,_0x5c06bf))||_0x322dab;}return _0x3903cc>0x3&&_0x322dab&&Object['defineProperty'](_0x379c3e,_0x5c06bf,_0x322dab),_0x322dab;},__metadata=this&&this[a138_0x10573d(0xfe)]||function(_0x2c028e,_0x4bb0eb){const _0x13a4df=a138_0x10573d;if(typeof Reflect==='object'&&typeof Reflect[_0x13a4df(0xcd)]===_0x13a4df(0xe8))return Reflect[_0x13a4df(0xcd)](_0x2c028e,_0x4bb0eb);},StreamingService_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a138_0x10573d(0xcb)]=void 0x0;const common_1=require(a138_0x10573d(0xe1)),child_process_1=require('child_process'),fs_1=require('fs'),puppeteer_1=require(a138_0x10573d(0xe4)),streaming_gateway_1=require(a138_0x10573d(0xd7)),user_service_1=require('../user/user.service'),jwt_1=require(a138_0x10573d(0xe9));function a138_0x1f8f(){const _0x47f904=['6618uWUUiZ','error','body','Inject','./streaming.gateway','stderr\x20data:\x20','50248IymNCq','stdout','Injectable','3764388PiSKiC','319RJzLEn','spawnMpgPlayer','design:paramtypes','openServerUIStream','@nestjs/common','childProcess','createReadStream','../helpers/puppeteer','stderr','exit','UserService','function','@nestjs/jwt','setCookie','getMasterUserAccessToken','name','2590XbTuyi','875ztEzuh','stdout\x20data:\x20','kill','decorate','length','jwtService','userService','code','13pGafXe','env','stdin','openNewpage','EPIPE','streamingGateway','design:type','data','__metadata','Logger','pipe','spawn','launchBrowser','createStreamFromFile','goto','16290MKHgVs','logger','1qCQocj','281768LvAGuq','grep\x20process\x20exited\x20with\x20code\x20','105165tnsOVV','close','StreamingGateway','browser','prototype','log','Error\x20when\x20open\x20page','focus','3516AJLipo','closeServerUIStream','StreamingService','Server\x20stream\x20browser\x20already\x20open','metadata','stopStreamAudio','playStreamAudioAsync','page','STREAM_SERVER_URL','123omsEKs'];a138_0x1f8f=function(){return _0x47f904;};return a138_0x1f8f();}let StreamingService=StreamingService_1=class StreamingService{constructor(_0x424746,_0x222d5b){const _0x250c1e=a138_0x10573d;this[_0x250c1e(0xf4)]=_0x424746,this[_0x250c1e(0xf3)]=_0x222d5b,this['logger']=new common_1[(_0x250c1e(0xff))](StreamingService_1[_0x250c1e(0xec)]);}[a138_0x10573d(0xde)](){const _0xe53082=a138_0x10573d;if(!this[_0xe53082(0xe2)])this[_0xe53082(0xe2)]=(0x0,child_process_1[_0xe53082(0x101)])('mpg123',['-']);}async['playStreamAudio'](_0x4bb99f){const _0x56fd65=a138_0x10573d;this['spawnMpgPlayer'](),_0x4bb99f[_0x56fd65(0x100)](this['childProcess'][_0x56fd65(0xf8)]),this[_0x56fd65(0xe2)][_0x56fd65(0xda)]['on'](_0x56fd65(0xd4),_0x437a8a=>{const _0x2a1df8=_0x56fd65;_0x437a8a[_0x2a1df8(0xf5)]==_0x2a1df8(0xfa)&&process[_0x2a1df8(0xe6)](0x0);}),this['childProcess']['stdin']['on']('error',_0x2944e5=>{const _0x2794f4=_0x56fd65;this[_0x2794f4(0xbd)]['log'](_0x2944e5);}),this[_0x56fd65(0xe2)]['stdout']['on'](_0x56fd65(0xfd),_0x45cb30=>{const _0x3118e8=_0x56fd65;this['logger'][_0x3118e8(0xc6)](_0x3118e8(0xef)+_0x45cb30);}),this[_0x56fd65(0xe2)][_0x56fd65(0xe5)]['on'](_0x56fd65(0xfd),_0x337f39=>{const _0x4d618c=_0x56fd65;this[_0x4d618c(0xbd)][_0x4d618c(0xc6)](_0x4d618c(0xd8)+_0x337f39);}),this[_0x56fd65(0xe2)]['on'](_0x56fd65(0xe6),_0x58bd19=>{const _0x52e548=_0x56fd65;this[_0x52e548(0xbd)][_0x52e548(0xc6)](_0x52e548(0xe6)),this[_0x52e548(0xe2)]['kill'](),this['childProcess']=null,_0x58bd19!==0x0&&this[_0x52e548(0xbd)]['log'](_0x52e548(0xc0)+_0x58bd19);});return;}[a138_0x10573d(0xcf)](_0xc11fc9){const _0x4fc39d=a138_0x10573d,_0x1b38c0=new Promise((_0xf01659,_0x95ec46)=>{const _0x26babd=a138_0x36b0;this[_0x26babd(0xde)](),_0xc11fc9[_0x26babd(0x100)](this[_0x26babd(0xe2)][_0x26babd(0xf8)]),this[_0x26babd(0xe2)]['stdout']['on']('error',_0x3f9140=>{const _0x3f6896=_0x26babd;_0x3f9140[_0x3f6896(0xf5)]=='EPIPE'&&process[_0x3f6896(0xe6)](0x0);}),this[_0x26babd(0xe2)][_0x26babd(0xf8)]['on'](_0x26babd(0xd4),_0x2a9999=>{const _0x3462eb=_0x26babd;this['logger'][_0x3462eb(0xc6)](_0x2a9999);}),this[_0x26babd(0xe2)][_0x26babd(0xda)]['on'](_0x26babd(0xfd),_0x5e2c22=>{const _0x337886=_0x26babd;this[_0x337886(0xbd)][_0x337886(0xc6)](_0x337886(0xef)+_0x5e2c22);}),this['childProcess'][_0x26babd(0xe5)]['on'](_0x26babd(0xfd),_0x59c7b2=>{const _0x295c00=_0x26babd;this[_0x295c00(0xbd)][_0x295c00(0xc6)](_0x295c00(0xd8)+_0x59c7b2);}),this[_0x26babd(0xe2)]['on']('exit',_0xd8f30d=>{const _0x1e955e=_0x26babd;_0xf01659(!![]),this[_0x1e955e(0xbd)][_0x1e955e(0xc6)](_0x1e955e(0xe6)),this[_0x1e955e(0xe2)][_0x1e955e(0xf0)](),this['childProcess']=null,_0xd8f30d!==0x0&&this[_0x1e955e(0xbd)]['log']('grep\x20process\x20exited\x20with\x20code\x20'+_0xd8f30d);});});return{'process':this[_0x4fc39d(0xe2)],'promise':_0x1b38c0};}[a138_0x10573d(0x103)](_0x3ae9b6){const _0x533f5b=a138_0x10573d;return(0x0,fs_1[_0x533f5b(0xe3)])(_0x3ae9b6);}async[a138_0x10573d(0xce)](){const _0x2ace14=a138_0x10573d;this[_0x2ace14(0xe2)][_0x2ace14(0xf0)]();}async[a138_0x10573d(0xe0)](){const _0x50b7ad=a138_0x10573d;try{const _0x444e82=process[_0x50b7ad(0xf7)]['STREAM_SERVER_URL']+'/stream';!this[_0x50b7ad(0xc4)]&&(this['browser']=await(0x0,puppeteer_1[_0x50b7ad(0x102)])());const _0x45459b=await(0x0,puppeteer_1['getBrowserUrls'])(this[_0x50b7ad(0xc4)]);if(_0x45459b['includes'](_0x444e82)){console['log'](_0x50b7ad(0xcc)),this[_0x50b7ad(0xfb)]['reconnectPeer']();return;}const _0x5ed8fc=this[_0x50b7ad(0xd0)]||await(0x0,puppeteer_1[_0x50b7ad(0xf9)])(this[_0x50b7ad(0xc4)]),_0x509ddb=await this['userService'][_0x50b7ad(0xeb)]();await _0x5ed8fc[_0x50b7ad(0xea)]({'name':'accessToken','url':process[_0x50b7ad(0xf7)][_0x50b7ad(0xd1)],'value':_0x509ddb}),await _0x5ed8fc[_0x50b7ad(0x104)](_0x444e82),await _0x5ed8fc[_0x50b7ad(0xc8)](_0x50b7ad(0xd5));}catch(_0x31a665){console['log'](_0x31a665,_0x50b7ad(0xc7));}}async[a138_0x10573d(0xca)](){const _0x5766df=a138_0x10573d;try{this[_0x5766df(0xd0)]&&(await this['page'][_0x5766df(0xc2)](),this[_0x5766df(0xd0)]=null);}catch(_0x24769e){console[_0x5766df(0xc6)](_0x24769e,'Error\x20when\x20close\x20page');}}};__decorate([(0x0,common_1[a138_0x10573d(0xd6)])(streaming_gateway_1[a138_0x10573d(0xc3)]),__metadata(a138_0x10573d(0xfc),streaming_gateway_1[a138_0x10573d(0xc3)])],StreamingService[a138_0x10573d(0xc5)],a138_0x10573d(0xfb),void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a138_0x10573d(0xdb)])(),__metadata(a138_0x10573d(0xdf),[user_service_1[a138_0x10573d(0xe7)],jwt_1['JwtService']])],StreamingService),exports[a138_0x10573d(0xcb)]=StreamingService;