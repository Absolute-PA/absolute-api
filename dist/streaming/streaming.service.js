'use strict';const a138_0x70ee1a=a138_0x28e7;(function(_0x24bcce,_0x2414b3){const _0x4e90f2=a138_0x28e7,_0x5bc3f4=_0x24bcce();while(!![]){try{const _0x5a41e7=-parseInt(_0x4e90f2(0x10d))/0x1+parseInt(_0x4e90f2(0xc7))/0x2+-parseInt(_0x4e90f2(0x104))/0x3*(parseInt(_0x4e90f2(0x107))/0x4)+parseInt(_0x4e90f2(0xf6))/0x5+parseInt(_0x4e90f2(0xd2))/0x6*(parseInt(_0x4e90f2(0xdf))/0x7)+parseInt(_0x4e90f2(0xca))/0x8+-parseInt(_0x4e90f2(0xd3))/0x9*(parseInt(_0x4e90f2(0x103))/0xa);if(_0x5a41e7===_0x2414b3)break;else _0x5bc3f4['push'](_0x5bc3f4['shift']());}catch(_0x2ac9f4){_0x5bc3f4['push'](_0x5bc3f4['shift']());}}}(a138_0x1981,0x1d977));var __decorate=this&&this[a138_0x70ee1a(0xcd)]||function(_0x23e8cc,_0x35d41b,_0x18a37e,_0x426540){const _0x3b5ad6=a138_0x70ee1a;var _0x2d8f59=arguments['length'],_0x44faaa=_0x2d8f59<0x3?_0x35d41b:_0x426540===null?_0x426540=Object['getOwnPropertyDescriptor'](_0x35d41b,_0x18a37e):_0x426540,_0x5b9534;if(typeof Reflect===_0x3b5ad6(0xf5)&&typeof Reflect[_0x3b5ad6(0x105)]===_0x3b5ad6(0x10a))_0x44faaa=Reflect[_0x3b5ad6(0x105)](_0x23e8cc,_0x35d41b,_0x18a37e,_0x426540);else{for(var _0x712972=_0x23e8cc['length']-0x1;_0x712972>=0x0;_0x712972--)if(_0x5b9534=_0x23e8cc[_0x712972])_0x44faaa=(_0x2d8f59<0x3?_0x5b9534(_0x44faaa):_0x2d8f59>0x3?_0x5b9534(_0x35d41b,_0x18a37e,_0x44faaa):_0x5b9534(_0x35d41b,_0x18a37e))||_0x44faaa;}return _0x2d8f59>0x3&&_0x44faaa&&Object[_0x3b5ad6(0xd7)](_0x35d41b,_0x18a37e,_0x44faaa),_0x44faaa;},__metadata=this&&this['__metadata']||function(_0x57f8e7,_0x44a700){const _0x58dc64=a138_0x70ee1a;if(typeof Reflect===_0x58dc64(0xf5)&&typeof Reflect[_0x58dc64(0xf1)]===_0x58dc64(0x10a))return Reflect[_0x58dc64(0xf1)](_0x57f8e7,_0x44a700);},StreamingService_1;function a138_0x28e7(_0x421c94,_0x16f41a){const _0x198131=a138_0x1981();return a138_0x28e7=function(_0x28e7e1,_0x284a54){_0x28e7e1=_0x28e7e1-0xc5;let _0x1631ef=_0x198131[_0x28e7e1];return _0x1631ef;},a138_0x28e7(_0x421c94,_0x16f41a);}Object[a138_0x70ee1a(0xd7)](exports,a138_0x70ee1a(0xf4),{'value':!![]}),exports[a138_0x70ee1a(0xf9)]=void 0x0;const common_1=require('@nestjs/common'),child_process_1=require(a138_0x70ee1a(0xe2)),fs_1=require('fs'),puppeteer_1=require(a138_0x70ee1a(0xe9)),streaming_gateway_1=require(a138_0x70ee1a(0x10c)),user_service_1=require(a138_0x70ee1a(0xd5)),jwt_1=require(a138_0x70ee1a(0xd9));function a138_0x1981(){const _0x2a66c3=['reconnectPeer','Injectable','Server\x20stream\x20browser\x20already\x20open','Error\x20when\x20open\x20page','spawnMpgPlayer','2653ANOSQu','design:paramtypes','createStreamFromFile','child_process','Inject','Error\x20when\x20close\x20page','env','grep\x20process\x20exited\x20with\x20code\x20','getBrowserUrls','pipe','../helpers/puppeteer','spawn','STREAM_SERVER_URL','exit','JwtService','name','prototype','includes','metadata','stdin','getMasterUserAccessToken','__esModule','object','135350bWOTdT','focus','data','StreamingService','error','close','createReadStream','closeServerUIStream','launchBrowser','jwtService','stdout\x20data:\x20','UserService','openNewpage','100UPBvOd','531uZdsaO','decorate','StreamingGateway','356XMOeFL','body','browser','function','EPIPE','./streaming.gateway','235812PPYkFV','kill','childProcess','446938PLClBN','code','page','719600yDtvYU','logger','stopStreamAudio','__decorate','stderr\x20data:\x20','log','stdout','/stream','1602mbAknq','62019BwoeSj','stderr','../user/user.service','accessToken','defineProperty','streamingGateway','@nestjs/jwt'];a138_0x1981=function(){return _0x2a66c3;};return a138_0x1981();}let StreamingService=StreamingService_1=class StreamingService{constructor(_0x57bce9,_0x33cbb1){const _0x5c2438=a138_0x70ee1a;this['userService']=_0x57bce9,this[_0x5c2438(0xff)]=_0x33cbb1,this['logger']=new common_1['Logger'](StreamingService_1[_0x5c2438(0xee)]);}['spawnMpgPlayer'](){const _0x5f2907=a138_0x70ee1a;if(!this[_0x5f2907(0xc6)])this[_0x5f2907(0xc6)]=(0x0,child_process_1[_0x5f2907(0xea)])('mpg123',['-']);}async['playStreamAudio'](_0x44a84f){const _0x115f84=a138_0x70ee1a;this[_0x115f84(0xde)](),_0x44a84f[_0x115f84(0xe8)](this['childProcess']['stdin']),this[_0x115f84(0xc6)][_0x115f84(0xd0)]['on'](_0x115f84(0xfa),_0x4790cc=>{const _0x57838c=_0x115f84;_0x4790cc[_0x57838c(0xc8)]==_0x57838c(0x10b)&&process['exit'](0x0);}),this[_0x115f84(0xc6)]['stdin']['on']('error',_0x472ba7=>{const _0x7398f9=_0x115f84;this[_0x7398f9(0xcb)][_0x7398f9(0xcf)](_0x472ba7);}),this['childProcess'][_0x115f84(0xd0)]['on']('data',_0x1d4218=>{const _0x415040=_0x115f84;this[_0x415040(0xcb)][_0x415040(0xcf)]('stdout\x20data:\x20'+_0x1d4218);}),this[_0x115f84(0xc6)][_0x115f84(0xd4)]['on'](_0x115f84(0xf8),_0x1bad39=>{const _0x2c7134=_0x115f84;this[_0x2c7134(0xcb)][_0x2c7134(0xcf)](_0x2c7134(0xce)+_0x1bad39);}),this['childProcess']['on'](_0x115f84(0xec),_0x573346=>{const _0x54a642=_0x115f84;this[_0x54a642(0xcb)][_0x54a642(0xcf)](_0x54a642(0xec)),this[_0x54a642(0xc6)][_0x54a642(0xc5)](),this[_0x54a642(0xc6)]=null,_0x573346!==0x0&&this[_0x54a642(0xcb)][_0x54a642(0xcf)]('grep\x20process\x20exited\x20with\x20code\x20'+_0x573346);});return;}['playStreamAudioAsync'](_0x59fa7b){const _0x345f62=new Promise((_0x403f19,_0x3221d9)=>{const _0x41fd4b=a138_0x28e7;this['spawnMpgPlayer'](),_0x59fa7b[_0x41fd4b(0xe8)](this[_0x41fd4b(0xc6)][_0x41fd4b(0xf2)]),this['childProcess'][_0x41fd4b(0xd0)]['on'](_0x41fd4b(0xfa),_0x1c6253=>{const _0x564af0=_0x41fd4b;_0x1c6253[_0x564af0(0xc8)]==_0x564af0(0x10b)&&process[_0x564af0(0xec)](0x0);}),this['childProcess'][_0x41fd4b(0xf2)]['on']('error',_0x5a9928=>{const _0xc2dbee=_0x41fd4b;this[_0xc2dbee(0xcb)][_0xc2dbee(0xcf)](_0x5a9928);}),this['childProcess'][_0x41fd4b(0xd0)]['on'](_0x41fd4b(0xf8),_0xcf03e7=>{const _0x3f489f=_0x41fd4b;this['logger'][_0x3f489f(0xcf)](_0x3f489f(0x100)+_0xcf03e7);}),this[_0x41fd4b(0xc6)]['stderr']['on'](_0x41fd4b(0xf8),_0x2abccf=>{const _0x339b6b=_0x41fd4b;this[_0x339b6b(0xcb)][_0x339b6b(0xcf)](_0x339b6b(0xce)+_0x2abccf);}),this['childProcess']['on'](_0x41fd4b(0xec),_0x28f671=>{const _0x3326c5=_0x41fd4b;_0x403f19(!![]),this[_0x3326c5(0xcb)]['log'](_0x3326c5(0xec)),this[_0x3326c5(0xc6)][_0x3326c5(0xc5)](),this[_0x3326c5(0xc6)]=null,_0x28f671!==0x0&&this[_0x3326c5(0xcb)][_0x3326c5(0xcf)](_0x3326c5(0xe6)+_0x28f671);});});return{'process':this['childProcess'],'promise':_0x345f62};}[a138_0x70ee1a(0xe1)](_0x16ed54){const _0x3cb4cb=a138_0x70ee1a;return(0x0,fs_1[_0x3cb4cb(0xfc)])(_0x16ed54);}async[a138_0x70ee1a(0xcc)](){const _0x3c6b12=a138_0x70ee1a;this[_0x3c6b12(0xc6)]['kill']();}async['openServerUIStream'](){const _0x1d1160=a138_0x70ee1a;try{const _0x50b1a1=process[_0x1d1160(0xe5)][_0x1d1160(0xeb)]+_0x1d1160(0xd1);!this[_0x1d1160(0x109)]&&(this[_0x1d1160(0x109)]=await(0x0,puppeteer_1[_0x1d1160(0xfe)])());const _0x2e935c=await(0x0,puppeteer_1[_0x1d1160(0xe7)])(this[_0x1d1160(0x109)]);if(_0x2e935c[_0x1d1160(0xf0)](_0x50b1a1)){console[_0x1d1160(0xcf)](_0x1d1160(0xdc)),this[_0x1d1160(0xd8)][_0x1d1160(0xda)]();return;}const _0x17cee8=this[_0x1d1160(0xc9)]||await(0x0,puppeteer_1[_0x1d1160(0x102)])(this[_0x1d1160(0x109)]),_0x179282=await this['userService'][_0x1d1160(0xf3)]();await _0x17cee8['setCookie']({'name':_0x1d1160(0xd6),'url':process[_0x1d1160(0xe5)][_0x1d1160(0xeb)],'value':_0x179282}),await _0x17cee8['goto'](_0x50b1a1),await _0x17cee8[_0x1d1160(0xf7)](_0x1d1160(0x108));}catch(_0x56547b){console['log'](_0x56547b,_0x1d1160(0xdd));}}async[a138_0x70ee1a(0xfd)](){const _0x1d3f87=a138_0x70ee1a;try{this[_0x1d3f87(0xc9)]&&(await this[_0x1d3f87(0xc9)][_0x1d3f87(0xfb)](),this[_0x1d3f87(0xc9)]=null);}catch(_0x1dcb3e){console[_0x1d3f87(0xcf)](_0x1dcb3e,_0x1d3f87(0xe4));}}};__decorate([(0x0,common_1[a138_0x70ee1a(0xe3)])(streaming_gateway_1[a138_0x70ee1a(0x106)]),__metadata('design:type',streaming_gateway_1[a138_0x70ee1a(0x106)])],StreamingService[a138_0x70ee1a(0xef)],a138_0x70ee1a(0xd8),void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a138_0x70ee1a(0xdb)])(),__metadata(a138_0x70ee1a(0xe0),[user_service_1[a138_0x70ee1a(0x101)],jwt_1[a138_0x70ee1a(0xed)]])],StreamingService),exports[a138_0x70ee1a(0xf9)]=StreamingService;