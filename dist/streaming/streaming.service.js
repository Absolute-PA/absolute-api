'use strict';const a141_0x322b03=a141_0x1581;(function(_0x3af67a,_0x4afb94){const _0x16f2aa=a141_0x1581,_0x5efa18=_0x3af67a();while(!![]){try{const _0x23fb96=parseInt(_0x16f2aa(0x10d))/0x1+-parseInt(_0x16f2aa(0x123))/0x2*(parseInt(_0x16f2aa(0x107))/0x3)+-parseInt(_0x16f2aa(0x12e))/0x4*(parseInt(_0x16f2aa(0x137))/0x5)+parseInt(_0x16f2aa(0x11c))/0x6*(-parseInt(_0x16f2aa(0x114))/0x7)+-parseInt(_0x16f2aa(0x109))/0x8*(parseInt(_0x16f2aa(0x13f))/0x9)+parseInt(_0x16f2aa(0x12f))/0xa*(-parseInt(_0x16f2aa(0x106))/0xb)+parseInt(_0x16f2aa(0x127))/0xc;if(_0x23fb96===_0x4afb94)break;else _0x5efa18['push'](_0x5efa18['shift']());}catch(_0x291d62){_0x5efa18['push'](_0x5efa18['shift']());}}}(a141_0x42d7,0xe801e));var __decorate=this&&this[a141_0x322b03(0x130)]||function(_0x47acd1,_0x38b50e,_0x1f20f4,_0x10383d){const _0x3ecf5d=a141_0x322b03;var _0x33dfdc=arguments[_0x3ecf5d(0x104)],_0x2e0fba=_0x33dfdc<0x3?_0x38b50e:_0x10383d===null?_0x10383d=Object[_0x3ecf5d(0x147)](_0x38b50e,_0x1f20f4):_0x10383d,_0x33135a;if(typeof Reflect===_0x3ecf5d(0x143)&&typeof Reflect[_0x3ecf5d(0x110)]===_0x3ecf5d(0x11b))_0x2e0fba=Reflect['decorate'](_0x47acd1,_0x38b50e,_0x1f20f4,_0x10383d);else{for(var _0x100a75=_0x47acd1[_0x3ecf5d(0x104)]-0x1;_0x100a75>=0x0;_0x100a75--)if(_0x33135a=_0x47acd1[_0x100a75])_0x2e0fba=(_0x33dfdc<0x3?_0x33135a(_0x2e0fba):_0x33dfdc>0x3?_0x33135a(_0x38b50e,_0x1f20f4,_0x2e0fba):_0x33135a(_0x38b50e,_0x1f20f4))||_0x2e0fba;}return _0x33dfdc>0x3&&_0x2e0fba&&Object['defineProperty'](_0x38b50e,_0x1f20f4,_0x2e0fba),_0x2e0fba;},__metadata=this&&this['__metadata']||function(_0x443f02,_0x1f19e2){const _0x2750df=a141_0x322b03;if(typeof Reflect===_0x2750df(0x143)&&typeof Reflect[_0x2750df(0x12a)]===_0x2750df(0x11b))return Reflect[_0x2750df(0x12a)](_0x443f02,_0x1f19e2);},StreamingService_1;Object[a141_0x322b03(0x148)](exports,a141_0x322b03(0x11f),{'value':!![]}),exports[a141_0x322b03(0x12d)]=void 0x0;const common_1=require(a141_0x322b03(0x141)),child_process_1=require(a141_0x322b03(0x115)),fs_1=require('fs'),puppeteer_1=require(a141_0x322b03(0x142)),streaming_gateway_1=require(a141_0x322b03(0x112)),user_service_1=require(a141_0x322b03(0x134)),jwt_1=require(a141_0x322b03(0x131));let StreamingService=StreamingService_1=class StreamingService{constructor(_0x4c824a,_0x4ad21f){const _0x55f289=a141_0x322b03;this['userService']=_0x4c824a,this['jwtService']=_0x4ad21f,this[_0x55f289(0x10c)]=new common_1[(_0x55f289(0x105))](StreamingService_1[_0x55f289(0x11d)]);}[a141_0x322b03(0x118)](){const _0x4247fa=a141_0x322b03;if(!this[_0x4247fa(0x128)])this[_0x4247fa(0x128)]=(0x0,child_process_1['spawn'])(_0x4247fa(0x122),['-']);}async[a141_0x322b03(0x103)](_0x44a281){const _0x1705ad=a141_0x322b03;this['spawnMpgPlayer'](),_0x44a281[_0x1705ad(0x12b)](this['childProcess']['stdin']),this[_0x1705ad(0x128)][_0x1705ad(0x138)]['on'](_0x1705ad(0x13a),_0x5dcff4=>{const _0x20e39f=_0x1705ad;_0x5dcff4['code']==_0x20e39f(0x11a)&&process['exit'](0x0);}),this['childProcess'][_0x1705ad(0x117)]['on']('error',_0x31d9d7=>{const _0xb9ebc2=_0x1705ad;this[_0xb9ebc2(0x10c)][_0xb9ebc2(0x135)](_0x31d9d7);}),this['childProcess'][_0x1705ad(0x138)]['on'](_0x1705ad(0x116),_0x22854b=>{const _0x1ea33e=_0x1705ad;this[_0x1ea33e(0x10c)][_0x1ea33e(0x135)]('stdout\x20data:\x20'+_0x22854b);}),this['childProcess'][_0x1705ad(0x13b)]['on'](_0x1705ad(0x116),_0x17197f=>{const _0x395117=_0x1705ad;this[_0x395117(0x10c)][_0x395117(0x135)]('stderr\x20data:\x20'+_0x17197f);}),this[_0x1705ad(0x128)]['on'](_0x1705ad(0x149),_0x1aeed2=>{const _0x51b847=_0x1705ad;this['logger'][_0x51b847(0x135)]('exit'),this[_0x51b847(0x128)][_0x51b847(0x10a)](),this[_0x51b847(0x128)]=null,_0x1aeed2!==0x0&&this[_0x51b847(0x10c)][_0x51b847(0x135)](_0x51b847(0x10b)+_0x1aeed2);});return;}['playStreamAudioAsync'](_0x49c5c8){const _0x1dd2d7=a141_0x322b03,_0x56d932=new Promise((_0x36495b,_0x21d2e7)=>{const _0x4f9a6c=a141_0x1581;this[_0x4f9a6c(0x118)](),_0x49c5c8['pipe'](this['childProcess'][_0x4f9a6c(0x117)]),this[_0x4f9a6c(0x128)]['stdout']['on']('error',_0x4a6dbb=>{const _0x2e3670=_0x4f9a6c;_0x4a6dbb['code']==_0x2e3670(0x11a)&&process[_0x2e3670(0x149)](0x0);}),this['childProcess'][_0x4f9a6c(0x117)]['on'](_0x4f9a6c(0x13a),_0x362cb5=>{const _0x379581=_0x4f9a6c;this[_0x379581(0x10c)][_0x379581(0x135)](_0x362cb5);}),this[_0x4f9a6c(0x128)][_0x4f9a6c(0x138)]['on'](_0x4f9a6c(0x116),_0x29f031=>{const _0x4d066d=_0x4f9a6c;this[_0x4d066d(0x10c)]['log'](_0x4d066d(0x132)+_0x29f031);}),this['childProcess'][_0x4f9a6c(0x13b)]['on'](_0x4f9a6c(0x116),_0x46b5bd=>{const _0x47e279=_0x4f9a6c;this[_0x47e279(0x10c)][_0x47e279(0x135)](_0x47e279(0x145)+_0x46b5bd);}),this['childProcess']['on'](_0x4f9a6c(0x149),_0x499264=>{const _0x194ee4=_0x4f9a6c;_0x36495b(!![]),this[_0x194ee4(0x10c)][_0x194ee4(0x135)]('exit'),this['childProcess']['kill'](),this[_0x194ee4(0x128)]=null,_0x499264!==0x0&&this[_0x194ee4(0x10c)]['log']('grep\x20process\x20exited\x20with\x20code\x20'+_0x499264);});});return{'process':this[_0x1dd2d7(0x128)],'promise':_0x56d932};}[a141_0x322b03(0x121)](_0x4040eb){const _0x4c56e4=a141_0x322b03;return(0x0,fs_1[_0x4c56e4(0x144)])(_0x4040eb);}async[a141_0x322b03(0x113)](){const _0x1e63bc=a141_0x322b03;this['childProcess'][_0x1e63bc(0x10a)]();}async[a141_0x322b03(0x140)](){const _0x1a9094=a141_0x322b03;try{const _0x3b6885=process[_0x1a9094(0x10e)]['STREAM_SERVER_URL']+_0x1a9094(0x10f);!this[_0x1a9094(0x13e)]&&(this['browser']=await(0x0,puppeteer_1[_0x1a9094(0x111)])());const _0x1e7ca9=await(0x0,puppeteer_1['getBrowserUrls'])(this[_0x1a9094(0x13e)]);if(_0x1e7ca9[_0x1a9094(0x146)](_0x3b6885)){console[_0x1a9094(0x135)]('Server\x20stream\x20browser\x20already\x20open'),this[_0x1a9094(0x13d)]['reconnectPeer']();return;}const _0x2ae712=this[_0x1a9094(0x133)]||await(0x0,puppeteer_1['openNewpage'])(this[_0x1a9094(0x13e)]),_0x8ead27=await this['userService'][_0x1a9094(0x136)]();await _0x2ae712[_0x1a9094(0x102)]({'name':_0x1a9094(0x13c),'url':process[_0x1a9094(0x10e)][_0x1a9094(0x11e)],'value':_0x8ead27}),await _0x2ae712['goto'](_0x3b6885),await _0x2ae712['focus'](_0x1a9094(0x124));}catch(_0x23f871){console['log'](_0x23f871,_0x1a9094(0x120));}}async['closeServerUIStream'](){const _0xcdad25=a141_0x322b03;try{this[_0xcdad25(0x133)]&&(await this[_0xcdad25(0x133)][_0xcdad25(0x126)](),this[_0xcdad25(0x133)]=null);}catch(_0x58a66d){console['log'](_0x58a66d,_0xcdad25(0x14a));}}};function a141_0x1581(_0x1111c9,_0x574345){const _0x42d7f0=a141_0x42d7();return a141_0x1581=function(_0x158116,_0x275dfc){_0x158116=_0x158116-0x102;let _0x35e0a0=_0x42d7f0[_0x158116];return _0x35e0a0;},a141_0x1581(_0x1111c9,_0x574345);}function a141_0x42d7(){const _0x449124=['childProcess','design:type','metadata','pipe','JwtService','StreamingService','164AXmlmU','430yaoZEX','__decorate','@nestjs/jwt','stdout\x20data:\x20','page','../user/user.service','log','getMasterUserAccessToken','51265IDTrgj','stdout','Injectable','error','stderr','accessToken','streamingGateway','browser','76743lQQqXP','openServerUIStream','@nestjs/common','../helpers/puppeteer','object','createReadStream','stderr\x20data:\x20','includes','getOwnPropertyDescriptor','defineProperty','exit','Error\x20when\x20close\x20page','setCookie','playStreamAudio','length','Logger','76945nIvRpC','34533ziqJPX','StreamingGateway','288hSgdwG','kill','grep\x20process\x20exited\x20with\x20code\x20','logger','1164591oubCVa','env','/stream','decorate','launchBrowser','./streaming.gateway','stopStreamAudio','14ReDXqn','child_process','data','stdin','spawnMpgPlayer','Inject','EPIPE','function','4846872ktObck','name','STREAM_SERVER_URL','__esModule','Error\x20when\x20open\x20page','createStreamFromFile','mpg123','2dJwBIE','body','prototype','close','29291712zFVstk'];a141_0x42d7=function(){return _0x449124;};return a141_0x42d7();}__decorate([(0x0,common_1[a141_0x322b03(0x119)])(streaming_gateway_1['StreamingGateway']),__metadata(a141_0x322b03(0x129),streaming_gateway_1[a141_0x322b03(0x108)])],StreamingService[a141_0x322b03(0x125)],a141_0x322b03(0x13d),void 0x0),StreamingService=StreamingService_1=__decorate([(0x0,common_1[a141_0x322b03(0x139)])(),__metadata('design:paramtypes',[user_service_1['UserService'],jwt_1[a141_0x322b03(0x12c)]])],StreamingService),exports[a141_0x322b03(0x12d)]=StreamingService;