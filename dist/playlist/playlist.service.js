'use strict';const a87_0x19e1a1=a87_0x1900;(function(_0x686a71,_0x3efd11){const _0x188964=a87_0x1900,_0x38ba73=_0x686a71();while(!![]){try{const _0x294db3=-parseInt(_0x188964(0x1a3))/0x1+-parseInt(_0x188964(0x1b0))/0x2+-parseInt(_0x188964(0x178))/0x3*(parseInt(_0x188964(0x175))/0x4)+-parseInt(_0x188964(0x1b7))/0x5+parseInt(_0x188964(0x1b5))/0x6*(parseInt(_0x188964(0x19c))/0x7)+parseInt(_0x188964(0x1a9))/0x8*(-parseInt(_0x188964(0x164))/0x9)+-parseInt(_0x188964(0x195))/0xa*(-parseInt(_0x188964(0x16e))/0xb);if(_0x294db3===_0x3efd11)break;else _0x38ba73['push'](_0x38ba73['shift']());}catch(_0x314689){_0x38ba73['push'](_0x38ba73['shift']());}}}(a87_0x56f2,0xd064c));var __decorate=this&&this[a87_0x19e1a1(0x1ae)]||function(_0x4127cd,_0x3987c8,_0x1de0d7,_0x1a55ef){const _0x4d0284=a87_0x19e1a1;var _0x56e3e1=arguments[_0x4d0284(0x1aa)],_0x27e2f7=_0x56e3e1<0x3?_0x3987c8:_0x1a55ef===null?_0x1a55ef=Object[_0x4d0284(0x19a)](_0x3987c8,_0x1de0d7):_0x1a55ef,_0x24cbfa;if(typeof Reflect===_0x4d0284(0x170)&&typeof Reflect[_0x4d0284(0x194)]===_0x4d0284(0x199))_0x27e2f7=Reflect[_0x4d0284(0x194)](_0x4127cd,_0x3987c8,_0x1de0d7,_0x1a55ef);else{for(var _0xc2445c=_0x4127cd[_0x4d0284(0x1aa)]-0x1;_0xc2445c>=0x0;_0xc2445c--)if(_0x24cbfa=_0x4127cd[_0xc2445c])_0x27e2f7=(_0x56e3e1<0x3?_0x24cbfa(_0x27e2f7):_0x56e3e1>0x3?_0x24cbfa(_0x3987c8,_0x1de0d7,_0x27e2f7):_0x24cbfa(_0x3987c8,_0x1de0d7))||_0x27e2f7;}return _0x56e3e1>0x3&&_0x27e2f7&&Object[_0x4d0284(0x180)](_0x3987c8,_0x1de0d7,_0x27e2f7),_0x27e2f7;},__metadata=this&&this[a87_0x19e1a1(0x184)]||function(_0x58d545,_0x3c6424){const _0xc3c3bf=a87_0x19e1a1;if(typeof Reflect===_0xc3c3bf(0x170)&&typeof Reflect[_0xc3c3bf(0x1a7)]===_0xc3c3bf(0x199))return Reflect[_0xc3c3bf(0x1a7)](_0x58d545,_0x3c6424);},__param=this&&this[a87_0x19e1a1(0x1b4)]||function(_0x5c3315,_0x4c8952){return function(_0x2bafe1,_0x5ac13b){_0x4c8952(_0x2bafe1,_0x5ac13b,_0x5c3315);};},PlaylistService_1;Object[a87_0x19e1a1(0x180)](exports,'__esModule',{'value':!![]}),exports[a87_0x19e1a1(0x18f)]=void 0x0;const common_1=require(a87_0x19e1a1(0x162)),mongoose_1=require('mongoose'),mongoose_2=require(a87_0x19e1a1(0x16c)),event_emitter_1=require(a87_0x19e1a1(0x17c)),sound_service_1=require('../sound/sound.service'),job_1=require(a87_0x19e1a1(0x183)),events_1=require('../common/events'),agenda_service_1=require(a87_0x19e1a1(0x1ac)),playlist_mapper_1=require('./mapper/playlist.mapper'),enums_1=require(a87_0x19e1a1(0x1b6)),path=require(a87_0x19e1a1(0x198)),path_1=require(a87_0x19e1a1(0x192)),audio_player_1=require(a87_0x19e1a1(0x190)),sound_gateway_1=require(a87_0x19e1a1(0x1a5));function a87_0x1900(_0x1c6456,_0x495e2d){const _0x56f2e1=a87_0x56f2();return a87_0x1900=function(_0x1900e9,_0x2ed5f2){_0x1900e9=_0x1900e9-0x161;let _0x5b395d=_0x56f2e1[_0x1900e9];return _0x5b395d;},a87_0x1900(_0x1c6456,_0x495e2d);}function a87_0x56f2(){const _0xb84f5e=['PlaylistEvent','create','isShuffle','@nestjs/event-emitter','all','PROCESS_CACHE','Play\x20Music\x20Playlist:\x20','defineProperty','save','design:type','../common/job','__metadata','\x20-\x20','now','PlayMusic','Playing\x20playlist:\x20','processRootPath','prototype','broadcastPlaying','soundGateway','logger','killAll','PlaylistService','../common/audio/audio-player','_id','../common/path','mapToDto','decorate','10NVZNcy','soundIds','stop','path','function','getOwnPropertyDescriptor','map','3480085zbqOBl','AgendaService','fileName','JobType','addSong','OnEvent','Inject','900644ECXEct','SoundGateway','../sound/sound.gateway','findOne','metadata','filter','4338688iKbBpj','length','Playlist','../agenda/agenda.service','assets','__decorate','design:paramtypes','2644232zLxhcN','InjectModel','findById','findByIdAndDelete','__param','18kleZfS','../common/enums','4246735mhTDfX','join','Play','playlistModel','@nestjs/common','play','18aLNyDM','playFromEvent','find','Injectable','update','design:returntype','AudioPlayer','name','@nestjs/mongoose','log','49261278rFSkSR','findAll','object','push','assign','findByIds','soundService','16EhXKeJ','agendaService','playAsync','719553BsuzGv'];a87_0x56f2=function(){return _0xb84f5e;};return a87_0x56f2();}let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x2e8730,_0x3f0942,_0x1561f5,_0x1da0f3){const _0x382b41=a87_0x19e1a1;this[_0x382b41(0x161)]=_0x2e8730,this['soundService']=_0x3f0942,this['agendaService']=_0x1561f5,this[_0x382b41(0x18c)]=_0x1da0f3,this[_0x382b41(0x18d)]=new common_1['Logger'](PlaylistService_1[_0x382b41(0x16b)]);}async[a87_0x19e1a1(0x17a)](_0x39d1d7){const _0x5e7ea5=a87_0x19e1a1,_0x5b3e0b=new this[(_0x5e7ea5(0x161))](_0x39d1d7);return _0x5b3e0b[_0x5e7ea5(0x181)]();}async[a87_0x19e1a1(0x16f)](){const _0x43cce5=a87_0x19e1a1,_0x5b1b69=await this['playlistModel'][_0x43cce5(0x166)]()['exec'](),_0x2765f4=_0x5b1b69[_0x43cce5(0x19b)](async _0x5102b7=>{const _0x42919b=_0x43cce5,_0x52b3bd=await this[_0x42919b(0x174)][_0x42919b(0x173)](_0x5102b7[_0x42919b(0x196)]);return(0x0,playlist_mapper_1[_0x42919b(0x193)])(_0x5102b7,_0x52b3bd);});return await Promise[_0x43cce5(0x17d)](_0x2765f4);}async[a87_0x19e1a1(0x1a6)](_0x566a15){const _0x15fe63=a87_0x19e1a1,_0x50de79=await this[_0x15fe63(0x161)][_0x15fe63(0x1b2)](_0x566a15),_0x393019=await this[_0x15fe63(0x174)][_0x15fe63(0x173)](_0x50de79['soundIds']);return(0x0,playlist_mapper_1[_0x15fe63(0x193)])(_0x50de79,_0x393019);}async['update'](_0x30b41d,_0x595bf0){const _0xbfe0f8=a87_0x19e1a1,_0x5a9e79=await this[_0xbfe0f8(0x161)]['findByIdAndUpdate'](_0x30b41d,Object[_0xbfe0f8(0x172)](Object['assign']({},_0x595bf0),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x18dad4=await this[_0xbfe0f8(0x174)][_0xbfe0f8(0x173)](_0x5a9e79[_0xbfe0f8(0x196)]);return(0x0,playlist_mapper_1[_0xbfe0f8(0x193)])(_0x5a9e79,_0x18dad4);}async['delete'](_0x2559de){const _0x5ec297=a87_0x19e1a1;return await this[_0x5ec297(0x161)][_0x5ec297(0x1b3)](_0x2559de);}async[a87_0x19e1a1(0x1a0)](_0x1670eb,_0x51b518){const _0x286de3=a87_0x19e1a1,_0x2d82bd=await this[_0x286de3(0x161)][_0x286de3(0x1b2)](_0x1670eb);return _0x2d82bd[_0x286de3(0x196)][_0x286de3(0x171)](_0x51b518),await _0x2d82bd[_0x286de3(0x181)]();}async['removeSong'](_0x2ab433,_0x166c1c){const _0x1e1d81=a87_0x19e1a1,_0x270962=await this['playlistModel'][_0x1e1d81(0x1b2)](_0x2ab433);return _0x270962[_0x1e1d81(0x196)]=_0x270962[_0x1e1d81(0x196)][_0x1e1d81(0x1a8)](_0x407f0b=>_0x407f0b!==_0x166c1c),await _0x270962['save']();}async[a87_0x19e1a1(0x163)](_0x2caed9,_0x560516){const _0x570a19=a87_0x19e1a1,_0x5a471e={'when':_0x570a19(0x186),'jobType':enums_1[_0x570a19(0x19f)][_0x570a19(0x187)],'attributes':{'playlistId':_0x560516},'audit':{'actor':_0x2caed9,'name':enums_1[_0x570a19(0x19f)][_0x570a19(0x187)],'message':_0x570a19(0x17f)+_0x560516}},{jobId:_0x514142}=await this[_0x570a19(0x176)]['scheduleJob'](_0x5a471e);return this[_0x570a19(0x168)](_0x560516,{'jobId':_0x514142});}async[a87_0x19e1a1(0x197)](_0x2c9732){const _0x59dcdd=a87_0x19e1a1;let _0x4e6432=await this[_0x59dcdd(0x1a6)](_0x2c9732);const {jobId:_0x316954}=_0x4e6432||{};if(_0x316954){const {success:_0x16f8fc}=await this['agendaService']['cancelJob'](_0x316954);_0x16f8fc&&(_0x4e6432=await this['update'](_0x2c9732,{'jobId':null}));}return this[_0x59dcdd(0x18c)][_0x59dcdd(0x18b)]({'id':_0x4e6432[_0x59dcdd(0x191)],'isPlaying':![]}),_0x4e6432;}async[a87_0x19e1a1(0x165)](_0x5b360c){const _0x2b2f8d=a87_0x19e1a1,{playlistId:_0x479a88,jobId:_0x5f3799,durationInSecond:_0x203579}=_0x5b360c,_0x15e515=await this['playlistModel'][_0x2b2f8d(0x1b2)](_0x479a88),_0x2cca98=[..._0x15e515[_0x2b2f8d(0x196)]],_0x4f91c0=await this['soundService'][_0x2b2f8d(0x173)](_0x2cca98),_0x37b6e7=_0x4f91c0[_0x2b2f8d(0x19b)](_0x310496=>path[_0x2b2f8d(0x1b8)](path_1[_0x2b2f8d(0x189)],_0x2b2f8d(0x1ad),'audio',_0x310496[_0x2b2f8d(0x19e)]));job_1[_0x2b2f8d(0x17e)][_0x2b2f8d(0x18e)](),this[_0x2b2f8d(0x18d)][_0x2b2f8d(0x16d)](_0x2b2f8d(0x188)+_0x479a88+_0x2b2f8d(0x185)+_0x15e515[_0x2b2f8d(0x16b)]),(0x0,job_1['executeJob'])({'jobId':_0x5f3799,'run':()=>audio_player_1[_0x2b2f8d(0x16a)][_0x2b2f8d(0x177)](_0x37b6e7,0x32,_0x15e515[_0x2b2f8d(0x17b)]),'durationInSecond':_0x203579,'next':()=>this[_0x2b2f8d(0x197)](_0x479a88)}),this[_0x2b2f8d(0x18c)][_0x2b2f8d(0x18b)]({'id':_0x479a88,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1[a87_0x19e1a1(0x1a1)])(events_1[a87_0x19e1a1(0x179)][a87_0x19e1a1(0x1b9)]),__metadata(a87_0x19e1a1(0x182),Function),__metadata(a87_0x19e1a1(0x1af),[Object]),__metadata(a87_0x19e1a1(0x169),Promise)],PlaylistService[a87_0x19e1a1(0x18a)],'playFromEvent',null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a87_0x19e1a1(0x167)])(),__param(0x0,(0x0,mongoose_2[a87_0x19e1a1(0x1b1)])(a87_0x19e1a1(0x1ab))),__param(0x3,(0x0,common_1[a87_0x19e1a1(0x1a2)])(sound_gateway_1[a87_0x19e1a1(0x1a4)])),__metadata('design:paramtypes',[mongoose_1['Model'],sound_service_1['SoundService'],agenda_service_1[a87_0x19e1a1(0x19d)],sound_gateway_1['SoundGateway']])],PlaylistService),exports['PlaylistService']=PlaylistService;