'use strict';function a87_0x2169(_0x381e69,_0x36fdcd){const _0x5b8be8=a87_0x5b8b();return a87_0x2169=function(_0x216954,_0x4cec9d){_0x216954=_0x216954-0xe0;let _0x1b3cae=_0x5b8be8[_0x216954];return _0x1b3cae;},a87_0x2169(_0x381e69,_0x36fdcd);}const a87_0x74507a=a87_0x2169;(function(_0x571166,_0xe46658){const _0x4258e5=a87_0x2169,_0x1bba31=_0x571166();while(!![]){try{const _0x16736f=-parseInt(_0x4258e5(0x12b))/0x1*(parseInt(_0x4258e5(0xfd))/0x2)+parseInt(_0x4258e5(0x118))/0x3*(parseInt(_0x4258e5(0x106))/0x4)+-parseInt(_0x4258e5(0xe1))/0x5+parseInt(_0x4258e5(0xe2))/0x6*(-parseInt(_0x4258e5(0xf5))/0x7)+parseInt(_0x4258e5(0x10a))/0x8*(parseInt(_0x4258e5(0xf0))/0x9)+-parseInt(_0x4258e5(0x11e))/0xa+-parseInt(_0x4258e5(0xe7))/0xb*(-parseInt(_0x4258e5(0xfe))/0xc);if(_0x16736f===_0xe46658)break;else _0x1bba31['push'](_0x1bba31['shift']());}catch(_0x10c947){_0x1bba31['push'](_0x1bba31['shift']());}}}(a87_0x5b8b,0xc3ad5));var __decorate=this&&this['__decorate']||function(_0x1424fd,_0x1e32fb,_0x2bf1ff,_0x30f2d0){const _0xc846b5=a87_0x2169;var _0x149ba5=arguments[_0xc846b5(0xfb)],_0xf22252=_0x149ba5<0x3?_0x1e32fb:_0x30f2d0===null?_0x30f2d0=Object['getOwnPropertyDescriptor'](_0x1e32fb,_0x2bf1ff):_0x30f2d0,_0xf72db;if(typeof Reflect===_0xc846b5(0x12a)&&typeof Reflect['decorate']===_0xc846b5(0xe3))_0xf22252=Reflect[_0xc846b5(0x11b)](_0x1424fd,_0x1e32fb,_0x2bf1ff,_0x30f2d0);else{for(var _0x3b21be=_0x1424fd[_0xc846b5(0xfb)]-0x1;_0x3b21be>=0x0;_0x3b21be--)if(_0xf72db=_0x1424fd[_0x3b21be])_0xf22252=(_0x149ba5<0x3?_0xf72db(_0xf22252):_0x149ba5>0x3?_0xf72db(_0x1e32fb,_0x2bf1ff,_0xf22252):_0xf72db(_0x1e32fb,_0x2bf1ff))||_0xf22252;}return _0x149ba5>0x3&&_0xf22252&&Object[_0xc846b5(0x110)](_0x1e32fb,_0x2bf1ff,_0xf22252),_0xf22252;},__metadata=this&&this['__metadata']||function(_0x57a6fb,_0x1ee6ac){const _0x2110b7=a87_0x2169;if(typeof Reflect===_0x2110b7(0x12a)&&typeof Reflect[_0x2110b7(0xec)]===_0x2110b7(0xe3))return Reflect[_0x2110b7(0xec)](_0x57a6fb,_0x1ee6ac);},__param=this&&this[a87_0x74507a(0xef)]||function(_0x368159,_0x25dc23){return function(_0x596c7c,_0x434df5){_0x25dc23(_0x596c7c,_0x434df5,_0x368159);};},PlaylistService_1;function a87_0x5b8b(){const _0x3968d1=['2RPBhIo','9576vUrfYg','mongoose','stop','play','agendaService','findByIds','scheduleJob','log','10744KuOHft','Model','JobType','../common/audio/audio-player','8cxXSWk','assets','path','SoundGateway','Logger','findByIdAndDelete','defineProperty','exec','findByIdAndUpdate','save','playlistModel','prototype','Playlist','findById','1467mihqTJ','push','@nestjs/mongoose','decorate','Inject','Play','5149060hohWsr','./mapper/playlist.mapper','PROCESS_CACHE','broadcastPlaying','Playing\x20playlist:\x20','soundIds','soundService','../sound/sound.gateway','SoundService','playFromEvent','update','find','object','1485283wikYzE','../sound/sound.service','../agenda/agenda.service','addSong','logger','@nestjs/event-emitter','cancelJob','mapToDto','soundGateway','filter','create','2255370uUiUut','12ziFIgH','function','delete','executeJob','design:paramtypes','25410SXUjfF','design:returntype','isShuffle','fileName','PlaylistService','metadata','findOne','killAll','__param','9428796zoQDKa','PlayMusic','__esModule','assign','_id','3331027OTvQgN','processRootPath','audio','../common/events','\x20-\x20','join','length','Injectable'];a87_0x5b8b=function(){return _0x3968d1;};return a87_0x5b8b();}Object[a87_0x74507a(0x110)](exports,a87_0x74507a(0xf2),{'value':!![]}),exports[a87_0x74507a(0xeb)]=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a87_0x74507a(0xff)),mongoose_2=require(a87_0x74507a(0x11a)),event_emitter_1=require(a87_0x74507a(0x130)),sound_service_1=require(a87_0x74507a(0x12c)),job_1=require('../common/job'),events_1=require(a87_0x74507a(0xf8)),agenda_service_1=require(a87_0x74507a(0x12d)),playlist_mapper_1=require(a87_0x74507a(0x11f)),enums_1=require('../common/enums'),path=require(a87_0x74507a(0x10c)),path_1=require('../common/path'),audio_player_1=require(a87_0x74507a(0x109)),sound_gateway_1=require(a87_0x74507a(0x125));let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x559a7c,_0x5e6550,_0x1a0509,_0x1d9c7f){const _0x235123=a87_0x74507a;this[_0x235123(0x114)]=_0x559a7c,this[_0x235123(0x124)]=_0x5e6550,this[_0x235123(0x102)]=_0x1a0509,this[_0x235123(0x133)]=_0x1d9c7f,this[_0x235123(0x12f)]=new common_1[(_0x235123(0x10e))](PlaylistService_1['name']);}async[a87_0x74507a(0xe0)](_0x11c7f5){const _0x2b14c7=a87_0x74507a,_0x193a6d=new this[(_0x2b14c7(0x114))](_0x11c7f5);return _0x193a6d['save']();}async['findAll'](){const _0x16d4e3=a87_0x74507a,_0x4b27ef=await this['playlistModel'][_0x16d4e3(0x129)]()[_0x16d4e3(0x111)](),_0x58c645=_0x4b27ef['map'](async _0x126497=>{const _0x4dfb5b=_0x16d4e3,_0xc8ffae=await this[_0x4dfb5b(0x124)][_0x4dfb5b(0x103)](_0x126497[_0x4dfb5b(0x123)]);return(0x0,playlist_mapper_1[_0x4dfb5b(0x132)])(_0x126497,_0xc8ffae);});return await Promise['all'](_0x58c645);}async['findOne'](_0x6c65f4){const _0x4d7e6d=a87_0x74507a,_0x149f41=await this[_0x4d7e6d(0x114)]['findById'](_0x6c65f4),_0x34b2b1=await this[_0x4d7e6d(0x124)][_0x4d7e6d(0x103)](_0x149f41[_0x4d7e6d(0x123)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x149f41,_0x34b2b1);}async['update'](_0x5bc820,_0x1f7cd4){const _0x4f726d=a87_0x74507a,_0x40bf1c=await this['playlistModel'][_0x4f726d(0x112)](_0x5bc820,Object['assign'](Object[_0x4f726d(0xf3)]({},_0x1f7cd4),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x53e716=await this['soundService'][_0x4f726d(0x103)](_0x40bf1c[_0x4f726d(0x123)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x40bf1c,_0x53e716);}async[a87_0x74507a(0xe4)](_0x292818){const _0x14919e=a87_0x74507a;return await this[_0x14919e(0x114)][_0x14919e(0x10f)](_0x292818);}async[a87_0x74507a(0x12e)](_0xa0cf7d,_0x131cb8){const _0x158e95=a87_0x74507a,_0x257f4d=await this[_0x158e95(0x114)][_0x158e95(0x117)](_0xa0cf7d);return _0x257f4d[_0x158e95(0x123)][_0x158e95(0x119)](_0x131cb8),await _0x257f4d[_0x158e95(0x113)]();}async['removeSong'](_0x30f5b0,_0x3f928d){const _0x200954=a87_0x74507a,_0x11220f=await this[_0x200954(0x114)][_0x200954(0x117)](_0x30f5b0);return _0x11220f[_0x200954(0x123)]=_0x11220f['soundIds'][_0x200954(0x134)](_0x584c02=>_0x584c02!==_0x3f928d),await _0x11220f[_0x200954(0x113)]();}async[a87_0x74507a(0x101)](_0x57ab39,_0x27f000){const _0x296e51=a87_0x74507a,_0x36a188={'when':'now','jobType':enums_1[_0x296e51(0x108)][_0x296e51(0xf1)],'attributes':{'playlistId':_0x27f000},'audit':{'actor':_0x57ab39,'name':enums_1[_0x296e51(0x108)][_0x296e51(0xf1)],'message':'Play\x20Music\x20Playlist:\x20'+_0x27f000}},{jobId:_0x6e5110}=await this[_0x296e51(0x102)][_0x296e51(0x104)](_0x36a188);return this[_0x296e51(0x128)](_0x27f000,{'jobId':_0x6e5110});}async[a87_0x74507a(0x100)](_0x287b1b){const _0x21f35b=a87_0x74507a;let _0xf55de0=await this[_0x21f35b(0xed)](_0x287b1b);const {jobId:_0x306d15}=_0xf55de0||{};if(_0x306d15){const {success:_0x46bb36}=await this[_0x21f35b(0x102)][_0x21f35b(0x131)](_0x306d15);_0x46bb36&&(_0xf55de0=await this[_0x21f35b(0x128)](_0x287b1b,{'jobId':null}));}return this['soundGateway'][_0x21f35b(0x121)]({'id':_0xf55de0[_0x21f35b(0xf4)],'isPlaying':![]}),_0xf55de0;}async[a87_0x74507a(0x127)](_0x469a48){const _0x3bc8bb=a87_0x74507a,{playlistId:_0x428513,jobId:_0x223307,durationInSecond:_0x3221db}=_0x469a48,_0x657636=await this[_0x3bc8bb(0x114)][_0x3bc8bb(0x117)](_0x428513),_0x425c92=[..._0x657636[_0x3bc8bb(0x123)]],_0x46cb18=await this[_0x3bc8bb(0x124)][_0x3bc8bb(0x103)](_0x425c92),_0x36905a=_0x46cb18['map'](_0x257d56=>path[_0x3bc8bb(0xfa)](path_1[_0x3bc8bb(0xf6)],_0x3bc8bb(0x10b),_0x3bc8bb(0xf7),_0x257d56[_0x3bc8bb(0xea)]));job_1[_0x3bc8bb(0x120)][_0x3bc8bb(0xee)](),this['logger'][_0x3bc8bb(0x105)](_0x3bc8bb(0x122)+_0x428513+_0x3bc8bb(0xf9)+_0x657636['name']),(0x0,job_1[_0x3bc8bb(0xe5)])({'jobId':_0x223307,'run':()=>audio_player_1['AudioPlayer']['playAsync'](_0x36905a,0x32,_0x657636[_0x3bc8bb(0xe9)]),'durationInSecond':_0x3221db,'next':()=>this[_0x3bc8bb(0x100)](_0x428513)}),this[_0x3bc8bb(0x133)][_0x3bc8bb(0x121)]({'id':_0x428513,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1['OnEvent'])(events_1['PlaylistEvent'][a87_0x74507a(0x11d)]),__metadata('design:type',Function),__metadata(a87_0x74507a(0xe6),[Object]),__metadata(a87_0x74507a(0xe8),Promise)],PlaylistService[a87_0x74507a(0x115)],a87_0x74507a(0x127),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a87_0x74507a(0xfc)])(),__param(0x0,(0x0,mongoose_2['InjectModel'])(a87_0x74507a(0x116))),__param(0x3,(0x0,common_1[a87_0x74507a(0x11c)])(sound_gateway_1[a87_0x74507a(0x10d)])),__metadata('design:paramtypes',[mongoose_1[a87_0x74507a(0x107)],sound_service_1[a87_0x74507a(0x126)],agenda_service_1['AgendaService'],sound_gateway_1[a87_0x74507a(0x10d)]])],PlaylistService),exports[a87_0x74507a(0xeb)]=PlaylistService;