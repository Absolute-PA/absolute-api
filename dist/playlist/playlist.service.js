'use strict';function a90_0x1334(_0x10065a,_0x30f3b8){const _0x3c1021=a90_0x3c10();return a90_0x1334=function(_0x133440,_0xc8c15a){_0x133440=_0x133440-0x14e;let _0x241fdf=_0x3c1021[_0x133440];return _0x241fdf;},a90_0x1334(_0x10065a,_0x30f3b8);}const a90_0x33835d=a90_0x1334;(function(_0x30806b,_0x408012){const _0x12b536=a90_0x1334,_0x517a98=_0x30806b();while(!![]){try{const _0x5eab7d=-parseInt(_0x12b536(0x155))/0x1+-parseInt(_0x12b536(0x162))/0x2*(-parseInt(_0x12b536(0x158))/0x3)+parseInt(_0x12b536(0x1a2))/0x4+parseInt(_0x12b536(0x19d))/0x5*(parseInt(_0x12b536(0x18a))/0x6)+parseInt(_0x12b536(0x17a))/0x7*(-parseInt(_0x12b536(0x153))/0x8)+parseInt(_0x12b536(0x16b))/0x9*(parseInt(_0x12b536(0x1a3))/0xa)+parseInt(_0x12b536(0x156))/0xb;if(_0x5eab7d===_0x408012)break;else _0x517a98['push'](_0x517a98['shift']());}catch(_0x2d31ad){_0x517a98['push'](_0x517a98['shift']());}}}(a90_0x3c10,0x7cf33));var __decorate=this&&this['__decorate']||function(_0x4b777b,_0x3fc291,_0x515e3a,_0x52c807){const _0xc91551=a90_0x1334;var _0x19ff5f=arguments[_0xc91551(0x1a6)],_0x57fb86=_0x19ff5f<0x3?_0x3fc291:_0x52c807===null?_0x52c807=Object[_0xc91551(0x165)](_0x3fc291,_0x515e3a):_0x52c807,_0x43f478;if(typeof Reflect===_0xc91551(0x17e)&&typeof Reflect[_0xc91551(0x196)]===_0xc91551(0x17b))_0x57fb86=Reflect[_0xc91551(0x196)](_0x4b777b,_0x3fc291,_0x515e3a,_0x52c807);else{for(var _0x2b4f2a=_0x4b777b[_0xc91551(0x1a6)]-0x1;_0x2b4f2a>=0x0;_0x2b4f2a--)if(_0x43f478=_0x4b777b[_0x2b4f2a])_0x57fb86=(_0x19ff5f<0x3?_0x43f478(_0x57fb86):_0x19ff5f>0x3?_0x43f478(_0x3fc291,_0x515e3a,_0x57fb86):_0x43f478(_0x3fc291,_0x515e3a))||_0x57fb86;}return _0x19ff5f>0x3&&_0x57fb86&&Object['defineProperty'](_0x3fc291,_0x515e3a,_0x57fb86),_0x57fb86;},__metadata=this&&this[a90_0x33835d(0x198)]||function(_0x4320ac,_0x13bb52){const _0x511392=a90_0x33835d;if(typeof Reflect===_0x511392(0x17e)&&typeof Reflect[_0x511392(0x172)]===_0x511392(0x17b))return Reflect[_0x511392(0x172)](_0x4320ac,_0x13bb52);},__param=this&&this[a90_0x33835d(0x183)]||function(_0x43eaa1,_0x55079e){return function(_0x40b6e4,_0x4a833e){_0x55079e(_0x40b6e4,_0x4a833e,_0x43eaa1);};},PlaylistService_1;function a90_0x3c10(){const _0x403c2d=['executeJob','agendaService','all','6DABvRN','find','design:type','soundGateway','mongoose','InjectModel','create','log','\x20-\x20','now','findByIdAndDelete','update','decorate','addSong','__metadata','AudioPlayer','Injectable','Inject','soundService','419865zGspge','processRootPath','../sound/sound.service','design:paramtypes','cancelJob','208888NHhURT','30EKsHpA','SoundService','@nestjs/mongoose','length','../common/audio/audio-player','logger','./mapper/playlist.mapper','mapToDto','../sound/sound.gateway','save','2451688cUferO','Playing\x20playlist:\x20','88615ubPbFE','1815682uOglzd','playAsync','129ITWrBI','Play\x20Music\x20Playlist:\x20','path','map','Model','../common/events','prototype','findOne','findById','exec','35422HNjUun','findByIds','@nestjs/event-emitter','getOwnPropertyDescriptor','__esModule','PlaylistService','../common/job','fileName','assets','1370889dWLzyO','soundIds','removeSong','../common/enums','assign','name','playFromEvent','metadata','playlistModel','../agenda/agenda.service','join','broadcastPlaying','AgendaService','design:returntype','PlayMusic','21MODiqO','function','SoundGateway','PlaylistEvent','object','_id','OnEvent','Play','push','__param','stop','audio','JobType'];a90_0x3c10=function(){return _0x403c2d;};return a90_0x3c10();}Object['defineProperty'](exports,a90_0x33835d(0x166),{'value':!![]}),exports['PlaylistService']=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a90_0x33835d(0x18e)),mongoose_2=require(a90_0x33835d(0x1a5)),event_emitter_1=require(a90_0x33835d(0x164)),sound_service_1=require(a90_0x33835d(0x19f)),job_1=require(a90_0x33835d(0x168)),events_1=require(a90_0x33835d(0x15d)),agenda_service_1=require(a90_0x33835d(0x174)),playlist_mapper_1=require(a90_0x33835d(0x14f)),enums_1=require(a90_0x33835d(0x16e)),path=require(a90_0x33835d(0x15a)),path_1=require('../common/path'),audio_player_1=require(a90_0x33835d(0x1a7)),sound_gateway_1=require(a90_0x33835d(0x151));let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x46e07b,_0x3a7ea3,_0x4b4650,_0x5c0055){const _0x177c50=a90_0x33835d;this[_0x177c50(0x173)]=_0x46e07b,this[_0x177c50(0x19c)]=_0x3a7ea3,this[_0x177c50(0x188)]=_0x4b4650,this['soundGateway']=_0x5c0055,this[_0x177c50(0x14e)]=new common_1['Logger'](PlaylistService_1[_0x177c50(0x170)]);}async[a90_0x33835d(0x190)](_0x48c8a6){const _0x3d8ff7=new this['playlistModel'](_0x48c8a6);return _0x3d8ff7['save']();}async['findAll'](){const _0x523b9a=a90_0x33835d,_0xd7f899=await this[_0x523b9a(0x173)][_0x523b9a(0x18b)]()[_0x523b9a(0x161)](),_0x173351=_0xd7f899[_0x523b9a(0x15b)](async _0x159ebe=>{const _0x46e355=_0x523b9a,_0x1e41c6=await this[_0x46e355(0x19c)][_0x46e355(0x163)](_0x159ebe[_0x46e355(0x16c)]);return(0x0,playlist_mapper_1[_0x46e355(0x150)])(_0x159ebe,_0x1e41c6);});return await Promise[_0x523b9a(0x189)](_0x173351);}async[a90_0x33835d(0x15f)](_0x318de2){const _0x9b4b32=a90_0x33835d,_0x3f3359=await this[_0x9b4b32(0x173)][_0x9b4b32(0x160)](_0x318de2),_0x5cc72a=await this['soundService'][_0x9b4b32(0x163)](_0x3f3359['soundIds']);return(0x0,playlist_mapper_1[_0x9b4b32(0x150)])(_0x3f3359,_0x5cc72a);}async[a90_0x33835d(0x195)](_0x40a0fd,_0x59d1e3){const _0x3db2c5=a90_0x33835d,_0x1bf6d9=await this[_0x3db2c5(0x173)]['findByIdAndUpdate'](_0x40a0fd,Object[_0x3db2c5(0x16f)](Object['assign']({},_0x59d1e3),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x4a97c1=await this[_0x3db2c5(0x19c)][_0x3db2c5(0x163)](_0x1bf6d9[_0x3db2c5(0x16c)]);return(0x0,playlist_mapper_1[_0x3db2c5(0x150)])(_0x1bf6d9,_0x4a97c1);}async['delete'](_0xe6b06f){const _0x2edad8=a90_0x33835d;return await this[_0x2edad8(0x173)][_0x2edad8(0x194)](_0xe6b06f);}async[a90_0x33835d(0x197)](_0x4ebf57,_0x478b2b){const _0x426770=a90_0x33835d,_0x221f73=await this[_0x426770(0x173)][_0x426770(0x160)](_0x4ebf57);return _0x221f73[_0x426770(0x16c)][_0x426770(0x182)](_0x478b2b),await _0x221f73['save']();}async[a90_0x33835d(0x16d)](_0x410b00,_0x2dc5b2){const _0x573857=a90_0x33835d,_0x59a5bb=await this[_0x573857(0x173)][_0x573857(0x160)](_0x410b00);return _0x59a5bb['soundIds']=_0x59a5bb[_0x573857(0x16c)]['filter'](_0x129dc1=>_0x129dc1!==_0x2dc5b2),await _0x59a5bb[_0x573857(0x152)]();}async['play'](_0x34330c,_0x59a0e0){const _0x3a822b=a90_0x33835d,_0x11d58b={'when':_0x3a822b(0x193),'jobType':enums_1[_0x3a822b(0x186)][_0x3a822b(0x179)],'attributes':{'playlistId':_0x59a0e0},'audit':{'actor':_0x34330c,'name':enums_1['JobType'][_0x3a822b(0x179)],'message':_0x3a822b(0x159)+_0x59a0e0}},{jobId:_0x517c6c}=await this[_0x3a822b(0x188)]['scheduleJob'](_0x11d58b);return this['update'](_0x59a0e0,{'jobId':_0x517c6c});}async[a90_0x33835d(0x184)](_0x405a4c){const _0x1c2104=a90_0x33835d;let _0x4e6891=await this['findOne'](_0x405a4c);const {jobId:_0x7de35f}=_0x4e6891||{};if(_0x7de35f){const {success:_0x13e604}=await this[_0x1c2104(0x188)][_0x1c2104(0x1a1)](_0x7de35f);_0x13e604&&(_0x4e6891=await this['update'](_0x405a4c,{'jobId':null}));}return this[_0x1c2104(0x18d)][_0x1c2104(0x176)]({'id':_0x4e6891[_0x1c2104(0x17f)],'isPlaying':![]}),_0x4e6891;}async[a90_0x33835d(0x171)](_0x3fefb4){const _0xd4a0b2=a90_0x33835d,{playlistId:_0x26ef87,jobId:_0xf7fa69,durationInSecond:_0x229922}=_0x3fefb4,_0x139a32=await this[_0xd4a0b2(0x173)][_0xd4a0b2(0x160)](_0x26ef87),_0x21c10b=[..._0x139a32[_0xd4a0b2(0x16c)]],_0x408aa5=await this['soundService'][_0xd4a0b2(0x163)](_0x21c10b),_0x532616=_0x408aa5['map'](_0x359126=>path[_0xd4a0b2(0x175)](path_1[_0xd4a0b2(0x19e)],_0xd4a0b2(0x16a),_0xd4a0b2(0x185),_0x359126[_0xd4a0b2(0x169)]));job_1['PROCESS_CACHE']['killAll'](),this[_0xd4a0b2(0x14e)][_0xd4a0b2(0x191)](_0xd4a0b2(0x154)+_0x26ef87+_0xd4a0b2(0x192)+_0x139a32[_0xd4a0b2(0x170)]),(0x0,job_1[_0xd4a0b2(0x187)])({'jobId':_0xf7fa69,'run':()=>audio_player_1[_0xd4a0b2(0x199)][_0xd4a0b2(0x157)](_0x532616,0x32,_0x139a32['isShuffle']),'durationInSecond':_0x229922,'next':()=>this[_0xd4a0b2(0x184)](_0x26ef87)}),this[_0xd4a0b2(0x18d)][_0xd4a0b2(0x176)]({'id':_0x26ef87,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1[a90_0x33835d(0x180)])(events_1[a90_0x33835d(0x17d)][a90_0x33835d(0x181)]),__metadata(a90_0x33835d(0x18c),Function),__metadata(a90_0x33835d(0x1a0),[Object]),__metadata(a90_0x33835d(0x178),Promise)],PlaylistService[a90_0x33835d(0x15e)],a90_0x33835d(0x171),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a90_0x33835d(0x19a)])(),__param(0x0,(0x0,mongoose_2[a90_0x33835d(0x18f)])('Playlist')),__param(0x3,(0x0,common_1[a90_0x33835d(0x19b)])(sound_gateway_1[a90_0x33835d(0x17c)])),__metadata(a90_0x33835d(0x1a0),[mongoose_1[a90_0x33835d(0x15c)],sound_service_1[a90_0x33835d(0x1a4)],agenda_service_1[a90_0x33835d(0x177)],sound_gateway_1[a90_0x33835d(0x17c)]])],PlaylistService),exports[a90_0x33835d(0x167)]=PlaylistService;