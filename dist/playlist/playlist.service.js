'use strict';const a90_0x2aab03=a90_0x2a4c;(function(_0x34bfc,_0x32f319){const _0x53cd01=a90_0x2a4c,_0x220fd4=_0x34bfc();while(!![]){try{const _0x3eff8c=parseInt(_0x53cd01(0x1db))/0x1+-parseInt(_0x53cd01(0x20c))/0x2+-parseInt(_0x53cd01(0x1b8))/0x3+parseInt(_0x53cd01(0x1f3))/0x4+-parseInt(_0x53cd01(0x1b6))/0x5*(-parseInt(_0x53cd01(0x1fd))/0x6)+parseInt(_0x53cd01(0x1c8))/0x7*(parseInt(_0x53cd01(0x1d4))/0x8)+parseInt(_0x53cd01(0x207))/0x9*(-parseInt(_0x53cd01(0x1ea))/0xa);if(_0x3eff8c===_0x32f319)break;else _0x220fd4['push'](_0x220fd4['shift']());}catch(_0x3f0240){_0x220fd4['push'](_0x220fd4['shift']());}}}(a90_0xe90f,0x22350));function a90_0xe90f(){const _0x2bb944=['all','addSong','../sound/sound.gateway','OnEvent','Logger','find','AgendaService','../common/path','map','decorate','87192aONOFW','__param','prototype','../sound/sound.service','findOne','__decorate','audio','_id','soundIds','Injectable','push','soundGateway','64yurPWh','create','mapToDto','name','function','logger','__esModule','216513AjgOrx','findById','../common/events','save','processRootPath','cancelJob','metadata','findByIdAndUpdate','findAll','\x20-\x20','killAll','delete','broadcastPlaying','../common/audio/audio-player','executeJob','50tvIZoP','filter','path','Play\x20Music\x20Playlist:\x20','findByIds','scheduleJob','playlistModel','removeSong','stop','109788fxGVfR','JobType','update','design:returntype','soundService','length','join','../common/job','AudioPlayer','../agenda/agenda.service','708978SmOQyf','SoundGateway','../common/enums','play','PROCESS_CACHE','mongoose','fileName','design:paramtypes','@nestjs/common','playFromEvent','286623OHxJzr','PlaylistEvent','Inject','assets','now','331560HqnYcu','Play','assign','getOwnPropertyDescriptor','@nestjs/event-emitter','Playlist','log','10oCJswd','PlayMusic','344421fcdMvl','@nestjs/mongoose','playAsync','object','isShuffle','PlaylistService'];a90_0xe90f=function(){return _0x2bb944;};return a90_0xe90f();}var __decorate=this&&this[a90_0x2aab03(0x1cd)]||function(_0x48a1ce,_0x1c41da,_0x53220c,_0x4e23c8){const _0x25d667=a90_0x2aab03;var _0x59d122=arguments[_0x25d667(0x1f8)],_0x1c4007=_0x59d122<0x3?_0x1c41da:_0x4e23c8===null?_0x4e23c8=Object[_0x25d667(0x1b2)](_0x1c41da,_0x53220c):_0x4e23c8,_0x15f418;if(typeof Reflect===_0x25d667(0x1bb)&&typeof Reflect[_0x25d667(0x1c7)]==='function')_0x1c4007=Reflect['decorate'](_0x48a1ce,_0x1c41da,_0x53220c,_0x4e23c8);else{for(var _0x1a68be=_0x48a1ce['length']-0x1;_0x1a68be>=0x0;_0x1a68be--)if(_0x15f418=_0x48a1ce[_0x1a68be])_0x1c4007=(_0x59d122<0x3?_0x15f418(_0x1c4007):_0x59d122>0x3?_0x15f418(_0x1c41da,_0x53220c,_0x1c4007):_0x15f418(_0x1c41da,_0x53220c))||_0x1c4007;}return _0x59d122>0x3&&_0x1c4007&&Object['defineProperty'](_0x1c41da,_0x53220c,_0x1c4007),_0x1c4007;},__metadata=this&&this['__metadata']||function(_0x49ceef,_0x18a720){const _0x2406ae=a90_0x2aab03;if(typeof Reflect==='object'&&typeof Reflect[_0x2406ae(0x1e1)]===_0x2406ae(0x1d8))return Reflect[_0x2406ae(0x1e1)](_0x49ceef,_0x18a720);},__param=this&&this[a90_0x2aab03(0x1c9)]||function(_0x3c1698,_0x13f500){return function(_0x5e0458,_0x4b5c54){_0x13f500(_0x5e0458,_0x4b5c54,_0x3c1698);};},PlaylistService_1;Object['defineProperty'](exports,a90_0x2aab03(0x1da),{'value':!![]}),exports[a90_0x2aab03(0x1bd)]=void 0x0;const common_1=require(a90_0x2aab03(0x205)),mongoose_1=require(a90_0x2aab03(0x202)),mongoose_2=require(a90_0x2aab03(0x1b9)),event_emitter_1=require(a90_0x2aab03(0x1b3)),sound_service_1=require(a90_0x2aab03(0x1cb)),job_1=require(a90_0x2aab03(0x1fa)),events_1=require(a90_0x2aab03(0x1dd)),agenda_service_1=require(a90_0x2aab03(0x1fc)),playlist_mapper_1=require('./mapper/playlist.mapper'),enums_1=require(a90_0x2aab03(0x1ff)),path=require(a90_0x2aab03(0x1ec)),path_1=require(a90_0x2aab03(0x1c5)),audio_player_1=require(a90_0x2aab03(0x1e8)),sound_gateway_1=require(a90_0x2aab03(0x1c0));let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x50b008,_0x289d98,_0x89b37c,_0x4acf7f){const _0x3ae1d2=a90_0x2aab03;this[_0x3ae1d2(0x1f0)]=_0x50b008,this[_0x3ae1d2(0x1f7)]=_0x289d98,this['agendaService']=_0x89b37c,this[_0x3ae1d2(0x1d3)]=_0x4acf7f,this[_0x3ae1d2(0x1d9)]=new common_1[(_0x3ae1d2(0x1c2))](PlaylistService_1[_0x3ae1d2(0x1d7)]);}async[a90_0x2aab03(0x1d5)](_0x37121f){const _0x3382dc=a90_0x2aab03,_0x1a1120=new this[(_0x3382dc(0x1f0))](_0x37121f);return _0x1a1120[_0x3382dc(0x1de)]();}async[a90_0x2aab03(0x1e3)](){const _0x3544ed=a90_0x2aab03,_0x37ebc9=await this[_0x3544ed(0x1f0)][_0x3544ed(0x1c3)]()['exec'](),_0x38f279=_0x37ebc9[_0x3544ed(0x1c6)](async _0x2fc6f9=>{const _0x420b70=_0x3544ed,_0x1b7ca9=await this['soundService'][_0x420b70(0x1ee)](_0x2fc6f9[_0x420b70(0x1d0)]);return(0x0,playlist_mapper_1[_0x420b70(0x1d6)])(_0x2fc6f9,_0x1b7ca9);});return await Promise[_0x3544ed(0x1be)](_0x38f279);}async[a90_0x2aab03(0x1cc)](_0x46dfbf){const _0x1bae39=a90_0x2aab03,_0x751660=await this[_0x1bae39(0x1f0)][_0x1bae39(0x1dc)](_0x46dfbf),_0x100897=await this[_0x1bae39(0x1f7)]['findByIds'](_0x751660[_0x1bae39(0x1d0)]);return(0x0,playlist_mapper_1[_0x1bae39(0x1d6)])(_0x751660,_0x100897);}async[a90_0x2aab03(0x1f5)](_0x2a1f2e,_0x4364a3){const _0x2aba03=a90_0x2aab03,_0x44ca4=await this[_0x2aba03(0x1f0)][_0x2aba03(0x1e2)](_0x2a1f2e,Object['assign'](Object[_0x2aba03(0x20e)]({},_0x4364a3),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x51715c=await this[_0x2aba03(0x1f7)][_0x2aba03(0x1ee)](_0x44ca4[_0x2aba03(0x1d0)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x44ca4,_0x51715c);}async[a90_0x2aab03(0x1e6)](_0x35d827){const _0x301460=a90_0x2aab03;return await this[_0x301460(0x1f0)]['findByIdAndDelete'](_0x35d827);}async[a90_0x2aab03(0x1bf)](_0x4f5dfc,_0x40d8ab){const _0x2bade9=a90_0x2aab03,_0x1dcb0c=await this[_0x2bade9(0x1f0)][_0x2bade9(0x1dc)](_0x4f5dfc);return _0x1dcb0c['soundIds'][_0x2bade9(0x1d2)](_0x40d8ab),await _0x1dcb0c[_0x2bade9(0x1de)]();}async[a90_0x2aab03(0x1f1)](_0x4fe2d4,_0xe0dc01){const _0x1080d8=a90_0x2aab03,_0x459e87=await this['playlistModel'][_0x1080d8(0x1dc)](_0x4fe2d4);return _0x459e87[_0x1080d8(0x1d0)]=_0x459e87['soundIds'][_0x1080d8(0x1eb)](_0x1c70e0=>_0x1c70e0!==_0xe0dc01),await _0x459e87['save']();}async[a90_0x2aab03(0x200)](_0x1c0ec5,_0x20bb5a){const _0x363fa9=a90_0x2aab03,_0x4d71cf={'when':_0x363fa9(0x20b),'jobType':enums_1[_0x363fa9(0x1f4)][_0x363fa9(0x1b7)],'attributes':{'playlistId':_0x20bb5a},'audit':{'actor':_0x1c0ec5,'name':enums_1[_0x363fa9(0x1f4)][_0x363fa9(0x1b7)],'message':_0x363fa9(0x1ed)+_0x20bb5a}},{jobId:_0x345d33}=await this['agendaService'][_0x363fa9(0x1ef)](_0x4d71cf);return this[_0x363fa9(0x1f5)](_0x20bb5a,{'jobId':_0x345d33});}async[a90_0x2aab03(0x1f2)](_0x4ca872){const _0x327ee5=a90_0x2aab03;let _0x23be2e=await this[_0x327ee5(0x1cc)](_0x4ca872);const {jobId:_0xedea31}=_0x23be2e||{};if(_0xedea31){const {success:_0xca774e}=await this['agendaService'][_0x327ee5(0x1e0)](_0xedea31);_0xca774e&&(_0x23be2e=await this['update'](_0x4ca872,{'jobId':null}));}return this['soundGateway']['broadcastPlaying']({'id':_0x23be2e[_0x327ee5(0x1cf)],'isPlaying':![]}),_0x23be2e;}async[a90_0x2aab03(0x206)](_0x2a642a){const _0x28de33=a90_0x2aab03,{playlistId:_0x7772de,jobId:_0x2e689b,durationInSecond:_0x32ec75}=_0x2a642a,_0x2ea708=await this[_0x28de33(0x1f0)][_0x28de33(0x1dc)](_0x7772de),_0x5a8856=[..._0x2ea708['soundIds']],_0x1ccf55=await this[_0x28de33(0x1f7)][_0x28de33(0x1ee)](_0x5a8856),_0x50b56d=_0x1ccf55[_0x28de33(0x1c6)](_0xf4e43d=>path[_0x28de33(0x1f9)](path_1[_0x28de33(0x1df)],_0x28de33(0x20a),_0x28de33(0x1ce),_0xf4e43d[_0x28de33(0x203)]));job_1[_0x28de33(0x201)][_0x28de33(0x1e5)](),this[_0x28de33(0x1d9)][_0x28de33(0x1b5)]('Playing\x20playlist:\x20'+_0x7772de+_0x28de33(0x1e4)+_0x2ea708[_0x28de33(0x1d7)]),(0x0,job_1[_0x28de33(0x1e9)])({'jobId':_0x2e689b,'run':()=>audio_player_1[_0x28de33(0x1fb)][_0x28de33(0x1ba)](_0x50b56d,0x32,_0x2ea708[_0x28de33(0x1bc)]),'durationInSecond':_0x32ec75,'next':()=>this[_0x28de33(0x1f2)](_0x7772de)}),this[_0x28de33(0x1d3)][_0x28de33(0x1e7)]({'id':_0x7772de,'isPlaying':!![]});}};function a90_0x2a4c(_0x31fdfd,_0x11dbd5){const _0xe90ff1=a90_0xe90f();return a90_0x2a4c=function(_0x2a4cdf,_0x4188e2){_0x2a4cdf=_0x2a4cdf-0x1b2;let _0x41d200=_0xe90ff1[_0x2a4cdf];return _0x41d200;},a90_0x2a4c(_0x31fdfd,_0x11dbd5);}__decorate([(0x0,event_emitter_1[a90_0x2aab03(0x1c1)])(events_1[a90_0x2aab03(0x208)][a90_0x2aab03(0x20d)]),__metadata('design:type',Function),__metadata(a90_0x2aab03(0x204),[Object]),__metadata(a90_0x2aab03(0x1f6),Promise)],PlaylistService[a90_0x2aab03(0x1ca)],'playFromEvent',null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a90_0x2aab03(0x1d1)])(),__param(0x0,(0x0,mongoose_2['InjectModel'])(a90_0x2aab03(0x1b4))),__param(0x3,(0x0,common_1[a90_0x2aab03(0x209)])(sound_gateway_1[a90_0x2aab03(0x1fe)])),__metadata(a90_0x2aab03(0x204),[mongoose_1['Model'],sound_service_1['SoundService'],agenda_service_1[a90_0x2aab03(0x1c4)],sound_gateway_1[a90_0x2aab03(0x1fe)]])],PlaylistService),exports[a90_0x2aab03(0x1bd)]=PlaylistService;