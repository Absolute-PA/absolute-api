'use strict';const a90_0x552e3b=a90_0x2681;(function(_0x25fbb6,_0x309b48){const _0x29106c=a90_0x2681,_0x14ce6d=_0x25fbb6();while(!![]){try{const _0x4812e1=-parseInt(_0x29106c(0x206))/0x1*(parseInt(_0x29106c(0x23c))/0x2)+parseInt(_0x29106c(0x1eb))/0x3*(-parseInt(_0x29106c(0x239))/0x4)+-parseInt(_0x29106c(0x1fa))/0x5+-parseInt(_0x29106c(0x216))/0x6*(-parseInt(_0x29106c(0x202))/0x7)+parseInt(_0x29106c(0x217))/0x8+parseInt(_0x29106c(0x21b))/0x9+parseInt(_0x29106c(0x20f))/0xa;if(_0x4812e1===_0x309b48)break;else _0x14ce6d['push'](_0x14ce6d['shift']());}catch(_0x57ef51){_0x14ce6d['push'](_0x14ce6d['shift']());}}}(a90_0x4c4b,0xb9710));function a90_0x4c4b(){const _0x39b665=['../common/job','Play','findById','4624605SaUeAO','__esModule','now','all','filter','assign','join','mongoose','PlaylistEvent','update','processRootPath','Play\x20Music\x20Playlist:\x20','play','playFromEvent','Playlist','delete','Playing\x20playlist:\x20','playlistModel','agendaService','findOne','design:type','PlayMusic','@nestjs/event-emitter','function','findByIds','@nestjs/mongoose','fileName','removeSong','OnEvent','PlaylistService','2200664PSFejB','find','__metadata','2628nUpFuv','Inject','object','soundIds','path','../common/path','mapToDto','logger','3vItoFN','soundGateway','\x20-\x20','prototype','scheduleJob','cancelJob','name','create','decorate','length','log','../sound/sound.service','Injectable','stop','map','6887810NepkMs','SoundGateway','broadcastPlaying','../agenda/agenda.service','metadata','__param','__decorate','@nestjs/common','42119BuxcIn','exec','audio','playAsync','928taqfjW','PROCESS_CACHE','findAll','_id','assets','findByIdAndUpdate','executeJob','JobType','defineProperty','7529710Xqjcrh','AudioPlayer','killAll','soundService','Model','../sound/sound.gateway','save','1362XjUqwb','10192104dHiuIC'];a90_0x4c4b=function(){return _0x39b665;};return a90_0x4c4b();}var __decorate=this&&this[a90_0x552e3b(0x200)]||function(_0x213dd1,_0x269bdb,_0x346ca7,_0xaff936){const _0x197ebf=a90_0x552e3b;var _0xabc34d=arguments[_0x197ebf(0x1f4)],_0x19050c=_0xabc34d<0x3?_0x269bdb:_0xaff936===null?_0xaff936=Object['getOwnPropertyDescriptor'](_0x269bdb,_0x346ca7):_0xaff936,_0x440323;if(typeof Reflect===_0x197ebf(0x23e)&&typeof Reflect[_0x197ebf(0x1f3)]===_0x197ebf(0x232))_0x19050c=Reflect[_0x197ebf(0x1f3)](_0x213dd1,_0x269bdb,_0x346ca7,_0xaff936);else{for(var _0x4a37af=_0x213dd1[_0x197ebf(0x1f4)]-0x1;_0x4a37af>=0x0;_0x4a37af--)if(_0x440323=_0x213dd1[_0x4a37af])_0x19050c=(_0xabc34d<0x3?_0x440323(_0x19050c):_0xabc34d>0x3?_0x440323(_0x269bdb,_0x346ca7,_0x19050c):_0x440323(_0x269bdb,_0x346ca7))||_0x19050c;}return _0xabc34d>0x3&&_0x19050c&&Object['defineProperty'](_0x269bdb,_0x346ca7,_0x19050c),_0x19050c;},__metadata=this&&this[a90_0x552e3b(0x23b)]||function(_0x503cb2,_0xbdb3b5){const _0x80d846=a90_0x552e3b;if(typeof Reflect===_0x80d846(0x23e)&&typeof Reflect[_0x80d846(0x1fe)]==='function')return Reflect[_0x80d846(0x1fe)](_0x503cb2,_0xbdb3b5);},__param=this&&this[a90_0x552e3b(0x1ff)]||function(_0x502378,_0x259070){return function(_0x29de7e,_0x34c63b){_0x259070(_0x29de7e,_0x34c63b,_0x502378);};},PlaylistService_1;Object[a90_0x552e3b(0x20e)](exports,a90_0x552e3b(0x21c),{'value':!![]}),exports[a90_0x552e3b(0x238)]=void 0x0;const common_1=require(a90_0x552e3b(0x201)),mongoose_1=require(a90_0x552e3b(0x222)),mongoose_2=require(a90_0x552e3b(0x234)),event_emitter_1=require(a90_0x552e3b(0x231)),sound_service_1=require(a90_0x552e3b(0x1f6)),job_1=require(a90_0x552e3b(0x218)),events_1=require('../common/events'),agenda_service_1=require(a90_0x552e3b(0x1fd)),playlist_mapper_1=require('./mapper/playlist.mapper'),enums_1=require('../common/enums'),path=require(a90_0x552e3b(0x240)),path_1=require(a90_0x552e3b(0x241)),audio_player_1=require('../common/audio/audio-player'),sound_gateway_1=require(a90_0x552e3b(0x214));function a90_0x2681(_0x459e00,_0x5d1403){const _0x4c4b5b=a90_0x4c4b();return a90_0x2681=function(_0x2681cc,_0x37d04e){_0x2681cc=_0x2681cc-0x1e9;let _0x372b7f=_0x4c4b5b[_0x2681cc];return _0x372b7f;},a90_0x2681(_0x459e00,_0x5d1403);}let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x4069ac,_0xe6804c,_0x2d88ed,_0x5b197d){const _0x591cb3=a90_0x552e3b;this[_0x591cb3(0x22c)]=_0x4069ac,this[_0x591cb3(0x212)]=_0xe6804c,this[_0x591cb3(0x22d)]=_0x2d88ed,this[_0x591cb3(0x1ec)]=_0x5b197d,this[_0x591cb3(0x1ea)]=new common_1['Logger'](PlaylistService_1[_0x591cb3(0x1f1)]);}async[a90_0x552e3b(0x1f2)](_0xf5dcd7){const _0x23f06f=a90_0x552e3b,_0x352bd6=new this[(_0x23f06f(0x22c))](_0xf5dcd7);return _0x352bd6[_0x23f06f(0x215)]();}async[a90_0x552e3b(0x208)](){const _0x2f5c76=a90_0x552e3b,_0x409872=await this['playlistModel'][_0x2f5c76(0x23a)]()[_0x2f5c76(0x203)](),_0x26abe3=_0x409872[_0x2f5c76(0x1f9)](async _0x5371a4=>{const _0x1bfab3=_0x2f5c76,_0x562d3f=await this[_0x1bfab3(0x212)]['findByIds'](_0x5371a4[_0x1bfab3(0x23f)]);return(0x0,playlist_mapper_1[_0x1bfab3(0x1e9)])(_0x5371a4,_0x562d3f);});return await Promise[_0x2f5c76(0x21e)](_0x26abe3);}async[a90_0x552e3b(0x22e)](_0x822e3e){const _0x49fcc6=a90_0x552e3b,_0x37096d=await this[_0x49fcc6(0x22c)][_0x49fcc6(0x21a)](_0x822e3e),_0x4bb5a6=await this[_0x49fcc6(0x212)][_0x49fcc6(0x233)](_0x37096d[_0x49fcc6(0x23f)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x37096d,_0x4bb5a6);}async['update'](_0x1e54a8,_0x27333f){const _0x3ad25a=a90_0x552e3b,_0x80045b=await this['playlistModel'][_0x3ad25a(0x20b)](_0x1e54a8,Object[_0x3ad25a(0x220)](Object['assign']({},_0x27333f),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x177897=await this[_0x3ad25a(0x212)]['findByIds'](_0x80045b[_0x3ad25a(0x23f)]);return(0x0,playlist_mapper_1[_0x3ad25a(0x1e9)])(_0x80045b,_0x177897);}async[a90_0x552e3b(0x22a)](_0x334f4c){return await this['playlistModel']['findByIdAndDelete'](_0x334f4c);}async['addSong'](_0x2cae51,_0x9e7a5c){const _0x3575e5=a90_0x552e3b,_0x14c27d=await this['playlistModel'][_0x3575e5(0x21a)](_0x2cae51);return _0x14c27d[_0x3575e5(0x23f)]['push'](_0x9e7a5c),await _0x14c27d[_0x3575e5(0x215)]();}async[a90_0x552e3b(0x236)](_0x2797fa,_0x3cef83){const _0x4d1394=a90_0x552e3b,_0x2814e3=await this[_0x4d1394(0x22c)][_0x4d1394(0x21a)](_0x2797fa);return _0x2814e3[_0x4d1394(0x23f)]=_0x2814e3['soundIds'][_0x4d1394(0x21f)](_0x43d15b=>_0x43d15b!==_0x3cef83),await _0x2814e3[_0x4d1394(0x215)]();}async[a90_0x552e3b(0x227)](_0x35b075,_0x2b1be5){const _0x460e04=a90_0x552e3b,_0x58e84a={'when':_0x460e04(0x21d),'jobType':enums_1[_0x460e04(0x20d)][_0x460e04(0x230)],'attributes':{'playlistId':_0x2b1be5},'audit':{'actor':_0x35b075,'name':enums_1[_0x460e04(0x20d)]['PlayMusic'],'message':_0x460e04(0x226)+_0x2b1be5}},{jobId:_0x12e462}=await this[_0x460e04(0x22d)][_0x460e04(0x1ef)](_0x58e84a);return this[_0x460e04(0x224)](_0x2b1be5,{'jobId':_0x12e462});}async[a90_0x552e3b(0x1f8)](_0x57e407){const _0x28530b=a90_0x552e3b;let _0x53302c=await this[_0x28530b(0x22e)](_0x57e407);const {jobId:_0x344e74}=_0x53302c||{};if(_0x344e74){const {success:_0x184821}=await this[_0x28530b(0x22d)][_0x28530b(0x1f0)](_0x344e74);_0x184821&&(_0x53302c=await this[_0x28530b(0x224)](_0x57e407,{'jobId':null}));}return this[_0x28530b(0x1ec)][_0x28530b(0x1fc)]({'id':_0x53302c[_0x28530b(0x209)],'isPlaying':![]}),_0x53302c;}async['playFromEvent'](_0x5eb067){const _0x823df2=a90_0x552e3b,{playlistId:_0x456dc7,jobId:_0x2831ef,durationInSecond:_0x1df526}=_0x5eb067,_0x5e1e90=await this['playlistModel']['findById'](_0x456dc7),_0x3f692f=[..._0x5e1e90['soundIds']],_0x3faab8=await this[_0x823df2(0x212)][_0x823df2(0x233)](_0x3f692f),_0xf734ae=_0x3faab8['map'](_0x4ac699=>path[_0x823df2(0x221)](path_1[_0x823df2(0x225)],_0x823df2(0x20a),_0x823df2(0x204),_0x4ac699[_0x823df2(0x235)]));job_1[_0x823df2(0x207)][_0x823df2(0x211)](),this[_0x823df2(0x1ea)][_0x823df2(0x1f5)](_0x823df2(0x22b)+_0x456dc7+_0x823df2(0x1ed)+_0x5e1e90[_0x823df2(0x1f1)]),(0x0,job_1[_0x823df2(0x20c)])({'jobId':_0x2831ef,'run':()=>audio_player_1[_0x823df2(0x210)][_0x823df2(0x205)](_0xf734ae,0x32,_0x5e1e90['isShuffle']),'durationInSecond':_0x1df526,'next':()=>this['stop'](_0x456dc7)}),this[_0x823df2(0x1ec)][_0x823df2(0x1fc)]({'id':_0x456dc7,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1[a90_0x552e3b(0x237)])(events_1[a90_0x552e3b(0x223)][a90_0x552e3b(0x219)]),__metadata(a90_0x552e3b(0x22f),Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],PlaylistService[a90_0x552e3b(0x1ee)],a90_0x552e3b(0x228),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a90_0x552e3b(0x1f7)])(),__param(0x0,(0x0,mongoose_2['InjectModel'])(a90_0x552e3b(0x229))),__param(0x3,(0x0,common_1[a90_0x552e3b(0x23d)])(sound_gateway_1[a90_0x552e3b(0x1fb)])),__metadata('design:paramtypes',[mongoose_1[a90_0x552e3b(0x213)],sound_service_1['SoundService'],agenda_service_1['AgendaService'],sound_gateway_1['SoundGateway']])],PlaylistService),exports['PlaylistService']=PlaylistService;