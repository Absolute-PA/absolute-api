'use strict';const a90_0x4417ce=a90_0x2a54;(function(_0x22df95,_0x1f0b20){const _0x299f06=a90_0x2a54,_0x487dc2=_0x22df95();while(!![]){try{const _0x3f187b=-parseInt(_0x299f06(0x191))/0x1+parseInt(_0x299f06(0x1c3))/0x2+-parseInt(_0x299f06(0x1a7))/0x3*(-parseInt(_0x299f06(0x1c9))/0x4)+-parseInt(_0x299f06(0x1af))/0x5*(parseInt(_0x299f06(0x18a))/0x6)+-parseInt(_0x299f06(0x1ca))/0x7+parseInt(_0x299f06(0x1c7))/0x8*(-parseInt(_0x299f06(0x1a8))/0x9)+parseInt(_0x299f06(0x1ae))/0xa;if(_0x3f187b===_0x1f0b20)break;else _0x487dc2['push'](_0x487dc2['shift']());}catch(_0x356f09){_0x487dc2['push'](_0x487dc2['shift']());}}}(a90_0x3110,0x37005));var __decorate=this&&this[a90_0x4417ce(0x1a5)]||function(_0x432abc,_0x570b22,_0x3e8f2c,_0x594b64){const _0x362ede=a90_0x4417ce;var _0x1deb29=arguments['length'],_0x5ba0fd=_0x1deb29<0x3?_0x570b22:_0x594b64===null?_0x594b64=Object[_0x362ede(0x189)](_0x570b22,_0x3e8f2c):_0x594b64,_0x197da8;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x5ba0fd=Reflect[_0x362ede(0x1cf)](_0x432abc,_0x570b22,_0x3e8f2c,_0x594b64);else{for(var _0x4e7295=_0x432abc['length']-0x1;_0x4e7295>=0x0;_0x4e7295--)if(_0x197da8=_0x432abc[_0x4e7295])_0x5ba0fd=(_0x1deb29<0x3?_0x197da8(_0x5ba0fd):_0x1deb29>0x3?_0x197da8(_0x570b22,_0x3e8f2c,_0x5ba0fd):_0x197da8(_0x570b22,_0x3e8f2c))||_0x5ba0fd;}return _0x1deb29>0x3&&_0x5ba0fd&&Object[_0x362ede(0x184)](_0x570b22,_0x3e8f2c,_0x5ba0fd),_0x5ba0fd;},__metadata=this&&this['__metadata']||function(_0x41f0b2,_0x188acc){const _0x5d8b66=a90_0x4417ce;if(typeof Reflect==='object'&&typeof Reflect['metadata']==='function')return Reflect[_0x5d8b66(0x1a6)](_0x41f0b2,_0x188acc);},__param=this&&this[a90_0x4417ce(0x1b2)]||function(_0x45e48a,_0x77563){return function(_0x2f281a,_0x3620f7){_0x77563(_0x2f281a,_0x3620f7,_0x45e48a);};},PlaylistService_1;Object[a90_0x4417ce(0x184)](exports,'__esModule',{'value':!![]}),exports[a90_0x4417ce(0x1cb)]=void 0x0;function a90_0x3110(){const _0x38fb04=['Inject','JobType','join','playlistModel','create','171834NcMkoG','agendaService','PlaylistEvent','mapToDto','all','removeSong','findByIds','Model','../common/audio/audio-player','logger','AgendaService','push','cancelJob','PROCESS_CACHE','InjectModel','killAll','assign','PlayMusic','Playlist','@nestjs/event-emitter','__decorate','metadata','6OvRJig','394344ZLdgeb','play','name','now','design:type','find','401170mslrDG','46835VglERF','stop','assets','__param','update','@nestjs/mongoose','scheduleJob','design:paramtypes','../common/enums','soundIds','soundGateway','../agenda/agenda.service','path','audio','../sound/sound.service','\x20-\x20','Play\x20Music\x20Playlist:\x20','findById','soundService','OnEvent','782412PobJwO','SoundService','findOne','playFromEvent','8nIChQr','fileName','868828jqODxE','2908045PVYKnX','PlaylistService','Play','save','broadcastPlaying','decorate','../common/events','findByIdAndDelete','design:returntype','isShuffle','defineProperty','playAsync','SoundGateway','map','log','getOwnPropertyDescriptor','6hptGkD','../common/job'];a90_0x3110=function(){return _0x38fb04;};return a90_0x3110();}const common_1=require('@nestjs/common'),mongoose_1=require('mongoose'),mongoose_2=require(a90_0x4417ce(0x1b4)),event_emitter_1=require(a90_0x4417ce(0x1a4)),sound_service_1=require(a90_0x4417ce(0x1bd)),job_1=require(a90_0x4417ce(0x18b)),events_1=require(a90_0x4417ce(0x1d0)),agenda_service_1=require(a90_0x4417ce(0x1ba)),playlist_mapper_1=require('./mapper/playlist.mapper'),enums_1=require(a90_0x4417ce(0x1b7)),path=require(a90_0x4417ce(0x1bb)),path_1=require('../common/path'),audio_player_1=require(a90_0x4417ce(0x199)),sound_gateway_1=require('../sound/sound.gateway');let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x4602cc,_0x485090,_0x2f1816,_0x204dc6){const _0x393e86=a90_0x4417ce;this[_0x393e86(0x18f)]=_0x4602cc,this[_0x393e86(0x1c1)]=_0x485090,this[_0x393e86(0x192)]=_0x2f1816,this[_0x393e86(0x1b9)]=_0x204dc6,this[_0x393e86(0x19a)]=new common_1['Logger'](PlaylistService_1['name']);}async[a90_0x4417ce(0x190)](_0x5ba5f2){const _0x186a2f=a90_0x4417ce,_0x428b46=new this['playlistModel'](_0x5ba5f2);return _0x428b46[_0x186a2f(0x1cd)]();}async['findAll'](){const _0x2b6ac5=a90_0x4417ce,_0x5d81cf=await this[_0x2b6ac5(0x18f)][_0x2b6ac5(0x1ad)]()['exec'](),_0x5b4735=_0x5d81cf[_0x2b6ac5(0x187)](async _0xc0ffe2=>{const _0x3e23b2=_0x2b6ac5,_0x12c0d2=await this[_0x3e23b2(0x1c1)]['findByIds'](_0xc0ffe2['soundIds']);return(0x0,playlist_mapper_1[_0x3e23b2(0x194)])(_0xc0ffe2,_0x12c0d2);});return await Promise[_0x2b6ac5(0x195)](_0x5b4735);}async[a90_0x4417ce(0x1c5)](_0x3bd5f5){const _0x300c15=a90_0x4417ce,_0x189873=await this[_0x300c15(0x18f)][_0x300c15(0x1c0)](_0x3bd5f5),_0x3131e6=await this[_0x300c15(0x1c1)][_0x300c15(0x197)](_0x189873[_0x300c15(0x1b8)]);return(0x0,playlist_mapper_1[_0x300c15(0x194)])(_0x189873,_0x3131e6);}async[a90_0x4417ce(0x1b3)](_0x93292b,_0x4bd1f2){const _0x3dd23d=a90_0x4417ce,_0x47e99f=await this['playlistModel']['findByIdAndUpdate'](_0x93292b,Object['assign'](Object[_0x3dd23d(0x1a1)]({},_0x4bd1f2),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x19dd16=await this['soundService'][_0x3dd23d(0x197)](_0x47e99f[_0x3dd23d(0x1b8)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x47e99f,_0x19dd16);}async['delete'](_0x475b5d){const _0x54bbf8=a90_0x4417ce;return await this[_0x54bbf8(0x18f)][_0x54bbf8(0x1d1)](_0x475b5d);}async['addSong'](_0x464636,_0xedb1de){const _0x4fe340=a90_0x4417ce,_0x32a2f2=await this[_0x4fe340(0x18f)]['findById'](_0x464636);return _0x32a2f2[_0x4fe340(0x1b8)][_0x4fe340(0x19c)](_0xedb1de),await _0x32a2f2[_0x4fe340(0x1cd)]();}async[a90_0x4417ce(0x196)](_0x418ead,_0x22ef5b){const _0x333063=a90_0x4417ce,_0x35bb58=await this[_0x333063(0x18f)][_0x333063(0x1c0)](_0x418ead);return _0x35bb58[_0x333063(0x1b8)]=_0x35bb58['soundIds']['filter'](_0x1d2e3d=>_0x1d2e3d!==_0x22ef5b),await _0x35bb58['save']();}async[a90_0x4417ce(0x1a9)](_0x2436ed,_0x56bd6e){const _0x3c1f9c=a90_0x4417ce,_0x2e15c8={'when':_0x3c1f9c(0x1ab),'jobType':enums_1[_0x3c1f9c(0x18d)][_0x3c1f9c(0x1a2)],'attributes':{'playlistId':_0x56bd6e},'audit':{'actor':_0x2436ed,'name':enums_1['JobType'][_0x3c1f9c(0x1a2)],'message':_0x3c1f9c(0x1bf)+_0x56bd6e}},{jobId:_0x8d1c7b}=await this[_0x3c1f9c(0x192)][_0x3c1f9c(0x1b5)](_0x2e15c8);return this[_0x3c1f9c(0x1b3)](_0x56bd6e,{'jobId':_0x8d1c7b});}async[a90_0x4417ce(0x1b0)](_0x3c3488){const _0x1dedba=a90_0x4417ce;let _0x36788a=await this['findOne'](_0x3c3488);const {jobId:_0x586214}=_0x36788a||{};if(_0x586214){const {success:_0x4905e5}=await this['agendaService'][_0x1dedba(0x19d)](_0x586214);_0x4905e5&&(_0x36788a=await this[_0x1dedba(0x1b3)](_0x3c3488,{'jobId':null}));}return this[_0x1dedba(0x1b9)][_0x1dedba(0x1ce)]({'id':_0x36788a['_id'],'isPlaying':![]}),_0x36788a;}async[a90_0x4417ce(0x1c6)](_0x5d583b){const _0x1985ce=a90_0x4417ce,{playlistId:_0x3ec8af,jobId:_0x123217,durationInSecond:_0x1e8aa5}=_0x5d583b,_0x316c29=await this[_0x1985ce(0x18f)][_0x1985ce(0x1c0)](_0x3ec8af),_0x133b96=[..._0x316c29[_0x1985ce(0x1b8)]],_0x4dfef8=await this[_0x1985ce(0x1c1)][_0x1985ce(0x197)](_0x133b96),_0x39e3b0=_0x4dfef8[_0x1985ce(0x187)](_0x430973=>path[_0x1985ce(0x18e)](path_1['processRootPath'],_0x1985ce(0x1b1),_0x1985ce(0x1bc),_0x430973[_0x1985ce(0x1c8)]));job_1[_0x1985ce(0x19e)][_0x1985ce(0x1a0)](),this[_0x1985ce(0x19a)][_0x1985ce(0x188)]('Playing\x20playlist:\x20'+_0x3ec8af+_0x1985ce(0x1be)+_0x316c29[_0x1985ce(0x1aa)]),(0x0,job_1['executeJob'])({'jobId':_0x123217,'run':()=>audio_player_1['AudioPlayer'][_0x1985ce(0x185)](_0x39e3b0,0x32,_0x316c29[_0x1985ce(0x183)]),'durationInSecond':_0x1e8aa5,'next':()=>this[_0x1985ce(0x1b0)](_0x3ec8af)}),this[_0x1985ce(0x1b9)]['broadcastPlaying']({'id':_0x3ec8af,'isPlaying':!![]});}};function a90_0x2a54(_0x464270,_0x5ec38c){const _0x311065=a90_0x3110();return a90_0x2a54=function(_0x2a549e,_0x26d5d2){_0x2a549e=_0x2a549e-0x183;let _0x23500a=_0x311065[_0x2a549e];return _0x23500a;},a90_0x2a54(_0x464270,_0x5ec38c);}__decorate([(0x0,event_emitter_1[a90_0x4417ce(0x1c2)])(events_1[a90_0x4417ce(0x193)][a90_0x4417ce(0x1cc)]),__metadata(a90_0x4417ce(0x1ac),Function),__metadata(a90_0x4417ce(0x1b6),[Object]),__metadata(a90_0x4417ce(0x1d2),Promise)],PlaylistService['prototype'],a90_0x4417ce(0x1c6),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_2[a90_0x4417ce(0x19f)])(a90_0x4417ce(0x1a3))),__param(0x3,(0x0,common_1[a90_0x4417ce(0x18c)])(sound_gateway_1[a90_0x4417ce(0x186)])),__metadata('design:paramtypes',[mongoose_1[a90_0x4417ce(0x198)],sound_service_1[a90_0x4417ce(0x1c4)],agenda_service_1[a90_0x4417ce(0x19b)],sound_gateway_1[a90_0x4417ce(0x186)]])],PlaylistService),exports[a90_0x4417ce(0x1cb)]=PlaylistService;