'use strict';const a87_0x59c01d=a87_0x3a16;function a87_0x3a16(_0x397b8a,_0x1d01da){const _0x5bf2a2=a87_0x5bf2();return a87_0x3a16=function(_0x3a160c,_0x4745e1){_0x3a160c=_0x3a160c-0xd4;let _0x38e1ec=_0x5bf2a2[_0x3a160c];return _0x38e1ec;},a87_0x3a16(_0x397b8a,_0x1d01da);}function a87_0x5bf2(){const _0x50d124=['../common/enums','PlaylistService','save','16YrcDEj','Logger','SoundService','findByIds','addSong','now','3468570tqMHix','./mapper/playlist.mapper','AudioPlayer','2749320VHjmiF','213345lcOnrY','526607uMCcDg','playlistModel','map','PlaylistEvent','mongoose','agendaService','create','JobType','154449xvsjhs','playFromEvent','design:returntype','executeJob','mapToDto','Inject','\x20-\x20','find','@nestjs/mongoose','@nestjs/common','findByIdAndDelete','../sound/sound.gateway','removeSong','1188678MzaVkc','push','all','killAll','_id','../agenda/agenda.service','scheduleJob','function','defineProperty','cancelJob','Play\x20Music\x20Playlist:\x20','object','play','name','getOwnPropertyDescriptor','PlayMusic','Model','__esModule','filter','metadata','stop','__param','findAll','update','soundService','__metadata','assign','findByIdAndUpdate','prototype','Playlist','6111368VbHzna','../common/path','../common/job','SoundGateway','design:type','length','__decorate','findById','soundIds','audio','broadcastPlaying','design:paramtypes','exec','soundGateway','playAsync','join','../sound/sound.service'];a87_0x5bf2=function(){return _0x50d124;};return a87_0x5bf2();}(function(_0x2282de,_0x2f21ee){const _0x574aa9=a87_0x3a16,_0x51de8a=_0x2282de();while(!![]){try{const _0x14e5aa=parseInt(_0x574aa9(0x100))/0x1+-parseInt(_0x574aa9(0x115))/0x2+parseInt(_0x574aa9(0x108))/0x3+-parseInt(_0x574aa9(0xf5))/0x4*(-parseInt(_0x574aa9(0xff))/0x5)+parseInt(_0x574aa9(0xfb))/0x6+parseInt(_0x574aa9(0xfe))/0x7+-parseInt(_0x574aa9(0xe1))/0x8;if(_0x14e5aa===_0x2f21ee)break;else _0x51de8a['push'](_0x51de8a['shift']());}catch(_0x1f19c2){_0x51de8a['push'](_0x51de8a['shift']());}}}(a87_0x5bf2,0x58391));var __decorate=this&&this[a87_0x59c01d(0xe7)]||function(_0x41992b,_0x290724,_0x5302b9,_0x499948){const _0x55d47c=a87_0x59c01d;var _0x1ba27c=arguments[_0x55d47c(0xe6)],_0x1bf84e=_0x1ba27c<0x3?_0x290724:_0x499948===null?_0x499948=Object[_0x55d47c(0x123)](_0x290724,_0x5302b9):_0x499948,_0x490546;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x55d47c(0x11c))_0x1bf84e=Reflect['decorate'](_0x41992b,_0x290724,_0x5302b9,_0x499948);else{for(var _0x507d85=_0x41992b[_0x55d47c(0xe6)]-0x1;_0x507d85>=0x0;_0x507d85--)if(_0x490546=_0x41992b[_0x507d85])_0x1bf84e=(_0x1ba27c<0x3?_0x490546(_0x1bf84e):_0x1ba27c>0x3?_0x490546(_0x290724,_0x5302b9,_0x1bf84e):_0x490546(_0x290724,_0x5302b9))||_0x1bf84e;}return _0x1ba27c>0x3&&_0x1bf84e&&Object[_0x55d47c(0x11d)](_0x290724,_0x5302b9,_0x1bf84e),_0x1bf84e;},__metadata=this&&this[a87_0x59c01d(0xdc)]||function(_0x71fff1,_0x2cf322){const _0x509d54=a87_0x59c01d;if(typeof Reflect===_0x509d54(0x120)&&typeof Reflect['metadata']===_0x509d54(0x11c))return Reflect[_0x509d54(0xd6)](_0x71fff1,_0x2cf322);},__param=this&&this[a87_0x59c01d(0xd8)]||function(_0x472bbe,_0x164270){return function(_0x728c31,_0x14e2aa){_0x164270(_0x728c31,_0x14e2aa,_0x472bbe);};},PlaylistService_1;Object[a87_0x59c01d(0x11d)](exports,a87_0x59c01d(0xd4),{'value':!![]}),exports['PlaylistService']=void 0x0;const common_1=require(a87_0x59c01d(0x111)),mongoose_1=require(a87_0x59c01d(0x104)),mongoose_2=require(a87_0x59c01d(0x110)),event_emitter_1=require('@nestjs/event-emitter'),sound_service_1=require(a87_0x59c01d(0xf1)),job_1=require(a87_0x59c01d(0xe3)),events_1=require('../common/events'),agenda_service_1=require(a87_0x59c01d(0x11a)),playlist_mapper_1=require(a87_0x59c01d(0xfc)),enums_1=require(a87_0x59c01d(0xf2)),path=require('path'),path_1=require(a87_0x59c01d(0xe2)),audio_player_1=require('../common/audio/audio-player'),sound_gateway_1=require(a87_0x59c01d(0x113));let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x48c449,_0x4c64a1,_0x46e949,_0x26832a){const _0x5326b1=a87_0x59c01d;this['playlistModel']=_0x48c449,this[_0x5326b1(0xdb)]=_0x4c64a1,this['agendaService']=_0x46e949,this[_0x5326b1(0xee)]=_0x26832a,this['logger']=new common_1[(_0x5326b1(0xf6))](PlaylistService_1[_0x5326b1(0x122)]);}async[a87_0x59c01d(0x106)](_0x3c1b16){const _0x1a6c13=a87_0x59c01d,_0x2e8000=new this['playlistModel'](_0x3c1b16);return _0x2e8000[_0x1a6c13(0xf4)]();}async[a87_0x59c01d(0xd9)](){const _0x117503=a87_0x59c01d,_0x3c8efc=await this[_0x117503(0x101)][_0x117503(0x10f)]()[_0x117503(0xed)](),_0x5b9784=_0x3c8efc[_0x117503(0x102)](async _0x1013b9=>{const _0x401e98=_0x117503,_0x43b17=await this[_0x401e98(0xdb)][_0x401e98(0xf8)](_0x1013b9['soundIds']);return(0x0,playlist_mapper_1[_0x401e98(0x10c)])(_0x1013b9,_0x43b17);});return await Promise[_0x117503(0x117)](_0x5b9784);}async['findOne'](_0x89f141){const _0x5cb75f=a87_0x59c01d,_0x290258=await this[_0x5cb75f(0x101)][_0x5cb75f(0xe8)](_0x89f141),_0x5492a1=await this[_0x5cb75f(0xdb)]['findByIds'](_0x290258[_0x5cb75f(0xe9)]);return(0x0,playlist_mapper_1[_0x5cb75f(0x10c)])(_0x290258,_0x5492a1);}async['update'](_0x2179aa,_0x3722ec){const _0x35e7dd=a87_0x59c01d,_0x278e20=await this[_0x35e7dd(0x101)][_0x35e7dd(0xde)](_0x2179aa,Object[_0x35e7dd(0xdd)](Object['assign']({},_0x3722ec),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x18dcce=await this[_0x35e7dd(0xdb)][_0x35e7dd(0xf8)](_0x278e20[_0x35e7dd(0xe9)]);return(0x0,playlist_mapper_1[_0x35e7dd(0x10c)])(_0x278e20,_0x18dcce);}async['delete'](_0x33d62d){const _0x44fcf0=a87_0x59c01d;return await this[_0x44fcf0(0x101)][_0x44fcf0(0x112)](_0x33d62d);}async[a87_0x59c01d(0xf9)](_0x1334da,_0x48617e){const _0x3241b4=a87_0x59c01d,_0x5269ba=await this['playlistModel'][_0x3241b4(0xe8)](_0x1334da);return _0x5269ba[_0x3241b4(0xe9)][_0x3241b4(0x116)](_0x48617e),await _0x5269ba[_0x3241b4(0xf4)]();}async[a87_0x59c01d(0x114)](_0x5308ee,_0x348801){const _0x5a12c9=a87_0x59c01d,_0x4baabc=await this[_0x5a12c9(0x101)][_0x5a12c9(0xe8)](_0x5308ee);return _0x4baabc[_0x5a12c9(0xe9)]=_0x4baabc['soundIds'][_0x5a12c9(0xd5)](_0x205faa=>_0x205faa!==_0x348801),await _0x4baabc['save']();}async[a87_0x59c01d(0x121)](_0xc4328,_0x15c462){const _0x7c31c3=a87_0x59c01d,_0x4a6c58={'when':_0x7c31c3(0xfa),'jobType':enums_1['JobType'][_0x7c31c3(0x124)],'attributes':{'playlistId':_0x15c462},'audit':{'actor':_0xc4328,'name':enums_1[_0x7c31c3(0x107)][_0x7c31c3(0x124)],'message':_0x7c31c3(0x11f)+_0x15c462}},{jobId:_0x3336d3}=await this[_0x7c31c3(0x105)][_0x7c31c3(0x11b)](_0x4a6c58);return this[_0x7c31c3(0xda)](_0x15c462,{'jobId':_0x3336d3});}async[a87_0x59c01d(0xd7)](_0xc9292c){const _0x3ac961=a87_0x59c01d;let _0x5ddff1=await this['findOne'](_0xc9292c);const {jobId:_0x36b621}=_0x5ddff1||{};if(_0x36b621){const {success:_0x322b81}=await this['agendaService'][_0x3ac961(0x11e)](_0x36b621);_0x322b81&&(_0x5ddff1=await this[_0x3ac961(0xda)](_0xc9292c,{'jobId':null}));}return this[_0x3ac961(0xee)][_0x3ac961(0xeb)]({'id':_0x5ddff1[_0x3ac961(0x119)],'isPlaying':![]}),_0x5ddff1;}async[a87_0x59c01d(0x109)](_0x4a7289){const _0x32afe5=a87_0x59c01d,{playlistId:_0x8c486e,jobId:_0x3adf81,durationInSecond:_0x310b33}=_0x4a7289,_0x390ad7=await this[_0x32afe5(0x101)][_0x32afe5(0xe8)](_0x8c486e),_0x55c436=[..._0x390ad7['soundIds']],_0x21b6a2=await this[_0x32afe5(0xdb)][_0x32afe5(0xf8)](_0x55c436),_0x1ff8c8=_0x21b6a2[_0x32afe5(0x102)](_0x567aa9=>path[_0x32afe5(0xf0)](path_1['processRootPath'],'assets',_0x32afe5(0xea),_0x567aa9['fileName']));job_1['PROCESS_CACHE'][_0x32afe5(0x118)](),this['logger']['log']('Playing\x20playlist:\x20'+_0x8c486e+_0x32afe5(0x10e)+_0x390ad7[_0x32afe5(0x122)]),(0x0,job_1[_0x32afe5(0x10b)])({'jobId':_0x3adf81,'run':()=>audio_player_1[_0x32afe5(0xfd)][_0x32afe5(0xef)](_0x1ff8c8,0x32,_0x390ad7['isShuffle']),'durationInSecond':_0x310b33,'next':()=>this[_0x32afe5(0xd7)](_0x8c486e)}),this[_0x32afe5(0xee)][_0x32afe5(0xeb)]({'id':_0x8c486e,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1['OnEvent'])(events_1[a87_0x59c01d(0x103)]['Play']),__metadata(a87_0x59c01d(0xe5),Function),__metadata(a87_0x59c01d(0xec),[Object]),__metadata(a87_0x59c01d(0x10a),Promise)],PlaylistService[a87_0x59c01d(0xdf)],a87_0x59c01d(0x109),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_2['InjectModel'])(a87_0x59c01d(0xe0))),__param(0x3,(0x0,common_1[a87_0x59c01d(0x10d)])(sound_gateway_1[a87_0x59c01d(0xe4)])),__metadata(a87_0x59c01d(0xec),[mongoose_1[a87_0x59c01d(0x125)],sound_service_1[a87_0x59c01d(0xf7)],agenda_service_1['AgendaService'],sound_gateway_1[a87_0x59c01d(0xe4)]])],PlaylistService),exports[a87_0x59c01d(0xf3)]=PlaylistService;