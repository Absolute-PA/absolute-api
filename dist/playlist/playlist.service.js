'use strict';const a87_0x462985=a87_0x5d40;(function(_0x4c269d,_0x42cc53){const _0x4409b1=a87_0x5d40,_0x4da0c0=_0x4c269d();while(!![]){try{const _0x54b3ab=-parseInt(_0x4409b1(0x17e))/0x1+parseInt(_0x4409b1(0x16f))/0x2*(-parseInt(_0x4409b1(0x196))/0x3)+-parseInt(_0x4409b1(0x190))/0x4*(-parseInt(_0x4409b1(0x179))/0x5)+parseInt(_0x4409b1(0x18f))/0x6*(-parseInt(_0x4409b1(0x16c))/0x7)+parseInt(_0x4409b1(0x148))/0x8+parseInt(_0x4409b1(0x193))/0x9*(-parseInt(_0x4409b1(0x174))/0xa)+-parseInt(_0x4409b1(0x169))/0xb*(-parseInt(_0x4409b1(0x168))/0xc);if(_0x54b3ab===_0x42cc53)break;else _0x4da0c0['push'](_0x4da0c0['shift']());}catch(_0x32017d){_0x4da0c0['push'](_0x4da0c0['shift']());}}}(a87_0x2461,0xbdaec));var __decorate=this&&this['__decorate']||function(_0x1948da,_0x592570,_0x30bc0b,_0x395b88){const _0x5cc560=a87_0x5d40;var _0x4053f6=arguments[_0x5cc560(0x15a)],_0x398641=_0x4053f6<0x3?_0x592570:_0x395b88===null?_0x395b88=Object[_0x5cc560(0x17d)](_0x592570,_0x30bc0b):_0x395b88,_0x393c84;if(typeof Reflect===_0x5cc560(0x192)&&typeof Reflect[_0x5cc560(0x150)]===_0x5cc560(0x167))_0x398641=Reflect['decorate'](_0x1948da,_0x592570,_0x30bc0b,_0x395b88);else{for(var _0x17ef54=_0x1948da[_0x5cc560(0x15a)]-0x1;_0x17ef54>=0x0;_0x17ef54--)if(_0x393c84=_0x1948da[_0x17ef54])_0x398641=(_0x4053f6<0x3?_0x393c84(_0x398641):_0x4053f6>0x3?_0x393c84(_0x592570,_0x30bc0b,_0x398641):_0x393c84(_0x592570,_0x30bc0b))||_0x398641;}return _0x4053f6>0x3&&_0x398641&&Object[_0x5cc560(0x17c)](_0x592570,_0x30bc0b,_0x398641),_0x398641;},__metadata=this&&this[a87_0x462985(0x177)]||function(_0x157348,_0x202fcc){const _0x19d7b5=a87_0x462985;if(typeof Reflect===_0x19d7b5(0x192)&&typeof Reflect[_0x19d7b5(0x181)]==='function')return Reflect[_0x19d7b5(0x181)](_0x157348,_0x202fcc);},__param=this&&this[a87_0x462985(0x18a)]||function(_0x2b6ed5,_0x3ab4f2){return function(_0x5d7a1b,_0x1c23a0){_0x3ab4f2(_0x5d7a1b,_0x1c23a0,_0x2b6ed5);};},PlaylistService_1;Object[a87_0x462985(0x17c)](exports,a87_0x462985(0x191),{'value':!![]}),exports[a87_0x462985(0x152)]=void 0x0;function a87_0x5d40(_0xa8203f,_0xce034b){const _0x2461d8=a87_0x2461();return a87_0x5d40=function(_0x5d40e8,_0x35adb7){_0x5d40e8=_0x5d40e8-0x143;let _0x2d4519=_0x2461d8[_0x5d40e8];return _0x2d4519;},a87_0x5d40(_0xa8203f,_0xce034b);}function a87_0x2461(){const _0x2827a3=['4oQvpLC','__esModule','object','232137JmYIUn','SoundGateway','OnEvent','57uCsZAH','play','./mapper/playlist.mapper','PlayMusic','Injectable','AgendaService','../common/enums','4626296PnaNGi','playFromEvent','findAll','filter','map','update','soundGateway','../common/path','decorate','../sound/sound.gateway','PlaylistService','scheduleJob','create','broadcastPlaying','cancelJob','prototype','mongoose','../common/audio/audio-player','length','findByIdAndUpdate','Playlist','processRootPath','audio','assign','exec','Playing\x20playlist:\x20','JobType','PROCESS_CACHE','design:paramtypes','removeSong','soundIds','function','2436wLTfgG','53383GZtNfg','assets','executeJob','3524647YovXzl','agendaService','Model','15398wPXHuz','logger','findByIds','playlistModel','findOne','120mLgzBP','AudioPlayer','@nestjs/mongoose','__metadata','design:type','4636385mJYgiW','Play','save','defineProperty','getOwnPropertyDescriptor','754465lIQNmF','Inject','push','metadata','name','soundService','@nestjs/event-emitter','../common/job','isShuffle','Play\x20Music\x20Playlist:\x20','findById','_id','__param','now','find','@nestjs/common','PlaylistEvent','6khAZmG'];a87_0x2461=function(){return _0x2827a3;};return a87_0x2461();}const common_1=require(a87_0x462985(0x18d)),mongoose_1=require(a87_0x462985(0x158)),mongoose_2=require(a87_0x462985(0x176)),event_emitter_1=require(a87_0x462985(0x184)),sound_service_1=require('../sound/sound.service'),job_1=require(a87_0x462985(0x185)),events_1=require('../common/events'),agenda_service_1=require('../agenda/agenda.service'),playlist_mapper_1=require(a87_0x462985(0x143)),enums_1=require(a87_0x462985(0x147)),path=require('path'),path_1=require(a87_0x462985(0x14f)),audio_player_1=require(a87_0x462985(0x159)),sound_gateway_1=require(a87_0x462985(0x151));let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0xe87539,_0xa5994b,_0x182d6b,_0x465be3){const _0x52fe98=a87_0x462985;this[_0x52fe98(0x172)]=_0xe87539,this[_0x52fe98(0x183)]=_0xa5994b,this[_0x52fe98(0x16d)]=_0x182d6b,this[_0x52fe98(0x14e)]=_0x465be3,this['logger']=new common_1['Logger'](PlaylistService_1[_0x52fe98(0x182)]);}async[a87_0x462985(0x154)](_0x5acbe2){const _0x16ed5c=new this['playlistModel'](_0x5acbe2);return _0x16ed5c['save']();}async[a87_0x462985(0x14a)](){const _0x457688=a87_0x462985,_0x39161f=await this[_0x457688(0x172)][_0x457688(0x18c)]()[_0x457688(0x160)](),_0x462ee5=_0x39161f[_0x457688(0x14c)](async _0x2a41ba=>{const _0x12bd17=_0x457688,_0x502183=await this['soundService']['findByIds'](_0x2a41ba[_0x12bd17(0x166)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x2a41ba,_0x502183);});return await Promise['all'](_0x462ee5);}async[a87_0x462985(0x173)](_0x221172){const _0x511c48=a87_0x462985,_0xee26b1=await this['playlistModel']['findById'](_0x221172),_0x40b6d4=await this[_0x511c48(0x183)][_0x511c48(0x171)](_0xee26b1['soundIds']);return(0x0,playlist_mapper_1['mapToDto'])(_0xee26b1,_0x40b6d4);}async['update'](_0x223bbc,_0xb6dcf4){const _0xc5e2de=a87_0x462985,_0x312c64=await this[_0xc5e2de(0x172)][_0xc5e2de(0x15b)](_0x223bbc,Object[_0xc5e2de(0x15f)](Object['assign']({},_0xb6dcf4),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x16ec07=await this[_0xc5e2de(0x183)][_0xc5e2de(0x171)](_0x312c64['soundIds']);return(0x0,playlist_mapper_1['mapToDto'])(_0x312c64,_0x16ec07);}async['delete'](_0x46acf1){return await this['playlistModel']['findByIdAndDelete'](_0x46acf1);}async['addSong'](_0x2a81a2,_0x137c3d){const _0x1c759b=a87_0x462985,_0x26a844=await this['playlistModel'][_0x1c759b(0x188)](_0x2a81a2);return _0x26a844[_0x1c759b(0x166)][_0x1c759b(0x180)](_0x137c3d),await _0x26a844[_0x1c759b(0x17b)]();}async[a87_0x462985(0x165)](_0x455d76,_0xcfb936){const _0xfe189c=a87_0x462985,_0x3c4d6a=await this[_0xfe189c(0x172)]['findById'](_0x455d76);return _0x3c4d6a[_0xfe189c(0x166)]=_0x3c4d6a[_0xfe189c(0x166)][_0xfe189c(0x14b)](_0x430aa2=>_0x430aa2!==_0xcfb936),await _0x3c4d6a[_0xfe189c(0x17b)]();}async[a87_0x462985(0x197)](_0x12f5b0,_0x24e1c8){const _0x108744=a87_0x462985,_0x3a924e={'when':_0x108744(0x18b),'jobType':enums_1[_0x108744(0x162)][_0x108744(0x144)],'attributes':{'playlistId':_0x24e1c8},'audit':{'actor':_0x12f5b0,'name':enums_1[_0x108744(0x162)][_0x108744(0x144)],'message':_0x108744(0x187)+_0x24e1c8}},{jobId:_0x52d025}=await this['agendaService'][_0x108744(0x153)](_0x3a924e);return this[_0x108744(0x14d)](_0x24e1c8,{'jobId':_0x52d025});}async['stop'](_0x31505c){const _0x5ac91f=a87_0x462985;let _0x577f10=await this['findOne'](_0x31505c);const {jobId:_0x349a24}=_0x577f10||{};if(_0x349a24){const {success:_0x2d7847}=await this['agendaService'][_0x5ac91f(0x156)](_0x349a24);_0x2d7847&&(_0x577f10=await this['update'](_0x31505c,{'jobId':null}));}return this[_0x5ac91f(0x14e)][_0x5ac91f(0x155)]({'id':_0x577f10[_0x5ac91f(0x189)],'isPlaying':![]}),_0x577f10;}async[a87_0x462985(0x149)](_0x33c011){const _0x2a0fb7=a87_0x462985,{playlistId:_0x114354,jobId:_0x5835ad,durationInSecond:_0xc1a416}=_0x33c011,_0x225260=await this[_0x2a0fb7(0x172)][_0x2a0fb7(0x188)](_0x114354),_0x12bab5=[..._0x225260['soundIds']],_0x15dca3=await this['soundService'][_0x2a0fb7(0x171)](_0x12bab5),_0x1b0976=_0x15dca3[_0x2a0fb7(0x14c)](_0x1f5ccf=>path['join'](path_1[_0x2a0fb7(0x15d)],_0x2a0fb7(0x16a),_0x2a0fb7(0x15e),_0x1f5ccf['fileName']));job_1[_0x2a0fb7(0x163)]['killAll'](),this[_0x2a0fb7(0x170)]['log'](_0x2a0fb7(0x161)+_0x114354+'\x20-\x20'+_0x225260[_0x2a0fb7(0x182)]),(0x0,job_1[_0x2a0fb7(0x16b)])({'jobId':_0x5835ad,'run':()=>audio_player_1[_0x2a0fb7(0x175)]['playAsync'](_0x1b0976,0x32,_0x225260[_0x2a0fb7(0x186)]),'durationInSecond':_0xc1a416,'next':()=>this['stop'](_0x114354)}),this[_0x2a0fb7(0x14e)][_0x2a0fb7(0x155)]({'id':_0x114354,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1[a87_0x462985(0x195)])(events_1[a87_0x462985(0x18e)][a87_0x462985(0x17a)]),__metadata(a87_0x462985(0x178),Function),__metadata(a87_0x462985(0x164),[Object]),__metadata('design:returntype',Promise)],PlaylistService[a87_0x462985(0x157)],'playFromEvent',null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a87_0x462985(0x145)])(),__param(0x0,(0x0,mongoose_2['InjectModel'])(a87_0x462985(0x15c))),__param(0x3,(0x0,common_1[a87_0x462985(0x17f)])(sound_gateway_1['SoundGateway'])),__metadata(a87_0x462985(0x164),[mongoose_1[a87_0x462985(0x16e)],sound_service_1['SoundService'],agenda_service_1[a87_0x462985(0x146)],sound_gateway_1[a87_0x462985(0x194)]])],PlaylistService),exports[a87_0x462985(0x152)]=PlaylistService;