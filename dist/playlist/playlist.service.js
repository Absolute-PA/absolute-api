'use strict';const a90_0x303c48=a90_0x3e99;(function(_0x225aff,_0x30ac5b){const _0x411f58=a90_0x3e99,_0x492dcd=_0x225aff();while(!![]){try{const _0x238ff7=-parseInt(_0x411f58(0x161))/0x1+parseInt(_0x411f58(0x163))/0x2+-parseInt(_0x411f58(0x198))/0x3*(parseInt(_0x411f58(0x154))/0x4)+-parseInt(_0x411f58(0x172))/0x5+parseInt(_0x411f58(0x183))/0x6*(-parseInt(_0x411f58(0x153))/0x7)+parseInt(_0x411f58(0x173))/0x8*(-parseInt(_0x411f58(0x156))/0x9)+parseInt(_0x411f58(0x19c))/0xa;if(_0x238ff7===_0x30ac5b)break;else _0x492dcd['push'](_0x492dcd['shift']());}catch(_0x4e0d4a){_0x492dcd['push'](_0x492dcd['shift']());}}}(a90_0x2d3e,0x94f58));var __decorate=this&&this[a90_0x303c48(0x18d)]||function(_0x1425d7,_0x4ceb6d,_0x47321f,_0x2cdd10){const _0x2fe619=a90_0x303c48;var _0x17c271=arguments[_0x2fe619(0x1a1)],_0x22e56e=_0x17c271<0x3?_0x4ceb6d:_0x2cdd10===null?_0x2cdd10=Object[_0x2fe619(0x158)](_0x4ceb6d,_0x47321f):_0x2cdd10,_0x42bd22;if(typeof Reflect==='object'&&typeof Reflect[_0x2fe619(0x191)]===_0x2fe619(0x17e))_0x22e56e=Reflect[_0x2fe619(0x191)](_0x1425d7,_0x4ceb6d,_0x47321f,_0x2cdd10);else{for(var _0x497713=_0x1425d7['length']-0x1;_0x497713>=0x0;_0x497713--)if(_0x42bd22=_0x1425d7[_0x497713])_0x22e56e=(_0x17c271<0x3?_0x42bd22(_0x22e56e):_0x17c271>0x3?_0x42bd22(_0x4ceb6d,_0x47321f,_0x22e56e):_0x42bd22(_0x4ceb6d,_0x47321f))||_0x22e56e;}return _0x17c271>0x3&&_0x22e56e&&Object[_0x2fe619(0x15a)](_0x4ceb6d,_0x47321f,_0x22e56e),_0x22e56e;},__metadata=this&&this[a90_0x303c48(0x16c)]||function(_0x1d6912,_0x39c70e){const _0x4e6e53=a90_0x303c48;if(typeof Reflect==='object'&&typeof Reflect[_0x4e6e53(0x189)]===_0x4e6e53(0x17e))return Reflect['metadata'](_0x1d6912,_0x39c70e);},__param=this&&this[a90_0x303c48(0x165)]||function(_0x37b274,_0x1a9fb6){return function(_0x2c2d5c,_0x17ccdf){_0x1a9fb6(_0x2c2d5c,_0x17ccdf,_0x37b274);};},PlaylistService_1;Object[a90_0x303c48(0x15a)](exports,a90_0x303c48(0x193),{'value':!![]}),exports[a90_0x303c48(0x186)]=void 0x0;function a90_0x2d3e(){const _0x9aa177=['cancelJob','AudioPlayer','AgendaService','@nestjs/event-emitter','playlistModel','809070VJHMJz','../common/job','74174GhiGrj','stop','__param','findOne','\x20-\x20','assign','../common/events','PlayMusic','SoundGateway','__metadata','findById','prototype','killAll','scheduleJob','agendaService','2129235vSHXvv','16DpzNvL','Injectable','addSong','JobType','logger','SoundService','playAsync','../common/path','./mapper/playlist.mapper','executeJob','mapToDto','function','name','../common/enums','play','create','174wUxLPG','InjectModel','OnEvent','PlaylistService','mongoose','PROCESS_CACHE','metadata','delete','findByIdAndUpdate','soundGateway','__decorate','removeSong','design:paramtypes','../sound/sound.gateway','decorate','_id','__esModule','update','design:returntype','push','now','90537tIQjYr','@nestjs/mongoose','isShuffle','soundService','32600220nMbErb','log','findByIds','../agenda/agenda.service','exec','length','save','filter','fileName','assets','map','path','192241LzWxaN','20vcpRTF','design:type','2271303dVnntw','soundIds','getOwnPropertyDescriptor','playFromEvent','defineProperty','findAll'];a90_0x2d3e=function(){return _0x9aa177;};return a90_0x2d3e();}function a90_0x3e99(_0x3b6eb8,_0x4ec417){const _0x2d3e79=a90_0x2d3e();return a90_0x3e99=function(_0x3e99ea,_0x348c3c){_0x3e99ea=_0x3e99ea-0x151;let _0x30d111=_0x2d3e79[_0x3e99ea];return _0x30d111;},a90_0x3e99(_0x3b6eb8,_0x4ec417);}const common_1=require('@nestjs/common'),mongoose_1=require(a90_0x303c48(0x187)),mongoose_2=require(a90_0x303c48(0x199)),event_emitter_1=require(a90_0x303c48(0x15f)),sound_service_1=require('../sound/sound.service'),job_1=require(a90_0x303c48(0x162)),events_1=require(a90_0x303c48(0x169)),agenda_service_1=require(a90_0x303c48(0x19f)),playlist_mapper_1=require(a90_0x303c48(0x17b)),enums_1=require(a90_0x303c48(0x180)),path=require(a90_0x303c48(0x152)),path_1=require(a90_0x303c48(0x17a)),audio_player_1=require('../common/audio/audio-player'),sound_gateway_1=require(a90_0x303c48(0x190));let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x5ea47a,_0x59ca6f,_0x152c44,_0x34513c){const _0x32714e=a90_0x303c48;this[_0x32714e(0x160)]=_0x5ea47a,this[_0x32714e(0x19b)]=_0x59ca6f,this['agendaService']=_0x152c44,this[_0x32714e(0x18c)]=_0x34513c,this[_0x32714e(0x177)]=new common_1['Logger'](PlaylistService_1['name']);}async[a90_0x303c48(0x182)](_0x5296dd){const _0x41d5b8=a90_0x303c48,_0x452d37=new this[(_0x41d5b8(0x160))](_0x5296dd);return _0x452d37[_0x41d5b8(0x1a2)]();}async[a90_0x303c48(0x15b)](){const _0x335cc4=a90_0x303c48,_0x1c585a=await this[_0x335cc4(0x160)]['find']()[_0x335cc4(0x1a0)](),_0x49b0df=_0x1c585a['map'](async _0x4facd3=>{const _0x9dce56=_0x335cc4,_0x1e28c2=await this[_0x9dce56(0x19b)][_0x9dce56(0x19e)](_0x4facd3[_0x9dce56(0x157)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x4facd3,_0x1e28c2);});return await Promise['all'](_0x49b0df);}async['findOne'](_0x3ef341){const _0x22b56b=a90_0x303c48,_0x13354a=await this[_0x22b56b(0x160)][_0x22b56b(0x16d)](_0x3ef341),_0x9b39d0=await this[_0x22b56b(0x19b)][_0x22b56b(0x19e)](_0x13354a[_0x22b56b(0x157)]);return(0x0,playlist_mapper_1[_0x22b56b(0x17d)])(_0x13354a,_0x9b39d0);}async['update'](_0x2481cd,_0x1c943a){const _0x599247=a90_0x303c48,_0xe41c27=await this['playlistModel'][_0x599247(0x18b)](_0x2481cd,Object[_0x599247(0x168)](Object[_0x599247(0x168)]({},_0x1c943a),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x115e5a=await this[_0x599247(0x19b)][_0x599247(0x19e)](_0xe41c27['soundIds']);return(0x0,playlist_mapper_1[_0x599247(0x17d)])(_0xe41c27,_0x115e5a);}async[a90_0x303c48(0x18a)](_0x155304){const _0x253d8d=a90_0x303c48;return await this[_0x253d8d(0x160)]['findByIdAndDelete'](_0x155304);}async[a90_0x303c48(0x175)](_0x467135,_0xcdf575){const _0x41d4cb=a90_0x303c48,_0x497c85=await this['playlistModel'][_0x41d4cb(0x16d)](_0x467135);return _0x497c85['soundIds'][_0x41d4cb(0x196)](_0xcdf575),await _0x497c85[_0x41d4cb(0x1a2)]();}async[a90_0x303c48(0x18e)](_0x40a6d1,_0xac7384){const _0x2ef337=a90_0x303c48,_0x1d8cc9=await this[_0x2ef337(0x160)][_0x2ef337(0x16d)](_0x40a6d1);return _0x1d8cc9[_0x2ef337(0x157)]=_0x1d8cc9[_0x2ef337(0x157)][_0x2ef337(0x1a3)](_0x176f46=>_0x176f46!==_0xac7384),await _0x1d8cc9[_0x2ef337(0x1a2)]();}async[a90_0x303c48(0x181)](_0x3b9398,_0x4ebae4){const _0x5f456d=a90_0x303c48,_0x502f07={'when':_0x5f456d(0x197),'jobType':enums_1[_0x5f456d(0x176)][_0x5f456d(0x16a)],'attributes':{'playlistId':_0x4ebae4},'audit':{'actor':_0x3b9398,'name':enums_1[_0x5f456d(0x176)]['PlayMusic'],'message':'Play\x20Music\x20Playlist:\x20'+_0x4ebae4}},{jobId:_0x46edac}=await this[_0x5f456d(0x171)][_0x5f456d(0x170)](_0x502f07);return this[_0x5f456d(0x194)](_0x4ebae4,{'jobId':_0x46edac});}async[a90_0x303c48(0x164)](_0x22a13b){const _0x387732=a90_0x303c48;let _0x25cdf3=await this[_0x387732(0x166)](_0x22a13b);const {jobId:_0x15b76e}=_0x25cdf3||{};if(_0x15b76e){const {success:_0x349c87}=await this[_0x387732(0x171)][_0x387732(0x15c)](_0x15b76e);_0x349c87&&(_0x25cdf3=await this[_0x387732(0x194)](_0x22a13b,{'jobId':null}));}return this[_0x387732(0x18c)]['broadcastPlaying']({'id':_0x25cdf3[_0x387732(0x192)],'isPlaying':![]}),_0x25cdf3;}async[a90_0x303c48(0x159)](_0x5303f5){const _0x2eee5a=a90_0x303c48,{playlistId:_0x12467c,jobId:_0x30f1c2,durationInSecond:_0x5501e1}=_0x5303f5,_0x3a2808=await this[_0x2eee5a(0x160)][_0x2eee5a(0x16d)](_0x12467c),_0x41cfdd=[..._0x3a2808['soundIds']],_0x56e7e0=await this[_0x2eee5a(0x19b)]['findByIds'](_0x41cfdd),_0x588f42=_0x56e7e0[_0x2eee5a(0x151)](_0x3b35f3=>path['join'](path_1['processRootPath'],_0x2eee5a(0x1a5),'audio',_0x3b35f3[_0x2eee5a(0x1a4)]));job_1[_0x2eee5a(0x188)][_0x2eee5a(0x16f)](),this['logger'][_0x2eee5a(0x19d)]('Playing\x20playlist:\x20'+_0x12467c+_0x2eee5a(0x167)+_0x3a2808[_0x2eee5a(0x17f)]),(0x0,job_1[_0x2eee5a(0x17c)])({'jobId':_0x30f1c2,'run':()=>audio_player_1[_0x2eee5a(0x15d)][_0x2eee5a(0x179)](_0x588f42,0x32,_0x3a2808[_0x2eee5a(0x19a)]),'durationInSecond':_0x5501e1,'next':()=>this[_0x2eee5a(0x164)](_0x12467c)}),this['soundGateway']['broadcastPlaying']({'id':_0x12467c,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1[a90_0x303c48(0x185)])(events_1['PlaylistEvent']['Play']),__metadata(a90_0x303c48(0x155),Function),__metadata(a90_0x303c48(0x18f),[Object]),__metadata(a90_0x303c48(0x195),Promise)],PlaylistService[a90_0x303c48(0x16e)],a90_0x303c48(0x159),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a90_0x303c48(0x174)])(),__param(0x0,(0x0,mongoose_2[a90_0x303c48(0x184)])('Playlist')),__param(0x3,(0x0,common_1['Inject'])(sound_gateway_1['SoundGateway'])),__metadata(a90_0x303c48(0x18f),[mongoose_1['Model'],sound_service_1[a90_0x303c48(0x178)],agenda_service_1[a90_0x303c48(0x15e)],sound_gateway_1[a90_0x303c48(0x16b)]])],PlaylistService),exports['PlaylistService']=PlaylistService;