'use strict';function a87_0x5b81(){const _0x5555e5=['soundIds','metadata','playlistModel','findOne','isShuffle','mapToDto','../common/enums','\x20-\x20','playAsync','playFromEvent','4640482aFkcFy','stop','__esModule','find','_id','prototype','29250axTgjH','name','logger','scheduleJob','../common/events','Playing\x20playlist:\x20','JobType','__metadata','length','decorate','../common/audio/audio-player','PlaylistEvent','Play\x20Music\x20Playlist:\x20','mongoose','__param','AgendaService','agendaService','PROCESS_CACHE','removeSong','__decorate','cancelJob','broadcastPlaying','all','assign','push','play','map','findAll','120778IaukPy','Injectable','save','PlaylistService','250778qRDRvi','Playlist','killAll','117452SaDrWU','design:paramtypes','94983ReecTJ','now','Model','soundGateway','../common/job','../agenda/agenda.service','findByIdAndDelete','../sound/sound.service','exec','24fxcGuH','soundService','executeJob','function','findById','join','105sWfzIb','object','../common/path','log','4699220tenTDG','path','findByIds','SoundGateway','create','filter','AudioPlayer','400mwYbIo','findByIdAndUpdate','108EcGhwD','Logger','defineProperty','fileName','assets'];a87_0x5b81=function(){return _0x5555e5;};return a87_0x5b81();}const a87_0x593a25=a87_0xd2af;(function(_0x5e78cc,_0x24ced){const _0x5c9e53=a87_0xd2af,_0x4c0a60=_0x5e78cc();while(!![]){try{const _0x5d0276=parseInt(_0x5c9e53(0x9b))/0x1+-parseInt(_0x5c9e53(0x97))/0x2*(parseInt(_0x5c9e53(0xa9))/0x3)+parseInt(_0x5c9e53(0x9e))/0x4*(-parseInt(_0x5c9e53(0xaf))/0x5)+parseInt(_0x5c9e53(0xbc))/0x6*(parseInt(_0x5c9e53(0xa0))/0x7)+-parseInt(_0x5c9e53(0xba))/0x8*(-parseInt(_0x5c9e53(0xd1))/0x9)+parseInt(_0x5c9e53(0xb3))/0xa+parseInt(_0x5c9e53(0xcb))/0xb;if(_0x5d0276===_0x24ced)break;else _0x4c0a60['push'](_0x4c0a60['shift']());}catch(_0x4e8337){_0x4c0a60['push'](_0x4c0a60['shift']());}}}(a87_0x5b81,0x6dc21));var __decorate=this&&this[a87_0x593a25(0x8e)]||function(_0xa7ba8f,_0x11a8ad,_0x4bdcff,_0x426dc4){const _0x12e9ca=a87_0x593a25;var _0x48907e=arguments[_0x12e9ca(0xd9)],_0x368585=_0x48907e<0x3?_0x11a8ad:_0x426dc4===null?_0x426dc4=Object['getOwnPropertyDescriptor'](_0x11a8ad,_0x4bdcff):_0x426dc4,_0x2f922a;if(typeof Reflect===_0x12e9ca(0xb0)&&typeof Reflect[_0x12e9ca(0xda)]==='function')_0x368585=Reflect[_0x12e9ca(0xda)](_0xa7ba8f,_0x11a8ad,_0x4bdcff,_0x426dc4);else{for(var _0x5a9aa9=_0xa7ba8f['length']-0x1;_0x5a9aa9>=0x0;_0x5a9aa9--)if(_0x2f922a=_0xa7ba8f[_0x5a9aa9])_0x368585=(_0x48907e<0x3?_0x2f922a(_0x368585):_0x48907e>0x3?_0x2f922a(_0x11a8ad,_0x4bdcff,_0x368585):_0x2f922a(_0x11a8ad,_0x4bdcff))||_0x368585;}return _0x48907e>0x3&&_0x368585&&Object[_0x12e9ca(0xbe)](_0x11a8ad,_0x4bdcff,_0x368585),_0x368585;},__metadata=this&&this[a87_0x593a25(0xd8)]||function(_0x57c05d,_0x1dbf5e){const _0x34bc3e=a87_0x593a25;if(typeof Reflect===_0x34bc3e(0xb0)&&typeof Reflect[_0x34bc3e(0xc2)]===_0x34bc3e(0xac))return Reflect[_0x34bc3e(0xc2)](_0x57c05d,_0x1dbf5e);},__param=this&&this[a87_0x593a25(0x89)]||function(_0xdd954a,_0x140ed6){return function(_0x1f0a57,_0x238487){_0x140ed6(_0x1f0a57,_0x238487,_0xdd954a);};},PlaylistService_1;Object['defineProperty'](exports,a87_0x593a25(0xcd),{'value':!![]}),exports['PlaylistService']=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a87_0x593a25(0xde)),mongoose_2=require('@nestjs/mongoose'),event_emitter_1=require('@nestjs/event-emitter'),sound_service_1=require(a87_0x593a25(0xa7)),job_1=require(a87_0x593a25(0xa4)),events_1=require(a87_0x593a25(0xd5)),agenda_service_1=require(a87_0x593a25(0xa5)),playlist_mapper_1=require('./mapper/playlist.mapper'),enums_1=require(a87_0x593a25(0xc7)),path=require(a87_0x593a25(0xb4)),path_1=require(a87_0x593a25(0xb1)),audio_player_1=require(a87_0x593a25(0xdb)),sound_gateway_1=require('../sound/sound.gateway');function a87_0xd2af(_0x2bedfd,_0x32d35e){const _0x5b814d=a87_0x5b81();return a87_0xd2af=function(_0xd2af1c,_0x509712){_0xd2af1c=_0xd2af1c-0x89;let _0x222f22=_0x5b814d[_0xd2af1c];return _0x222f22;},a87_0xd2af(_0x2bedfd,_0x32d35e);}let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x1bbcc4,_0x4db706,_0x420ff3,_0x573a2f){const _0x2fff41=a87_0x593a25;this['playlistModel']=_0x1bbcc4,this['soundService']=_0x4db706,this[_0x2fff41(0x8b)]=_0x420ff3,this[_0x2fff41(0xa3)]=_0x573a2f,this[_0x2fff41(0xd3)]=new common_1[(_0x2fff41(0xbd))](PlaylistService_1[_0x2fff41(0xd2)]);}async[a87_0x593a25(0xb7)](_0x42b4ed){const _0x215125=a87_0x593a25,_0x59ebe9=new this[(_0x215125(0xc3))](_0x42b4ed);return _0x59ebe9[_0x215125(0x99)]();}async[a87_0x593a25(0x96)](){const _0x156df5=a87_0x593a25,_0x23f8e6=await this[_0x156df5(0xc3)][_0x156df5(0xce)]()[_0x156df5(0xa8)](),_0x295cb5=_0x23f8e6[_0x156df5(0x95)](async _0x810962=>{const _0x50ec70=_0x156df5,_0x38bfe9=await this[_0x50ec70(0xaa)][_0x50ec70(0xb5)](_0x810962[_0x50ec70(0xc1)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x810962,_0x38bfe9);});return await Promise[_0x156df5(0x91)](_0x295cb5);}async['findOne'](_0x1fdc7f){const _0x1711c6=a87_0x593a25,_0xaffd7=await this[_0x1711c6(0xc3)][_0x1711c6(0xad)](_0x1fdc7f),_0x472fe4=await this[_0x1711c6(0xaa)][_0x1711c6(0xb5)](_0xaffd7[_0x1711c6(0xc1)]);return(0x0,playlist_mapper_1[_0x1711c6(0xc6)])(_0xaffd7,_0x472fe4);}async['update'](_0x228c35,_0x10e67b){const _0x47c6a7=a87_0x593a25,_0x144b6f=await this[_0x47c6a7(0xc3)][_0x47c6a7(0xbb)](_0x228c35,Object[_0x47c6a7(0x92)](Object['assign']({},_0x10e67b),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x48fd3c=await this[_0x47c6a7(0xaa)][_0x47c6a7(0xb5)](_0x144b6f[_0x47c6a7(0xc1)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x144b6f,_0x48fd3c);}async['delete'](_0x457c45){const _0x464a2c=a87_0x593a25;return await this[_0x464a2c(0xc3)][_0x464a2c(0xa6)](_0x457c45);}async['addSong'](_0x4c8fec,_0x556cb4){const _0x38e637=a87_0x593a25,_0x2eff3d=await this['playlistModel'][_0x38e637(0xad)](_0x4c8fec);return _0x2eff3d[_0x38e637(0xc1)][_0x38e637(0x93)](_0x556cb4),await _0x2eff3d[_0x38e637(0x99)]();}async[a87_0x593a25(0x8d)](_0x3a66d1,_0x575a1){const _0x2feecc=a87_0x593a25,_0x851f2=await this[_0x2feecc(0xc3)]['findById'](_0x3a66d1);return _0x851f2[_0x2feecc(0xc1)]=_0x851f2['soundIds'][_0x2feecc(0xb8)](_0x5b1232=>_0x5b1232!==_0x575a1),await _0x851f2[_0x2feecc(0x99)]();}async[a87_0x593a25(0x94)](_0x11268f,_0x1451c7){const _0x4d0256=a87_0x593a25,_0x3e2dc1={'when':_0x4d0256(0xa1),'jobType':enums_1[_0x4d0256(0xd7)]['PlayMusic'],'attributes':{'playlistId':_0x1451c7},'audit':{'actor':_0x11268f,'name':enums_1['JobType']['PlayMusic'],'message':_0x4d0256(0xdd)+_0x1451c7}},{jobId:_0x249fbb}=await this[_0x4d0256(0x8b)][_0x4d0256(0xd4)](_0x3e2dc1);return this['update'](_0x1451c7,{'jobId':_0x249fbb});}async['stop'](_0x1ad310){const _0x174593=a87_0x593a25;let _0x189b30=await this[_0x174593(0xc4)](_0x1ad310);const {jobId:_0x793ecf}=_0x189b30||{};if(_0x793ecf){const {success:_0x5e7259}=await this['agendaService'][_0x174593(0x8f)](_0x793ecf);_0x5e7259&&(_0x189b30=await this['update'](_0x1ad310,{'jobId':null}));}return this['soundGateway'][_0x174593(0x90)]({'id':_0x189b30[_0x174593(0xcf)],'isPlaying':![]}),_0x189b30;}async[a87_0x593a25(0xca)](_0x1075dc){const _0x840312=a87_0x593a25,{playlistId:_0x160638,jobId:_0x9c9e30,durationInSecond:_0x5efdb9}=_0x1075dc,_0x295823=await this[_0x840312(0xc3)][_0x840312(0xad)](_0x160638),_0x2e5cdb=[..._0x295823[_0x840312(0xc1)]],_0x37239b=await this[_0x840312(0xaa)][_0x840312(0xb5)](_0x2e5cdb),_0x79a905=_0x37239b[_0x840312(0x95)](_0x4743d2=>path[_0x840312(0xae)](path_1['processRootPath'],_0x840312(0xc0),'audio',_0x4743d2[_0x840312(0xbf)]));job_1[_0x840312(0x8c)][_0x840312(0x9d)](),this['logger'][_0x840312(0xb2)](_0x840312(0xd6)+_0x160638+_0x840312(0xc8)+_0x295823['name']),(0x0,job_1[_0x840312(0xab)])({'jobId':_0x9c9e30,'run':()=>audio_player_1[_0x840312(0xb9)][_0x840312(0xc9)](_0x79a905,0x32,_0x295823[_0x840312(0xc5)]),'durationInSecond':_0x5efdb9,'next':()=>this[_0x840312(0xcc)](_0x160638)}),this[_0x840312(0xa3)][_0x840312(0x90)]({'id':_0x160638,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1['OnEvent'])(events_1[a87_0x593a25(0xdc)]['Play']),__metadata('design:type',Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],PlaylistService[a87_0x593a25(0xd0)],'playFromEvent',null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a87_0x593a25(0x98)])(),__param(0x0,(0x0,mongoose_2['InjectModel'])(a87_0x593a25(0x9c))),__param(0x3,(0x0,common_1['Inject'])(sound_gateway_1[a87_0x593a25(0xb6)])),__metadata(a87_0x593a25(0x9f),[mongoose_1[a87_0x593a25(0xa2)],sound_service_1['SoundService'],agenda_service_1[a87_0x593a25(0x8a)],sound_gateway_1[a87_0x593a25(0xb6)]])],PlaylistService),exports[a87_0x593a25(0x9a)]=PlaylistService;