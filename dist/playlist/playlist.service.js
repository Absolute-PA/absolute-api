'use strict';const a90_0x384dd4=a90_0x42c0;(function(_0x4d1676,_0x223ec2){const _0x16fcef=a90_0x42c0,_0x1355bd=_0x4d1676();while(!![]){try{const _0x167a65=-parseInt(_0x16fcef(0xe4))/0x1+parseInt(_0x16fcef(0xcd))/0x2+-parseInt(_0x16fcef(0xb9))/0x3+parseInt(_0x16fcef(0xdc))/0x4*(parseInt(_0x16fcef(0xe6))/0x5)+parseInt(_0x16fcef(0xb8))/0x6+-parseInt(_0x16fcef(0xe5))/0x7+parseInt(_0x16fcef(0xe9))/0x8;if(_0x167a65===_0x223ec2)break;else _0x1355bd['push'](_0x1355bd['shift']());}catch(_0x3a3032){_0x1355bd['push'](_0x1355bd['shift']());}}}(a90_0x4653,0xa475e));function a90_0x42c0(_0x52313c,_0x517c0b){const _0x46537a=a90_0x4653();return a90_0x42c0=function(_0x42c005,_0x192282){_0x42c005=_0x42c005-0xa8;let _0x52242b=_0x46537a[_0x42c005];return _0x52242b;},a90_0x42c0(_0x52313c,_0x517c0b);}var __decorate=this&&this[a90_0x384dd4(0xcb)]||function(_0x2007a1,_0x1c2f7a,_0x4d3a9c,_0x152073){const _0x541673=a90_0x384dd4;var _0x1a50b9=arguments[_0x541673(0xb1)],_0x2498dc=_0x1a50b9<0x3?_0x1c2f7a:_0x152073===null?_0x152073=Object[_0x541673(0xc9)](_0x1c2f7a,_0x4d3a9c):_0x152073,_0x147c82;if(typeof Reflect===_0x541673(0xc4)&&typeof Reflect[_0x541673(0xb7)]===_0x541673(0xd7))_0x2498dc=Reflect[_0x541673(0xb7)](_0x2007a1,_0x1c2f7a,_0x4d3a9c,_0x152073);else{for(var _0x174084=_0x2007a1[_0x541673(0xb1)]-0x1;_0x174084>=0x0;_0x174084--)if(_0x147c82=_0x2007a1[_0x174084])_0x2498dc=(_0x1a50b9<0x3?_0x147c82(_0x2498dc):_0x1a50b9>0x3?_0x147c82(_0x1c2f7a,_0x4d3a9c,_0x2498dc):_0x147c82(_0x1c2f7a,_0x4d3a9c))||_0x2498dc;}return _0x1a50b9>0x3&&_0x2498dc&&Object[_0x541673(0xa8)](_0x1c2f7a,_0x4d3a9c,_0x2498dc),_0x2498dc;},__metadata=this&&this['__metadata']||function(_0x1a5957,_0x421900){const _0xb40294=a90_0x384dd4;if(typeof Reflect===_0xb40294(0xc4)&&typeof Reflect[_0xb40294(0xde)]==='function')return Reflect[_0xb40294(0xde)](_0x1a5957,_0x421900);},__param=this&&this[a90_0x384dd4(0xe8)]||function(_0x1d2aa7,_0x21bd75){return function(_0x769eea,_0x395f61){_0x21bd75(_0x769eea,_0x395f61,_0x1d2aa7);};},PlaylistService_1;Object[a90_0x384dd4(0xa8)](exports,'__esModule',{'value':!![]}),exports[a90_0x384dd4(0xf0)]=void 0x0;const common_1=require(a90_0x384dd4(0xb0)),mongoose_1=require(a90_0x384dd4(0xd1)),mongoose_2=require(a90_0x384dd4(0xe2)),event_emitter_1=require(a90_0x384dd4(0xeb)),sound_service_1=require(a90_0x384dd4(0xb6)),job_1=require(a90_0x384dd4(0xae)),events_1=require(a90_0x384dd4(0xad)),agenda_service_1=require(a90_0x384dd4(0xc8)),playlist_mapper_1=require(a90_0x384dd4(0xb4)),enums_1=require('../common/enums'),path=require(a90_0x384dd4(0xda)),path_1=require(a90_0x384dd4(0xc6)),audio_player_1=require('../common/audio/audio-player'),sound_gateway_1=require('../sound/sound.gateway');let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0xd18d8c,_0x5b5066,_0x19ed07,_0x7bcb3f){const _0x5ecf5a=a90_0x384dd4;this['playlistModel']=_0xd18d8c,this['soundService']=_0x5b5066,this['agendaService']=_0x19ed07,this[_0x5ecf5a(0xec)]=_0x7bcb3f,this[_0x5ecf5a(0xf1)]=new common_1[(_0x5ecf5a(0xc5))](PlaylistService_1[_0x5ecf5a(0xbe)]);}async[a90_0x384dd4(0xb3)](_0x4edecb){const _0x11e595=new this['playlistModel'](_0x4edecb);return _0x11e595['save']();}async['findAll'](){const _0x119d57=a90_0x384dd4,_0x30f620=await this[_0x119d57(0xd2)][_0x119d57(0xc2)]()['exec'](),_0x5eda71=_0x30f620[_0x119d57(0xb2)](async _0x559e81=>{const _0x411f83=_0x119d57,_0x1c6072=await this['soundService'][_0x411f83(0xd9)](_0x559e81[_0x411f83(0xbf)]);return(0x0,playlist_mapper_1[_0x411f83(0xee)])(_0x559e81,_0x1c6072);});return await Promise[_0x119d57(0xc7)](_0x5eda71);}async[a90_0x384dd4(0xdf)](_0x2833b1){const _0x30c8a2=a90_0x384dd4,_0x416ed5=await this[_0x30c8a2(0xd2)]['findById'](_0x2833b1),_0x2f0f5e=await this[_0x30c8a2(0xe3)][_0x30c8a2(0xd9)](_0x416ed5[_0x30c8a2(0xbf)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x416ed5,_0x2f0f5e);}async[a90_0x384dd4(0xc0)](_0x1dad88,_0x7d9afb){const _0x5bb6e3=a90_0x384dd4,_0x4ce857=await this[_0x5bb6e3(0xd2)][_0x5bb6e3(0xd8)](_0x1dad88,Object[_0x5bb6e3(0xdd)](Object[_0x5bb6e3(0xdd)]({},_0x7d9afb),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x49a2b9=await this[_0x5bb6e3(0xe3)][_0x5bb6e3(0xd9)](_0x4ce857[_0x5bb6e3(0xbf)]);return(0x0,playlist_mapper_1[_0x5bb6e3(0xee)])(_0x4ce857,_0x49a2b9);}async['delete'](_0x5712c8){const _0x19e83a=a90_0x384dd4;return await this[_0x19e83a(0xd2)][_0x19e83a(0xa9)](_0x5712c8);}async[a90_0x384dd4(0xd0)](_0x5b2ea8,_0x52b138){const _0x310e13=a90_0x384dd4,_0x2860e3=await this['playlistModel'][_0x310e13(0xe0)](_0x5b2ea8);return _0x2860e3['soundIds']['push'](_0x52b138),await _0x2860e3[_0x310e13(0xc1)]();}async['removeSong'](_0x4d9fed,_0x5e168f){const _0x3677b8=a90_0x384dd4,_0x393ad8=await this[_0x3677b8(0xd2)][_0x3677b8(0xe0)](_0x4d9fed);return _0x393ad8[_0x3677b8(0xbf)]=_0x393ad8[_0x3677b8(0xbf)][_0x3677b8(0xef)](_0x3b2351=>_0x3b2351!==_0x5e168f),await _0x393ad8[_0x3677b8(0xc1)]();}async[a90_0x384dd4(0xe1)](_0x2650ba,_0x5967e4){const _0xcb8ca3=a90_0x384dd4,_0x167866={'when':_0xcb8ca3(0xd3),'jobType':enums_1['JobType'][_0xcb8ca3(0xbc)],'attributes':{'playlistId':_0x5967e4},'audit':{'actor':_0x2650ba,'name':enums_1[_0xcb8ca3(0xed)][_0xcb8ca3(0xbc)],'message':'Play\x20Music\x20Playlist:\x20'+_0x5967e4}},{jobId:_0x478f5b}=await this[_0xcb8ca3(0xf2)]['scheduleJob'](_0x167866);return this[_0xcb8ca3(0xc0)](_0x5967e4,{'jobId':_0x478f5b});}async[a90_0x384dd4(0xd5)](_0x54f66b){const _0x2cbade=a90_0x384dd4;let _0x347c64=await this['findOne'](_0x54f66b);const {jobId:_0x2cbf93}=_0x347c64||{};if(_0x2cbf93){const {success:_0xf5d62}=await this[_0x2cbade(0xf2)]['cancelJob'](_0x2cbf93);_0xf5d62&&(_0x347c64=await this[_0x2cbade(0xc0)](_0x54f66b,{'jobId':null}));}return this['soundGateway'][_0x2cbade(0xdb)]({'id':_0x347c64['_id'],'isPlaying':![]}),_0x347c64;}async[a90_0x384dd4(0xbd)](_0x24ff3e){const _0xd785e1=a90_0x384dd4,{playlistId:_0x33cea2,jobId:_0x9c3d4f,durationInSecond:_0x2ae075}=_0x24ff3e,_0x360d52=await this['playlistModel'][_0xd785e1(0xe0)](_0x33cea2),_0xadaa16=[..._0x360d52['soundIds']],_0x4aa8cf=await this['soundService'][_0xd785e1(0xd9)](_0xadaa16),_0x3c9c09=_0x4aa8cf[_0xd785e1(0xb2)](_0x421e35=>path['join'](path_1['processRootPath'],_0xd785e1(0xe7),'audio',_0x421e35[_0xd785e1(0xea)]));job_1['PROCESS_CACHE'][_0xd785e1(0xba)](),this[_0xd785e1(0xf1)][_0xd785e1(0xaf)]('Playing\x20playlist:\x20'+_0x33cea2+_0xd785e1(0xd6)+_0x360d52[_0xd785e1(0xbe)]),(0x0,job_1['executeJob'])({'jobId':_0x9c3d4f,'run':()=>audio_player_1[_0xd785e1(0xab)][_0xd785e1(0xce)](_0x3c9c09,0x32,_0x360d52['isShuffle']),'durationInSecond':_0x2ae075,'next':()=>this[_0xd785e1(0xd5)](_0x33cea2)}),this[_0xd785e1(0xec)][_0xd785e1(0xdb)]({'id':_0x33cea2,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1[a90_0x384dd4(0xd4)])(events_1['PlaylistEvent']['Play']),__metadata(a90_0x384dd4(0xc3),Function),__metadata(a90_0x384dd4(0xca),[Object]),__metadata(a90_0x384dd4(0xcf),Promise)],PlaylistService['prototype'],'playFromEvent',null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_2[a90_0x384dd4(0xac)])('Playlist')),__param(0x3,(0x0,common_1[a90_0x384dd4(0xbb)])(sound_gateway_1[a90_0x384dd4(0xaa)])),__metadata(a90_0x384dd4(0xca),[mongoose_1[a90_0x384dd4(0xb5)],sound_service_1['SoundService'],agenda_service_1[a90_0x384dd4(0xcc)],sound_gateway_1['SoundGateway']])],PlaylistService),exports[a90_0x384dd4(0xf0)]=PlaylistService;function a90_0x4653(){const _0x43cec9=['Logger','../common/path','all','../agenda/agenda.service','getOwnPropertyDescriptor','design:paramtypes','__decorate','AgendaService','1299662kxCswo','playAsync','design:returntype','addSong','mongoose','playlistModel','now','OnEvent','stop','\x20-\x20','function','findByIdAndUpdate','findByIds','path','broadcastPlaying','129148CYXVcJ','assign','metadata','findOne','findById','play','@nestjs/mongoose','soundService','1059250BnIvqN','1053871IxTMic','5KzAkee','assets','__param','4961176SyozGl','fileName','@nestjs/event-emitter','soundGateway','JobType','mapToDto','filter','PlaylistService','logger','agendaService','defineProperty','findByIdAndDelete','SoundGateway','AudioPlayer','InjectModel','../common/events','../common/job','log','@nestjs/common','length','map','create','./mapper/playlist.mapper','Model','../sound/sound.service','decorate','5726766VFocbj','1119879qPEQmG','killAll','Inject','PlayMusic','playFromEvent','name','soundIds','update','save','find','design:type','object'];a90_0x4653=function(){return _0x43cec9;};return a90_0x4653();}