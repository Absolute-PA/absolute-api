'use strict';const a87_0x28d209=a87_0x54d2;function a87_0x1f7d(){const _0x1ac4a7=['./mapper/playlist.mapper','join','../common/job','save','findByIdAndUpdate','JobType','PROCESS_CACHE','create','playFromEvent','../sound/sound.service','soundIds','findByIds','all','name','mongoose','Playing\x20playlist:\x20','assets','739232TDfdVJ','PlaylistEvent','fileName','delete','map','408246iqVxTE','stop','1053066lVjoBE','Play\x20Music\x20Playlist:\x20','@nestjs/mongoose','../common/events','PlayMusic','PlaylistService','findOne','path','findAll','mapToDto','findById','executeJob','removeSong','addSong','801935QDGjLd','object','update','processRootPath','_id','filter','Play','soundGateway','__param','../agenda/agenda.service','AudioPlayer','getOwnPropertyDescriptor','626370OkmwoU','metadata','scheduleJob','4562369YqAsQZ','broadcastPlaying','AgendaService','Inject','288636JHrZyn','__metadata','SoundGateway','find','function','findByIdAndDelete','soundService','prototype','length','log','design:returntype','killAll','__decorate','decorate','Model','__esModule','@nestjs/common','\x20-\x20','../common/path','playlistModel','../common/audio/audio-player','isShuffle','logger','agendaService','design:type','design:paramtypes'];a87_0x1f7d=function(){return _0x1ac4a7;};return a87_0x1f7d();}(function(_0xe7a7ee,_0x4edf62){const _0x4a563b=a87_0x54d2,_0x530e7a=_0xe7a7ee();while(!![]){try{const _0x105af1=parseInt(_0x4a563b(0x8a))/0x1+parseInt(_0x4a563b(0xba))/0x2+parseInt(_0x4a563b(0xd6))/0x3+-parseInt(_0x4a563b(0xb5))/0x4+parseInt(_0x4a563b(0xca))/0x5+parseInt(_0x4a563b(0xbc))/0x6+-parseInt(_0x4a563b(0xd9))/0x7;if(_0x105af1===_0x4edf62)break;else _0x530e7a['push'](_0x530e7a['shift']());}catch(_0x248a1c){_0x530e7a['push'](_0x530e7a['shift']());}}}(a87_0x1f7d,0x310a8));function a87_0x54d2(_0x11d4aa,_0x149b23){const _0x1f7df7=a87_0x1f7d();return a87_0x54d2=function(_0x54d2c4,_0x455539){_0x54d2c4=_0x54d2c4-0x87;let _0x1e1fed=_0x1f7df7[_0x54d2c4];return _0x1e1fed;},a87_0x54d2(_0x11d4aa,_0x149b23);}var __decorate=this&&this[a87_0x28d209(0x96)]||function(_0x5cac99,_0x14eadb,_0x562389,_0x248cdc){const _0x11562e=a87_0x28d209;var _0x4cef68=arguments[_0x11562e(0x92)],_0xdce522=_0x4cef68<0x3?_0x14eadb:_0x248cdc===null?_0x248cdc=Object[_0x11562e(0xd5)](_0x14eadb,_0x562389):_0x248cdc,_0x47a34e;if(typeof Reflect==='object'&&typeof Reflect[_0x11562e(0x97)]===_0x11562e(0x8e))_0xdce522=Reflect[_0x11562e(0x97)](_0x5cac99,_0x14eadb,_0x562389,_0x248cdc);else{for(var _0x165ce7=_0x5cac99[_0x11562e(0x92)]-0x1;_0x165ce7>=0x0;_0x165ce7--)if(_0x47a34e=_0x5cac99[_0x165ce7])_0xdce522=(_0x4cef68<0x3?_0x47a34e(_0xdce522):_0x4cef68>0x3?_0x47a34e(_0x14eadb,_0x562389,_0xdce522):_0x47a34e(_0x14eadb,_0x562389))||_0xdce522;}return _0x4cef68>0x3&&_0xdce522&&Object['defineProperty'](_0x14eadb,_0x562389,_0xdce522),_0xdce522;},__metadata=this&&this[a87_0x28d209(0x8b)]||function(_0x19d9ec,_0x3994c2){const _0x197a13=a87_0x28d209;if(typeof Reflect===_0x197a13(0xcb)&&typeof Reflect[_0x197a13(0xd7)]===_0x197a13(0x8e))return Reflect[_0x197a13(0xd7)](_0x19d9ec,_0x3994c2);},__param=this&&this[a87_0x28d209(0xd2)]||function(_0x49a380,_0x17db6c){return function(_0x14dc58,_0x5a6e5f){_0x17db6c(_0x14dc58,_0x5a6e5f,_0x49a380);};},PlaylistService_1;Object['defineProperty'](exports,a87_0x28d209(0x99),{'value':!![]}),exports[a87_0x28d209(0xc1)]=void 0x0;const common_1=require(a87_0x28d209(0x9a)),mongoose_1=require(a87_0x28d209(0xb2)),mongoose_2=require(a87_0x28d209(0xbe)),event_emitter_1=require('@nestjs/event-emitter'),sound_service_1=require(a87_0x28d209(0xad)),job_1=require(a87_0x28d209(0xa6)),events_1=require(a87_0x28d209(0xbf)),agenda_service_1=require(a87_0x28d209(0xd3)),playlist_mapper_1=require(a87_0x28d209(0xa4)),enums_1=require('../common/enums'),path=require(a87_0x28d209(0xc3)),path_1=require(a87_0x28d209(0x9c)),audio_player_1=require(a87_0x28d209(0x9e)),sound_gateway_1=require('../sound/sound.gateway');let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x1f18a4,_0x377ea4,_0x40cd10,_0x19e48f){const _0x36835f=a87_0x28d209;this[_0x36835f(0x9d)]=_0x1f18a4,this[_0x36835f(0x90)]=_0x377ea4,this[_0x36835f(0xa1)]=_0x40cd10,this[_0x36835f(0xd1)]=_0x19e48f,this[_0x36835f(0xa0)]=new common_1['Logger'](PlaylistService_1[_0x36835f(0xb1)]);}async[a87_0x28d209(0xab)](_0x110d24){const _0x17a871=a87_0x28d209,_0xd0f2e9=new this[(_0x17a871(0x9d))](_0x110d24);return _0xd0f2e9['save']();}async[a87_0x28d209(0xc4)](){const _0x161179=a87_0x28d209,_0x1bf760=await this['playlistModel'][_0x161179(0x8d)]()['exec'](),_0x25d19c=_0x1bf760[_0x161179(0xb9)](async _0x2160ff=>{const _0x26cf51=_0x161179,_0x18f765=await this[_0x26cf51(0x90)][_0x26cf51(0xaf)](_0x2160ff[_0x26cf51(0xae)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x2160ff,_0x18f765);});return await Promise[_0x161179(0xb0)](_0x25d19c);}async['findOne'](_0x2af9c7){const _0x5d3bb9=a87_0x28d209,_0x15784d=await this[_0x5d3bb9(0x9d)][_0x5d3bb9(0xc6)](_0x2af9c7),_0xae4b48=await this[_0x5d3bb9(0x90)][_0x5d3bb9(0xaf)](_0x15784d[_0x5d3bb9(0xae)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x15784d,_0xae4b48);}async['update'](_0x4a22bd,_0x420f9f){const _0x7b7f67=a87_0x28d209,_0x393b3f=await this[_0x7b7f67(0x9d)][_0x7b7f67(0xa8)](_0x4a22bd,Object['assign'](Object['assign']({},_0x420f9f),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x2c2c77=await this[_0x7b7f67(0x90)][_0x7b7f67(0xaf)](_0x393b3f[_0x7b7f67(0xae)]);return(0x0,playlist_mapper_1[_0x7b7f67(0xc5)])(_0x393b3f,_0x2c2c77);}async[a87_0x28d209(0xb8)](_0x492852){const _0x1d73cc=a87_0x28d209;return await this[_0x1d73cc(0x9d)][_0x1d73cc(0x8f)](_0x492852);}async[a87_0x28d209(0xc9)](_0x5d08c4,_0x28131f){const _0x20f9bd=a87_0x28d209,_0x2be97a=await this['playlistModel'][_0x20f9bd(0xc6)](_0x5d08c4);return _0x2be97a[_0x20f9bd(0xae)]['push'](_0x28131f),await _0x2be97a[_0x20f9bd(0xa7)]();}async[a87_0x28d209(0xc8)](_0x3770fe,_0x130c38){const _0xa6ed9a=a87_0x28d209,_0xb89bbb=await this[_0xa6ed9a(0x9d)][_0xa6ed9a(0xc6)](_0x3770fe);return _0xb89bbb[_0xa6ed9a(0xae)]=_0xb89bbb[_0xa6ed9a(0xae)][_0xa6ed9a(0xcf)](_0x46f9cd=>_0x46f9cd!==_0x130c38),await _0xb89bbb['save']();}async['play'](_0x1122fc,_0x1a0229){const _0x6e13d3=a87_0x28d209,_0x1ea03f={'when':'now','jobType':enums_1[_0x6e13d3(0xa9)][_0x6e13d3(0xc0)],'attributes':{'playlistId':_0x1a0229},'audit':{'actor':_0x1122fc,'name':enums_1['JobType'][_0x6e13d3(0xc0)],'message':_0x6e13d3(0xbd)+_0x1a0229}},{jobId:_0x4a1d43}=await this[_0x6e13d3(0xa1)][_0x6e13d3(0xd8)](_0x1ea03f);return this[_0x6e13d3(0xcc)](_0x1a0229,{'jobId':_0x4a1d43});}async[a87_0x28d209(0xbb)](_0x56a71c){const _0x4535c5=a87_0x28d209;let _0x19a60f=await this[_0x4535c5(0xc2)](_0x56a71c);const {jobId:_0x4ae698}=_0x19a60f||{};if(_0x4ae698){const {success:_0x12b3db}=await this[_0x4535c5(0xa1)]['cancelJob'](_0x4ae698);_0x12b3db&&(_0x19a60f=await this[_0x4535c5(0xcc)](_0x56a71c,{'jobId':null}));}return this['soundGateway'][_0x4535c5(0x87)]({'id':_0x19a60f[_0x4535c5(0xce)],'isPlaying':![]}),_0x19a60f;}async[a87_0x28d209(0xac)](_0x5e443e){const _0x35b3c6=a87_0x28d209,{playlistId:_0x404114,jobId:_0x37be6d,durationInSecond:_0x2494e5}=_0x5e443e,_0x55c815=await this[_0x35b3c6(0x9d)][_0x35b3c6(0xc6)](_0x404114),_0x11d952=[..._0x55c815['soundIds']],_0x3e3556=await this[_0x35b3c6(0x90)]['findByIds'](_0x11d952),_0x3c779d=_0x3e3556[_0x35b3c6(0xb9)](_0x5914f1=>path[_0x35b3c6(0xa5)](path_1[_0x35b3c6(0xcd)],_0x35b3c6(0xb4),'audio',_0x5914f1[_0x35b3c6(0xb7)]));job_1[_0x35b3c6(0xaa)][_0x35b3c6(0x95)](),this[_0x35b3c6(0xa0)][_0x35b3c6(0x93)](_0x35b3c6(0xb3)+_0x404114+_0x35b3c6(0x9b)+_0x55c815['name']),(0x0,job_1[_0x35b3c6(0xc7)])({'jobId':_0x37be6d,'run':()=>audio_player_1[_0x35b3c6(0xd4)]['playAsync'](_0x3c779d,0x32,_0x55c815[_0x35b3c6(0x9f)]),'durationInSecond':_0x2494e5,'next':()=>this[_0x35b3c6(0xbb)](_0x404114)}),this['soundGateway'][_0x35b3c6(0x87)]({'id':_0x404114,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1['OnEvent'])(events_1[a87_0x28d209(0xb6)][a87_0x28d209(0xd0)]),__metadata(a87_0x28d209(0xa2),Function),__metadata(a87_0x28d209(0xa3),[Object]),__metadata(a87_0x28d209(0x94),Promise)],PlaylistService[a87_0x28d209(0x91)],'playFromEvent',null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_2['InjectModel'])('Playlist')),__param(0x3,(0x0,common_1[a87_0x28d209(0x89)])(sound_gateway_1['SoundGateway'])),__metadata(a87_0x28d209(0xa3),[mongoose_1[a87_0x28d209(0x98)],sound_service_1['SoundService'],agenda_service_1[a87_0x28d209(0x88)],sound_gateway_1[a87_0x28d209(0x8c)]])],PlaylistService),exports[a87_0x28d209(0xc1)]=PlaylistService;