'use strict';const a87_0x574104=a87_0x4303;(function(_0x190f44,_0x1cda6c){const _0x201411=a87_0x4303,_0x4e2189=_0x190f44();while(!![]){try{const _0x5e0db4=parseInt(_0x201411(0x12c))/0x1+-parseInt(_0x201411(0x13a))/0x2*(parseInt(_0x201411(0x107))/0x3)+-parseInt(_0x201411(0x144))/0x4+-parseInt(_0x201411(0xf7))/0x5*(parseInt(_0x201411(0x10f))/0x6)+parseInt(_0x201411(0x13d))/0x7+-parseInt(_0x201411(0x127))/0x8+parseInt(_0x201411(0x13b))/0x9;if(_0x5e0db4===_0x1cda6c)break;else _0x4e2189['push'](_0x4e2189['shift']());}catch(_0x337b22){_0x4e2189['push'](_0x4e2189['shift']());}}}(a87_0x338f,0x1f98f));var __decorate=this&&this[a87_0x574104(0x12a)]||function(_0x26bcf6,_0x3c2a75,_0x437ddf,_0x31e91c){const _0x1ff2ea=a87_0x574104;var _0x2fb307=arguments[_0x1ff2ea(0x124)],_0x52f173=_0x2fb307<0x3?_0x3c2a75:_0x31e91c===null?_0x31e91c=Object[_0x1ff2ea(0x11b)](_0x3c2a75,_0x437ddf):_0x31e91c,_0x13a3f2;if(typeof Reflect===_0x1ff2ea(0x141)&&typeof Reflect[_0x1ff2ea(0x10e)]===_0x1ff2ea(0xfe))_0x52f173=Reflect[_0x1ff2ea(0x10e)](_0x26bcf6,_0x3c2a75,_0x437ddf,_0x31e91c);else{for(var _0x1e07bf=_0x26bcf6['length']-0x1;_0x1e07bf>=0x0;_0x1e07bf--)if(_0x13a3f2=_0x26bcf6[_0x1e07bf])_0x52f173=(_0x2fb307<0x3?_0x13a3f2(_0x52f173):_0x2fb307>0x3?_0x13a3f2(_0x3c2a75,_0x437ddf,_0x52f173):_0x13a3f2(_0x3c2a75,_0x437ddf))||_0x52f173;}return _0x2fb307>0x3&&_0x52f173&&Object[_0x1ff2ea(0x12b)](_0x3c2a75,_0x437ddf,_0x52f173),_0x52f173;},__metadata=this&&this['__metadata']||function(_0x5ad05b,_0x1709d8){const _0x3bccc0=a87_0x574104;if(typeof Reflect==='object'&&typeof Reflect[_0x3bccc0(0x100)]===_0x3bccc0(0xfe))return Reflect[_0x3bccc0(0x100)](_0x5ad05b,_0x1709d8);},__param=this&&this['__param']||function(_0x3093f4,_0x36c701){return function(_0x2d349a,_0x51966b){_0x36c701(_0x2d349a,_0x51966b,_0x3093f4);};},PlaylistService_1;Object[a87_0x574104(0x12b)](exports,a87_0x574104(0x10b),{'value':!![]}),exports[a87_0x574104(0x135)]=void 0x0;const common_1=require(a87_0x574104(0x13f)),mongoose_1=require(a87_0x574104(0x104)),mongoose_2=require(a87_0x574104(0x102)),event_emitter_1=require(a87_0x574104(0x108)),sound_service_1=require(a87_0x574104(0x119)),job_1=require(a87_0x574104(0x12d)),events_1=require(a87_0x574104(0x121)),agenda_service_1=require(a87_0x574104(0x148)),playlist_mapper_1=require(a87_0x574104(0x128)),enums_1=require(a87_0x574104(0xf6)),path=require(a87_0x574104(0x11f)),path_1=require(a87_0x574104(0x123)),audio_player_1=require(a87_0x574104(0x11c)),sound_gateway_1=require('../sound/sound.gateway');let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x12a50e,_0x20a63e,_0x53c2c5,_0x5eca3d){const _0x3b0448=a87_0x574104;this[_0x3b0448(0x138)]=_0x12a50e,this[_0x3b0448(0x12e)]=_0x20a63e,this['agendaService']=_0x53c2c5,this[_0x3b0448(0x140)]=_0x5eca3d,this['logger']=new common_1['Logger'](PlaylistService_1[_0x3b0448(0xfd)]);}async[a87_0x574104(0x134)](_0x5c3c49){const _0x10810f=a87_0x574104,_0x3dcca5=new this['playlistModel'](_0x5c3c49);return _0x3dcca5[_0x10810f(0x109)]();}async[a87_0x574104(0xf8)](){const _0x2a7514=a87_0x574104,_0x157c87=await this[_0x2a7514(0x138)]['find']()[_0x2a7514(0x12f)](),_0x48ceea=_0x157c87[_0x2a7514(0x10a)](async _0x320f5c=>{const _0xbffb94=_0x2a7514,_0x1974bf=await this[_0xbffb94(0x12e)][_0xbffb94(0x106)](_0x320f5c[_0xbffb94(0xf4)]);return(0x0,playlist_mapper_1[_0xbffb94(0x132)])(_0x320f5c,_0x1974bf);});return await Promise[_0x2a7514(0x133)](_0x48ceea);}async[a87_0x574104(0x126)](_0x4ace3a){const _0x4db96a=a87_0x574104,_0x39982d=await this[_0x4db96a(0x138)][_0x4db96a(0x147)](_0x4ace3a),_0x3d7d9e=await this[_0x4db96a(0x12e)][_0x4db96a(0x106)](_0x39982d[_0x4db96a(0xf4)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x39982d,_0x3d7d9e);}async[a87_0x574104(0x129)](_0x8734d5,_0xfb1898){const _0x3f9732=a87_0x574104,_0xce3d25=await this['playlistModel'][_0x3f9732(0x13c)](_0x8734d5,Object[_0x3f9732(0x118)](Object[_0x3f9732(0x118)]({},_0xfb1898),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x227698=await this[_0x3f9732(0x12e)][_0x3f9732(0x106)](_0xce3d25[_0x3f9732(0xf4)]);return(0x0,playlist_mapper_1[_0x3f9732(0x132)])(_0xce3d25,_0x227698);}async['delete'](_0xaf912e){const _0x1bb9b8=a87_0x574104;return await this['playlistModel'][_0x1bb9b8(0x113)](_0xaf912e);}async['addSong'](_0x3fe33f,_0xa6718f){const _0x41fce9=a87_0x574104,_0x495206=await this[_0x41fce9(0x138)][_0x41fce9(0x147)](_0x3fe33f);return _0x495206['soundIds'][_0x41fce9(0x142)](_0xa6718f),await _0x495206[_0x41fce9(0x109)]();}async[a87_0x574104(0x130)](_0x1bd3a2,_0x411c1f){const _0x130649=a87_0x574104,_0x53dc41=await this[_0x130649(0x138)]['findById'](_0x1bd3a2);return _0x53dc41[_0x130649(0xf4)]=_0x53dc41[_0x130649(0xf4)][_0x130649(0x131)](_0x1ffc0c=>_0x1ffc0c!==_0x411c1f),await _0x53dc41[_0x130649(0x109)]();}async[a87_0x574104(0x114)](_0xa5a1c0,_0x28b824){const _0x5593de=a87_0x574104,_0x20107b={'when':_0x5593de(0x125),'jobType':enums_1[_0x5593de(0x10c)]['PlayMusic'],'attributes':{'playlistId':_0x28b824},'audit':{'actor':_0xa5a1c0,'name':enums_1['JobType'][_0x5593de(0xf9)],'message':'Play\x20Music\x20Playlist:\x20'+_0x28b824}},{jobId:_0x30570b}=await this['agendaService'][_0x5593de(0x120)](_0x20107b);return this[_0x5593de(0x129)](_0x28b824,{'jobId':_0x30570b});}async[a87_0x574104(0x139)](_0x12f1d6){const _0x22241c=a87_0x574104;let _0x58cc42=await this[_0x22241c(0x126)](_0x12f1d6);const {jobId:_0x599dfb}=_0x58cc42||{};if(_0x599dfb){const {success:_0x1d67a7}=await this[_0x22241c(0x136)]['cancelJob'](_0x599dfb);_0x1d67a7&&(_0x58cc42=await this[_0x22241c(0x129)](_0x12f1d6,{'jobId':null}));}return this[_0x22241c(0x140)][_0x22241c(0x116)]({'id':_0x58cc42[_0x22241c(0x101)],'isPlaying':![]}),_0x58cc42;}async[a87_0x574104(0xfb)](_0x29b224){const _0x56ca1f=a87_0x574104,{playlistId:_0x41d1d9,jobId:_0x583a61,durationInSecond:_0xe6a8c7}=_0x29b224,_0xd73585=await this['playlistModel'][_0x56ca1f(0x147)](_0x41d1d9),_0x4bc70f=[..._0xd73585[_0x56ca1f(0xf4)]],_0x4db45c=await this['soundService'][_0x56ca1f(0x106)](_0x4bc70f),_0x23b27c=_0x4db45c[_0x56ca1f(0x10a)](_0x43e86f=>path['join'](path_1[_0x56ca1f(0xff)],_0x56ca1f(0x137),_0x56ca1f(0x11a),_0x43e86f[_0x56ca1f(0x105)]));job_1['PROCESS_CACHE']['killAll'](),this[_0x56ca1f(0xfa)][_0x56ca1f(0x13e)](_0x56ca1f(0x117)+_0x41d1d9+_0x56ca1f(0x115)+_0xd73585[_0x56ca1f(0xfd)]),(0x0,job_1[_0x56ca1f(0xfc)])({'jobId':_0x583a61,'run':()=>audio_player_1[_0x56ca1f(0x122)][_0x56ca1f(0x10d)](_0x23b27c,0x32,_0xd73585['isShuffle']),'durationInSecond':_0xe6a8c7,'next':()=>this[_0x56ca1f(0x139)](_0x41d1d9)}),this[_0x56ca1f(0x140)][_0x56ca1f(0x116)]({'id':_0x41d1d9,'isPlaying':!![]});}};function a87_0x4303(_0x595d28,_0x6cabc3){const _0x338f11=a87_0x338f();return a87_0x4303=function(_0x4303ee,_0x16434d){_0x4303ee=_0x4303ee-0xf4;let _0x3306be=_0x338f11[_0x4303ee];return _0x3306be;},a87_0x4303(_0x595d28,_0x6cabc3);}function a87_0x338f(){const _0x4f5cb0=['map','__esModule','JobType','playAsync','decorate','12JjMYAW','Play','Inject','design:paramtypes','findByIdAndDelete','play','\x20-\x20','broadcastPlaying','Playing\x20playlist:\x20','assign','../sound/sound.service','audio','getOwnPropertyDescriptor','../common/audio/audio-player','Model','SoundGateway','path','scheduleJob','../common/events','AudioPlayer','../common/path','length','now','findOne','1125856QiHYUP','./mapper/playlist.mapper','update','__decorate','defineProperty','69765ugVXlz','../common/job','soundService','exec','removeSong','filter','mapToDto','all','create','PlaylistService','agendaService','assets','playlistModel','stop','22182VtfbqD','5506884AIyOtt','findByIdAndUpdate','30961SZjuKI','log','@nestjs/common','soundGateway','object','push','AgendaService','177640cOwkcC','SoundService','design:type','findById','../agenda/agenda.service','soundIds','prototype','../common/enums','291015ybnuKg','findAll','PlayMusic','logger','playFromEvent','executeJob','name','function','processRootPath','metadata','_id','@nestjs/mongoose','PlaylistEvent','mongoose','fileName','findByIds','69IdlfCH','@nestjs/event-emitter','save'];a87_0x338f=function(){return _0x4f5cb0;};return a87_0x338f();}__decorate([(0x0,event_emitter_1['OnEvent'])(events_1[a87_0x574104(0x103)][a87_0x574104(0x110)]),__metadata(a87_0x574104(0x146),Function),__metadata(a87_0x574104(0x112),[Object]),__metadata('design:returntype',Promise)],PlaylistService[a87_0x574104(0xf5)],'playFromEvent',null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_2['InjectModel'])('Playlist')),__param(0x3,(0x0,common_1[a87_0x574104(0x111)])(sound_gateway_1[a87_0x574104(0x11e)])),__metadata('design:paramtypes',[mongoose_1[a87_0x574104(0x11d)],sound_service_1[a87_0x574104(0x145)],agenda_service_1[a87_0x574104(0x143)],sound_gateway_1[a87_0x574104(0x11e)]])],PlaylistService),exports[a87_0x574104(0x135)]=PlaylistService;