'use strict';const a87_0x3f1a55=a87_0x5110;(function(_0x261cd3,_0xbbbdb1){const _0x5c56e0=a87_0x5110,_0x21b2fc=_0x261cd3();while(!![]){try{const _0x3f0344=parseInt(_0x5c56e0(0x213))/0x1*(-parseInt(_0x5c56e0(0x208))/0x2)+parseInt(_0x5c56e0(0x1d3))/0x3+parseInt(_0x5c56e0(0x1d5))/0x4+parseInt(_0x5c56e0(0x1c5))/0x5*(-parseInt(_0x5c56e0(0x1c7))/0x6)+parseInt(_0x5c56e0(0x1c6))/0x7+-parseInt(_0x5c56e0(0x1c8))/0x8+-parseInt(_0x5c56e0(0x202))/0x9*(-parseInt(_0x5c56e0(0x1e7))/0xa);if(_0x3f0344===_0xbbbdb1)break;else _0x21b2fc['push'](_0x21b2fc['shift']());}catch(_0x11038e){_0x21b2fc['push'](_0x21b2fc['shift']());}}}(a87_0x3a0b,0x63a87));function a87_0x3a0b(){const _0x127681=['prototype','getOwnPropertyDescriptor','mapToDto','../common/audio/audio-player','soundGateway','Playing\x20playlist:\x20','find','2pvGHia','Playlist','audio','../common/path','object','../sound/sound.gateway','3273980ltwtiT','2819915QZSBQX','6yKDbft','4118096EKvGFP','findAll','Model','JobType','Play','broadcastPlaying','save','mongoose','design:returntype','isShuffle','findByIdAndUpdate','805611bbGFQI','log','1733268uiCefs','__param','PROCESS_CACHE','length','OnEvent','PlaylistEvent','soundIds','findOne','@nestjs/event-emitter','soundService','processRootPath','removeSong','../common/enums','now','AudioPlayer','name','__metadata','findByIdAndDelete','1340OhcGaA','SoundService','__decorate','../common/events','Logger','@nestjs/mongoose','cancelJob','exec','function','playAsync','decorate','design:paramtypes','update','delete','agendaService','path','playFromEvent','PlaylistService','findById','Play\x20Music\x20Playlist:\x20','assets','scheduleJob','defineProperty','findByIds','SoundGateway','../agenda/agenda.service','create','32985vWDedw','../sound/sound.service','playlistModel','filter','logger','executeJob','18052kdMvRe','Inject','metadata','all'];a87_0x3a0b=function(){return _0x127681;};return a87_0x3a0b();}var __decorate=this&&this[a87_0x3f1a55(0x1e9)]||function(_0xcaab6c,_0x55a8ed,_0x5a740f,_0x3b0a13){const _0x36c3c2=a87_0x3f1a55;var _0x3be7dd=arguments[_0x36c3c2(0x1d8)],_0x301780=_0x3be7dd<0x3?_0x55a8ed:_0x3b0a13===null?_0x3b0a13=Object[_0x36c3c2(0x20d)](_0x55a8ed,_0x5a740f):_0x3b0a13,_0x251422;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x36c3c2(0x1ef))_0x301780=Reflect[_0x36c3c2(0x1f1)](_0xcaab6c,_0x55a8ed,_0x5a740f,_0x3b0a13);else{for(var _0x110524=_0xcaab6c['length']-0x1;_0x110524>=0x0;_0x110524--)if(_0x251422=_0xcaab6c[_0x110524])_0x301780=(_0x3be7dd<0x3?_0x251422(_0x301780):_0x3be7dd>0x3?_0x251422(_0x55a8ed,_0x5a740f,_0x301780):_0x251422(_0x55a8ed,_0x5a740f))||_0x301780;}return _0x3be7dd>0x3&&_0x301780&&Object[_0x36c3c2(0x1fd)](_0x55a8ed,_0x5a740f,_0x301780),_0x301780;},__metadata=this&&this[a87_0x3f1a55(0x1e5)]||function(_0x292bf6,_0x5865ae){const _0x33b77e=a87_0x3f1a55;if(typeof Reflect===_0x33b77e(0x217)&&typeof Reflect[_0x33b77e(0x20a)]===_0x33b77e(0x1ef))return Reflect[_0x33b77e(0x20a)](_0x292bf6,_0x5865ae);},__param=this&&this[a87_0x3f1a55(0x1d6)]||function(_0x7d732,_0x327cc1){return function(_0x1906ab,_0x49bbd9){_0x327cc1(_0x1906ab,_0x49bbd9,_0x7d732);};},PlaylistService_1;Object[a87_0x3f1a55(0x1fd)](exports,'__esModule',{'value':!![]}),exports['PlaylistService']=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a87_0x3f1a55(0x1cf)),mongoose_2=require(a87_0x3f1a55(0x1ec)),event_emitter_1=require(a87_0x3f1a55(0x1dd)),sound_service_1=require(a87_0x3f1a55(0x203)),job_1=require('../common/job'),events_1=require(a87_0x3f1a55(0x1ea)),agenda_service_1=require(a87_0x3f1a55(0x200)),playlist_mapper_1=require('./mapper/playlist.mapper'),enums_1=require(a87_0x3f1a55(0x1e1)),path=require(a87_0x3f1a55(0x1f6)),path_1=require(a87_0x3f1a55(0x216)),audio_player_1=require(a87_0x3f1a55(0x20f)),sound_gateway_1=require(a87_0x3f1a55(0x218));let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x58eb5e,_0x2149c3,_0x1c1581,_0x588c47){const _0xcc2425=a87_0x3f1a55;this[_0xcc2425(0x204)]=_0x58eb5e,this[_0xcc2425(0x1de)]=_0x2149c3,this[_0xcc2425(0x1f5)]=_0x1c1581,this[_0xcc2425(0x210)]=_0x588c47,this[_0xcc2425(0x206)]=new common_1[(_0xcc2425(0x1eb))](PlaylistService_1[_0xcc2425(0x1e4)]);}async[a87_0x3f1a55(0x201)](_0x2f1432){const _0x5f42a7=a87_0x3f1a55,_0x4a631d=new this['playlistModel'](_0x2f1432);return _0x4a631d[_0x5f42a7(0x1ce)]();}async[a87_0x3f1a55(0x1c9)](){const _0x45b1fb=a87_0x3f1a55,_0x55f9dc=await this[_0x45b1fb(0x204)][_0x45b1fb(0x212)]()[_0x45b1fb(0x1ee)](),_0x2f11e2=_0x55f9dc['map'](async _0x44a3c3=>{const _0x13f4a4=_0x45b1fb,_0x386344=await this[_0x13f4a4(0x1de)][_0x13f4a4(0x1fe)](_0x44a3c3[_0x13f4a4(0x1db)]);return(0x0,playlist_mapper_1[_0x13f4a4(0x20e)])(_0x44a3c3,_0x386344);});return await Promise[_0x45b1fb(0x20b)](_0x2f11e2);}async[a87_0x3f1a55(0x1dc)](_0x8c6bab){const _0x4fdf83=a87_0x3f1a55,_0x50b3d1=await this[_0x4fdf83(0x204)][_0x4fdf83(0x1f9)](_0x8c6bab),_0x400c64=await this[_0x4fdf83(0x1de)][_0x4fdf83(0x1fe)](_0x50b3d1[_0x4fdf83(0x1db)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x50b3d1,_0x400c64);}async[a87_0x3f1a55(0x1f3)](_0x204f63,_0x4bc4cd){const _0x576524=a87_0x3f1a55,_0x4bcb7b=await this[_0x576524(0x204)][_0x576524(0x1d2)](_0x204f63,Object['assign'](Object['assign']({},_0x4bc4cd),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x6782ad=await this['soundService']['findByIds'](_0x4bcb7b[_0x576524(0x1db)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x4bcb7b,_0x6782ad);}async[a87_0x3f1a55(0x1f4)](_0x22fe57){const _0x48bf0a=a87_0x3f1a55;return await this[_0x48bf0a(0x204)][_0x48bf0a(0x1e6)](_0x22fe57);}async['addSong'](_0x284527,_0x505450){const _0x30001e=a87_0x3f1a55,_0x2d8d23=await this[_0x30001e(0x204)]['findById'](_0x284527);return _0x2d8d23[_0x30001e(0x1db)]['push'](_0x505450),await _0x2d8d23['save']();}async[a87_0x3f1a55(0x1e0)](_0x166581,_0x4c9113){const _0x3e7e1e=a87_0x3f1a55,_0x49ed42=await this[_0x3e7e1e(0x204)]['findById'](_0x166581);return _0x49ed42[_0x3e7e1e(0x1db)]=_0x49ed42[_0x3e7e1e(0x1db)][_0x3e7e1e(0x205)](_0x1e9290=>_0x1e9290!==_0x4c9113),await _0x49ed42[_0x3e7e1e(0x1ce)]();}async['play'](_0x5a1f36,_0x12a9f0){const _0xc46084=a87_0x3f1a55,_0x450e58={'when':_0xc46084(0x1e2),'jobType':enums_1['JobType']['PlayMusic'],'attributes':{'playlistId':_0x12a9f0},'audit':{'actor':_0x5a1f36,'name':enums_1[_0xc46084(0x1cb)]['PlayMusic'],'message':_0xc46084(0x1fa)+_0x12a9f0}},{jobId:_0x5782e5}=await this[_0xc46084(0x1f5)][_0xc46084(0x1fc)](_0x450e58);return this['update'](_0x12a9f0,{'jobId':_0x5782e5});}async['stop'](_0x6e728d){const _0x45fcc2=a87_0x3f1a55;let _0x20cb47=await this['findOne'](_0x6e728d);const {jobId:_0xed24ea}=_0x20cb47||{};if(_0xed24ea){const {success:_0x5c6a33}=await this[_0x45fcc2(0x1f5)][_0x45fcc2(0x1ed)](_0xed24ea);_0x5c6a33&&(_0x20cb47=await this[_0x45fcc2(0x1f3)](_0x6e728d,{'jobId':null}));}return this[_0x45fcc2(0x210)][_0x45fcc2(0x1cd)]({'id':_0x20cb47['_id'],'isPlaying':![]}),_0x20cb47;}async[a87_0x3f1a55(0x1f7)](_0x4a560c){const _0x45b768=a87_0x3f1a55,{playlistId:_0x5c8280,jobId:_0x577e64,durationInSecond:_0x7f4357}=_0x4a560c,_0x34fade=await this[_0x45b768(0x204)][_0x45b768(0x1f9)](_0x5c8280),_0x17af26=[..._0x34fade['soundIds']],_0x1c3e42=await this['soundService'][_0x45b768(0x1fe)](_0x17af26),_0x289b00=_0x1c3e42['map'](_0x5e9204=>path['join'](path_1[_0x45b768(0x1df)],_0x45b768(0x1fb),_0x45b768(0x215),_0x5e9204['fileName']));job_1[_0x45b768(0x1d7)]['killAll'](),this[_0x45b768(0x206)][_0x45b768(0x1d4)](_0x45b768(0x211)+_0x5c8280+'\x20-\x20'+_0x34fade['name']),(0x0,job_1[_0x45b768(0x207)])({'jobId':_0x577e64,'run':()=>audio_player_1[_0x45b768(0x1e3)][_0x45b768(0x1f0)](_0x289b00,0x32,_0x34fade[_0x45b768(0x1d1)]),'durationInSecond':_0x7f4357,'next':()=>this['stop'](_0x5c8280)}),this['soundGateway'][_0x45b768(0x1cd)]({'id':_0x5c8280,'isPlaying':!![]});}};function a87_0x5110(_0x49323a,_0x2976e0){const _0x3a0bd7=a87_0x3a0b();return a87_0x5110=function(_0x511086,_0x40e111){_0x511086=_0x511086-0x1c5;let _0x13e29f=_0x3a0bd7[_0x511086];return _0x13e29f;},a87_0x5110(_0x49323a,_0x2976e0);}__decorate([(0x0,event_emitter_1[a87_0x3f1a55(0x1d9)])(events_1[a87_0x3f1a55(0x1da)][a87_0x3f1a55(0x1cc)]),__metadata('design:type',Function),__metadata('design:paramtypes',[Object]),__metadata(a87_0x3f1a55(0x1d0),Promise)],PlaylistService[a87_0x3f1a55(0x20c)],'playFromEvent',null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_2['InjectModel'])(a87_0x3f1a55(0x214))),__param(0x3,(0x0,common_1[a87_0x3f1a55(0x209)])(sound_gateway_1[a87_0x3f1a55(0x1ff)])),__metadata(a87_0x3f1a55(0x1f2),[mongoose_1[a87_0x3f1a55(0x1ca)],sound_service_1[a87_0x3f1a55(0x1e8)],agenda_service_1['AgendaService'],sound_gateway_1[a87_0x3f1a55(0x1ff)]])],PlaylistService),exports[a87_0x3f1a55(0x1f8)]=PlaylistService;