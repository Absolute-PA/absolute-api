'use strict';function a90_0x107b(_0x15f350,_0x8672fb){const _0x18e489=a90_0x18e4();return a90_0x107b=function(_0x107bdc,_0x107851){_0x107bdc=_0x107bdc-0x14e;let _0x514771=_0x18e489[_0x107bdc];return _0x514771;},a90_0x107b(_0x15f350,_0x8672fb);}const a90_0x24a4f6=a90_0x107b;(function(_0x17b624,_0x21fd9f){const _0x2bad4f=a90_0x107b,_0x3762a2=_0x17b624();while(!![]){try{const _0xf3f92a=parseInt(_0x2bad4f(0x172))/0x1*(-parseInt(_0x2bad4f(0x16f))/0x2)+-parseInt(_0x2bad4f(0x14f))/0x3+-parseInt(_0x2bad4f(0x150))/0x4+parseInt(_0x2bad4f(0x184))/0x5*(-parseInt(_0x2bad4f(0x164))/0x6)+parseInt(_0x2bad4f(0x15e))/0x7*(-parseInt(_0x2bad4f(0x1a2))/0x8)+parseInt(_0x2bad4f(0x19f))/0x9+parseInt(_0x2bad4f(0x168))/0xa*(parseInt(_0x2bad4f(0x191))/0xb);if(_0xf3f92a===_0x21fd9f)break;else _0x3762a2['push'](_0x3762a2['shift']());}catch(_0xbfe4ac){_0x3762a2['push'](_0x3762a2['shift']());}}}(a90_0x18e4,0x3c01e));function a90_0x18e4(){const _0x34d162=['1010IPDgRd','Injectable','addSong','assign','../common/path','playAsync','PlaylistService','JobType','InjectModel','../common/audio/audio-player','__decorate','length','findOne','124377HrAbat','design:paramtypes','PROCESS_CACHE','removeSong','soundIds','../agenda/agenda.service','Model','../sound/sound.gateway','__param','@nestjs/event-emitter','assets','stop','prototype','save','3237741cHMWtN','AudioPlayer','killAll','2271664agWsJL','Playlist','join','PlaylistEvent','@nestjs/common','mongoose','Playing\x20playlist:\x20','fileName','../sound/sound.service','function','AgendaService','97509GVixLD','649684gaRSzx','log','scheduleJob','soundService','map','play','Inject','defineProperty','soundGateway','filter','audio','agendaService','all','design:type','7CbaLbp','Play','path','decorate','../common/enums','OnEvent','7284EuEOjv','isShuffle','__metadata','broadcastPlaying','910lEDlZf','logger','object','playlistModel','PlayMusic','_id','update','4PKDTCe','now','delete','209393PbRnSW','SoundGateway','processRootPath','create','name','__esModule','design:returntype','findByIdAndUpdate','findByIdAndDelete','findById','./mapper/playlist.mapper','@nestjs/mongoose','../common/events','getOwnPropertyDescriptor','findByIds','mapToDto','metadata','playFromEvent'];a90_0x18e4=function(){return _0x34d162;};return a90_0x18e4();}var __decorate=this&&this[a90_0x24a4f6(0x18e)]||function(_0x4ee857,_0x352a5d,_0x3948be,_0x5ee165){const _0x378d51=a90_0x24a4f6;var _0x1afee7=arguments[_0x378d51(0x18f)],_0x5e84fe=_0x1afee7<0x3?_0x352a5d:_0x5ee165===null?_0x5ee165=Object[_0x378d51(0x17f)](_0x352a5d,_0x3948be):_0x5ee165,_0x2a9c6f;if(typeof Reflect===_0x378d51(0x16a)&&typeof Reflect[_0x378d51(0x161)]==='function')_0x5e84fe=Reflect[_0x378d51(0x161)](_0x4ee857,_0x352a5d,_0x3948be,_0x5ee165);else{for(var _0x4f3c79=_0x4ee857[_0x378d51(0x18f)]-0x1;_0x4f3c79>=0x0;_0x4f3c79--)if(_0x2a9c6f=_0x4ee857[_0x4f3c79])_0x5e84fe=(_0x1afee7<0x3?_0x2a9c6f(_0x5e84fe):_0x1afee7>0x3?_0x2a9c6f(_0x352a5d,_0x3948be,_0x5e84fe):_0x2a9c6f(_0x352a5d,_0x3948be))||_0x5e84fe;}return _0x1afee7>0x3&&_0x5e84fe&&Object[_0x378d51(0x157)](_0x352a5d,_0x3948be,_0x5e84fe),_0x5e84fe;},__metadata=this&&this[a90_0x24a4f6(0x166)]||function(_0xe00b8c,_0x440018){const _0x2b446c=a90_0x24a4f6;if(typeof Reflect===_0x2b446c(0x16a)&&typeof Reflect[_0x2b446c(0x182)]===_0x2b446c(0x1ab))return Reflect[_0x2b446c(0x182)](_0xe00b8c,_0x440018);},__param=this&&this[a90_0x24a4f6(0x199)]||function(_0x4e88aa,_0x55e264){return function(_0x5094bd,_0x1b2cc7){_0x55e264(_0x5094bd,_0x1b2cc7,_0x4e88aa);};},PlaylistService_1;Object[a90_0x24a4f6(0x157)](exports,a90_0x24a4f6(0x177),{'value':!![]}),exports['PlaylistService']=void 0x0;const common_1=require(a90_0x24a4f6(0x1a6)),mongoose_1=require(a90_0x24a4f6(0x1a7)),mongoose_2=require(a90_0x24a4f6(0x17d)),event_emitter_1=require(a90_0x24a4f6(0x19a)),sound_service_1=require(a90_0x24a4f6(0x1aa)),job_1=require('../common/job'),events_1=require(a90_0x24a4f6(0x17e)),agenda_service_1=require(a90_0x24a4f6(0x196)),playlist_mapper_1=require(a90_0x24a4f6(0x17c)),enums_1=require(a90_0x24a4f6(0x162)),path=require(a90_0x24a4f6(0x160)),path_1=require(a90_0x24a4f6(0x188)),audio_player_1=require(a90_0x24a4f6(0x18d)),sound_gateway_1=require(a90_0x24a4f6(0x198));let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0xb1812e,_0x56f73d,_0x4effec,_0x42e6bf){const _0x5686ca=a90_0x24a4f6;this[_0x5686ca(0x16b)]=_0xb1812e,this[_0x5686ca(0x153)]=_0x56f73d,this[_0x5686ca(0x15b)]=_0x4effec,this[_0x5686ca(0x158)]=_0x42e6bf,this[_0x5686ca(0x169)]=new common_1['Logger'](PlaylistService_1[_0x5686ca(0x176)]);}async[a90_0x24a4f6(0x175)](_0x2f569f){const _0x37e3c5=a90_0x24a4f6,_0x494a6e=new this[(_0x37e3c5(0x16b))](_0x2f569f);return _0x494a6e['save']();}async['findAll'](){const _0x339ca4=a90_0x24a4f6,_0x31c07e=await this['playlistModel']['find']()['exec'](),_0x2cacf5=_0x31c07e[_0x339ca4(0x154)](async _0x58f94a=>{const _0x3221e0=_0x339ca4,_0x12d63=await this[_0x3221e0(0x153)][_0x3221e0(0x180)](_0x58f94a[_0x3221e0(0x195)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x58f94a,_0x12d63);});return await Promise[_0x339ca4(0x15c)](_0x2cacf5);}async[a90_0x24a4f6(0x190)](_0x548f41){const _0x1219a7=a90_0x24a4f6,_0x26a275=await this[_0x1219a7(0x16b)]['findById'](_0x548f41),_0x2d92c5=await this[_0x1219a7(0x153)]['findByIds'](_0x26a275[_0x1219a7(0x195)]);return(0x0,playlist_mapper_1[_0x1219a7(0x181)])(_0x26a275,_0x2d92c5);}async[a90_0x24a4f6(0x16e)](_0x3f2a18,_0x1da06){const _0x5cb411=a90_0x24a4f6,_0x3774b7=await this[_0x5cb411(0x16b)][_0x5cb411(0x179)](_0x3f2a18,Object[_0x5cb411(0x187)](Object['assign']({},_0x1da06),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x3dfd48=await this[_0x5cb411(0x153)][_0x5cb411(0x180)](_0x3774b7[_0x5cb411(0x195)]);return(0x0,playlist_mapper_1[_0x5cb411(0x181)])(_0x3774b7,_0x3dfd48);}async[a90_0x24a4f6(0x171)](_0x5735a1){const _0x5bafd7=a90_0x24a4f6;return await this[_0x5bafd7(0x16b)][_0x5bafd7(0x17a)](_0x5735a1);}async[a90_0x24a4f6(0x186)](_0x5dfc79,_0x25323f){const _0x729028=a90_0x24a4f6,_0xe232fe=await this[_0x729028(0x16b)]['findById'](_0x5dfc79);return _0xe232fe[_0x729028(0x195)]['push'](_0x25323f),await _0xe232fe[_0x729028(0x19e)]();}async[a90_0x24a4f6(0x194)](_0x585cb0,_0x4a9bd9){const _0x4f13d4=a90_0x24a4f6,_0x36bf88=await this[_0x4f13d4(0x16b)][_0x4f13d4(0x17b)](_0x585cb0);return _0x36bf88[_0x4f13d4(0x195)]=_0x36bf88[_0x4f13d4(0x195)][_0x4f13d4(0x159)](_0x58c16f=>_0x58c16f!==_0x4a9bd9),await _0x36bf88[_0x4f13d4(0x19e)]();}async[a90_0x24a4f6(0x155)](_0x560ddf,_0x269b73){const _0x475dab=a90_0x24a4f6,_0xa72702={'when':_0x475dab(0x170),'jobType':enums_1[_0x475dab(0x18b)][_0x475dab(0x16c)],'attributes':{'playlistId':_0x269b73},'audit':{'actor':_0x560ddf,'name':enums_1[_0x475dab(0x18b)][_0x475dab(0x16c)],'message':'Play\x20Music\x20Playlist:\x20'+_0x269b73}},{jobId:_0x5cba05}=await this[_0x475dab(0x15b)][_0x475dab(0x152)](_0xa72702);return this['update'](_0x269b73,{'jobId':_0x5cba05});}async[a90_0x24a4f6(0x19c)](_0x2f24f9){const _0x208c9e=a90_0x24a4f6;let _0x274050=await this[_0x208c9e(0x190)](_0x2f24f9);const {jobId:_0x2f5526}=_0x274050||{};if(_0x2f5526){const {success:_0x5f33ca}=await this[_0x208c9e(0x15b)]['cancelJob'](_0x2f5526);_0x5f33ca&&(_0x274050=await this[_0x208c9e(0x16e)](_0x2f24f9,{'jobId':null}));}return this[_0x208c9e(0x158)][_0x208c9e(0x167)]({'id':_0x274050[_0x208c9e(0x16d)],'isPlaying':![]}),_0x274050;}async[a90_0x24a4f6(0x183)](_0x244961){const _0x5d5add=a90_0x24a4f6,{playlistId:_0x14a9ae,jobId:_0x4ea1a8,durationInSecond:_0x145813}=_0x244961,_0x37cfb7=await this[_0x5d5add(0x16b)][_0x5d5add(0x17b)](_0x14a9ae),_0x291ae1=[..._0x37cfb7[_0x5d5add(0x195)]],_0x403d48=await this[_0x5d5add(0x153)][_0x5d5add(0x180)](_0x291ae1),_0x334672=_0x403d48[_0x5d5add(0x154)](_0x156b67=>path[_0x5d5add(0x1a4)](path_1[_0x5d5add(0x174)],_0x5d5add(0x19b),_0x5d5add(0x15a),_0x156b67[_0x5d5add(0x1a9)]));job_1[_0x5d5add(0x193)][_0x5d5add(0x1a1)](),this[_0x5d5add(0x169)][_0x5d5add(0x151)](_0x5d5add(0x1a8)+_0x14a9ae+'\x20-\x20'+_0x37cfb7[_0x5d5add(0x176)]),(0x0,job_1['executeJob'])({'jobId':_0x4ea1a8,'run':()=>audio_player_1[_0x5d5add(0x1a0)][_0x5d5add(0x189)](_0x334672,0x32,_0x37cfb7[_0x5d5add(0x165)]),'durationInSecond':_0x145813,'next':()=>this[_0x5d5add(0x19c)](_0x14a9ae)}),this[_0x5d5add(0x158)][_0x5d5add(0x167)]({'id':_0x14a9ae,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1[a90_0x24a4f6(0x163)])(events_1[a90_0x24a4f6(0x1a5)][a90_0x24a4f6(0x15f)]),__metadata(a90_0x24a4f6(0x15d),Function),__metadata(a90_0x24a4f6(0x192),[Object]),__metadata(a90_0x24a4f6(0x178),Promise)],PlaylistService[a90_0x24a4f6(0x19d)],a90_0x24a4f6(0x183),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a90_0x24a4f6(0x185)])(),__param(0x0,(0x0,mongoose_2[a90_0x24a4f6(0x18c)])(a90_0x24a4f6(0x1a3))),__param(0x3,(0x0,common_1[a90_0x24a4f6(0x156)])(sound_gateway_1[a90_0x24a4f6(0x173)])),__metadata(a90_0x24a4f6(0x192),[mongoose_1[a90_0x24a4f6(0x197)],sound_service_1['SoundService'],agenda_service_1[a90_0x24a4f6(0x14e)],sound_gateway_1[a90_0x24a4f6(0x173)]])],PlaylistService),exports[a90_0x24a4f6(0x18a)]=PlaylistService;