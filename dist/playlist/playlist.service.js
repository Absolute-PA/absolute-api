'use strict';const a90_0x3f52e9=a90_0xef72;(function(_0x3a933f,_0x242c3a){const _0x120be1=a90_0xef72,_0x22c137=_0x3a933f();while(!![]){try{const _0x4eae67=parseInt(_0x120be1(0x184))/0x1*(parseInt(_0x120be1(0x170))/0x2)+parseInt(_0x120be1(0x140))/0x3*(parseInt(_0x120be1(0x17d))/0x4)+parseInt(_0x120be1(0x135))/0x5*(parseInt(_0x120be1(0x171))/0x6)+-parseInt(_0x120be1(0x14b))/0x7*(parseInt(_0x120be1(0x16c))/0x8)+-parseInt(_0x120be1(0x137))/0x9*(-parseInt(_0x120be1(0x172))/0xa)+parseInt(_0x120be1(0x15b))/0xb+parseInt(_0x120be1(0x188))/0xc*(-parseInt(_0x120be1(0x154))/0xd);if(_0x4eae67===_0x242c3a)break;else _0x22c137['push'](_0x22c137['shift']());}catch(_0x2e2ea5){_0x22c137['push'](_0x22c137['shift']());}}}(a90_0x3be6,0x2c7c3));var __decorate=this&&this[a90_0x3f52e9(0x158)]||function(_0x2f86a7,_0x5b37d3,_0x13f922,_0x38603c){const _0x583ad2=a90_0x3f52e9;var _0x4f9d89=arguments[_0x583ad2(0x134)],_0x28c102=_0x4f9d89<0x3?_0x5b37d3:_0x38603c===null?_0x38603c=Object[_0x583ad2(0x17c)](_0x5b37d3,_0x13f922):_0x38603c,_0x196335;if(typeof Reflect==='object'&&typeof Reflect[_0x583ad2(0x181)]==='function')_0x28c102=Reflect[_0x583ad2(0x181)](_0x2f86a7,_0x5b37d3,_0x13f922,_0x38603c);else{for(var _0x231354=_0x2f86a7[_0x583ad2(0x134)]-0x1;_0x231354>=0x0;_0x231354--)if(_0x196335=_0x2f86a7[_0x231354])_0x28c102=(_0x4f9d89<0x3?_0x196335(_0x28c102):_0x4f9d89>0x3?_0x196335(_0x5b37d3,_0x13f922,_0x28c102):_0x196335(_0x5b37d3,_0x13f922))||_0x28c102;}return _0x4f9d89>0x3&&_0x28c102&&Object['defineProperty'](_0x5b37d3,_0x13f922,_0x28c102),_0x28c102;},__metadata=this&&this[a90_0x3f52e9(0x13f)]||function(_0x1fa091,_0x25f63e){const _0x405db5=a90_0x3f52e9;if(typeof Reflect===_0x405db5(0x13c)&&typeof Reflect[_0x405db5(0x149)]===_0x405db5(0x182))return Reflect['metadata'](_0x1fa091,_0x25f63e);},__param=this&&this[a90_0x3f52e9(0x16a)]||function(_0xbf70e,_0xc01b4b){return function(_0x5a671e,_0x16eb22){_0xc01b4b(_0x5a671e,_0x16eb22,_0xbf70e);};},PlaylistService_1;Object[a90_0x3f52e9(0x157)](exports,a90_0x3f52e9(0x132),{'value':!![]}),exports[a90_0x3f52e9(0x161)]=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a90_0x3f52e9(0x183)),mongoose_2=require(a90_0x3f52e9(0x176)),event_emitter_1=require(a90_0x3f52e9(0x17e)),sound_service_1=require(a90_0x3f52e9(0x143)),job_1=require('../common/job'),events_1=require(a90_0x3f52e9(0x156)),agenda_service_1=require('../agenda/agenda.service'),playlist_mapper_1=require(a90_0x3f52e9(0x14a)),enums_1=require(a90_0x3f52e9(0x180)),path=require('path'),path_1=require(a90_0x3f52e9(0x133)),audio_player_1=require(a90_0x3f52e9(0x164)),sound_gateway_1=require('../sound/sound.gateway');let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x567770,_0x49a46f,_0x3d60e2,_0x10dde5){const _0x1c509=a90_0x3f52e9;this['playlistModel']=_0x567770,this[_0x1c509(0x173)]=_0x49a46f,this['agendaService']=_0x3d60e2,this[_0x1c509(0x159)]=_0x10dde5,this[_0x1c509(0x160)]=new common_1[(_0x1c509(0x14f))](PlaylistService_1[_0x1c509(0x14e)]);}async['create'](_0x26d8a3){const _0x57479e=a90_0x3f52e9,_0x38c785=new this[(_0x57479e(0x136))](_0x26d8a3);return _0x38c785['save']();}async[a90_0x3f52e9(0x174)](){const _0x47c2a4=a90_0x3f52e9,_0x24221e=await this['playlistModel'][_0x47c2a4(0x13a)]()[_0x47c2a4(0x17a)](),_0x25b3b5=_0x24221e[_0x47c2a4(0x186)](async _0x1dfbd7=>{const _0x3f5ec9=_0x47c2a4,_0x37373f=await this[_0x3f5ec9(0x173)]['findByIds'](_0x1dfbd7[_0x3f5ec9(0x177)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x1dfbd7,_0x37373f);});return await Promise[_0x47c2a4(0x131)](_0x25b3b5);}async[a90_0x3f52e9(0x15a)](_0x2bc782){const _0x3fbfd2=a90_0x3f52e9,_0x355970=await this[_0x3fbfd2(0x136)]['findById'](_0x2bc782),_0x49c649=await this[_0x3fbfd2(0x173)][_0x3fbfd2(0x14d)](_0x355970[_0x3fbfd2(0x177)]);return(0x0,playlist_mapper_1[_0x3fbfd2(0x175)])(_0x355970,_0x49c649);}async[a90_0x3f52e9(0x15d)](_0x4ce49a,_0x4845f6){const _0x1ac7d6=a90_0x3f52e9,_0x2bb534=await this[_0x1ac7d6(0x136)][_0x1ac7d6(0x16e)](_0x4ce49a,Object['assign'](Object[_0x1ac7d6(0x162)]({},_0x4845f6),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x5ba2ca=await this[_0x1ac7d6(0x173)]['findByIds'](_0x2bb534[_0x1ac7d6(0x177)]);return(0x0,playlist_mapper_1[_0x1ac7d6(0x175)])(_0x2bb534,_0x5ba2ca);}async[a90_0x3f52e9(0x15f)](_0x5eb056){const _0x390db9=a90_0x3f52e9;return await this['playlistModel'][_0x390db9(0x17f)](_0x5eb056);}async[a90_0x3f52e9(0x150)](_0x5a23cc,_0x425acb){const _0x25f4d6=a90_0x3f52e9,_0xd9a099=await this['playlistModel']['findById'](_0x5a23cc);return _0xd9a099[_0x25f4d6(0x177)][_0x25f4d6(0x14c)](_0x425acb),await _0xd9a099[_0x25f4d6(0x178)]();}async[a90_0x3f52e9(0x163)](_0xdbd75d,_0x43ac74){const _0x42881f=a90_0x3f52e9,_0x424ee9=await this['playlistModel'][_0x42881f(0x13d)](_0xdbd75d);return _0x424ee9[_0x42881f(0x177)]=_0x424ee9[_0x42881f(0x177)]['filter'](_0x2bb375=>_0x2bb375!==_0x43ac74),await _0x424ee9[_0x42881f(0x178)]();}async['play'](_0x40cdd9,_0x244c90){const _0x505911=a90_0x3f52e9,_0x20877c={'when':'now','jobType':enums_1[_0x505911(0x141)][_0x505911(0x16f)],'attributes':{'playlistId':_0x244c90},'audit':{'actor':_0x40cdd9,'name':enums_1[_0x505911(0x141)]['PlayMusic'],'message':_0x505911(0x168)+_0x244c90}},{jobId:_0xf37502}=await this['agendaService']['scheduleJob'](_0x20877c);return this[_0x505911(0x15d)](_0x244c90,{'jobId':_0xf37502});}async['stop'](_0x5146cd){const _0x250020=a90_0x3f52e9;let _0x18dd66=await this[_0x250020(0x15a)](_0x5146cd);const {jobId:_0x1832ae}=_0x18dd66||{};if(_0x1832ae){const {success:_0x81cac0}=await this[_0x250020(0x145)][_0x250020(0x166)](_0x1832ae);_0x81cac0&&(_0x18dd66=await this[_0x250020(0x15d)](_0x5146cd,{'jobId':null}));}return this[_0x250020(0x159)][_0x250020(0x179)]({'id':_0x18dd66['_id'],'isPlaying':![]}),_0x18dd66;}async[a90_0x3f52e9(0x189)](_0x16460e){const _0x5bb204=a90_0x3f52e9,{playlistId:_0x1db791,jobId:_0x5b7b31,durationInSecond:_0x5d36ba}=_0x16460e,_0x52935f=await this['playlistModel'][_0x5bb204(0x13d)](_0x1db791),_0x247453=[..._0x52935f[_0x5bb204(0x177)]],_0x184d11=await this[_0x5bb204(0x173)]['findByIds'](_0x247453),_0x301b94=_0x184d11['map'](_0x375658=>path[_0x5bb204(0x167)](path_1['processRootPath'],_0x5bb204(0x12e),_0x5bb204(0x130),_0x375658[_0x5bb204(0x16d)]));job_1[_0x5bb204(0x165)]['killAll'](),this['logger'][_0x5bb204(0x151)](_0x5bb204(0x142)+_0x1db791+'\x20-\x20'+_0x52935f[_0x5bb204(0x14e)]),(0x0,job_1['executeJob'])({'jobId':_0x5b7b31,'run':()=>audio_player_1[_0x5bb204(0x146)][_0x5bb204(0x148)](_0x301b94,0x32,_0x52935f[_0x5bb204(0x144)]),'durationInSecond':_0x5d36ba,'next':()=>this[_0x5bb204(0x139)](_0x1db791)}),this[_0x5bb204(0x159)]['broadcastPlaying']({'id':_0x1db791,'isPlaying':!![]});}};function a90_0xef72(_0x1c4966,_0x9caf77){const _0x3be62f=a90_0x3be6();return a90_0xef72=function(_0xef729e,_0x46537e){_0xef729e=_0xef729e-0x12e;let _0x430e85=_0x3be62f[_0xef729e];return _0x430e85;},a90_0xef72(_0x1c4966,_0x9caf77);}__decorate([(0x0,event_emitter_1[a90_0x3f52e9(0x13e)])(events_1[a90_0x3f52e9(0x169)][a90_0x3f52e9(0x12f)]),__metadata(a90_0x3f52e9(0x155),Function),__metadata(a90_0x3f52e9(0x15c),[Object]),__metadata(a90_0x3f52e9(0x152),Promise)],PlaylistService[a90_0x3f52e9(0x13b)],a90_0x3f52e9(0x189),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a90_0x3f52e9(0x15e)])(),__param(0x0,(0x0,mongoose_2[a90_0x3f52e9(0x147)])(a90_0x3f52e9(0x138))),__param(0x3,(0x0,common_1[a90_0x3f52e9(0x187)])(sound_gateway_1[a90_0x3f52e9(0x17b)])),__metadata(a90_0x3f52e9(0x15c),[mongoose_1[a90_0x3f52e9(0x16b)],sound_service_1[a90_0x3f52e9(0x185)],agenda_service_1[a90_0x3f52e9(0x153)],sound_gateway_1[a90_0x3f52e9(0x17b)]])],PlaylistService),exports[a90_0x3f52e9(0x161)]=PlaylistService;function a90_0x3be6(){const _0x4a7b00=['addSong','log','design:returntype','AgendaService','194831ZfpKSu','design:type','../common/events','defineProperty','__decorate','soundGateway','findOne','718432MsPCfO','design:paramtypes','update','Injectable','delete','logger','PlaylistService','assign','removeSong','../common/audio/audio-player','PROCESS_CACHE','cancelJob','join','Play\x20Music\x20Playlist:\x20','PlaylistEvent','__param','Model','183016KPSTXB','fileName','findByIdAndUpdate','PlayMusic','202UwVzdg','363786QFsXVY','130110Trusnn','soundService','findAll','mapToDto','@nestjs/mongoose','soundIds','save','broadcastPlaying','exec','SoundGateway','getOwnPropertyDescriptor','8XBWVeM','@nestjs/event-emitter','findByIdAndDelete','../common/enums','decorate','function','mongoose','234LPCyZJ','SoundService','map','Inject','492GcDHqX','playFromEvent','assets','Play','audio','all','__esModule','../common/path','length','20CHgaOy','playlistModel','243THIPMf','Playlist','stop','find','prototype','object','findById','OnEvent','__metadata','342444rdSJzm','JobType','Playing\x20playlist:\x20','../sound/sound.service','isShuffle','agendaService','AudioPlayer','InjectModel','playAsync','metadata','./mapper/playlist.mapper','35IifCAo','push','findByIds','name','Logger'];a90_0x3be6=function(){return _0x4a7b00;};return a90_0x3be6();}