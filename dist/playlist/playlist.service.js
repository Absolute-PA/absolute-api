'use strict';const a87_0x445b85=a87_0x3d38;(function(_0x28be71,_0x215928){const _0x550e64=a87_0x3d38,_0x2ee120=_0x28be71();while(!![]){try{const _0x40601a=parseInt(_0x550e64(0xc7))/0x1+parseInt(_0x550e64(0x9d))/0x2*(-parseInt(_0x550e64(0xb8))/0x3)+-parseInt(_0x550e64(0x97))/0x4*(-parseInt(_0x550e64(0xa9))/0x5)+-parseInt(_0x550e64(0xb2))/0x6*(-parseInt(_0x550e64(0x91))/0x7)+-parseInt(_0x550e64(0xd3))/0x8+parseInt(_0x550e64(0x95))/0x9*(parseInt(_0x550e64(0x94))/0xa)+parseInt(_0x550e64(0xe0))/0xb;if(_0x40601a===_0x215928)break;else _0x2ee120['push'](_0x2ee120['shift']());}catch(_0x604a55){_0x2ee120['push'](_0x2ee120['shift']());}}}(a87_0x5010,0x2718a));function a87_0x5010(){const _0x2e9a79=['broadcastPlaying','function','playFromEvent','Playing\x20playlist:\x20','fileName','design:type','update','../common/events','audio','105766MjtToj','defineProperty','../common/enums','assets','logger','killAll','join','findOne','InjectModel','save','Model','prototype','2326448pacwuB','@nestjs/event-emitter','__param','object','mapToDto','PlaylistEvent','addSong','all','filter','find','scheduleJob','map','__metadata','788513PhQpQx','../common/path','../sound/sound.gateway','Playlist','metadata','assign','cancelJob','AgendaService','soundIds','push','\x20-\x20','Play','findById','7Qfjdxu','_id','../common/job','2838720iqJUBb','9POQnCx','Logger','4XJweoy','processRootPath','../common/audio/audio-player','isShuffle','PlaylistService','delete','337388uanDXZ','PlayMusic','name','design:returntype','create','exec','@nestjs/common','stop','design:paramtypes','SoundGateway','findAll','agendaService','392620fZTRyg','Inject','executeJob','../sound/sound.service','play','getOwnPropertyDescriptor','findByIds','SoundService','__decorate','478758NVllmf','log','findByIdAndUpdate','soundService','removeSong','playlistModel','3yaNJVo','AudioPlayer','@nestjs/mongoose','JobType','decorate','soundGateway'];a87_0x5010=function(){return _0x2e9a79;};return a87_0x5010();}function a87_0x3d38(_0x3d4bfe,_0x1bf67d){const _0x50103c=a87_0x5010();return a87_0x3d38=function(_0x3d387e,_0x3d3073){_0x3d387e=_0x3d387e-0x90;let _0xdda340=_0x50103c[_0x3d387e];return _0xdda340;},a87_0x3d38(_0x3d4bfe,_0x1bf67d);}var __decorate=this&&this[a87_0x445b85(0xb1)]||function(_0x28d872,_0x2b7937,_0xf10965,_0x46989d){const _0x1ced2d=a87_0x445b85;var _0x14c9f3=arguments['length'],_0x29f852=_0x14c9f3<0x3?_0x2b7937:_0x46989d===null?_0x46989d=Object[_0x1ced2d(0xae)](_0x2b7937,_0xf10965):_0x46989d,_0x481708;if(typeof Reflect===_0x1ced2d(0xd6)&&typeof Reflect[_0x1ced2d(0xbc)]===_0x1ced2d(0xbf))_0x29f852=Reflect[_0x1ced2d(0xbc)](_0x28d872,_0x2b7937,_0xf10965,_0x46989d);else{for(var _0x3b9125=_0x28d872['length']-0x1;_0x3b9125>=0x0;_0x3b9125--)if(_0x481708=_0x28d872[_0x3b9125])_0x29f852=(_0x14c9f3<0x3?_0x481708(_0x29f852):_0x14c9f3>0x3?_0x481708(_0x2b7937,_0xf10965,_0x29f852):_0x481708(_0x2b7937,_0xf10965))||_0x29f852;}return _0x14c9f3>0x3&&_0x29f852&&Object[_0x1ced2d(0xc8)](_0x2b7937,_0xf10965,_0x29f852),_0x29f852;},__metadata=this&&this[a87_0x445b85(0xdf)]||function(_0x339ced,_0x1d54a4){const _0x37df71=a87_0x445b85;if(typeof Reflect===_0x37df71(0xd6)&&typeof Reflect[_0x37df71(0xe4)]==='function')return Reflect[_0x37df71(0xe4)](_0x339ced,_0x1d54a4);},__param=this&&this[a87_0x445b85(0xd5)]||function(_0x2fb49a,_0x52de57){return function(_0x1bbab1,_0x10f9df){_0x52de57(_0x1bbab1,_0x10f9df,_0x2fb49a);};},PlaylistService_1;Object[a87_0x445b85(0xc8)](exports,'__esModule',{'value':!![]}),exports['PlaylistService']=void 0x0;const common_1=require(a87_0x445b85(0xa3)),mongoose_1=require('mongoose'),mongoose_2=require(a87_0x445b85(0xba)),event_emitter_1=require(a87_0x445b85(0xd4)),sound_service_1=require(a87_0x445b85(0xac)),job_1=require(a87_0x445b85(0x93)),events_1=require(a87_0x445b85(0xc5)),agenda_service_1=require('../agenda/agenda.service'),playlist_mapper_1=require('./mapper/playlist.mapper'),enums_1=require(a87_0x445b85(0xc9)),path=require('path'),path_1=require(a87_0x445b85(0xe1)),audio_player_1=require(a87_0x445b85(0x99)),sound_gateway_1=require(a87_0x445b85(0xe2));let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x2dbffd,_0x442886,_0x40e21a,_0x15cc8a){const _0x2ae11d=a87_0x445b85;this[_0x2ae11d(0xb7)]=_0x2dbffd,this[_0x2ae11d(0xb5)]=_0x442886,this[_0x2ae11d(0xa8)]=_0x40e21a,this[_0x2ae11d(0xbd)]=_0x15cc8a,this[_0x2ae11d(0xcb)]=new common_1[(_0x2ae11d(0x96))](PlaylistService_1[_0x2ae11d(0x9f)]);}async[a87_0x445b85(0xa1)](_0x2533f1){const _0x416e4c=a87_0x445b85,_0x2d1aad=new this[(_0x416e4c(0xb7))](_0x2533f1);return _0x2d1aad[_0x416e4c(0xd0)]();}async[a87_0x445b85(0xa7)](){const _0xa48ea5=a87_0x445b85,_0xf926ef=await this[_0xa48ea5(0xb7)][_0xa48ea5(0xdc)]()[_0xa48ea5(0xa2)](),_0xa7df84=_0xf926ef[_0xa48ea5(0xde)](async _0xf804a4=>{const _0x2d74d4=_0xa48ea5,_0x1c52a8=await this[_0x2d74d4(0xb5)][_0x2d74d4(0xaf)](_0xf804a4[_0x2d74d4(0xe8)]);return(0x0,playlist_mapper_1[_0x2d74d4(0xd7)])(_0xf804a4,_0x1c52a8);});return await Promise[_0xa48ea5(0xda)](_0xa7df84);}async[a87_0x445b85(0xce)](_0x4ebd35){const _0x1a6065=a87_0x445b85,_0x34c060=await this[_0x1a6065(0xb7)][_0x1a6065(0x90)](_0x4ebd35),_0x167ffd=await this[_0x1a6065(0xb5)]['findByIds'](_0x34c060[_0x1a6065(0xe8)]);return(0x0,playlist_mapper_1[_0x1a6065(0xd7)])(_0x34c060,_0x167ffd);}async[a87_0x445b85(0xc4)](_0xa8a1e5,_0x39c684){const _0x2e8601=a87_0x445b85,_0x530fbc=await this['playlistModel'][_0x2e8601(0xb4)](_0xa8a1e5,Object[_0x2e8601(0xe5)](Object[_0x2e8601(0xe5)]({},_0x39c684),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x9d8e3a=await this['soundService'][_0x2e8601(0xaf)](_0x530fbc['soundIds']);return(0x0,playlist_mapper_1[_0x2e8601(0xd7)])(_0x530fbc,_0x9d8e3a);}async[a87_0x445b85(0x9c)](_0x3d520f){return await this['playlistModel']['findByIdAndDelete'](_0x3d520f);}async[a87_0x445b85(0xd9)](_0xf2e44f,_0x27425b){const _0x2abf6a=a87_0x445b85,_0x479bf0=await this['playlistModel'][_0x2abf6a(0x90)](_0xf2e44f);return _0x479bf0['soundIds'][_0x2abf6a(0xe9)](_0x27425b),await _0x479bf0[_0x2abf6a(0xd0)]();}async[a87_0x445b85(0xb6)](_0x8c967b,_0x40d3fd){const _0x1d260a=a87_0x445b85,_0x57ec26=await this[_0x1d260a(0xb7)][_0x1d260a(0x90)](_0x8c967b);return _0x57ec26[_0x1d260a(0xe8)]=_0x57ec26[_0x1d260a(0xe8)][_0x1d260a(0xdb)](_0x3e572e=>_0x3e572e!==_0x40d3fd),await _0x57ec26[_0x1d260a(0xd0)]();}async[a87_0x445b85(0xad)](_0x24ba2b,_0x286aad){const _0x65a5c4=a87_0x445b85,_0xb07afe={'when':'now','jobType':enums_1[_0x65a5c4(0xbb)]['PlayMusic'],'attributes':{'playlistId':_0x286aad},'audit':{'actor':_0x24ba2b,'name':enums_1[_0x65a5c4(0xbb)][_0x65a5c4(0x9e)],'message':'Play\x20Music\x20Playlist:\x20'+_0x286aad}},{jobId:_0x24b2fd}=await this[_0x65a5c4(0xa8)][_0x65a5c4(0xdd)](_0xb07afe);return this[_0x65a5c4(0xc4)](_0x286aad,{'jobId':_0x24b2fd});}async[a87_0x445b85(0xa4)](_0xbcbf1f){const _0x2bc65c=a87_0x445b85;let _0x1d1b22=await this[_0x2bc65c(0xce)](_0xbcbf1f);const {jobId:_0x537eb8}=_0x1d1b22||{};if(_0x537eb8){const {success:_0x147ac1}=await this[_0x2bc65c(0xa8)][_0x2bc65c(0xe6)](_0x537eb8);_0x147ac1&&(_0x1d1b22=await this[_0x2bc65c(0xc4)](_0xbcbf1f,{'jobId':null}));}return this['soundGateway']['broadcastPlaying']({'id':_0x1d1b22[_0x2bc65c(0x92)],'isPlaying':![]}),_0x1d1b22;}async[a87_0x445b85(0xc0)](_0x36856f){const _0xe729ef=a87_0x445b85,{playlistId:_0x2aba94,jobId:_0x132a54,durationInSecond:_0x134e7e}=_0x36856f,_0x1dfe00=await this[_0xe729ef(0xb7)]['findById'](_0x2aba94),_0x34c3b8=[..._0x1dfe00[_0xe729ef(0xe8)]],_0x417064=await this[_0xe729ef(0xb5)][_0xe729ef(0xaf)](_0x34c3b8),_0x1aca66=_0x417064[_0xe729ef(0xde)](_0x417d44=>path[_0xe729ef(0xcd)](path_1[_0xe729ef(0x98)],_0xe729ef(0xca),_0xe729ef(0xc6),_0x417d44[_0xe729ef(0xc2)]));job_1['PROCESS_CACHE'][_0xe729ef(0xcc)](),this[_0xe729ef(0xcb)][_0xe729ef(0xb3)](_0xe729ef(0xc1)+_0x2aba94+_0xe729ef(0xea)+_0x1dfe00[_0xe729ef(0x9f)]),(0x0,job_1[_0xe729ef(0xab)])({'jobId':_0x132a54,'run':()=>audio_player_1[_0xe729ef(0xb9)]['playAsync'](_0x1aca66,0x32,_0x1dfe00[_0xe729ef(0x9a)]),'durationInSecond':_0x134e7e,'next':()=>this['stop'](_0x2aba94)}),this[_0xe729ef(0xbd)][_0xe729ef(0xbe)]({'id':_0x2aba94,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1['OnEvent'])(events_1[a87_0x445b85(0xd8)][a87_0x445b85(0xeb)]),__metadata(a87_0x445b85(0xc3),Function),__metadata(a87_0x445b85(0xa5),[Object]),__metadata(a87_0x445b85(0xa0),Promise)],PlaylistService[a87_0x445b85(0xd2)],a87_0x445b85(0xc0),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_2[a87_0x445b85(0xcf)])(a87_0x445b85(0xe3))),__param(0x3,(0x0,common_1[a87_0x445b85(0xaa)])(sound_gateway_1[a87_0x445b85(0xa6)])),__metadata(a87_0x445b85(0xa5),[mongoose_1[a87_0x445b85(0xd1)],sound_service_1[a87_0x445b85(0xb0)],agenda_service_1[a87_0x445b85(0xe7)],sound_gateway_1[a87_0x445b85(0xa6)]])],PlaylistService),exports[a87_0x445b85(0x9b)]=PlaylistService;