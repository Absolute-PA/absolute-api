'use strict';const a87_0x7a8040=a87_0x49e2;(function(_0x89e804,_0x119598){const _0x143d69=a87_0x49e2,_0x5de51e=_0x89e804();while(!![]){try{const _0x1e5c2e=parseInt(_0x143d69(0x14e))/0x1+parseInt(_0x143d69(0x142))/0x2*(-parseInt(_0x143d69(0x193))/0x3)+parseInt(_0x143d69(0x16d))/0x4+-parseInt(_0x143d69(0x163))/0x5*(parseInt(_0x143d69(0x175))/0x6)+parseInt(_0x143d69(0x168))/0x7+parseInt(_0x143d69(0x15b))/0x8+-parseInt(_0x143d69(0x153))/0x9;if(_0x1e5c2e===_0x119598)break;else _0x5de51e['push'](_0x5de51e['shift']());}catch(_0x1406dd){_0x5de51e['push'](_0x5de51e['shift']());}}}(a87_0x4e70,0xf1df7));var __decorate=this&&this['__decorate']||function(_0x3571b1,_0x41f11e,_0x2c8470,_0x5c9914){const _0x4e71bf=a87_0x49e2;var _0x7f3a27=arguments[_0x4e71bf(0x181)],_0x5f5b27=_0x7f3a27<0x3?_0x41f11e:_0x5c9914===null?_0x5c9914=Object['getOwnPropertyDescriptor'](_0x41f11e,_0x2c8470):_0x5c9914,_0x53a7cf;if(typeof Reflect===_0x4e71bf(0x18d)&&typeof Reflect['decorate']==='function')_0x5f5b27=Reflect[_0x4e71bf(0x194)](_0x3571b1,_0x41f11e,_0x2c8470,_0x5c9914);else{for(var _0x58735b=_0x3571b1[_0x4e71bf(0x181)]-0x1;_0x58735b>=0x0;_0x58735b--)if(_0x53a7cf=_0x3571b1[_0x58735b])_0x5f5b27=(_0x7f3a27<0x3?_0x53a7cf(_0x5f5b27):_0x7f3a27>0x3?_0x53a7cf(_0x41f11e,_0x2c8470,_0x5f5b27):_0x53a7cf(_0x41f11e,_0x2c8470))||_0x5f5b27;}return _0x7f3a27>0x3&&_0x5f5b27&&Object[_0x4e71bf(0x17e)](_0x41f11e,_0x2c8470,_0x5f5b27),_0x5f5b27;},__metadata=this&&this[a87_0x7a8040(0x15d)]||function(_0x5eaad5,_0x26be9c){const _0x3974a9=a87_0x7a8040;if(typeof Reflect===_0x3974a9(0x18d)&&typeof Reflect[_0x3974a9(0x18c)]==='function')return Reflect[_0x3974a9(0x18c)](_0x5eaad5,_0x26be9c);},__param=this&&this[a87_0x7a8040(0x152)]||function(_0xd80be3,_0x4f4d15){return function(_0x2cf76e,_0x72127e){_0x4f4d15(_0x2cf76e,_0x72127e,_0xd80be3);};},PlaylistService_1;Object[a87_0x7a8040(0x17e)](exports,'__esModule',{'value':!![]}),exports[a87_0x7a8040(0x162)]=void 0x0;const common_1=require(a87_0x7a8040(0x16a)),mongoose_1=require(a87_0x7a8040(0x143)),mongoose_2=require(a87_0x7a8040(0x167)),event_emitter_1=require(a87_0x7a8040(0x15f)),sound_service_1=require('../sound/sound.service'),job_1=require('../common/job'),events_1=require(a87_0x7a8040(0x14d)),agenda_service_1=require(a87_0x7a8040(0x176)),playlist_mapper_1=require(a87_0x7a8040(0x154)),enums_1=require(a87_0x7a8040(0x15e)),path=require(a87_0x7a8040(0x184)),path_1=require(a87_0x7a8040(0x190)),audio_player_1=require(a87_0x7a8040(0x182)),sound_gateway_1=require(a87_0x7a8040(0x191));let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x392023,_0x1981d8,_0x581667,_0x517b39){const _0x5a7039=a87_0x7a8040;this[_0x5a7039(0x17c)]=_0x392023,this[_0x5a7039(0x178)]=_0x1981d8,this[_0x5a7039(0x188)]=_0x581667,this[_0x5a7039(0x160)]=_0x517b39,this['logger']=new common_1[(_0x5a7039(0x192))](PlaylistService_1[_0x5a7039(0x18e)]);}async[a87_0x7a8040(0x161)](_0xedbc70){const _0x4e95f5=a87_0x7a8040,_0x6ff92d=new this[(_0x4e95f5(0x17c))](_0xedbc70);return _0x6ff92d[_0x4e95f5(0x183)]();}async['findAll'](){const _0x6d7b6c=a87_0x7a8040,_0x35da09=await this[_0x6d7b6c(0x17c)][_0x6d7b6c(0x146)]()[_0x6d7b6c(0x158)](),_0x365fd7=_0x35da09[_0x6d7b6c(0x15c)](async _0x411512=>{const _0x4e8d1a=_0x6d7b6c,_0x21d872=await this[_0x4e8d1a(0x178)]['findByIds'](_0x411512[_0x4e8d1a(0x177)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x411512,_0x21d872);});return await Promise['all'](_0x365fd7);}async['findOne'](_0x3cbf1c){const _0x3ed460=a87_0x7a8040,_0x255731=await this[_0x3ed460(0x17c)][_0x3ed460(0x17b)](_0x3cbf1c),_0x1bc9c2=await this[_0x3ed460(0x178)][_0x3ed460(0x145)](_0x255731[_0x3ed460(0x177)]);return(0x0,playlist_mapper_1[_0x3ed460(0x18b)])(_0x255731,_0x1bc9c2);}async[a87_0x7a8040(0x17d)](_0x4371f1,_0x1f8a9f){const _0x454757=a87_0x7a8040,_0x58ecd3=await this[_0x454757(0x17c)][_0x454757(0x14a)](_0x4371f1,Object[_0x454757(0x165)](Object[_0x454757(0x165)]({},_0x1f8a9f),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x80146c=await this[_0x454757(0x178)]['findByIds'](_0x58ecd3[_0x454757(0x177)]);return(0x0,playlist_mapper_1[_0x454757(0x18b)])(_0x58ecd3,_0x80146c);}async['delete'](_0x2a6f58){const _0x62687e=a87_0x7a8040;return await this[_0x62687e(0x17c)][_0x62687e(0x169)](_0x2a6f58);}async['addSong'](_0xeaca6f,_0x1813c6){const _0xa900b8=a87_0x7a8040,_0x355b5f=await this['playlistModel'][_0xa900b8(0x17b)](_0xeaca6f);return _0x355b5f[_0xa900b8(0x177)][_0xa900b8(0x18a)](_0x1813c6),await _0x355b5f['save']();}async[a87_0x7a8040(0x186)](_0x3c1822,_0x4053eb){const _0x3d2078=a87_0x7a8040,_0x417e98=await this[_0x3d2078(0x17c)][_0x3d2078(0x17b)](_0x3c1822);return _0x417e98[_0x3d2078(0x177)]=_0x417e98['soundIds'][_0x3d2078(0x16b)](_0xbeb15f=>_0xbeb15f!==_0x4053eb),await _0x417e98[_0x3d2078(0x183)]();}async[a87_0x7a8040(0x148)](_0x25d627,_0x47ad30){const _0x5ece04=a87_0x7a8040,_0x5e3331={'when':_0x5ece04(0x156),'jobType':enums_1['JobType'][_0x5ece04(0x16c)],'attributes':{'playlistId':_0x47ad30},'audit':{'actor':_0x25d627,'name':enums_1['JobType'][_0x5ece04(0x16c)],'message':_0x5ece04(0x15a)+_0x47ad30}},{jobId:_0x36ff85}=await this[_0x5ece04(0x188)][_0x5ece04(0x170)](_0x5e3331);return this[_0x5ece04(0x17d)](_0x47ad30,{'jobId':_0x36ff85});}async[a87_0x7a8040(0x149)](_0x3fa618){const _0x576c31=a87_0x7a8040;let _0x2bc8a0=await this[_0x576c31(0x164)](_0x3fa618);const {jobId:_0x101490}=_0x2bc8a0||{};if(_0x101490){const {success:_0x5dee94}=await this['agendaService'][_0x576c31(0x174)](_0x101490);_0x5dee94&&(_0x2bc8a0=await this[_0x576c31(0x17d)](_0x3fa618,{'jobId':null}));}return this['soundGateway'][_0x576c31(0x187)]({'id':_0x2bc8a0[_0x576c31(0x159)],'isPlaying':![]}),_0x2bc8a0;}async['playFromEvent'](_0xf5df3f){const _0x11fcac=a87_0x7a8040,{playlistId:_0x137398,jobId:_0x1562e1,durationInSecond:_0x1d7196}=_0xf5df3f,_0x4913f2=await this[_0x11fcac(0x17c)][_0x11fcac(0x17b)](_0x137398),_0xcc6ab9=[..._0x4913f2[_0x11fcac(0x177)]],_0x3dcb53=await this[_0x11fcac(0x178)][_0x11fcac(0x145)](_0xcc6ab9),_0x505d44=_0x3dcb53[_0x11fcac(0x15c)](_0x15857f=>path[_0x11fcac(0x157)](path_1[_0x11fcac(0x189)],_0x11fcac(0x171),_0x11fcac(0x17a),_0x15857f['fileName']));job_1[_0x11fcac(0x172)][_0x11fcac(0x173)](),this[_0x11fcac(0x14b)][_0x11fcac(0x179)]('Playing\x20playlist:\x20'+_0x137398+_0x11fcac(0x155)+_0x4913f2[_0x11fcac(0x18e)]),(0x0,job_1[_0x11fcac(0x144)])({'jobId':_0x1562e1,'run':()=>audio_player_1[_0x11fcac(0x18f)]['playAsync'](_0x505d44,0x32,_0x4913f2[_0x11fcac(0x17f)]),'durationInSecond':_0x1d7196,'next':()=>this[_0x11fcac(0x149)](_0x137398)}),this[_0x11fcac(0x160)][_0x11fcac(0x187)]({'id':_0x137398,'isPlaying':!![]});}};function a87_0x4e70(){const _0x30ae6e=['assign','Play','@nestjs/mongoose','7019943xUtEWy','findByIdAndDelete','@nestjs/common','filter','PlayMusic','4720488EFeEOj','design:paramtypes','OnEvent','scheduleJob','assets','PROCESS_CACHE','killAll','cancelJob','12saXQqx','../agenda/agenda.service','soundIds','soundService','log','audio','findById','playlistModel','update','defineProperty','isShuffle','AgendaService','length','../common/audio/audio-player','save','path','Injectable','removeSong','broadcastPlaying','agendaService','processRootPath','push','mapToDto','metadata','object','name','AudioPlayer','../common/path','../sound/sound.gateway','Logger','13749kScFYF','decorate','572yHdnXm','mongoose','executeJob','findByIds','find','SoundGateway','play','stop','findByIdAndUpdate','logger','prototype','../common/events','1742443wRgXdX','SoundService','design:type','PlaylistEvent','__param','9339390pSitnw','./mapper/playlist.mapper','\x20-\x20','now','join','exec','_id','Play\x20Music\x20Playlist:\x20','5794072WzIARq','map','__metadata','../common/enums','@nestjs/event-emitter','soundGateway','create','PlaylistService','3276285uefaYN','findOne'];a87_0x4e70=function(){return _0x30ae6e;};return a87_0x4e70();}function a87_0x49e2(_0x149215,_0x42c1bd){const _0x4e70ca=a87_0x4e70();return a87_0x49e2=function(_0x49e297,_0x32eab9){_0x49e297=_0x49e297-0x142;let _0x3b8c7c=_0x4e70ca[_0x49e297];return _0x3b8c7c;},a87_0x49e2(_0x149215,_0x42c1bd);}__decorate([(0x0,event_emitter_1[a87_0x7a8040(0x16f)])(events_1[a87_0x7a8040(0x151)][a87_0x7a8040(0x166)]),__metadata(a87_0x7a8040(0x150),Function),__metadata(a87_0x7a8040(0x16e),[Object]),__metadata('design:returntype',Promise)],PlaylistService[a87_0x7a8040(0x14c)],'playFromEvent',null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a87_0x7a8040(0x185)])(),__param(0x0,(0x0,mongoose_2['InjectModel'])('Playlist')),__param(0x3,(0x0,common_1['Inject'])(sound_gateway_1[a87_0x7a8040(0x147)])),__metadata(a87_0x7a8040(0x16e),[mongoose_1['Model'],sound_service_1[a87_0x7a8040(0x14f)],agenda_service_1[a87_0x7a8040(0x180)],sound_gateway_1[a87_0x7a8040(0x147)]])],PlaylistService),exports[a87_0x7a8040(0x162)]=PlaylistService;