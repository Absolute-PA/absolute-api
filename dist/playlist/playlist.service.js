'use strict';const a87_0x3fb3a8=a87_0x1e0c;(function(_0x1f9763,_0x390d36){const _0x5b380b=a87_0x1e0c,_0x339fae=_0x1f9763();while(!![]){try{const _0x4a554d=-parseInt(_0x5b380b(0xaf))/0x1+-parseInt(_0x5b380b(0xae))/0x2*(-parseInt(_0x5b380b(0xa6))/0x3)+-parseInt(_0x5b380b(0x99))/0x4*(-parseInt(_0x5b380b(0xc3))/0x5)+parseInt(_0x5b380b(0xb7))/0x6+parseInt(_0x5b380b(0x80))/0x7+parseInt(_0x5b380b(0xba))/0x8+-parseInt(_0x5b380b(0xb1))/0x9;if(_0x4a554d===_0x390d36)break;else _0x339fae['push'](_0x339fae['shift']());}catch(_0x3efe2b){_0x339fae['push'](_0x339fae['shift']());}}}(a87_0xb875,0x24bf6));var __decorate=this&&this[a87_0x3fb3a8(0x7b)]||function(_0x457f2e,_0x3508bd,_0x40a0c9,_0x43ad5e){const _0x38c7e2=a87_0x3fb3a8;var _0x4e67d4=arguments[_0x38c7e2(0x8a)],_0x1492e6=_0x4e67d4<0x3?_0x3508bd:_0x43ad5e===null?_0x43ad5e=Object['getOwnPropertyDescriptor'](_0x3508bd,_0x40a0c9):_0x43ad5e,_0xeba54;if(typeof Reflect==='object'&&typeof Reflect[_0x38c7e2(0x81)]===_0x38c7e2(0x8f))_0x1492e6=Reflect[_0x38c7e2(0x81)](_0x457f2e,_0x3508bd,_0x40a0c9,_0x43ad5e);else{for(var _0x5597f1=_0x457f2e[_0x38c7e2(0x8a)]-0x1;_0x5597f1>=0x0;_0x5597f1--)if(_0xeba54=_0x457f2e[_0x5597f1])_0x1492e6=(_0x4e67d4<0x3?_0xeba54(_0x1492e6):_0x4e67d4>0x3?_0xeba54(_0x3508bd,_0x40a0c9,_0x1492e6):_0xeba54(_0x3508bd,_0x40a0c9))||_0x1492e6;}return _0x4e67d4>0x3&&_0x1492e6&&Object[_0x38c7e2(0x7a)](_0x3508bd,_0x40a0c9,_0x1492e6),_0x1492e6;},__metadata=this&&this[a87_0x3fb3a8(0x7e)]||function(_0x41f7f9,_0x440662){const _0x462ae2=a87_0x3fb3a8;if(typeof Reflect===_0x462ae2(0xa2)&&typeof Reflect[_0x462ae2(0xac)]===_0x462ae2(0x8f))return Reflect[_0x462ae2(0xac)](_0x41f7f9,_0x440662);},__param=this&&this['__param']||function(_0x2ff314,_0x9f3f02){return function(_0x4fc86,_0x209ea6){_0x9f3f02(_0x4fc86,_0x209ea6,_0x2ff314);};},PlaylistService_1;Object[a87_0x3fb3a8(0x7a)](exports,a87_0x3fb3a8(0x88),{'value':!![]}),exports['PlaylistService']=void 0x0;function a87_0x1e0c(_0x42b5d4,_0x3d979e){const _0xb875cf=a87_0xb875();return a87_0x1e0c=function(_0x1e0c2b,_0x4a4822){_0x1e0c2b=_0x1e0c2b-0x77;let _0x15afc2=_0xb875cf[_0x1e0c2b];return _0x15afc2;},a87_0x1e0c(_0x42b5d4,_0x3d979e);}const common_1=require(a87_0x3fb3a8(0xbb)),mongoose_1=require(a87_0x3fb3a8(0x96)),mongoose_2=require(a87_0x3fb3a8(0xa8)),event_emitter_1=require(a87_0x3fb3a8(0xc0)),sound_service_1=require(a87_0x3fb3a8(0xcc)),job_1=require('../common/job'),events_1=require(a87_0x3fb3a8(0x89)),agenda_service_1=require(a87_0x3fb3a8(0x83)),playlist_mapper_1=require(a87_0x3fb3a8(0xc8)),enums_1=require(a87_0x3fb3a8(0x87)),path=require('path'),path_1=require(a87_0x3fb3a8(0xc5)),audio_player_1=require('../common/audio/audio-player'),sound_gateway_1=require(a87_0x3fb3a8(0x90));function a87_0xb875(){const _0x455e8e=['addSong','JobType','design:returntype','processRootPath','push','map','object','all','design:paramtypes','delete','159cFVyFD','findByIdAndDelete','@nestjs/mongoose','save','design:type','soundService','metadata','assign','118tzLOZz','1759RWbrdF','stop','2536371MAfzPh','broadcastPlaying','findByIds','playFromEvent','playAsync','PlaylistEvent','27036dzNAUJ','prototype','SoundGateway','1100144uUFkqJ','@nestjs/common','PlayMusic','agendaService','Inject','findById','@nestjs/event-emitter','cancelJob','Play\x20Music\x20Playlist:\x20','47940TRVWAI','\x20-\x20','../common/path','InjectModel','create','./mapper/playlist.mapper','logger','soundIds','play','../sound/sound.service','executeJob','mapToDto','fileName','filter','find','defineProperty','__decorate','AgendaService','log','__metadata','name','1955499aFLZMD','decorate','PROCESS_CACHE','../agenda/agenda.service','killAll','findOne','playlistModel','../common/enums','__esModule','../common/events','length','findByIdAndUpdate','Playlist','exec','Play','function','../sound/sound.gateway','SoundService','_id','OnEvent','Injectable','soundGateway','mongoose','PlaylistService','scheduleJob','4eIWBxl','Model','audio'];a87_0xb875=function(){return _0x455e8e;};return a87_0xb875();}let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x3a74fb,_0x11ee7e,_0x1182d5,_0x2c1d86){const _0x337bda=a87_0x3fb3a8;this[_0x337bda(0x86)]=_0x3a74fb,this['soundService']=_0x11ee7e,this[_0x337bda(0xbd)]=_0x1182d5,this['soundGateway']=_0x2c1d86,this[_0x337bda(0xc9)]=new common_1['Logger'](PlaylistService_1[_0x337bda(0x7f)]);}async[a87_0x3fb3a8(0xc7)](_0x55653d){const _0x5e007c=a87_0x3fb3a8,_0x39246a=new this['playlistModel'](_0x55653d);return _0x39246a[_0x5e007c(0xa9)]();}async['findAll'](){const _0x3bf9a7=a87_0x3fb3a8,_0x570379=await this['playlistModel'][_0x3bf9a7(0x79)]()[_0x3bf9a7(0x8d)](),_0x2931fc=_0x570379[_0x3bf9a7(0xa1)](async _0x12947d=>{const _0x5c0473=_0x3bf9a7,_0x292779=await this['soundService'][_0x5c0473(0xb3)](_0x12947d['soundIds']);return(0x0,playlist_mapper_1[_0x5c0473(0xce)])(_0x12947d,_0x292779);});return await Promise[_0x3bf9a7(0xa3)](_0x2931fc);}async[a87_0x3fb3a8(0x85)](_0x300713){const _0x5486e2=a87_0x3fb3a8,_0xea8192=await this[_0x5486e2(0x86)][_0x5486e2(0xbf)](_0x300713),_0x1e312a=await this[_0x5486e2(0xab)][_0x5486e2(0xb3)](_0xea8192[_0x5486e2(0xca)]);return(0x0,playlist_mapper_1[_0x5486e2(0xce)])(_0xea8192,_0x1e312a);}async['update'](_0x7f6bd3,_0xd76896){const _0x153415=a87_0x3fb3a8,_0x4a91d4=await this[_0x153415(0x86)][_0x153415(0x8b)](_0x7f6bd3,Object[_0x153415(0xad)](Object[_0x153415(0xad)]({},_0xd76896),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x1fdad0=await this[_0x153415(0xab)][_0x153415(0xb3)](_0x4a91d4[_0x153415(0xca)]);return(0x0,playlist_mapper_1[_0x153415(0xce)])(_0x4a91d4,_0x1fdad0);}async[a87_0x3fb3a8(0xa5)](_0x184689){const _0x50369b=a87_0x3fb3a8;return await this[_0x50369b(0x86)][_0x50369b(0xa7)](_0x184689);}async[a87_0x3fb3a8(0x9c)](_0x5905bd,_0x5df87a){const _0xba8a71=a87_0x3fb3a8,_0xc92a25=await this[_0xba8a71(0x86)][_0xba8a71(0xbf)](_0x5905bd);return _0xc92a25[_0xba8a71(0xca)][_0xba8a71(0xa0)](_0x5df87a),await _0xc92a25[_0xba8a71(0xa9)]();}async['removeSong'](_0x150b73,_0x48ecef){const _0x4ce4c5=a87_0x3fb3a8,_0x426b6e=await this['playlistModel'][_0x4ce4c5(0xbf)](_0x150b73);return _0x426b6e[_0x4ce4c5(0xca)]=_0x426b6e[_0x4ce4c5(0xca)][_0x4ce4c5(0x78)](_0x3d7ee1=>_0x3d7ee1!==_0x48ecef),await _0x426b6e['save']();}async[a87_0x3fb3a8(0xcb)](_0x3449e3,_0x4e186d){const _0x5b1354=a87_0x3fb3a8,_0x3f849a={'when':'now','jobType':enums_1[_0x5b1354(0x9d)][_0x5b1354(0xbc)],'attributes':{'playlistId':_0x4e186d},'audit':{'actor':_0x3449e3,'name':enums_1[_0x5b1354(0x9d)]['PlayMusic'],'message':_0x5b1354(0xc2)+_0x4e186d}},{jobId:_0x420fef}=await this[_0x5b1354(0xbd)][_0x5b1354(0x98)](_0x3f849a);return this['update'](_0x4e186d,{'jobId':_0x420fef});}async[a87_0x3fb3a8(0xb0)](_0x4c0341){const _0x548949=a87_0x3fb3a8;let _0x1df3c5=await this[_0x548949(0x85)](_0x4c0341);const {jobId:_0x2998a5}=_0x1df3c5||{};if(_0x2998a5){const {success:_0x254f6b}=await this[_0x548949(0xbd)][_0x548949(0xc1)](_0x2998a5);_0x254f6b&&(_0x1df3c5=await this['update'](_0x4c0341,{'jobId':null}));}return this[_0x548949(0x95)][_0x548949(0xb2)]({'id':_0x1df3c5[_0x548949(0x92)],'isPlaying':![]}),_0x1df3c5;}async[a87_0x3fb3a8(0xb4)](_0x362ea7){const _0x5e5067=a87_0x3fb3a8,{playlistId:_0x356164,jobId:_0x134c0f,durationInSecond:_0x8315d2}=_0x362ea7,_0x172519=await this[_0x5e5067(0x86)]['findById'](_0x356164),_0x373553=[..._0x172519[_0x5e5067(0xca)]],_0x4c773e=await this[_0x5e5067(0xab)][_0x5e5067(0xb3)](_0x373553),_0xde78e0=_0x4c773e[_0x5e5067(0xa1)](_0x25e7f0=>path['join'](path_1[_0x5e5067(0x9f)],'assets',_0x5e5067(0x9b),_0x25e7f0[_0x5e5067(0x77)]));job_1[_0x5e5067(0x82)][_0x5e5067(0x84)](),this[_0x5e5067(0xc9)][_0x5e5067(0x7d)]('Playing\x20playlist:\x20'+_0x356164+_0x5e5067(0xc4)+_0x172519[_0x5e5067(0x7f)]),(0x0,job_1[_0x5e5067(0xcd)])({'jobId':_0x134c0f,'run':()=>audio_player_1['AudioPlayer'][_0x5e5067(0xb5)](_0xde78e0,0x32,_0x172519['isShuffle']),'durationInSecond':_0x8315d2,'next':()=>this['stop'](_0x356164)}),this[_0x5e5067(0x95)][_0x5e5067(0xb2)]({'id':_0x356164,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1[a87_0x3fb3a8(0x93)])(events_1[a87_0x3fb3a8(0xb6)][a87_0x3fb3a8(0x8e)]),__metadata(a87_0x3fb3a8(0xaa),Function),__metadata(a87_0x3fb3a8(0xa4),[Object]),__metadata(a87_0x3fb3a8(0x9e),Promise)],PlaylistService[a87_0x3fb3a8(0xb8)],a87_0x3fb3a8(0xb4),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a87_0x3fb3a8(0x94)])(),__param(0x0,(0x0,mongoose_2[a87_0x3fb3a8(0xc6)])(a87_0x3fb3a8(0x8c))),__param(0x3,(0x0,common_1[a87_0x3fb3a8(0xbe)])(sound_gateway_1[a87_0x3fb3a8(0xb9)])),__metadata(a87_0x3fb3a8(0xa4),[mongoose_1[a87_0x3fb3a8(0x9a)],sound_service_1[a87_0x3fb3a8(0x91)],agenda_service_1[a87_0x3fb3a8(0x7c)],sound_gateway_1[a87_0x3fb3a8(0xb9)]])],PlaylistService),exports[a87_0x3fb3a8(0x97)]=PlaylistService;