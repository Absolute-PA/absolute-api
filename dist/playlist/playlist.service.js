'use strict';const a87_0x19768e=a87_0xf7a6;function a87_0xf7a6(_0x20d31b,_0x2bdadc){const _0x4311fa=a87_0x4311();return a87_0xf7a6=function(_0xf7a696,_0x3bd0c2){_0xf7a696=_0xf7a696-0x7e;let _0x6c47b=_0x4311fa[_0xf7a696];return _0x6c47b;},a87_0xf7a6(_0x20d31b,_0x2bdadc);}(function(_0x9bd7aa,_0x2508d5){const _0x3a8af1=a87_0xf7a6,_0x33febf=_0x9bd7aa();while(!![]){try{const _0x198425=-parseInt(_0x3a8af1(0xb9))/0x1*(parseInt(_0x3a8af1(0xae))/0x2)+parseInt(_0x3a8af1(0x7f))/0x3*(-parseInt(_0x3a8af1(0xbe))/0x4)+parseInt(_0x3a8af1(0xd6))/0x5*(parseInt(_0x3a8af1(0xc1))/0x6)+parseInt(_0x3a8af1(0x9a))/0x7*(parseInt(_0x3a8af1(0xce))/0x8)+-parseInt(_0x3a8af1(0xb7))/0x9+-parseInt(_0x3a8af1(0x98))/0xa*(parseInt(_0x3a8af1(0x9c))/0xb)+parseInt(_0x3a8af1(0x9b))/0xc;if(_0x198425===_0x2508d5)break;else _0x33febf['push'](_0x33febf['shift']());}catch(_0x941497){_0x33febf['push'](_0x33febf['shift']());}}}(a87_0x4311,0xb33ff));var __decorate=this&&this['__decorate']||function(_0x3bd74b,_0x5ae6fa,_0x1d8052,_0x35c5bd){const _0x4d685d=a87_0xf7a6;var _0x533994=arguments['length'],_0x424391=_0x533994<0x3?_0x5ae6fa:_0x35c5bd===null?_0x35c5bd=Object[_0x4d685d(0xb3)](_0x5ae6fa,_0x1d8052):_0x35c5bd,_0x3ecdc6;if(typeof Reflect===_0x4d685d(0xba)&&typeof Reflect[_0x4d685d(0xad)]===_0x4d685d(0xd3))_0x424391=Reflect[_0x4d685d(0xad)](_0x3bd74b,_0x5ae6fa,_0x1d8052,_0x35c5bd);else{for(var _0x4813c0=_0x3bd74b[_0x4d685d(0xc3)]-0x1;_0x4813c0>=0x0;_0x4813c0--)if(_0x3ecdc6=_0x3bd74b[_0x4813c0])_0x424391=(_0x533994<0x3?_0x3ecdc6(_0x424391):_0x533994>0x3?_0x3ecdc6(_0x5ae6fa,_0x1d8052,_0x424391):_0x3ecdc6(_0x5ae6fa,_0x1d8052))||_0x424391;}return _0x533994>0x3&&_0x424391&&Object[_0x4d685d(0x94)](_0x5ae6fa,_0x1d8052,_0x424391),_0x424391;},__metadata=this&&this['__metadata']||function(_0x44d3ac,_0x31ef0e){const _0x2e1595=a87_0xf7a6;if(typeof Reflect===_0x2e1595(0xba)&&typeof Reflect['metadata']==='function')return Reflect[_0x2e1595(0xcd)](_0x44d3ac,_0x31ef0e);},__param=this&&this[a87_0x19768e(0xc6)]||function(_0xd444b,_0x2261f2){return function(_0x212348,_0x2bd41c){_0x2261f2(_0x212348,_0x2bd41c,_0xd444b);};},PlaylistService_1;function a87_0x4311(){const _0x30cc36=['playlistModel','../agenda/agenda.service','PROCESS_CACHE','update','play','executeJob','findByIds','Play\x20Music\x20Playlist:\x20','filter','findOne','assign','scheduleJob','exec','decorate','30gZeAkx','_id','mongoose','__esModule','cancelJob','getOwnPropertyDescriptor','findByIdAndUpdate','JobType','../common/events','11291823bfKOrD','PlaylistService','88582XsXhjJ','object','broadcastPlaying','design:type','isShuffle','316OtLDnq','Playing\x20playlist:\x20','../common/audio/audio-player','246myJmlz','findByIdAndDelete','length','soundIds','removeSong','__param','findById','SoundService','Playlist','prototype','Model','fileName','metadata','55576mAZUfE','mapToDto','now','soundGateway','name','function','@nestjs/mongoose','PlaylistEvent','56345PLzaFb','SoundGateway','36489TDjOHp','join','./mapper/playlist.mapper','addSong','AudioPlayer','audio','logger','save','soundService','design:paramtypes','log','../common/job','Logger','stop','path','../common/path','findAll','all','agendaService','delete','@nestjs/event-emitter','defineProperty','find','processRootPath','../sound/sound.gateway','84610JxgHlt','../sound/sound.service','1162DvoUNU','41401236rJEyAy','1023yGdYHU','design:returntype','playFromEvent','PlayMusic'];a87_0x4311=function(){return _0x30cc36;};return a87_0x4311();}Object[a87_0x19768e(0x94)](exports,a87_0x19768e(0xb1),{'value':!![]}),exports[a87_0x19768e(0xb8)]=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a87_0x19768e(0xb0)),mongoose_2=require(a87_0x19768e(0xd4)),event_emitter_1=require(a87_0x19768e(0x93)),sound_service_1=require(a87_0x19768e(0x99)),job_1=require(a87_0x19768e(0x8a)),events_1=require(a87_0x19768e(0xb6)),agenda_service_1=require(a87_0x19768e(0xa1)),playlist_mapper_1=require(a87_0x19768e(0x81)),enums_1=require('../common/enums'),path=require(a87_0x19768e(0x8d)),path_1=require(a87_0x19768e(0x8e)),audio_player_1=require(a87_0x19768e(0xc0)),sound_gateway_1=require(a87_0x19768e(0x97));let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x3eff53,_0x4ab5cc,_0x2851b3,_0x19880f){const _0x45a529=a87_0x19768e;this[_0x45a529(0xa0)]=_0x3eff53,this['soundService']=_0x4ab5cc,this['agendaService']=_0x2851b3,this[_0x45a529(0xd1)]=_0x19880f,this[_0x45a529(0x85)]=new common_1[(_0x45a529(0x8b))](PlaylistService_1[_0x45a529(0xd2)]);}async['create'](_0x107695){const _0x24e1cb=a87_0x19768e,_0x3caa46=new this[(_0x24e1cb(0xa0))](_0x107695);return _0x3caa46[_0x24e1cb(0x86)]();}async[a87_0x19768e(0x8f)](){const _0x38ee15=a87_0x19768e,_0x5ba5e7=await this[_0x38ee15(0xa0)][_0x38ee15(0x95)]()[_0x38ee15(0xac)](),_0x25dc88=_0x5ba5e7['map'](async _0x143ad7=>{const _0x4e078a=_0x38ee15,_0x4418b2=await this[_0x4e078a(0x87)][_0x4e078a(0xa6)](_0x143ad7[_0x4e078a(0xc4)]);return(0x0,playlist_mapper_1[_0x4e078a(0xcf)])(_0x143ad7,_0x4418b2);});return await Promise[_0x38ee15(0x90)](_0x25dc88);}async[a87_0x19768e(0xa9)](_0x596d68){const _0x55d473=a87_0x19768e,_0x2600d7=await this[_0x55d473(0xa0)][_0x55d473(0xc7)](_0x596d68),_0x4fcab0=await this[_0x55d473(0x87)][_0x55d473(0xa6)](_0x2600d7[_0x55d473(0xc4)]);return(0x0,playlist_mapper_1[_0x55d473(0xcf)])(_0x2600d7,_0x4fcab0);}async[a87_0x19768e(0xa3)](_0x2e41a4,_0x117954){const _0x10bc6d=a87_0x19768e,_0x2e3520=await this[_0x10bc6d(0xa0)][_0x10bc6d(0xb4)](_0x2e41a4,Object[_0x10bc6d(0xaa)](Object[_0x10bc6d(0xaa)]({},_0x117954),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x3209b3=await this[_0x10bc6d(0x87)][_0x10bc6d(0xa6)](_0x2e3520[_0x10bc6d(0xc4)]);return(0x0,playlist_mapper_1[_0x10bc6d(0xcf)])(_0x2e3520,_0x3209b3);}async[a87_0x19768e(0x92)](_0x47dab8){const _0x3d4c71=a87_0x19768e;return await this['playlistModel'][_0x3d4c71(0xc2)](_0x47dab8);}async[a87_0x19768e(0x82)](_0x4ac785,_0x508bb4){const _0x59c09b=a87_0x19768e,_0x1e04e7=await this[_0x59c09b(0xa0)]['findById'](_0x4ac785);return _0x1e04e7[_0x59c09b(0xc4)]['push'](_0x508bb4),await _0x1e04e7[_0x59c09b(0x86)]();}async[a87_0x19768e(0xc5)](_0x5e908c,_0x561230){const _0x2ec756=a87_0x19768e,_0x1cc9a8=await this['playlistModel']['findById'](_0x5e908c);return _0x1cc9a8[_0x2ec756(0xc4)]=_0x1cc9a8['soundIds'][_0x2ec756(0xa8)](_0x545d68=>_0x545d68!==_0x561230),await _0x1cc9a8[_0x2ec756(0x86)]();}async[a87_0x19768e(0xa4)](_0x10b0ef,_0x2d9f6b){const _0x5e687b=a87_0x19768e,_0xe5738a={'when':_0x5e687b(0xd0),'jobType':enums_1[_0x5e687b(0xb5)][_0x5e687b(0x9f)],'attributes':{'playlistId':_0x2d9f6b},'audit':{'actor':_0x10b0ef,'name':enums_1[_0x5e687b(0xb5)]['PlayMusic'],'message':_0x5e687b(0xa7)+_0x2d9f6b}},{jobId:_0x2b3c7e}=await this['agendaService'][_0x5e687b(0xab)](_0xe5738a);return this[_0x5e687b(0xa3)](_0x2d9f6b,{'jobId':_0x2b3c7e});}async[a87_0x19768e(0x8c)](_0x49b2ad){const _0x369ea0=a87_0x19768e;let _0x4f48c8=await this[_0x369ea0(0xa9)](_0x49b2ad);const {jobId:_0x2f80d0}=_0x4f48c8||{};if(_0x2f80d0){const {success:_0x351b3b}=await this[_0x369ea0(0x91)][_0x369ea0(0xb2)](_0x2f80d0);_0x351b3b&&(_0x4f48c8=await this['update'](_0x49b2ad,{'jobId':null}));}return this[_0x369ea0(0xd1)][_0x369ea0(0xbb)]({'id':_0x4f48c8[_0x369ea0(0xaf)],'isPlaying':![]}),_0x4f48c8;}async['playFromEvent'](_0x2de351){const _0x53690c=a87_0x19768e,{playlistId:_0xcd145e,jobId:_0x59300b,durationInSecond:_0x500e10}=_0x2de351,_0x3edf2d=await this[_0x53690c(0xa0)][_0x53690c(0xc7)](_0xcd145e),_0x2e69e4=[..._0x3edf2d['soundIds']],_0x3b1276=await this['soundService'][_0x53690c(0xa6)](_0x2e69e4),_0x188d8f=_0x3b1276['map'](_0x58c46a=>path[_0x53690c(0x80)](path_1[_0x53690c(0x96)],'assets',_0x53690c(0x84),_0x58c46a[_0x53690c(0xcc)]));job_1[_0x53690c(0xa2)]['killAll'](),this[_0x53690c(0x85)][_0x53690c(0x89)](_0x53690c(0xbf)+_0xcd145e+'\x20-\x20'+_0x3edf2d[_0x53690c(0xd2)]),(0x0,job_1[_0x53690c(0xa5)])({'jobId':_0x59300b,'run':()=>audio_player_1[_0x53690c(0x83)]['playAsync'](_0x188d8f,0x32,_0x3edf2d[_0x53690c(0xbd)]),'durationInSecond':_0x500e10,'next':()=>this[_0x53690c(0x8c)](_0xcd145e)}),this[_0x53690c(0xd1)][_0x53690c(0xbb)]({'id':_0xcd145e,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1['OnEvent'])(events_1[a87_0x19768e(0xd5)]['Play']),__metadata(a87_0x19768e(0xbc),Function),__metadata(a87_0x19768e(0x88),[Object]),__metadata(a87_0x19768e(0x9d),Promise)],PlaylistService[a87_0x19768e(0xca)],a87_0x19768e(0x9e),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_2['InjectModel'])(a87_0x19768e(0xc9))),__param(0x3,(0x0,common_1['Inject'])(sound_gateway_1[a87_0x19768e(0x7e)])),__metadata(a87_0x19768e(0x88),[mongoose_1[a87_0x19768e(0xcb)],sound_service_1[a87_0x19768e(0xc8)],agenda_service_1['AgendaService'],sound_gateway_1['SoundGateway']])],PlaylistService),exports['PlaylistService']=PlaylistService;