'use strict';const a90_0x1b6691=a90_0x1d47;(function(_0x11c42e,_0x476045){const _0x968a09=a90_0x1d47,_0x691f0a=_0x11c42e();while(!![]){try{const _0x5254e2=-parseInt(_0x968a09(0x15c))/0x1+parseInt(_0x968a09(0x146))/0x2*(-parseInt(_0x968a09(0x142))/0x3)+-parseInt(_0x968a09(0x162))/0x4*(parseInt(_0x968a09(0x14c))/0x5)+parseInt(_0x968a09(0x13e))/0x6+-parseInt(_0x968a09(0x156))/0x7+parseInt(_0x968a09(0x153))/0x8*(-parseInt(_0x968a09(0x11c))/0x9)+-parseInt(_0x968a09(0x11e))/0xa*(-parseInt(_0x968a09(0x154))/0xb);if(_0x5254e2===_0x476045)break;else _0x691f0a['push'](_0x691f0a['shift']());}catch(_0x123998){_0x691f0a['push'](_0x691f0a['shift']());}}}(a90_0x5cf7,0xa1263));var __decorate=this&&this[a90_0x1b6691(0x125)]||function(_0x3e2cdf,_0x29f12f,_0x280641,_0x324c8f){const _0x1f05e9=a90_0x1b6691;var _0x4761c7=arguments[_0x1f05e9(0x158)],_0x191929=_0x4761c7<0x3?_0x29f12f:_0x324c8f===null?_0x324c8f=Object[_0x1f05e9(0x14d)](_0x29f12f,_0x280641):_0x324c8f,_0x24fc1b;if(typeof Reflect===_0x1f05e9(0x13a)&&typeof Reflect[_0x1f05e9(0x141)]==='function')_0x191929=Reflect['decorate'](_0x3e2cdf,_0x29f12f,_0x280641,_0x324c8f);else{for(var _0x2cd65c=_0x3e2cdf[_0x1f05e9(0x158)]-0x1;_0x2cd65c>=0x0;_0x2cd65c--)if(_0x24fc1b=_0x3e2cdf[_0x2cd65c])_0x191929=(_0x4761c7<0x3?_0x24fc1b(_0x191929):_0x4761c7>0x3?_0x24fc1b(_0x29f12f,_0x280641,_0x191929):_0x24fc1b(_0x29f12f,_0x280641))||_0x191929;}return _0x4761c7>0x3&&_0x191929&&Object[_0x1f05e9(0x152)](_0x29f12f,_0x280641,_0x191929),_0x191929;},__metadata=this&&this[a90_0x1b6691(0x134)]||function(_0x4e0703,_0x4f6b68){const _0x2a7a12=a90_0x1b6691;if(typeof Reflect===_0x2a7a12(0x13a)&&typeof Reflect[_0x2a7a12(0x132)]===_0x2a7a12(0x12c))return Reflect[_0x2a7a12(0x132)](_0x4e0703,_0x4f6b68);},__param=this&&this[a90_0x1b6691(0x118)]||function(_0x992f3c,_0x5cd1e9){return function(_0x4c9d14,_0x4c33e8){_0x5cd1e9(_0x4c9d14,_0x4c33e8,_0x992f3c);};},PlaylistService_1;Object[a90_0x1b6691(0x152)](exports,a90_0x1b6691(0x123),{'value':!![]}),exports[a90_0x1b6691(0x145)]=void 0x0;const common_1=require(a90_0x1b6691(0x15f)),mongoose_1=require(a90_0x1b6691(0x143)),mongoose_2=require(a90_0x1b6691(0x11b)),event_emitter_1=require(a90_0x1b6691(0x131)),sound_service_1=require(a90_0x1b6691(0x12a)),job_1=require(a90_0x1b6691(0x13c)),events_1=require(a90_0x1b6691(0x15e)),agenda_service_1=require(a90_0x1b6691(0x11f)),playlist_mapper_1=require('./mapper/playlist.mapper'),enums_1=require(a90_0x1b6691(0x163)),path=require(a90_0x1b6691(0x11a)),path_1=require(a90_0x1b6691(0x14b)),audio_player_1=require('../common/audio/audio-player'),sound_gateway_1=require('../sound/sound.gateway');let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x2bf9a0,_0x1f3e6a,_0x34d9d6,_0x8d02e9){const _0x60cbb6=a90_0x1b6691;this['playlistModel']=_0x2bf9a0,this[_0x60cbb6(0x155)]=_0x1f3e6a,this[_0x60cbb6(0x151)]=_0x34d9d6,this[_0x60cbb6(0x140)]=_0x8d02e9,this['logger']=new common_1[(_0x60cbb6(0x13b))](PlaylistService_1[_0x60cbb6(0x137)]);}async[a90_0x1b6691(0x147)](_0x5ee373){const _0x10e9d0=new this['playlistModel'](_0x5ee373);return _0x10e9d0['save']();}async[a90_0x1b6691(0x122)](){const _0x4ec204=a90_0x1b6691,_0x53c36c=await this['playlistModel'][_0x4ec204(0x168)]()['exec'](),_0x4ece48=_0x53c36c[_0x4ec204(0x144)](async _0x41106a=>{const _0x22b93a=_0x4ec204,_0x4de25c=await this[_0x22b93a(0x155)]['findByIds'](_0x41106a[_0x22b93a(0x12b)]);return(0x0,playlist_mapper_1[_0x22b93a(0x15b)])(_0x41106a,_0x4de25c);});return await Promise[_0x4ec204(0x136)](_0x4ece48);}async['findOne'](_0x29509c){const _0x2e4650=a90_0x1b6691,_0x1f1a4e=await this[_0x2e4650(0x157)][_0x2e4650(0x12d)](_0x29509c),_0x221086=await this[_0x2e4650(0x155)][_0x2e4650(0x139)](_0x1f1a4e[_0x2e4650(0x12b)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x1f1a4e,_0x221086);}async['update'](_0x29e8ee,_0xc60832){const _0x455bfa=a90_0x1b6691,_0x257966=await this[_0x455bfa(0x157)][_0x455bfa(0x13d)](_0x29e8ee,Object[_0x455bfa(0x117)](Object[_0x455bfa(0x117)]({},_0xc60832),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x5cce72=await this['soundService'][_0x455bfa(0x139)](_0x257966['soundIds']);return(0x0,playlist_mapper_1[_0x455bfa(0x15b)])(_0x257966,_0x5cce72);}async[a90_0x1b6691(0x135)](_0x5dbf47){const _0x540b7a=a90_0x1b6691;return await this[_0x540b7a(0x157)]['findByIdAndDelete'](_0x5dbf47);}async['addSong'](_0x5e7189,_0x381680){const _0x485595=a90_0x1b6691,_0x4b7ca1=await this['playlistModel']['findById'](_0x5e7189);return _0x4b7ca1['soundIds'][_0x485595(0x14e)](_0x381680),await _0x4b7ca1[_0x485595(0x121)]();}async['removeSong'](_0x286261,_0xbda60e){const _0x57410f=a90_0x1b6691,_0xabb256=await this[_0x57410f(0x157)][_0x57410f(0x12d)](_0x286261);return _0xabb256[_0x57410f(0x12b)]=_0xabb256[_0x57410f(0x12b)]['filter'](_0x34dc9f=>_0x34dc9f!==_0xbda60e),await _0xabb256[_0x57410f(0x121)]();}async[a90_0x1b6691(0x113)](_0x1eb0f7,_0x1a90bd){const _0x1994d9=a90_0x1b6691,_0x57d5b5={'when':_0x1994d9(0x120),'jobType':enums_1[_0x1994d9(0x126)][_0x1994d9(0x128)],'attributes':{'playlistId':_0x1a90bd},'audit':{'actor':_0x1eb0f7,'name':enums_1[_0x1994d9(0x126)][_0x1994d9(0x128)],'message':_0x1994d9(0x14f)+_0x1a90bd}},{jobId:_0x14bee8}=await this[_0x1994d9(0x151)]['scheduleJob'](_0x57d5b5);return this[_0x1994d9(0x165)](_0x1a90bd,{'jobId':_0x14bee8});}async[a90_0x1b6691(0x12e)](_0x257799){const _0x43315e=a90_0x1b6691;let _0x13f17c=await this[_0x43315e(0x149)](_0x257799);const {jobId:_0x4dca7a}=_0x13f17c||{};if(_0x4dca7a){const {success:_0x45f795}=await this[_0x43315e(0x151)]['cancelJob'](_0x4dca7a);_0x45f795&&(_0x13f17c=await this[_0x43315e(0x165)](_0x257799,{'jobId':null}));}return this['soundGateway']['broadcastPlaying']({'id':_0x13f17c[_0x43315e(0x127)],'isPlaying':![]}),_0x13f17c;}async[a90_0x1b6691(0x133)](_0x4fac46){const _0x5e5a93=a90_0x1b6691,{playlistId:_0x4917e2,jobId:_0x3024a4,durationInSecond:_0xbb5725}=_0x4fac46,_0x2cacac=await this[_0x5e5a93(0x157)][_0x5e5a93(0x12d)](_0x4917e2),_0x1fc3d7=[..._0x2cacac[_0x5e5a93(0x12b)]],_0x526244=await this[_0x5e5a93(0x155)][_0x5e5a93(0x139)](_0x1fc3d7),_0x18cda7=_0x526244[_0x5e5a93(0x144)](_0x2a61d6=>path[_0x5e5a93(0x124)](path_1[_0x5e5a93(0x116)],_0x5e5a93(0x167),'audio',_0x2a61d6[_0x5e5a93(0x164)]));job_1[_0x5e5a93(0x115)][_0x5e5a93(0x138)](),this['logger'][_0x5e5a93(0x14a)]('Playing\x20playlist:\x20'+_0x4917e2+_0x5e5a93(0x148)+_0x2cacac[_0x5e5a93(0x137)]),(0x0,job_1['executeJob'])({'jobId':_0x3024a4,'run':()=>audio_player_1[_0x5e5a93(0x130)]['playAsync'](_0x18cda7,0x32,_0x2cacac[_0x5e5a93(0x160)]),'durationInSecond':_0xbb5725,'next':()=>this[_0x5e5a93(0x12e)](_0x4917e2)}),this[_0x5e5a93(0x140)]['broadcastPlaying']({'id':_0x4917e2,'isPlaying':!![]});}};function a90_0x1d47(_0x1be497,_0x3d2e33){const _0x5cf7f5=a90_0x5cf7();return a90_0x1d47=function(_0x1d4761,_0x5d8d38){_0x1d4761=_0x1d4761-0x113;let _0x367ff4=_0x5cf7f5[_0x1d4761];return _0x367ff4;},a90_0x1d47(_0x1be497,_0x3d2e33);}__decorate([(0x0,event_emitter_1[a90_0x1b6691(0x166)])(events_1[a90_0x1b6691(0x150)][a90_0x1b6691(0x12f)]),__metadata(a90_0x1b6691(0x114),Function),__metadata(a90_0x1b6691(0x129),[Object]),__metadata(a90_0x1b6691(0x161),Promise)],PlaylistService[a90_0x1b6691(0x15a)],a90_0x1b6691(0x133),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a90_0x1b6691(0x159)])(),__param(0x0,(0x0,mongoose_2[a90_0x1b6691(0x11d)])('Playlist')),__param(0x3,(0x0,common_1['Inject'])(sound_gateway_1['SoundGateway'])),__metadata(a90_0x1b6691(0x129),[mongoose_1[a90_0x1b6691(0x15d)],sound_service_1['SoundService'],agenda_service_1[a90_0x1b6691(0x119)],sound_gateway_1[a90_0x1b6691(0x13f)]])],PlaylistService),exports['PlaylistService']=PlaylistService;function a90_0x5cf7(){const _0x2a0751=['log','../common/path','424675WBcDuw','getOwnPropertyDescriptor','push','Play\x20Music\x20Playlist:\x20','PlaylistEvent','agendaService','defineProperty','40jtHNYs','40546TiOWlN','soundService','4321975IktSbV','playlistModel','length','Injectable','prototype','mapToDto','563339MJskjy','Model','../common/events','@nestjs/common','isShuffle','design:returntype','12eSifHU','../common/enums','fileName','update','OnEvent','assets','find','play','design:type','PROCESS_CACHE','processRootPath','assign','__param','AgendaService','path','@nestjs/mongoose','2034999aVJBHk','InjectModel','7090hVNQyv','../agenda/agenda.service','now','save','findAll','__esModule','join','__decorate','JobType','_id','PlayMusic','design:paramtypes','../sound/sound.service','soundIds','function','findById','stop','Play','AudioPlayer','@nestjs/event-emitter','metadata','playFromEvent','__metadata','delete','all','name','killAll','findByIds','object','Logger','../common/job','findByIdAndUpdate','5914056NvJbzw','SoundGateway','soundGateway','decorate','1118577QYonJC','mongoose','map','PlaylistService','2mriHSe','create','\x20-\x20','findOne'];a90_0x5cf7=function(){return _0x2a0751;};return a90_0x5cf7();}