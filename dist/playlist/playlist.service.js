'use strict';function a87_0x37a6(_0x331f3f,_0x3c2323){const _0x6d5767=a87_0x6d57();return a87_0x37a6=function(_0x37a62d,_0x4e9bb6){_0x37a62d=_0x37a62d-0xfa;let _0x58a96f=_0x6d5767[_0x37a62d];return _0x58a96f;},a87_0x37a6(_0x331f3f,_0x3c2323);}const a87_0x224f45=a87_0x37a6;(function(_0x54831e,_0x14c012){const _0x415f77=a87_0x37a6,_0x562c12=_0x54831e();while(!![]){try{const _0x4b255b=parseInt(_0x415f77(0x147))/0x1+parseInt(_0x415f77(0x14c))/0x2+parseInt(_0x415f77(0x103))/0x3+-parseInt(_0x415f77(0x115))/0x4*(parseInt(_0x415f77(0x130))/0x5)+parseInt(_0x415f77(0x12e))/0x6*(-parseInt(_0x415f77(0x13b))/0x7)+-parseInt(_0x415f77(0x11c))/0x8*(parseInt(_0x415f77(0x154))/0x9)+parseInt(_0x415f77(0x121))/0xa*(parseInt(_0x415f77(0x120))/0xb);if(_0x4b255b===_0x14c012)break;else _0x562c12['push'](_0x562c12['shift']());}catch(_0x2d4a32){_0x562c12['push'](_0x562c12['shift']());}}}(a87_0x6d57,0x86be3));var __decorate=this&&this[a87_0x224f45(0x124)]||function(_0x2ba6d5,_0x13a964,_0x41002a,_0x1254c8){const _0x459514=a87_0x224f45;var _0xac2584=arguments[_0x459514(0x119)],_0x364e8a=_0xac2584<0x3?_0x13a964:_0x1254c8===null?_0x1254c8=Object[_0x459514(0x143)](_0x13a964,_0x41002a):_0x1254c8,_0x4b2386;if(typeof Reflect===_0x459514(0x14a)&&typeof Reflect[_0x459514(0xfc)]===_0x459514(0x12f))_0x364e8a=Reflect['decorate'](_0x2ba6d5,_0x13a964,_0x41002a,_0x1254c8);else{for(var _0x36c1a1=_0x2ba6d5[_0x459514(0x119)]-0x1;_0x36c1a1>=0x0;_0x36c1a1--)if(_0x4b2386=_0x2ba6d5[_0x36c1a1])_0x364e8a=(_0xac2584<0x3?_0x4b2386(_0x364e8a):_0xac2584>0x3?_0x4b2386(_0x13a964,_0x41002a,_0x364e8a):_0x4b2386(_0x13a964,_0x41002a))||_0x364e8a;}return _0xac2584>0x3&&_0x364e8a&&Object['defineProperty'](_0x13a964,_0x41002a,_0x364e8a),_0x364e8a;},__metadata=this&&this['__metadata']||function(_0x254ed5,_0x11c2a5){const _0x2bf156=a87_0x224f45;if(typeof Reflect==='object'&&typeof Reflect[_0x2bf156(0x127)]===_0x2bf156(0x12f))return Reflect['metadata'](_0x254ed5,_0x11c2a5);},__param=this&&this[a87_0x224f45(0x132)]||function(_0x3ea8ad,_0x50a428){return function(_0x308587,_0x4d4115){_0x50a428(_0x308587,_0x4d4115,_0x3ea8ad);};},PlaylistService_1;Object[a87_0x224f45(0x137)](exports,a87_0x224f45(0x152),{'value':!![]}),exports[a87_0x224f45(0x12b)]=void 0x0;const common_1=require(a87_0x224f45(0x126)),mongoose_1=require(a87_0x224f45(0x11a)),mongoose_2=require(a87_0x224f45(0x110)),event_emitter_1=require(a87_0x224f45(0x114)),sound_service_1=require('../sound/sound.service'),job_1=require(a87_0x224f45(0x134)),events_1=require(a87_0x224f45(0x12c)),agenda_service_1=require(a87_0x224f45(0x131)),playlist_mapper_1=require('./mapper/playlist.mapper'),enums_1=require(a87_0x224f45(0x14d)),path=require(a87_0x224f45(0x138)),path_1=require('../common/path'),audio_player_1=require(a87_0x224f45(0x10e)),sound_gateway_1=require(a87_0x224f45(0x140));function a87_0x6d57(){const _0x1b5823=['log','playFromEvent','length','mongoose','map','552lZXHGq','Model','playAsync','isShuffle','26213XWSvRd','1510vPbMUD','SoundGateway','filter','__decorate','now','@nestjs/common','metadata','Play','\x20-\x20','assets','PlaylistService','../common/events','soundIds','267060xhySTp','function','5Iposfk','../agenda/agenda.service','__param','broadcastPlaying','../common/job','name','findById','defineProperty','path','Inject','killAll','91dxYhdg','logger','AudioPlayer','update','push','../sound/sound.gateway','audio','Injectable','getOwnPropertyDescriptor','prototype','delete','design:type','509098bxzKYS','create','removeSong','object','design:paramtypes','1414602nZkWCP','../common/enums','fileName','Play\x20Music\x20Playlist:\x20','stop','InjectModel','__esModule','findAll','91890iGOKSx','processRootPath','soundService','decorate','JobType','findByIdAndUpdate','scheduleJob','agendaService','cancelJob','mapToDto','2447748uWmcPd','Logger','OnEvent','assign','addSong','PROCESS_CACHE','exec','executeJob','save','findByIds','findOne','../common/audio/audio-player','Playlist','@nestjs/mongoose','soundGateway','SoundService','playlistModel','@nestjs/event-emitter','2228484Ognayl','AgendaService'];a87_0x6d57=function(){return _0x1b5823;};return a87_0x6d57();}let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x30e0a3,_0x2541a3,_0x3e6d8c,_0x303140){const _0x2ad08b=a87_0x224f45;this[_0x2ad08b(0x113)]=_0x30e0a3,this[_0x2ad08b(0xfb)]=_0x2541a3,this[_0x2ad08b(0x100)]=_0x3e6d8c,this[_0x2ad08b(0x111)]=_0x303140,this[_0x2ad08b(0x13c)]=new common_1[(_0x2ad08b(0x104))](PlaylistService_1[_0x2ad08b(0x135)]);}async[a87_0x224f45(0x148)](_0x55dee){const _0xb50a54=a87_0x224f45,_0x47f5bc=new this[(_0xb50a54(0x113))](_0x55dee);return _0x47f5bc['save']();}async[a87_0x224f45(0x153)](){const _0x2ef0c0=a87_0x224f45,_0x41c8e5=await this[_0x2ef0c0(0x113)]['find']()[_0x2ef0c0(0x109)](),_0x459d5a=_0x41c8e5['map'](async _0x59dbbb=>{const _0x55576f=_0x2ef0c0,_0x2b18ea=await this[_0x55576f(0xfb)][_0x55576f(0x10c)](_0x59dbbb['soundIds']);return(0x0,playlist_mapper_1['mapToDto'])(_0x59dbbb,_0x2b18ea);});return await Promise['all'](_0x459d5a);}async[a87_0x224f45(0x10d)](_0x1932f3){const _0x3e2404=a87_0x224f45,_0x5b73b5=await this[_0x3e2404(0x113)][_0x3e2404(0x136)](_0x1932f3),_0x5ca772=await this[_0x3e2404(0xfb)][_0x3e2404(0x10c)](_0x5b73b5[_0x3e2404(0x12d)]);return(0x0,playlist_mapper_1[_0x3e2404(0x102)])(_0x5b73b5,_0x5ca772);}async[a87_0x224f45(0x13e)](_0x85642,_0x352b5a){const _0x4e46f=a87_0x224f45,_0x22e70e=await this[_0x4e46f(0x113)][_0x4e46f(0xfe)](_0x85642,Object[_0x4e46f(0x106)](Object[_0x4e46f(0x106)]({},_0x352b5a),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x476bd1=await this[_0x4e46f(0xfb)][_0x4e46f(0x10c)](_0x22e70e[_0x4e46f(0x12d)]);return(0x0,playlist_mapper_1[_0x4e46f(0x102)])(_0x22e70e,_0x476bd1);}async[a87_0x224f45(0x145)](_0x106b16){const _0xc7fabc=a87_0x224f45;return await this[_0xc7fabc(0x113)]['findByIdAndDelete'](_0x106b16);}async[a87_0x224f45(0x107)](_0xb54db7,_0x2ca5bc){const _0x24ad8d=a87_0x224f45,_0x247a5f=await this[_0x24ad8d(0x113)][_0x24ad8d(0x136)](_0xb54db7);return _0x247a5f[_0x24ad8d(0x12d)][_0x24ad8d(0x13f)](_0x2ca5bc),await _0x247a5f['save']();}async[a87_0x224f45(0x149)](_0x13a6dd,_0x1fa698){const _0x461664=a87_0x224f45,_0x412eb6=await this['playlistModel'][_0x461664(0x136)](_0x13a6dd);return _0x412eb6[_0x461664(0x12d)]=_0x412eb6['soundIds'][_0x461664(0x123)](_0x3f8332=>_0x3f8332!==_0x1fa698),await _0x412eb6[_0x461664(0x10b)]();}async['play'](_0x4b52fd,_0x129d66){const _0x561575=a87_0x224f45,_0x362060={'when':_0x561575(0x125),'jobType':enums_1[_0x561575(0xfd)]['PlayMusic'],'attributes':{'playlistId':_0x129d66},'audit':{'actor':_0x4b52fd,'name':enums_1[_0x561575(0xfd)]['PlayMusic'],'message':_0x561575(0x14f)+_0x129d66}},{jobId:_0x51e12d}=await this['agendaService'][_0x561575(0xff)](_0x362060);return this[_0x561575(0x13e)](_0x129d66,{'jobId':_0x51e12d});}async[a87_0x224f45(0x150)](_0x1f9b9d){const _0x51cc31=a87_0x224f45;let _0xb9c589=await this['findOne'](_0x1f9b9d);const {jobId:_0xf25c80}=_0xb9c589||{};if(_0xf25c80){const {success:_0x3404d7}=await this[_0x51cc31(0x100)][_0x51cc31(0x101)](_0xf25c80);_0x3404d7&&(_0xb9c589=await this[_0x51cc31(0x13e)](_0x1f9b9d,{'jobId':null}));}return this['soundGateway']['broadcastPlaying']({'id':_0xb9c589['_id'],'isPlaying':![]}),_0xb9c589;}async[a87_0x224f45(0x118)](_0x3bd7cf){const _0x30c61d=a87_0x224f45,{playlistId:_0x1ac941,jobId:_0x4c9093,durationInSecond:_0x2a1036}=_0x3bd7cf,_0x1f7b57=await this['playlistModel'][_0x30c61d(0x136)](_0x1ac941),_0x4fb64f=[..._0x1f7b57[_0x30c61d(0x12d)]],_0x149b83=await this['soundService'][_0x30c61d(0x10c)](_0x4fb64f),_0x123e36=_0x149b83[_0x30c61d(0x11b)](_0x5b8f88=>path['join'](path_1[_0x30c61d(0xfa)],_0x30c61d(0x12a),_0x30c61d(0x141),_0x5b8f88[_0x30c61d(0x14e)]));job_1[_0x30c61d(0x108)][_0x30c61d(0x13a)](),this[_0x30c61d(0x13c)][_0x30c61d(0x117)]('Playing\x20playlist:\x20'+_0x1ac941+_0x30c61d(0x129)+_0x1f7b57['name']),(0x0,job_1[_0x30c61d(0x10a)])({'jobId':_0x4c9093,'run':()=>audio_player_1[_0x30c61d(0x13d)][_0x30c61d(0x11e)](_0x123e36,0x32,_0x1f7b57[_0x30c61d(0x11f)]),'durationInSecond':_0x2a1036,'next':()=>this[_0x30c61d(0x150)](_0x1ac941)}),this[_0x30c61d(0x111)][_0x30c61d(0x133)]({'id':_0x1ac941,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1[a87_0x224f45(0x105)])(events_1['PlaylistEvent'][a87_0x224f45(0x128)]),__metadata(a87_0x224f45(0x146),Function),__metadata(a87_0x224f45(0x14b),[Object]),__metadata('design:returntype',Promise)],PlaylistService[a87_0x224f45(0x144)],a87_0x224f45(0x118),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a87_0x224f45(0x142)])(),__param(0x0,(0x0,mongoose_2[a87_0x224f45(0x151)])(a87_0x224f45(0x10f))),__param(0x3,(0x0,common_1[a87_0x224f45(0x139)])(sound_gateway_1['SoundGateway'])),__metadata(a87_0x224f45(0x14b),[mongoose_1[a87_0x224f45(0x11d)],sound_service_1[a87_0x224f45(0x112)],agenda_service_1[a87_0x224f45(0x116)],sound_gateway_1[a87_0x224f45(0x122)]])],PlaylistService),exports['PlaylistService']=PlaylistService;