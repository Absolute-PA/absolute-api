'use strict';const a87_0x7afa14=a87_0x573a;(function(_0xc994bd,_0x46709b){const _0xf534f8=a87_0x573a,_0x29a955=_0xc994bd();while(!![]){try{const _0x39f338=parseInt(_0xf534f8(0x12b))/0x1+-parseInt(_0xf534f8(0x148))/0x2+-parseInt(_0xf534f8(0x155))/0x3*(-parseInt(_0xf534f8(0x163))/0x4)+parseInt(_0xf534f8(0x153))/0x5+parseInt(_0xf534f8(0x129))/0x6*(parseInt(_0xf534f8(0x13b))/0x7)+parseInt(_0xf534f8(0x14d))/0x8+-parseInt(_0xf534f8(0x15d))/0x9;if(_0x39f338===_0x46709b)break;else _0x29a955['push'](_0x29a955['shift']());}catch(_0x4b4be2){_0x29a955['push'](_0x29a955['shift']());}}}(a87_0x1f9b,0x38fae));var __decorate=this&&this[a87_0x7afa14(0x142)]||function(_0x10b497,_0x32bf26,_0x3a8d79,_0x4359be){const _0x16a710=a87_0x7afa14;var _0x161525=arguments[_0x16a710(0x158)],_0x4f6877=_0x161525<0x3?_0x32bf26:_0x4359be===null?_0x4359be=Object[_0x16a710(0x161)](_0x32bf26,_0x3a8d79):_0x4359be,_0x51865f;if(typeof Reflect===_0x16a710(0x134)&&typeof Reflect[_0x16a710(0x15e)]==='function')_0x4f6877=Reflect[_0x16a710(0x15e)](_0x10b497,_0x32bf26,_0x3a8d79,_0x4359be);else{for(var _0x517ce0=_0x10b497[_0x16a710(0x158)]-0x1;_0x517ce0>=0x0;_0x517ce0--)if(_0x51865f=_0x10b497[_0x517ce0])_0x4f6877=(_0x161525<0x3?_0x51865f(_0x4f6877):_0x161525>0x3?_0x51865f(_0x32bf26,_0x3a8d79,_0x4f6877):_0x51865f(_0x32bf26,_0x3a8d79))||_0x4f6877;}return _0x161525>0x3&&_0x4f6877&&Object[_0x16a710(0x132)](_0x32bf26,_0x3a8d79,_0x4f6877),_0x4f6877;},__metadata=this&&this['__metadata']||function(_0x4039ee,_0x393ffe){const _0x59b3c7=a87_0x7afa14;if(typeof Reflect===_0x59b3c7(0x134)&&typeof Reflect['metadata']==='function')return Reflect[_0x59b3c7(0x162)](_0x4039ee,_0x393ffe);},__param=this&&this[a87_0x7afa14(0x167)]||function(_0x3c9c34,_0x41c929){return function(_0x3d7a98,_0x301b41){_0x41c929(_0x3d7a98,_0x301b41,_0x3c9c34);};},PlaylistService_1;Object[a87_0x7afa14(0x132)](exports,a87_0x7afa14(0x160),{'value':!![]}),exports[a87_0x7afa14(0x127)]=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a87_0x7afa14(0x16d)),mongoose_2=require(a87_0x7afa14(0x16a)),event_emitter_1=require('@nestjs/event-emitter'),sound_service_1=require(a87_0x7afa14(0x173)),job_1=require(a87_0x7afa14(0x16b)),events_1=require('../common/events'),agenda_service_1=require(a87_0x7afa14(0x170)),playlist_mapper_1=require(a87_0x7afa14(0x13c)),enums_1=require(a87_0x7afa14(0x150)),path=require('path'),path_1=require(a87_0x7afa14(0x143)),audio_player_1=require(a87_0x7afa14(0x14a)),sound_gateway_1=require(a87_0x7afa14(0x144));let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x5d4de8,_0x3d96a9,_0x2c4ec1,_0x51dc57){const _0x5ef3d7=a87_0x7afa14;this[_0x5ef3d7(0x13f)]=_0x5d4de8,this['soundService']=_0x3d96a9,this[_0x5ef3d7(0x12e)]=_0x2c4ec1,this[_0x5ef3d7(0x171)]=_0x51dc57,this[_0x5ef3d7(0x16c)]=new common_1['Logger'](PlaylistService_1[_0x5ef3d7(0x15f)]);}async[a87_0x7afa14(0x15b)](_0x198916){const _0x466db8=a87_0x7afa14,_0xecad3=new this[(_0x466db8(0x13f))](_0x198916);return _0xecad3[_0x466db8(0x141)]();}async[a87_0x7afa14(0x135)](){const _0x2feca7=a87_0x7afa14,_0x4f90a6=await this['playlistModel'][_0x2feca7(0x14e)]()[_0x2feca7(0x125)](),_0x52c380=_0x4f90a6[_0x2feca7(0x146)](async _0x30c201=>{const _0x24f837=_0x2feca7,_0x4c9a9c=await this['soundService'][_0x24f837(0x174)](_0x30c201[_0x24f837(0x164)]);return(0x0,playlist_mapper_1[_0x24f837(0x136)])(_0x30c201,_0x4c9a9c);});return await Promise['all'](_0x52c380);}async['findOne'](_0x783452){const _0x1842c9=a87_0x7afa14,_0x5cc1ac=await this['playlistModel']['findById'](_0x783452),_0x269f13=await this[_0x1842c9(0x165)][_0x1842c9(0x174)](_0x5cc1ac[_0x1842c9(0x164)]);return(0x0,playlist_mapper_1[_0x1842c9(0x136)])(_0x5cc1ac,_0x269f13);}async[a87_0x7afa14(0x13a)](_0x243ec5,_0x520647){const _0x610f19=a87_0x7afa14,_0x6175d9=await this[_0x610f19(0x13f)][_0x610f19(0x13d)](_0x243ec5,Object[_0x610f19(0x154)](Object[_0x610f19(0x154)]({},_0x520647),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x3270f4=await this[_0x610f19(0x165)][_0x610f19(0x174)](_0x6175d9[_0x610f19(0x164)]);return(0x0,playlist_mapper_1[_0x610f19(0x136)])(_0x6175d9,_0x3270f4);}async[a87_0x7afa14(0x168)](_0x485b35){const _0x129f8d=a87_0x7afa14;return await this[_0x129f8d(0x13f)]['findByIdAndDelete'](_0x485b35);}async[a87_0x7afa14(0x133)](_0x27bb42,_0x47dd44){const _0x408ead=a87_0x7afa14,_0x4dd1c3=await this[_0x408ead(0x13f)][_0x408ead(0x130)](_0x27bb42);return _0x4dd1c3[_0x408ead(0x164)][_0x408ead(0x147)](_0x47dd44),await _0x4dd1c3[_0x408ead(0x141)]();}async[a87_0x7afa14(0x16f)](_0x3a3828,_0x859049){const _0x5ee516=a87_0x7afa14,_0x3e7863=await this[_0x5ee516(0x13f)][_0x5ee516(0x130)](_0x3a3828);return _0x3e7863[_0x5ee516(0x164)]=_0x3e7863[_0x5ee516(0x164)][_0x5ee516(0x14f)](_0x201c08=>_0x201c08!==_0x859049),await _0x3e7863['save']();}async['play'](_0x6c180f,_0x20abef){const _0x13484c=a87_0x7afa14,_0x2711aa={'when':_0x13484c(0x16e),'jobType':enums_1[_0x13484c(0x169)][_0x13484c(0x149)],'attributes':{'playlistId':_0x20abef},'audit':{'actor':_0x6c180f,'name':enums_1['JobType'][_0x13484c(0x149)],'message':'Play\x20Music\x20Playlist:\x20'+_0x20abef}},{jobId:_0xd591b2}=await this['agendaService'][_0x13484c(0x13e)](_0x2711aa);return this['update'](_0x20abef,{'jobId':_0xd591b2});}async[a87_0x7afa14(0x128)](_0x5b3f02){const _0x360054=a87_0x7afa14;let _0x27562b=await this[_0x360054(0x157)](_0x5b3f02);const {jobId:_0x4c3326}=_0x27562b||{};if(_0x4c3326){const {success:_0x31ad78}=await this[_0x360054(0x12e)][_0x360054(0x152)](_0x4c3326);_0x31ad78&&(_0x27562b=await this[_0x360054(0x13a)](_0x5b3f02,{'jobId':null}));}return this['soundGateway']['broadcastPlaying']({'id':_0x27562b['_id'],'isPlaying':![]}),_0x27562b;}async[a87_0x7afa14(0x151)](_0x5e0056){const _0x1011f8=a87_0x7afa14,{playlistId:_0x33969d,jobId:_0x420d60,durationInSecond:_0x1ea00a}=_0x5e0056,_0xd894b3=await this[_0x1011f8(0x13f)][_0x1011f8(0x130)](_0x33969d),_0xc75dab=[..._0xd894b3[_0x1011f8(0x164)]],_0x1ccfb0=await this['soundService'][_0x1011f8(0x174)](_0xc75dab),_0x27ea62=_0x1ccfb0[_0x1011f8(0x146)](_0x4ba008=>path['join'](path_1['processRootPath'],'assets',_0x1011f8(0x15a),_0x4ba008[_0x1011f8(0x137)]));job_1[_0x1011f8(0x159)][_0x1011f8(0x12a)](),this[_0x1011f8(0x16c)][_0x1011f8(0x172)]('Playing\x20playlist:\x20'+_0x33969d+'\x20-\x20'+_0xd894b3[_0x1011f8(0x15f)]),(0x0,job_1[_0x1011f8(0x145)])({'jobId':_0x420d60,'run':()=>audio_player_1['AudioPlayer'][_0x1011f8(0x14b)](_0x27ea62,0x32,_0xd894b3['isShuffle']),'durationInSecond':_0x1ea00a,'next':()=>this[_0x1011f8(0x128)](_0x33969d)}),this[_0x1011f8(0x171)][_0x1011f8(0x124)]({'id':_0x33969d,'isPlaying':!![]});}};function a87_0x573a(_0x57cea2,_0x5a1353){const _0x1f9b2f=a87_0x1f9b();return a87_0x573a=function(_0x573a47,_0x5cbe60){_0x573a47=_0x573a47-0x124;let _0x324c57=_0x1f9b2f[_0x573a47];return _0x324c57;},a87_0x573a(_0x57cea2,_0x5a1353);}function a87_0x1f9b(){const _0x19e984=['scheduleJob','playlistModel','Model','save','__decorate','../common/path','../sound/sound.gateway','executeJob','map','push','195346HSHFAc','PlayMusic','../common/audio/audio-player','playAsync','SoundGateway','1291040FlNjvO','find','filter','../common/enums','playFromEvent','cancelJob','702450VYaezD','assign','321681jFgfKU','Playlist','findOne','length','PROCESS_CACHE','audio','create','design:returntype','3768894oZoHRn','decorate','name','__esModule','getOwnPropertyDescriptor','metadata','4gGStrO','soundIds','soundService','Inject','__param','delete','JobType','@nestjs/mongoose','../common/job','logger','mongoose','now','removeSong','../agenda/agenda.service','soundGateway','log','../sound/sound.service','findByIds','broadcastPlaying','exec','design:paramtypes','PlaylistService','stop','12TBMbBR','killAll','195590PeXAQo','InjectModel','PlaylistEvent','agendaService','Play','findById','design:type','defineProperty','addSong','object','findAll','mapToDto','fileName','SoundService','OnEvent','update','507997baZZAW','./mapper/playlist.mapper','findByIdAndUpdate'];a87_0x1f9b=function(){return _0x19e984;};return a87_0x1f9b();}__decorate([(0x0,event_emitter_1[a87_0x7afa14(0x139)])(events_1[a87_0x7afa14(0x12d)][a87_0x7afa14(0x12f)]),__metadata(a87_0x7afa14(0x131),Function),__metadata('design:paramtypes',[Object]),__metadata(a87_0x7afa14(0x15c),Promise)],PlaylistService['prototype'],a87_0x7afa14(0x151),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_2[a87_0x7afa14(0x12c)])(a87_0x7afa14(0x156))),__param(0x3,(0x0,common_1[a87_0x7afa14(0x166)])(sound_gateway_1['SoundGateway'])),__metadata(a87_0x7afa14(0x126),[mongoose_1[a87_0x7afa14(0x140)],sound_service_1[a87_0x7afa14(0x138)],agenda_service_1['AgendaService'],sound_gateway_1[a87_0x7afa14(0x14c)]])],PlaylistService),exports[a87_0x7afa14(0x127)]=PlaylistService;