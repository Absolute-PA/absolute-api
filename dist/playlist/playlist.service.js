'use strict';function a90_0x23b6(_0x713d29,_0xb7b1d){const _0x23df4f=a90_0x23df();return a90_0x23b6=function(_0x23b62f,_0x272fb5){_0x23b62f=_0x23b62f-0x1e0;let _0xca6a5b=_0x23df4f[_0x23b62f];return _0xca6a5b;},a90_0x23b6(_0x713d29,_0xb7b1d);}const a90_0x266485=a90_0x23b6;(function(_0x586397,_0x3f5c62){const _0x21d3b6=a90_0x23b6,_0x32901a=_0x586397();while(!![]){try{const _0x36d209=parseInt(_0x21d3b6(0x237))/0x1+-parseInt(_0x21d3b6(0x20d))/0x2*(-parseInt(_0x21d3b6(0x1eb))/0x3)+parseInt(_0x21d3b6(0x229))/0x4+-parseInt(_0x21d3b6(0x210))/0x5+parseInt(_0x21d3b6(0x238))/0x6*(parseInt(_0x21d3b6(0x1ec))/0x7)+-parseInt(_0x21d3b6(0x1fa))/0x8*(-parseInt(_0x21d3b6(0x226))/0x9)+-parseInt(_0x21d3b6(0x239))/0xa*(parseInt(_0x21d3b6(0x213))/0xb);if(_0x36d209===_0x3f5c62)break;else _0x32901a['push'](_0x32901a['shift']());}catch(_0x490d6e){_0x32901a['push'](_0x32901a['shift']());}}}(a90_0x23df,0xe9fd2));var __decorate=this&&this[a90_0x266485(0x211)]||function(_0x322ff0,_0x2a8018,_0x694f53,_0x5a1e6b){const _0x283de2=a90_0x266485;var _0x3ada88=arguments['length'],_0x233717=_0x3ada88<0x3?_0x2a8018:_0x5a1e6b===null?_0x5a1e6b=Object[_0x283de2(0x21d)](_0x2a8018,_0x694f53):_0x5a1e6b,_0x5ef93d;if(typeof Reflect===_0x283de2(0x232)&&typeof Reflect[_0x283de2(0x218)]===_0x283de2(0x225))_0x233717=Reflect[_0x283de2(0x218)](_0x322ff0,_0x2a8018,_0x694f53,_0x5a1e6b);else{for(var _0x47b3ef=_0x322ff0[_0x283de2(0x21b)]-0x1;_0x47b3ef>=0x0;_0x47b3ef--)if(_0x5ef93d=_0x322ff0[_0x47b3ef])_0x233717=(_0x3ada88<0x3?_0x5ef93d(_0x233717):_0x3ada88>0x3?_0x5ef93d(_0x2a8018,_0x694f53,_0x233717):_0x5ef93d(_0x2a8018,_0x694f53))||_0x233717;}return _0x3ada88>0x3&&_0x233717&&Object[_0x283de2(0x22e)](_0x2a8018,_0x694f53,_0x233717),_0x233717;},__metadata=this&&this[a90_0x266485(0x1e2)]||function(_0x5dc2b9,_0x1473e9){const _0x21dd46=a90_0x266485;if(typeof Reflect===_0x21dd46(0x232)&&typeof Reflect[_0x21dd46(0x227)]===_0x21dd46(0x225))return Reflect['metadata'](_0x5dc2b9,_0x1473e9);},__param=this&&this[a90_0x266485(0x1f5)]||function(_0x251e60,_0xb58412){return function(_0x3aa96d,_0x5e0c04){_0xb58412(_0x3aa96d,_0x5e0c04,_0x251e60);};},PlaylistService_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a90_0x266485(0x217)]=void 0x0;const common_1=require(a90_0x266485(0x201)),mongoose_1=require(a90_0x266485(0x21e)),mongoose_2=require(a90_0x266485(0x224)),event_emitter_1=require(a90_0x266485(0x209)),sound_service_1=require(a90_0x266485(0x1e1)),job_1=require(a90_0x266485(0x22a)),events_1=require(a90_0x266485(0x22c)),agenda_service_1=require(a90_0x266485(0x20f)),playlist_mapper_1=require(a90_0x266485(0x220)),enums_1=require(a90_0x266485(0x21a)),path=require(a90_0x266485(0x216)),path_1=require(a90_0x266485(0x233)),audio_player_1=require(a90_0x266485(0x22b)),sound_gateway_1=require('../sound/sound.gateway');function a90_0x23df(){const _0x5e3d70=['_id','@nestjs/event-emitter','join','soundGateway','filter','36952kbzQoG','play','../agenda/agenda.service','1029340HceJKc','__decorate','name','11tIrCKR','prototype','findByIds','path','PlaylistService','decorate','save','../common/enums','length','SoundGateway','getOwnPropertyDescriptor','mongoose','Play\x20Music\x20Playlist:\x20','./mapper/playlist.mapper','PlayMusic','log','Model','@nestjs/mongoose','function','715626vSxnLb','metadata','processRootPath','1809872RsyicB','../common/job','../common/audio/audio-player','../common/events','find','defineProperty','Injectable','Play','scheduleJob','object','../common/path','audio','removeSong','AgendaService','381054RBeQjs','30roPknE','20625190DAfWUX','map','../sound/sound.service','__metadata','design:returntype','push','delete','playAsync','logger','killAll','playlistModel','OnEvent','201IGwRVp','615671qTZnOs','design:paramtypes','update','agendaService','all','addSong','findOne','findById','assign','__param','stop','assets','executeJob','soundService','72rxRtQJ','Playlist','broadcastPlaying','JobType','fileName','findAll','Logger','@nestjs/common','SoundService','now','isShuffle','design:type','mapToDto','soundIds'];a90_0x23df=function(){return _0x5e3d70;};return a90_0x23df();}let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x3f9590,_0x483643,_0x3ade3d,_0x16524e){const _0xbf7324=a90_0x266485;this['playlistModel']=_0x3f9590,this[_0xbf7324(0x1f9)]=_0x483643,this[_0xbf7324(0x1ef)]=_0x3ade3d,this['soundGateway']=_0x16524e,this[_0xbf7324(0x1e7)]=new common_1[(_0xbf7324(0x200))](PlaylistService_1['name']);}async['create'](_0x2c4c7b){const _0x582b91=a90_0x266485,_0x26527f=new this['playlistModel'](_0x2c4c7b);return _0x26527f[_0x582b91(0x219)]();}async[a90_0x266485(0x1ff)](){const _0x30abb0=a90_0x266485,_0x3941f1=await this[_0x30abb0(0x1e9)][_0x30abb0(0x22d)]()['exec'](),_0x348130=_0x3941f1['map'](async _0xe7e92f=>{const _0x4c0106=_0x30abb0,_0x1a3c08=await this['soundService'][_0x4c0106(0x215)](_0xe7e92f[_0x4c0106(0x207)]);return(0x0,playlist_mapper_1[_0x4c0106(0x206)])(_0xe7e92f,_0x1a3c08);});return await Promise[_0x30abb0(0x1f0)](_0x348130);}async[a90_0x266485(0x1f2)](_0x37df2d){const _0x305365=a90_0x266485,_0x1cd56e=await this['playlistModel'][_0x305365(0x1f3)](_0x37df2d),_0xfcd442=await this['soundService'][_0x305365(0x215)](_0x1cd56e['soundIds']);return(0x0,playlist_mapper_1[_0x305365(0x206)])(_0x1cd56e,_0xfcd442);}async['update'](_0x25e901,_0x257901){const _0x42d740=a90_0x266485,_0x5d0c04=await this['playlistModel']['findByIdAndUpdate'](_0x25e901,Object[_0x42d740(0x1f4)](Object[_0x42d740(0x1f4)]({},_0x257901),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x32dde1=await this[_0x42d740(0x1f9)][_0x42d740(0x215)](_0x5d0c04['soundIds']);return(0x0,playlist_mapper_1[_0x42d740(0x206)])(_0x5d0c04,_0x32dde1);}async[a90_0x266485(0x1e5)](_0x56c852){const _0x3efc79=a90_0x266485;return await this[_0x3efc79(0x1e9)]['findByIdAndDelete'](_0x56c852);}async[a90_0x266485(0x1f1)](_0x16bfd0,_0x2394ca){const _0x3fe0f1=a90_0x266485,_0x496efe=await this[_0x3fe0f1(0x1e9)][_0x3fe0f1(0x1f3)](_0x16bfd0);return _0x496efe[_0x3fe0f1(0x207)][_0x3fe0f1(0x1e4)](_0x2394ca),await _0x496efe[_0x3fe0f1(0x219)]();}async[a90_0x266485(0x235)](_0x3cbac2,_0x4a9aca){const _0x3c2743=a90_0x266485,_0x146105=await this['playlistModel'][_0x3c2743(0x1f3)](_0x3cbac2);return _0x146105[_0x3c2743(0x207)]=_0x146105[_0x3c2743(0x207)][_0x3c2743(0x20c)](_0x332db2=>_0x332db2!==_0x4a9aca),await _0x146105['save']();}async[a90_0x266485(0x20e)](_0x4d82c0,_0xd83210){const _0x55bc6f=a90_0x266485,_0x4b0518={'when':_0x55bc6f(0x203),'jobType':enums_1[_0x55bc6f(0x1fd)][_0x55bc6f(0x221)],'attributes':{'playlistId':_0xd83210},'audit':{'actor':_0x4d82c0,'name':enums_1['JobType']['PlayMusic'],'message':_0x55bc6f(0x21f)+_0xd83210}},{jobId:_0x49dd42}=await this[_0x55bc6f(0x1ef)][_0x55bc6f(0x231)](_0x4b0518);return this['update'](_0xd83210,{'jobId':_0x49dd42});}async[a90_0x266485(0x1f6)](_0x2bc137){const _0x12523f=a90_0x266485;let _0x1da1f1=await this[_0x12523f(0x1f2)](_0x2bc137);const {jobId:_0x4221fa}=_0x1da1f1||{};if(_0x4221fa){const {success:_0x435de2}=await this[_0x12523f(0x1ef)]['cancelJob'](_0x4221fa);_0x435de2&&(_0x1da1f1=await this[_0x12523f(0x1ee)](_0x2bc137,{'jobId':null}));}return this[_0x12523f(0x20b)][_0x12523f(0x1fc)]({'id':_0x1da1f1[_0x12523f(0x208)],'isPlaying':![]}),_0x1da1f1;}async['playFromEvent'](_0x5338ab){const _0x306fb3=a90_0x266485,{playlistId:_0x3f6b44,jobId:_0x45b79f,durationInSecond:_0x1c428a}=_0x5338ab,_0x37fcd7=await this[_0x306fb3(0x1e9)]['findById'](_0x3f6b44),_0x3d441e=[..._0x37fcd7[_0x306fb3(0x207)]],_0x4c6375=await this[_0x306fb3(0x1f9)][_0x306fb3(0x215)](_0x3d441e),_0x4481db=_0x4c6375[_0x306fb3(0x1e0)](_0x5b7695=>path[_0x306fb3(0x20a)](path_1[_0x306fb3(0x228)],_0x306fb3(0x1f7),_0x306fb3(0x234),_0x5b7695[_0x306fb3(0x1fe)]));job_1['PROCESS_CACHE'][_0x306fb3(0x1e8)](),this[_0x306fb3(0x1e7)][_0x306fb3(0x222)]('Playing\x20playlist:\x20'+_0x3f6b44+'\x20-\x20'+_0x37fcd7[_0x306fb3(0x212)]),(0x0,job_1[_0x306fb3(0x1f8)])({'jobId':_0x45b79f,'run':()=>audio_player_1['AudioPlayer'][_0x306fb3(0x1e6)](_0x4481db,0x32,_0x37fcd7[_0x306fb3(0x204)]),'durationInSecond':_0x1c428a,'next':()=>this[_0x306fb3(0x1f6)](_0x3f6b44)}),this[_0x306fb3(0x20b)]['broadcastPlaying']({'id':_0x3f6b44,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1[a90_0x266485(0x1ea)])(events_1['PlaylistEvent'][a90_0x266485(0x230)]),__metadata(a90_0x266485(0x205),Function),__metadata(a90_0x266485(0x1ed),[Object]),__metadata(a90_0x266485(0x1e3),Promise)],PlaylistService[a90_0x266485(0x214)],'playFromEvent',null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a90_0x266485(0x22f)])(),__param(0x0,(0x0,mongoose_2['InjectModel'])(a90_0x266485(0x1fb))),__param(0x3,(0x0,common_1['Inject'])(sound_gateway_1[a90_0x266485(0x21c)])),__metadata(a90_0x266485(0x1ed),[mongoose_1[a90_0x266485(0x223)],sound_service_1[a90_0x266485(0x202)],agenda_service_1[a90_0x266485(0x236)],sound_gateway_1[a90_0x266485(0x21c)]])],PlaylistService),exports[a90_0x266485(0x217)]=PlaylistService;