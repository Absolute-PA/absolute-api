'use strict';function a87_0x45f7(_0x5ee62f,_0x23f04c){const _0xee0be4=a87_0xee0b();return a87_0x45f7=function(_0x45f7d3,_0x459071){_0x45f7d3=_0x45f7d3-0x1c1;let _0x2b86f9=_0xee0be4[_0x45f7d3];return _0x2b86f9;},a87_0x45f7(_0x5ee62f,_0x23f04c);}const a87_0x425366=a87_0x45f7;(function(_0x45b319,_0x3a9000){const _0x51e0b5=a87_0x45f7,_0x493feb=_0x45b319();while(!![]){try{const _0x14bad9=parseInt(_0x51e0b5(0x1f0))/0x1+-parseInt(_0x51e0b5(0x1e3))/0x2*(parseInt(_0x51e0b5(0x1db))/0x3)+parseInt(_0x51e0b5(0x207))/0x4*(parseInt(_0x51e0b5(0x1cd))/0x5)+-parseInt(_0x51e0b5(0x1d7))/0x6+-parseInt(_0x51e0b5(0x1f7))/0x7*(parseInt(_0x51e0b5(0x1fb))/0x8)+parseInt(_0x51e0b5(0x1ff))/0x9+parseInt(_0x51e0b5(0x1ec))/0xa;if(_0x14bad9===_0x3a9000)break;else _0x493feb['push'](_0x493feb['shift']());}catch(_0x1eb129){_0x493feb['push'](_0x493feb['shift']());}}}(a87_0xee0b,0x3c3bc));var __decorate=this&&this[a87_0x425366(0x1f1)]||function(_0x2a72a8,_0x2c435a,_0x138e8b,_0x1703c9){const _0x17e908=a87_0x425366;var _0x1b7466=arguments[_0x17e908(0x210)],_0x34d988=_0x1b7466<0x3?_0x2c435a:_0x1703c9===null?_0x1703c9=Object[_0x17e908(0x1f9)](_0x2c435a,_0x138e8b):_0x1703c9,_0x4eab4e;if(typeof Reflect===_0x17e908(0x1ea)&&typeof Reflect['decorate']===_0x17e908(0x204))_0x34d988=Reflect[_0x17e908(0x1da)](_0x2a72a8,_0x2c435a,_0x138e8b,_0x1703c9);else{for(var _0x580c2e=_0x2a72a8[_0x17e908(0x210)]-0x1;_0x580c2e>=0x0;_0x580c2e--)if(_0x4eab4e=_0x2a72a8[_0x580c2e])_0x34d988=(_0x1b7466<0x3?_0x4eab4e(_0x34d988):_0x1b7466>0x3?_0x4eab4e(_0x2c435a,_0x138e8b,_0x34d988):_0x4eab4e(_0x2c435a,_0x138e8b))||_0x34d988;}return _0x1b7466>0x3&&_0x34d988&&Object[_0x17e908(0x1fa)](_0x2c435a,_0x138e8b,_0x34d988),_0x34d988;},__metadata=this&&this['__metadata']||function(_0x2d2edd,_0x11ee1b){const _0x1d6f0d=a87_0x425366;if(typeof Reflect===_0x1d6f0d(0x1ea)&&typeof Reflect['metadata']===_0x1d6f0d(0x204))return Reflect[_0x1d6f0d(0x1f4)](_0x2d2edd,_0x11ee1b);},__param=this&&this[a87_0x425366(0x1cc)]||function(_0x4c4a56,_0xdd83a4){return function(_0x756f37,_0x467be8){_0xdd83a4(_0x756f37,_0x467be8,_0x4c4a56);};},PlaylistService_1;function a87_0xee0b(){const _0x5c018e=['PlaylistEvent','play','200601xgWNyc','findByIds','assign','findOne','mapToDto','function','PlayMusic','logger','157788HsOHQU','scheduleJob','isShuffle','findById','findAll','fileName','soundIds','design:paramtypes','playlistModel','length','prototype','path','../agenda/agenda.service','update','find','Playlist','OnEvent','AudioPlayer','map','SoundGateway','../common/job','AgendaService','playAsync','__param','55aOPiev','findByIdAndDelete','now','playFromEvent','assets','cancelJob','create','design:type','save','name','2150862LvlzhH','Model','Play\x20Music\x20Playlist:\x20','decorate','75jpNimH','Injectable','_id','removeSong','JobType','push','audio','agendaService','9434CvgxFm','executeJob','broadcastPlaying','filter','@nestjs/common','../common/audio/audio-player','../common/path','object','soundGateway','2921470GGRnQN','./mapper/playlist.mapper','exec','design:returntype','430248naNlvC','__decorate','../common/events','join','metadata','processRootPath','mongoose','455483zuNzIo','stop','getOwnPropertyDescriptor','defineProperty','56AMtPSJ','soundService'];a87_0xee0b=function(){return _0x5c018e;};return a87_0xee0b();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['PlaylistService']=void 0x0;const common_1=require(a87_0x425366(0x1e7)),mongoose_1=require(a87_0x425366(0x1f6)),mongoose_2=require('@nestjs/mongoose'),event_emitter_1=require('@nestjs/event-emitter'),sound_service_1=require('../sound/sound.service'),job_1=require(a87_0x425366(0x1c9)),events_1=require(a87_0x425366(0x1f2)),agenda_service_1=require(a87_0x425366(0x1c1)),playlist_mapper_1=require(a87_0x425366(0x1ed)),enums_1=require('../common/enums'),path=require(a87_0x425366(0x212)),path_1=require(a87_0x425366(0x1e9)),audio_player_1=require(a87_0x425366(0x1e8)),sound_gateway_1=require('../sound/sound.gateway');let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x2feaed,_0x368f0f,_0x2987be,_0x171eed){const _0x3404e9=a87_0x425366;this['playlistModel']=_0x2feaed,this[_0x3404e9(0x1fc)]=_0x368f0f,this[_0x3404e9(0x1e2)]=_0x2987be,this[_0x3404e9(0x1eb)]=_0x171eed,this[_0x3404e9(0x206)]=new common_1['Logger'](PlaylistService_1[_0x3404e9(0x1d6)]);}async[a87_0x425366(0x1d3)](_0x1067c9){const _0x26ade1=a87_0x425366,_0xc14502=new this[(_0x26ade1(0x20f))](_0x1067c9);return _0xc14502[_0x26ade1(0x1d5)]();}async[a87_0x425366(0x20b)](){const _0x2fd248=a87_0x425366,_0x2b859b=await this[_0x2fd248(0x20f)][_0x2fd248(0x1c3)]()[_0x2fd248(0x1ee)](),_0xcab999=_0x2b859b[_0x2fd248(0x1c7)](async _0x32fdc0=>{const _0x257d44=_0x2fd248,_0x115fbe=await this['soundService'][_0x257d44(0x200)](_0x32fdc0['soundIds']);return(0x0,playlist_mapper_1['mapToDto'])(_0x32fdc0,_0x115fbe);});return await Promise['all'](_0xcab999);}async[a87_0x425366(0x202)](_0x2cc979){const _0x3ba15d=a87_0x425366,_0x38de80=await this['playlistModel'][_0x3ba15d(0x20a)](_0x2cc979),_0x9bc273=await this['soundService'][_0x3ba15d(0x200)](_0x38de80[_0x3ba15d(0x20d)]);return(0x0,playlist_mapper_1[_0x3ba15d(0x203)])(_0x38de80,_0x9bc273);}async['update'](_0x273265,_0x484441){const _0x4fa38e=a87_0x425366,_0x2c2e5c=await this[_0x4fa38e(0x20f)]['findByIdAndUpdate'](_0x273265,Object['assign'](Object[_0x4fa38e(0x201)]({},_0x484441),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x250d52=await this[_0x4fa38e(0x1fc)][_0x4fa38e(0x200)](_0x2c2e5c[_0x4fa38e(0x20d)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x2c2e5c,_0x250d52);}async['delete'](_0x5b0152){const _0x46c9cd=a87_0x425366;return await this[_0x46c9cd(0x20f)][_0x46c9cd(0x1ce)](_0x5b0152);}async['addSong'](_0x5f49fb,_0x4eb80b){const _0x1391e1=a87_0x425366,_0x28c34b=await this[_0x1391e1(0x20f)]['findById'](_0x5f49fb);return _0x28c34b[_0x1391e1(0x20d)][_0x1391e1(0x1e0)](_0x4eb80b),await _0x28c34b[_0x1391e1(0x1d5)]();}async[a87_0x425366(0x1de)](_0x3277eb,_0x99e008){const _0x587115=a87_0x425366,_0x5e01a7=await this['playlistModel'][_0x587115(0x20a)](_0x3277eb);return _0x5e01a7['soundIds']=_0x5e01a7[_0x587115(0x20d)][_0x587115(0x1e6)](_0x22dea5=>_0x22dea5!==_0x99e008),await _0x5e01a7['save']();}async[a87_0x425366(0x1fe)](_0x2296eb,_0x1ce847){const _0x5205f0=a87_0x425366,_0x4d56b5={'when':_0x5205f0(0x1cf),'jobType':enums_1[_0x5205f0(0x1df)][_0x5205f0(0x205)],'attributes':{'playlistId':_0x1ce847},'audit':{'actor':_0x2296eb,'name':enums_1['JobType'][_0x5205f0(0x205)],'message':_0x5205f0(0x1d9)+_0x1ce847}},{jobId:_0x4b6efe}=await this[_0x5205f0(0x1e2)][_0x5205f0(0x208)](_0x4d56b5);return this[_0x5205f0(0x1c2)](_0x1ce847,{'jobId':_0x4b6efe});}async['stop'](_0x15e8ce){const _0x34e006=a87_0x425366;let _0x5e26fb=await this[_0x34e006(0x202)](_0x15e8ce);const {jobId:_0xabdcdb}=_0x5e26fb||{};if(_0xabdcdb){const {success:_0x472d40}=await this[_0x34e006(0x1e2)][_0x34e006(0x1d2)](_0xabdcdb);_0x472d40&&(_0x5e26fb=await this[_0x34e006(0x1c2)](_0x15e8ce,{'jobId':null}));}return this[_0x34e006(0x1eb)]['broadcastPlaying']({'id':_0x5e26fb[_0x34e006(0x1dd)],'isPlaying':![]}),_0x5e26fb;}async[a87_0x425366(0x1d0)](_0x181539){const _0x3cc880=a87_0x425366,{playlistId:_0x5b75fb,jobId:_0x1fadc6,durationInSecond:_0x2542ad}=_0x181539,_0x2964f3=await this['playlistModel'][_0x3cc880(0x20a)](_0x5b75fb),_0x350d1d=[..._0x2964f3[_0x3cc880(0x20d)]],_0xd7f899=await this[_0x3cc880(0x1fc)][_0x3cc880(0x200)](_0x350d1d),_0x3f06a3=_0xd7f899['map'](_0x481114=>path[_0x3cc880(0x1f3)](path_1[_0x3cc880(0x1f5)],_0x3cc880(0x1d1),_0x3cc880(0x1e1),_0x481114[_0x3cc880(0x20c)]));job_1['PROCESS_CACHE']['killAll'](),this[_0x3cc880(0x206)]['log']('Playing\x20playlist:\x20'+_0x5b75fb+'\x20-\x20'+_0x2964f3[_0x3cc880(0x1d6)]),(0x0,job_1[_0x3cc880(0x1e4)])({'jobId':_0x1fadc6,'run':()=>audio_player_1[_0x3cc880(0x1c6)][_0x3cc880(0x1cb)](_0x3f06a3,0x32,_0x2964f3[_0x3cc880(0x209)]),'durationInSecond':_0x2542ad,'next':()=>this[_0x3cc880(0x1f8)](_0x5b75fb)}),this[_0x3cc880(0x1eb)][_0x3cc880(0x1e5)]({'id':_0x5b75fb,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1[a87_0x425366(0x1c5)])(events_1[a87_0x425366(0x1fd)]['Play']),__metadata(a87_0x425366(0x1d4),Function),__metadata(a87_0x425366(0x20e),[Object]),__metadata(a87_0x425366(0x1ef),Promise)],PlaylistService[a87_0x425366(0x211)],a87_0x425366(0x1d0),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a87_0x425366(0x1dc)])(),__param(0x0,(0x0,mongoose_2['InjectModel'])(a87_0x425366(0x1c4))),__param(0x3,(0x0,common_1['Inject'])(sound_gateway_1[a87_0x425366(0x1c8)])),__metadata(a87_0x425366(0x20e),[mongoose_1[a87_0x425366(0x1d8)],sound_service_1['SoundService'],agenda_service_1[a87_0x425366(0x1ca)],sound_gateway_1[a87_0x425366(0x1c8)]])],PlaylistService),exports['PlaylistService']=PlaylistService;