'use strict';const a87_0x30d576=a87_0x478a;function a87_0x478a(_0x3a0f3f,_0x479e59){const _0xabf9ac=a87_0xabf9();return a87_0x478a=function(_0x478a5e,_0x43f330){_0x478a5e=_0x478a5e-0xcd;let _0x2abf1c=_0xabf9ac[_0x478a5e];return _0x2abf1c;},a87_0x478a(_0x3a0f3f,_0x479e59);}(function(_0x5e8579,_0x54fcee){const _0x15f070=a87_0x478a,_0x4168df=_0x5e8579();while(!![]){try{const _0x59f5fe=parseInt(_0x15f070(0xda))/0x1*(-parseInt(_0x15f070(0xe7))/0x2)+parseInt(_0x15f070(0xce))/0x3+-parseInt(_0x15f070(0x103))/0x4+parseInt(_0x15f070(0x105))/0x5+-parseInt(_0x15f070(0xe8))/0x6+parseInt(_0x15f070(0x10a))/0x7*(parseInt(_0x15f070(0x10f))/0x8)+parseInt(_0x15f070(0xd5))/0x9*(parseInt(_0x15f070(0xff))/0xa);if(_0x59f5fe===_0x54fcee)break;else _0x4168df['push'](_0x4168df['shift']());}catch(_0x12099e){_0x4168df['push'](_0x4168df['shift']());}}}(a87_0xabf9,0x1cf87));var __decorate=this&&this['__decorate']||function(_0x341702,_0xe6944b,_0xa9426d,_0xe19ad8){const _0x356700=a87_0x478a;var _0x83b12d=arguments[_0x356700(0x102)],_0x467d1d=_0x83b12d<0x3?_0xe6944b:_0xe19ad8===null?_0xe19ad8=Object[_0x356700(0x116)](_0xe6944b,_0xa9426d):_0xe19ad8,_0x1b7962;if(typeof Reflect===_0x356700(0xec)&&typeof Reflect[_0x356700(0xef)]==='function')_0x467d1d=Reflect['decorate'](_0x341702,_0xe6944b,_0xa9426d,_0xe19ad8);else{for(var _0x2a55e3=_0x341702['length']-0x1;_0x2a55e3>=0x0;_0x2a55e3--)if(_0x1b7962=_0x341702[_0x2a55e3])_0x467d1d=(_0x83b12d<0x3?_0x1b7962(_0x467d1d):_0x83b12d>0x3?_0x1b7962(_0xe6944b,_0xa9426d,_0x467d1d):_0x1b7962(_0xe6944b,_0xa9426d))||_0x467d1d;}return _0x83b12d>0x3&&_0x467d1d&&Object['defineProperty'](_0xe6944b,_0xa9426d,_0x467d1d),_0x467d1d;},__metadata=this&&this[a87_0x30d576(0xdd)]||function(_0x4c0051,_0x55f9dc){const _0x3126fb=a87_0x30d576;if(typeof Reflect==='object'&&typeof Reflect[_0x3126fb(0x108)]===_0x3126fb(0xfe))return Reflect['metadata'](_0x4c0051,_0x55f9dc);},__param=this&&this[a87_0x30d576(0xd2)]||function(_0x1fe27e,_0x41d2c7){return function(_0x39591e,_0x20d375){_0x41d2c7(_0x39591e,_0x20d375,_0x1fe27e);};},PlaylistService_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a87_0x30d576(0x100)]=void 0x0;const common_1=require(a87_0x30d576(0x114)),mongoose_1=require('mongoose'),mongoose_2=require('@nestjs/mongoose'),event_emitter_1=require(a87_0x30d576(0xf5)),sound_service_1=require(a87_0x30d576(0xd6)),job_1=require(a87_0x30d576(0xd9)),events_1=require(a87_0x30d576(0xe9)),agenda_service_1=require('../agenda/agenda.service'),playlist_mapper_1=require(a87_0x30d576(0xf2)),enums_1=require('../common/enums'),path=require(a87_0x30d576(0xcf)),path_1=require('../common/path'),audio_player_1=require('../common/audio/audio-player'),sound_gateway_1=require(a87_0x30d576(0xd8));function a87_0xabf9(){const _0x2c863d=['findOne','assets','playFromEvent','\x20-\x20','function','1743370IfzfWb','PlaylistService','push','length','467484LlhCBX','Model','439090mzpDnS','mapToDto','isShuffle','metadata','Play','28322sOuNBA','prototype','killAll','design:type','JobType','232aIHlkL','InjectModel','save','soundIds','PROCESS_CACHE','@nestjs/common','processRootPath','getOwnPropertyDescriptor','playlistModel','AudioPlayer','PlaylistEvent','Play\x20Music\x20Playlist:\x20','findByIds','agendaService','exec','update','soundService','421998YfBHyI','path','PlayMusic','AgendaService','__param','design:returntype','delete','9SOqdCl','../sound/sound.service','findAll','../sound/sound.gateway','../common/job','21017tnDGxv','_id','removeSong','__metadata','all','scheduleJob','create','OnEvent','design:paramtypes','map','find','cancelJob','SoundService','12ZjBKHH','951114JPdxmZ','../common/events','logger','SoundGateway','object','fileName','broadcastPlaying','decorate','playAsync','findById','./mapper/playlist.mapper','soundGateway','executeJob','@nestjs/event-emitter','name','findByIdAndUpdate','Logger','play'];a87_0xabf9=function(){return _0x2c863d;};return a87_0xabf9();}let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x45cc4a,_0x1eaa35,_0x6006fc,_0x55bc03){const _0x271389=a87_0x30d576;this[_0x271389(0x117)]=_0x45cc4a,this[_0x271389(0xcd)]=_0x1eaa35,this[_0x271389(0x11c)]=_0x6006fc,this[_0x271389(0xf3)]=_0x55bc03,this[_0x271389(0xea)]=new common_1[(_0x271389(0xf8))](PlaylistService_1['name']);}async[a87_0x30d576(0xe0)](_0x57dfb9){const _0x4d2448=a87_0x30d576,_0x175f27=new this[(_0x4d2448(0x117))](_0x57dfb9);return _0x175f27['save']();}async[a87_0x30d576(0xd7)](){const _0x500d34=a87_0x30d576,_0x339843=await this[_0x500d34(0x117)][_0x500d34(0xe4)]()[_0x500d34(0x11d)](),_0x38a7de=_0x339843[_0x500d34(0xe3)](async _0x1ccc31=>{const _0x1b4fb1=_0x500d34,_0x27b0f0=await this['soundService']['findByIds'](_0x1ccc31[_0x1b4fb1(0x112)]);return(0x0,playlist_mapper_1[_0x1b4fb1(0x106)])(_0x1ccc31,_0x27b0f0);});return await Promise[_0x500d34(0xde)](_0x38a7de);}async[a87_0x30d576(0xfa)](_0x35e2e5){const _0x4192e3=a87_0x30d576,_0x497f0a=await this[_0x4192e3(0x117)][_0x4192e3(0xf1)](_0x35e2e5),_0xef737=await this[_0x4192e3(0xcd)][_0x4192e3(0x11b)](_0x497f0a[_0x4192e3(0x112)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x497f0a,_0xef737);}async[a87_0x30d576(0x11e)](_0x393123,_0x4e55d1){const _0x573316=a87_0x30d576,_0x393a8a=await this['playlistModel'][_0x573316(0xf7)](_0x393123,Object['assign'](Object['assign']({},_0x4e55d1),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x3052b6=await this[_0x573316(0xcd)][_0x573316(0x11b)](_0x393a8a[_0x573316(0x112)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x393a8a,_0x3052b6);}async[a87_0x30d576(0xd4)](_0x114536){const _0x589580=a87_0x30d576;return await this[_0x589580(0x117)]['findByIdAndDelete'](_0x114536);}async['addSong'](_0x14106f,_0x30672c){const _0x2e3b48=a87_0x30d576,_0x3072ca=await this['playlistModel'][_0x2e3b48(0xf1)](_0x14106f);return _0x3072ca['soundIds'][_0x2e3b48(0x101)](_0x30672c),await _0x3072ca[_0x2e3b48(0x111)]();}async[a87_0x30d576(0xdc)](_0x1e438c,_0x54e28a){const _0x5c7068=a87_0x30d576,_0x1635e0=await this[_0x5c7068(0x117)][_0x5c7068(0xf1)](_0x1e438c);return _0x1635e0['soundIds']=_0x1635e0[_0x5c7068(0x112)]['filter'](_0x24496c=>_0x24496c!==_0x54e28a),await _0x1635e0[_0x5c7068(0x111)]();}async[a87_0x30d576(0xf9)](_0x478533,_0x4e2a64){const _0x24f9dc=a87_0x30d576,_0x331a93={'when':'now','jobType':enums_1['JobType'][_0x24f9dc(0xd0)],'attributes':{'playlistId':_0x4e2a64},'audit':{'actor':_0x478533,'name':enums_1[_0x24f9dc(0x10e)][_0x24f9dc(0xd0)],'message':_0x24f9dc(0x11a)+_0x4e2a64}},{jobId:_0x20b7d4}=await this[_0x24f9dc(0x11c)][_0x24f9dc(0xdf)](_0x331a93);return this[_0x24f9dc(0x11e)](_0x4e2a64,{'jobId':_0x20b7d4});}async['stop'](_0x4081c5){const _0xb69292=a87_0x30d576;let _0x4f2c82=await this[_0xb69292(0xfa)](_0x4081c5);const {jobId:_0x4ec1a1}=_0x4f2c82||{};if(_0x4ec1a1){const {success:_0x226812}=await this[_0xb69292(0x11c)][_0xb69292(0xe5)](_0x4ec1a1);_0x226812&&(_0x4f2c82=await this[_0xb69292(0x11e)](_0x4081c5,{'jobId':null}));}return this[_0xb69292(0xf3)][_0xb69292(0xee)]({'id':_0x4f2c82[_0xb69292(0xdb)],'isPlaying':![]}),_0x4f2c82;}async['playFromEvent'](_0x1acd8f){const _0xc2e0c0=a87_0x30d576,{playlistId:_0x7f9cf3,jobId:_0x2e0efa,durationInSecond:_0x1a2320}=_0x1acd8f,_0x59af90=await this['playlistModel'][_0xc2e0c0(0xf1)](_0x7f9cf3),_0x5bbdcb=[..._0x59af90[_0xc2e0c0(0x112)]],_0x533f56=await this[_0xc2e0c0(0xcd)][_0xc2e0c0(0x11b)](_0x5bbdcb),_0x3d9292=_0x533f56[_0xc2e0c0(0xe3)](_0x4c4ebe=>path['join'](path_1[_0xc2e0c0(0x115)],_0xc2e0c0(0xfb),'audio',_0x4c4ebe[_0xc2e0c0(0xed)]));job_1[_0xc2e0c0(0x113)][_0xc2e0c0(0x10c)](),this[_0xc2e0c0(0xea)]['log']('Playing\x20playlist:\x20'+_0x7f9cf3+_0xc2e0c0(0xfd)+_0x59af90[_0xc2e0c0(0xf6)]),(0x0,job_1[_0xc2e0c0(0xf4)])({'jobId':_0x2e0efa,'run':()=>audio_player_1[_0xc2e0c0(0x118)][_0xc2e0c0(0xf0)](_0x3d9292,0x32,_0x59af90[_0xc2e0c0(0x107)]),'durationInSecond':_0x1a2320,'next':()=>this['stop'](_0x7f9cf3)}),this[_0xc2e0c0(0xf3)][_0xc2e0c0(0xee)]({'id':_0x7f9cf3,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1[a87_0x30d576(0xe1)])(events_1[a87_0x30d576(0x119)][a87_0x30d576(0x109)]),__metadata(a87_0x30d576(0x10d),Function),__metadata(a87_0x30d576(0xe2),[Object]),__metadata(a87_0x30d576(0xd3),Promise)],PlaylistService[a87_0x30d576(0x10b)],a87_0x30d576(0xfc),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_2[a87_0x30d576(0x110)])('Playlist')),__param(0x3,(0x0,common_1['Inject'])(sound_gateway_1[a87_0x30d576(0xeb)])),__metadata(a87_0x30d576(0xe2),[mongoose_1[a87_0x30d576(0x104)],sound_service_1[a87_0x30d576(0xe6)],agenda_service_1[a87_0x30d576(0xd1)],sound_gateway_1[a87_0x30d576(0xeb)]])],PlaylistService),exports[a87_0x30d576(0x100)]=PlaylistService;