'use strict';const a87_0x1e632f=a87_0x534a;(function(_0xf5353b,_0x35c9c7){const _0x44bf1c=a87_0x534a,_0xec8723=_0xf5353b();while(!![]){try{const _0x2cc5e8=parseInt(_0x44bf1c(0x17a))/0x1+-parseInt(_0x44bf1c(0x146))/0x2+-parseInt(_0x44bf1c(0x163))/0x3+-parseInt(_0x44bf1c(0x184))/0x4+parseInt(_0x44bf1c(0x16f))/0x5*(parseInt(_0x44bf1c(0x167))/0x6)+parseInt(_0x44bf1c(0x18a))/0x7+-parseInt(_0x44bf1c(0x149))/0x8;if(_0x2cc5e8===_0x35c9c7)break;else _0xec8723['push'](_0xec8723['shift']());}catch(_0x14e1fb){_0xec8723['push'](_0xec8723['shift']());}}}(a87_0x4a5c,0x69775));var __decorate=this&&this[a87_0x1e632f(0x166)]||function(_0x2a4813,_0x349bb6,_0x143301,_0x1d9138){const _0x267558=a87_0x1e632f;var _0x4a9401=arguments[_0x267558(0x185)],_0x3b8342=_0x4a9401<0x3?_0x349bb6:_0x1d9138===null?_0x1d9138=Object[_0x267558(0x177)](_0x349bb6,_0x143301):_0x1d9138,_0x25b032;if(typeof Reflect===_0x267558(0x162)&&typeof Reflect[_0x267558(0x175)]==='function')_0x3b8342=Reflect[_0x267558(0x175)](_0x2a4813,_0x349bb6,_0x143301,_0x1d9138);else{for(var _0x4d2070=_0x2a4813[_0x267558(0x185)]-0x1;_0x4d2070>=0x0;_0x4d2070--)if(_0x25b032=_0x2a4813[_0x4d2070])_0x3b8342=(_0x4a9401<0x3?_0x25b032(_0x3b8342):_0x4a9401>0x3?_0x25b032(_0x349bb6,_0x143301,_0x3b8342):_0x25b032(_0x349bb6,_0x143301))||_0x3b8342;}return _0x4a9401>0x3&&_0x3b8342&&Object[_0x267558(0x142)](_0x349bb6,_0x143301,_0x3b8342),_0x3b8342;},__metadata=this&&this['__metadata']||function(_0x29cb66,_0x13f773){const _0x18ce32=a87_0x1e632f;if(typeof Reflect===_0x18ce32(0x162)&&typeof Reflect[_0x18ce32(0x15c)]==='function')return Reflect['metadata'](_0x29cb66,_0x13f773);},__param=this&&this[a87_0x1e632f(0x151)]||function(_0x3db7c8,_0x131133){return function(_0x1f1a92,_0x5ed022){_0x131133(_0x1f1a92,_0x5ed022,_0x3db7c8);};},PlaylistService_1;Object[a87_0x1e632f(0x142)](exports,a87_0x1e632f(0x143),{'value':!![]}),exports['PlaylistService']=void 0x0;const common_1=require(a87_0x1e632f(0x165)),mongoose_1=require('mongoose'),mongoose_2=require(a87_0x1e632f(0x148)),event_emitter_1=require(a87_0x1e632f(0x161)),sound_service_1=require(a87_0x1e632f(0x179)),job_1=require(a87_0x1e632f(0x182)),events_1=require(a87_0x1e632f(0x152)),agenda_service_1=require(a87_0x1e632f(0x14c)),playlist_mapper_1=require(a87_0x1e632f(0x145)),enums_1=require(a87_0x1e632f(0x16e)),path=require('path'),path_1=require('../common/path'),audio_player_1=require(a87_0x1e632f(0x158)),sound_gateway_1=require(a87_0x1e632f(0x15f));function a87_0x4a5c(){const _0x469dc0=['design:paramtypes','metadata','save','mapToDto','../sound/sound.gateway','play','@nestjs/event-emitter','object','1192926QYMLFJ','filter','@nestjs/common','__decorate','168DhZpxP','playlistModel','removeSong','stop','JobType','Injectable','design:type','../common/enums','110795rAqMRp','assets','findByIds','prototype','AudioPlayer','push','decorate','agendaService','getOwnPropertyDescriptor','soundService','../sound/sound.service','833280QIYvUI','PlayMusic','playAsync','findByIdAndUpdate','fileName','logger','update','broadcastPlaying','../common/job','Inject','1646436ZJqYJo','length','SoundGateway','soundIds','SoundService','cancelJob','5870529bHzVkj','killAll','create','Playing\x20playlist:\x20','Playlist','defineProperty','__esModule','scheduleJob','./mapper/playlist.mapper','479604knWImq','map','@nestjs/mongoose','6490696xqEkDc','findAll','\x20-\x20','../agenda/agenda.service','join','Play','AgendaService','name','__param','../common/events','Play\x20Music\x20Playlist:\x20','OnEvent','findById','findOne','playFromEvent','../common/audio/audio-player','exec','find'];a87_0x4a5c=function(){return _0x469dc0;};return a87_0x4a5c();}function a87_0x534a(_0x2432ae,_0x3a6325){const _0x4a5c2d=a87_0x4a5c();return a87_0x534a=function(_0x534a94,_0x582b79){_0x534a94=_0x534a94-0x141;let _0x23d561=_0x4a5c2d[_0x534a94];return _0x23d561;},a87_0x534a(_0x2432ae,_0x3a6325);}let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x30a05a,_0x6a5118,_0xe082f8,_0x109d5b){const _0x20f8ed=a87_0x1e632f;this[_0x20f8ed(0x168)]=_0x30a05a,this['soundService']=_0x6a5118,this[_0x20f8ed(0x176)]=_0xe082f8,this['soundGateway']=_0x109d5b,this[_0x20f8ed(0x17f)]=new common_1['Logger'](PlaylistService_1[_0x20f8ed(0x150)]);}async[a87_0x1e632f(0x18c)](_0xae5293){const _0x3e9391=a87_0x1e632f,_0x6fa20a=new this[(_0x3e9391(0x168))](_0xae5293);return _0x6fa20a[_0x3e9391(0x15d)]();}async[a87_0x1e632f(0x14a)](){const _0x469e88=a87_0x1e632f,_0x80aa17=await this[_0x469e88(0x168)][_0x469e88(0x15a)]()[_0x469e88(0x159)](),_0x5680bf=_0x80aa17[_0x469e88(0x147)](async _0x5a60e3=>{const _0x1dcb3f=_0x469e88,_0xbda537=await this[_0x1dcb3f(0x178)]['findByIds'](_0x5a60e3['soundIds']);return(0x0,playlist_mapper_1['mapToDto'])(_0x5a60e3,_0xbda537);});return await Promise['all'](_0x5680bf);}async[a87_0x1e632f(0x156)](_0x44ca64){const _0x5128a6=a87_0x1e632f,_0xa3dd91=await this[_0x5128a6(0x168)][_0x5128a6(0x155)](_0x44ca64),_0x3deccd=await this['soundService'][_0x5128a6(0x171)](_0xa3dd91[_0x5128a6(0x187)]);return(0x0,playlist_mapper_1[_0x5128a6(0x15e)])(_0xa3dd91,_0x3deccd);}async['update'](_0x40dac1,_0x2859ed){const _0x868a97=a87_0x1e632f,_0x5a5c8c=await this[_0x868a97(0x168)][_0x868a97(0x17d)](_0x40dac1,Object['assign'](Object['assign']({},_0x2859ed),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x9fc05=await this['soundService'][_0x868a97(0x171)](_0x5a5c8c[_0x868a97(0x187)]);return(0x0,playlist_mapper_1[_0x868a97(0x15e)])(_0x5a5c8c,_0x9fc05);}async['delete'](_0x1f53c0){const _0x32370e=a87_0x1e632f;return await this[_0x32370e(0x168)]['findByIdAndDelete'](_0x1f53c0);}async['addSong'](_0x59948a,_0x5cd180){const _0x128dad=a87_0x1e632f,_0x57e247=await this[_0x128dad(0x168)][_0x128dad(0x155)](_0x59948a);return _0x57e247['soundIds'][_0x128dad(0x174)](_0x5cd180),await _0x57e247[_0x128dad(0x15d)]();}async[a87_0x1e632f(0x169)](_0x44bc46,_0x33bd5b){const _0x3c6279=a87_0x1e632f,_0x1e7948=await this['playlistModel'][_0x3c6279(0x155)](_0x44bc46);return _0x1e7948[_0x3c6279(0x187)]=_0x1e7948[_0x3c6279(0x187)][_0x3c6279(0x164)](_0x47a1b6=>_0x47a1b6!==_0x33bd5b),await _0x1e7948[_0x3c6279(0x15d)]();}async[a87_0x1e632f(0x160)](_0x4d1cb6,_0x55e69c){const _0x3ce55e=a87_0x1e632f,_0x1ba277={'when':'now','jobType':enums_1[_0x3ce55e(0x16b)][_0x3ce55e(0x17b)],'attributes':{'playlistId':_0x55e69c},'audit':{'actor':_0x4d1cb6,'name':enums_1['JobType'][_0x3ce55e(0x17b)],'message':_0x3ce55e(0x153)+_0x55e69c}},{jobId:_0x363165}=await this[_0x3ce55e(0x176)][_0x3ce55e(0x144)](_0x1ba277);return this[_0x3ce55e(0x180)](_0x55e69c,{'jobId':_0x363165});}async[a87_0x1e632f(0x16a)](_0x22395c){const _0x2b68b5=a87_0x1e632f;let _0x162fbf=await this['findOne'](_0x22395c);const {jobId:_0x76bd79}=_0x162fbf||{};if(_0x76bd79){const {success:_0x580f96}=await this[_0x2b68b5(0x176)][_0x2b68b5(0x189)](_0x76bd79);_0x580f96&&(_0x162fbf=await this[_0x2b68b5(0x180)](_0x22395c,{'jobId':null}));}return this['soundGateway']['broadcastPlaying']({'id':_0x162fbf['_id'],'isPlaying':![]}),_0x162fbf;}async[a87_0x1e632f(0x157)](_0x4fdb09){const _0x378e14=a87_0x1e632f,{playlistId:_0x48e3da,jobId:_0x59b46d,durationInSecond:_0x5749dd}=_0x4fdb09,_0x1f963c=await this[_0x378e14(0x168)][_0x378e14(0x155)](_0x48e3da),_0x952abf=[..._0x1f963c['soundIds']],_0x26646d=await this[_0x378e14(0x178)]['findByIds'](_0x952abf),_0x5041cb=_0x26646d['map'](_0x4fea6b=>path[_0x378e14(0x14d)](path_1['processRootPath'],_0x378e14(0x170),'audio',_0x4fea6b[_0x378e14(0x17e)]));job_1['PROCESS_CACHE'][_0x378e14(0x18b)](),this['logger']['log'](_0x378e14(0x18d)+_0x48e3da+_0x378e14(0x14b)+_0x1f963c[_0x378e14(0x150)]),(0x0,job_1['executeJob'])({'jobId':_0x59b46d,'run':()=>audio_player_1[_0x378e14(0x173)][_0x378e14(0x17c)](_0x5041cb,0x32,_0x1f963c['isShuffle']),'durationInSecond':_0x5749dd,'next':()=>this['stop'](_0x48e3da)}),this['soundGateway'][_0x378e14(0x181)]({'id':_0x48e3da,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1[a87_0x1e632f(0x154)])(events_1['PlaylistEvent'][a87_0x1e632f(0x14e)]),__metadata(a87_0x1e632f(0x16d),Function),__metadata(a87_0x1e632f(0x15b),[Object]),__metadata('design:returntype',Promise)],PlaylistService[a87_0x1e632f(0x172)],a87_0x1e632f(0x157),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a87_0x1e632f(0x16c)])(),__param(0x0,(0x0,mongoose_2['InjectModel'])(a87_0x1e632f(0x141))),__param(0x3,(0x0,common_1[a87_0x1e632f(0x183)])(sound_gateway_1[a87_0x1e632f(0x186)])),__metadata(a87_0x1e632f(0x15b),[mongoose_1['Model'],sound_service_1[a87_0x1e632f(0x188)],agenda_service_1[a87_0x1e632f(0x14f)],sound_gateway_1[a87_0x1e632f(0x186)]])],PlaylistService),exports['PlaylistService']=PlaylistService;