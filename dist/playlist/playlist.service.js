'use strict';function a87_0x5481(_0x517712,_0x131eb8){const _0x2a5c8b=a87_0x2a5c();return a87_0x5481=function(_0x54812d,_0x398abc){_0x54812d=_0x54812d-0x133;let _0x326921=_0x2a5c8b[_0x54812d];return _0x326921;},a87_0x5481(_0x517712,_0x131eb8);}const a87_0x474786=a87_0x5481;(function(_0x243f86,_0x21c03d){const _0x52c748=a87_0x5481,_0x49459e=_0x243f86();while(!![]){try{const _0x442fff=-parseInt(_0x52c748(0x145))/0x1+parseInt(_0x52c748(0x165))/0x2*(-parseInt(_0x52c748(0x13a))/0x3)+parseInt(_0x52c748(0x162))/0x4+parseInt(_0x52c748(0x150))/0x5+parseInt(_0x52c748(0x13f))/0x6*(parseInt(_0x52c748(0x16e))/0x7)+-parseInt(_0x52c748(0x147))/0x8*(parseInt(_0x52c748(0x143))/0x9)+parseInt(_0x52c748(0x15c))/0xa;if(_0x442fff===_0x21c03d)break;else _0x49459e['push'](_0x49459e['shift']());}catch(_0x2687b8){_0x49459e['push'](_0x49459e['shift']());}}}(a87_0x2a5c,0x98e9c));function a87_0x2a5c(){const _0x561209=['./mapper/playlist.mapper','addSong','object','length','../sound/sound.service','_id','findById','prototype','play','push','join','Injectable','mongoose','playlistModel','SoundGateway','defineProperty','soundGateway','__param','../common/job','3GZealb','scheduleJob','__decorate','AgendaService','fileName','1224276rfZrrp','@nestjs/event-emitter','SoundService','create','56736uSRbAA','find','436988XmbMrM','InjectModel','896KLAuok','../common/audio/audio-player','Play\x20Music\x20Playlist:\x20','delete','findOne','AudioPlayer','../common/enums','killAll','../sound/sound.gateway','3285395FzfBUZ','save','playFromEvent','__esModule','design:paramtypes','logger','Playing\x20playlist:\x20','PlaylistEvent','stop','design:type','JobType','path','2304520dMxvXp','log','agendaService','Play','assign','update','2062840aGZrDz','name','PROCESS_CACHE','1716298aCnfPx','removeSong','function','decorate','PlayMusic','design:returntype','soundIds','findByIds','playAsync','42eICqzU','isShuffle','Model','mapToDto','PlaylistService','@nestjs/common','Playlist','filter','soundService','metadata','broadcastPlaying'];a87_0x2a5c=function(){return _0x561209;};return a87_0x2a5c();}var __decorate=this&&this[a87_0x474786(0x13c)]||function(_0x19f210,_0x576fbf,_0x57be39,_0x14fb4a){const _0x12259c=a87_0x474786;var _0x4f318f=arguments[_0x12259c(0x17c)],_0x53f115=_0x4f318f<0x3?_0x576fbf:_0x14fb4a===null?_0x14fb4a=Object['getOwnPropertyDescriptor'](_0x576fbf,_0x57be39):_0x14fb4a,_0x44a012;if(typeof Reflect===_0x12259c(0x17b)&&typeof Reflect[_0x12259c(0x168)]===_0x12259c(0x167))_0x53f115=Reflect['decorate'](_0x19f210,_0x576fbf,_0x57be39,_0x14fb4a);else{for(var _0x501b60=_0x19f210[_0x12259c(0x17c)]-0x1;_0x501b60>=0x0;_0x501b60--)if(_0x44a012=_0x19f210[_0x501b60])_0x53f115=(_0x4f318f<0x3?_0x44a012(_0x53f115):_0x4f318f>0x3?_0x44a012(_0x576fbf,_0x57be39,_0x53f115):_0x44a012(_0x576fbf,_0x57be39))||_0x53f115;}return _0x4f318f>0x3&&_0x53f115&&Object[_0x12259c(0x136)](_0x576fbf,_0x57be39,_0x53f115),_0x53f115;},__metadata=this&&this['__metadata']||function(_0x52316d,_0x501185){const _0x1dfb8f=a87_0x474786;if(typeof Reflect===_0x1dfb8f(0x17b)&&typeof Reflect[_0x1dfb8f(0x177)]==='function')return Reflect[_0x1dfb8f(0x177)](_0x52316d,_0x501185);},__param=this&&this[a87_0x474786(0x138)]||function(_0x120049,_0x23b972){return function(_0x58c4bb,_0xd6a90a){_0x23b972(_0x58c4bb,_0xd6a90a,_0x120049);};},PlaylistService_1;Object[a87_0x474786(0x136)](exports,a87_0x474786(0x153),{'value':!![]}),exports[a87_0x474786(0x172)]=void 0x0;const common_1=require(a87_0x474786(0x173)),mongoose_1=require(a87_0x474786(0x133)),mongoose_2=require('@nestjs/mongoose'),event_emitter_1=require(a87_0x474786(0x140)),sound_service_1=require(a87_0x474786(0x17d)),job_1=require(a87_0x474786(0x139)),events_1=require('../common/events'),agenda_service_1=require('../agenda/agenda.service'),playlist_mapper_1=require(a87_0x474786(0x179)),enums_1=require(a87_0x474786(0x14d)),path=require(a87_0x474786(0x15b)),path_1=require('../common/path'),audio_player_1=require(a87_0x474786(0x148)),sound_gateway_1=require(a87_0x474786(0x14f));let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x5b4d5b,_0x4f7690,_0x33eb29,_0x396836){const _0x1502cf=a87_0x474786;this[_0x1502cf(0x134)]=_0x5b4d5b,this['soundService']=_0x4f7690,this[_0x1502cf(0x15e)]=_0x33eb29,this[_0x1502cf(0x137)]=_0x396836,this['logger']=new common_1['Logger'](PlaylistService_1[_0x1502cf(0x163)]);}async[a87_0x474786(0x142)](_0x544700){const _0x5522ea=a87_0x474786,_0x356a64=new this['playlistModel'](_0x544700);return _0x356a64[_0x5522ea(0x151)]();}async['findAll'](){const _0x435b81=a87_0x474786,_0x49bdcf=await this[_0x435b81(0x134)][_0x435b81(0x144)]()['exec'](),_0x8f392d=_0x49bdcf['map'](async _0xaae535=>{const _0xdc90e4=_0x435b81,_0x484f28=await this[_0xdc90e4(0x176)][_0xdc90e4(0x16c)](_0xaae535[_0xdc90e4(0x16b)]);return(0x0,playlist_mapper_1[_0xdc90e4(0x171)])(_0xaae535,_0x484f28);});return await Promise['all'](_0x8f392d);}async[a87_0x474786(0x14b)](_0x147ca4){const _0x316786=a87_0x474786,_0x29aee9=await this[_0x316786(0x134)][_0x316786(0x17f)](_0x147ca4),_0x3a154c=await this['soundService']['findByIds'](_0x29aee9[_0x316786(0x16b)]);return(0x0,playlist_mapper_1[_0x316786(0x171)])(_0x29aee9,_0x3a154c);}async[a87_0x474786(0x161)](_0x18c721,_0xae68fb){const _0x26e862=a87_0x474786,_0x24c39c=await this[_0x26e862(0x134)]['findByIdAndUpdate'](_0x18c721,Object[_0x26e862(0x160)](Object[_0x26e862(0x160)]({},_0xae68fb),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x18bfc8=await this[_0x26e862(0x176)][_0x26e862(0x16c)](_0x24c39c[_0x26e862(0x16b)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x24c39c,_0x18bfc8);}async[a87_0x474786(0x14a)](_0x1ee480){const _0x2d6038=a87_0x474786;return await this[_0x2d6038(0x134)]['findByIdAndDelete'](_0x1ee480);}async[a87_0x474786(0x17a)](_0x4aa2d5,_0x30ebea){const _0x44bcde=a87_0x474786,_0x34e59e=await this[_0x44bcde(0x134)]['findById'](_0x4aa2d5);return _0x34e59e['soundIds'][_0x44bcde(0x182)](_0x30ebea),await _0x34e59e['save']();}async[a87_0x474786(0x166)](_0x11390c,_0x27dca5){const _0x1d374e=a87_0x474786,_0x285b7a=await this[_0x1d374e(0x134)][_0x1d374e(0x17f)](_0x11390c);return _0x285b7a[_0x1d374e(0x16b)]=_0x285b7a['soundIds'][_0x1d374e(0x175)](_0x2a8eb5=>_0x2a8eb5!==_0x27dca5),await _0x285b7a[_0x1d374e(0x151)]();}async[a87_0x474786(0x181)](_0x2cd5bb,_0x4797aa){const _0x5e2992=a87_0x474786,_0x840b04={'when':'now','jobType':enums_1[_0x5e2992(0x15a)][_0x5e2992(0x169)],'attributes':{'playlistId':_0x4797aa},'audit':{'actor':_0x2cd5bb,'name':enums_1[_0x5e2992(0x15a)]['PlayMusic'],'message':_0x5e2992(0x149)+_0x4797aa}},{jobId:_0x2fa544}=await this[_0x5e2992(0x15e)][_0x5e2992(0x13b)](_0x840b04);return this[_0x5e2992(0x161)](_0x4797aa,{'jobId':_0x2fa544});}async[a87_0x474786(0x158)](_0xd51daf){const _0x5bb02b=a87_0x474786;let _0x5318c7=await this[_0x5bb02b(0x14b)](_0xd51daf);const {jobId:_0x13f1bc}=_0x5318c7||{};if(_0x13f1bc){const {success:_0x56c099}=await this[_0x5bb02b(0x15e)]['cancelJob'](_0x13f1bc);_0x56c099&&(_0x5318c7=await this[_0x5bb02b(0x161)](_0xd51daf,{'jobId':null}));}return this[_0x5bb02b(0x137)][_0x5bb02b(0x178)]({'id':_0x5318c7[_0x5bb02b(0x17e)],'isPlaying':![]}),_0x5318c7;}async[a87_0x474786(0x152)](_0x3c31f2){const _0x5b3eb1=a87_0x474786,{playlistId:_0x47caf0,jobId:_0x591505,durationInSecond:_0x5bdea7}=_0x3c31f2,_0x9929cd=await this[_0x5b3eb1(0x134)][_0x5b3eb1(0x17f)](_0x47caf0),_0x36e777=[..._0x9929cd[_0x5b3eb1(0x16b)]],_0x50131c=await this[_0x5b3eb1(0x176)]['findByIds'](_0x36e777),_0x3f811b=_0x50131c['map'](_0x5bf7f3=>path[_0x5b3eb1(0x183)](path_1['processRootPath'],'assets','audio',_0x5bf7f3[_0x5b3eb1(0x13e)]));job_1[_0x5b3eb1(0x164)][_0x5b3eb1(0x14e)](),this[_0x5b3eb1(0x155)][_0x5b3eb1(0x15d)](_0x5b3eb1(0x156)+_0x47caf0+'\x20-\x20'+_0x9929cd[_0x5b3eb1(0x163)]),(0x0,job_1['executeJob'])({'jobId':_0x591505,'run':()=>audio_player_1[_0x5b3eb1(0x14c)][_0x5b3eb1(0x16d)](_0x3f811b,0x32,_0x9929cd[_0x5b3eb1(0x16f)]),'durationInSecond':_0x5bdea7,'next':()=>this[_0x5b3eb1(0x158)](_0x47caf0)}),this['soundGateway'][_0x5b3eb1(0x178)]({'id':_0x47caf0,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1['OnEvent'])(events_1[a87_0x474786(0x157)][a87_0x474786(0x15f)]),__metadata(a87_0x474786(0x159),Function),__metadata(a87_0x474786(0x154),[Object]),__metadata(a87_0x474786(0x16a),Promise)],PlaylistService[a87_0x474786(0x180)],a87_0x474786(0x152),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a87_0x474786(0x184)])(),__param(0x0,(0x0,mongoose_2[a87_0x474786(0x146)])(a87_0x474786(0x174))),__param(0x3,(0x0,common_1['Inject'])(sound_gateway_1[a87_0x474786(0x135)])),__metadata('design:paramtypes',[mongoose_1[a87_0x474786(0x170)],sound_service_1[a87_0x474786(0x141)],agenda_service_1[a87_0x474786(0x13d)],sound_gateway_1['SoundGateway']])],PlaylistService),exports[a87_0x474786(0x172)]=PlaylistService;