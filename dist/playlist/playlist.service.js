'use strict';const a90_0x5a7478=a90_0x1633;(function(_0x2a63af,_0x5aad70){const _0x236aad=a90_0x1633,_0x4f7b4a=_0x2a63af();while(!![]){try{const _0x2731b0=parseInt(_0x236aad(0x1e4))/0x1*(parseInt(_0x236aad(0x1df))/0x2)+parseInt(_0x236aad(0x1ef))/0x3+parseInt(_0x236aad(0x1f2))/0x4+parseInt(_0x236aad(0x1bc))/0x5*(-parseInt(_0x236aad(0x1b4))/0x6)+parseInt(_0x236aad(0x1cc))/0x7+-parseInt(_0x236aad(0x1a0))/0x8*(parseInt(_0x236aad(0x1f3))/0x9)+-parseInt(_0x236aad(0x1a3))/0xa;if(_0x2731b0===_0x5aad70)break;else _0x4f7b4a['push'](_0x4f7b4a['shift']());}catch(_0x532372){_0x4f7b4a['push'](_0x4f7b4a['shift']());}}}(a90_0x2575,0x303f2));function a90_0x2575(){const _0x534a58=['findByIds','soundGateway','../sound/sound.service','function','findOne','scheduleJob','isShuffle','170DgKetD','PlaylistEvent','removeSong','executeJob','__esModule','assets','length','mongoose','Play','map','logger','design:returntype','find','all','../common/enums','PlaylistService','881118lUihJR','design:paramtypes','../common/audio/audio-player','Logger','filter','Play\x20Music\x20Playlist:\x20','metadata','../common/events','prototype','agendaService','broadcastPlaying','fileName','../common/path','\x20-\x20','Playing\x20playlist:\x20','stop','__metadata','PlayMusic','object','1538ygsLYh','create','@nestjs/mongoose','getOwnPropertyDescriptor','now','491eYQVpN','findById','defineProperty','playAsync','mapToDto','_id','AudioPlayer','play','soundService','JobType','path','211233SxBNuO','@nestjs/event-emitter','PROCESS_CACHE','281340LbgSMd','9iZQXJc','update','../common/job','InjectModel','@nestjs/common','design:type','1141576JZulWq','./mapper/playlist.mapper','processRootPath','187600cMggGs','save','AgendaService','soundIds','../sound/sound.gateway','assign','../agenda/agenda.service','Injectable','findByIdAndUpdate','Inject','SoundGateway','killAll','playlistModel','playFromEvent','findAll','__decorate','name','50316qYpotj'];a90_0x2575=function(){return _0x534a58;};return a90_0x2575();}var __decorate=this&&this[a90_0x5a7478(0x1b2)]||function(_0xf857a3,_0x3d6397,_0x4b27e8,_0x4a582c){const _0x332824=a90_0x5a7478;var _0x3951b4=arguments[_0x332824(0x1c2)],_0x11808f=_0x3951b4<0x3?_0x3d6397:_0x4a582c===null?_0x4a582c=Object[_0x332824(0x1e2)](_0x3d6397,_0x4b27e8):_0x4a582c,_0x4c586f;if(typeof Reflect===_0x332824(0x1de)&&typeof Reflect['decorate']===_0x332824(0x1b8))_0x11808f=Reflect['decorate'](_0xf857a3,_0x3d6397,_0x4b27e8,_0x4a582c);else{for(var _0x2e3245=_0xf857a3[_0x332824(0x1c2)]-0x1;_0x2e3245>=0x0;_0x2e3245--)if(_0x4c586f=_0xf857a3[_0x2e3245])_0x11808f=(_0x3951b4<0x3?_0x4c586f(_0x11808f):_0x3951b4>0x3?_0x4c586f(_0x3d6397,_0x4b27e8,_0x11808f):_0x4c586f(_0x3d6397,_0x4b27e8))||_0x11808f;}return _0x3951b4>0x3&&_0x11808f&&Object[_0x332824(0x1e6)](_0x3d6397,_0x4b27e8,_0x11808f),_0x11808f;},__metadata=this&&this[a90_0x5a7478(0x1dc)]||function(_0x4fdc13,_0x37ccdd){const _0x8c12b0=a90_0x5a7478;if(typeof Reflect===_0x8c12b0(0x1de)&&typeof Reflect[_0x8c12b0(0x1d2)]==='function')return Reflect[_0x8c12b0(0x1d2)](_0x4fdc13,_0x37ccdd);},__param=this&&this['__param']||function(_0x332c23,_0x30b97c){return function(_0x22cb53,_0x309dbc){_0x30b97c(_0x22cb53,_0x309dbc,_0x332c23);};},PlaylistService_1;Object[a90_0x5a7478(0x1e6)](exports,a90_0x5a7478(0x1c0),{'value':!![]}),exports[a90_0x5a7478(0x1cb)]=void 0x0;const common_1=require(a90_0x5a7478(0x1f7)),mongoose_1=require(a90_0x5a7478(0x1c3)),mongoose_2=require(a90_0x5a7478(0x1e1)),event_emitter_1=require(a90_0x5a7478(0x1f0)),sound_service_1=require(a90_0x5a7478(0x1b7)),job_1=require(a90_0x5a7478(0x1f5)),events_1=require(a90_0x5a7478(0x1d3)),agenda_service_1=require(a90_0x5a7478(0x1a9)),playlist_mapper_1=require(a90_0x5a7478(0x1a1)),enums_1=require(a90_0x5a7478(0x1ca)),path=require(a90_0x5a7478(0x1ee)),path_1=require(a90_0x5a7478(0x1d8)),audio_player_1=require(a90_0x5a7478(0x1ce)),sound_gateway_1=require(a90_0x5a7478(0x1a7));let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x526b65,_0x46bab7,_0x365181,_0x98870a){const _0x4faf3d=a90_0x5a7478;this[_0x4faf3d(0x1af)]=_0x526b65,this[_0x4faf3d(0x1ec)]=_0x46bab7,this['agendaService']=_0x365181,this[_0x4faf3d(0x1b6)]=_0x98870a,this[_0x4faf3d(0x1c6)]=new common_1[(_0x4faf3d(0x1cf))](PlaylistService_1[_0x4faf3d(0x1b3)]);}async[a90_0x5a7478(0x1e0)](_0x3030a5){const _0xce938=a90_0x5a7478,_0x5b3e51=new this['playlistModel'](_0x3030a5);return _0x5b3e51[_0xce938(0x1a4)]();}async[a90_0x5a7478(0x1b1)](){const _0x51b588=a90_0x5a7478,_0x186f6f=await this[_0x51b588(0x1af)][_0x51b588(0x1c8)]()['exec'](),_0x2d14c1=_0x186f6f[_0x51b588(0x1c5)](async _0x54676a=>{const _0x3ec13c=_0x51b588,_0x25c23c=await this[_0x3ec13c(0x1ec)][_0x3ec13c(0x1b5)](_0x54676a['soundIds']);return(0x0,playlist_mapper_1[_0x3ec13c(0x1e8)])(_0x54676a,_0x25c23c);});return await Promise[_0x51b588(0x1c9)](_0x2d14c1);}async[a90_0x5a7478(0x1b9)](_0x43a7db){const _0x2d7284=a90_0x5a7478,_0x3fb7a0=await this['playlistModel'][_0x2d7284(0x1e5)](_0x43a7db),_0xa06be7=await this['soundService'][_0x2d7284(0x1b5)](_0x3fb7a0['soundIds']);return(0x0,playlist_mapper_1[_0x2d7284(0x1e8)])(_0x3fb7a0,_0xa06be7);}async[a90_0x5a7478(0x1f4)](_0x5147c9,_0x43d14d){const _0x5f1c4b=a90_0x5a7478,_0x386ed2=await this['playlistModel'][_0x5f1c4b(0x1ab)](_0x5147c9,Object[_0x5f1c4b(0x1a8)](Object[_0x5f1c4b(0x1a8)]({},_0x43d14d),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x196653=await this[_0x5f1c4b(0x1ec)][_0x5f1c4b(0x1b5)](_0x386ed2['soundIds']);return(0x0,playlist_mapper_1['mapToDto'])(_0x386ed2,_0x196653);}async['delete'](_0x5acc70){const _0xb5e10f=a90_0x5a7478;return await this[_0xb5e10f(0x1af)]['findByIdAndDelete'](_0x5acc70);}async['addSong'](_0x41f8ed,_0x520c20){const _0x50d82a=a90_0x5a7478,_0x38fe8d=await this['playlistModel']['findById'](_0x41f8ed);return _0x38fe8d[_0x50d82a(0x1a6)]['push'](_0x520c20),await _0x38fe8d[_0x50d82a(0x1a4)]();}async[a90_0x5a7478(0x1be)](_0x12cc51,_0x35ba44){const _0x5d307d=a90_0x5a7478,_0x28dd63=await this[_0x5d307d(0x1af)]['findById'](_0x12cc51);return _0x28dd63['soundIds']=_0x28dd63['soundIds'][_0x5d307d(0x1d0)](_0x27f38d=>_0x27f38d!==_0x35ba44),await _0x28dd63[_0x5d307d(0x1a4)]();}async[a90_0x5a7478(0x1eb)](_0x27e861,_0x1489d8){const _0x3a8578=a90_0x5a7478,_0x5b3427={'when':_0x3a8578(0x1e3),'jobType':enums_1[_0x3a8578(0x1ed)][_0x3a8578(0x1dd)],'attributes':{'playlistId':_0x1489d8},'audit':{'actor':_0x27e861,'name':enums_1[_0x3a8578(0x1ed)][_0x3a8578(0x1dd)],'message':_0x3a8578(0x1d1)+_0x1489d8}},{jobId:_0x5dd65e}=await this[_0x3a8578(0x1d5)][_0x3a8578(0x1ba)](_0x5b3427);return this['update'](_0x1489d8,{'jobId':_0x5dd65e});}async[a90_0x5a7478(0x1db)](_0x31bd09){const _0x30e376=a90_0x5a7478;let _0x165af6=await this[_0x30e376(0x1b9)](_0x31bd09);const {jobId:_0xb57566}=_0x165af6||{};if(_0xb57566){const {success:_0x305a83}=await this['agendaService']['cancelJob'](_0xb57566);_0x305a83&&(_0x165af6=await this[_0x30e376(0x1f4)](_0x31bd09,{'jobId':null}));}return this[_0x30e376(0x1b6)]['broadcastPlaying']({'id':_0x165af6[_0x30e376(0x1e9)],'isPlaying':![]}),_0x165af6;}async[a90_0x5a7478(0x1b0)](_0x45ec0a){const _0x40b105=a90_0x5a7478,{playlistId:_0x583920,jobId:_0x12baf1,durationInSecond:_0x4abd22}=_0x45ec0a,_0x189639=await this['playlistModel'][_0x40b105(0x1e5)](_0x583920),_0x1e1609=[..._0x189639[_0x40b105(0x1a6)]],_0x511abf=await this[_0x40b105(0x1ec)][_0x40b105(0x1b5)](_0x1e1609),_0x50a770=_0x511abf[_0x40b105(0x1c5)](_0x2f8ea9=>path['join'](path_1[_0x40b105(0x1a2)],_0x40b105(0x1c1),'audio',_0x2f8ea9[_0x40b105(0x1d7)]));job_1[_0x40b105(0x1f1)][_0x40b105(0x1ae)](),this[_0x40b105(0x1c6)]['log'](_0x40b105(0x1da)+_0x583920+_0x40b105(0x1d9)+_0x189639[_0x40b105(0x1b3)]),(0x0,job_1[_0x40b105(0x1bf)])({'jobId':_0x12baf1,'run':()=>audio_player_1[_0x40b105(0x1ea)][_0x40b105(0x1e7)](_0x50a770,0x32,_0x189639[_0x40b105(0x1bb)]),'durationInSecond':_0x4abd22,'next':()=>this[_0x40b105(0x1db)](_0x583920)}),this['soundGateway'][_0x40b105(0x1d6)]({'id':_0x583920,'isPlaying':!![]});}};function a90_0x1633(_0x5baa32,_0x2e5537){const _0x257502=a90_0x2575();return a90_0x1633=function(_0x1633b2,_0x155683){_0x1633b2=_0x1633b2-0x19f;let _0x1297bf=_0x257502[_0x1633b2];return _0x1297bf;},a90_0x1633(_0x5baa32,_0x2e5537);}__decorate([(0x0,event_emitter_1['OnEvent'])(events_1[a90_0x5a7478(0x1bd)][a90_0x5a7478(0x1c4)]),__metadata(a90_0x5a7478(0x19f),Function),__metadata(a90_0x5a7478(0x1cd),[Object]),__metadata(a90_0x5a7478(0x1c7),Promise)],PlaylistService[a90_0x5a7478(0x1d4)],a90_0x5a7478(0x1b0),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a90_0x5a7478(0x1aa)])(),__param(0x0,(0x0,mongoose_2[a90_0x5a7478(0x1f6)])('Playlist')),__param(0x3,(0x0,common_1[a90_0x5a7478(0x1ac)])(sound_gateway_1['SoundGateway'])),__metadata(a90_0x5a7478(0x1cd),[mongoose_1['Model'],sound_service_1['SoundService'],agenda_service_1[a90_0x5a7478(0x1a5)],sound_gateway_1[a90_0x5a7478(0x1ad)]])],PlaylistService),exports[a90_0x5a7478(0x1cb)]=PlaylistService;