'use strict';const a87_0x345701=a87_0x57eb;(function(_0x212b24,_0x370ff5){const _0x49a858=a87_0x57eb,_0x2dc2f1=_0x212b24();while(!![]){try{const _0x22dfd4=-parseInt(_0x49a858(0x1af))/0x1+parseInt(_0x49a858(0x1b5))/0x2*(-parseInt(_0x49a858(0x184))/0x3)+-parseInt(_0x49a858(0x1a1))/0x4+parseInt(_0x49a858(0x1ba))/0x5+-parseInt(_0x49a858(0x182))/0x6+parseInt(_0x49a858(0x1ad))/0x7+-parseInt(_0x49a858(0x1c7))/0x8*(-parseInt(_0x49a858(0x1cb))/0x9);if(_0x22dfd4===_0x370ff5)break;else _0x2dc2f1['push'](_0x2dc2f1['shift']());}catch(_0x234b52){_0x2dc2f1['push'](_0x2dc2f1['shift']());}}}(a87_0x1ae6,0x33140));function a87_0x1ae6(){const _0x42f22d=['findAll','./mapper/playlist.mapper','__decorate','defineProperty','filter','PlayMusic','2294684ieajjz','soundGateway','185759rbRaQn','findByIds','_id','update','find','design:returntype','9740UHiUPi','path','JobType','processRootPath','findOne','894045mfYjHS','function','soundService','PROCESS_CACHE','../common/job','PlaylistEvent','Play','fileName','\x20-\x20','push','cancelJob','OnEvent','addSong','273440peSHnZ','SoundGateway','decorate','Logger','171DuhwWK','../common/audio/audio-player','__metadata','mongoose','../common/events','Model','Playing\x20playlist:\x20','../sound/sound.gateway','../common/path','killAll','isShuffle','PlaylistService','../agenda/agenda.service','audio','Playlist','design:paramtypes','1460736yQXmAB','stop','189YwAMfM','@nestjs/mongoose','__esModule','log','AgendaService','__param','findById','create','map','assign','playFromEvent','agendaService','join','AudioPlayer','logger','soundIds','@nestjs/event-emitter','metadata','mapToDto','save','InjectModel','removeSong','executeJob','getOwnPropertyDescriptor','playAsync','Play\x20Music\x20Playlist:\x20','name','@nestjs/common','object','843200VTWyGj','Inject','playlistModel','broadcastPlaying','length','scheduleJob'];a87_0x1ae6=function(){return _0x42f22d;};return a87_0x1ae6();}function a87_0x57eb(_0x12e434,_0x4d1e2d){const _0x1ae6b9=a87_0x1ae6();return a87_0x57eb=function(_0x57ebfa,_0x78af4e){_0x57ebfa=_0x57ebfa-0x181;let _0x4ee66d=_0x1ae6b9[_0x57ebfa];return _0x4ee66d;},a87_0x57eb(_0x12e434,_0x4d1e2d);}var __decorate=this&&this[a87_0x345701(0x1a9)]||function(_0x4c93db,_0x214010,_0x6592f,_0x147ab7){const _0x23d1b0=a87_0x345701;var _0x4c01ae=arguments[_0x23d1b0(0x1a5)],_0x589e04=_0x4c01ae<0x3?_0x214010:_0x147ab7===null?_0x147ab7=Object[_0x23d1b0(0x19b)](_0x214010,_0x6592f):_0x147ab7,_0x5dcde8;if(typeof Reflect===_0x23d1b0(0x1a0)&&typeof Reflect[_0x23d1b0(0x1c9)]===_0x23d1b0(0x1bb))_0x589e04=Reflect[_0x23d1b0(0x1c9)](_0x4c93db,_0x214010,_0x6592f,_0x147ab7);else{for(var _0x31bb48=_0x4c93db[_0x23d1b0(0x1a5)]-0x1;_0x31bb48>=0x0;_0x31bb48--)if(_0x5dcde8=_0x4c93db[_0x31bb48])_0x589e04=(_0x4c01ae<0x3?_0x5dcde8(_0x589e04):_0x4c01ae>0x3?_0x5dcde8(_0x214010,_0x6592f,_0x589e04):_0x5dcde8(_0x214010,_0x6592f))||_0x589e04;}return _0x4c01ae>0x3&&_0x589e04&&Object['defineProperty'](_0x214010,_0x6592f,_0x589e04),_0x589e04;},__metadata=this&&this[a87_0x345701(0x1cd)]||function(_0x459605,_0x58708d){const _0xc86046=a87_0x345701;if(typeof Reflect===_0xc86046(0x1a0)&&typeof Reflect[_0xc86046(0x195)]===_0xc86046(0x1bb))return Reflect[_0xc86046(0x195)](_0x459605,_0x58708d);},__param=this&&this[a87_0x345701(0x189)]||function(_0x4556f3,_0x502b8a){return function(_0x21cc18,_0x432dea){_0x502b8a(_0x21cc18,_0x432dea,_0x4556f3);};},PlaylistService_1;Object[a87_0x345701(0x1aa)](exports,a87_0x345701(0x186),{'value':!![]}),exports[a87_0x345701(0x1d6)]=void 0x0;const common_1=require(a87_0x345701(0x19f)),mongoose_1=require(a87_0x345701(0x1ce)),mongoose_2=require(a87_0x345701(0x185)),event_emitter_1=require(a87_0x345701(0x194)),sound_service_1=require('../sound/sound.service'),job_1=require(a87_0x345701(0x1be)),events_1=require(a87_0x345701(0x1cf)),agenda_service_1=require(a87_0x345701(0x1d7)),playlist_mapper_1=require(a87_0x345701(0x1a8)),enums_1=require('../common/enums'),path=require(a87_0x345701(0x1b6)),path_1=require(a87_0x345701(0x1d3)),audio_player_1=require(a87_0x345701(0x1cc)),sound_gateway_1=require(a87_0x345701(0x1d2));let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0xe2d6a0,_0x538ecf,_0x214537,_0x4da938){const _0x2ed27c=a87_0x345701;this['playlistModel']=_0xe2d6a0,this[_0x2ed27c(0x1bc)]=_0x538ecf,this[_0x2ed27c(0x18f)]=_0x214537,this[_0x2ed27c(0x1ae)]=_0x4da938,this[_0x2ed27c(0x192)]=new common_1[(_0x2ed27c(0x1ca))](PlaylistService_1['name']);}async[a87_0x345701(0x18b)](_0x55933e){const _0x273ada=a87_0x345701,_0x4a0497=new this[(_0x273ada(0x1a3))](_0x55933e);return _0x4a0497[_0x273ada(0x197)]();}async[a87_0x345701(0x1a7)](){const _0x191143=a87_0x345701,_0x69b4b3=await this[_0x191143(0x1a3)][_0x191143(0x1b3)]()['exec'](),_0x22ad74=_0x69b4b3[_0x191143(0x18c)](async _0x1fa4fc=>{const _0x4aa011=_0x191143,_0x2b42a8=await this[_0x4aa011(0x1bc)][_0x4aa011(0x1b0)](_0x1fa4fc[_0x4aa011(0x193)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x1fa4fc,_0x2b42a8);});return await Promise['all'](_0x22ad74);}async[a87_0x345701(0x1b9)](_0x20f1f8){const _0x541013=a87_0x345701,_0x5104be=await this[_0x541013(0x1a3)][_0x541013(0x18a)](_0x20f1f8),_0x18e3b1=await this[_0x541013(0x1bc)][_0x541013(0x1b0)](_0x5104be[_0x541013(0x193)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x5104be,_0x18e3b1);}async[a87_0x345701(0x1b2)](_0x40fbe1,_0x102027){const _0xbce980=a87_0x345701,_0x2a985d=await this['playlistModel']['findByIdAndUpdate'](_0x40fbe1,Object[_0xbce980(0x18d)](Object[_0xbce980(0x18d)]({},_0x102027),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x434e8f=await this[_0xbce980(0x1bc)][_0xbce980(0x1b0)](_0x2a985d[_0xbce980(0x193)]);return(0x0,playlist_mapper_1[_0xbce980(0x196)])(_0x2a985d,_0x434e8f);}async['delete'](_0x2a0eef){return await this['playlistModel']['findByIdAndDelete'](_0x2a0eef);}async[a87_0x345701(0x1c6)](_0x7f13e,_0x5bbcf2){const _0x519ebe=a87_0x345701,_0x55638d=await this[_0x519ebe(0x1a3)]['findById'](_0x7f13e);return _0x55638d[_0x519ebe(0x193)][_0x519ebe(0x1c3)](_0x5bbcf2),await _0x55638d[_0x519ebe(0x197)]();}async[a87_0x345701(0x199)](_0x13327a,_0x5490bd){const _0xcf9abc=a87_0x345701,_0x2b2e67=await this[_0xcf9abc(0x1a3)][_0xcf9abc(0x18a)](_0x13327a);return _0x2b2e67[_0xcf9abc(0x193)]=_0x2b2e67[_0xcf9abc(0x193)][_0xcf9abc(0x1ab)](_0x11151b=>_0x11151b!==_0x5490bd),await _0x2b2e67['save']();}async['play'](_0x189e49,_0x53d4d6){const _0x5ad712=a87_0x345701,_0xc55a58={'when':'now','jobType':enums_1[_0x5ad712(0x1b7)][_0x5ad712(0x1ac)],'attributes':{'playlistId':_0x53d4d6},'audit':{'actor':_0x189e49,'name':enums_1[_0x5ad712(0x1b7)]['PlayMusic'],'message':_0x5ad712(0x19d)+_0x53d4d6}},{jobId:_0x132cf9}=await this[_0x5ad712(0x18f)][_0x5ad712(0x1a6)](_0xc55a58);return this['update'](_0x53d4d6,{'jobId':_0x132cf9});}async['stop'](_0x54ade5){const _0x2f4730=a87_0x345701;let _0xf955a=await this['findOne'](_0x54ade5);const {jobId:_0x348b97}=_0xf955a||{};if(_0x348b97){const {success:_0x1b3cc6}=await this[_0x2f4730(0x18f)][_0x2f4730(0x1c4)](_0x348b97);_0x1b3cc6&&(_0xf955a=await this[_0x2f4730(0x1b2)](_0x54ade5,{'jobId':null}));}return this[_0x2f4730(0x1ae)][_0x2f4730(0x1a4)]({'id':_0xf955a[_0x2f4730(0x1b1)],'isPlaying':![]}),_0xf955a;}async[a87_0x345701(0x18e)](_0x45e73f){const _0x354651=a87_0x345701,{playlistId:_0x4ad348,jobId:_0x1a6407,durationInSecond:_0x1edc56}=_0x45e73f,_0x301a2f=await this[_0x354651(0x1a3)][_0x354651(0x18a)](_0x4ad348),_0x59abde=[..._0x301a2f[_0x354651(0x193)]],_0x2bee4d=await this[_0x354651(0x1bc)][_0x354651(0x1b0)](_0x59abde),_0x45986d=_0x2bee4d[_0x354651(0x18c)](_0x1b3779=>path[_0x354651(0x190)](path_1[_0x354651(0x1b8)],'assets',_0x354651(0x1d8),_0x1b3779[_0x354651(0x1c1)]));job_1[_0x354651(0x1bd)][_0x354651(0x1d4)](),this['logger'][_0x354651(0x187)](_0x354651(0x1d1)+_0x4ad348+_0x354651(0x1c2)+_0x301a2f[_0x354651(0x19e)]),(0x0,job_1[_0x354651(0x19a)])({'jobId':_0x1a6407,'run':()=>audio_player_1[_0x354651(0x191)][_0x354651(0x19c)](_0x45986d,0x32,_0x301a2f[_0x354651(0x1d5)]),'durationInSecond':_0x1edc56,'next':()=>this[_0x354651(0x183)](_0x4ad348)}),this[_0x354651(0x1ae)][_0x354651(0x1a4)]({'id':_0x4ad348,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1[a87_0x345701(0x1c5)])(events_1[a87_0x345701(0x1bf)][a87_0x345701(0x1c0)]),__metadata('design:type',Function),__metadata(a87_0x345701(0x181),[Object]),__metadata(a87_0x345701(0x1b4),Promise)],PlaylistService['prototype'],'playFromEvent',null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_2[a87_0x345701(0x198)])(a87_0x345701(0x1d9))),__param(0x3,(0x0,common_1[a87_0x345701(0x1a2)])(sound_gateway_1['SoundGateway'])),__metadata('design:paramtypes',[mongoose_1[a87_0x345701(0x1d0)],sound_service_1['SoundService'],agenda_service_1[a87_0x345701(0x188)],sound_gateway_1[a87_0x345701(0x1c8)]])],PlaylistService),exports[a87_0x345701(0x1d6)]=PlaylistService;