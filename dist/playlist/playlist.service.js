'use strict';const a90_0x33e90b=a90_0x4a27;(function(_0x1c76f2,_0x471f34){const _0xe9b10e=a90_0x4a27,_0x54cc05=_0x1c76f2();while(!![]){try{const _0x265fb6=parseInt(_0xe9b10e(0x101))/0x1*(-parseInt(_0xe9b10e(0xd1))/0x2)+-parseInt(_0xe9b10e(0x11e))/0x3+parseInt(_0xe9b10e(0x119))/0x4*(parseInt(_0xe9b10e(0x104))/0x5)+parseInt(_0xe9b10e(0x10c))/0x6+parseInt(_0xe9b10e(0x121))/0x7+parseInt(_0xe9b10e(0xe1))/0x8+-parseInt(_0xe9b10e(0x103))/0x9;if(_0x265fb6===_0x471f34)break;else _0x54cc05['push'](_0x54cc05['shift']());}catch(_0x53dc56){_0x54cc05['push'](_0x54cc05['shift']());}}}(a90_0x46dc,0x4c81c));var __decorate=this&&this['__decorate']||function(_0xb732ae,_0x5ad808,_0x5354f1,_0x508834){const _0x437c62=a90_0x4a27;var _0x47c441=arguments[_0x437c62(0xfe)],_0x48aac0=_0x47c441<0x3?_0x5ad808:_0x508834===null?_0x508834=Object[_0x437c62(0xe4)](_0x5ad808,_0x5354f1):_0x508834,_0xccfe8c;if(typeof Reflect===_0x437c62(0xde)&&typeof Reflect[_0x437c62(0x111)]===_0x437c62(0xe5))_0x48aac0=Reflect[_0x437c62(0x111)](_0xb732ae,_0x5ad808,_0x5354f1,_0x508834);else{for(var _0x3c9188=_0xb732ae['length']-0x1;_0x3c9188>=0x0;_0x3c9188--)if(_0xccfe8c=_0xb732ae[_0x3c9188])_0x48aac0=(_0x47c441<0x3?_0xccfe8c(_0x48aac0):_0x47c441>0x3?_0xccfe8c(_0x5ad808,_0x5354f1,_0x48aac0):_0xccfe8c(_0x5ad808,_0x5354f1))||_0x48aac0;}return _0x47c441>0x3&&_0x48aac0&&Object[_0x437c62(0x112)](_0x5ad808,_0x5354f1,_0x48aac0),_0x48aac0;},__metadata=this&&this['__metadata']||function(_0x424824,_0x46de24){const _0x4fea2a=a90_0x4a27;if(typeof Reflect===_0x4fea2a(0xde)&&typeof Reflect['metadata']===_0x4fea2a(0xe5))return Reflect[_0x4fea2a(0xd5)](_0x424824,_0x46de24);},__param=this&&this[a90_0x33e90b(0x10f)]||function(_0x2e2ee6,_0xf2eb76){return function(_0xfce315,_0xbbc3ab){_0xf2eb76(_0xfce315,_0xbbc3ab,_0x2e2ee6);};},PlaylistService_1;function a90_0x4a27(_0x54e326,_0x49d0b5){const _0x46dc4f=a90_0x46dc();return a90_0x4a27=function(_0x4a27ec,_0x38c724){_0x4a27ec=_0x4a27ec-0xd0;let _0x52a607=_0x46dc4f[_0x4a27ec];return _0x52a607;},a90_0x4a27(_0x54e326,_0x49d0b5);}Object[a90_0x33e90b(0x112)](exports,a90_0x33e90b(0x100),{'value':!![]}),exports['PlaylistService']=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a90_0x33e90b(0x105)),mongoose_2=require(a90_0x33e90b(0x11c)),event_emitter_1=require(a90_0x33e90b(0x125)),sound_service_1=require(a90_0x33e90b(0x11f)),job_1=require(a90_0x33e90b(0xdd)),events_1=require('../common/events'),agenda_service_1=require(a90_0x33e90b(0xe7)),playlist_mapper_1=require(a90_0x33e90b(0x11b)),enums_1=require('../common/enums'),path=require(a90_0x33e90b(0xf9)),path_1=require(a90_0x33e90b(0xeb)),audio_player_1=require(a90_0x33e90b(0xd6)),sound_gateway_1=require(a90_0x33e90b(0xf8));let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x5adb11,_0x594e30,_0x4d80d4,_0x1b12a8){const _0x1e7e33=a90_0x33e90b;this[_0x1e7e33(0xe3)]=_0x5adb11,this[_0x1e7e33(0xd2)]=_0x594e30,this[_0x1e7e33(0xd8)]=_0x4d80d4,this[_0x1e7e33(0x113)]=_0x1b12a8,this[_0x1e7e33(0xfa)]=new common_1[(_0x1e7e33(0xf6))](PlaylistService_1[_0x1e7e33(0x126)]);}async[a90_0x33e90b(0xdf)](_0x42411a){const _0x6a62c6=a90_0x33e90b,_0x376b00=new this[(_0x6a62c6(0xe3))](_0x42411a);return _0x376b00[_0x6a62c6(0x102)]();}async['findAll'](){const _0x3da30a=a90_0x33e90b,_0xef124c=await this[_0x3da30a(0xe3)][_0x3da30a(0x116)]()[_0x3da30a(0xee)](),_0x114548=_0xef124c[_0x3da30a(0xf0)](async _0x16031b=>{const _0x44b7d7=_0x3da30a,_0x212af6=await this['soundService'][_0x44b7d7(0xd4)](_0x16031b[_0x44b7d7(0x108)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x16031b,_0x212af6);});return await Promise[_0x3da30a(0x109)](_0x114548);}async[a90_0x33e90b(0x115)](_0x39a474){const _0xfd666d=a90_0x33e90b,_0x2e838c=await this[_0xfd666d(0xe3)]['findById'](_0x39a474),_0x37dbdd=await this[_0xfd666d(0xd2)][_0xfd666d(0xd4)](_0x2e838c['soundIds']);return(0x0,playlist_mapper_1[_0xfd666d(0x107)])(_0x2e838c,_0x37dbdd);}async[a90_0x33e90b(0xfd)](_0x588215,_0x11a891){const _0x33ccfa=a90_0x33e90b,_0x50305f=await this[_0x33ccfa(0xe3)][_0x33ccfa(0x11d)](_0x588215,Object[_0x33ccfa(0x117)](Object[_0x33ccfa(0x117)]({},_0x11a891),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x245cf7=await this[_0x33ccfa(0xd2)][_0x33ccfa(0xd4)](_0x50305f[_0x33ccfa(0x108)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x50305f,_0x245cf7);}async[a90_0x33e90b(0xf2)](_0x2076ca){return await this['playlistModel']['findByIdAndDelete'](_0x2076ca);}async[a90_0x33e90b(0x128)](_0x19f1b1,_0x1642b0){const _0x2694f8=a90_0x33e90b,_0xe0cf5b=await this[_0x2694f8(0xe3)][_0x2694f8(0xdc)](_0x19f1b1);return _0xe0cf5b[_0x2694f8(0x108)][_0x2694f8(0xe6)](_0x1642b0),await _0xe0cf5b[_0x2694f8(0x102)]();}async[a90_0x33e90b(0x114)](_0x46ae29,_0x313a78){const _0x136602=a90_0x33e90b,_0x1c794f=await this[_0x136602(0xe3)]['findById'](_0x46ae29);return _0x1c794f['soundIds']=_0x1c794f[_0x136602(0x108)][_0x136602(0x122)](_0x354418=>_0x354418!==_0x313a78),await _0x1c794f[_0x136602(0x102)]();}async[a90_0x33e90b(0x11a)](_0x2664fe,_0x4d892e){const _0x338832=a90_0x33e90b,_0x1058b0={'when':_0x338832(0x10b),'jobType':enums_1[_0x338832(0xec)]['PlayMusic'],'attributes':{'playlistId':_0x4d892e},'audit':{'actor':_0x2664fe,'name':enums_1[_0x338832(0xec)][_0x338832(0xd9)],'message':'Play\x20Music\x20Playlist:\x20'+_0x4d892e}},{jobId:_0x528f84}=await this[_0x338832(0xd8)]['scheduleJob'](_0x1058b0);return this[_0x338832(0xfd)](_0x4d892e,{'jobId':_0x528f84});}async[a90_0x33e90b(0x106)](_0x2bf6bb){const _0x527747=a90_0x33e90b;let _0x1dc10b=await this[_0x527747(0x115)](_0x2bf6bb);const {jobId:_0x2a4294}=_0x1dc10b||{};if(_0x2a4294){const {success:_0x4c6114}=await this[_0x527747(0xd8)][_0x527747(0xf1)](_0x2a4294);_0x4c6114&&(_0x1dc10b=await this['update'](_0x2bf6bb,{'jobId':null}));}return this[_0x527747(0x113)][_0x527747(0xe2)]({'id':_0x1dc10b[_0x527747(0xfb)],'isPlaying':![]}),_0x1dc10b;}async[a90_0x33e90b(0xe9)](_0xafbdf7){const _0xcd70a7=a90_0x33e90b,{playlistId:_0x21955f,jobId:_0x365fed,durationInSecond:_0x2527ed}=_0xafbdf7,_0x410ebf=await this[_0xcd70a7(0xe3)][_0xcd70a7(0xdc)](_0x21955f),_0x404e70=[..._0x410ebf[_0xcd70a7(0x108)]],_0x1e17d0=await this[_0xcd70a7(0xd2)][_0xcd70a7(0xd4)](_0x404e70),_0x413a6f=_0x1e17d0[_0xcd70a7(0xf0)](_0x1aaada=>path[_0xcd70a7(0xff)](path_1[_0xcd70a7(0x10e)],_0xcd70a7(0xf5),_0xcd70a7(0x118),_0x1aaada[_0xcd70a7(0x120)]));job_1['PROCESS_CACHE'][_0xcd70a7(0xdb)](),this[_0xcd70a7(0xfa)][_0xcd70a7(0xd3)](_0xcd70a7(0xd0)+_0x21955f+_0xcd70a7(0xf7)+_0x410ebf['name']),(0x0,job_1[_0xcd70a7(0x10d)])({'jobId':_0x365fed,'run':()=>audio_player_1[_0xcd70a7(0xfc)][_0xcd70a7(0xf4)](_0x413a6f,0x32,_0x410ebf[_0xcd70a7(0xd7)]),'durationInSecond':_0x2527ed,'next':()=>this[_0xcd70a7(0x106)](_0x21955f)}),this[_0xcd70a7(0x113)][_0xcd70a7(0xe2)]({'id':_0x21955f,'isPlaying':!![]});}};function a90_0x46dc(){const _0x39c762=['Injectable','@nestjs/event-emitter','name','design:paramtypes','addSong','Playing\x20playlist:\x20','14TTwttj','soundService','log','findByIds','metadata','../common/audio/audio-player','isShuffle','agendaService','PlayMusic','Inject','killAll','findById','../common/job','object','create','design:type','3022192uVzHOE','broadcastPlaying','playlistModel','getOwnPropertyDescriptor','function','push','../agenda/agenda.service','PlaylistService','playFromEvent','Playlist','../common/path','JobType','prototype','exec','design:returntype','map','cancelJob','delete','OnEvent','playAsync','assets','Logger','\x20-\x20','../sound/sound.gateway','path','logger','_id','AudioPlayer','update','length','join','__esModule','66445UwtUeu','save','1389852jGKiXW','15WkBCfq','mongoose','stop','mapToDto','soundIds','all','Play','now','2603298JeprrL','executeJob','processRootPath','__param','SoundGateway','decorate','defineProperty','soundGateway','removeSong','findOne','find','assign','audio','38620yteGdJ','play','./mapper/playlist.mapper','@nestjs/mongoose','findByIdAndUpdate','1057248LSmiOY','../sound/sound.service','fileName','3112963IDTxKa','filter','InjectModel'];a90_0x46dc=function(){return _0x39c762;};return a90_0x46dc();}__decorate([(0x0,event_emitter_1[a90_0x33e90b(0xf3)])(events_1['PlaylistEvent'][a90_0x33e90b(0x10a)]),__metadata(a90_0x33e90b(0xe0),Function),__metadata(a90_0x33e90b(0x127),[Object]),__metadata(a90_0x33e90b(0xef),Promise)],PlaylistService[a90_0x33e90b(0xed)],a90_0x33e90b(0xe9),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a90_0x33e90b(0x124)])(),__param(0x0,(0x0,mongoose_2[a90_0x33e90b(0x123)])(a90_0x33e90b(0xea))),__param(0x3,(0x0,common_1[a90_0x33e90b(0xda)])(sound_gateway_1[a90_0x33e90b(0x110)])),__metadata(a90_0x33e90b(0x127),[mongoose_1['Model'],sound_service_1['SoundService'],agenda_service_1['AgendaService'],sound_gateway_1['SoundGateway']])],PlaylistService),exports[a90_0x33e90b(0xe8)]=PlaylistService;