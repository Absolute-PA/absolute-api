'use strict';const a90_0x3efe41=a90_0x4d03;function a90_0x4cf5(){const _0x5e147d=['design:type','playlistModel','soundGateway','assets','Play','__param','findById','649304cPlqlj','InjectModel','scheduleJob','cancelJob','stop','4452816mCZLfh','@nestjs/common','16009oicckI','PROCESS_CACHE','length','_id','1587240xpQyKR','logger','Injectable','./mapper/playlist.mapper','../sound/sound.service','now','SoundService','assign','delete','3028809WRTeMF','../common/audio/audio-player','../agenda/agenda.service','filter','mapToDto','broadcastPlaying','OnEvent','soundIds','design:paramtypes','../common/enums','killAll','Play\x20Music\x20Playlist:\x20','function','agendaService','279PPlQVT','Playing\x20playlist:\x20','../common/job','soundService','Inject','play','object','design:returntype','findOne','JobType','390QuQueb','Playlist','metadata','map','removeSong','1052951pEsTIR','1408134doowmK','SoundGateway','find','save','isShuffle','update','PlaylistEvent','log','AgendaService','addSong','defineProperty','AudioPlayer','findAll','PlaylistService','name','playFromEvent','join','findByIds'];a90_0x4cf5=function(){return _0x5e147d;};return a90_0x4cf5();}(function(_0x10b8a8,_0x2345a6){const _0x5b3bc8=a90_0x4d03,_0xed6acc=_0x10b8a8();while(!![]){try{const _0x102515=parseInt(_0x5b3bc8(0x10c))/0x1+-parseInt(_0x5b3bc8(0x10d))/0x2+-parseInt(_0x5b3bc8(0xef))/0x3+-parseInt(_0x5b3bc8(0x12b))/0x4+-parseInt(_0x5b3bc8(0xe6))/0x5+-parseInt(_0x5b3bc8(0x107))/0x6*(-parseInt(_0x5b3bc8(0xe2))/0x7)+-parseInt(_0x5b3bc8(0x126))/0x8*(-parseInt(_0x5b3bc8(0xfd))/0x9);if(_0x102515===_0x2345a6)break;else _0xed6acc['push'](_0xed6acc['shift']());}catch(_0x305a00){_0xed6acc['push'](_0xed6acc['shift']());}}}(a90_0x4cf5,0x8bf99));function a90_0x4d03(_0x1d2807,_0x342a68){const _0x4cf552=a90_0x4cf5();return a90_0x4d03=function(_0x4d03d8,_0x4cb601){_0x4d03d8=_0x4d03d8-0xe1;let _0x4beaee=_0x4cf552[_0x4d03d8];return _0x4beaee;},a90_0x4d03(_0x1d2807,_0x342a68);}var __decorate=this&&this['__decorate']||function(_0x4a788b,_0x382247,_0x238f1d,_0x5dcb5f){const _0x2aa141=a90_0x4d03;var _0x2a4dd9=arguments[_0x2aa141(0xe4)],_0x18c3f4=_0x2a4dd9<0x3?_0x382247:_0x5dcb5f===null?_0x5dcb5f=Object['getOwnPropertyDescriptor'](_0x382247,_0x238f1d):_0x5dcb5f,_0x3b1879;if(typeof Reflect===_0x2aa141(0x103)&&typeof Reflect['decorate']===_0x2aa141(0xfb))_0x18c3f4=Reflect['decorate'](_0x4a788b,_0x382247,_0x238f1d,_0x5dcb5f);else{for(var _0x25aaff=_0x4a788b[_0x2aa141(0xe4)]-0x1;_0x25aaff>=0x0;_0x25aaff--)if(_0x3b1879=_0x4a788b[_0x25aaff])_0x18c3f4=(_0x2a4dd9<0x3?_0x3b1879(_0x18c3f4):_0x2a4dd9>0x3?_0x3b1879(_0x382247,_0x238f1d,_0x18c3f4):_0x3b1879(_0x382247,_0x238f1d))||_0x18c3f4;}return _0x2a4dd9>0x3&&_0x18c3f4&&Object[_0x2aa141(0x117)](_0x382247,_0x238f1d,_0x18c3f4),_0x18c3f4;},__metadata=this&&this['__metadata']||function(_0x25d8bc,_0x35f4df){const _0x1366ee=a90_0x4d03;if(typeof Reflect===_0x1366ee(0x103)&&typeof Reflect['metadata']===_0x1366ee(0xfb))return Reflect[_0x1366ee(0x109)](_0x25d8bc,_0x35f4df);},__param=this&&this[a90_0x3efe41(0x124)]||function(_0x4583f5,_0x5b1e91){return function(_0x4aff0b,_0x4aa122){_0x5b1e91(_0x4aff0b,_0x4aa122,_0x4583f5);};},PlaylistService_1;Object[a90_0x3efe41(0x117)](exports,'__esModule',{'value':!![]}),exports['PlaylistService']=void 0x0;const common_1=require(a90_0x3efe41(0xe1)),mongoose_1=require('mongoose'),mongoose_2=require('@nestjs/mongoose'),event_emitter_1=require('@nestjs/event-emitter'),sound_service_1=require(a90_0x3efe41(0xea)),job_1=require(a90_0x3efe41(0xff)),events_1=require('../common/events'),agenda_service_1=require(a90_0x3efe41(0xf1)),playlist_mapper_1=require(a90_0x3efe41(0xe9)),enums_1=require(a90_0x3efe41(0xf8)),path=require('path'),path_1=require('../common/path'),audio_player_1=require(a90_0x3efe41(0xf0)),sound_gateway_1=require('../sound/sound.gateway');let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x13d048,_0x321689,_0x1b3204,_0x48d05b){const _0x1d3b09=a90_0x3efe41;this[_0x1d3b09(0x120)]=_0x13d048,this[_0x1d3b09(0x100)]=_0x321689,this['agendaService']=_0x1b3204,this[_0x1d3b09(0x121)]=_0x48d05b,this[_0x1d3b09(0xe7)]=new common_1['Logger'](PlaylistService_1[_0x1d3b09(0x11b)]);}async['create'](_0x205e78){const _0x4123bc=a90_0x3efe41,_0x102cd7=new this['playlistModel'](_0x205e78);return _0x102cd7[_0x4123bc(0x110)]();}async[a90_0x3efe41(0x119)](){const _0x3edf7b=a90_0x3efe41,_0x4f40f7=await this[_0x3edf7b(0x120)][_0x3edf7b(0x10f)]()['exec'](),_0x24ebb5=_0x4f40f7['map'](async _0x284585=>{const _0x5cc324=_0x3edf7b,_0x36d1f8=await this[_0x5cc324(0x100)]['findByIds'](_0x284585['soundIds']);return(0x0,playlist_mapper_1['mapToDto'])(_0x284585,_0x36d1f8);});return await Promise['all'](_0x24ebb5);}async[a90_0x3efe41(0x105)](_0x4fa6d3){const _0x24a443=a90_0x3efe41,_0xf969fc=await this['playlistModel'][_0x24a443(0x125)](_0x4fa6d3),_0x2d379b=await this[_0x24a443(0x100)][_0x24a443(0x11e)](_0xf969fc[_0x24a443(0xf6)]);return(0x0,playlist_mapper_1[_0x24a443(0xf3)])(_0xf969fc,_0x2d379b);}async[a90_0x3efe41(0x112)](_0xf22530,_0x2392c0){const _0x5bc2d2=a90_0x3efe41,_0x38215b=await this[_0x5bc2d2(0x120)]['findByIdAndUpdate'](_0xf22530,Object[_0x5bc2d2(0xed)](Object['assign']({},_0x2392c0),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x26c698=await this['soundService'][_0x5bc2d2(0x11e)](_0x38215b['soundIds']);return(0x0,playlist_mapper_1[_0x5bc2d2(0xf3)])(_0x38215b,_0x26c698);}async[a90_0x3efe41(0xee)](_0x5b76d6){const _0x10373c=a90_0x3efe41;return await this[_0x10373c(0x120)]['findByIdAndDelete'](_0x5b76d6);}async[a90_0x3efe41(0x116)](_0x246249,_0x4c740d){const _0x440579=a90_0x3efe41,_0x570cfe=await this[_0x440579(0x120)][_0x440579(0x125)](_0x246249);return _0x570cfe[_0x440579(0xf6)]['push'](_0x4c740d),await _0x570cfe[_0x440579(0x110)]();}async[a90_0x3efe41(0x10b)](_0x7150ba,_0x490d02){const _0x5e4cd2=a90_0x3efe41,_0x2c3f22=await this[_0x5e4cd2(0x120)]['findById'](_0x7150ba);return _0x2c3f22[_0x5e4cd2(0xf6)]=_0x2c3f22[_0x5e4cd2(0xf6)][_0x5e4cd2(0xf2)](_0x5429a7=>_0x5429a7!==_0x490d02),await _0x2c3f22['save']();}async[a90_0x3efe41(0x102)](_0x4a7fc3,_0x123834){const _0x477148=a90_0x3efe41,_0x31e010={'when':_0x477148(0xeb),'jobType':enums_1[_0x477148(0x106)]['PlayMusic'],'attributes':{'playlistId':_0x123834},'audit':{'actor':_0x4a7fc3,'name':enums_1[_0x477148(0x106)]['PlayMusic'],'message':_0x477148(0xfa)+_0x123834}},{jobId:_0x17d9a0}=await this[_0x477148(0xfc)][_0x477148(0x128)](_0x31e010);return this[_0x477148(0x112)](_0x123834,{'jobId':_0x17d9a0});}async[a90_0x3efe41(0x12a)](_0x481998){const _0xb3093d=a90_0x3efe41;let _0x5875d8=await this['findOne'](_0x481998);const {jobId:_0x58aed8}=_0x5875d8||{};if(_0x58aed8){const {success:_0xcde2af}=await this[_0xb3093d(0xfc)][_0xb3093d(0x129)](_0x58aed8);_0xcde2af&&(_0x5875d8=await this['update'](_0x481998,{'jobId':null}));}return this['soundGateway'][_0xb3093d(0xf4)]({'id':_0x5875d8[_0xb3093d(0xe5)],'isPlaying':![]}),_0x5875d8;}async['playFromEvent'](_0x459c52){const _0x486fbe=a90_0x3efe41,{playlistId:_0x5ea37a,jobId:_0x40de4f,durationInSecond:_0x1a6d0e}=_0x459c52,_0x22e308=await this[_0x486fbe(0x120)][_0x486fbe(0x125)](_0x5ea37a),_0x402fde=[..._0x22e308[_0x486fbe(0xf6)]],_0x18c9c5=await this['soundService']['findByIds'](_0x402fde),_0x33656e=_0x18c9c5[_0x486fbe(0x10a)](_0x4eaa9d=>path[_0x486fbe(0x11d)](path_1['processRootPath'],_0x486fbe(0x122),'audio',_0x4eaa9d['fileName']));job_1[_0x486fbe(0xe3)][_0x486fbe(0xf9)](),this[_0x486fbe(0xe7)][_0x486fbe(0x114)](_0x486fbe(0xfe)+_0x5ea37a+'\x20-\x20'+_0x22e308[_0x486fbe(0x11b)]),(0x0,job_1['executeJob'])({'jobId':_0x40de4f,'run':()=>audio_player_1[_0x486fbe(0x118)]['playAsync'](_0x33656e,0x32,_0x22e308[_0x486fbe(0x111)]),'durationInSecond':_0x1a6d0e,'next':()=>this[_0x486fbe(0x12a)](_0x5ea37a)}),this[_0x486fbe(0x121)]['broadcastPlaying']({'id':_0x5ea37a,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1[a90_0x3efe41(0xf5)])(events_1[a90_0x3efe41(0x113)][a90_0x3efe41(0x123)]),__metadata(a90_0x3efe41(0x11f),Function),__metadata(a90_0x3efe41(0xf7),[Object]),__metadata(a90_0x3efe41(0x104),Promise)],PlaylistService['prototype'],a90_0x3efe41(0x11c),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a90_0x3efe41(0xe8)])(),__param(0x0,(0x0,mongoose_2[a90_0x3efe41(0x127)])(a90_0x3efe41(0x108))),__param(0x3,(0x0,common_1[a90_0x3efe41(0x101)])(sound_gateway_1[a90_0x3efe41(0x10e)])),__metadata(a90_0x3efe41(0xf7),[mongoose_1['Model'],sound_service_1[a90_0x3efe41(0xec)],agenda_service_1[a90_0x3efe41(0x115)],sound_gateway_1[a90_0x3efe41(0x10e)]])],PlaylistService),exports[a90_0x3efe41(0x11a)]=PlaylistService;