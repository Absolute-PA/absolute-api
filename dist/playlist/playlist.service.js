'use strict';function a90_0x667a(){const _0x34b0e5=['SoundGateway','1689710VSaAwX','@nestjs/mongoose','object','getOwnPropertyDescriptor','soundService','\x20-\x20','defineProperty','JobType','./mapper/playlist.mapper','isShuffle','mapToDto','PlayMusic','cancelJob','843bCvPbm','3344200cqIrDJ','decorate','findById','delete','4693830wTovZm','__param','AgendaService','all','findByIdAndUpdate','SoundService','assets','findOne','../common/enums','../sound/sound.gateway','playlistModel','../sound/sound.service','8724fEaqHV','1210475DZuZra','log','1965024YsvUvb','processRootPath','AudioPlayer','design:type','__metadata','update','exec','path','find','metadata','6dxsWIp','Play','prototype','Model','Inject','__esModule','function','name','154osjBRN','now','stop','broadcastPlaying','../agenda/agenda.service','Playlist','PlaylistEvent','../common/path','executeJob','findByIds','45RxZBsl','design:paramtypes','Logger','soundIds','Play\x20Music\x20Playlist:\x20','map','@nestjs/event-emitter','PlaylistService','playFromEvent','logger','mongoose','26582VmUxaY','create','findByIdAndDelete','fileName','@nestjs/common','__decorate','assign','Injectable','agendaService','addSong','_id','audio','filter','save','length','playAsync'];a90_0x667a=function(){return _0x34b0e5;};return a90_0x667a();}const a90_0xe19d8c=a90_0x2d77;(function(_0xb1b064,_0x2963ba){const _0x59665a=a90_0x2d77,_0x4aa20b=_0xb1b064();while(!![]){try{const _0x5117d7=parseInt(_0x59665a(0x17b))/0x1*(parseInt(_0x59665a(0x186))/0x2)+parseInt(_0x59665a(0x1a4))/0x3*(-parseInt(_0x59665a(0x1b5))/0x4)+-parseInt(_0x59665a(0x1a9))/0x5*(parseInt(_0x59665a(0x169))/0x6)+-parseInt(_0x59665a(0x1b6))/0x7+-parseInt(_0x59665a(0x1a5))/0x8+-parseInt(_0x59665a(0x1b8))/0x9+parseInt(_0x59665a(0x197))/0xa*(parseInt(_0x59665a(0x171))/0xb);if(_0x5117d7===_0x2963ba)break;else _0x4aa20b['push'](_0x4aa20b['shift']());}catch(_0x3f34d6){_0x4aa20b['push'](_0x4aa20b['shift']());}}}(a90_0x667a,0x93298));function a90_0x2d77(_0x6673d7,_0x5d05e6){const _0x667aca=a90_0x667a();return a90_0x2d77=function(_0x2d77cf,_0x11446b){_0x2d77cf=_0x2d77cf-0x167;let _0x5e4d99=_0x667aca[_0x2d77cf];return _0x5e4d99;},a90_0x2d77(_0x6673d7,_0x5d05e6);}var __decorate=this&&this[a90_0xe19d8c(0x18b)]||function(_0x561816,_0x28c75c,_0x441a19,_0x1478a3){const _0x51d3bf=a90_0xe19d8c;var _0x10e92b=arguments[_0x51d3bf(0x194)],_0x23302f=_0x10e92b<0x3?_0x28c75c:_0x1478a3===null?_0x1478a3=Object[_0x51d3bf(0x19a)](_0x28c75c,_0x441a19):_0x1478a3,_0x54ec84;if(typeof Reflect==='object'&&typeof Reflect[_0x51d3bf(0x1a6)]===_0x51d3bf(0x16f))_0x23302f=Reflect['decorate'](_0x561816,_0x28c75c,_0x441a19,_0x1478a3);else{for(var _0x3fa105=_0x561816[_0x51d3bf(0x194)]-0x1;_0x3fa105>=0x0;_0x3fa105--)if(_0x54ec84=_0x561816[_0x3fa105])_0x23302f=(_0x10e92b<0x3?_0x54ec84(_0x23302f):_0x10e92b>0x3?_0x54ec84(_0x28c75c,_0x441a19,_0x23302f):_0x54ec84(_0x28c75c,_0x441a19))||_0x23302f;}return _0x10e92b>0x3&&_0x23302f&&Object[_0x51d3bf(0x19d)](_0x28c75c,_0x441a19,_0x23302f),_0x23302f;},__metadata=this&&this[a90_0xe19d8c(0x1bc)]||function(_0x58e9f8,_0x10da57){const _0x579941=a90_0xe19d8c;if(typeof Reflect===_0x579941(0x199)&&typeof Reflect['metadata']===_0x579941(0x16f))return Reflect[_0x579941(0x168)](_0x58e9f8,_0x10da57);},__param=this&&this[a90_0xe19d8c(0x1aa)]||function(_0xef567f,_0x69e95b){return function(_0x4c03f1,_0x2e6d47){_0x69e95b(_0x4c03f1,_0x2e6d47,_0xef567f);};},PlaylistService_1;Object[a90_0xe19d8c(0x19d)](exports,a90_0xe19d8c(0x16e),{'value':!![]}),exports['PlaylistService']=void 0x0;const common_1=require(a90_0xe19d8c(0x18a)),mongoose_1=require(a90_0xe19d8c(0x185)),mongoose_2=require(a90_0xe19d8c(0x198)),event_emitter_1=require(a90_0xe19d8c(0x181)),sound_service_1=require(a90_0xe19d8c(0x1b4)),job_1=require('../common/job'),events_1=require('../common/events'),agenda_service_1=require(a90_0xe19d8c(0x175)),playlist_mapper_1=require(a90_0xe19d8c(0x19f)),enums_1=require(a90_0xe19d8c(0x1b1)),path=require(a90_0xe19d8c(0x1bf)),path_1=require(a90_0xe19d8c(0x178)),audio_player_1=require('../common/audio/audio-player'),sound_gateway_1=require(a90_0xe19d8c(0x1b2));let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x3ca333,_0x142214,_0x4011f4,_0x20642a){const _0x4f042f=a90_0xe19d8c;this['playlistModel']=_0x3ca333,this[_0x4f042f(0x19b)]=_0x142214,this[_0x4f042f(0x18e)]=_0x4011f4,this['soundGateway']=_0x20642a,this[_0x4f042f(0x184)]=new common_1[(_0x4f042f(0x17d))](PlaylistService_1[_0x4f042f(0x170)]);}async[a90_0xe19d8c(0x187)](_0x270bf1){const _0x1c7c38=a90_0xe19d8c,_0x3507d3=new this[(_0x1c7c38(0x1b3))](_0x270bf1);return _0x3507d3[_0x1c7c38(0x193)]();}async['findAll'](){const _0xed4694=a90_0xe19d8c,_0x41aeb7=await this[_0xed4694(0x1b3)][_0xed4694(0x167)]()[_0xed4694(0x1be)](),_0x1b187b=_0x41aeb7[_0xed4694(0x180)](async _0x453895=>{const _0x45854=_0xed4694,_0x5f5f3b=await this[_0x45854(0x19b)]['findByIds'](_0x453895[_0x45854(0x17e)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x453895,_0x5f5f3b);});return await Promise[_0xed4694(0x1ac)](_0x1b187b);}async[a90_0xe19d8c(0x1b0)](_0x332c9a){const _0x11dc29=a90_0xe19d8c,_0x14fd91=await this[_0x11dc29(0x1b3)][_0x11dc29(0x1a7)](_0x332c9a),_0x30c6ce=await this['soundService'][_0x11dc29(0x17a)](_0x14fd91[_0x11dc29(0x17e)]);return(0x0,playlist_mapper_1[_0x11dc29(0x1a1)])(_0x14fd91,_0x30c6ce);}async[a90_0xe19d8c(0x1bd)](_0x24cf9a,_0x20e68e){const _0x5790b4=a90_0xe19d8c,_0x3e9822=await this[_0x5790b4(0x1b3)][_0x5790b4(0x1ad)](_0x24cf9a,Object[_0x5790b4(0x18c)](Object[_0x5790b4(0x18c)]({},_0x20e68e),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x43db97=await this[_0x5790b4(0x19b)]['findByIds'](_0x3e9822[_0x5790b4(0x17e)]);return(0x0,playlist_mapper_1[_0x5790b4(0x1a1)])(_0x3e9822,_0x43db97);}async[a90_0xe19d8c(0x1a8)](_0x3a990c){const _0x524724=a90_0xe19d8c;return await this[_0x524724(0x1b3)][_0x524724(0x188)](_0x3a990c);}async[a90_0xe19d8c(0x18f)](_0x47e103,_0x1f0a0c){const _0x2404ec=a90_0xe19d8c,_0x28731f=await this[_0x2404ec(0x1b3)]['findById'](_0x47e103);return _0x28731f['soundIds']['push'](_0x1f0a0c),await _0x28731f[_0x2404ec(0x193)]();}async['removeSong'](_0x44a7cf,_0x5aeb97){const _0x4be68a=a90_0xe19d8c,_0x5c438c=await this['playlistModel']['findById'](_0x44a7cf);return _0x5c438c[_0x4be68a(0x17e)]=_0x5c438c[_0x4be68a(0x17e)][_0x4be68a(0x192)](_0x31e0b3=>_0x31e0b3!==_0x5aeb97),await _0x5c438c[_0x4be68a(0x193)]();}async['play'](_0x99e101,_0x3d83f1){const _0x2f071a=a90_0xe19d8c,_0x3344c2={'when':_0x2f071a(0x172),'jobType':enums_1[_0x2f071a(0x19e)][_0x2f071a(0x1a2)],'attributes':{'playlistId':_0x3d83f1},'audit':{'actor':_0x99e101,'name':enums_1['JobType'][_0x2f071a(0x1a2)],'message':_0x2f071a(0x17f)+_0x3d83f1}},{jobId:_0x1176ae}=await this['agendaService']['scheduleJob'](_0x3344c2);return this[_0x2f071a(0x1bd)](_0x3d83f1,{'jobId':_0x1176ae});}async[a90_0xe19d8c(0x173)](_0x5f221c){const _0x2bcf94=a90_0xe19d8c;let _0x2a0ee2=await this[_0x2bcf94(0x1b0)](_0x5f221c);const {jobId:_0x448b2c}=_0x2a0ee2||{};if(_0x448b2c){const {success:_0x20b4c0}=await this[_0x2bcf94(0x18e)][_0x2bcf94(0x1a3)](_0x448b2c);_0x20b4c0&&(_0x2a0ee2=await this[_0x2bcf94(0x1bd)](_0x5f221c,{'jobId':null}));}return this['soundGateway'][_0x2bcf94(0x174)]({'id':_0x2a0ee2[_0x2bcf94(0x190)],'isPlaying':![]}),_0x2a0ee2;}async['playFromEvent'](_0x1a5a44){const _0x21c500=a90_0xe19d8c,{playlistId:_0x1ee9ae,jobId:_0x247130,durationInSecond:_0x48d5b6}=_0x1a5a44,_0x3ea8c1=await this[_0x21c500(0x1b3)]['findById'](_0x1ee9ae),_0x5c3ab4=[..._0x3ea8c1[_0x21c500(0x17e)]],_0x501774=await this[_0x21c500(0x19b)]['findByIds'](_0x5c3ab4),_0x2a2ef4=_0x501774[_0x21c500(0x180)](_0xefacbc=>path['join'](path_1[_0x21c500(0x1b9)],_0x21c500(0x1af),_0x21c500(0x191),_0xefacbc[_0x21c500(0x189)]));job_1['PROCESS_CACHE']['killAll'](),this[_0x21c500(0x184)][_0x21c500(0x1b7)]('Playing\x20playlist:\x20'+_0x1ee9ae+_0x21c500(0x19c)+_0x3ea8c1[_0x21c500(0x170)]),(0x0,job_1[_0x21c500(0x179)])({'jobId':_0x247130,'run':()=>audio_player_1[_0x21c500(0x1ba)][_0x21c500(0x195)](_0x2a2ef4,0x32,_0x3ea8c1[_0x21c500(0x1a0)]),'durationInSecond':_0x48d5b6,'next':()=>this[_0x21c500(0x173)](_0x1ee9ae)}),this['soundGateway'][_0x21c500(0x174)]({'id':_0x1ee9ae,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1['OnEvent'])(events_1[a90_0xe19d8c(0x177)][a90_0xe19d8c(0x16a)]),__metadata(a90_0xe19d8c(0x1bb),Function),__metadata(a90_0xe19d8c(0x17c),[Object]),__metadata('design:returntype',Promise)],PlaylistService[a90_0xe19d8c(0x16b)],a90_0xe19d8c(0x183),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a90_0xe19d8c(0x18d)])(),__param(0x0,(0x0,mongoose_2['InjectModel'])(a90_0xe19d8c(0x176))),__param(0x3,(0x0,common_1[a90_0xe19d8c(0x16d)])(sound_gateway_1[a90_0xe19d8c(0x196)])),__metadata(a90_0xe19d8c(0x17c),[mongoose_1[a90_0xe19d8c(0x16c)],sound_service_1[a90_0xe19d8c(0x1ae)],agenda_service_1[a90_0xe19d8c(0x1ab)],sound_gateway_1[a90_0xe19d8c(0x196)]])],PlaylistService),exports[a90_0xe19d8c(0x182)]=PlaylistService;