'use strict';const a90_0x383c12=a90_0x5f02;(function(_0x4a127e,_0x7f3d5e){const _0x58ec4f=a90_0x5f02,_0xe61210=_0x4a127e();while(!![]){try{const _0x2447bd=-parseInt(_0x58ec4f(0x9a))/0x1+-parseInt(_0x58ec4f(0xd1))/0x2*(parseInt(_0x58ec4f(0x93))/0x3)+parseInt(_0x58ec4f(0x8a))/0x4+-parseInt(_0x58ec4f(0x9c))/0x5+parseInt(_0x58ec4f(0xc1))/0x6*(parseInt(_0x58ec4f(0x99))/0x7)+parseInt(_0x58ec4f(0xcf))/0x8+parseInt(_0x58ec4f(0x8d))/0x9*(parseInt(_0x58ec4f(0x94))/0xa);if(_0x2447bd===_0x7f3d5e)break;else _0xe61210['push'](_0xe61210['shift']());}catch(_0x44a0b2){_0xe61210['push'](_0xe61210['shift']());}}}(a90_0x45d0,0x4e7c3));var __decorate=this&&this[a90_0x383c12(0xb1)]||function(_0x5ebab9,_0x250532,_0x179128,_0x8e72b7){const _0x2046f7=a90_0x383c12;var _0xc1dabd=arguments['length'],_0x5baf2f=_0xc1dabd<0x3?_0x250532:_0x8e72b7===null?_0x8e72b7=Object[_0x2046f7(0xc0)](_0x250532,_0x179128):_0x8e72b7,_0x471f43;if(typeof Reflect==='object'&&typeof Reflect[_0x2046f7(0x85)]===_0x2046f7(0xa1))_0x5baf2f=Reflect[_0x2046f7(0x85)](_0x5ebab9,_0x250532,_0x179128,_0x8e72b7);else{for(var _0x5c8923=_0x5ebab9['length']-0x1;_0x5c8923>=0x0;_0x5c8923--)if(_0x471f43=_0x5ebab9[_0x5c8923])_0x5baf2f=(_0xc1dabd<0x3?_0x471f43(_0x5baf2f):_0xc1dabd>0x3?_0x471f43(_0x250532,_0x179128,_0x5baf2f):_0x471f43(_0x250532,_0x179128))||_0x5baf2f;}return _0xc1dabd>0x3&&_0x5baf2f&&Object[_0x2046f7(0x8f)](_0x250532,_0x179128,_0x5baf2f),_0x5baf2f;},__metadata=this&&this['__metadata']||function(_0x2bafdd,_0x17e091){const _0x51cfe1=a90_0x383c12;if(typeof Reflect===_0x51cfe1(0xad)&&typeof Reflect[_0x51cfe1(0x87)]===_0x51cfe1(0xa1))return Reflect[_0x51cfe1(0x87)](_0x2bafdd,_0x17e091);},__param=this&&this[a90_0x383c12(0x90)]||function(_0x327263,_0x4b47e5){return function(_0x4028ef,_0xf28b13){_0x4b47e5(_0x4028ef,_0xf28b13,_0x327263);};},PlaylistService_1;Object[a90_0x383c12(0x8f)](exports,a90_0x383c12(0xab),{'value':!![]}),exports['PlaylistService']=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a90_0x383c12(0xac)),mongoose_2=require(a90_0x383c12(0x8e)),event_emitter_1=require(a90_0x383c12(0xd6)),sound_service_1=require(a90_0x383c12(0xc9)),job_1=require(a90_0x383c12(0xce)),events_1=require(a90_0x383c12(0xa3)),agenda_service_1=require('../agenda/agenda.service'),playlist_mapper_1=require('./mapper/playlist.mapper'),enums_1=require(a90_0x383c12(0xaa)),path=require(a90_0x383c12(0x84)),path_1=require(a90_0x383c12(0xcd)),audio_player_1=require(a90_0x383c12(0x9f)),sound_gateway_1=require('../sound/sound.gateway');let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0xbcecb4,_0x22a0fe,_0x2a96d7,_0x2e91d1){const _0x13f9ad=a90_0x383c12;this[_0x13f9ad(0xc2)]=_0xbcecb4,this[_0x13f9ad(0xbb)]=_0x22a0fe,this[_0x13f9ad(0xb7)]=_0x2a96d7,this[_0x13f9ad(0xa8)]=_0x2e91d1,this[_0x13f9ad(0xb8)]=new common_1[(_0x13f9ad(0x82))](PlaylistService_1[_0x13f9ad(0xd5)]);}async['create'](_0x1247d3){const _0x55bbd2=a90_0x383c12,_0x1447f0=new this['playlistModel'](_0x1247d3);return _0x1447f0[_0x55bbd2(0xd0)]();}async['findAll'](){const _0x36ecd1=a90_0x383c12,_0x5bb3a5=await this[_0x36ecd1(0xc2)]['find']()[_0x36ecd1(0xd3)](),_0x4e8265=_0x5bb3a5['map'](async _0x1938a0=>{const _0x2743f3=_0x36ecd1,_0x4aad82=await this['soundService'][_0x2743f3(0xbf)](_0x1938a0['soundIds']);return(0x0,playlist_mapper_1[_0x2743f3(0xb5)])(_0x1938a0,_0x4aad82);});return await Promise[_0x36ecd1(0x92)](_0x4e8265);}async[a90_0x383c12(0xc4)](_0x2edfe9){const _0x2e0dd6=a90_0x383c12,_0x41e0b1=await this[_0x2e0dd6(0xc2)][_0x2e0dd6(0xa2)](_0x2edfe9),_0x209576=await this[_0x2e0dd6(0xbb)][_0x2e0dd6(0xbf)](_0x41e0b1[_0x2e0dd6(0xbd)]);return(0x0,playlist_mapper_1[_0x2e0dd6(0xb5)])(_0x41e0b1,_0x209576);}async[a90_0x383c12(0xa7)](_0x4c239c,_0x3edf67){const _0x297c15=a90_0x383c12,_0x4c81e2=await this['playlistModel']['findByIdAndUpdate'](_0x4c239c,Object[_0x297c15(0xd2)](Object[_0x297c15(0xd2)]({},_0x3edf67),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x154733=await this[_0x297c15(0xbb)][_0x297c15(0xbf)](_0x4c81e2[_0x297c15(0xbd)]);return(0x0,playlist_mapper_1[_0x297c15(0xb5)])(_0x4c81e2,_0x154733);}async[a90_0x383c12(0x89)](_0x113345){const _0x2cdc28=a90_0x383c12;return await this['playlistModel'][_0x2cdc28(0x9b)](_0x113345);}async[a90_0x383c12(0x9d)](_0x5cc8f8,_0x1170b5){const _0x399dd7=a90_0x383c12,_0x2606e2=await this[_0x399dd7(0xc2)][_0x399dd7(0xa2)](_0x5cc8f8);return _0x2606e2[_0x399dd7(0xbd)][_0x399dd7(0xae)](_0x1170b5),await _0x2606e2['save']();}async[a90_0x383c12(0xb6)](_0x152b64,_0x13551){const _0x1c7db6=a90_0x383c12,_0x1c8411=await this[_0x1c7db6(0xc2)][_0x1c7db6(0xa2)](_0x152b64);return _0x1c8411['soundIds']=_0x1c8411[_0x1c7db6(0xbd)]['filter'](_0x3ae6b9=>_0x3ae6b9!==_0x13551),await _0x1c8411[_0x1c7db6(0xd0)]();}async[a90_0x383c12(0x9e)](_0x36f922,_0x1b180e){const _0x4a0288=a90_0x383c12,_0xf3ba1a={'when':'now','jobType':enums_1[_0x4a0288(0x98)][_0x4a0288(0xcb)],'attributes':{'playlistId':_0x1b180e},'audit':{'actor':_0x36f922,'name':enums_1['JobType']['PlayMusic'],'message':_0x4a0288(0xb2)+_0x1b180e}},{jobId:_0x559ee3}=await this[_0x4a0288(0xb7)][_0x4a0288(0xa0)](_0xf3ba1a);return this[_0x4a0288(0xa7)](_0x1b180e,{'jobId':_0x559ee3});}async[a90_0x383c12(0xc6)](_0x11ca85){const _0x5aaac1=a90_0x383c12;let _0x3f8a04=await this[_0x5aaac1(0xc4)](_0x11ca85);const {jobId:_0x2106ed}=_0x3f8a04||{};if(_0x2106ed){const {success:_0x509c9a}=await this['agendaService'][_0x5aaac1(0x8c)](_0x2106ed);_0x509c9a&&(_0x3f8a04=await this[_0x5aaac1(0xa7)](_0x11ca85,{'jobId':null}));}return this['soundGateway'][_0x5aaac1(0x95)]({'id':_0x3f8a04['_id'],'isPlaying':![]}),_0x3f8a04;}async['playFromEvent'](_0x33be5d){const _0x173edb=a90_0x383c12,{playlistId:_0x422db8,jobId:_0xb262d7,durationInSecond:_0x4f4867}=_0x33be5d,_0x159c50=await this[_0x173edb(0xc2)]['findById'](_0x422db8),_0x2c36a9=[..._0x159c50[_0x173edb(0xbd)]],_0x349567=await this['soundService'][_0x173edb(0xbf)](_0x2c36a9),_0x2aceca=_0x349567[_0x173edb(0xc7)](_0x14dcdd=>path[_0x173edb(0xb4)](path_1[_0x173edb(0xb3)],_0x173edb(0xba),_0x173edb(0xbc),_0x14dcdd['fileName']));job_1['PROCESS_CACHE'][_0x173edb(0xc5)](),this[_0x173edb(0xb8)][_0x173edb(0xa9)](_0x173edb(0xcc)+_0x422db8+_0x173edb(0xca)+_0x159c50['name']),(0x0,job_1[_0x173edb(0x8b)])({'jobId':_0xb262d7,'run':()=>audio_player_1[_0x173edb(0xa5)][_0x173edb(0xd4)](_0x2aceca,0x32,_0x159c50['isShuffle']),'durationInSecond':_0x4f4867,'next':()=>this['stop'](_0x422db8)}),this['soundGateway'][_0x173edb(0x95)]({'id':_0x422db8,'isPlaying':!![]});}};function a90_0x45d0(){const _0x45a8f8=['save','481808lPrFRm','assign','exec','playAsync','name','@nestjs/event-emitter','AgendaService','prototype','Logger','OnEvent','path','decorate','InjectModel','metadata','design:paramtypes','delete','2022736WtSWJu','executeJob','cancelJob','5060511VeCkqN','@nestjs/mongoose','defineProperty','__param','design:type','all','6jFiTET','10arooSF','broadcastPlaying','design:returntype','PlaylistEvent','JobType','82607RugZFk','453439tOglAM','findByIdAndDelete','2313515QVLTDD','addSong','play','../common/audio/audio-player','scheduleJob','function','findById','../common/events','Model','AudioPlayer','playFromEvent','update','soundGateway','log','../common/enums','__esModule','mongoose','object','push','Inject','Injectable','__decorate','Play\x20Music\x20Playlist:\x20','processRootPath','join','mapToDto','removeSong','agendaService','logger','SoundGateway','assets','soundService','audio','soundIds','Playlist','findByIds','getOwnPropertyDescriptor','162KJmNPd','playlistModel','SoundService','findOne','killAll','stop','map','Play','../sound/sound.service','\x20-\x20','PlayMusic','Playing\x20playlist:\x20','../common/path','../common/job','2662680iURQZx'];a90_0x45d0=function(){return _0x45a8f8;};return a90_0x45d0();}function a90_0x5f02(_0x774662,_0x37298c){const _0x45d0f8=a90_0x45d0();return a90_0x5f02=function(_0x5f0264,_0x8760e0){_0x5f0264=_0x5f0264-0x82;let _0x180dd5=_0x45d0f8[_0x5f0264];return _0x180dd5;},a90_0x5f02(_0x774662,_0x37298c);}__decorate([(0x0,event_emitter_1[a90_0x383c12(0x83)])(events_1[a90_0x383c12(0x97)][a90_0x383c12(0xc8)]),__metadata(a90_0x383c12(0x91),Function),__metadata(a90_0x383c12(0x88),[Object]),__metadata(a90_0x383c12(0x96),Promise)],PlaylistService[a90_0x383c12(0xd8)],a90_0x383c12(0xa6),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a90_0x383c12(0xb0)])(),__param(0x0,(0x0,mongoose_2[a90_0x383c12(0x86)])(a90_0x383c12(0xbe))),__param(0x3,(0x0,common_1[a90_0x383c12(0xaf)])(sound_gateway_1[a90_0x383c12(0xb9)])),__metadata('design:paramtypes',[mongoose_1[a90_0x383c12(0xa4)],sound_service_1[a90_0x383c12(0xc3)],agenda_service_1[a90_0x383c12(0xd7)],sound_gateway_1['SoundGateway']])],PlaylistService),exports['PlaylistService']=PlaylistService;