'use strict';function a87_0x2ec1(){const _0x3e288b=['469RUpQMO','save','findById','find','2521285eUuSUz','3053871hoXMnp','play','audio','AudioPlayer','prototype','24bYqPPa','Playing\x20playlist:\x20','stop','../common/events','Play\x20Music\x20Playlist:\x20','scheduleJob','990763qLqAqJ','findByIdAndDelete','create','Inject','now','87420UWCAVI','26630054fcEGzc','PlaylistEvent','object','JobType','Playlist','Play','design:returntype','soundIds','log','148tXHVWe','SoundGateway','logger','findAll','../sound/sound.gateway','all','\x20-\x20','processRootPath','design:paramtypes','__decorate','addSong','decorate','Injectable','InjectModel','mongoose','map','delete','findOne','../agenda/agenda.service','getOwnPropertyDescriptor','./mapper/playlist.mapper','__param','../common/enums','../common/audio/audio-player','soundService','PlaylistService','2TMPhRc','Logger','name','metadata','soundGateway','SoundService','assets','design:type','@nestjs/common','8891020kAPDtd','PlayMusic','path','playlistModel','defineProperty','exec','__metadata','AgendaService','update','PROCESS_CACHE','findByIds','join','OnEvent','cancelJob','../common/job','agendaService','executeJob','43701kRPyFO','assign','push','_id','killAll'];a87_0x2ec1=function(){return _0x3e288b;};return a87_0x2ec1();}const a87_0x4b1272=a87_0x20f8;(function(_0x110000,_0x40fe4e){const _0x3da639=a87_0x20f8,_0x4d2083=_0x110000();while(!![]){try{const _0x129640=-parseInt(_0x3da639(0x185))/0x1*(-parseInt(_0x3da639(0x156))/0x2)+-parseInt(_0x3da639(0x170))/0x3*(-parseInt(_0x3da639(0x13c))/0x4)+parseInt(_0x3da639(0x179))/0x5+parseInt(_0x3da639(0x18a))/0x6*(-parseInt(_0x3da639(0x175))/0x7)+-parseInt(_0x3da639(0x17f))/0x8*(-parseInt(_0x3da639(0x17a))/0x9)+parseInt(_0x3da639(0x15f))/0xa+-parseInt(_0x3da639(0x18b))/0xb;if(_0x129640===_0x40fe4e)break;else _0x4d2083['push'](_0x4d2083['shift']());}catch(_0x5867f7){_0x4d2083['push'](_0x4d2083['shift']());}}}(a87_0x2ec1,0x84cd2));function a87_0x20f8(_0x56f5b3,_0xc92cae){const _0x2ec157=a87_0x2ec1();return a87_0x20f8=function(_0x20f8dd,_0x2cdf08){_0x20f8dd=_0x20f8dd-0x13b;let _0x498647=_0x2ec157[_0x20f8dd];return _0x498647;},a87_0x20f8(_0x56f5b3,_0xc92cae);}var __decorate=this&&this[a87_0x4b1272(0x145)]||function(_0x126fe1,_0x1fc742,_0x5bfcde,_0xe91584){const _0x1078f8=a87_0x4b1272;var _0x53ba6d=arguments['length'],_0x4e19be=_0x53ba6d<0x3?_0x1fc742:_0xe91584===null?_0xe91584=Object[_0x1078f8(0x14f)](_0x1fc742,_0x5bfcde):_0xe91584,_0xf54745;if(typeof Reflect===_0x1078f8(0x18d)&&typeof Reflect[_0x1078f8(0x147)]==='function')_0x4e19be=Reflect['decorate'](_0x126fe1,_0x1fc742,_0x5bfcde,_0xe91584);else{for(var _0x7da44e=_0x126fe1['length']-0x1;_0x7da44e>=0x0;_0x7da44e--)if(_0xf54745=_0x126fe1[_0x7da44e])_0x4e19be=(_0x53ba6d<0x3?_0xf54745(_0x4e19be):_0x53ba6d>0x3?_0xf54745(_0x1fc742,_0x5bfcde,_0x4e19be):_0xf54745(_0x1fc742,_0x5bfcde))||_0x4e19be;}return _0x53ba6d>0x3&&_0x4e19be&&Object['defineProperty'](_0x1fc742,_0x5bfcde,_0x4e19be),_0x4e19be;},__metadata=this&&this[a87_0x4b1272(0x165)]||function(_0x34a92b,_0x10a7dd){const _0x5330fd=a87_0x4b1272;if(typeof Reflect===_0x5330fd(0x18d)&&typeof Reflect[_0x5330fd(0x159)]==='function')return Reflect['metadata'](_0x34a92b,_0x10a7dd);},__param=this&&this[a87_0x4b1272(0x151)]||function(_0x17cdda,_0x358ebd){return function(_0x6cac9,_0x4f73ed){_0x358ebd(_0x6cac9,_0x4f73ed,_0x17cdda);};},PlaylistService_1;Object[a87_0x4b1272(0x163)](exports,'__esModule',{'value':!![]}),exports[a87_0x4b1272(0x155)]=void 0x0;const common_1=require(a87_0x4b1272(0x15e)),mongoose_1=require(a87_0x4b1272(0x14a)),mongoose_2=require('@nestjs/mongoose'),event_emitter_1=require('@nestjs/event-emitter'),sound_service_1=require('../sound/sound.service'),job_1=require(a87_0x4b1272(0x16d)),events_1=require(a87_0x4b1272(0x182)),agenda_service_1=require(a87_0x4b1272(0x14e)),playlist_mapper_1=require(a87_0x4b1272(0x150)),enums_1=require(a87_0x4b1272(0x152)),path=require(a87_0x4b1272(0x161)),path_1=require('../common/path'),audio_player_1=require(a87_0x4b1272(0x153)),sound_gateway_1=require(a87_0x4b1272(0x140));let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x4e2d88,_0x420635,_0x369ad8,_0x37c09f){const _0x190bb2=a87_0x4b1272;this[_0x190bb2(0x162)]=_0x4e2d88,this[_0x190bb2(0x154)]=_0x420635,this[_0x190bb2(0x16e)]=_0x369ad8,this['soundGateway']=_0x37c09f,this['logger']=new common_1[(_0x190bb2(0x157))](PlaylistService_1[_0x190bb2(0x158)]);}async[a87_0x4b1272(0x187)](_0x52121b){const _0x3ce3bb=a87_0x4b1272,_0x349c3c=new this['playlistModel'](_0x52121b);return _0x349c3c[_0x3ce3bb(0x176)]();}async[a87_0x4b1272(0x13f)](){const _0x44832a=a87_0x4b1272,_0x52adef=await this[_0x44832a(0x162)][_0x44832a(0x178)]()[_0x44832a(0x164)](),_0x2f59a2=_0x52adef[_0x44832a(0x14b)](async _0x4f79de=>{const _0x3cb82c=_0x44832a,_0x487a19=await this[_0x3cb82c(0x154)]['findByIds'](_0x4f79de[_0x3cb82c(0x192)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x4f79de,_0x487a19);});return await Promise[_0x44832a(0x141)](_0x2f59a2);}async[a87_0x4b1272(0x14d)](_0xd402ba){const _0x18bed1=a87_0x4b1272,_0x2b5915=await this[_0x18bed1(0x162)][_0x18bed1(0x177)](_0xd402ba),_0x3c7a1d=await this[_0x18bed1(0x154)][_0x18bed1(0x169)](_0x2b5915[_0x18bed1(0x192)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x2b5915,_0x3c7a1d);}async['update'](_0x5dcf8e,_0x314d26){const _0x4d9e9e=a87_0x4b1272,_0xbdc60d=await this[_0x4d9e9e(0x162)]['findByIdAndUpdate'](_0x5dcf8e,Object[_0x4d9e9e(0x171)](Object[_0x4d9e9e(0x171)]({},_0x314d26),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x335b59=await this[_0x4d9e9e(0x154)][_0x4d9e9e(0x169)](_0xbdc60d[_0x4d9e9e(0x192)]);return(0x0,playlist_mapper_1['mapToDto'])(_0xbdc60d,_0x335b59);}async[a87_0x4b1272(0x14c)](_0x5bc244){const _0x53c0e7=a87_0x4b1272;return await this[_0x53c0e7(0x162)][_0x53c0e7(0x186)](_0x5bc244);}async[a87_0x4b1272(0x146)](_0x47ac62,_0x1560a8){const _0x9b4220=a87_0x4b1272,_0x203876=await this[_0x9b4220(0x162)][_0x9b4220(0x177)](_0x47ac62);return _0x203876[_0x9b4220(0x192)][_0x9b4220(0x172)](_0x1560a8),await _0x203876[_0x9b4220(0x176)]();}async['removeSong'](_0xb434cc,_0x5ae522){const _0x2decfd=a87_0x4b1272,_0x8a2343=await this['playlistModel'][_0x2decfd(0x177)](_0xb434cc);return _0x8a2343[_0x2decfd(0x192)]=_0x8a2343[_0x2decfd(0x192)]['filter'](_0x480654=>_0x480654!==_0x5ae522),await _0x8a2343[_0x2decfd(0x176)]();}async[a87_0x4b1272(0x17b)](_0x19e097,_0x1ebebd){const _0x1dc9f4=a87_0x4b1272,_0x16785d={'when':_0x1dc9f4(0x189),'jobType':enums_1[_0x1dc9f4(0x18e)][_0x1dc9f4(0x160)],'attributes':{'playlistId':_0x1ebebd},'audit':{'actor':_0x19e097,'name':enums_1['JobType'][_0x1dc9f4(0x160)],'message':_0x1dc9f4(0x183)+_0x1ebebd}},{jobId:_0x30ac23}=await this[_0x1dc9f4(0x16e)][_0x1dc9f4(0x184)](_0x16785d);return this[_0x1dc9f4(0x167)](_0x1ebebd,{'jobId':_0x30ac23});}async[a87_0x4b1272(0x181)](_0x39017c){const _0x4a0f88=a87_0x4b1272;let _0x23b018=await this[_0x4a0f88(0x14d)](_0x39017c);const {jobId:_0x421edb}=_0x23b018||{};if(_0x421edb){const {success:_0x501045}=await this['agendaService'][_0x4a0f88(0x16c)](_0x421edb);_0x501045&&(_0x23b018=await this[_0x4a0f88(0x167)](_0x39017c,{'jobId':null}));}return this['soundGateway']['broadcastPlaying']({'id':_0x23b018[_0x4a0f88(0x173)],'isPlaying':![]}),_0x23b018;}async['playFromEvent'](_0x2d717d){const _0x3749bf=a87_0x4b1272,{playlistId:_0x27a7a4,jobId:_0x3e5905,durationInSecond:_0x24dc81}=_0x2d717d,_0x1822c4=await this[_0x3749bf(0x162)][_0x3749bf(0x177)](_0x27a7a4),_0x2d2cfa=[..._0x1822c4[_0x3749bf(0x192)]],_0x41f15f=await this['soundService'][_0x3749bf(0x169)](_0x2d2cfa),_0x43db7a=_0x41f15f['map'](_0x1f9af9=>path[_0x3749bf(0x16a)](path_1[_0x3749bf(0x143)],_0x3749bf(0x15c),_0x3749bf(0x17c),_0x1f9af9['fileName']));job_1[_0x3749bf(0x168)][_0x3749bf(0x174)](),this[_0x3749bf(0x13e)][_0x3749bf(0x13b)](_0x3749bf(0x180)+_0x27a7a4+_0x3749bf(0x142)+_0x1822c4[_0x3749bf(0x158)]),(0x0,job_1[_0x3749bf(0x16f)])({'jobId':_0x3e5905,'run':()=>audio_player_1[_0x3749bf(0x17d)]['playAsync'](_0x43db7a,0x32,_0x1822c4['isShuffle']),'durationInSecond':_0x24dc81,'next':()=>this['stop'](_0x27a7a4)}),this[_0x3749bf(0x15a)]['broadcastPlaying']({'id':_0x27a7a4,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1[a87_0x4b1272(0x16b)])(events_1[a87_0x4b1272(0x18c)][a87_0x4b1272(0x190)]),__metadata(a87_0x4b1272(0x15d),Function),__metadata(a87_0x4b1272(0x144),[Object]),__metadata(a87_0x4b1272(0x191),Promise)],PlaylistService[a87_0x4b1272(0x17e)],'playFromEvent',null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a87_0x4b1272(0x148)])(),__param(0x0,(0x0,mongoose_2[a87_0x4b1272(0x149)])(a87_0x4b1272(0x18f))),__param(0x3,(0x0,common_1[a87_0x4b1272(0x188)])(sound_gateway_1[a87_0x4b1272(0x13d)])),__metadata(a87_0x4b1272(0x144),[mongoose_1['Model'],sound_service_1[a87_0x4b1272(0x15b)],agenda_service_1[a87_0x4b1272(0x166)],sound_gateway_1[a87_0x4b1272(0x13d)]])],PlaylistService),exports[a87_0x4b1272(0x155)]=PlaylistService;