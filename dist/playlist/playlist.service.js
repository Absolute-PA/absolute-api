'use strict';function a87_0xb71e(){const _0x437a38=['create','PlayMusic','metadata','findByIds','soundGateway','Logger','executeJob','../sound/sound.service','1096975NsXwLZ','@nestjs/common','play','PlaylistService','agendaService','playlistModel','Inject','Playing\x20playlist:\x20','audio','290xTvzfL','SoundService','\x20-\x20','design:paramtypes','Injectable','all','413VRSHwj','exec','../common/enums','_id','design:returntype','InjectModel','25632ICJPTv','defineProperty','stop','update','./mapper/playlist.mapper','design:type','PlaylistEvent','getOwnPropertyDescriptor','Play','PROCESS_CACHE','now','addSong','__esModule','decorate','cancelJob','logger','soundIds','isShuffle','filter','320316vUzxEI','delete','Playlist','length','assets','soundService','Play\x20Music\x20Playlist:\x20','log','../common/events','SoundGateway','1776230TAZZBz','prototype','save','JobType','3750388QlCgEp','1FRjJWQ','@nestjs/event-emitter','assign','playAsync','__decorate','../sound/sound.gateway','mapToDto','processRootPath','push','../common/audio/audio-player','object','broadcastPlaying','scheduleJob','function','81nuXjud','120850jjEDBv','findAll','findOne','findByIdAndUpdate','playFromEvent','../common/job','findById','name','../common/path','fileName','../agenda/agenda.service','6258rCvIYO','map','find'];a87_0xb71e=function(){return _0x437a38;};return a87_0xb71e();}const a87_0x7481c1=a87_0x7a09;(function(_0x14e51e,_0x28bfb7){const _0x4fffbd=a87_0x7a09,_0x110a18=_0x14e51e();while(!![]){try{const _0x4ad325=parseInt(_0x4fffbd(0xcf))/0x1*(-parseInt(_0x4fffbd(0xde))/0x2)+parseInt(_0x4fffbd(0xc0))/0x3+-parseInt(_0x4fffbd(0xce))/0x4+parseInt(_0x4fffbd(0xfd))/0x5*(parseInt(_0x4fffbd(0xe9))/0x6)+-parseInt(_0x4fffbd(0xa7))/0x7*(-parseInt(_0x4fffbd(0xad))/0x8)+parseInt(_0x4fffbd(0xdd))/0x9*(parseInt(_0x4fffbd(0xca))/0xa)+-parseInt(_0x4fffbd(0xf4))/0xb;if(_0x4ad325===_0x28bfb7)break;else _0x110a18['push'](_0x110a18['shift']());}catch(_0x4ba874){_0x110a18['push'](_0x110a18['shift']());}}}(a87_0xb71e,0xd144a));var __decorate=this&&this[a87_0x7481c1(0xd3)]||function(_0x1aa0eb,_0x782682,_0x69b67,_0x427837){const _0x47fbad=a87_0x7481c1;var _0x1be172=arguments[_0x47fbad(0xc3)],_0x401d7a=_0x1be172<0x3?_0x782682:_0x427837===null?_0x427837=Object[_0x47fbad(0xb4)](_0x782682,_0x69b67):_0x427837,_0x569252;if(typeof Reflect===_0x47fbad(0xd9)&&typeof Reflect[_0x47fbad(0xba)]===_0x47fbad(0xdc))_0x401d7a=Reflect[_0x47fbad(0xba)](_0x1aa0eb,_0x782682,_0x69b67,_0x427837);else{for(var _0x505654=_0x1aa0eb[_0x47fbad(0xc3)]-0x1;_0x505654>=0x0;_0x505654--)if(_0x569252=_0x1aa0eb[_0x505654])_0x401d7a=(_0x1be172<0x3?_0x569252(_0x401d7a):_0x1be172>0x3?_0x569252(_0x782682,_0x69b67,_0x401d7a):_0x569252(_0x782682,_0x69b67))||_0x401d7a;}return _0x1be172>0x3&&_0x401d7a&&Object[_0x47fbad(0xae)](_0x782682,_0x69b67,_0x401d7a),_0x401d7a;},__metadata=this&&this['__metadata']||function(_0x6110b6,_0x3fc1dd){const _0x3d9cf5=a87_0x7481c1;if(typeof Reflect===_0x3d9cf5(0xd9)&&typeof Reflect[_0x3d9cf5(0xee)]==='function')return Reflect[_0x3d9cf5(0xee)](_0x6110b6,_0x3fc1dd);},__param=this&&this['__param']||function(_0x3207b9,_0x1f2ce){return function(_0x3cc7b0,_0x2a5579){_0x1f2ce(_0x3cc7b0,_0x2a5579,_0x3207b9);};},PlaylistService_1;Object[a87_0x7481c1(0xae)](exports,a87_0x7481c1(0xb9),{'value':!![]}),exports[a87_0x7481c1(0xf7)]=void 0x0;function a87_0x7a09(_0x1237a3,_0x3d9bef){const _0xb71ee=a87_0xb71e();return a87_0x7a09=function(_0x7a091e,_0x2739d1){_0x7a091e=_0x7a091e-0xa3;let _0x215df4=_0xb71ee[_0x7a091e];return _0x215df4;},a87_0x7a09(_0x1237a3,_0x3d9bef);}const common_1=require(a87_0x7481c1(0xf5)),mongoose_1=require('mongoose'),mongoose_2=require('@nestjs/mongoose'),event_emitter_1=require(a87_0x7481c1(0xd0)),sound_service_1=require(a87_0x7481c1(0xf3)),job_1=require(a87_0x7481c1(0xe3)),events_1=require(a87_0x7481c1(0xc8)),agenda_service_1=require(a87_0x7481c1(0xe8)),playlist_mapper_1=require(a87_0x7481c1(0xb1)),enums_1=require(a87_0x7481c1(0xa9)),path=require('path'),path_1=require(a87_0x7481c1(0xe6)),audio_player_1=require(a87_0x7481c1(0xd8)),sound_gateway_1=require(a87_0x7481c1(0xd4));let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x424303,_0x1f987a,_0x9f1ada,_0x37a185){const _0x2fb2c5=a87_0x7481c1;this[_0x2fb2c5(0xf9)]=_0x424303,this['soundService']=_0x1f987a,this[_0x2fb2c5(0xf8)]=_0x9f1ada,this[_0x2fb2c5(0xf0)]=_0x37a185,this['logger']=new common_1[(_0x2fb2c5(0xf1))](PlaylistService_1[_0x2fb2c5(0xe5)]);}async[a87_0x7481c1(0xec)](_0x11e781){const _0x1d8939=a87_0x7481c1,_0x3ffb81=new this['playlistModel'](_0x11e781);return _0x3ffb81[_0x1d8939(0xcc)]();}async[a87_0x7481c1(0xdf)](){const _0x45b0a8=a87_0x7481c1,_0x3c037d=await this[_0x45b0a8(0xf9)][_0x45b0a8(0xeb)]()[_0x45b0a8(0xa8)](),_0x722fb8=_0x3c037d[_0x45b0a8(0xea)](async _0x5dd239=>{const _0x595e22=_0x45b0a8,_0xef2ac8=await this['soundService'][_0x595e22(0xef)](_0x5dd239[_0x595e22(0xbd)]);return(0x0,playlist_mapper_1[_0x595e22(0xd5)])(_0x5dd239,_0xef2ac8);});return await Promise[_0x45b0a8(0xa6)](_0x722fb8);}async[a87_0x7481c1(0xe0)](_0x194c9e){const _0xbfe0a9=a87_0x7481c1,_0x87f440=await this[_0xbfe0a9(0xf9)]['findById'](_0x194c9e),_0x52023f=await this['soundService']['findByIds'](_0x87f440[_0xbfe0a9(0xbd)]);return(0x0,playlist_mapper_1[_0xbfe0a9(0xd5)])(_0x87f440,_0x52023f);}async[a87_0x7481c1(0xb0)](_0x4cfcd4,_0x18710a){const _0x5c2b73=a87_0x7481c1,_0x144d55=await this[_0x5c2b73(0xf9)][_0x5c2b73(0xe1)](_0x4cfcd4,Object[_0x5c2b73(0xd1)](Object['assign']({},_0x18710a),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x420c37=await this[_0x5c2b73(0xc5)][_0x5c2b73(0xef)](_0x144d55['soundIds']);return(0x0,playlist_mapper_1[_0x5c2b73(0xd5)])(_0x144d55,_0x420c37);}async[a87_0x7481c1(0xc1)](_0x2c7796){return await this['playlistModel']['findByIdAndDelete'](_0x2c7796);}async[a87_0x7481c1(0xb8)](_0x4e0c91,_0x22d6ca){const _0x2aee8d=a87_0x7481c1,_0x30e4b0=await this[_0x2aee8d(0xf9)][_0x2aee8d(0xe4)](_0x4e0c91);return _0x30e4b0[_0x2aee8d(0xbd)][_0x2aee8d(0xd7)](_0x22d6ca),await _0x30e4b0[_0x2aee8d(0xcc)]();}async['removeSong'](_0x5564e0,_0x33343c){const _0x5c96d9=a87_0x7481c1,_0x193289=await this[_0x5c96d9(0xf9)][_0x5c96d9(0xe4)](_0x5564e0);return _0x193289[_0x5c96d9(0xbd)]=_0x193289[_0x5c96d9(0xbd)][_0x5c96d9(0xbf)](_0x37b0b3=>_0x37b0b3!==_0x33343c),await _0x193289[_0x5c96d9(0xcc)]();}async[a87_0x7481c1(0xf6)](_0xf1b6a,_0x2beee7){const _0x5a12c6=a87_0x7481c1,_0x255bc7={'when':_0x5a12c6(0xb7),'jobType':enums_1[_0x5a12c6(0xcd)]['PlayMusic'],'attributes':{'playlistId':_0x2beee7},'audit':{'actor':_0xf1b6a,'name':enums_1[_0x5a12c6(0xcd)][_0x5a12c6(0xed)],'message':_0x5a12c6(0xc6)+_0x2beee7}},{jobId:_0x2c1d2e}=await this[_0x5a12c6(0xf8)][_0x5a12c6(0xdb)](_0x255bc7);return this[_0x5a12c6(0xb0)](_0x2beee7,{'jobId':_0x2c1d2e});}async['stop'](_0x3cc46f){const _0x5b439c=a87_0x7481c1;let _0xb5fcf1=await this[_0x5b439c(0xe0)](_0x3cc46f);const {jobId:_0x9fe6f3}=_0xb5fcf1||{};if(_0x9fe6f3){const {success:_0x204342}=await this[_0x5b439c(0xf8)][_0x5b439c(0xbb)](_0x9fe6f3);_0x204342&&(_0xb5fcf1=await this['update'](_0x3cc46f,{'jobId':null}));}return this[_0x5b439c(0xf0)][_0x5b439c(0xda)]({'id':_0xb5fcf1[_0x5b439c(0xaa)],'isPlaying':![]}),_0xb5fcf1;}async['playFromEvent'](_0x3dcbf8){const _0x553815=a87_0x7481c1,{playlistId:_0x29cbb6,jobId:_0xe7dfcc,durationInSecond:_0x497c52}=_0x3dcbf8,_0x1f0fce=await this['playlistModel']['findById'](_0x29cbb6),_0x1823fe=[..._0x1f0fce[_0x553815(0xbd)]],_0x2193d6=await this[_0x553815(0xc5)][_0x553815(0xef)](_0x1823fe),_0x53a652=_0x2193d6['map'](_0x5764=>path['join'](path_1[_0x553815(0xd6)],_0x553815(0xc4),_0x553815(0xfc),_0x5764[_0x553815(0xe7)]));job_1[_0x553815(0xb6)]['killAll'](),this[_0x553815(0xbc)][_0x553815(0xc7)](_0x553815(0xfb)+_0x29cbb6+_0x553815(0xa3)+_0x1f0fce[_0x553815(0xe5)]),(0x0,job_1[_0x553815(0xf2)])({'jobId':_0xe7dfcc,'run':()=>audio_player_1['AudioPlayer'][_0x553815(0xd2)](_0x53a652,0x32,_0x1f0fce[_0x553815(0xbe)]),'durationInSecond':_0x497c52,'next':()=>this[_0x553815(0xaf)](_0x29cbb6)}),this[_0x553815(0xf0)][_0x553815(0xda)]({'id':_0x29cbb6,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1['OnEvent'])(events_1[a87_0x7481c1(0xb3)][a87_0x7481c1(0xb5)]),__metadata(a87_0x7481c1(0xb2),Function),__metadata(a87_0x7481c1(0xa4),[Object]),__metadata(a87_0x7481c1(0xab),Promise)],PlaylistService[a87_0x7481c1(0xcb)],a87_0x7481c1(0xe2),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a87_0x7481c1(0xa5)])(),__param(0x0,(0x0,mongoose_2[a87_0x7481c1(0xac)])(a87_0x7481c1(0xc2))),__param(0x3,(0x0,common_1[a87_0x7481c1(0xfa)])(sound_gateway_1[a87_0x7481c1(0xc9)])),__metadata(a87_0x7481c1(0xa4),[mongoose_1['Model'],sound_service_1[a87_0x7481c1(0xfe)],agenda_service_1['AgendaService'],sound_gateway_1['SoundGateway']])],PlaylistService),exports[a87_0x7481c1(0xf7)]=PlaylistService;