'use strict';const a90_0x42efac=a90_0x3a11;(function(_0x3753ba,_0x3affe9){const _0x5bc348=a90_0x3a11,_0x3f03ea=_0x3753ba();while(!![]){try{const _0x36c91b=-parseInt(_0x5bc348(0xae))/0x1*(-parseInt(_0x5bc348(0x98))/0x2)+-parseInt(_0x5bc348(0x80))/0x3+parseInt(_0x5bc348(0xaf))/0x4*(parseInt(_0x5bc348(0xab))/0x5)+-parseInt(_0x5bc348(0x8f))/0x6+-parseInt(_0x5bc348(0x89))/0x7*(parseInt(_0x5bc348(0xd8))/0x8)+parseInt(_0x5bc348(0xc9))/0x9*(parseInt(_0x5bc348(0xb1))/0xa)+parseInt(_0x5bc348(0xa7))/0xb;if(_0x36c91b===_0x3affe9)break;else _0x3f03ea['push'](_0x3f03ea['shift']());}catch(_0x2cc175){_0x3f03ea['push'](_0x3f03ea['shift']());}}}(a90_0x10a4,0x338d6));function a90_0x3a11(_0x3f1f4b,_0x3beb20){const _0x10a488=a90_0x10a4();return a90_0x3a11=function(_0x3a110d,_0x108097){_0x3a110d=_0x3a110d-0x80;let _0x77c7ec=_0x10a488[_0x3a110d];return _0x77c7ec;},a90_0x3a11(_0x3f1f4b,_0x3beb20);}var __decorate=this&&this[a90_0x42efac(0x8c)]||function(_0x407244,_0x4dc925,_0x41eff0,_0x34d627){const _0x589f9e=a90_0x42efac;var _0x1f843c=arguments[_0x589f9e(0xd7)],_0x3187e9=_0x1f843c<0x3?_0x4dc925:_0x34d627===null?_0x34d627=Object['getOwnPropertyDescriptor'](_0x4dc925,_0x41eff0):_0x34d627,_0x419eca;if(typeof Reflect===_0x589f9e(0xaa)&&typeof Reflect[_0x589f9e(0xcf)]==='function')_0x3187e9=Reflect[_0x589f9e(0xcf)](_0x407244,_0x4dc925,_0x41eff0,_0x34d627);else{for(var _0x3ca532=_0x407244[_0x589f9e(0xd7)]-0x1;_0x3ca532>=0x0;_0x3ca532--)if(_0x419eca=_0x407244[_0x3ca532])_0x3187e9=(_0x1f843c<0x3?_0x419eca(_0x3187e9):_0x1f843c>0x3?_0x419eca(_0x4dc925,_0x41eff0,_0x3187e9):_0x419eca(_0x4dc925,_0x41eff0))||_0x3187e9;}return _0x1f843c>0x3&&_0x3187e9&&Object[_0x589f9e(0xb4)](_0x4dc925,_0x41eff0,_0x3187e9),_0x3187e9;},__metadata=this&&this[a90_0x42efac(0x82)]||function(_0x5ab682,_0x1ab680){const _0x159d0d=a90_0x42efac;if(typeof Reflect===_0x159d0d(0xaa)&&typeof Reflect[_0x159d0d(0x97)]===_0x159d0d(0x86))return Reflect['metadata'](_0x5ab682,_0x1ab680);},__param=this&&this[a90_0x42efac(0xa4)]||function(_0x534975,_0x336171){return function(_0x48eefe,_0x449ede){_0x336171(_0x48eefe,_0x449ede,_0x534975);};},PlaylistService_1;Object[a90_0x42efac(0xb4)](exports,a90_0x42efac(0x87),{'value':!![]}),exports[a90_0x42efac(0x92)]=void 0x0;function a90_0x10a4(){const _0x4e4f92=['removeSong','Logger','decorate','SoundGateway','InjectModel','scheduleJob','mongoose','map','playFromEvent','design:paramtypes','length','88yCKMWi','mapToDto','addSong','filter','findByIdAndDelete','222753LkRYez','\x20-\x20','__metadata','../common/job','killAll','_id','function','__esModule','Injectable','92309beRJlC','play','@nestjs/event-emitter','__decorate','soundService','Playing\x20playlist:\x20','2141862hEsWeg','assets','../common/audio/audio-player','PlaylistService','../agenda/agenda.service','findByIds','design:type','name','metadata','118GofTXh','findByIdAndUpdate','log','./mapper/playlist.mapper','Playlist','OnEvent','logger','PlayMusic','../common/path','soundGateway','JobType','soundIds','__param','broadcastPlaying','PROCESS_CACHE','1312575WHMYHG','findAll','playAsync','object','290wJhNqF','@nestjs/common','findById','7028agioXc','10356XuzpBL','create','80JqYSym','update','../sound/sound.gateway','defineProperty','PlaylistEvent','SoundService','Model','Play','audio','agendaService','playlistModel','assign','fileName','exec','findOne','../common/events','prototype','AudioPlayer','executeJob','save','delete','../common/enums','cancelJob','stop','116217pYLZJo','Play\x20Music\x20Playlist:\x20','find','join'];a90_0x10a4=function(){return _0x4e4f92;};return a90_0x10a4();}const common_1=require(a90_0x42efac(0xac)),mongoose_1=require(a90_0x42efac(0xd3)),mongoose_2=require('@nestjs/mongoose'),event_emitter_1=require(a90_0x42efac(0x8b)),sound_service_1=require('../sound/sound.service'),job_1=require(a90_0x42efac(0x83)),events_1=require(a90_0x42efac(0xc0)),agenda_service_1=require(a90_0x42efac(0x93)),playlist_mapper_1=require(a90_0x42efac(0x9b)),enums_1=require(a90_0x42efac(0xc6)),path=require('path'),path_1=require(a90_0x42efac(0xa0)),audio_player_1=require(a90_0x42efac(0x91)),sound_gateway_1=require(a90_0x42efac(0xb3));let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x3e51a1,_0x26e367,_0x2bc4dc,_0x334d81){const _0xb39fc5=a90_0x42efac;this[_0xb39fc5(0xbb)]=_0x3e51a1,this['soundService']=_0x26e367,this[_0xb39fc5(0xba)]=_0x2bc4dc,this[_0xb39fc5(0xa1)]=_0x334d81,this[_0xb39fc5(0x9e)]=new common_1[(_0xb39fc5(0xce))](PlaylistService_1[_0xb39fc5(0x96)]);}async[a90_0x42efac(0xb0)](_0x10941d){const _0x41371e=a90_0x42efac,_0x4d54e1=new this[(_0x41371e(0xbb))](_0x10941d);return _0x4d54e1[_0x41371e(0xc4)]();}async[a90_0x42efac(0xa8)](){const _0x915b14=a90_0x42efac,_0x96399b=await this[_0x915b14(0xbb)][_0x915b14(0xcb)]()[_0x915b14(0xbe)](),_0x11eb3b=_0x96399b[_0x915b14(0xd4)](async _0x46d1e7=>{const _0x590a17=_0x915b14,_0x40de0a=await this[_0x590a17(0x8d)]['findByIds'](_0x46d1e7['soundIds']);return(0x0,playlist_mapper_1['mapToDto'])(_0x46d1e7,_0x40de0a);});return await Promise['all'](_0x11eb3b);}async[a90_0x42efac(0xbf)](_0x3f4713){const _0x20f8cd=a90_0x42efac,_0x27adb8=await this[_0x20f8cd(0xbb)][_0x20f8cd(0xad)](_0x3f4713),_0x47560c=await this[_0x20f8cd(0x8d)]['findByIds'](_0x27adb8[_0x20f8cd(0xa3)]);return(0x0,playlist_mapper_1[_0x20f8cd(0xd9)])(_0x27adb8,_0x47560c);}async['update'](_0x58d76c,_0x2754f2){const _0x267820=a90_0x42efac,_0x2f99dc=await this[_0x267820(0xbb)][_0x267820(0x99)](_0x58d76c,Object[_0x267820(0xbc)](Object[_0x267820(0xbc)]({},_0x2754f2),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x3f39b9=await this[_0x267820(0x8d)]['findByIds'](_0x2f99dc[_0x267820(0xa3)]);return(0x0,playlist_mapper_1[_0x267820(0xd9)])(_0x2f99dc,_0x3f39b9);}async[a90_0x42efac(0xc5)](_0x4fa330){const _0x34f260=a90_0x42efac;return await this['playlistModel'][_0x34f260(0xdc)](_0x4fa330);}async[a90_0x42efac(0xda)](_0x33ae6a,_0x351957){const _0x1dfea8=a90_0x42efac,_0x17645e=await this[_0x1dfea8(0xbb)][_0x1dfea8(0xad)](_0x33ae6a);return _0x17645e['soundIds']['push'](_0x351957),await _0x17645e[_0x1dfea8(0xc4)]();}async[a90_0x42efac(0xcd)](_0x319822,_0x2ba08c){const _0x3d4e31=a90_0x42efac,_0x410563=await this[_0x3d4e31(0xbb)][_0x3d4e31(0xad)](_0x319822);return _0x410563[_0x3d4e31(0xa3)]=_0x410563[_0x3d4e31(0xa3)][_0x3d4e31(0xdb)](_0x30abc2=>_0x30abc2!==_0x2ba08c),await _0x410563[_0x3d4e31(0xc4)]();}async[a90_0x42efac(0x8a)](_0x242248,_0x3dd0e5){const _0x3ada81=a90_0x42efac,_0x3e5f9d={'when':'now','jobType':enums_1[_0x3ada81(0xa2)]['PlayMusic'],'attributes':{'playlistId':_0x3dd0e5},'audit':{'actor':_0x242248,'name':enums_1[_0x3ada81(0xa2)][_0x3ada81(0x9f)],'message':_0x3ada81(0xca)+_0x3dd0e5}},{jobId:_0x284690}=await this['agendaService'][_0x3ada81(0xd2)](_0x3e5f9d);return this[_0x3ada81(0xb2)](_0x3dd0e5,{'jobId':_0x284690});}async[a90_0x42efac(0xc8)](_0x5c7fe0){const _0x395814=a90_0x42efac;let _0x4c9ea6=await this[_0x395814(0xbf)](_0x5c7fe0);const {jobId:_0x2be0cf}=_0x4c9ea6||{};if(_0x2be0cf){const {success:_0x4f7630}=await this[_0x395814(0xba)][_0x395814(0xc7)](_0x2be0cf);_0x4f7630&&(_0x4c9ea6=await this[_0x395814(0xb2)](_0x5c7fe0,{'jobId':null}));}return this[_0x395814(0xa1)][_0x395814(0xa5)]({'id':_0x4c9ea6[_0x395814(0x85)],'isPlaying':![]}),_0x4c9ea6;}async['playFromEvent'](_0x46e9c3){const _0xcb212a=a90_0x42efac,{playlistId:_0x26d78d,jobId:_0xc4759b,durationInSecond:_0x27c3a0}=_0x46e9c3,_0x2742a1=await this[_0xcb212a(0xbb)][_0xcb212a(0xad)](_0x26d78d),_0x4f2959=[..._0x2742a1[_0xcb212a(0xa3)]],_0x574c98=await this[_0xcb212a(0x8d)][_0xcb212a(0x94)](_0x4f2959),_0x5831a0=_0x574c98[_0xcb212a(0xd4)](_0x4c3e11=>path[_0xcb212a(0xcc)](path_1['processRootPath'],_0xcb212a(0x90),_0xcb212a(0xb9),_0x4c3e11[_0xcb212a(0xbd)]));job_1[_0xcb212a(0xa6)][_0xcb212a(0x84)](),this['logger'][_0xcb212a(0x9a)](_0xcb212a(0x8e)+_0x26d78d+_0xcb212a(0x81)+_0x2742a1[_0xcb212a(0x96)]),(0x0,job_1[_0xcb212a(0xc3)])({'jobId':_0xc4759b,'run':()=>audio_player_1[_0xcb212a(0xc2)][_0xcb212a(0xa9)](_0x5831a0,0x32,_0x2742a1['isShuffle']),'durationInSecond':_0x27c3a0,'next':()=>this[_0xcb212a(0xc8)](_0x26d78d)}),this[_0xcb212a(0xa1)]['broadcastPlaying']({'id':_0x26d78d,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1[a90_0x42efac(0x9d)])(events_1[a90_0x42efac(0xb5)][a90_0x42efac(0xb8)]),__metadata(a90_0x42efac(0x95),Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],PlaylistService[a90_0x42efac(0xc1)],a90_0x42efac(0xd5),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a90_0x42efac(0x88)])(),__param(0x0,(0x0,mongoose_2[a90_0x42efac(0xd1)])(a90_0x42efac(0x9c))),__param(0x3,(0x0,common_1['Inject'])(sound_gateway_1[a90_0x42efac(0xd0)])),__metadata(a90_0x42efac(0xd6),[mongoose_1[a90_0x42efac(0xb7)],sound_service_1[a90_0x42efac(0xb6)],agenda_service_1['AgendaService'],sound_gateway_1[a90_0x42efac(0xd0)]])],PlaylistService),exports['PlaylistService']=PlaylistService;