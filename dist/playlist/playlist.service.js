'use strict';const a90_0x2fbafc=a90_0x118a;(function(_0x5e0e5a,_0x98d644){const _0x2d692d=a90_0x118a,_0x4d112f=_0x5e0e5a();while(!![]){try{const _0x56fe95=-parseInt(_0x2d692d(0x197))/0x1*(parseInt(_0x2d692d(0x179))/0x2)+parseInt(_0x2d692d(0x19d))/0x3+-parseInt(_0x2d692d(0x17f))/0x4*(parseInt(_0x2d692d(0x177))/0x5)+parseInt(_0x2d692d(0x1b5))/0x6*(parseInt(_0x2d692d(0x180))/0x7)+-parseInt(_0x2d692d(0x1c2))/0x8+parseInt(_0x2d692d(0x186))/0x9+parseInt(_0x2d692d(0x19f))/0xa*(parseInt(_0x2d692d(0x182))/0xb);if(_0x56fe95===_0x98d644)break;else _0x4d112f['push'](_0x4d112f['shift']());}catch(_0x5dfcfd){_0x4d112f['push'](_0x4d112f['shift']());}}}(a90_0x16ec,0xe1fce));var __decorate=this&&this[a90_0x2fbafc(0x199)]||function(_0x16f264,_0x342cfb,_0x19abd8,_0x2fe909){const _0x523f4e=a90_0x2fbafc;var _0x33f9b4=arguments[_0x523f4e(0x18c)],_0x361a1a=_0x33f9b4<0x3?_0x342cfb:_0x2fe909===null?_0x2fe909=Object['getOwnPropertyDescriptor'](_0x342cfb,_0x19abd8):_0x2fe909,_0x12e659;if(typeof Reflect==='object'&&typeof Reflect[_0x523f4e(0x17b)]===_0x523f4e(0x190))_0x361a1a=Reflect[_0x523f4e(0x17b)](_0x16f264,_0x342cfb,_0x19abd8,_0x2fe909);else{for(var _0x5a8c0e=_0x16f264[_0x523f4e(0x18c)]-0x1;_0x5a8c0e>=0x0;_0x5a8c0e--)if(_0x12e659=_0x16f264[_0x5a8c0e])_0x361a1a=(_0x33f9b4<0x3?_0x12e659(_0x361a1a):_0x33f9b4>0x3?_0x12e659(_0x342cfb,_0x19abd8,_0x361a1a):_0x12e659(_0x342cfb,_0x19abd8))||_0x361a1a;}return _0x33f9b4>0x3&&_0x361a1a&&Object[_0x523f4e(0x1c7)](_0x342cfb,_0x19abd8,_0x361a1a),_0x361a1a;},__metadata=this&&this['__metadata']||function(_0x5866e1,_0x2133c7){const _0x511817=a90_0x2fbafc;if(typeof Reflect===_0x511817(0x18a)&&typeof Reflect[_0x511817(0x18d)]==='function')return Reflect['metadata'](_0x5866e1,_0x2133c7);},__param=this&&this[a90_0x2fbafc(0x191)]||function(_0x34483b,_0x13feb8){return function(_0x1a094f,_0x17a4ef){_0x13feb8(_0x1a094f,_0x17a4ef,_0x34483b);};},PlaylistService_1;Object[a90_0x2fbafc(0x1c7)](exports,a90_0x2fbafc(0x17d),{'value':!![]}),exports[a90_0x2fbafc(0x1ba)]=void 0x0;function a90_0x118a(_0x1cb749,_0x4857a1){const _0x16ec60=a90_0x16ec();return a90_0x118a=function(_0x118ab7,_0x1bb4e8){_0x118ab7=_0x118ab7-0x175;let _0x308ccd=_0x16ec60[_0x118ab7];return _0x308ccd;},a90_0x118a(_0x1cb749,_0x4857a1);}function a90_0x16ec(){const _0x5dcd4b=['fileName','48700KhZiHn','3899knhZzu','design:type','11huAMFU','exec','findByIds','assets','9269757VzGSxQ','soundGateway','find','mapToDto','object','InjectModel','length','metadata','SoundGateway','save','function','__param','playFromEvent','processRootPath','cancelJob','PlaylistEvent','name','5186AzxPMn','playlistModel','__decorate','../common/events','stop','broadcastPlaying','2304183kMCKQv','../agenda/agenda.service','7002410gZXUoL','OnEvent','_id','now','create','log','\x20-\x20','filter','PlayMusic','findById','../common/path','findByIdAndUpdate','findOne','design:returntype','agendaService','scheduleJob','JobType','join','soundIds','design:paramtypes','../sound/sound.gateway','play','13038UpvRgh','Injectable','soundService','isShuffle','assign','PlaylistService','./mapper/playlist.mapper','removeSong','findByIdAndDelete','logger','@nestjs/event-emitter','push','Playlist','7110856wxggyf','update','AgendaService','../common/enums','playAsync','defineProperty','delete','PROCESS_CACHE','665xtyJBy','path','106QBJoHI','all','decorate','../common/audio/audio-player','__esModule'];a90_0x16ec=function(){return _0x5dcd4b;};return a90_0x16ec();}const common_1=require('@nestjs/common'),mongoose_1=require('mongoose'),mongoose_2=require('@nestjs/mongoose'),event_emitter_1=require(a90_0x2fbafc(0x1bf)),sound_service_1=require('../sound/sound.service'),job_1=require('../common/job'),events_1=require(a90_0x2fbafc(0x19a)),agenda_service_1=require(a90_0x2fbafc(0x19e)),playlist_mapper_1=require(a90_0x2fbafc(0x1bb)),enums_1=require(a90_0x2fbafc(0x1c5)),path=require(a90_0x2fbafc(0x178)),path_1=require(a90_0x2fbafc(0x1a9)),audio_player_1=require(a90_0x2fbafc(0x17c)),sound_gateway_1=require(a90_0x2fbafc(0x1b3));let PlaylistService=PlaylistService_1=class PlaylistService{constructor(_0x331cc4,_0x3936ad,_0x39c30a,_0x260fef){const _0x3c0d23=a90_0x2fbafc;this[_0x3c0d23(0x198)]=_0x331cc4,this['soundService']=_0x3936ad,this[_0x3c0d23(0x1ad)]=_0x39c30a,this[_0x3c0d23(0x187)]=_0x260fef,this[_0x3c0d23(0x1be)]=new common_1['Logger'](PlaylistService_1[_0x3c0d23(0x196)]);}async[a90_0x2fbafc(0x1a3)](_0x583722){const _0x16125d=a90_0x2fbafc,_0x22025f=new this[(_0x16125d(0x198))](_0x583722);return _0x22025f[_0x16125d(0x18f)]();}async['findAll'](){const _0x1988b8=a90_0x2fbafc,_0x3b017f=await this['playlistModel'][_0x1988b8(0x188)]()[_0x1988b8(0x183)](),_0x32b878=_0x3b017f['map'](async _0x5f4cd9=>{const _0x3b5fba=_0x1988b8,_0x569d40=await this['soundService'][_0x3b5fba(0x184)](_0x5f4cd9['soundIds']);return(0x0,playlist_mapper_1['mapToDto'])(_0x5f4cd9,_0x569d40);});return await Promise[_0x1988b8(0x17a)](_0x32b878);}async[a90_0x2fbafc(0x1ab)](_0x2e40a3){const _0x60b3f=a90_0x2fbafc,_0x528319=await this[_0x60b3f(0x198)][_0x60b3f(0x1a8)](_0x2e40a3),_0x39ceb7=await this[_0x60b3f(0x1b7)]['findByIds'](_0x528319['soundIds']);return(0x0,playlist_mapper_1[_0x60b3f(0x189)])(_0x528319,_0x39ceb7);}async[a90_0x2fbafc(0x1c3)](_0x41a64e,_0x17cc57){const _0x181dfe=a90_0x2fbafc,_0x4f3017=await this[_0x181dfe(0x198)][_0x181dfe(0x1aa)](_0x41a64e,Object['assign'](Object[_0x181dfe(0x1b9)]({},_0x17cc57),{'updatedAtUtc':new Date()}),{'new':!![]}),_0x1236a3=await this[_0x181dfe(0x1b7)][_0x181dfe(0x184)](_0x4f3017[_0x181dfe(0x1b1)]);return(0x0,playlist_mapper_1['mapToDto'])(_0x4f3017,_0x1236a3);}async[a90_0x2fbafc(0x175)](_0x182c53){const _0x14ad41=a90_0x2fbafc;return await this[_0x14ad41(0x198)][_0x14ad41(0x1bd)](_0x182c53);}async['addSong'](_0x5a42c3,_0xa91b55){const _0x291c02=a90_0x2fbafc,_0x4b6cfd=await this[_0x291c02(0x198)][_0x291c02(0x1a8)](_0x5a42c3);return _0x4b6cfd[_0x291c02(0x1b1)][_0x291c02(0x1c0)](_0xa91b55),await _0x4b6cfd['save']();}async[a90_0x2fbafc(0x1bc)](_0x17cf86,_0x198599){const _0x5b08b3=a90_0x2fbafc,_0x498d10=await this[_0x5b08b3(0x198)]['findById'](_0x17cf86);return _0x498d10['soundIds']=_0x498d10[_0x5b08b3(0x1b1)][_0x5b08b3(0x1a6)](_0x4e8d75=>_0x4e8d75!==_0x198599),await _0x498d10[_0x5b08b3(0x18f)]();}async[a90_0x2fbafc(0x1b4)](_0x4ac640,_0x3b766a){const _0x49a287=a90_0x2fbafc,_0x1cd1a4={'when':_0x49a287(0x1a2),'jobType':enums_1[_0x49a287(0x1af)][_0x49a287(0x1a7)],'attributes':{'playlistId':_0x3b766a},'audit':{'actor':_0x4ac640,'name':enums_1[_0x49a287(0x1af)]['PlayMusic'],'message':'Play\x20Music\x20Playlist:\x20'+_0x3b766a}},{jobId:_0x435c35}=await this[_0x49a287(0x1ad)][_0x49a287(0x1ae)](_0x1cd1a4);return this['update'](_0x3b766a,{'jobId':_0x435c35});}async['stop'](_0x35c9aa){const _0x3c3309=a90_0x2fbafc;let _0x451e05=await this[_0x3c3309(0x1ab)](_0x35c9aa);const {jobId:_0x34c078}=_0x451e05||{};if(_0x34c078){const {success:_0x115bfc}=await this[_0x3c3309(0x1ad)][_0x3c3309(0x194)](_0x34c078);_0x115bfc&&(_0x451e05=await this[_0x3c3309(0x1c3)](_0x35c9aa,{'jobId':null}));}return this[_0x3c3309(0x187)]['broadcastPlaying']({'id':_0x451e05[_0x3c3309(0x1a1)],'isPlaying':![]}),_0x451e05;}async[a90_0x2fbafc(0x192)](_0x130e89){const _0xabf5d2=a90_0x2fbafc,{playlistId:_0x14f6aa,jobId:_0x264b8e,durationInSecond:_0x1f0ba1}=_0x130e89,_0x12055b=await this[_0xabf5d2(0x198)][_0xabf5d2(0x1a8)](_0x14f6aa),_0x371389=[..._0x12055b['soundIds']],_0x31bf83=await this[_0xabf5d2(0x1b7)]['findByIds'](_0x371389),_0x36b0cc=_0x31bf83['map'](_0x3aeac1=>path[_0xabf5d2(0x1b0)](path_1[_0xabf5d2(0x193)],_0xabf5d2(0x185),'audio',_0x3aeac1[_0xabf5d2(0x17e)]));job_1[_0xabf5d2(0x176)]['killAll'](),this['logger'][_0xabf5d2(0x1a4)]('Playing\x20playlist:\x20'+_0x14f6aa+_0xabf5d2(0x1a5)+_0x12055b['name']),(0x0,job_1['executeJob'])({'jobId':_0x264b8e,'run':()=>audio_player_1['AudioPlayer'][_0xabf5d2(0x1c6)](_0x36b0cc,0x32,_0x12055b[_0xabf5d2(0x1b8)]),'durationInSecond':_0x1f0ba1,'next':()=>this[_0xabf5d2(0x19b)](_0x14f6aa)}),this[_0xabf5d2(0x187)][_0xabf5d2(0x19c)]({'id':_0x14f6aa,'isPlaying':!![]});}};__decorate([(0x0,event_emitter_1[a90_0x2fbafc(0x1a0)])(events_1[a90_0x2fbafc(0x195)]['Play']),__metadata(a90_0x2fbafc(0x181),Function),__metadata(a90_0x2fbafc(0x1b2),[Object]),__metadata(a90_0x2fbafc(0x1ac),Promise)],PlaylistService['prototype'],a90_0x2fbafc(0x192),null),PlaylistService=PlaylistService_1=__decorate([(0x0,common_1[a90_0x2fbafc(0x1b6)])(),__param(0x0,(0x0,mongoose_2[a90_0x2fbafc(0x18b)])(a90_0x2fbafc(0x1c1))),__param(0x3,(0x0,common_1['Inject'])(sound_gateway_1[a90_0x2fbafc(0x18e)])),__metadata('design:paramtypes',[mongoose_1['Model'],sound_service_1['SoundService'],agenda_service_1[a90_0x2fbafc(0x1c4)],sound_gateway_1[a90_0x2fbafc(0x18e)]])],PlaylistService),exports['PlaylistService']=PlaylistService;