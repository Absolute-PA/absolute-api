'use strict';const a79_0x46301a=a79_0xdbea;(function(_0x3164ce,_0x963d52){const _0x57a99e=a79_0xdbea,_0x5580dd=_0x3164ce();while(!![]){try{const _0x4a2776=-parseInt(_0x57a99e(0x1eb))/0x1*(parseInt(_0x57a99e(0x21e))/0x2)+parseInt(_0x57a99e(0x1e3))/0x3*(-parseInt(_0x57a99e(0x1fc))/0x4)+-parseInt(_0x57a99e(0x22e))/0x5+-parseInt(_0x57a99e(0x1e1))/0x6*(parseInt(_0x57a99e(0x1f5))/0x7)+parseInt(_0x57a99e(0x209))/0x8*(-parseInt(_0x57a99e(0x229))/0x9)+-parseInt(_0x57a99e(0x22c))/0xa*(-parseInt(_0x57a99e(0x1e2))/0xb)+parseInt(_0x57a99e(0x1de))/0xc;if(_0x4a2776===_0x963d52)break;else _0x5580dd['push'](_0x5580dd['shift']());}catch(_0xf6302){_0x5580dd['push'](_0x5580dd['shift']());}}}(a79_0x4493,0x549c2));var __decorate=this&&this[a79_0x46301a(0x1fb)]||function(_0x2875d3,_0xf15efb,_0x1acd22,_0x1eaeac){const _0x3779f4=a79_0x46301a;var _0x56fda1=arguments[_0x3779f4(0x1f0)],_0x126c03=_0x56fda1<0x3?_0xf15efb:_0x1eaeac===null?_0x1eaeac=Object[_0x3779f4(0x234)](_0xf15efb,_0x1acd22):_0x1eaeac,_0x351e4e;if(typeof Reflect===_0x3779f4(0x1ea)&&typeof Reflect[_0x3779f4(0x210)]===_0x3779f4(0x1f3))_0x126c03=Reflect[_0x3779f4(0x210)](_0x2875d3,_0xf15efb,_0x1acd22,_0x1eaeac);else{for(var _0x66319f=_0x2875d3[_0x3779f4(0x1f0)]-0x1;_0x66319f>=0x0;_0x66319f--)if(_0x351e4e=_0x2875d3[_0x66319f])_0x126c03=(_0x56fda1<0x3?_0x351e4e(_0x126c03):_0x56fda1>0x3?_0x351e4e(_0xf15efb,_0x1acd22,_0x126c03):_0x351e4e(_0xf15efb,_0x1acd22))||_0x126c03;}return _0x56fda1>0x3&&_0x126c03&&Object['defineProperty'](_0xf15efb,_0x1acd22,_0x126c03),_0x126c03;},__metadata=this&&this[a79_0x46301a(0x1e0)]||function(_0x23f193,_0x2cedd1){const _0x5c7e6d=a79_0x46301a;if(typeof Reflect===_0x5c7e6d(0x1ea)&&typeof Reflect[_0x5c7e6d(0x1ef)]===_0x5c7e6d(0x1f3))return Reflect[_0x5c7e6d(0x1ef)](_0x23f193,_0x2cedd1);},EmailService_1;Object[a79_0x46301a(0x1ff)](exports,a79_0x46301a(0x21f),{'value':!![]}),exports[a79_0x46301a(0x22d)]=void 0x0;function a79_0x4493(){const _0x5307f6=['@nestjs/common','SMTP_PASS','function','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20URL:</strong>\x20','3067309yziAHA','Logger','SMTP_FROM','toISOString','</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Body:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','SMTP_PORT','__decorate','305616rRLWKc','Email\x20not\x20configured,\x20skipping\x20exception\x20notification','url','defineProperty','error','getDeviceName','Email\x20configuration\x20not\x20found.\x20Exceptions\x20will\x20be\x20sent\x20to\x20default\x20address.','Failed\x20to\x20send\x20exception\x20notification\x20email:','\x0aTimestamp:\x20','\x0aRequest\x20Method:\x20','\x22Exception\x20Notifier\x22\x20<no-reply@absolutepa.com>','createTransport','piName','120oJuFiv','\x0a\x0aRequest\x20Body:\x0a','\x0aRequest\x20URL:\x20','stringify','Failed\x20to\x20get\x20device\x20name\x20from\x20SettingService,\x20falling\x20back\x20to\x20details.piName\x20or\x20default.','SMTP_USER','body','decorate','exdyrljbopqilckb',']\x20Unhandled\x20Exception\x20Occurred','defaultToEmail','SettingService','dev.absolutepa@gmail.com','\x0aUnhandled\x20Exception\x20Notification\x0a\x0aDevice:\x20','design:paramtypes','EXCEPTION_NOTIFY_EMAIL','method','formatExceptionEmailHtml','Unknown\x20Device','transporter','\x0a\x20\x20\x20\x20\x20\x20<h2>Unhandled\x20Exception\x20Notification</h2>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Device:</strong>\x20','7778pTMTxP','__esModule','true','\x0a\x20\x20\x20\x20','cachedDeviceName','findFirst','trim','N/A','createTransporter','onModuleInit','dev.absolutepa@gmail.com,service@absolutepa.com.au','88119aDfoEI','timestamp','</p>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Exception\x20Message:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','35990DggQdf','EmailService','589235CLZrWW','_settingService','message','logger','isEmailConfigured','587','getOwnPropertyDescriptor','../setting/setting.service','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20Method:</strong>\x20','18135576MaaAcA','SMTP_HOST','__metadata','6NNcPBF','572VmJIBr','18hanwAN','warn','</pre>\x0a\x20\x20\x20\x20','\x0a\x0aException\x20Message:\x0a','name','Failed\x20to\x20cache\x20device\x20name\x20on\x20startup.','SMTP_SECURE','object','49UWtvFM','env','headers','schoolId','metadata','length'];a79_0x4493=function(){return _0x5307f6;};return a79_0x4493();}const common_1=require(a79_0x46301a(0x1f1)),nodemailer=require('nodemailer'),setting_service_1=require(a79_0x46301a(0x1dc));function a79_0xdbea(_0x516935,_0x3d64d4){const _0x449320=a79_0x4493();return a79_0xdbea=function(_0xdbea74,_0x2f7063){_0xdbea74=_0xdbea74-0x1dc;let _0x4c2d0a=_0x449320[_0xdbea74];return _0x4c2d0a;},a79_0xdbea(_0x516935,_0x3d64d4);}let EmailService=EmailService_1=class EmailService{constructor(_0x449902){const _0x7e04dc=a79_0x46301a;this['_settingService']=_0x449902,this[_0x7e04dc(0x231)]=new common_1[(_0x7e04dc(0x1f6))](EmailService_1[_0x7e04dc(0x1e7)]),this['defaultToEmail']=_0x7e04dc(0x228),this['cachedDeviceName']=null,this['createTransporter']();}async[a79_0x46301a(0x227)](){const _0x41a08d=a79_0x46301a;try{const _0x5d977d=await this[_0x41a08d(0x22f)][_0x41a08d(0x223)]();this[_0x41a08d(0x222)]=(_0x5d977d===null||_0x5d977d===void 0x0?void 0x0:_0x5d977d[_0x41a08d(0x1ee)])||null;}catch(_0x7a3f61){this[_0x41a08d(0x231)][_0x41a08d(0x1e4)](_0x41a08d(0x1e8)),this['cachedDeviceName']=null;}}[a79_0x46301a(0x226)](){const _0x121ac3=a79_0x46301a;this['isEmailConfigured']()?this['transporter']=nodemailer['createTransport']({'host':process[_0x121ac3(0x1ec)][_0x121ac3(0x1df)],'port':parseInt(process[_0x121ac3(0x1ec)][_0x121ac3(0x1fa)]||_0x121ac3(0x233)),'secure':process[_0x121ac3(0x1ec)][_0x121ac3(0x1e9)]===_0x121ac3(0x220),'auth':{'user':process['env'][_0x121ac3(0x20e)],'pass':process[_0x121ac3(0x1ec)][_0x121ac3(0x1f2)]}}):(this[_0x121ac3(0x231)][_0x121ac3(0x1e4)](_0x121ac3(0x202)),this[_0x121ac3(0x21c)]=nodemailer[_0x121ac3(0x207)]({'host':'smtp.gmail.com','port':0x24b,'secure':![],'auth':{'user':_0x121ac3(0x215),'pass':_0x121ac3(0x211)}}));}[a79_0x46301a(0x232)](){const _0x1b8233=a79_0x46301a;return!!(process[_0x1b8233(0x1ec)]['SMTP_HOST']&&process[_0x1b8233(0x1ec)][_0x1b8233(0x20e)]&&process[_0x1b8233(0x1ec)][_0x1b8233(0x1f2)]&&process['env'][_0x1b8233(0x218)]);}async['sendExceptionNotification'](_0x2ee39a){const _0x2d517f=a79_0x46301a;if(!this[_0x2d517f(0x21c)]){this[_0x2d517f(0x231)]['debug'](_0x2d517f(0x1fd));return;}const _0x14bd23=await this[_0x2d517f(0x201)](_0x2ee39a);try{const _0x224013=this['formatExceptionEmail'](_0x2ee39a,_0x14bd23);await this[_0x2d517f(0x21c)]['sendMail']({'from':process[_0x2d517f(0x1ec)][_0x2d517f(0x1f7)]||_0x2d517f(0x206),'to':process[_0x2d517f(0x1ec)][_0x2d517f(0x218)]||this[_0x2d517f(0x213)],'subject':'['+_0x14bd23+_0x2d517f(0x212),'text':_0x224013,'html':this[_0x2d517f(0x21a)](_0x2ee39a,_0x14bd23)}),this[_0x2d517f(0x231)]['log']('Exception\x20notification\x20email\x20sent\x20successfully');}catch(_0x2590cc){this[_0x2d517f(0x231)][_0x2d517f(0x200)](_0x2d517f(0x203),_0x2590cc);}}['formatExceptionEmail'](_0x6cdfc6,_0xa91936){const _0x526d2f=a79_0x46301a;return(_0x526d2f(0x216)+_0xa91936+_0x526d2f(0x204)+(_0x6cdfc6[_0x526d2f(0x22a)]||new Date()[_0x526d2f(0x1f8)]())+_0x526d2f(0x20b)+(_0x6cdfc6['url']||_0x526d2f(0x225))+_0x526d2f(0x205)+(_0x6cdfc6['method']||_0x526d2f(0x225))+_0x526d2f(0x1e6)+_0x6cdfc6[_0x526d2f(0x230)]+_0x526d2f(0x20a)+(_0x6cdfc6[_0x526d2f(0x20f)]?JSON[_0x526d2f(0x20c)](_0x6cdfc6['body'],null,0x2):'N/A')+'\x0a\x0aRequest\x20Headers:\x0a'+(_0x6cdfc6[_0x526d2f(0x1ed)]?JSON[_0x526d2f(0x20c)](_0x6cdfc6[_0x526d2f(0x1ed)],null,0x2):_0x526d2f(0x225))+_0x526d2f(0x221))[_0x526d2f(0x224)]();}[a79_0x46301a(0x21a)](_0x23ac3d,_0x493ff9){const _0xf09f3a=a79_0x46301a;return _0xf09f3a(0x21d)+_0x493ff9+'</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Timestamp:</strong>\x20'+(_0x23ac3d['timestamp']||new Date()[_0xf09f3a(0x1f8)]())+_0xf09f3a(0x1f4)+(_0x23ac3d[_0xf09f3a(0x1fe)]||_0xf09f3a(0x225))+_0xf09f3a(0x1dd)+(_0x23ac3d[_0xf09f3a(0x219)]||'N/A')+_0xf09f3a(0x22b)+_0x23ac3d[_0xf09f3a(0x230)]+_0xf09f3a(0x1f9)+(_0x23ac3d['body']?JSON['stringify'](_0x23ac3d[_0xf09f3a(0x20f)],null,0x2):_0xf09f3a(0x225))+'</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Headers:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>'+(_0x23ac3d['headers']?JSON[_0xf09f3a(0x20c)](_0x23ac3d['headers'],null,0x2):_0xf09f3a(0x225))+_0xf09f3a(0x1e5);}async[a79_0x46301a(0x201)](_0xd7fa55){const _0x500d90=a79_0x46301a;if(this['cachedDeviceName'])return this['cachedDeviceName'];try{const _0x2b7506=await this[_0x500d90(0x22f)][_0x500d90(0x223)]();return(_0x2b7506===null||_0x2b7506===void 0x0?void 0x0:_0x2b7506[_0x500d90(0x1ee)])||_0xd7fa55[_0x500d90(0x208)]||_0x500d90(0x21b);}catch(_0x479e1f){return this[_0x500d90(0x231)][_0x500d90(0x1e4)](_0x500d90(0x20d)),_0xd7fa55[_0x500d90(0x208)]||_0x500d90(0x21b);}}};EmailService=EmailService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(a79_0x46301a(0x217),[setting_service_1[a79_0x46301a(0x214)]])],EmailService),exports[a79_0x46301a(0x22d)]=EmailService;