'use strict';const a79_0x5512d9=a79_0x74c2;(function(_0x303c3a,_0x2a91f3){const _0x3fb5cc=a79_0x74c2,_0xc60433=_0x303c3a();while(!![]){try{const _0x41be02=-parseInt(_0x3fb5cc(0x17c))/0x1+parseInt(_0x3fb5cc(0x1bf))/0x2+parseInt(_0x3fb5cc(0x19e))/0x3+parseInt(_0x3fb5cc(0x192))/0x4+-parseInt(_0x3fb5cc(0x19f))/0x5+parseInt(_0x3fb5cc(0x1bb))/0x6*(-parseInt(_0x3fb5cc(0x1b3))/0x7)+parseInt(_0x3fb5cc(0x1ac))/0x8*(parseInt(_0x3fb5cc(0x18f))/0x9);if(_0x41be02===_0x2a91f3)break;else _0xc60433['push'](_0xc60433['shift']());}catch(_0x535943){_0xc60433['push'](_0xc60433['shift']());}}}(a79_0x7932,0x88abd));function a79_0x74c2(_0x1ffa30,_0x4ed6e6){const _0x7932e4=a79_0x7932();return a79_0x74c2=function(_0x74c2a2,_0x56cb54){_0x74c2a2=_0x74c2a2-0x174;let _0x54fcc9=_0x7932e4[_0x74c2a2];return _0x54fcc9;},a79_0x74c2(_0x1ffa30,_0x4ed6e6);}var __decorate=this&&this[a79_0x5512d9(0x1ba)]||function(_0x11262a,_0x53ac92,_0x20a323,_0x233600){const _0x3d6b90=a79_0x5512d9;var _0x3eab67=arguments[_0x3d6b90(0x1c6)],_0x5d1139=_0x3eab67<0x3?_0x53ac92:_0x233600===null?_0x233600=Object[_0x3d6b90(0x187)](_0x53ac92,_0x20a323):_0x233600,_0x27e272;if(typeof Reflect===_0x3d6b90(0x1be)&&typeof Reflect[_0x3d6b90(0x1b5)]==='function')_0x5d1139=Reflect[_0x3d6b90(0x1b5)](_0x11262a,_0x53ac92,_0x20a323,_0x233600);else{for(var _0x389d76=_0x11262a[_0x3d6b90(0x1c6)]-0x1;_0x389d76>=0x0;_0x389d76--)if(_0x27e272=_0x11262a[_0x389d76])_0x5d1139=(_0x3eab67<0x3?_0x27e272(_0x5d1139):_0x3eab67>0x3?_0x27e272(_0x53ac92,_0x20a323,_0x5d1139):_0x27e272(_0x53ac92,_0x20a323))||_0x5d1139;}return _0x3eab67>0x3&&_0x5d1139&&Object[_0x3d6b90(0x1bd)](_0x53ac92,_0x20a323,_0x5d1139),_0x5d1139;},__metadata=this&&this[a79_0x5512d9(0x180)]||function(_0x3ba4b8,_0xb09bd6){const _0x16a3c0=a79_0x5512d9;if(typeof Reflect===_0x16a3c0(0x1be)&&typeof Reflect[_0x16a3c0(0x1a2)]===_0x16a3c0(0x19d))return Reflect[_0x16a3c0(0x1a2)](_0x3ba4b8,_0xb09bd6);},EmailService_1;Object[a79_0x5512d9(0x1bd)](exports,'__esModule',{'value':!![]}),exports[a79_0x5512d9(0x18b)]=void 0x0;const common_1=require('@nestjs/common'),nodemailer=require('nodemailer'),setting_service_1=require(a79_0x5512d9(0x17a));function a79_0x7932(){const _0x59c026=['</p>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Exception\x20Message:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','length','defaultToEmail','</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Body:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Timestamp:</strong>\x20','Logger','warn','createTransport','exdyrljbopqilckb','error','schoolId','../setting/setting.service',']\x20Unhandled\x20Exception\x20Occurred','777780fhCcfi','Injectable','toISOString','\x22Exception\x20Notifier\x22\x20<no-reply@absolutepa.com>','__metadata','body','findFirst','\x0aTimestamp:\x20','Failed\x20to\x20get\x20device\x20name\x20from\x20SettingService,\x20falling\x20back\x20to\x20details.piName\x20or\x20default.','Failed\x20to\x20send\x20exception\x20notification\x20email:','\x0a\x20\x20\x20\x20','getOwnPropertyDescriptor','name','N/A','isEmailConfigured','EmailService','design:paramtypes','env','</pre>\x0a\x20\x20\x20\x20','369PAyJVE','transporter','true','3067940sxrXGs','formatExceptionEmailHtml','\x0aRequest\x20URL:\x20','debug','dev.absolutepa@gmail.com,service@absolutepa.com.au','getDeviceName','onModuleInit','message','createTransporter','logger','\x0aRequest\x20Method:\x20','function','1277544YCLqan','5566980dlDYNy','SMTP_HOST','url','metadata','587','headers','cachedDeviceName','_settingService','Exception\x20notification\x20email\x20sent\x20successfully','formatExceptionEmail','\x0a\x0aException\x20Message:\x0a','SMTP_PASS','log','97832JPIDRm','dev.absolutepa@gmail.com','trim','piName','\x0a\x0aRequest\x20Headers:\x0a','SMTP_USER','sendExceptionNotification','761649MCHljT','Unknown\x20Device','decorate','smtp.gmail.com','method','SMTP_FROM','sendMail','__decorate','18eAtdxV','timestamp','defineProperty','object','2166360VSGhVI','Email\x20configuration\x20not\x20found.\x20Exceptions\x20will\x20be\x20sent\x20to\x20default\x20address.','SMTP_PORT','\x0aUnhandled\x20Exception\x20Notification\x0a\x0aDevice:\x20','stringify','\x0a\x20\x20\x20\x20\x20\x20<h2>Unhandled\x20Exception\x20Notification</h2>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Device:</strong>\x20'];a79_0x7932=function(){return _0x59c026;};return a79_0x7932();}let EmailService=EmailService_1=class EmailService{constructor(_0xa037d0){const _0xe3d2a9=a79_0x5512d9;this[_0xe3d2a9(0x1a6)]=_0xa037d0,this[_0xe3d2a9(0x19b)]=new common_1[(_0xe3d2a9(0x174))](EmailService_1[_0xe3d2a9(0x188)]),this[_0xe3d2a9(0x1c7)]=_0xe3d2a9(0x196),this[_0xe3d2a9(0x1a5)]=null,this[_0xe3d2a9(0x19a)]();}async[a79_0x5512d9(0x198)](){const _0x444e35=a79_0x5512d9;try{const _0x151dd0=await this[_0x444e35(0x1a6)][_0x444e35(0x182)]();this[_0x444e35(0x1a5)]=(_0x151dd0===null||_0x151dd0===void 0x0?void 0x0:_0x151dd0['schoolId'])||null;}catch(_0x163bd1){this[_0x444e35(0x19b)][_0x444e35(0x175)]('Failed\x20to\x20cache\x20device\x20name\x20on\x20startup.'),this['cachedDeviceName']=null;}}[a79_0x5512d9(0x19a)](){const _0x37e3bb=a79_0x5512d9;this[_0x37e3bb(0x18a)]()?this[_0x37e3bb(0x190)]=nodemailer[_0x37e3bb(0x176)]({'host':process['env']['SMTP_HOST'],'port':parseInt(process[_0x37e3bb(0x18d)][_0x37e3bb(0x1c1)]||_0x37e3bb(0x1a3)),'secure':process['env']['SMTP_SECURE']===_0x37e3bb(0x191),'auth':{'user':process[_0x37e3bb(0x18d)][_0x37e3bb(0x1b1)],'pass':process[_0x37e3bb(0x18d)][_0x37e3bb(0x1aa)]}}):(this[_0x37e3bb(0x19b)][_0x37e3bb(0x175)](_0x37e3bb(0x1c0)),this[_0x37e3bb(0x190)]=nodemailer['createTransport']({'host':_0x37e3bb(0x1b6),'port':0x24b,'secure':![],'auth':{'user':_0x37e3bb(0x1ad),'pass':_0x37e3bb(0x177)}}));}[a79_0x5512d9(0x18a)](){const _0x3ec0ac=a79_0x5512d9;return!!(process['env'][_0x3ec0ac(0x1a0)]&&process[_0x3ec0ac(0x18d)][_0x3ec0ac(0x1b1)]&&process[_0x3ec0ac(0x18d)][_0x3ec0ac(0x1aa)]&&process[_0x3ec0ac(0x18d)]['EXCEPTION_NOTIFY_EMAIL']);}async[a79_0x5512d9(0x1b2)](_0x29e96c){const _0x189475=a79_0x5512d9;if(!this[_0x189475(0x190)]){this[_0x189475(0x19b)][_0x189475(0x195)]('Email\x20not\x20configured,\x20skipping\x20exception\x20notification');return;}const _0x21c39c=await this[_0x189475(0x197)](_0x29e96c);try{const _0x64e6fb=this[_0x189475(0x1a8)](_0x29e96c,_0x21c39c);await this[_0x189475(0x190)][_0x189475(0x1b9)]({'from':process[_0x189475(0x18d)][_0x189475(0x1b8)]||_0x189475(0x17f),'to':process[_0x189475(0x18d)]['EXCEPTION_NOTIFY_EMAIL']||this[_0x189475(0x1c7)],'subject':'['+_0x21c39c+_0x189475(0x17b),'text':_0x64e6fb,'html':this['formatExceptionEmailHtml'](_0x29e96c,_0x21c39c)}),this[_0x189475(0x19b)][_0x189475(0x1ab)](_0x189475(0x1a7));}catch(_0x5b2123){this[_0x189475(0x19b)][_0x189475(0x178)](_0x189475(0x185),_0x5b2123);}}[a79_0x5512d9(0x1a8)](_0x89db3c,_0x3e3671){const _0x5474ff=a79_0x5512d9;return(_0x5474ff(0x1c2)+_0x3e3671+_0x5474ff(0x183)+(_0x89db3c[_0x5474ff(0x1bc)]||new Date()[_0x5474ff(0x17e)]())+_0x5474ff(0x194)+(_0x89db3c[_0x5474ff(0x1a1)]||_0x5474ff(0x189))+_0x5474ff(0x19c)+(_0x89db3c[_0x5474ff(0x1b7)]||_0x5474ff(0x189))+_0x5474ff(0x1a9)+_0x89db3c[_0x5474ff(0x199)]+'\x0a\x0aRequest\x20Body:\x0a'+(_0x89db3c[_0x5474ff(0x181)]?JSON[_0x5474ff(0x1c3)](_0x89db3c[_0x5474ff(0x181)],null,0x2):_0x5474ff(0x189))+_0x5474ff(0x1b0)+(_0x89db3c['headers']?JSON[_0x5474ff(0x1c3)](_0x89db3c[_0x5474ff(0x1a4)],null,0x2):_0x5474ff(0x189))+_0x5474ff(0x186))[_0x5474ff(0x1ae)]();}[a79_0x5512d9(0x193)](_0x1760ec,_0x1aeecd){const _0x417e5a=a79_0x5512d9;return _0x417e5a(0x1c4)+_0x1aeecd+_0x417e5a(0x1c9)+(_0x1760ec[_0x417e5a(0x1bc)]||new Date()[_0x417e5a(0x17e)]())+'</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20URL:</strong>\x20'+(_0x1760ec[_0x417e5a(0x1a1)]||_0x417e5a(0x189))+'</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20Method:</strong>\x20'+(_0x1760ec[_0x417e5a(0x1b7)]||_0x417e5a(0x189))+_0x417e5a(0x1c5)+_0x1760ec[_0x417e5a(0x199)]+_0x417e5a(0x1c8)+(_0x1760ec['body']?JSON['stringify'](_0x1760ec['body'],null,0x2):_0x417e5a(0x189))+'</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Headers:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>'+(_0x1760ec[_0x417e5a(0x1a4)]?JSON[_0x417e5a(0x1c3)](_0x1760ec[_0x417e5a(0x1a4)],null,0x2):'N/A')+_0x417e5a(0x18e);}async[a79_0x5512d9(0x197)](_0x241253){const _0x2ac5bd=a79_0x5512d9;if(this[_0x2ac5bd(0x1a5)])return this[_0x2ac5bd(0x1a5)];try{const _0x2ede5d=await this[_0x2ac5bd(0x1a6)][_0x2ac5bd(0x182)]();return(_0x2ede5d===null||_0x2ede5d===void 0x0?void 0x0:_0x2ede5d[_0x2ac5bd(0x179)])||_0x241253['piName']||_0x2ac5bd(0x1b4);}catch(_0x3757e0){return this[_0x2ac5bd(0x19b)][_0x2ac5bd(0x175)](_0x2ac5bd(0x184)),_0x241253[_0x2ac5bd(0x1af)]||_0x2ac5bd(0x1b4);}}};EmailService=EmailService_1=__decorate([(0x0,common_1[a79_0x5512d9(0x17d)])(),__metadata(a79_0x5512d9(0x18c),[setting_service_1['SettingService']])],EmailService),exports[a79_0x5512d9(0x18b)]=EmailService;