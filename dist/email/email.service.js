'use strict';const a79_0x2ed5b1=a79_0x3cf5;(function(_0x11610a,_0x1c79bf){const _0xb8c603=a79_0x3cf5,_0x47b7fa=_0x11610a();while(!![]){try{const _0x15e36c=-parseInt(_0xb8c603(0x1d4))/0x1*(parseInt(_0xb8c603(0x1f6))/0x2)+-parseInt(_0xb8c603(0x1d1))/0x3+-parseInt(_0xb8c603(0x1d3))/0x4+parseInt(_0xb8c603(0x211))/0x5*(-parseInt(_0xb8c603(0x1fe))/0x6)+-parseInt(_0xb8c603(0x1ca))/0x7+-parseInt(_0xb8c603(0x1d2))/0x8*(-parseInt(_0xb8c603(0x215))/0x9)+parseInt(_0xb8c603(0x1ce))/0xa;if(_0x15e36c===_0x1c79bf)break;else _0x47b7fa['push'](_0x47b7fa['shift']());}catch(_0x44979f){_0x47b7fa['push'](_0x47b7fa['shift']());}}}(a79_0x17c3,0x740e0));function a79_0x17c3(){const _0x1de78b=['decorate','env','logger','\x0a\x0aRequest\x20Body:\x0a',']\x20Unhandled\x20Exception\x20Occurred','formatExceptionEmail','SMTP_PASS','\x0aRequest\x20URL:\x20','object','smtp.gmail.com','design:paramtypes','getDeviceName','\x22Exception\x20Notifier\x22\x20<no-reply@absolutepa.com>','onModuleInit','cachedDeviceName','Email\x20configuration\x20not\x20found.\x20Exceptions\x20will\x20be\x20sent\x20to\x20default\x20address.','createTransporter','\x0a\x20\x20\x20\x20','findFirst','Logger','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20Method:</strong>\x20','exdyrljbopqilckb','metadata','_settingService','</p>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Exception\x20Message:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','piName','schoolId','\x0aTimestamp:\x20','method','Unknown\x20Device','formatExceptionEmailHtml','function','toISOString','8FobnGI','Failed\x20to\x20get\x20device\x20name\x20from\x20SettingService,\x20falling\x20back\x20to\x20details.piName\x20or\x20default.','SMTP_SECURE','timestamp','defineProperty','transporter','length','Injectable','6OrsWxh','stringify','</pre>\x0a\x20\x20\x20\x20','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20URL:</strong>\x20','@nestjs/common','SMTP_USER','createTransport','defaultToEmail','__esModule','message','\x0a\x20\x20\x20\x20\x20\x20<h2>Unhandled\x20Exception\x20Notification</h2>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Device:</strong>\x20','\x0aUnhandled\x20Exception\x20Notification\x0a\x0aDevice:\x20','N/A','body','error','name','Failed\x20to\x20send\x20exception\x20notification\x20email:','url','Failed\x20to\x20cache\x20device\x20name\x20on\x20startup.','1491505NSnJKE','SMTP_HOST','SMTP_FROM','headers','10683zNevkJ','EmailService','warn','__metadata','Exception\x20notification\x20email\x20sent\x20successfully','trim','2735341xziqoN','isEmailConfigured','../setting/setting.service','</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Body:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','20505600IMGPlB','nodemailer','__decorate','1782612ENyQcz','3320MlNcBh','157812kJDPvk','186271ZQuBrQ'];a79_0x17c3=function(){return _0x1de78b;};return a79_0x17c3();}var __decorate=this&&this[a79_0x2ed5b1(0x1d0)]||function(_0x50e5c2,_0x34f51a,_0x1ce71f,_0x3e3adf){const _0x2dae86=a79_0x2ed5b1;var _0x45215c=arguments['length'],_0x149495=_0x45215c<0x3?_0x34f51a:_0x3e3adf===null?_0x3e3adf=Object['getOwnPropertyDescriptor'](_0x34f51a,_0x1ce71f):_0x3e3adf,_0x317407;if(typeof Reflect===_0x2dae86(0x1dd)&&typeof Reflect['decorate']===_0x2dae86(0x1f4))_0x149495=Reflect[_0x2dae86(0x1d5)](_0x50e5c2,_0x34f51a,_0x1ce71f,_0x3e3adf);else{for(var _0x29b66b=_0x50e5c2[_0x2dae86(0x1fc)]-0x1;_0x29b66b>=0x0;_0x29b66b--)if(_0x317407=_0x50e5c2[_0x29b66b])_0x149495=(_0x45215c<0x3?_0x317407(_0x149495):_0x45215c>0x3?_0x317407(_0x34f51a,_0x1ce71f,_0x149495):_0x317407(_0x34f51a,_0x1ce71f))||_0x149495;}return _0x45215c>0x3&&_0x149495&&Object[_0x2dae86(0x1fa)](_0x34f51a,_0x1ce71f,_0x149495),_0x149495;},__metadata=this&&this[a79_0x2ed5b1(0x218)]||function(_0x57d378,_0x2610ba){const _0x167868=a79_0x2ed5b1;if(typeof Reflect==='object'&&typeof Reflect[_0x167868(0x1eb)]===_0x167868(0x1f4))return Reflect[_0x167868(0x1eb)](_0x57d378,_0x2610ba);},EmailService_1;Object[a79_0x2ed5b1(0x1fa)](exports,a79_0x2ed5b1(0x206),{'value':!![]}),exports['EmailService']=void 0x0;const common_1=require(a79_0x2ed5b1(0x202)),nodemailer=require(a79_0x2ed5b1(0x1cf)),setting_service_1=require(a79_0x2ed5b1(0x1cc));function a79_0x3cf5(_0x3176e8,_0x2a773d){const _0x17c37b=a79_0x17c3();return a79_0x3cf5=function(_0x3cf5cb,_0x2be9b1){_0x3cf5cb=_0x3cf5cb-0x1c8;let _0x36ad10=_0x17c37b[_0x3cf5cb];return _0x36ad10;},a79_0x3cf5(_0x3176e8,_0x2a773d);}let EmailService=EmailService_1=class EmailService{constructor(_0x4f00ce){const _0x3c7ed4=a79_0x2ed5b1;this['_settingService']=_0x4f00ce,this[_0x3c7ed4(0x1d7)]=new common_1[(_0x3c7ed4(0x1e8))](EmailService_1[_0x3c7ed4(0x20d)]),this[_0x3c7ed4(0x205)]='dev.absolutepa@gmail.com,service@absolutepa.com.au',this['cachedDeviceName']=null,this['createTransporter']();}async[a79_0x2ed5b1(0x1e2)](){const _0x1d6751=a79_0x2ed5b1;try{const _0x15aaba=await this['_settingService'][_0x1d6751(0x1e7)]();this[_0x1d6751(0x1e3)]=(_0x15aaba===null||_0x15aaba===void 0x0?void 0x0:_0x15aaba[_0x1d6751(0x1ef)])||null;}catch(_0x56459f){this[_0x1d6751(0x1d7)][_0x1d6751(0x217)](_0x1d6751(0x210)),this['cachedDeviceName']=null;}}[a79_0x2ed5b1(0x1e5)](){const _0x460f62=a79_0x2ed5b1;this[_0x460f62(0x1cb)]()?this[_0x460f62(0x1fb)]=nodemailer[_0x460f62(0x204)]({'host':process[_0x460f62(0x1d6)]['SMTP_HOST'],'port':parseInt(process['env']['SMTP_PORT']||'587'),'secure':process[_0x460f62(0x1d6)][_0x460f62(0x1f8)]==='true','auth':{'user':process['env']['SMTP_USER'],'pass':process[_0x460f62(0x1d6)][_0x460f62(0x1db)]}}):(this[_0x460f62(0x1d7)][_0x460f62(0x217)](_0x460f62(0x1e4)),this['transporter']=nodemailer[_0x460f62(0x204)]({'host':_0x460f62(0x1de),'port':0x24b,'secure':![],'auth':{'user':'dev.absolutepa@gmail.com','pass':_0x460f62(0x1ea)}}));}[a79_0x2ed5b1(0x1cb)](){const _0x5ac49d=a79_0x2ed5b1;return!!(process[_0x5ac49d(0x1d6)][_0x5ac49d(0x212)]&&process[_0x5ac49d(0x1d6)][_0x5ac49d(0x203)]&&process['env'][_0x5ac49d(0x1db)]&&process[_0x5ac49d(0x1d6)]['EXCEPTION_NOTIFY_EMAIL']);}async['sendExceptionNotification'](_0x2fba78){const _0x494e6b=a79_0x2ed5b1;if(!this[_0x494e6b(0x1fb)]){this['logger']['debug']('Email\x20not\x20configured,\x20skipping\x20exception\x20notification');return;}const _0x880d51=await this[_0x494e6b(0x1e0)](_0x2fba78);try{const _0x211bcf=this[_0x494e6b(0x1da)](_0x2fba78,_0x880d51);await this[_0x494e6b(0x1fb)]['sendMail']({'from':process[_0x494e6b(0x1d6)][_0x494e6b(0x213)]||_0x494e6b(0x1e1),'to':process[_0x494e6b(0x1d6)]['EXCEPTION_NOTIFY_EMAIL']||this[_0x494e6b(0x205)],'subject':'['+_0x880d51+_0x494e6b(0x1d9),'text':_0x211bcf,'html':this[_0x494e6b(0x1f3)](_0x2fba78,_0x880d51)}),this[_0x494e6b(0x1d7)]['log'](_0x494e6b(0x1c8));}catch(_0x32031d){this[_0x494e6b(0x1d7)][_0x494e6b(0x20c)](_0x494e6b(0x20e),_0x32031d);}}['formatExceptionEmail'](_0x195ca7,_0x10f989){const _0x553583=a79_0x2ed5b1;return(_0x553583(0x209)+_0x10f989+_0x553583(0x1f0)+(_0x195ca7[_0x553583(0x1f9)]||new Date()['toISOString']())+_0x553583(0x1dc)+(_0x195ca7[_0x553583(0x20f)]||'N/A')+'\x0aRequest\x20Method:\x20'+(_0x195ca7[_0x553583(0x1f1)]||_0x553583(0x20a))+'\x0a\x0aException\x20Message:\x0a'+_0x195ca7[_0x553583(0x207)]+_0x553583(0x1d8)+(_0x195ca7[_0x553583(0x20b)]?JSON[_0x553583(0x1ff)](_0x195ca7['body'],null,0x2):_0x553583(0x20a))+'\x0a\x0aRequest\x20Headers:\x0a'+(_0x195ca7[_0x553583(0x214)]?JSON[_0x553583(0x1ff)](_0x195ca7[_0x553583(0x214)],null,0x2):'N/A')+_0x553583(0x1e6))[_0x553583(0x1c9)]();}[a79_0x2ed5b1(0x1f3)](_0x5c2bce,_0x16d948){const _0x4ff4f4=a79_0x2ed5b1;return _0x4ff4f4(0x208)+_0x16d948+'</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Timestamp:</strong>\x20'+(_0x5c2bce[_0x4ff4f4(0x1f9)]||new Date()[_0x4ff4f4(0x1f5)]())+_0x4ff4f4(0x201)+(_0x5c2bce[_0x4ff4f4(0x20f)]||_0x4ff4f4(0x20a))+_0x4ff4f4(0x1e9)+(_0x5c2bce['method']||_0x4ff4f4(0x20a))+_0x4ff4f4(0x1ed)+_0x5c2bce[_0x4ff4f4(0x207)]+_0x4ff4f4(0x1cd)+(_0x5c2bce['body']?JSON['stringify'](_0x5c2bce[_0x4ff4f4(0x20b)],null,0x2):'N/A')+'</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Headers:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>'+(_0x5c2bce['headers']?JSON[_0x4ff4f4(0x1ff)](_0x5c2bce[_0x4ff4f4(0x214)],null,0x2):'N/A')+_0x4ff4f4(0x200);}async[a79_0x2ed5b1(0x1e0)](_0x23702c){const _0x270b6d=a79_0x2ed5b1;if(this[_0x270b6d(0x1e3)])return this['cachedDeviceName'];try{const _0x10ecfa=await this[_0x270b6d(0x1ec)][_0x270b6d(0x1e7)]();return(_0x10ecfa===null||_0x10ecfa===void 0x0?void 0x0:_0x10ecfa[_0x270b6d(0x1ef)])||_0x23702c[_0x270b6d(0x1ee)]||_0x270b6d(0x1f2);}catch(_0x3bedd2){return this[_0x270b6d(0x1d7)][_0x270b6d(0x217)](_0x270b6d(0x1f7)),_0x23702c['piName']||_0x270b6d(0x1f2);}}};EmailService=EmailService_1=__decorate([(0x0,common_1[a79_0x2ed5b1(0x1fd)])(),__metadata(a79_0x2ed5b1(0x1df),[setting_service_1['SettingService']])],EmailService),exports[a79_0x2ed5b1(0x216)]=EmailService;