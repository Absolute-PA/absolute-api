'use strict';const a79_0x1bcc65=a79_0x480d;(function(_0x12bb96,_0x729d04){const _0x52f023=a79_0x480d,_0x2a93c2=_0x12bb96();while(!![]){try{const _0x15226c=-parseInt(_0x52f023(0x162))/0x1*(parseInt(_0x52f023(0x153))/0x2)+parseInt(_0x52f023(0x155))/0x3*(parseInt(_0x52f023(0x140))/0x4)+-parseInt(_0x52f023(0x142))/0x5+-parseInt(_0x52f023(0x167))/0x6+-parseInt(_0x52f023(0x15d))/0x7+-parseInt(_0x52f023(0x16b))/0x8+parseInt(_0x52f023(0x15b))/0x9;if(_0x15226c===_0x729d04)break;else _0x2a93c2['push'](_0x2a93c2['shift']());}catch(_0x23a43c){_0x2a93c2['push'](_0x2a93c2['shift']());}}}(a79_0x591c,0xa1853));function a79_0x591c(){const _0x18085b=['\x0aRequest\x20URL:\x20','@nestjs/common','exdyrljbopqilckb','SMTP_HOST','__decorate','design:paramtypes','\x0aTimestamp:\x20','16EaWOJj','function','11661sTIMOy','defaultToEmail','env','stringify','Exception\x20notification\x20email\x20sent\x20successfully','Failed\x20to\x20send\x20exception\x20notification\x20email:','18229869WUNxMR','timestamp','5962712Dsmxol','</p>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Exception\x20Message:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Body:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','\x0a\x0aRequest\x20Body:\x0a','dev.absolutepa@gmail.com','2566TIMcET','\x0a\x20\x20\x20\x20','createTransport','message','nodemailer','656076whRCfc','error','warn','EXCEPTION_NOTIFY_EMAIL','3642736OdNlhA','piName','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Timestamp:</strong>\x20','_settingService','Failed\x20to\x20cache\x20device\x20name\x20on\x20startup.','sendMail','trim','\x0aUnhandled\x20Exception\x20Notification\x0a\x0aDevice:\x20','object','</pre>\x0a\x20\x20\x20\x20','N/A',']\x20Unhandled\x20Exception\x20Occurred','__esModule','url','\x0a\x0aRequest\x20Headers:\x0a','Failed\x20to\x20get\x20device\x20name\x20from\x20SettingService,\x20falling\x20back\x20to\x20details.piName\x20or\x20default.','SMTP_FROM','toISOString','cachedDeviceName','smtp.gmail.com','headers','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20URL:</strong>\x20','logger','isEmailConfigured','getOwnPropertyDescriptor','Injectable','method','SMTP_PORT','name','formatExceptionEmailHtml','true','SMTP_PASS','schoolId','\x0a\x0aException\x20Message:\x0a','getDeviceName','SMTP_USER','\x0a\x20\x20\x20\x20\x20\x20<h2>Unhandled\x20Exception\x20Notification</h2>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Device:</strong>\x20','body','debug','620YjIbTM','length','2647035VrivZQ','decorate','sendExceptionNotification','EmailService','transporter','../setting/setting.service','metadata','findFirst','onModuleInit','formatExceptionEmail'];a79_0x591c=function(){return _0x18085b;};return a79_0x591c();}var __decorate=this&&this[a79_0x1bcc65(0x150)]||function(_0x1f0d0f,_0x4c808c,_0x428f8f,_0x50d46f){const _0x1df925=a79_0x1bcc65;var _0x34ba01=arguments[_0x1df925(0x141)],_0x4da9b2=_0x34ba01<0x3?_0x4c808c:_0x50d46f===null?_0x50d46f=Object[_0x1df925(0x131)](_0x4c808c,_0x428f8f):_0x50d46f,_0x41fa47;if(typeof Reflect===_0x1df925(0x121)&&typeof Reflect[_0x1df925(0x143)]===_0x1df925(0x154))_0x4da9b2=Reflect[_0x1df925(0x143)](_0x1f0d0f,_0x4c808c,_0x428f8f,_0x50d46f);else{for(var _0xe3d23d=_0x1f0d0f[_0x1df925(0x141)]-0x1;_0xe3d23d>=0x0;_0xe3d23d--)if(_0x41fa47=_0x1f0d0f[_0xe3d23d])_0x4da9b2=(_0x34ba01<0x3?_0x41fa47(_0x4da9b2):_0x34ba01>0x3?_0x41fa47(_0x4c808c,_0x428f8f,_0x4da9b2):_0x41fa47(_0x4c808c,_0x428f8f))||_0x4da9b2;}return _0x34ba01>0x3&&_0x4da9b2&&Object['defineProperty'](_0x4c808c,_0x428f8f,_0x4da9b2),_0x4da9b2;},__metadata=this&&this['__metadata']||function(_0xd7a24d,_0x1f4a66){const _0x1ac3f9=a79_0x1bcc65;if(typeof Reflect==='object'&&typeof Reflect[_0x1ac3f9(0x148)]==='function')return Reflect[_0x1ac3f9(0x148)](_0xd7a24d,_0x1f4a66);},EmailService_1;Object['defineProperty'](exports,a79_0x1bcc65(0x125),{'value':!![]}),exports[a79_0x1bcc65(0x145)]=void 0x0;function a79_0x480d(_0x1af437,_0xd11bb8){const _0x591c64=a79_0x591c();return a79_0x480d=function(_0x480dba,_0x472e9d){_0x480dba=_0x480dba-0x11b;let _0x55021d=_0x591c64[_0x480dba];return _0x55021d;},a79_0x480d(_0x1af437,_0xd11bb8);}const common_1=require(a79_0x1bcc65(0x14d)),nodemailer=require(a79_0x1bcc65(0x166)),setting_service_1=require(a79_0x1bcc65(0x147));let EmailService=EmailService_1=class EmailService{constructor(_0x6a562b){const _0x1ba6df=a79_0x1bcc65;this[_0x1ba6df(0x11c)]=_0x6a562b,this[_0x1ba6df(0x12f)]=new common_1['Logger'](EmailService_1[_0x1ba6df(0x135)]),this[_0x1ba6df(0x156)]='dev.absolutepa@gmail.com,service@absolutepa.com.au',this['cachedDeviceName']=null,this['createTransporter']();}async[a79_0x1bcc65(0x14a)](){const _0x4b1ab4=a79_0x1bcc65;try{const _0x566455=await this[_0x4b1ab4(0x11c)][_0x4b1ab4(0x149)]();this[_0x4b1ab4(0x12b)]=(_0x566455===null||_0x566455===void 0x0?void 0x0:_0x566455[_0x4b1ab4(0x139)])||null;}catch(_0x31093b){this[_0x4b1ab4(0x12f)][_0x4b1ab4(0x169)](_0x4b1ab4(0x11d)),this[_0x4b1ab4(0x12b)]=null;}}['createTransporter'](){const _0x32c8b4=a79_0x1bcc65;this[_0x32c8b4(0x130)]()?this[_0x32c8b4(0x146)]=nodemailer[_0x32c8b4(0x164)]({'host':process[_0x32c8b4(0x157)]['SMTP_HOST'],'port':parseInt(process[_0x32c8b4(0x157)][_0x32c8b4(0x134)]||'587'),'secure':process[_0x32c8b4(0x157)]['SMTP_SECURE']===_0x32c8b4(0x137),'auth':{'user':process[_0x32c8b4(0x157)][_0x32c8b4(0x13c)],'pass':process[_0x32c8b4(0x157)][_0x32c8b4(0x138)]}}):(this['logger'][_0x32c8b4(0x169)]('Email\x20configuration\x20not\x20found.\x20Exceptions\x20will\x20be\x20sent\x20to\x20default\x20address.'),this[_0x32c8b4(0x146)]=nodemailer[_0x32c8b4(0x164)]({'host':_0x32c8b4(0x12c),'port':0x24b,'secure':![],'auth':{'user':_0x32c8b4(0x161),'pass':_0x32c8b4(0x14e)}}));}[a79_0x1bcc65(0x130)](){const _0x384e76=a79_0x1bcc65;return!!(process[_0x384e76(0x157)][_0x384e76(0x14f)]&&process[_0x384e76(0x157)][_0x384e76(0x13c)]&&process[_0x384e76(0x157)][_0x384e76(0x138)]&&process[_0x384e76(0x157)][_0x384e76(0x16a)]);}async[a79_0x1bcc65(0x144)](_0x2a4fe1){const _0x18c84e=a79_0x1bcc65;if(!this[_0x18c84e(0x146)]){this['logger'][_0x18c84e(0x13f)]('Email\x20not\x20configured,\x20skipping\x20exception\x20notification');return;}const _0xd92df6=await this[_0x18c84e(0x13b)](_0x2a4fe1);try{const _0x3e5397=this[_0x18c84e(0x14b)](_0x2a4fe1,_0xd92df6);await this[_0x18c84e(0x146)][_0x18c84e(0x11e)]({'from':process[_0x18c84e(0x157)][_0x18c84e(0x129)]||'\x22Exception\x20Notifier\x22\x20<no-reply@absolutepa.com>','to':process[_0x18c84e(0x157)][_0x18c84e(0x16a)]||this[_0x18c84e(0x156)],'subject':'['+_0xd92df6+_0x18c84e(0x124),'text':_0x3e5397,'html':this[_0x18c84e(0x136)](_0x2a4fe1,_0xd92df6)}),this[_0x18c84e(0x12f)]['log'](_0x18c84e(0x159));}catch(_0x2a89ea){this['logger'][_0x18c84e(0x168)](_0x18c84e(0x15a),_0x2a89ea);}}[a79_0x1bcc65(0x14b)](_0x1c4972,_0xc8d3da){const _0x2696e5=a79_0x1bcc65;return(_0x2696e5(0x120)+_0xc8d3da+_0x2696e5(0x152)+(_0x1c4972[_0x2696e5(0x15c)]||new Date()[_0x2696e5(0x12a)]())+_0x2696e5(0x14c)+(_0x1c4972[_0x2696e5(0x126)]||_0x2696e5(0x123))+'\x0aRequest\x20Method:\x20'+(_0x1c4972['method']||_0x2696e5(0x123))+_0x2696e5(0x13a)+_0x1c4972[_0x2696e5(0x165)]+_0x2696e5(0x160)+(_0x1c4972[_0x2696e5(0x13e)]?JSON['stringify'](_0x1c4972[_0x2696e5(0x13e)],null,0x2):_0x2696e5(0x123))+_0x2696e5(0x127)+(_0x1c4972[_0x2696e5(0x12d)]?JSON[_0x2696e5(0x158)](_0x1c4972[_0x2696e5(0x12d)],null,0x2):'N/A')+_0x2696e5(0x163))[_0x2696e5(0x11f)]();}[a79_0x1bcc65(0x136)](_0x53d126,_0x41106c){const _0x14a9ea=a79_0x1bcc65;return _0x14a9ea(0x13d)+_0x41106c+_0x14a9ea(0x11b)+(_0x53d126[_0x14a9ea(0x15c)]||new Date()[_0x14a9ea(0x12a)]())+_0x14a9ea(0x12e)+(_0x53d126['url']||_0x14a9ea(0x123))+'</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20Method:</strong>\x20'+(_0x53d126[_0x14a9ea(0x133)]||'N/A')+_0x14a9ea(0x15e)+_0x53d126[_0x14a9ea(0x165)]+_0x14a9ea(0x15f)+(_0x53d126[_0x14a9ea(0x13e)]?JSON[_0x14a9ea(0x158)](_0x53d126[_0x14a9ea(0x13e)],null,0x2):_0x14a9ea(0x123))+'</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Headers:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>'+(_0x53d126[_0x14a9ea(0x12d)]?JSON[_0x14a9ea(0x158)](_0x53d126[_0x14a9ea(0x12d)],null,0x2):_0x14a9ea(0x123))+_0x14a9ea(0x122);}async[a79_0x1bcc65(0x13b)](_0x90cabf){const _0x15d397=a79_0x1bcc65;if(this[_0x15d397(0x12b)])return this[_0x15d397(0x12b)];try{const _0x22d904=await this[_0x15d397(0x11c)][_0x15d397(0x149)]();return(_0x22d904===null||_0x22d904===void 0x0?void 0x0:_0x22d904[_0x15d397(0x139)])||_0x90cabf['piName']||'Unknown\x20Device';}catch(_0xe874d){return this[_0x15d397(0x12f)][_0x15d397(0x169)](_0x15d397(0x128)),_0x90cabf[_0x15d397(0x16c)]||'Unknown\x20Device';}}};EmailService=EmailService_1=__decorate([(0x0,common_1[a79_0x1bcc65(0x132)])(),__metadata(a79_0x1bcc65(0x151),[setting_service_1['SettingService']])],EmailService),exports['EmailService']=EmailService;