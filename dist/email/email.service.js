'use strict';const a79_0x2d1187=a79_0x5aba;(function(_0x5b4c9a,_0x676f3f){const _0x3998e7=a79_0x5aba,_0x3cc348=_0x5b4c9a();while(!![]){try{const _0x2f3a0d=-parseInt(_0x3998e7(0x1ca))/0x1+-parseInt(_0x3998e7(0x1b7))/0x2*(-parseInt(_0x3998e7(0x1d8))/0x3)+parseInt(_0x3998e7(0x1c5))/0x4*(-parseInt(_0x3998e7(0x1b2))/0x5)+parseInt(_0x3998e7(0x1ac))/0x6+parseInt(_0x3998e7(0x1e1))/0x7+parseInt(_0x3998e7(0x192))/0x8+parseInt(_0x3998e7(0x1aa))/0x9*(-parseInt(_0x3998e7(0x1d4))/0xa);if(_0x2f3a0d===_0x676f3f)break;else _0x3cc348['push'](_0x3cc348['shift']());}catch(_0x4f39c1){_0x3cc348['push'](_0x3cc348['shift']());}}}(a79_0x1cfa,0x1e2d2));function a79_0x1cfa(){const _0x181d8d=['createTransport','onModuleInit','12621gglyjT','stringify','trim','EXCEPTION_NOTIFY_EMAIL','Unknown\x20Device','exdyrljbopqilckb','getOwnPropertyDescriptor','debug','@nestjs/common','218267ECIQHx','function','design:paramtypes','getDeviceName','defaultToEmail','</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Headers:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','599512pIJwXY','Failed\x20to\x20cache\x20device\x20name\x20on\x20startup.','metadata','message','findFirst','\x22Exception\x20Notifier\x22\x20<no-reply@absolutepa.com>','../setting/setting.service','</pre>\x0a\x20\x20\x20\x20','warn','decorate','\x0a\x0aRequest\x20Body:\x0a','env','true','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20Method:</strong>\x20','isEmailConfigured','\x0a\x0aException\x20Message:\x0a','SMTP_USER','SMTP_HOST','length','Injectable','Email\x20not\x20configured,\x20skipping\x20exception\x20notification','nodemailer','body','</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Body:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','882wNiHgP','toISOString','623076PxABpj','object','587','smtp.gmail.com','__decorate','logger','25dVgTFV','timestamp','__esModule','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20URL:</strong>\x20','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Timestamp:</strong>\x20','112qLUNyD','schoolId','EmailService','url','formatExceptionEmailHtml','SettingService','_settingService','piName','SMTP_FROM','dev.absolutepa@gmail.com','headers','transporter','</p>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Exception\x20Message:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','SMTP_PORT','108844OoMBPZ','\x0aTimestamp:\x20','formatExceptionEmail','defineProperty','cachedDeviceName','110147AIcAdC','\x0aUnhandled\x20Exception\x20Notification\x0a\x0aDevice:\x20',']\x20Unhandled\x20Exception\x20Occurred','\x0a\x0aRequest\x20Headers:\x0a','method','createTransporter','Exception\x20notification\x20email\x20sent\x20successfully','N/A','SMTP_PASS','sendExceptionNotification','7730ikYZvw','SMTP_SECURE'];a79_0x1cfa=function(){return _0x181d8d;};return a79_0x1cfa();}var __decorate=this&&this[a79_0x2d1187(0x1b0)]||function(_0x547315,_0x769b3f,_0x18870b,_0x5c3d3d){const _0x15e5e2=a79_0x2d1187;var _0x177080=arguments[_0x15e5e2(0x1a4)],_0x24ec1e=_0x177080<0x3?_0x769b3f:_0x5c3d3d===null?_0x5c3d3d=Object[_0x15e5e2(0x1de)](_0x769b3f,_0x18870b):_0x5c3d3d,_0x4fe020;if(typeof Reflect===_0x15e5e2(0x1ad)&&typeof Reflect[_0x15e5e2(0x19b)]===_0x15e5e2(0x1e2))_0x24ec1e=Reflect[_0x15e5e2(0x19b)](_0x547315,_0x769b3f,_0x18870b,_0x5c3d3d);else{for(var _0x3b781d=_0x547315[_0x15e5e2(0x1a4)]-0x1;_0x3b781d>=0x0;_0x3b781d--)if(_0x4fe020=_0x547315[_0x3b781d])_0x24ec1e=(_0x177080<0x3?_0x4fe020(_0x24ec1e):_0x177080>0x3?_0x4fe020(_0x769b3f,_0x18870b,_0x24ec1e):_0x4fe020(_0x769b3f,_0x18870b))||_0x24ec1e;}return _0x177080>0x3&&_0x24ec1e&&Object[_0x15e5e2(0x1c8)](_0x769b3f,_0x18870b,_0x24ec1e),_0x24ec1e;},__metadata=this&&this['__metadata']||function(_0x2809fc,_0x4d766f){const _0x54f5cc=a79_0x2d1187;if(typeof Reflect==='object'&&typeof Reflect[_0x54f5cc(0x194)]===_0x54f5cc(0x1e2))return Reflect[_0x54f5cc(0x194)](_0x2809fc,_0x4d766f);},EmailService_1;Object[a79_0x2d1187(0x1c8)](exports,a79_0x2d1187(0x1b4),{'value':!![]}),exports[a79_0x2d1187(0x1b9)]=void 0x0;const common_1=require(a79_0x2d1187(0x1e0)),nodemailer=require(a79_0x2d1187(0x1a7)),setting_service_1=require(a79_0x2d1187(0x198));function a79_0x5aba(_0xb03fb8,_0x46d463){const _0x1cfa8d=a79_0x1cfa();return a79_0x5aba=function(_0x5aba99,_0x1365c7){_0x5aba99=_0x5aba99-0x18f;let _0x3da6cd=_0x1cfa8d[_0x5aba99];return _0x3da6cd;},a79_0x5aba(_0xb03fb8,_0x46d463);}let EmailService=EmailService_1=class EmailService{constructor(_0x235dca){const _0x34b403=a79_0x2d1187;this[_0x34b403(0x1bd)]=_0x235dca,this[_0x34b403(0x1b1)]=new common_1['Logger'](EmailService_1['name']),this[_0x34b403(0x190)]='dev.absolutepa@gmail.com,service@absolutepa.com.au',this[_0x34b403(0x1c9)]=null,this['createTransporter']();}async[a79_0x2d1187(0x1d7)](){const _0x5db013=a79_0x2d1187;try{const _0x2bf14e=await this['_settingService'][_0x5db013(0x196)]();this[_0x5db013(0x1c9)]=(_0x2bf14e===null||_0x2bf14e===void 0x0?void 0x0:_0x2bf14e[_0x5db013(0x1b8)])||null;}catch(_0x41d9e9){this['logger']['warn'](_0x5db013(0x193)),this[_0x5db013(0x1c9)]=null;}}[a79_0x2d1187(0x1cf)](){const _0x25cd42=a79_0x2d1187;this['isEmailConfigured']()?this[_0x25cd42(0x1c2)]=nodemailer[_0x25cd42(0x1d6)]({'host':process[_0x25cd42(0x19d)][_0x25cd42(0x1a3)],'port':parseInt(process['env'][_0x25cd42(0x1c4)]||_0x25cd42(0x1ae)),'secure':process[_0x25cd42(0x19d)][_0x25cd42(0x1d5)]===_0x25cd42(0x19e),'auth':{'user':process[_0x25cd42(0x19d)][_0x25cd42(0x1a2)],'pass':process[_0x25cd42(0x19d)][_0x25cd42(0x1d2)]}}):(this[_0x25cd42(0x1b1)][_0x25cd42(0x19a)]('Email\x20configuration\x20not\x20found.\x20Exceptions\x20will\x20be\x20sent\x20to\x20default\x20address.'),this[_0x25cd42(0x1c2)]=nodemailer[_0x25cd42(0x1d6)]({'host':_0x25cd42(0x1af),'port':0x24b,'secure':![],'auth':{'user':_0x25cd42(0x1c0),'pass':_0x25cd42(0x1dd)}}));}[a79_0x2d1187(0x1a0)](){const _0x5efcd1=a79_0x2d1187;return!!(process[_0x5efcd1(0x19d)][_0x5efcd1(0x1a3)]&&process[_0x5efcd1(0x19d)][_0x5efcd1(0x1a2)]&&process[_0x5efcd1(0x19d)][_0x5efcd1(0x1d2)]&&process[_0x5efcd1(0x19d)]['EXCEPTION_NOTIFY_EMAIL']);}async[a79_0x2d1187(0x1d3)](_0x492086){const _0x248c1a=a79_0x2d1187;if(!this['transporter']){this[_0x248c1a(0x1b1)][_0x248c1a(0x1df)](_0x248c1a(0x1a6));return;}const _0x33dc30=await this['getDeviceName'](_0x492086);try{const _0x1ed05d=this['formatExceptionEmail'](_0x492086,_0x33dc30);await this[_0x248c1a(0x1c2)]['sendMail']({'from':process[_0x248c1a(0x19d)][_0x248c1a(0x1bf)]||_0x248c1a(0x197),'to':process[_0x248c1a(0x19d)][_0x248c1a(0x1db)]||this[_0x248c1a(0x190)],'subject':'['+_0x33dc30+_0x248c1a(0x1cc),'text':_0x1ed05d,'html':this[_0x248c1a(0x1bb)](_0x492086,_0x33dc30)}),this[_0x248c1a(0x1b1)]['log'](_0x248c1a(0x1d0));}catch(_0xfb7111){this[_0x248c1a(0x1b1)]['error']('Failed\x20to\x20send\x20exception\x20notification\x20email:',_0xfb7111);}}[a79_0x2d1187(0x1c7)](_0x14f73b,_0x14e810){const _0x29dc07=a79_0x2d1187;return(_0x29dc07(0x1cb)+_0x14e810+_0x29dc07(0x1c6)+(_0x14f73b[_0x29dc07(0x1b3)]||new Date()[_0x29dc07(0x1ab)]())+'\x0aRequest\x20URL:\x20'+(_0x14f73b['url']||_0x29dc07(0x1d1))+'\x0aRequest\x20Method:\x20'+(_0x14f73b['method']||_0x29dc07(0x1d1))+_0x29dc07(0x1a1)+_0x14f73b[_0x29dc07(0x195)]+_0x29dc07(0x19c)+(_0x14f73b[_0x29dc07(0x1a8)]?JSON[_0x29dc07(0x1d9)](_0x14f73b[_0x29dc07(0x1a8)],null,0x2):_0x29dc07(0x1d1))+_0x29dc07(0x1cd)+(_0x14f73b[_0x29dc07(0x1c1)]?JSON[_0x29dc07(0x1d9)](_0x14f73b[_0x29dc07(0x1c1)],null,0x2):'N/A')+'\x0a\x20\x20\x20\x20')[_0x29dc07(0x1da)]();}['formatExceptionEmailHtml'](_0x42790b,_0x184420){const _0x13f296=a79_0x2d1187;return'\x0a\x20\x20\x20\x20\x20\x20<h2>Unhandled\x20Exception\x20Notification</h2>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Device:</strong>\x20'+_0x184420+_0x13f296(0x1b6)+(_0x42790b['timestamp']||new Date()['toISOString']())+_0x13f296(0x1b5)+(_0x42790b[_0x13f296(0x1ba)]||_0x13f296(0x1d1))+_0x13f296(0x19f)+(_0x42790b[_0x13f296(0x1ce)]||_0x13f296(0x1d1))+_0x13f296(0x1c3)+_0x42790b[_0x13f296(0x195)]+_0x13f296(0x1a9)+(_0x42790b['body']?JSON[_0x13f296(0x1d9)](_0x42790b['body'],null,0x2):_0x13f296(0x1d1))+_0x13f296(0x191)+(_0x42790b[_0x13f296(0x1c1)]?JSON[_0x13f296(0x1d9)](_0x42790b[_0x13f296(0x1c1)],null,0x2):_0x13f296(0x1d1))+_0x13f296(0x199);}async[a79_0x2d1187(0x18f)](_0x4c628){const _0x1f4477=a79_0x2d1187;if(this[_0x1f4477(0x1c9)])return this[_0x1f4477(0x1c9)];try{const _0x1aeabb=await this[_0x1f4477(0x1bd)][_0x1f4477(0x196)]();return(_0x1aeabb===null||_0x1aeabb===void 0x0?void 0x0:_0x1aeabb['schoolId'])||_0x4c628[_0x1f4477(0x1be)]||_0x1f4477(0x1dc);}catch(_0x3a1a18){return this[_0x1f4477(0x1b1)]['warn']('Failed\x20to\x20get\x20device\x20name\x20from\x20SettingService,\x20falling\x20back\x20to\x20details.piName\x20or\x20default.'),_0x4c628[_0x1f4477(0x1be)]||_0x1f4477(0x1dc);}}};EmailService=EmailService_1=__decorate([(0x0,common_1[a79_0x2d1187(0x1a5)])(),__metadata(a79_0x2d1187(0x1e3),[setting_service_1[a79_0x2d1187(0x1bc)]])],EmailService),exports[a79_0x2d1187(0x1b9)]=EmailService;