'use strict';const a79_0x5a77b9=a79_0x3d5b;function a79_0x3370(){const _0x25536c=['findFirst','metadata','exdyrljbopqilckb','</pre>\x0a\x20\x20\x20\x20','message','function','</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Body:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','transporter','true','\x0a\x0aRequest\x20Body:\x0a','N/A','</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Headers:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>',']\x20Unhandled\x20Exception\x20Occurred','__esModule','SMTP_SECURE','createTransporter','defaultToEmail','timestamp','logger','formatExceptionEmailHtml','decorate','SMTP_PORT','734mcskSm','Email\x20not\x20configured,\x20skipping\x20exception\x20notification','\x0a\x20\x20\x20\x20\x20\x20<h2>Unhandled\x20Exception\x20Notification</h2>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Device:</strong>\x20','nodemailer','piName','</p>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Exception\x20Message:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','\x0a\x0aRequest\x20Headers:\x0a','SMTP_PASS','__decorate','Failed\x20to\x20send\x20exception\x20notification\x20email:','\x0aRequest\x20Method:\x20','trim','18790380yPhrDU','1325187uniWXF','url','EXCEPTION_NOTIFY_EMAIL','name','sendExceptionNotification','Logger','schoolId','error','3085EUCLeu','env','defineProperty','SettingService','\x0a\x20\x20\x20\x20','SMTP_USER','object','7196903gYiNKk','Exception\x20notification\x20email\x20sent\x20successfully','16xQjWOb','SMTP_HOST','warn','Injectable','getDeviceName','Unknown\x20Device','method','cachedDeviceName','876318ZwCELe','toISOString','__metadata','9931512wKUzJX','length','\x0aUnhandled\x20Exception\x20Notification\x0a\x0aDevice:\x20','\x22Exception\x20Notifier\x22\x20<no-reply@absolutepa.com>','EmailService','headers','formatExceptionEmail','dev.absolutepa@gmail.com','debug','stringify','onModuleInit','80uiGkxp','_settingService','smtp.gmail.com','\x0aTimestamp:\x20','body','createTransport','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Timestamp:</strong>\x20','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20Method:</strong>\x20','Email\x20configuration\x20not\x20found.\x20Exceptions\x20will\x20be\x20sent\x20to\x20default\x20address.','587','8173165rmekWX','dev.absolutepa@gmail.com,service@absolutepa.com.au'];a79_0x3370=function(){return _0x25536c;};return a79_0x3370();}(function(_0x3fbc5c,_0x54d3ee){const _0x24461a=a79_0x3d5b,_0x5cb94f=_0x3fbc5c();while(!![]){try{const _0x1c5088=parseInt(_0x24461a(0xb0))/0x1*(parseInt(_0x24461a(0x9b))/0x2)+-parseInt(_0x24461a(0xc1))/0x3*(-parseInt(_0x24461a(0xb9))/0x4)+parseInt(_0x24461a(0xd9))/0x5+-parseInt(_0x24461a(0xc4))/0x6+-parseInt(_0x24461a(0xb7))/0x7+parseInt(_0x24461a(0xcf))/0x8*(parseInt(_0x24461a(0xa8))/0x9)+-parseInt(_0x24461a(0xa7))/0xa;if(_0x1c5088===_0x54d3ee)break;else _0x5cb94f['push'](_0x5cb94f['shift']());}catch(_0x5abf91){_0x5cb94f['push'](_0x5cb94f['shift']());}}}(a79_0x3370,0xce5cf));var __decorate=this&&this[a79_0x5a77b9(0xa3)]||function(_0x1a363a,_0x41628f,_0x3cd957,_0xc60196){const _0x544c2e=a79_0x5a77b9;var _0x4f002f=arguments[_0x544c2e(0xc5)],_0x1213f8=_0x4f002f<0x3?_0x41628f:_0xc60196===null?_0xc60196=Object['getOwnPropertyDescriptor'](_0x41628f,_0x3cd957):_0xc60196,_0x284ebe;if(typeof Reflect===_0x544c2e(0xb6)&&typeof Reflect['decorate']===_0x544c2e(0xe0))_0x1213f8=Reflect[_0x544c2e(0x99)](_0x1a363a,_0x41628f,_0x3cd957,_0xc60196);else{for(var _0x31c8f5=_0x1a363a['length']-0x1;_0x31c8f5>=0x0;_0x31c8f5--)if(_0x284ebe=_0x1a363a[_0x31c8f5])_0x1213f8=(_0x4f002f<0x3?_0x284ebe(_0x1213f8):_0x4f002f>0x3?_0x284ebe(_0x41628f,_0x3cd957,_0x1213f8):_0x284ebe(_0x41628f,_0x3cd957))||_0x1213f8;}return _0x4f002f>0x3&&_0x1213f8&&Object[_0x544c2e(0xb2)](_0x41628f,_0x3cd957,_0x1213f8),_0x1213f8;},__metadata=this&&this[a79_0x5a77b9(0xc3)]||function(_0x5e0367,_0x469c5a){const _0x2b37ff=a79_0x5a77b9;if(typeof Reflect===_0x2b37ff(0xb6)&&typeof Reflect[_0x2b37ff(0xdc)]==='function')return Reflect[_0x2b37ff(0xdc)](_0x5e0367,_0x469c5a);},EmailService_1;Object[a79_0x5a77b9(0xb2)](exports,a79_0x5a77b9(0xe8),{'value':!![]}),exports['EmailService']=void 0x0;function a79_0x3d5b(_0x4b4dd5,_0x13ab00){const _0x337093=a79_0x3370();return a79_0x3d5b=function(_0x3d5ba1,_0x3a48ca){_0x3d5ba1=_0x3d5ba1-0x98;let _0x2a66f4=_0x337093[_0x3d5ba1];return _0x2a66f4;},a79_0x3d5b(_0x4b4dd5,_0x13ab00);}const common_1=require('@nestjs/common'),nodemailer=require(a79_0x5a77b9(0x9e)),setting_service_1=require('../setting/setting.service');let EmailService=EmailService_1=class EmailService{constructor(_0x4cdfe5){const _0x1ed49e=a79_0x5a77b9;this['_settingService']=_0x4cdfe5,this[_0x1ed49e(0xed)]=new common_1[(_0x1ed49e(0xad))](EmailService_1[_0x1ed49e(0xab)]),this[_0x1ed49e(0xeb)]=_0x1ed49e(0xda),this[_0x1ed49e(0xc0)]=null,this[_0x1ed49e(0xea)]();}async[a79_0x5a77b9(0xce)](){const _0x4d6d43=a79_0x5a77b9;try{const _0x3ada40=await this[_0x4d6d43(0xd0)][_0x4d6d43(0xdb)]();this[_0x4d6d43(0xc0)]=(_0x3ada40===null||_0x3ada40===void 0x0?void 0x0:_0x3ada40[_0x4d6d43(0xae)])||null;}catch(_0x55cad3){this[_0x4d6d43(0xed)][_0x4d6d43(0xbb)]('Failed\x20to\x20cache\x20device\x20name\x20on\x20startup.'),this[_0x4d6d43(0xc0)]=null;}}['createTransporter'](){const _0x19e388=a79_0x5a77b9;this['isEmailConfigured']()?this[_0x19e388(0xe2)]=nodemailer[_0x19e388(0xd4)]({'host':process[_0x19e388(0xb1)][_0x19e388(0xba)],'port':parseInt(process['env'][_0x19e388(0x9a)]||_0x19e388(0xd8)),'secure':process['env'][_0x19e388(0xe9)]===_0x19e388(0xe3),'auth':{'user':process[_0x19e388(0xb1)]['SMTP_USER'],'pass':process[_0x19e388(0xb1)][_0x19e388(0xa2)]}}):(this[_0x19e388(0xed)][_0x19e388(0xbb)](_0x19e388(0xd7)),this['transporter']=nodemailer[_0x19e388(0xd4)]({'host':_0x19e388(0xd1),'port':0x24b,'secure':![],'auth':{'user':_0x19e388(0xcb),'pass':_0x19e388(0xdd)}}));}['isEmailConfigured'](){const _0x1c45e0=a79_0x5a77b9;return!!(process['env']['SMTP_HOST']&&process[_0x1c45e0(0xb1)][_0x1c45e0(0xb5)]&&process[_0x1c45e0(0xb1)][_0x1c45e0(0xa2)]&&process[_0x1c45e0(0xb1)][_0x1c45e0(0xaa)]);}async[a79_0x5a77b9(0xac)](_0xb1f720){const _0x15c2ff=a79_0x5a77b9;if(!this[_0x15c2ff(0xe2)]){this[_0x15c2ff(0xed)][_0x15c2ff(0xcc)](_0x15c2ff(0x9c));return;}const _0x452f1c=await this['getDeviceName'](_0xb1f720);try{const _0x2ba8e5=this[_0x15c2ff(0xca)](_0xb1f720,_0x452f1c);await this[_0x15c2ff(0xe2)]['sendMail']({'from':process['env']['SMTP_FROM']||_0x15c2ff(0xc7),'to':process['env'][_0x15c2ff(0xaa)]||this[_0x15c2ff(0xeb)],'subject':'['+_0x452f1c+_0x15c2ff(0xe7),'text':_0x2ba8e5,'html':this[_0x15c2ff(0x98)](_0xb1f720,_0x452f1c)}),this[_0x15c2ff(0xed)]['log'](_0x15c2ff(0xb8));}catch(_0x4ed696){this[_0x15c2ff(0xed)][_0x15c2ff(0xaf)](_0x15c2ff(0xa4),_0x4ed696);}}[a79_0x5a77b9(0xca)](_0x2240e2,_0x23e8fa){const _0x303afb=a79_0x5a77b9;return(_0x303afb(0xc6)+_0x23e8fa+_0x303afb(0xd2)+(_0x2240e2[_0x303afb(0xec)]||new Date()[_0x303afb(0xc2)]())+'\x0aRequest\x20URL:\x20'+(_0x2240e2['url']||_0x303afb(0xe5))+_0x303afb(0xa5)+(_0x2240e2[_0x303afb(0xbf)]||_0x303afb(0xe5))+'\x0a\x0aException\x20Message:\x0a'+_0x2240e2['message']+_0x303afb(0xe4)+(_0x2240e2[_0x303afb(0xd3)]?JSON[_0x303afb(0xcd)](_0x2240e2['body'],null,0x2):_0x303afb(0xe5))+_0x303afb(0xa1)+(_0x2240e2[_0x303afb(0xc9)]?JSON[_0x303afb(0xcd)](_0x2240e2[_0x303afb(0xc9)],null,0x2):_0x303afb(0xe5))+_0x303afb(0xb4))[_0x303afb(0xa6)]();}[a79_0x5a77b9(0x98)](_0x488fb8,_0x137b12){const _0x9ed792=a79_0x5a77b9;return _0x9ed792(0x9d)+_0x137b12+_0x9ed792(0xd5)+(_0x488fb8[_0x9ed792(0xec)]||new Date()[_0x9ed792(0xc2)]())+'</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20URL:</strong>\x20'+(_0x488fb8[_0x9ed792(0xa9)]||'N/A')+_0x9ed792(0xd6)+(_0x488fb8[_0x9ed792(0xbf)]||'N/A')+_0x9ed792(0xa0)+_0x488fb8[_0x9ed792(0xdf)]+_0x9ed792(0xe1)+(_0x488fb8[_0x9ed792(0xd3)]?JSON['stringify'](_0x488fb8['body'],null,0x2):'N/A')+_0x9ed792(0xe6)+(_0x488fb8['headers']?JSON[_0x9ed792(0xcd)](_0x488fb8[_0x9ed792(0xc9)],null,0x2):_0x9ed792(0xe5))+_0x9ed792(0xde);}async[a79_0x5a77b9(0xbd)](_0x1dfe0e){const _0x63dacd=a79_0x5a77b9;if(this[_0x63dacd(0xc0)])return this['cachedDeviceName'];try{const _0x4689a3=await this['_settingService'][_0x63dacd(0xdb)]();return(_0x4689a3===null||_0x4689a3===void 0x0?void 0x0:_0x4689a3[_0x63dacd(0xae)])||_0x1dfe0e['piName']||_0x63dacd(0xbe);}catch(_0x526f1f){return this[_0x63dacd(0xed)][_0x63dacd(0xbb)]('Failed\x20to\x20get\x20device\x20name\x20from\x20SettingService,\x20falling\x20back\x20to\x20details.piName\x20or\x20default.'),_0x1dfe0e[_0x63dacd(0x9f)]||'Unknown\x20Device';}}};EmailService=EmailService_1=__decorate([(0x0,common_1[a79_0x5a77b9(0xbc)])(),__metadata('design:paramtypes',[setting_service_1[a79_0x5a77b9(0xb3)]])],EmailService),exports[a79_0x5a77b9(0xc8)]=EmailService;