'use strict';const a79_0x46dbb2=a79_0x5135;(function(_0x1853c6,_0x171c47){const _0x46c522=a79_0x5135,_0x4b6a19=_0x1853c6();while(!![]){try{const _0x37e3c5=parseInt(_0x46c522(0x1fb))/0x1*(-parseInt(_0x46c522(0x1e8))/0x2)+parseInt(_0x46c522(0x1e9))/0x3+-parseInt(_0x46c522(0x1ba))/0x4*(parseInt(_0x46c522(0x1bb))/0x5)+parseInt(_0x46c522(0x1bc))/0x6*(parseInt(_0x46c522(0x1ec))/0x7)+-parseInt(_0x46c522(0x1f8))/0x8+-parseInt(_0x46c522(0x1cc))/0x9*(-parseInt(_0x46c522(0x1f4))/0xa)+parseInt(_0x46c522(0x202))/0xb*(parseInt(_0x46c522(0x1d7))/0xc);if(_0x37e3c5===_0x171c47)break;else _0x4b6a19['push'](_0x4b6a19['shift']());}catch(_0x242dda){_0x4b6a19['push'](_0x4b6a19['shift']());}}}(a79_0x1e1d,0x3e833));function a79_0x1e1d(){const _0x5ba1cb=['url','EmailService','trim','metadata','Unknown\x20Device','</pre>\x0a\x20\x20\x20\x20','message','Injectable','isEmailConfigured','formatExceptionEmail','method','_settingService','SMTP_PASS','39302eieTiu','612939MgTkjA','defineProperty','N/A','37569rZCRBk','../setting/setting.service','headers','\x0aUnhandled\x20Exception\x20Notification\x0a\x0aDevice:\x20','\x0aRequest\x20Method:\x20','\x0a\x0aException\x20Message:\x0a','getDeviceName','transporter','1445190LbPCIk','object','__metadata','SMTP_HOST','4009968CfoNFT','</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Body:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','piName','23ITTJuT','error','\x0aTimestamp:\x20','findFirst','SMTP_PORT','Email\x20configuration\x20not\x20found.\x20Exception\x20email\x20notifications\x20will\x20be\x20disabled.','design:paramtypes','578677DDXCYA','__esModule','sendMail','logger','\x0a\x0aRequest\x20Body:\x0a','Failed\x20to\x20get\x20device\x20name\x20from\x20SettingService,\x20falling\x20back\x20to\x20details.piName\x20or\x20default.','Exception\x20notification\x20email\x20sent\x20successfully','Logger','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20URL:</strong>\x20','219412HAcvhK','30ZaRjxO','36gpiHQb',']\x20Unhandled\x20Exception\x20Occurred','env','\x22Exception\x20Notifier\x22\x20<no-reply@absolutepa.com>','length','</p>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Exception\x20Message:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','EXCEPTION_NOTIFY_EMAIL','body','\x0a\x0aRequest\x20Headers:\x0a','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Timestamp:</strong>\x20','warn','debug','@nestjs/common','name','timestamp','toISOString','9SZOSjx','\x0a\x20\x20\x20\x20\x20\x20<h2>Unhandled\x20Exception\x20Notification</h2>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Device:</strong>\x20','decorate','sendExceptionNotification','Failed\x20to\x20send\x20exception\x20notification\x20email:','SMTP_FROM','stringify','createTransport','function','587','nodemailer','264rcblDJ','\x0a\x20\x20\x20\x20','log','SMTP_USER'];a79_0x1e1d=function(){return _0x5ba1cb;};return a79_0x1e1d();}var __decorate=this&&this['__decorate']||function(_0x6ca295,_0x5b3152,_0x35f8ab,_0x4e3fb5){const _0x3ca0e7=a79_0x5135;var _0x220ac9=arguments[_0x3ca0e7(0x1c0)],_0x28d7dc=_0x220ac9<0x3?_0x5b3152:_0x4e3fb5===null?_0x4e3fb5=Object['getOwnPropertyDescriptor'](_0x5b3152,_0x35f8ab):_0x4e3fb5,_0x231618;if(typeof Reflect===_0x3ca0e7(0x1f5)&&typeof Reflect[_0x3ca0e7(0x1ce)]==='function')_0x28d7dc=Reflect[_0x3ca0e7(0x1ce)](_0x6ca295,_0x5b3152,_0x35f8ab,_0x4e3fb5);else{for(var _0x440ad0=_0x6ca295['length']-0x1;_0x440ad0>=0x0;_0x440ad0--)if(_0x231618=_0x6ca295[_0x440ad0])_0x28d7dc=(_0x220ac9<0x3?_0x231618(_0x28d7dc):_0x220ac9>0x3?_0x231618(_0x5b3152,_0x35f8ab,_0x28d7dc):_0x231618(_0x5b3152,_0x35f8ab))||_0x28d7dc;}return _0x220ac9>0x3&&_0x28d7dc&&Object['defineProperty'](_0x5b3152,_0x35f8ab,_0x28d7dc),_0x28d7dc;},__metadata=this&&this[a79_0x46dbb2(0x1f6)]||function(_0x1faf83,_0x2d0c0a){const _0x254d74=a79_0x46dbb2;if(typeof Reflect===_0x254d74(0x1f5)&&typeof Reflect[_0x254d74(0x1de)]===_0x254d74(0x1d4))return Reflect[_0x254d74(0x1de)](_0x1faf83,_0x2d0c0a);},EmailService_1;Object[a79_0x46dbb2(0x1ea)](exports,a79_0x46dbb2(0x203),{'value':!![]}),exports[a79_0x46dbb2(0x1dc)]=void 0x0;const common_1=require(a79_0x46dbb2(0x1c8)),nodemailer=require(a79_0x46dbb2(0x1d6)),setting_service_1=require(a79_0x46dbb2(0x1ed));let EmailService=EmailService_1=class EmailService{constructor(_0x6242dc){const _0x2b9103=a79_0x46dbb2;this[_0x2b9103(0x1e6)]=_0x6242dc,this[_0x2b9103(0x1b4)]=new common_1[(_0x2b9103(0x1b8))](EmailService_1[_0x2b9103(0x1c9)]),this['createTransporter']();}['createTransporter'](){const _0x5b98d6=a79_0x46dbb2;this['isEmailConfigured']()?this[_0x5b98d6(0x1f3)]=nodemailer[_0x5b98d6(0x1d3)]({'host':process['env'][_0x5b98d6(0x1f7)],'port':parseInt(process[_0x5b98d6(0x1be)][_0x5b98d6(0x1ff)]||_0x5b98d6(0x1d5)),'secure':process['env']['SMTP_SECURE']==='true','auth':{'user':process['env'][_0x5b98d6(0x1da)],'pass':process[_0x5b98d6(0x1be)]['SMTP_PASS']}}):this[_0x5b98d6(0x1b4)][_0x5b98d6(0x1c6)](_0x5b98d6(0x200));}['isEmailConfigured'](){const _0x2674de=a79_0x46dbb2;return!!(process[_0x2674de(0x1be)][_0x2674de(0x1f7)]&&process[_0x2674de(0x1be)][_0x2674de(0x1da)]&&process[_0x2674de(0x1be)][_0x2674de(0x1e7)]&&process[_0x2674de(0x1be)][_0x2674de(0x1c2)]);}async[a79_0x46dbb2(0x1cf)](_0x5d29fc){const _0x383991=a79_0x46dbb2;if(!this[_0x383991(0x1f3)]||!this[_0x383991(0x1e3)]()){this[_0x383991(0x1b4)][_0x383991(0x1c7)]('Email\x20not\x20configured,\x20skipping\x20exception\x20notification');return;}const _0x435691=await this[_0x383991(0x1f2)](_0x5d29fc);try{const _0xfd90d1=this[_0x383991(0x1e4)](_0x5d29fc,_0x435691);await this[_0x383991(0x1f3)][_0x383991(0x1b3)]({'from':process[_0x383991(0x1be)][_0x383991(0x1d1)]||_0x383991(0x1bf),'to':process['env'][_0x383991(0x1c2)],'subject':'['+_0x435691+_0x383991(0x1bd),'text':_0xfd90d1,'html':this['formatExceptionEmailHtml'](_0x5d29fc,_0x435691)}),this['logger'][_0x383991(0x1d9)](_0x383991(0x1b7));}catch(_0x420bb2){this['logger'][_0x383991(0x1fc)](_0x383991(0x1d0),_0x420bb2);}}[a79_0x46dbb2(0x1e4)](_0x2cc0c2,_0x5ea201){const _0x541bb2=a79_0x46dbb2;return(_0x541bb2(0x1ef)+_0x5ea201+_0x541bb2(0x1fd)+(_0x2cc0c2['timestamp']||new Date()[_0x541bb2(0x1cb)]())+'\x0aRequest\x20URL:\x20'+(_0x2cc0c2['url']||_0x541bb2(0x1eb))+_0x541bb2(0x1f0)+(_0x2cc0c2['method']||_0x541bb2(0x1eb))+_0x541bb2(0x1f1)+_0x2cc0c2[_0x541bb2(0x1e1)]+_0x541bb2(0x1b5)+(_0x2cc0c2[_0x541bb2(0x1c3)]?JSON[_0x541bb2(0x1d2)](_0x2cc0c2[_0x541bb2(0x1c3)],null,0x2):_0x541bb2(0x1eb))+_0x541bb2(0x1c4)+(_0x2cc0c2[_0x541bb2(0x1ee)]?JSON[_0x541bb2(0x1d2)](_0x2cc0c2[_0x541bb2(0x1ee)],null,0x2):_0x541bb2(0x1eb))+_0x541bb2(0x1d8))[_0x541bb2(0x1dd)]();}['formatExceptionEmailHtml'](_0x26287f,_0x59ec0e){const _0x535d8d=a79_0x46dbb2;return _0x535d8d(0x1cd)+_0x59ec0e+_0x535d8d(0x1c5)+(_0x26287f[_0x535d8d(0x1ca)]||new Date()[_0x535d8d(0x1cb)]())+_0x535d8d(0x1b9)+(_0x26287f[_0x535d8d(0x1db)]||'N/A')+'</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20Method:</strong>\x20'+(_0x26287f[_0x535d8d(0x1e5)]||_0x535d8d(0x1eb))+_0x535d8d(0x1c1)+_0x26287f[_0x535d8d(0x1e1)]+_0x535d8d(0x1f9)+(_0x26287f[_0x535d8d(0x1c3)]?JSON[_0x535d8d(0x1d2)](_0x26287f[_0x535d8d(0x1c3)],null,0x2):_0x535d8d(0x1eb))+'</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Headers:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>'+(_0x26287f['headers']?JSON[_0x535d8d(0x1d2)](_0x26287f[_0x535d8d(0x1ee)],null,0x2):'N/A')+_0x535d8d(0x1e0);}async[a79_0x46dbb2(0x1f2)](_0x426f92){const _0x17877d=a79_0x46dbb2;try{const _0x4efaf7=await this['_settingService'][_0x17877d(0x1fe)]();return(_0x4efaf7===null||_0x4efaf7===void 0x0?void 0x0:_0x4efaf7['schoolId'])||_0x426f92[_0x17877d(0x1fa)]||'Unknown\x20Device';}catch(_0x1eb329){return this[_0x17877d(0x1b4)]['warn'](_0x17877d(0x1b6)),_0x426f92[_0x17877d(0x1fa)]||_0x17877d(0x1df);}}};function a79_0x5135(_0x3d5880,_0xf0576f){const _0x1e1d8d=a79_0x1e1d();return a79_0x5135=function(_0x5135ab,_0x4dec70){_0x5135ab=_0x5135ab-0x1b3;let _0x5d0fb2=_0x1e1d8d[_0x5135ab];return _0x5d0fb2;},a79_0x5135(_0x3d5880,_0xf0576f);}EmailService=EmailService_1=__decorate([(0x0,common_1[a79_0x46dbb2(0x1e2)])(),__metadata(a79_0x46dbb2(0x201),[setting_service_1['SettingService']])],EmailService),exports[a79_0x46dbb2(0x1dc)]=EmailService;