'use strict';const a79_0x58b7d9=a79_0xc99c;(function(_0x1d6e0e,_0x5b3a83){const _0x4b9188=a79_0xc99c,_0x3a7ca7=_0x1d6e0e();while(!![]){try{const _0x2ed87d=-parseInt(_0x4b9188(0x12c))/0x1*(parseInt(_0x4b9188(0x154))/0x2)+-parseInt(_0x4b9188(0x14a))/0x3*(-parseInt(_0x4b9188(0x140))/0x4)+parseInt(_0x4b9188(0x153))/0x5*(-parseInt(_0x4b9188(0x165))/0x6)+-parseInt(_0x4b9188(0x176))/0x7+-parseInt(_0x4b9188(0x150))/0x8*(-parseInt(_0x4b9188(0x156))/0x9)+-parseInt(_0x4b9188(0x138))/0xa+-parseInt(_0x4b9188(0x145))/0xb*(-parseInt(_0x4b9188(0x16d))/0xc);if(_0x2ed87d===_0x5b3a83)break;else _0x3a7ca7['push'](_0x3a7ca7['shift']());}catch(_0xb39cdb){_0x3a7ca7['push'](_0x3a7ca7['shift']());}}}(a79_0x3959,0xba7de));var __decorate=this&&this[a79_0x58b7d9(0x126)]||function(_0x69a8ee,_0x35debe,_0x4e63ec,_0x19145c){const _0x1f64bf=a79_0x58b7d9;var _0x1f39e5=arguments[_0x1f64bf(0x13b)],_0x1b397e=_0x1f39e5<0x3?_0x35debe:_0x19145c===null?_0x19145c=Object[_0x1f64bf(0x167)](_0x35debe,_0x4e63ec):_0x19145c,_0x5e4624;if(typeof Reflect===_0x1f64bf(0x151)&&typeof Reflect[_0x1f64bf(0x14c)]==='function')_0x1b397e=Reflect['decorate'](_0x69a8ee,_0x35debe,_0x4e63ec,_0x19145c);else{for(var _0x587e5b=_0x69a8ee[_0x1f64bf(0x13b)]-0x1;_0x587e5b>=0x0;_0x587e5b--)if(_0x5e4624=_0x69a8ee[_0x587e5b])_0x1b397e=(_0x1f39e5<0x3?_0x5e4624(_0x1b397e):_0x1f39e5>0x3?_0x5e4624(_0x35debe,_0x4e63ec,_0x1b397e):_0x5e4624(_0x35debe,_0x4e63ec))||_0x1b397e;}return _0x1f39e5>0x3&&_0x1b397e&&Object[_0x1f64bf(0x144)](_0x35debe,_0x4e63ec,_0x1b397e),_0x1b397e;},__metadata=this&&this[a79_0x58b7d9(0x15f)]||function(_0x343419,_0x2fc061){const _0x436fe2=a79_0x58b7d9;if(typeof Reflect===_0x436fe2(0x151)&&typeof Reflect[_0x436fe2(0x160)]==='function')return Reflect[_0x436fe2(0x160)](_0x343419,_0x2fc061);},EmailService_1;Object[a79_0x58b7d9(0x144)](exports,'__esModule',{'value':!![]}),exports[a79_0x58b7d9(0x148)]=void 0x0;function a79_0xc99c(_0x587cb3,_0x16c842){const _0x3959c5=a79_0x3959();return a79_0xc99c=function(_0xc99cbb,_0x3eabd5){_0xc99cbb=_0xc99cbb-0x121;let _0x4f3b9c=_0x3959c5[_0xc99cbb];return _0x4f3b9c;},a79_0xc99c(_0x587cb3,_0x16c842);}const common_1=require(a79_0x58b7d9(0x123)),nodemailer=require(a79_0x58b7d9(0x161)),setting_service_1=require(a79_0x58b7d9(0x13f));function a79_0x3959(){const _0x5f147e=['name','toISOString','formatExceptionEmail','env','\x0a\x0aRequest\x20Headers:\x0a','dev.absolutepa@gmail.com,service@absolutepa.com.au','4354889KJKeTG','createTransport','\x0a\x0aException\x20Message:\x0a','Exception\x20notification\x20email\x20sent\x20successfully','@nestjs/common','\x0a\x0aRequest\x20Body:\x0a','SMTP_FROM','__decorate','587','SMTP_USER','transporter','url','EXCEPTION_NOTIFY_EMAIL','5BDmxhw','true','getDeviceName','logger','defaultToEmail','method','\x0aUnhandled\x20Exception\x20Notification\x0a\x0aDevice:\x20','headers','SMTP_PORT','log','sendMail','isEmailConfigured','13374470nWuAxm','message','SMTP_PASS','length','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20Method:</strong>\x20','\x22Exception\x20Notifier\x22\x20<no-reply@absolutepa.com>','Email\x20not\x20configured,\x20skipping\x20exception\x20notification','../setting/setting.service','4600gyGASj','sendExceptionNotification','SettingService','\x0a\x20\x20\x20\x20\x20\x20<h2>Unhandled\x20Exception\x20Notification</h2>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Device:</strong>\x20','defineProperty','374kqyInD','\x0aTimestamp:\x20','design:paramtypes','EmailService','error','1887evNQFx','Failed\x20to\x20send\x20exception\x20notification\x20email:','decorate','</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Body:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','timestamp','</pre>\x0a\x20\x20\x20\x20','8UHnFXE','object','piName','4904885nIhuom','163238UzhIea','trim','7770672igGOQL','Unknown\x20Device','findFirst','createTransporter','_settingService','warn','formatExceptionEmailHtml','</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Headers:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','schoolId','__metadata','metadata','nodemailer','</p>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Exception\x20Message:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','debug','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Timestamp:</strong>\x20','6iKwspQ','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20URL:</strong>\x20','getOwnPropertyDescriptor','stringify','Injectable','N/A','cachedDeviceName','body','891444hregWW','exdyrljbopqilckb','\x0aRequest\x20Method:\x20'];a79_0x3959=function(){return _0x5f147e;};return a79_0x3959();}let EmailService=EmailService_1=class EmailService{constructor(_0x8b9e28){const _0x343754=a79_0x58b7d9;this[_0x343754(0x15a)]=_0x8b9e28,this[_0x343754(0x12f)]=new common_1['Logger'](EmailService_1[_0x343754(0x170)]),this[_0x343754(0x130)]=_0x343754(0x175),this[_0x343754(0x16b)]=null,this[_0x343754(0x159)]();}async['onModuleInit'](){const _0x42de62=a79_0x58b7d9;try{const _0x212c32=await this[_0x42de62(0x15a)][_0x42de62(0x158)]();this[_0x42de62(0x16b)]=(_0x212c32===null||_0x212c32===void 0x0?void 0x0:_0x212c32[_0x42de62(0x15e)])||null;}catch(_0x5f0c87){this[_0x42de62(0x12f)]['warn']('Failed\x20to\x20cache\x20device\x20name\x20on\x20startup.'),this[_0x42de62(0x16b)]=null;}}[a79_0x58b7d9(0x159)](){const _0x24dbb6=a79_0x58b7d9;this[_0x24dbb6(0x137)]()?this[_0x24dbb6(0x129)]=nodemailer[_0x24dbb6(0x177)]({'host':process[_0x24dbb6(0x173)]['SMTP_HOST'],'port':parseInt(process[_0x24dbb6(0x173)][_0x24dbb6(0x134)]||_0x24dbb6(0x127)),'secure':process[_0x24dbb6(0x173)]['SMTP_SECURE']===_0x24dbb6(0x12d),'auth':{'user':process[_0x24dbb6(0x173)][_0x24dbb6(0x128)],'pass':process[_0x24dbb6(0x173)]['SMTP_PASS']}}):(this[_0x24dbb6(0x12f)][_0x24dbb6(0x15b)]('Email\x20configuration\x20not\x20found.\x20Exceptions\x20will\x20be\x20sent\x20to\x20default\x20address.'),this['transporter']=nodemailer[_0x24dbb6(0x177)]({'host':'smtp.gmail.com','port':0x24b,'secure':![],'auth':{'user':'dev.absolutepa@gmail.com','pass':_0x24dbb6(0x16e)}}));}['isEmailConfigured'](){const _0xcb4741=a79_0x58b7d9;return!!(process[_0xcb4741(0x173)]['SMTP_HOST']&&process[_0xcb4741(0x173)][_0xcb4741(0x128)]&&process[_0xcb4741(0x173)][_0xcb4741(0x13a)]&&process['env']['EXCEPTION_NOTIFY_EMAIL']);}async[a79_0x58b7d9(0x141)](_0x2f98b9){const _0x592686=a79_0x58b7d9;if(!this[_0x592686(0x129)]){this[_0x592686(0x12f)][_0x592686(0x163)](_0x592686(0x13e));return;}const _0x547ecc=await this[_0x592686(0x12e)](_0x2f98b9);try{const _0x23580a=this[_0x592686(0x172)](_0x2f98b9,_0x547ecc);await this[_0x592686(0x129)][_0x592686(0x136)]({'from':process[_0x592686(0x173)][_0x592686(0x125)]||_0x592686(0x13d),'to':process[_0x592686(0x173)][_0x592686(0x12b)]||this[_0x592686(0x130)],'subject':'['+_0x547ecc+']\x20Unhandled\x20Exception\x20Occurred','text':_0x23580a,'html':this[_0x592686(0x15c)](_0x2f98b9,_0x547ecc)}),this[_0x592686(0x12f)][_0x592686(0x135)](_0x592686(0x122));}catch(_0x4258fc){this['logger'][_0x592686(0x149)](_0x592686(0x14b),_0x4258fc);}}[a79_0x58b7d9(0x172)](_0x4d7f2d,_0x42bdc2){const _0x412698=a79_0x58b7d9;return(_0x412698(0x132)+_0x42bdc2+_0x412698(0x146)+(_0x4d7f2d[_0x412698(0x14e)]||new Date()[_0x412698(0x171)]())+'\x0aRequest\x20URL:\x20'+(_0x4d7f2d[_0x412698(0x12a)]||'N/A')+_0x412698(0x16f)+(_0x4d7f2d[_0x412698(0x131)]||_0x412698(0x16a))+_0x412698(0x121)+_0x4d7f2d[_0x412698(0x139)]+_0x412698(0x124)+(_0x4d7f2d[_0x412698(0x16c)]?JSON[_0x412698(0x168)](_0x4d7f2d[_0x412698(0x16c)],null,0x2):_0x412698(0x16a))+_0x412698(0x174)+(_0x4d7f2d[_0x412698(0x133)]?JSON[_0x412698(0x168)](_0x4d7f2d[_0x412698(0x133)],null,0x2):_0x412698(0x16a))+'\x0a\x20\x20\x20\x20')[_0x412698(0x155)]();}['formatExceptionEmailHtml'](_0x1f0d20,_0x4f31f4){const _0xea8c49=a79_0x58b7d9;return _0xea8c49(0x143)+_0x4f31f4+_0xea8c49(0x164)+(_0x1f0d20[_0xea8c49(0x14e)]||new Date()[_0xea8c49(0x171)]())+_0xea8c49(0x166)+(_0x1f0d20[_0xea8c49(0x12a)]||_0xea8c49(0x16a))+_0xea8c49(0x13c)+(_0x1f0d20[_0xea8c49(0x131)]||'N/A')+_0xea8c49(0x162)+_0x1f0d20[_0xea8c49(0x139)]+_0xea8c49(0x14d)+(_0x1f0d20[_0xea8c49(0x16c)]?JSON[_0xea8c49(0x168)](_0x1f0d20['body'],null,0x2):'N/A')+_0xea8c49(0x15d)+(_0x1f0d20[_0xea8c49(0x133)]?JSON[_0xea8c49(0x168)](_0x1f0d20['headers'],null,0x2):'N/A')+_0xea8c49(0x14f);}async[a79_0x58b7d9(0x12e)](_0x1ca0b7){const _0x41adcf=a79_0x58b7d9;if(this[_0x41adcf(0x16b)])return this[_0x41adcf(0x16b)];try{const _0xbb5405=await this[_0x41adcf(0x15a)]['findFirst']();return(_0xbb5405===null||_0xbb5405===void 0x0?void 0x0:_0xbb5405[_0x41adcf(0x15e)])||_0x1ca0b7[_0x41adcf(0x152)]||_0x41adcf(0x157);}catch(_0x30b3b4){return this['logger'][_0x41adcf(0x15b)]('Failed\x20to\x20get\x20device\x20name\x20from\x20SettingService,\x20falling\x20back\x20to\x20details.piName\x20or\x20default.'),_0x1ca0b7['piName']||_0x41adcf(0x157);}}};EmailService=EmailService_1=__decorate([(0x0,common_1[a79_0x58b7d9(0x169)])(),__metadata(a79_0x58b7d9(0x147),[setting_service_1[a79_0x58b7d9(0x142)]])],EmailService),exports[a79_0x58b7d9(0x148)]=EmailService;