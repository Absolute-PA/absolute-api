'use strict';const a79_0x5f1fdc=a79_0x2353;(function(_0x7a5fb9,_0x172287){const _0xa4fcf3=a79_0x2353,_0x19e045=_0x7a5fb9();while(!![]){try{const _0x55e152=-parseInt(_0xa4fcf3(0x1d7))/0x1*(-parseInt(_0xa4fcf3(0x1e4))/0x2)+parseInt(_0xa4fcf3(0x204))/0x3+parseInt(_0xa4fcf3(0x206))/0x4*(-parseInt(_0xa4fcf3(0x1e1))/0x5)+-parseInt(_0xa4fcf3(0x202))/0x6*(-parseInt(_0xa4fcf3(0x200))/0x7)+-parseInt(_0xa4fcf3(0x1cf))/0x8+-parseInt(_0xa4fcf3(0x209))/0x9*(parseInt(_0xa4fcf3(0x1d4))/0xa)+parseInt(_0xa4fcf3(0x1fa))/0xb;if(_0x55e152===_0x172287)break;else _0x19e045['push'](_0x19e045['shift']());}catch(_0x3b09ae){_0x19e045['push'](_0x19e045['shift']());}}}(a79_0x2c96,0x8995e));var __decorate=this&&this['__decorate']||function(_0x4a4cfc,_0x3e4488,_0x2af616,_0x59fccb){const _0x2593c4=a79_0x2353;var _0xbaf57=arguments['length'],_0x1dabe3=_0xbaf57<0x3?_0x3e4488:_0x59fccb===null?_0x59fccb=Object[_0x2593c4(0x1f3)](_0x3e4488,_0x2af616):_0x59fccb,_0x5980cb;if(typeof Reflect===_0x2593c4(0x1d3)&&typeof Reflect[_0x2593c4(0x21c)]==='function')_0x1dabe3=Reflect[_0x2593c4(0x21c)](_0x4a4cfc,_0x3e4488,_0x2af616,_0x59fccb);else{for(var _0xe60cf5=_0x4a4cfc[_0x2593c4(0x218)]-0x1;_0xe60cf5>=0x0;_0xe60cf5--)if(_0x5980cb=_0x4a4cfc[_0xe60cf5])_0x1dabe3=(_0xbaf57<0x3?_0x5980cb(_0x1dabe3):_0xbaf57>0x3?_0x5980cb(_0x3e4488,_0x2af616,_0x1dabe3):_0x5980cb(_0x3e4488,_0x2af616))||_0x1dabe3;}return _0xbaf57>0x3&&_0x1dabe3&&Object[_0x2593c4(0x205)](_0x3e4488,_0x2af616,_0x1dabe3),_0x1dabe3;},__metadata=this&&this['__metadata']||function(_0xd00443,_0xb384d1){const _0x24e76c=a79_0x2353;if(typeof Reflect==='object'&&typeof Reflect['metadata']==='function')return Reflect[_0x24e76c(0x213)](_0xd00443,_0xb384d1);},EmailService_1;Object['defineProperty'](exports,a79_0x5f1fdc(0x1f1),{'value':!![]}),exports[a79_0x5f1fdc(0x212)]=void 0x0;const common_1=require(a79_0x5f1fdc(0x1f5)),nodemailer=require(a79_0x5f1fdc(0x1f4)),setting_service_1=require('../setting/setting.service');let EmailService=EmailService_1=class EmailService{constructor(_0x39455b){const _0x2d3623=a79_0x5f1fdc;this[_0x2d3623(0x1d0)]=_0x39455b,this[_0x2d3623(0x20d)]=new common_1[(_0x2d3623(0x20c))](EmailService_1[_0x2d3623(0x211)]),this[_0x2d3623(0x1fd)]=_0x2d3623(0x208),this[_0x2d3623(0x1ff)]=null,this[_0x2d3623(0x1fb)]();}async[a79_0x5f1fdc(0x20b)](){const _0x30c358=a79_0x5f1fdc;try{const _0x30563f=await this[_0x30c358(0x1d0)][_0x30c358(0x1ed)]();this['cachedDeviceName']=(_0x30563f===null||_0x30563f===void 0x0?void 0x0:_0x30563f[_0x30c358(0x20a)])||null;}catch(_0x5646ab){this['logger'][_0x30c358(0x1e7)](_0x30c358(0x1f0)),this[_0x30c358(0x1ff)]=null;}}[a79_0x5f1fdc(0x1fb)](){const _0x523915=a79_0x5f1fdc;this[_0x523915(0x217)]()?this[_0x523915(0x1e8)]=nodemailer[_0x523915(0x214)]({'host':process[_0x523915(0x1de)][_0x523915(0x1fe)],'port':parseInt(process['env']['SMTP_PORT']||_0x523915(0x1dc)),'secure':process[_0x523915(0x1de)][_0x523915(0x1e6)]===_0x523915(0x203),'auth':{'user':process[_0x523915(0x1de)][_0x523915(0x1e0)],'pass':process[_0x523915(0x1de)][_0x523915(0x1ee)]}}):(this[_0x523915(0x20d)][_0x523915(0x1e7)](_0x523915(0x1f6)),this['transporter']=nodemailer[_0x523915(0x214)]({'host':_0x523915(0x1cb),'port':0x24b,'secure':![],'auth':{'user':_0x523915(0x20f),'pass':_0x523915(0x1da)}}));}['isEmailConfigured'](){const _0x113343=a79_0x5f1fdc;return!!(process['env'][_0x113343(0x1fe)]&&process[_0x113343(0x1de)]['SMTP_USER']&&process[_0x113343(0x1de)]['SMTP_PASS']&&process[_0x113343(0x1de)][_0x113343(0x21a)]);}async[a79_0x5f1fdc(0x1f9)](_0xef9222){const _0x400418=a79_0x5f1fdc;if(!this[_0x400418(0x1e8)]){this[_0x400418(0x20d)][_0x400418(0x1d9)]('Email\x20not\x20configured,\x20skipping\x20exception\x20notification');return;}const _0x5ca635=await this['getDeviceName'](_0xef9222);try{const _0x21c8c6=this[_0x400418(0x215)](_0xef9222,_0x5ca635);await this[_0x400418(0x1e8)][_0x400418(0x1f2)]({'from':process['env']['SMTP_FROM']||_0x400418(0x1e9),'to':process[_0x400418(0x1de)][_0x400418(0x21a)]||this[_0x400418(0x1fd)],'subject':'['+_0x5ca635+_0x400418(0x1d1),'text':_0x21c8c6,'html':this[_0x400418(0x1d5)](_0xef9222,_0x5ca635)}),this[_0x400418(0x20d)][_0x400418(0x1db)](_0x400418(0x1ce));}catch(_0x2453bd){this[_0x400418(0x20d)]['error']('Failed\x20to\x20send\x20exception\x20notification\x20email:',_0x2453bd);}}[a79_0x5f1fdc(0x215)](_0x32045a,_0x339985){const _0x1656bb=a79_0x5f1fdc;return(_0x1656bb(0x1d8)+_0x339985+_0x1656bb(0x1cc)+(_0x32045a['timestamp']||new Date()['toISOString']())+_0x1656bb(0x1f8)+(_0x32045a[_0x1656bb(0x201)]||_0x1656bb(0x21b))+_0x1656bb(0x1e3)+(_0x32045a[_0x1656bb(0x1e5)]||_0x1656bb(0x21b))+'\x0a\x0aException\x20Message:\x0a'+_0x32045a[_0x1656bb(0x1ea)]+'\x0a\x0aRequest\x20Body:\x0a'+(_0x32045a[_0x1656bb(0x210)]?JSON[_0x1656bb(0x1ef)](_0x32045a[_0x1656bb(0x210)],null,0x2):'N/A')+_0x1656bb(0x21d)+(_0x32045a[_0x1656bb(0x1f7)]?JSON['stringify'](_0x32045a[_0x1656bb(0x1f7)],null,0x2):_0x1656bb(0x21b))+_0x1656bb(0x1df))[_0x1656bb(0x20e)]();}['formatExceptionEmailHtml'](_0x53f6c3,_0x618c77){const _0x5604f7=a79_0x5f1fdc;return _0x5604f7(0x1eb)+_0x618c77+_0x5604f7(0x1cd)+(_0x53f6c3['timestamp']||new Date()['toISOString']())+'</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20URL:</strong>\x20'+(_0x53f6c3[_0x5604f7(0x201)]||_0x5604f7(0x21b))+_0x5604f7(0x1ca)+(_0x53f6c3[_0x5604f7(0x1e5)]||'N/A')+'</p>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Exception\x20Message:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>'+_0x53f6c3[_0x5604f7(0x1ea)]+_0x5604f7(0x1dd)+(_0x53f6c3[_0x5604f7(0x210)]?JSON['stringify'](_0x53f6c3['body'],null,0x2):_0x5604f7(0x21b))+_0x5604f7(0x1d2)+(_0x53f6c3['headers']?JSON[_0x5604f7(0x1ef)](_0x53f6c3['headers'],null,0x2):_0x5604f7(0x21b))+_0x5604f7(0x219);}async[a79_0x5f1fdc(0x1d6)](_0x19cc54){const _0x24c9c0=a79_0x5f1fdc;if(this[_0x24c9c0(0x1ff)])return this[_0x24c9c0(0x1ff)];try{const _0x40b888=await this[_0x24c9c0(0x1d0)]['findFirst']();return(_0x40b888===null||_0x40b888===void 0x0?void 0x0:_0x40b888[_0x24c9c0(0x20a)])||_0x19cc54['piName']||_0x24c9c0(0x207);}catch(_0x51bd32){return this[_0x24c9c0(0x20d)][_0x24c9c0(0x1e7)](_0x24c9c0(0x1e2)),_0x19cc54['piName']||_0x24c9c0(0x207);}}};function a79_0x2c96(){const _0x2781f2=['Exception\x20notification\x20email\x20sent\x20successfully','3573424RuQmTz','_settingService',']\x20Unhandled\x20Exception\x20Occurred','</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Headers:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','object','9519630LlnLfg','formatExceptionEmailHtml','getDeviceName','65PaLYGn','\x0aUnhandled\x20Exception\x20Notification\x0a\x0aDevice:\x20','debug','exdyrljbopqilckb','log','587','</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Body:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','env','\x0a\x20\x20\x20\x20','SMTP_USER','1700645GWoqXE','Failed\x20to\x20get\x20device\x20name\x20from\x20SettingService,\x20falling\x20back\x20to\x20details.piName\x20or\x20default.','\x0aRequest\x20Method:\x20','18660uyQLbb','method','SMTP_SECURE','warn','transporter','\x22Exception\x20Notifier\x22\x20<no-reply@absolutepa.com>','message','\x0a\x20\x20\x20\x20\x20\x20<h2>Unhandled\x20Exception\x20Notification</h2>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Device:</strong>\x20','SettingService','findFirst','SMTP_PASS','stringify','Failed\x20to\x20cache\x20device\x20name\x20on\x20startup.','__esModule','sendMail','getOwnPropertyDescriptor','nodemailer','@nestjs/common','Email\x20configuration\x20not\x20found.\x20Exceptions\x20will\x20be\x20sent\x20to\x20default\x20address.','headers','\x0aRequest\x20URL:\x20','sendExceptionNotification','12182522DEvMVU','createTransporter','design:paramtypes','defaultToEmail','SMTP_HOST','cachedDeviceName','42uMtfNN','url','798918NqvKlH','true','1409124eXlgDP','defineProperty','12lIORnR','Unknown\x20Device','dev.absolutepa@gmail.com,service@absolutepa.com.au','9TPEHbX','schoolId','onModuleInit','Logger','logger','trim','dev.absolutepa@gmail.com','body','name','EmailService','metadata','createTransport','formatExceptionEmail','Injectable','isEmailConfigured','length','</pre>\x0a\x20\x20\x20\x20','EXCEPTION_NOTIFY_EMAIL','N/A','decorate','\x0a\x0aRequest\x20Headers:\x0a','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20Method:</strong>\x20','smtp.gmail.com','\x0aTimestamp:\x20','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Timestamp:</strong>\x20'];a79_0x2c96=function(){return _0x2781f2;};return a79_0x2c96();}function a79_0x2353(_0x420c55,_0x461ff6){const _0x2c9654=a79_0x2c96();return a79_0x2353=function(_0x235341,_0x5c8783){_0x235341=_0x235341-0x1ca;let _0x419a76=_0x2c9654[_0x235341];return _0x419a76;},a79_0x2353(_0x420c55,_0x461ff6);}EmailService=EmailService_1=__decorate([(0x0,common_1[a79_0x5f1fdc(0x216)])(),__metadata(a79_0x5f1fdc(0x1fc),[setting_service_1[a79_0x5f1fdc(0x1ec)]])],EmailService),exports[a79_0x5f1fdc(0x212)]=EmailService;