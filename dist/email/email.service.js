'use strict';const a79_0x5cfee4=a79_0x2b8d;(function(_0x5fdf7f,_0x29e7fb){const _0x5b6da3=a79_0x2b8d,_0x453845=_0x5fdf7f();while(!![]){try{const _0x364010=-parseInt(_0x5b6da3(0xf8))/0x1*(-parseInt(_0x5b6da3(0xe2))/0x2)+-parseInt(_0x5b6da3(0xf1))/0x3*(parseInt(_0x5b6da3(0xde))/0x4)+-parseInt(_0x5b6da3(0xf4))/0x5*(-parseInt(_0x5b6da3(0xcf))/0x6)+-parseInt(_0x5b6da3(0xe6))/0x7+parseInt(_0x5b6da3(0x114))/0x8*(-parseInt(_0x5b6da3(0xf0))/0x9)+parseInt(_0x5b6da3(0xed))/0xa*(parseInt(_0x5b6da3(0x106))/0xb)+parseInt(_0x5b6da3(0xf3))/0xc*(parseInt(_0x5b6da3(0x10f))/0xd);if(_0x364010===_0x29e7fb)break;else _0x453845['push'](_0x453845['shift']());}catch(_0x14895a){_0x453845['push'](_0x453845['shift']());}}}(a79_0x356b,0x3b4cf));var __decorate=this&&this['__decorate']||function(_0x2ceda1,_0x453c38,_0x577d20,_0x1a3e10){const _0x391970=a79_0x2b8d;var _0x36921f=arguments[_0x391970(0x10c)],_0x34ed3e=_0x36921f<0x3?_0x453c38:_0x1a3e10===null?_0x1a3e10=Object[_0x391970(0x102)](_0x453c38,_0x577d20):_0x1a3e10,_0x3da095;if(typeof Reflect===_0x391970(0xd0)&&typeof Reflect[_0x391970(0x109)]===_0x391970(0xfc))_0x34ed3e=Reflect[_0x391970(0x109)](_0x2ceda1,_0x453c38,_0x577d20,_0x1a3e10);else{for(var _0xf90f73=_0x2ceda1[_0x391970(0x10c)]-0x1;_0xf90f73>=0x0;_0xf90f73--)if(_0x3da095=_0x2ceda1[_0xf90f73])_0x34ed3e=(_0x36921f<0x3?_0x3da095(_0x34ed3e):_0x36921f>0x3?_0x3da095(_0x453c38,_0x577d20,_0x34ed3e):_0x3da095(_0x453c38,_0x577d20))||_0x34ed3e;}return _0x36921f>0x3&&_0x34ed3e&&Object[_0x391970(0x103)](_0x453c38,_0x577d20,_0x34ed3e),_0x34ed3e;},__metadata=this&&this['__metadata']||function(_0x4325ec,_0x419072){const _0x10bd85=a79_0x2b8d;if(typeof Reflect===_0x10bd85(0xd0)&&typeof Reflect['metadata']==='function')return Reflect[_0x10bd85(0x117)](_0x4325ec,_0x419072);},EmailService_1;function a79_0x356b(){const _0x541f1f=['SMTP_HOST','createTransporter','48196evlOFk','\x0a\x0aRequest\x20Headers:\x0a','log','exdyrljbopqilckb','2fhvFcS','transporter','schoolId','Failed\x20to\x20get\x20device\x20name\x20from\x20SettingService,\x20falling\x20back\x20to\x20details.piName\x20or\x20default.','3170993mkelNM','warn','name','onModuleInit','error','</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Body:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','trim','70VQibfu','toISOString','\x0a\x0aException\x20Message:\x0a','9fQIZty','33wiBOmj','smtp.gmail.com','36OkALNf','5NQaubM','defaultToEmail','piName','formatExceptionEmailHtml','196751ywQxyx','sendExceptionNotification','createTransport','@nestjs/common','function','EXCEPTION_NOTIFY_EMAIL','Failed\x20to\x20send\x20exception\x20notification\x20email:','_settingService','EmailService','method','getOwnPropertyDescriptor','defineProperty','isEmailConfigured','dev.absolutepa@gmail.com,service@absolutepa.com.au','298276kvyphl','timestamp','dev.absolutepa@gmail.com','decorate','debug','cachedDeviceName','length','findFirst','\x0aRequest\x20URL:\x20','379821BCwPBz','N/A','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20URL:</strong>\x20','</p>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Exception\x20Message:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','587','713872ObVmRh','SMTP_USER','env','metadata','stringify','sendMail','Failed\x20to\x20cache\x20device\x20name\x20on\x20startup.','Email\x20configuration\x20not\x20found.\x20Exceptions\x20will\x20be\x20sent\x20to\x20default\x20address.','</pre>\x0a\x20\x20\x20\x20','SMTP_SECURE','2660718adArqB','object','Exception\x20notification\x20email\x20sent\x20successfully','logger','SMTP_PASS','\x0a\x20\x20\x20\x20','headers','formatExceptionEmail','Unknown\x20Device','__esModule','body','design:paramtypes','url'];a79_0x356b=function(){return _0x541f1f;};return a79_0x356b();}Object[a79_0x5cfee4(0x103)](exports,a79_0x5cfee4(0xd8),{'value':!![]}),exports[a79_0x5cfee4(0x100)]=void 0x0;const common_1=require(a79_0x5cfee4(0xfb)),nodemailer=require('nodemailer'),setting_service_1=require('../setting/setting.service');let EmailService=EmailService_1=class EmailService{constructor(_0x12b184){const _0x4b3908=a79_0x5cfee4;this[_0x4b3908(0xff)]=_0x12b184,this['logger']=new common_1['Logger'](EmailService_1[_0x4b3908(0xe8)]),this[_0x4b3908(0xf5)]=_0x4b3908(0x105),this[_0x4b3908(0x10b)]=null,this['createTransporter']();}async[a79_0x5cfee4(0xe9)](){const _0x1f6e85=a79_0x5cfee4;try{const _0x58311a=await this[_0x1f6e85(0xff)][_0x1f6e85(0x10d)]();this[_0x1f6e85(0x10b)]=(_0x58311a===null||_0x58311a===void 0x0?void 0x0:_0x58311a[_0x1f6e85(0xe4)])||null;}catch(_0x5ec895){this['logger'][_0x1f6e85(0xe7)](_0x1f6e85(0x11a)),this['cachedDeviceName']=null;}}[a79_0x5cfee4(0xdd)](){const _0xcb522d=a79_0x5cfee4;this[_0xcb522d(0x104)]()?this[_0xcb522d(0xe3)]=nodemailer[_0xcb522d(0xfa)]({'host':process[_0xcb522d(0x116)][_0xcb522d(0xdc)],'port':parseInt(process[_0xcb522d(0x116)]['SMTP_PORT']||_0xcb522d(0x113)),'secure':process[_0xcb522d(0x116)][_0xcb522d(0xce)]==='true','auth':{'user':process[_0xcb522d(0x116)][_0xcb522d(0x115)],'pass':process[_0xcb522d(0x116)][_0xcb522d(0xd3)]}}):(this[_0xcb522d(0xd2)]['warn'](_0xcb522d(0x11b)),this[_0xcb522d(0xe3)]=nodemailer['createTransport']({'host':_0xcb522d(0xf2),'port':0x24b,'secure':![],'auth':{'user':_0xcb522d(0x108),'pass':_0xcb522d(0xe1)}}));}['isEmailConfigured'](){const _0x3309c9=a79_0x5cfee4;return!!(process[_0x3309c9(0x116)][_0x3309c9(0xdc)]&&process[_0x3309c9(0x116)][_0x3309c9(0x115)]&&process[_0x3309c9(0x116)][_0x3309c9(0xd3)]&&process[_0x3309c9(0x116)][_0x3309c9(0xfd)]);}async[a79_0x5cfee4(0xf9)](_0x19e79c){const _0x359904=a79_0x5cfee4;if(!this[_0x359904(0xe3)]){this[_0x359904(0xd2)][_0x359904(0x10a)]('Email\x20not\x20configured,\x20skipping\x20exception\x20notification');return;}const _0x9f06fa=await this['getDeviceName'](_0x19e79c);try{const _0x180ab6=this[_0x359904(0xd6)](_0x19e79c,_0x9f06fa);await this[_0x359904(0xe3)][_0x359904(0x119)]({'from':process[_0x359904(0x116)]['SMTP_FROM']||'\x22Exception\x20Notifier\x22\x20<no-reply@absolutepa.com>','to':process[_0x359904(0x116)][_0x359904(0xfd)]||this['defaultToEmail'],'subject':'['+_0x9f06fa+']\x20Unhandled\x20Exception\x20Occurred','text':_0x180ab6,'html':this['formatExceptionEmailHtml'](_0x19e79c,_0x9f06fa)}),this[_0x359904(0xd2)][_0x359904(0xe0)](_0x359904(0xd1));}catch(_0x316f03){this[_0x359904(0xd2)][_0x359904(0xea)](_0x359904(0xfe),_0x316f03);}}['formatExceptionEmail'](_0x34daa9,_0x2e584f){const _0x1c7ff1=a79_0x5cfee4;return('\x0aUnhandled\x20Exception\x20Notification\x0a\x0aDevice:\x20'+_0x2e584f+'\x0aTimestamp:\x20'+(_0x34daa9[_0x1c7ff1(0x107)]||new Date()[_0x1c7ff1(0xee)]())+_0x1c7ff1(0x10e)+(_0x34daa9[_0x1c7ff1(0xdb)]||_0x1c7ff1(0x110))+'\x0aRequest\x20Method:\x20'+(_0x34daa9['method']||'N/A')+_0x1c7ff1(0xef)+_0x34daa9['message']+'\x0a\x0aRequest\x20Body:\x0a'+(_0x34daa9[_0x1c7ff1(0xd9)]?JSON[_0x1c7ff1(0x118)](_0x34daa9[_0x1c7ff1(0xd9)],null,0x2):_0x1c7ff1(0x110))+_0x1c7ff1(0xdf)+(_0x34daa9[_0x1c7ff1(0xd5)]?JSON[_0x1c7ff1(0x118)](_0x34daa9[_0x1c7ff1(0xd5)],null,0x2):_0x1c7ff1(0x110))+_0x1c7ff1(0xd4))[_0x1c7ff1(0xec)]();}[a79_0x5cfee4(0xf7)](_0x38622a,_0x2f0a20){const _0x9255c=a79_0x5cfee4;return'\x0a\x20\x20\x20\x20\x20\x20<h2>Unhandled\x20Exception\x20Notification</h2>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Device:</strong>\x20'+_0x2f0a20+'</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Timestamp:</strong>\x20'+(_0x38622a[_0x9255c(0x107)]||new Date()[_0x9255c(0xee)]())+_0x9255c(0x111)+(_0x38622a[_0x9255c(0xdb)]||_0x9255c(0x110))+'</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20Method:</strong>\x20'+(_0x38622a[_0x9255c(0x101)]||_0x9255c(0x110))+_0x9255c(0x112)+_0x38622a['message']+_0x9255c(0xeb)+(_0x38622a[_0x9255c(0xd9)]?JSON[_0x9255c(0x118)](_0x38622a[_0x9255c(0xd9)],null,0x2):_0x9255c(0x110))+'</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Headers:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>'+(_0x38622a[_0x9255c(0xd5)]?JSON[_0x9255c(0x118)](_0x38622a[_0x9255c(0xd5)],null,0x2):'N/A')+_0x9255c(0x11c);}async['getDeviceName'](_0x59a76c){const _0x2537ef=a79_0x5cfee4;if(this[_0x2537ef(0x10b)])return this[_0x2537ef(0x10b)];try{const _0x1dfb3a=await this[_0x2537ef(0xff)][_0x2537ef(0x10d)]();return(_0x1dfb3a===null||_0x1dfb3a===void 0x0?void 0x0:_0x1dfb3a[_0x2537ef(0xe4)])||_0x59a76c[_0x2537ef(0xf6)]||'Unknown\x20Device';}catch(_0x45a7c6){return this[_0x2537ef(0xd2)][_0x2537ef(0xe7)](_0x2537ef(0xe5)),_0x59a76c[_0x2537ef(0xf6)]||_0x2537ef(0xd7);}}};function a79_0x2b8d(_0x1dead0,_0x39227d){const _0x356bd3=a79_0x356b();return a79_0x2b8d=function(_0x2b8d53,_0x4deb84){_0x2b8d53=_0x2b8d53-0xce;let _0x180172=_0x356bd3[_0x2b8d53];return _0x180172;},a79_0x2b8d(_0x1dead0,_0x39227d);}EmailService=EmailService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(a79_0x5cfee4(0xda),[setting_service_1['SettingService']])],EmailService),exports[a79_0x5cfee4(0x100)]=EmailService;