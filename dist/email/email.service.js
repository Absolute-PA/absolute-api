'use strict';const a79_0x378ce8=a79_0x4c35;(function(_0x129d7e,_0x20da2a){const _0x37944f=a79_0x4c35,_0x398828=_0x129d7e();while(!![]){try{const _0x48da87=-parseInt(_0x37944f(0x197))/0x1+-parseInt(_0x37944f(0x1bd))/0x2*(parseInt(_0x37944f(0x1a8))/0x3)+-parseInt(_0x37944f(0x1c9))/0x4+parseInt(_0x37944f(0x1c1))/0x5*(-parseInt(_0x37944f(0x1df))/0x6)+-parseInt(_0x37944f(0x1ca))/0x7+parseInt(_0x37944f(0x1a5))/0x8*(parseInt(_0x37944f(0x19a))/0x9)+-parseInt(_0x37944f(0x1bf))/0xa*(-parseInt(_0x37944f(0x1c0))/0xb);if(_0x48da87===_0x20da2a)break;else _0x398828['push'](_0x398828['shift']());}catch(_0x418c04){_0x398828['push'](_0x398828['shift']());}}}(a79_0x1f3a,0x3814a));function a79_0x1f3a(){const _0x45e4ed=['88oUGMFP','15YkgBxG','Failed\x20to\x20get\x20device\x20name\x20from\x20SettingService,\x20falling\x20back\x20to\x20details.piName\x20or\x20default.','exdyrljbopqilckb','onModuleInit','SMTP_HOST','sendExceptionNotification','Exception\x20notification\x20email\x20sent\x20successfully','SMTP_PASS','618012yFSfXc','2536233VkiwBN','url','nodemailer','getDeviceName','SMTP_FROM','</p>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Exception\x20Message:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','body','\x0aRequest\x20Method:\x20','SMTP_USER','warn','\x0a\x20\x20\x20\x20\x20\x20<h2>Unhandled\x20Exception\x20Notification</h2>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Device:</strong>\x20','length','design:paramtypes','createTransporter','method','SMTP_PORT','Unknown\x20Device','trim','sendMail','__esModule','headers','335802zDVFAA','SMTP_SECURE','stringify','timestamp','dev.absolutepa@gmail.com,service@absolutepa.com.au','debug','EmailService','\x0aRequest\x20URL:\x20','isEmailConfigured','logger','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20URL:</strong>\x20','127105TwFwzA','defineProperty','defaultToEmail','815274Yhnqbf','Email\x20not\x20configured,\x20skipping\x20exception\x20notification','</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Body:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Headers:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','error','metadata','Failed\x20to\x20send\x20exception\x20notification\x20email:','EXCEPTION_NOTIFY_EMAIL','decorate','env','findFirst','16pBXpXK','cachedDeviceName','toISOString','15873bXMukb','587','_settingService','Logger','schoolId','Email\x20configuration\x20not\x20found.\x20Exceptions\x20will\x20be\x20sent\x20to\x20default\x20address.','Failed\x20to\x20cache\x20device\x20name\x20on\x20startup.','../setting/setting.service','__metadata','N/A','transporter','createTransport','\x0a\x0aRequest\x20Headers:\x0a','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20Method:</strong>\x20','\x0aUnhandled\x20Exception\x20Notification\x0a\x0aDevice:\x20','object','formatExceptionEmailHtml','function','SettingService','smtp.gmail.com','\x0a\x0aRequest\x20Body:\x0a','148rlmtxH','formatExceptionEmail','1564870VdCmAq'];a79_0x1f3a=function(){return _0x45e4ed;};return a79_0x1f3a();}var __decorate=this&&this['__decorate']||function(_0x263984,_0x2ab6f5,_0x1d82a8,_0xf571ca){const _0x5c82b6=a79_0x4c35;var _0xb0483f=arguments[_0x5c82b6(0x1d5)],_0x11c208=_0xb0483f<0x3?_0x2ab6f5:_0xf571ca===null?_0xf571ca=Object['getOwnPropertyDescriptor'](_0x2ab6f5,_0x1d82a8):_0xf571ca,_0x2db703;if(typeof Reflect===_0x5c82b6(0x1b7)&&typeof Reflect[_0x5c82b6(0x1a2)]===_0x5c82b6(0x1b9))_0x11c208=Reflect[_0x5c82b6(0x1a2)](_0x263984,_0x2ab6f5,_0x1d82a8,_0xf571ca);else{for(var _0x99593c=_0x263984[_0x5c82b6(0x1d5)]-0x1;_0x99593c>=0x0;_0x99593c--)if(_0x2db703=_0x263984[_0x99593c])_0x11c208=(_0xb0483f<0x3?_0x2db703(_0x11c208):_0xb0483f>0x3?_0x2db703(_0x2ab6f5,_0x1d82a8,_0x11c208):_0x2db703(_0x2ab6f5,_0x1d82a8))||_0x11c208;}return _0xb0483f>0x3&&_0x11c208&&Object['defineProperty'](_0x2ab6f5,_0x1d82a8,_0x11c208),_0x11c208;},__metadata=this&&this[a79_0x378ce8(0x1b0)]||function(_0x357b94,_0x276d17){const _0x3d090b=a79_0x378ce8;if(typeof Reflect===_0x3d090b(0x1b7)&&typeof Reflect[_0x3d090b(0x19f)]===_0x3d090b(0x1b9))return Reflect[_0x3d090b(0x19f)](_0x357b94,_0x276d17);},EmailService_1;Object[a79_0x378ce8(0x198)](exports,a79_0x378ce8(0x1dd),{'value':!![]}),exports[a79_0x378ce8(0x192)]=void 0x0;const common_1=require('@nestjs/common'),nodemailer=require(a79_0x378ce8(0x1cc)),setting_service_1=require(a79_0x378ce8(0x1af));function a79_0x4c35(_0xc47ba5,_0x532c0b){const _0x1f3a09=a79_0x1f3a();return a79_0x4c35=function(_0x4c3541,_0x2815aa){_0x4c3541=_0x4c3541-0x192;let _0x4c34d8=_0x1f3a09[_0x4c3541];return _0x4c34d8;},a79_0x4c35(_0xc47ba5,_0x532c0b);}let EmailService=EmailService_1=class EmailService{constructor(_0x3dc9f3){const _0x2dcb0e=a79_0x378ce8;this[_0x2dcb0e(0x1aa)]=_0x3dc9f3,this[_0x2dcb0e(0x195)]=new common_1[(_0x2dcb0e(0x1ab))](EmailService_1['name']),this[_0x2dcb0e(0x199)]=_0x2dcb0e(0x1e3),this['cachedDeviceName']=null,this[_0x2dcb0e(0x1d7)]();}async[a79_0x378ce8(0x1c4)](){const _0x210d50=a79_0x378ce8;try{const _0x2dd760=await this[_0x210d50(0x1aa)][_0x210d50(0x1a4)]();this['cachedDeviceName']=(_0x2dd760===null||_0x2dd760===void 0x0?void 0x0:_0x2dd760[_0x210d50(0x1ac)])||null;}catch(_0x1f3387){this[_0x210d50(0x195)][_0x210d50(0x1d3)](_0x210d50(0x1ae)),this[_0x210d50(0x1a6)]=null;}}[a79_0x378ce8(0x1d7)](){const _0x31d85c=a79_0x378ce8;this['isEmailConfigured']()?this[_0x31d85c(0x1b2)]=nodemailer[_0x31d85c(0x1b3)]({'host':process[_0x31d85c(0x1a3)][_0x31d85c(0x1c5)],'port':parseInt(process[_0x31d85c(0x1a3)][_0x31d85c(0x1d9)]||_0x31d85c(0x1a9)),'secure':process[_0x31d85c(0x1a3)][_0x31d85c(0x1e0)]==='true','auth':{'user':process[_0x31d85c(0x1a3)]['SMTP_USER'],'pass':process[_0x31d85c(0x1a3)]['SMTP_PASS']}}):(this['logger'][_0x31d85c(0x1d3)](_0x31d85c(0x1ad)),this[_0x31d85c(0x1b2)]=nodemailer[_0x31d85c(0x1b3)]({'host':_0x31d85c(0x1bb),'port':0x24b,'secure':![],'auth':{'user':'dev.absolutepa@gmail.com','pass':_0x31d85c(0x1c3)}}));}[a79_0x378ce8(0x194)](){const _0x35768c=a79_0x378ce8;return!!(process['env'][_0x35768c(0x1c5)]&&process['env'][_0x35768c(0x1d2)]&&process[_0x35768c(0x1a3)][_0x35768c(0x1c8)]&&process['env'][_0x35768c(0x1a1)]);}async[a79_0x378ce8(0x1c6)](_0x197994){const _0x43663d=a79_0x378ce8;if(!this['transporter']){this[_0x43663d(0x195)][_0x43663d(0x1e4)](_0x43663d(0x19b));return;}const _0x2c6b13=await this['getDeviceName'](_0x197994);try{const _0xbe9d81=this['formatExceptionEmail'](_0x197994,_0x2c6b13);await this[_0x43663d(0x1b2)][_0x43663d(0x1dc)]({'from':process['env'][_0x43663d(0x1ce)]||'\x22Exception\x20Notifier\x22\x20<no-reply@absolutepa.com>','to':process['env'][_0x43663d(0x1a1)]||this[_0x43663d(0x199)],'subject':'['+_0x2c6b13+']\x20Unhandled\x20Exception\x20Occurred','text':_0xbe9d81,'html':this[_0x43663d(0x1b8)](_0x197994,_0x2c6b13)}),this[_0x43663d(0x195)]['log'](_0x43663d(0x1c7));}catch(_0x27e3a4){this[_0x43663d(0x195)][_0x43663d(0x19e)](_0x43663d(0x1a0),_0x27e3a4);}}[a79_0x378ce8(0x1be)](_0x54fab,_0x230827){const _0x34b76f=a79_0x378ce8;return(_0x34b76f(0x1b6)+_0x230827+'\x0aTimestamp:\x20'+(_0x54fab[_0x34b76f(0x1e2)]||new Date()[_0x34b76f(0x1a7)]())+_0x34b76f(0x193)+(_0x54fab['url']||_0x34b76f(0x1b1))+_0x34b76f(0x1d1)+(_0x54fab[_0x34b76f(0x1d8)]||'N/A')+'\x0a\x0aException\x20Message:\x0a'+_0x54fab['message']+_0x34b76f(0x1bc)+(_0x54fab['body']?JSON[_0x34b76f(0x1e1)](_0x54fab[_0x34b76f(0x1d0)],null,0x2):'N/A')+_0x34b76f(0x1b4)+(_0x54fab[_0x34b76f(0x1de)]?JSON['stringify'](_0x54fab[_0x34b76f(0x1de)],null,0x2):_0x34b76f(0x1b1))+'\x0a\x20\x20\x20\x20')[_0x34b76f(0x1db)]();}[a79_0x378ce8(0x1b8)](_0x32a363,_0x2f0919){const _0x23f4e0=a79_0x378ce8;return _0x23f4e0(0x1d4)+_0x2f0919+'</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Timestamp:</strong>\x20'+(_0x32a363[_0x23f4e0(0x1e2)]||new Date()[_0x23f4e0(0x1a7)]())+_0x23f4e0(0x196)+(_0x32a363[_0x23f4e0(0x1cb)]||'N/A')+_0x23f4e0(0x1b5)+(_0x32a363[_0x23f4e0(0x1d8)]||'N/A')+_0x23f4e0(0x1cf)+_0x32a363['message']+_0x23f4e0(0x19c)+(_0x32a363['body']?JSON[_0x23f4e0(0x1e1)](_0x32a363[_0x23f4e0(0x1d0)],null,0x2):_0x23f4e0(0x1b1))+_0x23f4e0(0x19d)+(_0x32a363[_0x23f4e0(0x1de)]?JSON['stringify'](_0x32a363[_0x23f4e0(0x1de)],null,0x2):'N/A')+'</pre>\x0a\x20\x20\x20\x20';}async[a79_0x378ce8(0x1cd)](_0x2989cc){const _0x44f48d=a79_0x378ce8;if(this['cachedDeviceName'])return this[_0x44f48d(0x1a6)];try{const _0x3822e5=await this[_0x44f48d(0x1aa)]['findFirst']();return(_0x3822e5===null||_0x3822e5===void 0x0?void 0x0:_0x3822e5[_0x44f48d(0x1ac)])||_0x2989cc['piName']||_0x44f48d(0x1da);}catch(_0x1b0673){return this[_0x44f48d(0x195)][_0x44f48d(0x1d3)](_0x44f48d(0x1c2)),_0x2989cc['piName']||_0x44f48d(0x1da);}}};EmailService=EmailService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(a79_0x378ce8(0x1d6),[setting_service_1[a79_0x378ce8(0x1ba)]])],EmailService),exports[a79_0x378ce8(0x192)]=EmailService;