'use strict';function a79_0x5bfe(){const _0x485723=['\x0a\x20\x20\x20\x20','</p>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Exception\x20Message:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','exdyrljbopqilckb','error','Unknown\x20Device','findFirst','\x0a\x20\x20\x20\x20\x20\x20<h2>Unhandled\x20Exception\x20Notification</h2>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Device:</strong>\x20','debug','\x0a\x0aRequest\x20Body:\x0a','metadata','body','\x0aTimestamp:\x20','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20Method:</strong>\x20','getOwnPropertyDescriptor','schoolId','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Timestamp:</strong>\x20','logger','headers','defineProperty','1158220TCuLbW','__decorate','url','_settingService','Email\x20configuration\x20not\x20found.\x20Exceptions\x20will\x20be\x20sent\x20to\x20default\x20address.','smtp.gmail.com','SMTP_USER','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20URL:</strong>\x20','</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Body:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','\x0a\x0aRequest\x20Headers:\x0a','stringify','createTransport','decorate','formatExceptionEmail','8794072WSqYBm','sendExceptionNotification','piName','4822655bcVkTR','transporter','\x22Exception\x20Notifier\x22\x20<no-reply@absolutepa.com>','EmailService','name','EXCEPTION_NOTIFY_EMAIL','message','</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Headers:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','Email\x20not\x20configured,\x20skipping\x20exception\x20notification','cachedDeviceName','env','\x0aRequest\x20Method:\x20','585qPaITf','Failed\x20to\x20get\x20device\x20name\x20from\x20SettingService,\x20falling\x20back\x20to\x20details.piName\x20or\x20default.','createTransporter',']\x20Unhandled\x20Exception\x20Occurred','\x0a\x0aException\x20Message:\x0a','isEmailConfigured','formatExceptionEmailHtml','__esModule','SMTP_FROM','dev.absolutepa@gmail.com','Logger','Injectable','4949370bXLTNr','7bEIXic','35036089RzLyle','defaultToEmail','sendMail','true','\x0aUnhandled\x20Exception\x20Notification\x0a\x0aDevice:\x20','warn','object','timestamp','SMTP_HOST','854253lBmQFO','getDeviceName','SMTP_PASS','N/A','length','__metadata','1dsbMFU','method','function','../setting/setting.service','SettingService','toISOString','Failed\x20to\x20cache\x20device\x20name\x20on\x20startup.','SMTP_SECURE','@nestjs/common','Failed\x20to\x20send\x20exception\x20notification\x20email:','design:paramtypes','4JgnGEE','180520IoQXjh'];a79_0x5bfe=function(){return _0x485723;};return a79_0x5bfe();}const a79_0x2f801f=a79_0x266f;(function(_0x1b39a2,_0x4364d4){const _0x519d2d=a79_0x266f,_0x550dc7=_0x1b39a2();while(!![]){try{const _0x6e5bcf=-parseInt(_0x519d2d(0x22f))/0x1*(parseInt(_0x519d2d(0x1f5))/0x2)+-parseInt(_0x519d2d(0x229))/0x3+-parseInt(_0x519d2d(0x1e0))/0x4*(parseInt(_0x519d2d(0x206))/0x5)+-parseInt(_0x519d2d(0x21e))/0x6+-parseInt(_0x519d2d(0x21f))/0x7*(parseInt(_0x519d2d(0x203))/0x8)+-parseInt(_0x519d2d(0x212))/0x9*(-parseInt(_0x519d2d(0x1e1))/0xa)+parseInt(_0x519d2d(0x220))/0xb;if(_0x6e5bcf===_0x4364d4)break;else _0x550dc7['push'](_0x550dc7['shift']());}catch(_0x554e43){_0x550dc7['push'](_0x550dc7['shift']());}}}(a79_0x5bfe,0x93eed));function a79_0x266f(_0x52f988,_0x8c1303){const _0x5bfeca=a79_0x5bfe();return a79_0x266f=function(_0x266fdb,_0x1fa896){_0x266fdb=_0x266fdb-0x1df;let _0x53f16e=_0x5bfeca[_0x266fdb];return _0x53f16e;},a79_0x266f(_0x52f988,_0x8c1303);}var __decorate=this&&this[a79_0x2f801f(0x1f6)]||function(_0x3be099,_0x16d863,_0x6f9d0a,_0x5ca6c6){const _0x4ab6b3=a79_0x2f801f;var _0x3091c8=arguments['length'],_0x2de127=_0x3091c8<0x3?_0x16d863:_0x5ca6c6===null?_0x5ca6c6=Object[_0x4ab6b3(0x1ef)](_0x16d863,_0x6f9d0a):_0x5ca6c6,_0x38f580;if(typeof Reflect===_0x4ab6b3(0x226)&&typeof Reflect[_0x4ab6b3(0x201)]===_0x4ab6b3(0x231))_0x2de127=Reflect[_0x4ab6b3(0x201)](_0x3be099,_0x16d863,_0x6f9d0a,_0x5ca6c6);else{for(var _0x5d165d=_0x3be099[_0x4ab6b3(0x22d)]-0x1;_0x5d165d>=0x0;_0x5d165d--)if(_0x38f580=_0x3be099[_0x5d165d])_0x2de127=(_0x3091c8<0x3?_0x38f580(_0x2de127):_0x3091c8>0x3?_0x38f580(_0x16d863,_0x6f9d0a,_0x2de127):_0x38f580(_0x16d863,_0x6f9d0a))||_0x2de127;}return _0x3091c8>0x3&&_0x2de127&&Object[_0x4ab6b3(0x1f4)](_0x16d863,_0x6f9d0a,_0x2de127),_0x2de127;},__metadata=this&&this[a79_0x2f801f(0x22e)]||function(_0x5de2e0,_0x195137){const _0x3c8fd6=a79_0x2f801f;if(typeof Reflect==='object'&&typeof Reflect[_0x3c8fd6(0x1eb)]===_0x3c8fd6(0x231))return Reflect[_0x3c8fd6(0x1eb)](_0x5de2e0,_0x195137);},EmailService_1;Object[a79_0x2f801f(0x1f4)](exports,a79_0x2f801f(0x219),{'value':!![]}),exports[a79_0x2f801f(0x209)]=void 0x0;const common_1=require(a79_0x2f801f(0x237)),nodemailer=require('nodemailer'),setting_service_1=require(a79_0x2f801f(0x232));let EmailService=EmailService_1=class EmailService{constructor(_0x4b8433){const _0x2a56ea=a79_0x2f801f;this['_settingService']=_0x4b8433,this['logger']=new common_1[(_0x2a56ea(0x21c))](EmailService_1[_0x2a56ea(0x20a)]),this[_0x2a56ea(0x221)]='dev.absolutepa@gmail.com,service@absolutepa.com.au',this[_0x2a56ea(0x20f)]=null,this[_0x2a56ea(0x214)]();}async['onModuleInit'](){const _0x304d0a=a79_0x2f801f;try{const _0x46087b=await this['_settingService'][_0x304d0a(0x1e7)]();this['cachedDeviceName']=(_0x46087b===null||_0x46087b===void 0x0?void 0x0:_0x46087b[_0x304d0a(0x1f0)])||null;}catch(_0x1864e9){this[_0x304d0a(0x1f2)][_0x304d0a(0x225)](_0x304d0a(0x235)),this[_0x304d0a(0x20f)]=null;}}[a79_0x2f801f(0x214)](){const _0x5c981e=a79_0x2f801f;this['isEmailConfigured']()?this[_0x5c981e(0x207)]=nodemailer[_0x5c981e(0x200)]({'host':process['env'][_0x5c981e(0x228)],'port':parseInt(process[_0x5c981e(0x210)]['SMTP_PORT']||'587'),'secure':process['env'][_0x5c981e(0x236)]===_0x5c981e(0x223),'auth':{'user':process['env'][_0x5c981e(0x1fb)],'pass':process[_0x5c981e(0x210)][_0x5c981e(0x22b)]}}):(this[_0x5c981e(0x1f2)][_0x5c981e(0x225)](_0x5c981e(0x1f9)),this[_0x5c981e(0x207)]=nodemailer[_0x5c981e(0x200)]({'host':_0x5c981e(0x1fa),'port':0x24b,'secure':![],'auth':{'user':_0x5c981e(0x21b),'pass':_0x5c981e(0x1e4)}}));}[a79_0x2f801f(0x217)](){const _0x206771=a79_0x2f801f;return!!(process[_0x206771(0x210)][_0x206771(0x228)]&&process[_0x206771(0x210)][_0x206771(0x1fb)]&&process[_0x206771(0x210)]['SMTP_PASS']&&process[_0x206771(0x210)][_0x206771(0x20b)]);}async[a79_0x2f801f(0x204)](_0x3550a5){const _0x520204=a79_0x2f801f;if(!this[_0x520204(0x207)]){this[_0x520204(0x1f2)][_0x520204(0x1e9)](_0x520204(0x20e));return;}const _0x3ad97a=await this[_0x520204(0x22a)](_0x3550a5);try{const _0x39547a=this[_0x520204(0x202)](_0x3550a5,_0x3ad97a);await this['transporter'][_0x520204(0x222)]({'from':process[_0x520204(0x210)][_0x520204(0x21a)]||_0x520204(0x208),'to':process[_0x520204(0x210)]['EXCEPTION_NOTIFY_EMAIL']||this[_0x520204(0x221)],'subject':'['+_0x3ad97a+_0x520204(0x215),'text':_0x39547a,'html':this[_0x520204(0x218)](_0x3550a5,_0x3ad97a)}),this[_0x520204(0x1f2)]['log']('Exception\x20notification\x20email\x20sent\x20successfully');}catch(_0x48fe34){this[_0x520204(0x1f2)][_0x520204(0x1e5)](_0x520204(0x238),_0x48fe34);}}[a79_0x2f801f(0x202)](_0x4fba93,_0xd40518){const _0x1e4df1=a79_0x2f801f;return(_0x1e4df1(0x224)+_0xd40518+_0x1e4df1(0x1ed)+(_0x4fba93['timestamp']||new Date()[_0x1e4df1(0x234)]())+'\x0aRequest\x20URL:\x20'+(_0x4fba93[_0x1e4df1(0x1f7)]||'N/A')+_0x1e4df1(0x211)+(_0x4fba93[_0x1e4df1(0x230)]||_0x1e4df1(0x22c))+_0x1e4df1(0x216)+_0x4fba93[_0x1e4df1(0x20c)]+_0x1e4df1(0x1ea)+(_0x4fba93[_0x1e4df1(0x1ec)]?JSON[_0x1e4df1(0x1ff)](_0x4fba93[_0x1e4df1(0x1ec)],null,0x2):'N/A')+_0x1e4df1(0x1fe)+(_0x4fba93['headers']?JSON[_0x1e4df1(0x1ff)](_0x4fba93['headers'],null,0x2):_0x1e4df1(0x22c))+_0x1e4df1(0x1e2))['trim']();}[a79_0x2f801f(0x218)](_0x156ac8,_0x276886){const _0x18c099=a79_0x2f801f;return _0x18c099(0x1e8)+_0x276886+_0x18c099(0x1f1)+(_0x156ac8[_0x18c099(0x227)]||new Date()[_0x18c099(0x234)]())+_0x18c099(0x1fc)+(_0x156ac8[_0x18c099(0x1f7)]||'N/A')+_0x18c099(0x1ee)+(_0x156ac8[_0x18c099(0x230)]||_0x18c099(0x22c))+_0x18c099(0x1e3)+_0x156ac8['message']+_0x18c099(0x1fd)+(_0x156ac8[_0x18c099(0x1ec)]?JSON['stringify'](_0x156ac8['body'],null,0x2):_0x18c099(0x22c))+_0x18c099(0x20d)+(_0x156ac8[_0x18c099(0x1f3)]?JSON[_0x18c099(0x1ff)](_0x156ac8[_0x18c099(0x1f3)],null,0x2):_0x18c099(0x22c))+'</pre>\x0a\x20\x20\x20\x20';}async[a79_0x2f801f(0x22a)](_0xdbffd4){const _0x13e009=a79_0x2f801f;if(this[_0x13e009(0x20f)])return this['cachedDeviceName'];try{const _0x54e965=await this[_0x13e009(0x1f8)][_0x13e009(0x1e7)]();return(_0x54e965===null||_0x54e965===void 0x0?void 0x0:_0x54e965[_0x13e009(0x1f0)])||_0xdbffd4[_0x13e009(0x205)]||_0x13e009(0x1e6);}catch(_0x1f1221){return this['logger'][_0x13e009(0x225)](_0x13e009(0x213)),_0xdbffd4[_0x13e009(0x205)]||_0x13e009(0x1e6);}}};EmailService=EmailService_1=__decorate([(0x0,common_1[a79_0x2f801f(0x21d)])(),__metadata(a79_0x2f801f(0x1df),[setting_service_1[a79_0x2f801f(0x233)]])],EmailService),exports['EmailService']=EmailService;