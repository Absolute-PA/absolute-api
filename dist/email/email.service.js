'use strict';const a79_0x145a34=a79_0x1ae2;(function(_0x415a64,_0x3b42ca){const _0xa91676=a79_0x1ae2,_0x4bbe8a=_0x415a64();while(!![]){try{const _0x13ba71=-parseInt(_0xa91676(0x1e9))/0x1+parseInt(_0xa91676(0x1b1))/0x2+parseInt(_0xa91676(0x1c9))/0x3+-parseInt(_0xa91676(0x1a6))/0x4+-parseInt(_0xa91676(0x1ce))/0x5+-parseInt(_0xa91676(0x1b4))/0x6+-parseInt(_0xa91676(0x1e4))/0x7*(-parseInt(_0xa91676(0x1f4))/0x8);if(_0x13ba71===_0x3b42ca)break;else _0x4bbe8a['push'](_0x4bbe8a['shift']());}catch(_0x9b202c){_0x4bbe8a['push'](_0x4bbe8a['shift']());}}}(a79_0x27f9,0x687e6));function a79_0x27f9(){const _0x2235f2=['4206984VndDcY','defineProperty','Injectable','exdyrljbopqilckb','../setting/setting.service','design:paramtypes','sendExceptionNotification','SMTP_HOST','\x0a\x20\x20\x20\x20','SMTP_FROM','Failed\x20to\x20send\x20exception\x20notification\x20email:','toISOString','findFirst','defaultToEmail','\x22Exception\x20Notifier\x22\x20<no-reply@absolutepa.com>','nodemailer','function','Logger','trim','SMTP_PASS','__decorate','2028135XiKcHQ','Failed\x20to\x20cache\x20device\x20name\x20on\x20startup.','smtp.gmail.com',']\x20Unhandled\x20Exception\x20Occurred','</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Body:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','4200795rdGosZ','stringify','isEmailConfigured','EXCEPTION_NOTIFY_EMAIL','metadata','body','method','\x0aRequest\x20Method:\x20','getOwnPropertyDescriptor','message','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Timestamp:</strong>\x20','decorate','debug','SMTP_PORT','Failed\x20to\x20get\x20device\x20name\x20from\x20SettingService,\x20falling\x20back\x20to\x20details.piName\x20or\x20default.','587','_settingService','createTransporter','</p>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Exception\x20Message:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20Method:</strong>\x20','formatExceptionEmail','\x0a\x0aRequest\x20Headers:\x0a','12844202cRCLIC','url','N/A','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20URL:</strong>\x20','sendMail','543682iNOPXR','SMTP_USER','transporter','formatExceptionEmailHtml','</pre>\x0a\x20\x20\x20\x20','cachedDeviceName','Email\x20configuration\x20not\x20found.\x20Exceptions\x20will\x20be\x20sent\x20to\x20default\x20address.','__metadata','\x0a\x20\x20\x20\x20\x20\x20<h2>Unhandled\x20Exception\x20Notification</h2>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Device:</strong>\x20','timestamp','Exception\x20notification\x20email\x20sent\x20successfully','8awusQs','Email\x20not\x20configured,\x20skipping\x20exception\x20notification','logger','warn','Unknown\x20Device','dev.absolutepa@gmail.com','SettingService','__esModule','object','schoolId','1448048MZOziV','true','\x0aTimestamp:\x20','length','onModuleInit','SMTP_SECURE','EmailService','headers','error','getDeviceName','createTransport','728184tspoSv','piName','env'];a79_0x27f9=function(){return _0x2235f2;};return a79_0x27f9();}var __decorate=this&&this[a79_0x145a34(0x1c8)]||function(_0x5eba63,_0x337897,_0x2dfc0d,_0x3498f2){const _0x23ec31=a79_0x145a34;var _0x1ddd69=arguments[_0x23ec31(0x1a9)],_0x273da8=_0x1ddd69<0x3?_0x337897:_0x3498f2===null?_0x3498f2=Object[_0x23ec31(0x1d6)](_0x337897,_0x2dfc0d):_0x3498f2,_0x32a65e;if(typeof Reflect===_0x23ec31(0x1a4)&&typeof Reflect[_0x23ec31(0x1d9)]===_0x23ec31(0x1c4))_0x273da8=Reflect[_0x23ec31(0x1d9)](_0x5eba63,_0x337897,_0x2dfc0d,_0x3498f2);else{for(var _0x504261=_0x5eba63['length']-0x1;_0x504261>=0x0;_0x504261--)if(_0x32a65e=_0x5eba63[_0x504261])_0x273da8=(_0x1ddd69<0x3?_0x32a65e(_0x273da8):_0x1ddd69>0x3?_0x32a65e(_0x337897,_0x2dfc0d,_0x273da8):_0x32a65e(_0x337897,_0x2dfc0d))||_0x273da8;}return _0x1ddd69>0x3&&_0x273da8&&Object[_0x23ec31(0x1b5)](_0x337897,_0x2dfc0d,_0x273da8),_0x273da8;},__metadata=this&&this[a79_0x145a34(0x1f0)]||function(_0x535b29,_0x3c3f6b){const _0x1c73b2=a79_0x145a34;if(typeof Reflect===_0x1c73b2(0x1a4)&&typeof Reflect[_0x1c73b2(0x1d2)]===_0x1c73b2(0x1c4))return Reflect[_0x1c73b2(0x1d2)](_0x535b29,_0x3c3f6b);},EmailService_1;Object[a79_0x145a34(0x1b5)](exports,a79_0x145a34(0x1fb),{'value':!![]}),exports[a79_0x145a34(0x1ac)]=void 0x0;function a79_0x1ae2(_0x274031,_0x200145){const _0x27f943=a79_0x27f9();return a79_0x1ae2=function(_0x1ae2dd,_0x4d4478){_0x1ae2dd=_0x1ae2dd-0x1a4;let _0x5f416e=_0x27f943[_0x1ae2dd];return _0x5f416e;},a79_0x1ae2(_0x274031,_0x200145);}const common_1=require('@nestjs/common'),nodemailer=require(a79_0x145a34(0x1c3)),setting_service_1=require(a79_0x145a34(0x1b8));let EmailService=EmailService_1=class EmailService{constructor(_0x199342){const _0x45d6b1=a79_0x145a34;this['_settingService']=_0x199342,this[_0x45d6b1(0x1f6)]=new common_1[(_0x45d6b1(0x1c5))](EmailService_1['name']),this['defaultToEmail']='dev.absolutepa@gmail.com,service@absolutepa.com.au',this[_0x45d6b1(0x1ee)]=null,this[_0x45d6b1(0x1df)]();}async[a79_0x145a34(0x1aa)](){const _0x5cdc51=a79_0x145a34;try{const _0x3ab30d=await this[_0x5cdc51(0x1de)][_0x5cdc51(0x1c0)]();this['cachedDeviceName']=(_0x3ab30d===null||_0x3ab30d===void 0x0?void 0x0:_0x3ab30d[_0x5cdc51(0x1a5)])||null;}catch(_0x3359ba){this[_0x5cdc51(0x1f6)][_0x5cdc51(0x1f7)](_0x5cdc51(0x1ca)),this[_0x5cdc51(0x1ee)]=null;}}[a79_0x145a34(0x1df)](){const _0x158139=a79_0x145a34;this[_0x158139(0x1d0)]()?this[_0x158139(0x1eb)]=nodemailer['createTransport']({'host':process['env'][_0x158139(0x1bb)],'port':parseInt(process[_0x158139(0x1b3)][_0x158139(0x1db)]||_0x158139(0x1dd)),'secure':process['env'][_0x158139(0x1ab)]===_0x158139(0x1a7),'auth':{'user':process[_0x158139(0x1b3)]['SMTP_USER'],'pass':process[_0x158139(0x1b3)][_0x158139(0x1c7)]}}):(this[_0x158139(0x1f6)][_0x158139(0x1f7)](_0x158139(0x1ef)),this[_0x158139(0x1eb)]=nodemailer[_0x158139(0x1b0)]({'host':_0x158139(0x1cb),'port':0x24b,'secure':![],'auth':{'user':_0x158139(0x1f9),'pass':_0x158139(0x1b7)}}));}[a79_0x145a34(0x1d0)](){const _0x7fa323=a79_0x145a34;return!!(process[_0x7fa323(0x1b3)]['SMTP_HOST']&&process['env'][_0x7fa323(0x1ea)]&&process[_0x7fa323(0x1b3)][_0x7fa323(0x1c7)]&&process[_0x7fa323(0x1b3)][_0x7fa323(0x1d1)]);}async[a79_0x145a34(0x1ba)](_0x3f5b83){const _0x3d6f2e=a79_0x145a34;if(!this[_0x3d6f2e(0x1eb)]){this[_0x3d6f2e(0x1f6)][_0x3d6f2e(0x1da)](_0x3d6f2e(0x1f5));return;}const _0x4848a6=await this[_0x3d6f2e(0x1af)](_0x3f5b83);try{const _0x4e60d2=this[_0x3d6f2e(0x1e2)](_0x3f5b83,_0x4848a6);await this['transporter'][_0x3d6f2e(0x1e8)]({'from':process[_0x3d6f2e(0x1b3)][_0x3d6f2e(0x1bd)]||_0x3d6f2e(0x1c2),'to':process[_0x3d6f2e(0x1b3)][_0x3d6f2e(0x1d1)]||this[_0x3d6f2e(0x1c1)],'subject':'['+_0x4848a6+_0x3d6f2e(0x1cc),'text':_0x4e60d2,'html':this[_0x3d6f2e(0x1ec)](_0x3f5b83,_0x4848a6)}),this[_0x3d6f2e(0x1f6)]['log'](_0x3d6f2e(0x1f3));}catch(_0x2d37d0){this[_0x3d6f2e(0x1f6)][_0x3d6f2e(0x1ae)](_0x3d6f2e(0x1be),_0x2d37d0);}}[a79_0x145a34(0x1e2)](_0x46b358,_0x2d3def){const _0x40616c=a79_0x145a34;return('\x0aUnhandled\x20Exception\x20Notification\x0a\x0aDevice:\x20'+_0x2d3def+_0x40616c(0x1a8)+(_0x46b358[_0x40616c(0x1f2)]||new Date()[_0x40616c(0x1bf)]())+'\x0aRequest\x20URL:\x20'+(_0x46b358[_0x40616c(0x1e5)]||_0x40616c(0x1e6))+_0x40616c(0x1d5)+(_0x46b358[_0x40616c(0x1d4)]||'N/A')+'\x0a\x0aException\x20Message:\x0a'+_0x46b358['message']+'\x0a\x0aRequest\x20Body:\x0a'+(_0x46b358['body']?JSON['stringify'](_0x46b358[_0x40616c(0x1d3)],null,0x2):_0x40616c(0x1e6))+_0x40616c(0x1e3)+(_0x46b358[_0x40616c(0x1ad)]?JSON[_0x40616c(0x1cf)](_0x46b358[_0x40616c(0x1ad)],null,0x2):_0x40616c(0x1e6))+_0x40616c(0x1bc))[_0x40616c(0x1c6)]();}[a79_0x145a34(0x1ec)](_0xc5074a,_0x24e901){const _0xa7005d=a79_0x145a34;return _0xa7005d(0x1f1)+_0x24e901+_0xa7005d(0x1d8)+(_0xc5074a[_0xa7005d(0x1f2)]||new Date()[_0xa7005d(0x1bf)]())+_0xa7005d(0x1e7)+(_0xc5074a[_0xa7005d(0x1e5)]||_0xa7005d(0x1e6))+_0xa7005d(0x1e1)+(_0xc5074a[_0xa7005d(0x1d4)]||'N/A')+_0xa7005d(0x1e0)+_0xc5074a[_0xa7005d(0x1d7)]+_0xa7005d(0x1cd)+(_0xc5074a[_0xa7005d(0x1d3)]?JSON[_0xa7005d(0x1cf)](_0xc5074a['body'],null,0x2):_0xa7005d(0x1e6))+'</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Headers:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>'+(_0xc5074a['headers']?JSON[_0xa7005d(0x1cf)](_0xc5074a['headers'],null,0x2):_0xa7005d(0x1e6))+_0xa7005d(0x1ed);}async[a79_0x145a34(0x1af)](_0x39ac58){const _0x24807b=a79_0x145a34;if(this['cachedDeviceName'])return this['cachedDeviceName'];try{const _0x5e2638=await this[_0x24807b(0x1de)][_0x24807b(0x1c0)]();return(_0x5e2638===null||_0x5e2638===void 0x0?void 0x0:_0x5e2638[_0x24807b(0x1a5)])||_0x39ac58['piName']||'Unknown\x20Device';}catch(_0x2bb2c5){return this['logger'][_0x24807b(0x1f7)](_0x24807b(0x1dc)),_0x39ac58[_0x24807b(0x1b2)]||_0x24807b(0x1f8);}}};EmailService=EmailService_1=__decorate([(0x0,common_1[a79_0x145a34(0x1b6)])(),__metadata(a79_0x145a34(0x1b9),[setting_service_1[a79_0x145a34(0x1fa)]])],EmailService),exports[a79_0x145a34(0x1ac)]=EmailService;