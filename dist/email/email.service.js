'use strict';const a79_0x19d7dc=a79_0x1dc2;function a79_0xdfeb(){const _0x40886d=['length','Injectable','__metadata','SettingService','_settingService','Email\x20not\x20configured,\x20skipping\x20exception\x20notification','formatExceptionEmail','69499210vZlaua',']\x20Unhandled\x20Exception\x20Occurred','method','name','Exception\x20notification\x20email\x20sent\x20successfully','229985emXwmW','3398072dxMnXC','N/A','\x0a\x20\x20\x20\x20','210PhDoDj','function','smtp.gmail.com','EmailService','cachedDeviceName','getOwnPropertyDescriptor','SMTP_PORT','1265285mlZlAc','EXCEPTION_NOTIFY_EMAIL','\x0a\x0aException\x20Message:\x0a','\x0aTimestamp:\x20','object','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Timestamp:</strong>\x20','url','</pre>\x0a\x20\x20\x20\x20','SMTP_USER','message','nodemailer','</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Body:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','schoolId','transporter','sendExceptionNotification','defaultToEmail','warn','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20Method:</strong>\x20','env','isEmailConfigured','headers','onModuleInit','1xmqMrG','sendMail','getDeviceName','7657839KtKriS','\x0aRequest\x20URL:\x20','</p>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Exception\x20Message:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','findFirst','debug','Logger','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20URL:</strong>\x20','Failed\x20to\x20get\x20device\x20name\x20from\x20SettingService,\x20falling\x20back\x20to\x20details.piName\x20or\x20default.','\x0aUnhandled\x20Exception\x20Notification\x0a\x0aDevice:\x20','dev.absolutepa@gmail.com','createTransporter','Unknown\x20Device','body','toISOString','defineProperty','Email\x20configuration\x20not\x20found.\x20Exceptions\x20will\x20be\x20sent\x20to\x20default\x20address.','piName','\x0aRequest\x20Method:\x20','\x0a\x0aRequest\x20Body:\x0a','stringify','SMTP_PASS','metadata','true','__decorate','1698399ObldvZ','createTransport','7120448HIeUtX','SMTP_HOST','16zFPnIx','\x0a\x20\x20\x20\x20\x20\x20<h2>Unhandled\x20Exception\x20Notification</h2>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Device:</strong>\x20','logger'];a79_0xdfeb=function(){return _0x40886d;};return a79_0xdfeb();}(function(_0x5f13d0,_0x27b852){const _0x4aebb9=a79_0x1dc2,_0x4abeb4=_0x5f13d0();while(!![]){try{const _0xf85d10=-parseInt(_0x4aebb9(0x1fd))/0x1*(parseInt(_0x4aebb9(0x1dd))/0x2)+parseInt(_0x4aebb9(0x218))/0x3+-parseInt(_0x4aebb9(0x21a))/0x4+parseInt(_0x4aebb9(0x1dc))/0x5*(-parseInt(_0x4aebb9(0x1e0))/0x6)+parseInt(_0x4aebb9(0x1e7))/0x7+parseInt(_0x4aebb9(0x21c))/0x8*(-parseInt(_0x4aebb9(0x200))/0x9)+parseInt(_0x4aebb9(0x226))/0xa;if(_0xf85d10===_0x27b852)break;else _0x4abeb4['push'](_0x4abeb4['shift']());}catch(_0x5a17fe){_0x4abeb4['push'](_0x4abeb4['shift']());}}}(a79_0xdfeb,0xdd328));var __decorate=this&&this[a79_0x19d7dc(0x217)]||function(_0x14818e,_0x291c54,_0x4f47db,_0x590951){const _0xf9b532=a79_0x19d7dc;var _0x3707f5=arguments[_0xf9b532(0x21f)],_0x1917d5=_0x3707f5<0x3?_0x291c54:_0x590951===null?_0x590951=Object[_0xf9b532(0x1e5)](_0x291c54,_0x4f47db):_0x590951,_0x8b007a;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0xf9b532(0x1e1))_0x1917d5=Reflect['decorate'](_0x14818e,_0x291c54,_0x4f47db,_0x590951);else{for(var _0x4e84e9=_0x14818e[_0xf9b532(0x21f)]-0x1;_0x4e84e9>=0x0;_0x4e84e9--)if(_0x8b007a=_0x14818e[_0x4e84e9])_0x1917d5=(_0x3707f5<0x3?_0x8b007a(_0x1917d5):_0x3707f5>0x3?_0x8b007a(_0x291c54,_0x4f47db,_0x1917d5):_0x8b007a(_0x291c54,_0x4f47db))||_0x1917d5;}return _0x3707f5>0x3&&_0x1917d5&&Object[_0xf9b532(0x20e)](_0x291c54,_0x4f47db,_0x1917d5),_0x1917d5;},__metadata=this&&this[a79_0x19d7dc(0x221)]||function(_0x53894c,_0x20505b){const _0x2bd517=a79_0x19d7dc;if(typeof Reflect===_0x2bd517(0x1eb)&&typeof Reflect[_0x2bd517(0x215)]===_0x2bd517(0x1e1))return Reflect[_0x2bd517(0x215)](_0x53894c,_0x20505b);},EmailService_1;Object[a79_0x19d7dc(0x20e)](exports,'__esModule',{'value':!![]}),exports[a79_0x19d7dc(0x1e3)]=void 0x0;const common_1=require('@nestjs/common'),nodemailer=require(a79_0x19d7dc(0x1f1)),setting_service_1=require('../setting/setting.service');function a79_0x1dc2(_0xe3ccb5,_0xf3e829){const _0xdfeb8e=a79_0xdfeb();return a79_0x1dc2=function(_0x1dc200,_0x41a1a2){_0x1dc200=_0x1dc200-0x1dc;let _0xbab8c2=_0xdfeb8e[_0x1dc200];return _0xbab8c2;},a79_0x1dc2(_0xe3ccb5,_0xf3e829);}let EmailService=EmailService_1=class EmailService{constructor(_0x23702c){const _0x19d145=a79_0x19d7dc;this[_0x19d145(0x223)]=_0x23702c,this[_0x19d145(0x21e)]=new common_1[(_0x19d145(0x205))](EmailService_1[_0x19d145(0x229)]),this[_0x19d145(0x1f6)]='dev.absolutepa@gmail.com,service@absolutepa.com.au',this[_0x19d145(0x1e4)]=null,this[_0x19d145(0x20a)]();}async[a79_0x19d7dc(0x1fc)](){const _0x3962bf=a79_0x19d7dc;try{const _0x413a3d=await this[_0x3962bf(0x223)][_0x3962bf(0x203)]();this[_0x3962bf(0x1e4)]=(_0x413a3d===null||_0x413a3d===void 0x0?void 0x0:_0x413a3d['schoolId'])||null;}catch(_0x2629f9){this[_0x3962bf(0x21e)][_0x3962bf(0x1f7)]('Failed\x20to\x20cache\x20device\x20name\x20on\x20startup.'),this[_0x3962bf(0x1e4)]=null;}}['createTransporter'](){const _0x285b79=a79_0x19d7dc;this[_0x285b79(0x1fa)]()?this[_0x285b79(0x1f4)]=nodemailer['createTransport']({'host':process['env'][_0x285b79(0x21b)],'port':parseInt(process[_0x285b79(0x1f9)][_0x285b79(0x1e6)]||'587'),'secure':process[_0x285b79(0x1f9)]['SMTP_SECURE']===_0x285b79(0x216),'auth':{'user':process[_0x285b79(0x1f9)][_0x285b79(0x1ef)],'pass':process[_0x285b79(0x1f9)][_0x285b79(0x214)]}}):(this['logger']['warn'](_0x285b79(0x20f)),this[_0x285b79(0x1f4)]=nodemailer[_0x285b79(0x219)]({'host':_0x285b79(0x1e2),'port':0x24b,'secure':![],'auth':{'user':_0x285b79(0x209),'pass':'exdyrljbopqilckb'}}));}[a79_0x19d7dc(0x1fa)](){const _0x362fd1=a79_0x19d7dc;return!!(process[_0x362fd1(0x1f9)][_0x362fd1(0x21b)]&&process[_0x362fd1(0x1f9)]['SMTP_USER']&&process[_0x362fd1(0x1f9)]['SMTP_PASS']&&process[_0x362fd1(0x1f9)][_0x362fd1(0x1e8)]);}async[a79_0x19d7dc(0x1f5)](_0x238e32){const _0x39d437=a79_0x19d7dc;if(!this[_0x39d437(0x1f4)]){this[_0x39d437(0x21e)][_0x39d437(0x204)](_0x39d437(0x224));return;}const _0x348ec0=await this[_0x39d437(0x1ff)](_0x238e32);try{const _0x248515=this[_0x39d437(0x225)](_0x238e32,_0x348ec0);await this[_0x39d437(0x1f4)][_0x39d437(0x1fe)]({'from':process['env']['SMTP_FROM']||'\x22Exception\x20Notifier\x22\x20<no-reply@absolutepa.com>','to':process[_0x39d437(0x1f9)][_0x39d437(0x1e8)]||this[_0x39d437(0x1f6)],'subject':'['+_0x348ec0+_0x39d437(0x227),'text':_0x248515,'html':this['formatExceptionEmailHtml'](_0x238e32,_0x348ec0)}),this['logger']['log'](_0x39d437(0x22a));}catch(_0x3fc0a0){this[_0x39d437(0x21e)]['error']('Failed\x20to\x20send\x20exception\x20notification\x20email:',_0x3fc0a0);}}['formatExceptionEmail'](_0x2683b2,_0x350954){const _0x5a6cf3=a79_0x19d7dc;return(_0x5a6cf3(0x208)+_0x350954+_0x5a6cf3(0x1ea)+(_0x2683b2['timestamp']||new Date()[_0x5a6cf3(0x20d)]())+_0x5a6cf3(0x201)+(_0x2683b2[_0x5a6cf3(0x1ed)]||_0x5a6cf3(0x1de))+_0x5a6cf3(0x211)+(_0x2683b2[_0x5a6cf3(0x228)]||'N/A')+_0x5a6cf3(0x1e9)+_0x2683b2[_0x5a6cf3(0x1f0)]+_0x5a6cf3(0x212)+(_0x2683b2['body']?JSON[_0x5a6cf3(0x213)](_0x2683b2[_0x5a6cf3(0x20c)],null,0x2):'N/A')+'\x0a\x0aRequest\x20Headers:\x0a'+(_0x2683b2['headers']?JSON[_0x5a6cf3(0x213)](_0x2683b2[_0x5a6cf3(0x1fb)],null,0x2):_0x5a6cf3(0x1de))+_0x5a6cf3(0x1df))['trim']();}['formatExceptionEmailHtml'](_0x2fd293,_0x54d381){const _0xb65c2c=a79_0x19d7dc;return _0xb65c2c(0x21d)+_0x54d381+_0xb65c2c(0x1ec)+(_0x2fd293['timestamp']||new Date()[_0xb65c2c(0x20d)]())+_0xb65c2c(0x206)+(_0x2fd293[_0xb65c2c(0x1ed)]||_0xb65c2c(0x1de))+_0xb65c2c(0x1f8)+(_0x2fd293['method']||'N/A')+_0xb65c2c(0x202)+_0x2fd293['message']+_0xb65c2c(0x1f2)+(_0x2fd293[_0xb65c2c(0x20c)]?JSON[_0xb65c2c(0x213)](_0x2fd293[_0xb65c2c(0x20c)],null,0x2):'N/A')+'</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Headers:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>'+(_0x2fd293[_0xb65c2c(0x1fb)]?JSON[_0xb65c2c(0x213)](_0x2fd293[_0xb65c2c(0x1fb)],null,0x2):'N/A')+_0xb65c2c(0x1ee);}async['getDeviceName'](_0x4f7455){const _0x5cecce=a79_0x19d7dc;if(this[_0x5cecce(0x1e4)])return this[_0x5cecce(0x1e4)];try{const _0x51e163=await this[_0x5cecce(0x223)][_0x5cecce(0x203)]();return(_0x51e163===null||_0x51e163===void 0x0?void 0x0:_0x51e163[_0x5cecce(0x1f3)])||_0x4f7455['piName']||_0x5cecce(0x20b);}catch(_0x1a5002){return this[_0x5cecce(0x21e)]['warn'](_0x5cecce(0x207)),_0x4f7455[_0x5cecce(0x210)]||_0x5cecce(0x20b);}}};EmailService=EmailService_1=__decorate([(0x0,common_1[a79_0x19d7dc(0x220)])(),__metadata('design:paramtypes',[setting_service_1[a79_0x19d7dc(0x222)]])],EmailService),exports[a79_0x19d7dc(0x1e3)]=EmailService;