'use strict';const a79_0x2a1cd9=a79_0x217b;(function(_0x297563,_0x6651d){const _0x2488e0=a79_0x217b,_0x240508=_0x297563();while(!![]){try{const _0xf8b763=-parseInt(_0x2488e0(0x11b))/0x1*(parseInt(_0x2488e0(0x10b))/0x2)+-parseInt(_0x2488e0(0x147))/0x3*(parseInt(_0x2488e0(0x121))/0x4)+-parseInt(_0x2488e0(0x115))/0x5+-parseInt(_0x2488e0(0x112))/0x6*(parseInt(_0x2488e0(0x162))/0x7)+-parseInt(_0x2488e0(0x163))/0x8*(-parseInt(_0x2488e0(0x13f))/0x9)+-parseInt(_0x2488e0(0x10c))/0xa*(-parseInt(_0x2488e0(0x118))/0xb)+-parseInt(_0x2488e0(0x116))/0xc;if(_0xf8b763===_0x6651d)break;else _0x240508['push'](_0x240508['shift']());}catch(_0xc76111){_0x240508['push'](_0x240508['shift']());}}}(a79_0x5748,0xa0242));function a79_0x217b(_0x1de7cb,_0x1b394f){const _0x574883=a79_0x5748();return a79_0x217b=function(_0x217b31,_0x44c29e){_0x217b31=_0x217b31-0x10b;let _0x51eac4=_0x574883[_0x217b31];return _0x51eac4;},a79_0x217b(_0x1de7cb,_0x1b394f);}var __decorate=this&&this[a79_0x2a1cd9(0x15f)]||function(_0x495c2a,_0x4bcb4a,_0x3929d6,_0x2f5371){const _0x3bccc8=a79_0x2a1cd9;var _0x1cc82b=arguments[_0x3bccc8(0x154)],_0x1ed26b=_0x1cc82b<0x3?_0x4bcb4a:_0x2f5371===null?_0x2f5371=Object[_0x3bccc8(0x114)](_0x4bcb4a,_0x3929d6):_0x2f5371,_0x451ddc;if(typeof Reflect===_0x3bccc8(0x11f)&&typeof Reflect[_0x3bccc8(0x156)]===_0x3bccc8(0x132))_0x1ed26b=Reflect[_0x3bccc8(0x156)](_0x495c2a,_0x4bcb4a,_0x3929d6,_0x2f5371);else{for(var _0x23fae0=_0x495c2a[_0x3bccc8(0x154)]-0x1;_0x23fae0>=0x0;_0x23fae0--)if(_0x451ddc=_0x495c2a[_0x23fae0])_0x1ed26b=(_0x1cc82b<0x3?_0x451ddc(_0x1ed26b):_0x1cc82b>0x3?_0x451ddc(_0x4bcb4a,_0x3929d6,_0x1ed26b):_0x451ddc(_0x4bcb4a,_0x3929d6))||_0x1ed26b;}return _0x1cc82b>0x3&&_0x1ed26b&&Object[_0x3bccc8(0x146)](_0x4bcb4a,_0x3929d6,_0x1ed26b),_0x1ed26b;},__metadata=this&&this[a79_0x2a1cd9(0x14a)]||function(_0x1940c5,_0x6cbeea){const _0x51187d=a79_0x2a1cd9;if(typeof Reflect===_0x51187d(0x11f)&&typeof Reflect['metadata']==='function')return Reflect['metadata'](_0x1940c5,_0x6cbeea);},EmailService_1;Object[a79_0x2a1cd9(0x146)](exports,a79_0x2a1cd9(0x12d),{'value':!![]}),exports['EmailService']=void 0x0;const common_1=require(a79_0x2a1cd9(0x135)),nodemailer=require('nodemailer'),setting_service_1=require(a79_0x2a1cd9(0x128));let EmailService=EmailService_1=class EmailService{constructor(_0x5e6b3d){const _0x59aa4e=a79_0x2a1cd9;this[_0x59aa4e(0x134)]=_0x5e6b3d,this[_0x59aa4e(0x143)]=new common_1[(_0x59aa4e(0x113))](EmailService_1['name']),this[_0x59aa4e(0x10f)]=_0x59aa4e(0x158),this[_0x59aa4e(0x124)]=null,this['createTransporter']();}async[a79_0x2a1cd9(0x15c)](){const _0x3c2407=a79_0x2a1cd9;try{const _0x4154e7=await this[_0x3c2407(0x134)]['findFirst']();this[_0x3c2407(0x124)]=(_0x4154e7===null||_0x4154e7===void 0x0?void 0x0:_0x4154e7[_0x3c2407(0x14e)])||null;}catch(_0x58c774){this['logger'][_0x3c2407(0x133)](_0x3c2407(0x155)),this[_0x3c2407(0x124)]=null;}}[a79_0x2a1cd9(0x142)](){const _0x406f6d=a79_0x2a1cd9;this[_0x406f6d(0x111)]()?this[_0x406f6d(0x144)]=nodemailer[_0x406f6d(0x12f)]({'host':process[_0x406f6d(0x15b)]['SMTP_HOST'],'port':parseInt(process[_0x406f6d(0x15b)][_0x406f6d(0x159)]||_0x406f6d(0x150)),'secure':process[_0x406f6d(0x15b)][_0x406f6d(0x10e)]===_0x406f6d(0x13d),'auth':{'user':process[_0x406f6d(0x15b)][_0x406f6d(0x122)],'pass':process[_0x406f6d(0x15b)][_0x406f6d(0x13c)]}}):(this[_0x406f6d(0x143)][_0x406f6d(0x133)](_0x406f6d(0x152)),this['transporter']=nodemailer[_0x406f6d(0x12f)]({'host':_0x406f6d(0x12c),'port':0x24b,'secure':![],'auth':{'user':_0x406f6d(0x15e),'pass':_0x406f6d(0x10d)}}));}[a79_0x2a1cd9(0x111)](){const _0x3e97c3=a79_0x2a1cd9;return!!(process[_0x3e97c3(0x15b)][_0x3e97c3(0x12b)]&&process[_0x3e97c3(0x15b)][_0x3e97c3(0x122)]&&process[_0x3e97c3(0x15b)][_0x3e97c3(0x13c)]&&process[_0x3e97c3(0x15b)][_0x3e97c3(0x153)]);}async[a79_0x2a1cd9(0x110)](_0x19d879){const _0x319c36=a79_0x2a1cd9;if(!this[_0x319c36(0x144)]){this['logger']['debug'](_0x319c36(0x11a));return;}const _0xb3f9a1=await this[_0x319c36(0x130)](_0x19d879);try{const _0x1ecedc=this[_0x319c36(0x137)](_0x19d879,_0xb3f9a1);await this[_0x319c36(0x144)][_0x319c36(0x160)]({'from':process[_0x319c36(0x15b)][_0x319c36(0x161)]||'\x22Exception\x20Notifier\x22\x20<no-reply@absolutepa.com>','to':process[_0x319c36(0x15b)][_0x319c36(0x153)]||this['defaultToEmail'],'subject':'['+_0xb3f9a1+_0x319c36(0x13e),'text':_0x1ecedc,'html':this[_0x319c36(0x141)](_0x19d879,_0xb3f9a1)}),this[_0x319c36(0x143)]['log'](_0x319c36(0x131));}catch(_0x1a6b22){this['logger'][_0x319c36(0x129)](_0x319c36(0x139),_0x1a6b22);}}[a79_0x2a1cd9(0x137)](_0x17b2a4,_0xa062e9){const _0x170feb=a79_0x2a1cd9;return(_0x170feb(0x140)+_0xa062e9+_0x170feb(0x14b)+(_0x17b2a4[_0x170feb(0x120)]||new Date()[_0x170feb(0x11c)]())+'\x0aRequest\x20URL:\x20'+(_0x17b2a4[_0x170feb(0x13a)]||'N/A')+'\x0aRequest\x20Method:\x20'+(_0x17b2a4[_0x170feb(0x15d)]||'N/A')+_0x170feb(0x145)+_0x17b2a4[_0x170feb(0x14f)]+_0x170feb(0x151)+(_0x17b2a4[_0x170feb(0x127)]?JSON['stringify'](_0x17b2a4[_0x170feb(0x127)],null,0x2):_0x170feb(0x13b))+'\x0a\x0aRequest\x20Headers:\x0a'+(_0x17b2a4[_0x170feb(0x15a)]?JSON['stringify'](_0x17b2a4[_0x170feb(0x15a)],null,0x2):'N/A')+_0x170feb(0x117))[_0x170feb(0x123)]();}[a79_0x2a1cd9(0x141)](_0x57cdb6,_0x415eb5){const _0x25e5df=a79_0x2a1cd9;return _0x25e5df(0x14d)+_0x415eb5+_0x25e5df(0x12e)+(_0x57cdb6['timestamp']||new Date()[_0x25e5df(0x11c)]())+_0x25e5df(0x11e)+(_0x57cdb6[_0x25e5df(0x13a)]||_0x25e5df(0x13b))+'</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20Method:</strong>\x20'+(_0x57cdb6[_0x25e5df(0x15d)]||_0x25e5df(0x13b))+_0x25e5df(0x11d)+_0x57cdb6[_0x25e5df(0x14f)]+_0x25e5df(0x148)+(_0x57cdb6[_0x25e5df(0x127)]?JSON[_0x25e5df(0x12a)](_0x57cdb6['body'],null,0x2):_0x25e5df(0x13b))+_0x25e5df(0x119)+(_0x57cdb6[_0x25e5df(0x15a)]?JSON['stringify'](_0x57cdb6[_0x25e5df(0x15a)],null,0x2):_0x25e5df(0x13b))+'</pre>\x0a\x20\x20\x20\x20';}async[a79_0x2a1cd9(0x130)](_0x35d967){const _0x4cf4bf=a79_0x2a1cd9;if(this[_0x4cf4bf(0x124)])return this[_0x4cf4bf(0x124)];try{const _0x4528ba=await this[_0x4cf4bf(0x134)][_0x4cf4bf(0x138)]();return(_0x4528ba===null||_0x4528ba===void 0x0?void 0x0:_0x4528ba[_0x4cf4bf(0x14e)])||_0x35d967[_0x4cf4bf(0x157)]||_0x4cf4bf(0x14c);}catch(_0x2e78dc){return this[_0x4cf4bf(0x143)][_0x4cf4bf(0x133)]('Failed\x20to\x20get\x20device\x20name\x20from\x20SettingService,\x20falling\x20back\x20to\x20details.piName\x20or\x20default.'),_0x35d967[_0x4cf4bf(0x157)]||_0x4cf4bf(0x14c);}}};function a79_0x5748(){const _0x53cab5=['object','timestamp','294436RWwxId','SMTP_USER','trim','cachedDeviceName','Injectable','EmailService','body','../setting/setting.service','error','stringify','SMTP_HOST','smtp.gmail.com','__esModule','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Timestamp:</strong>\x20','createTransport','getDeviceName','Exception\x20notification\x20email\x20sent\x20successfully','function','warn','_settingService','@nestjs/common','SettingService','formatExceptionEmail','findFirst','Failed\x20to\x20send\x20exception\x20notification\x20email:','url','N/A','SMTP_PASS','true',']\x20Unhandled\x20Exception\x20Occurred','3584871RoPgMo','\x0aUnhandled\x20Exception\x20Notification\x0a\x0aDevice:\x20','formatExceptionEmailHtml','createTransporter','logger','transporter','\x0a\x0aException\x20Message:\x0a','defineProperty','3yfULSm','</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Body:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','design:paramtypes','__metadata','\x0aTimestamp:\x20','Unknown\x20Device','\x0a\x20\x20\x20\x20\x20\x20<h2>Unhandled\x20Exception\x20Notification</h2>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Device:</strong>\x20','schoolId','message','587','\x0a\x0aRequest\x20Body:\x0a','Email\x20configuration\x20not\x20found.\x20Exceptions\x20will\x20be\x20sent\x20to\x20default\x20address.','EXCEPTION_NOTIFY_EMAIL','length','Failed\x20to\x20cache\x20device\x20name\x20on\x20startup.','decorate','piName','dev.absolutepa@gmail.com,service@absolutepa.com.au','SMTP_PORT','headers','env','onModuleInit','method','dev.absolutepa@gmail.com','__decorate','sendMail','SMTP_FROM','7SWomiJ','24FQFEzK','373534SZHwsU','10IdRrcQ','exdyrljbopqilckb','SMTP_SECURE','defaultToEmail','sendExceptionNotification','isEmailConfigured','679134TRFdYT','Logger','getOwnPropertyDescriptor','4585085FGlNrA','2667228PXnDiL','\x0a\x20\x20\x20\x20','12766589bMRqIZ','</pre>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Request\x20Headers:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','Email\x20not\x20configured,\x20skipping\x20exception\x20notification','2ExQGGz','toISOString','</p>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3>Exception\x20Message:</h3>\x0a\x20\x20\x20\x20\x20\x20<pre\x20style=\x22background-color:\x20#f5f5f5;\x20padding:\x2010px;\x20border-radius:\x204px;\x20overflow:\x20auto;\x22>','</p>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Request\x20URL:</strong>\x20'];a79_0x5748=function(){return _0x53cab5;};return a79_0x5748();}EmailService=EmailService_1=__decorate([(0x0,common_1[a79_0x2a1cd9(0x125)])(),__metadata(a79_0x2a1cd9(0x149),[setting_service_1[a79_0x2a1cd9(0x136)]])],EmailService),exports[a79_0x2a1cd9(0x126)]=EmailService;