'use strict';const a120_0x3fb5bb=a120_0x12b7;function a120_0xa04f(){const _0x14a1b6=['schoolId','log','12991825qGqfYh','BadRequestException','UserSettingDto','Invalid\x20license\x20key','__metadata','design:returntype','pm2\x20restart\x20startUI\x20startApi','./dto','/kill-jobs','832581UBxaPk','62476hhyvSg','59130eIXLCc','104jcIvCB','Post','../auth/guards/jwt.guard','../auth/guards/roles.guard','__decorate','../auth/decorators/roles.decorator','defineProperty','licenseKey','UpdateSettingDto','__esModule','Get','updateCode','design:paramtypes',':id/user-setting','Master','Param','Success\x20request\x20update\x20app\x20to\x20latest\x20version','Admin',':id/license','prototype','Body','733943cATtbL','Roles','Controller','/update','Role','mapSettingDocumentToDto','210rxeCLh','9fVJlDG','data','__param','UseGuards','@nestjs/common','70zwkWfc','stdin','object','exec','update','SettingController','JwtAuthGuard','RolesGuard','userSetting','validateLicenseKey','error','Patch','killJobs','length','41573592KQxhVi','decorate','SettingService','isValid','initalize','findFirst','settingService','790smfMuT','./dto/user-setting.dto','updateUserSetting','metadata','function','maxUser','User','design:type','getOwnPropertyDescriptor','expiryDate','./mappers/setting.mapper','41352XUPsyu','setting'];a120_0xa04f=function(){return _0x14a1b6;};return a120_0xa04f();}(function(_0x32cf81,_0x4afe42){const _0x5053ae=a120_0x12b7,_0x4f4186=_0x32cf81();while(!![]){try{const _0x3b552c=-parseInt(_0x5053ae(0x7f))/0x1*(-parseInt(_0x5053ae(0xb2))/0x2)+-parseInt(_0x5053ae(0x7e))/0x3*(parseInt(_0x5053ae(0xa4))/0x4)+-parseInt(_0x5053ae(0x99))/0x5*(-parseInt(_0x5053ae(0xb3))/0x6)+-parseInt(_0x5053ae(0x78))/0x7*(-parseInt(_0x5053ae(0xb4))/0x8)+-parseInt(_0x5053ae(0xb1))/0x9*(-parseInt(_0x5053ae(0x84))/0xa)+parseInt(_0x5053ae(0xa8))/0xb+-parseInt(_0x5053ae(0x92))/0xc;if(_0x3b552c===_0x4afe42)break;else _0x4f4186['push'](_0x4f4186['shift']());}catch(_0x29d86f){_0x4f4186['push'](_0x4f4186['shift']());}}}(a120_0xa04f,0xcd835));var __decorate=this&&this[a120_0x3fb5bb(0xb8)]||function(_0x178308,_0x1707b6,_0x263516,_0x26db67){const _0x2e72ce=a120_0x3fb5bb;var _0x2f9ed1=arguments[_0x2e72ce(0x91)],_0x1680e9=_0x2f9ed1<0x3?_0x1707b6:_0x26db67===null?_0x26db67=Object[_0x2e72ce(0xa1)](_0x1707b6,_0x263516):_0x26db67,_0x5e360b;if(typeof Reflect===_0x2e72ce(0x86)&&typeof Reflect[_0x2e72ce(0x93)]===_0x2e72ce(0x9d))_0x1680e9=Reflect[_0x2e72ce(0x93)](_0x178308,_0x1707b6,_0x263516,_0x26db67);else{for(var _0x5c8938=_0x178308[_0x2e72ce(0x91)]-0x1;_0x5c8938>=0x0;_0x5c8938--)if(_0x5e360b=_0x178308[_0x5c8938])_0x1680e9=(_0x2f9ed1<0x3?_0x5e360b(_0x1680e9):_0x2f9ed1>0x3?_0x5e360b(_0x1707b6,_0x263516,_0x1680e9):_0x5e360b(_0x1707b6,_0x263516))||_0x1680e9;}return _0x2f9ed1>0x3&&_0x1680e9&&Object[_0x2e72ce(0xba)](_0x1707b6,_0x263516,_0x1680e9),_0x1680e9;},__metadata=this&&this[a120_0x3fb5bb(0xac)]||function(_0x4dcd43,_0x1aa161){const _0x901846=a120_0x3fb5bb;if(typeof Reflect==='object'&&typeof Reflect['metadata']==='function')return Reflect[_0x901846(0x9c)](_0x4dcd43,_0x1aa161);},__param=this&&this[a120_0x3fb5bb(0x81)]||function(_0x17f75c,_0x53e39b){return function(_0x29d60c,_0x55dabf){_0x53e39b(_0x29d60c,_0x55dabf,_0x17f75c);};};Object[a120_0x3fb5bb(0xba)](exports,a120_0x3fb5bb(0xbd),{'value':!![]}),exports[a120_0x3fb5bb(0x89)]=void 0x0;function a120_0x12b7(_0x3faf68,_0x50ac5a){const _0xa04f77=a120_0xa04f();return a120_0x12b7=function(_0x12b73b,_0x666ca8){_0x12b73b=_0x12b73b-0x73;let _0x506b6c=_0xa04f77[_0x12b73b];return _0x506b6c;},a120_0x12b7(_0x3faf68,_0x50ac5a);}const common_1=require(a120_0x3fb5bb(0x83)),setting_service_1=require('./setting.service'),dto_1=require(a120_0x3fb5bb(0xaf)),roles_decorator_1=require(a120_0x3fb5bb(0xb9)),role_enum_1=require('../auth/enums/role.enum'),jwt_guard_1=require(a120_0x3fb5bb(0xb6)),roles_guard_1=require(a120_0x3fb5bb(0xb7)),setting_mapper_1=require(a120_0x3fb5bb(0xa3)),child_process_1=require('child_process'),user_setting_dto_1=require(a120_0x3fb5bb(0x9a));let SettingController=class SettingController{constructor(_0x428dfd){const _0x416e6b=a120_0x3fb5bb;this[_0x416e6b(0x98)]=_0x428dfd,this[_0x416e6b(0x96)]();}async[a120_0x3fb5bb(0x97)](){const _0x8c12f8=a120_0x3fb5bb,_0x3a2e81=await this[_0x8c12f8(0x98)]['findFirst'](),_0x185c21=this[_0x8c12f8(0x98)][_0x8c12f8(0x8d)](_0x3a2e81[_0x8c12f8(0xbb)],_0x3a2e81[_0x8c12f8(0xa6)]);return(0x0,setting_mapper_1[_0x8c12f8(0x7d)])(_0x3a2e81,_0x185c21[_0x8c12f8(0xa2)]);}async['updateCode'](){const _0x1741df=a120_0x3fb5bb,_0x27b8fa=(0x0,child_process_1[_0x1741df(0x87)])(_0x1741df(0xae));return console[_0x1741df(0xa7)](_0x1741df(0x73)),_0x27b8fa['stdout']['on'](_0x1741df(0x8e),_0x2d01d1=>{const _0x554fed=_0x1741df;console[_0x554fed(0xa7)](_0x2d01d1);}),_0x27b8fa[_0x1741df(0x85)]['on'](_0x1741df(0x8e),_0x3a444b=>{const _0x48ce22=_0x1741df;console[_0x48ce22(0xa7)](_0x3a444b);}),_0x27b8fa['stderr']['on'](_0x1741df(0x80),_0x26ca66=>{const _0x364986=_0x1741df;console[_0x364986(0xa7)](_0x26ca66);}),'Success\x20request\x20update\x20app\x20to\x20latest\x20version';}async['update'](_0x140ec0,_0x47bdd1){const _0x52131f=a120_0x3fb5bb,_0x594dc1=this[_0x52131f(0x98)][_0x52131f(0x8d)](_0x47bdd1[_0x52131f(0xbb)],_0x47bdd1[_0x52131f(0xa6)]);if(!_0x594dc1[_0x52131f(0x95)])throw new common_1[(_0x52131f(0xa9))](_0x52131f(0xab));_0x47bdd1['isExpired']=![];const _0x8e502a=await this[_0x52131f(0x98)][_0x52131f(0x88)](_0x140ec0,_0x47bdd1);return(0x0,setting_mapper_1[_0x52131f(0x7d)])(_0x8e502a,_0x594dc1[_0x52131f(0xa2)]);}async[a120_0x3fb5bb(0x9b)](_0x173f66,_0x386033){const _0x3199e2=a120_0x3fb5bb;_0x386033['maxUser']=+_0x386033[_0x3199e2(0x9e)];if(isNaN(_0x386033[_0x3199e2(0x9e)]))throw new common_1[(_0x3199e2(0xa9))]('Max\x20user\x20must\x20be\x20a\x20number');const _0x4279b7=await this[_0x3199e2(0x98)]['updateUserSetting'](_0x386033);return _0x4279b7[_0x3199e2(0x8c)];}async[a120_0x3fb5bb(0x90)](){await this['settingService']['killJobs']();}async[a120_0x3fb5bb(0x96)](){const _0x390e6d=a120_0x3fb5bb,_0x3f2107=await this[_0x390e6d(0x98)]['findFirst']();!_0x3f2107&&await this['settingService']['create']({'schoolId':'','licenseKey':'','isExpired':!![]});}};__decorate([(0x0,common_1[a120_0x3fb5bb(0xbe)])('/'),(0x0,common_1[a120_0x3fb5bb(0x82)])(jwt_guard_1[a120_0x3fb5bb(0x8a)],roles_guard_1[a120_0x3fb5bb(0x8b)]),(0x0,roles_decorator_1['Roles'])(role_enum_1[a120_0x3fb5bb(0x7c)][a120_0x3fb5bb(0x74)],role_enum_1[a120_0x3fb5bb(0x7c)][a120_0x3fb5bb(0x9f)],role_enum_1[a120_0x3fb5bb(0x7c)]['Viewer']),__metadata(a120_0x3fb5bb(0xa0),Function),__metadata(a120_0x3fb5bb(0xc0),[]),__metadata('design:returntype',Promise)],SettingController['prototype'],'findFirst',null),__decorate([(0x0,common_1[a120_0x3fb5bb(0xb5)])(a120_0x3fb5bb(0x7b)),(0x0,common_1['UseGuards'])(jwt_guard_1[a120_0x3fb5bb(0x8a)],roles_guard_1['RolesGuard']),(0x0,roles_decorator_1[a120_0x3fb5bb(0x79)])(role_enum_1['Role']['Admin'],role_enum_1[a120_0x3fb5bb(0x7c)][a120_0x3fb5bb(0x9f)]),__metadata(a120_0x3fb5bb(0xa0),Function),__metadata('design:paramtypes',[]),__metadata(a120_0x3fb5bb(0xad),Promise)],SettingController[a120_0x3fb5bb(0x76)],a120_0x3fb5bb(0xbf),null),__decorate([(0x0,common_1['Patch'])(a120_0x3fb5bb(0x75)),(0x0,common_1[a120_0x3fb5bb(0x82)])(jwt_guard_1[a120_0x3fb5bb(0x8a)],roles_guard_1['RolesGuard']),(0x0,roles_decorator_1[a120_0x3fb5bb(0x79)])(role_enum_1[a120_0x3fb5bb(0x7c)][a120_0x3fb5bb(0x74)],role_enum_1[a120_0x3fb5bb(0x7c)][a120_0x3fb5bb(0x9f)]),__param(0x0,(0x0,common_1[a120_0x3fb5bb(0xc3)])('id')),__param(0x1,(0x0,common_1[a120_0x3fb5bb(0x77)])()),__metadata(a120_0x3fb5bb(0xa0),Function),__metadata(a120_0x3fb5bb(0xc0),[String,dto_1[a120_0x3fb5bb(0xbc)]]),__metadata('design:returntype',Promise)],SettingController['prototype'],'update',null),__decorate([(0x0,common_1[a120_0x3fb5bb(0x8f)])(a120_0x3fb5bb(0xc1)),(0x0,common_1[a120_0x3fb5bb(0x82)])(jwt_guard_1[a120_0x3fb5bb(0x8a)],roles_guard_1['RolesGuard']),(0x0,roles_decorator_1[a120_0x3fb5bb(0x79)])(role_enum_1[a120_0x3fb5bb(0x7c)][a120_0x3fb5bb(0xc2)]),__param(0x0,(0x0,common_1[a120_0x3fb5bb(0xc3)])('id')),__param(0x1,(0x0,common_1[a120_0x3fb5bb(0x77)])()),__metadata(a120_0x3fb5bb(0xa0),Function),__metadata(a120_0x3fb5bb(0xc0),[String,user_setting_dto_1[a120_0x3fb5bb(0xaa)]]),__metadata(a120_0x3fb5bb(0xad),Promise)],SettingController[a120_0x3fb5bb(0x76)],a120_0x3fb5bb(0x9b),null),__decorate([(0x0,common_1[a120_0x3fb5bb(0xb5)])(a120_0x3fb5bb(0xb0)),(0x0,common_1[a120_0x3fb5bb(0x82)])(jwt_guard_1[a120_0x3fb5bb(0x8a)],roles_guard_1[a120_0x3fb5bb(0x8b)]),(0x0,roles_decorator_1[a120_0x3fb5bb(0x79)])(role_enum_1[a120_0x3fb5bb(0x7c)][a120_0x3fb5bb(0x74)],role_enum_1[a120_0x3fb5bb(0x7c)][a120_0x3fb5bb(0x9f)]),__metadata(a120_0x3fb5bb(0xa0),Function),__metadata(a120_0x3fb5bb(0xc0),[]),__metadata(a120_0x3fb5bb(0xad),Promise)],SettingController['prototype'],a120_0x3fb5bb(0x90),null),SettingController=__decorate([(0x0,common_1[a120_0x3fb5bb(0x7a)])(a120_0x3fb5bb(0xa5)),__metadata(a120_0x3fb5bb(0xc0),[setting_service_1[a120_0x3fb5bb(0x94)]])],SettingController),exports['SettingController']=SettingController;