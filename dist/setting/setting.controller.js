'use strict';function a120_0x5723(){const _0x2cc74e=['length','../auth/guards/roles.guard','./setting.service','SettingController','mapSettingDocumentToDto','1582580xfmNCb','decorate',':id/user-setting','Body','stderr','Roles','stdout','userSetting','BadRequestException','design:type','stdin','Viewer','3668217hoBOLC','3657692wdKgoQ','update','function','settingService','309596uQkFLt','Invalid\x20license\x20key','../auth/guards/jwt.guard','SettingService','pm2\x20restart\x20startUI\x20startApi','getOwnPropertyDescriptor','updateUserSetting','updateCode','Get','Role','1857621YKTnHZ','isExpired','__param','data','17563617owpowN','Param','Controller','2MqbIVm','../auth/decorators/roles.decorator','findFirst','design:returntype','UserSettingDto','Max\x20user\x20must\x20be\x20a\x20number','__esModule','RolesGuard','killJobs','__metadata','../auth/enums/role.enum','Success\x20request\x20update\x20app\x20to\x20latest\x20version','error','9954456mgBVej','24xPWQEy','Admin','initalize','/update','object','licenseKey','Patch','maxUser','child_process','design:paramtypes','log','./dto','UseGuards','metadata','__decorate','User','./dto/user-setting.dto','prototype','defineProperty','JwtAuthGuard','/kill-jobs','./mappers/setting.mapper','expiryDate'];a120_0x5723=function(){return _0x2cc74e;};return a120_0x5723();}const a120_0x24e5d5=a120_0x960f;(function(_0x31069e,_0x212f1e){const _0x411325=a120_0x960f,_0x3abbe6=_0x31069e();while(!![]){try{const _0x1c0b9a=-parseInt(_0x411325(0xde))/0x1+-parseInt(_0x411325(0xef))/0x2*(-parseInt(_0x411325(0xe8))/0x3)+-parseInt(_0x411325(0xda))/0x4+parseInt(_0x411325(0xcd))/0x5+parseInt(_0x411325(0xfc))/0x6+parseInt(_0x411325(0xd9))/0x7*(parseInt(_0x411325(0xfd))/0x8)+-parseInt(_0x411325(0xec))/0x9;if(_0x1c0b9a===_0x212f1e)break;else _0x3abbe6['push'](_0x3abbe6['shift']());}catch(_0x578ff7){_0x3abbe6['push'](_0x3abbe6['shift']());}}}(a120_0x5723,0xf2080));var __decorate=this&&this[a120_0x24e5d5(0xbf)]||function(_0x20d707,_0xea86de,_0x5e317a,_0x566830){const _0x1ad1f4=a120_0x24e5d5;var _0x3a54d6=arguments['length'],_0x42a654=_0x3a54d6<0x3?_0xea86de:_0x566830===null?_0x566830=Object[_0x1ad1f4(0xe3)](_0xea86de,_0x5e317a):_0x566830,_0x2bf73c;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x1ad1f4(0xdc))_0x42a654=Reflect[_0x1ad1f4(0xce)](_0x20d707,_0xea86de,_0x5e317a,_0x566830);else{for(var _0x2043c2=_0x20d707[_0x1ad1f4(0xc8)]-0x1;_0x2043c2>=0x0;_0x2043c2--)if(_0x2bf73c=_0x20d707[_0x2043c2])_0x42a654=(_0x3a54d6<0x3?_0x2bf73c(_0x42a654):_0x3a54d6>0x3?_0x2bf73c(_0xea86de,_0x5e317a,_0x42a654):_0x2bf73c(_0xea86de,_0x5e317a))||_0x42a654;}return _0x3a54d6>0x3&&_0x42a654&&Object[_0x1ad1f4(0xc3)](_0xea86de,_0x5e317a,_0x42a654),_0x42a654;},__metadata=this&&this[a120_0x24e5d5(0xf8)]||function(_0x22b127,_0x115c55){const _0x1c1399=a120_0x24e5d5;if(typeof Reflect===_0x1c1399(0xb5)&&typeof Reflect[_0x1c1399(0xbe)]===_0x1c1399(0xdc))return Reflect[_0x1c1399(0xbe)](_0x22b127,_0x115c55);},__param=this&&this[a120_0x24e5d5(0xea)]||function(_0x2ba6f9,_0x2c2cc4){return function(_0x267c14,_0x11e650){_0x2c2cc4(_0x267c14,_0x11e650,_0x2ba6f9);};};Object[a120_0x24e5d5(0xc3)](exports,a120_0x24e5d5(0xf5),{'value':!![]}),exports['SettingController']=void 0x0;const common_1=require('@nestjs/common'),setting_service_1=require(a120_0x24e5d5(0xca)),dto_1=require(a120_0x24e5d5(0xbc)),roles_decorator_1=require(a120_0x24e5d5(0xf0)),role_enum_1=require(a120_0x24e5d5(0xf9)),jwt_guard_1=require(a120_0x24e5d5(0xe0)),roles_guard_1=require(a120_0x24e5d5(0xc9)),setting_mapper_1=require(a120_0x24e5d5(0xc6)),child_process_1=require(a120_0x24e5d5(0xb9)),user_setting_dto_1=require(a120_0x24e5d5(0xc1));let SettingController=class SettingController{constructor(_0xed9f18){const _0x7abe4f=a120_0x24e5d5;this[_0x7abe4f(0xdd)]=_0xed9f18,this[_0x7abe4f(0xff)]();}async[a120_0x24e5d5(0xf1)](){const _0x40f218=a120_0x24e5d5,_0x6388be=await this['settingService'][_0x40f218(0xf1)](),_0x2cf0a2=this[_0x40f218(0xdd)]['validateLicenseKey'](_0x6388be[_0x40f218(0xb6)],_0x6388be['schoolId']);return(0x0,setting_mapper_1[_0x40f218(0xcc)])(_0x6388be,_0x2cf0a2[_0x40f218(0xc7)]);}async['updateCode'](){const _0x187447=a120_0x24e5d5,_0x3fcaf2=(0x0,child_process_1['exec'])(_0x187447(0xe2));return console[_0x187447(0xbb)](_0x187447(0xfa)),_0x3fcaf2[_0x187447(0xd3)]['on'](_0x187447(0xfb),_0xcaa362=>{const _0xd69864=_0x187447;console[_0xd69864(0xbb)](_0xcaa362);}),_0x3fcaf2[_0x187447(0xd7)]['on'](_0x187447(0xfb),_0x59de02=>{const _0x808e76=_0x187447;console[_0x808e76(0xbb)](_0x59de02);}),_0x3fcaf2[_0x187447(0xd1)]['on'](_0x187447(0xeb),_0x4b243d=>{console['log'](_0x4b243d);}),_0x187447(0xfa);}async[a120_0x24e5d5(0xdb)](_0x46e854,_0x17a6b5){const _0x488f45=a120_0x24e5d5,_0x32d6aa=this[_0x488f45(0xdd)]['validateLicenseKey'](_0x17a6b5['licenseKey'],_0x17a6b5['schoolId']);if(!_0x32d6aa['isValid'])throw new common_1[(_0x488f45(0xd5))](_0x488f45(0xdf));_0x17a6b5[_0x488f45(0xe9)]=![];const _0x9b5443=await this['settingService'][_0x488f45(0xdb)](_0x46e854,_0x17a6b5);return(0x0,setting_mapper_1['mapSettingDocumentToDto'])(_0x9b5443,_0x32d6aa[_0x488f45(0xc7)]);}async[a120_0x24e5d5(0xe4)](_0x59611a,_0x526ab3){const _0x48fdc3=a120_0x24e5d5;_0x526ab3[_0x48fdc3(0xb8)]=+_0x526ab3[_0x48fdc3(0xb8)];if(isNaN(_0x526ab3[_0x48fdc3(0xb8)]))throw new common_1[(_0x48fdc3(0xd5))](_0x48fdc3(0xf4));const _0x3c625d=await this[_0x48fdc3(0xdd)]['updateUserSetting'](_0x526ab3);return _0x3c625d[_0x48fdc3(0xd4)];}async[a120_0x24e5d5(0xf7)](){const _0x35a4eb=a120_0x24e5d5;await this[_0x35a4eb(0xdd)]['killJobs']();}async[a120_0x24e5d5(0xff)](){const _0x18c059=a120_0x24e5d5,_0x303260=await this['settingService'][_0x18c059(0xf1)]();!_0x303260&&await this['settingService']['create']({'schoolId':'','licenseKey':'','isExpired':!![]});}};function a120_0x960f(_0x5bdae4,_0x7f095c){const _0x5723f9=a120_0x5723();return a120_0x960f=function(_0x960f90,_0x3b2685){_0x960f90=_0x960f90-0xb4;let _0x25d44a=_0x5723f9[_0x960f90];return _0x25d44a;},a120_0x960f(_0x5bdae4,_0x7f095c);}__decorate([(0x0,common_1[a120_0x24e5d5(0xe6)])('/'),(0x0,common_1['UseGuards'])(jwt_guard_1[a120_0x24e5d5(0xc4)],roles_guard_1['RolesGuard']),(0x0,roles_decorator_1['Roles'])(role_enum_1[a120_0x24e5d5(0xe7)]['Admin'],role_enum_1[a120_0x24e5d5(0xe7)]['User'],role_enum_1[a120_0x24e5d5(0xe7)][a120_0x24e5d5(0xd8)]),__metadata(a120_0x24e5d5(0xd6),Function),__metadata(a120_0x24e5d5(0xba),[]),__metadata(a120_0x24e5d5(0xf2),Promise)],SettingController[a120_0x24e5d5(0xc2)],'findFirst',null),__decorate([(0x0,common_1['Post'])(a120_0x24e5d5(0xb4)),(0x0,common_1['UseGuards'])(jwt_guard_1[a120_0x24e5d5(0xc4)],roles_guard_1[a120_0x24e5d5(0xf6)]),(0x0,roles_decorator_1[a120_0x24e5d5(0xd2)])(role_enum_1[a120_0x24e5d5(0xe7)][a120_0x24e5d5(0xfe)],role_enum_1['Role'][a120_0x24e5d5(0xc0)]),__metadata(a120_0x24e5d5(0xd6),Function),__metadata(a120_0x24e5d5(0xba),[]),__metadata(a120_0x24e5d5(0xf2),Promise)],SettingController['prototype'],a120_0x24e5d5(0xe5),null),__decorate([(0x0,common_1[a120_0x24e5d5(0xb7)])(':id/license'),(0x0,common_1[a120_0x24e5d5(0xbd)])(jwt_guard_1[a120_0x24e5d5(0xc4)],roles_guard_1['RolesGuard']),(0x0,roles_decorator_1[a120_0x24e5d5(0xd2)])(role_enum_1[a120_0x24e5d5(0xe7)][a120_0x24e5d5(0xfe)],role_enum_1[a120_0x24e5d5(0xe7)]['User']),__param(0x0,(0x0,common_1[a120_0x24e5d5(0xed)])('id')),__param(0x1,(0x0,common_1[a120_0x24e5d5(0xd0)])()),__metadata('design:type',Function),__metadata(a120_0x24e5d5(0xba),[String,dto_1['UpdateSettingDto']]),__metadata('design:returntype',Promise)],SettingController['prototype'],a120_0x24e5d5(0xdb),null),__decorate([(0x0,common_1[a120_0x24e5d5(0xb7)])(a120_0x24e5d5(0xcf)),(0x0,common_1[a120_0x24e5d5(0xbd)])(jwt_guard_1[a120_0x24e5d5(0xc4)],roles_guard_1[a120_0x24e5d5(0xf6)]),(0x0,roles_decorator_1[a120_0x24e5d5(0xd2)])(role_enum_1['Role']['Master']),__param(0x0,(0x0,common_1['Param'])('id')),__param(0x1,(0x0,common_1['Body'])()),__metadata('design:type',Function),__metadata(a120_0x24e5d5(0xba),[String,user_setting_dto_1[a120_0x24e5d5(0xf3)]]),__metadata(a120_0x24e5d5(0xf2),Promise)],SettingController[a120_0x24e5d5(0xc2)],a120_0x24e5d5(0xe4),null),__decorate([(0x0,common_1['Post'])(a120_0x24e5d5(0xc5)),(0x0,common_1[a120_0x24e5d5(0xbd)])(jwt_guard_1[a120_0x24e5d5(0xc4)],roles_guard_1['RolesGuard']),(0x0,roles_decorator_1[a120_0x24e5d5(0xd2)])(role_enum_1['Role'][a120_0x24e5d5(0xfe)],role_enum_1[a120_0x24e5d5(0xe7)][a120_0x24e5d5(0xc0)]),__metadata(a120_0x24e5d5(0xd6),Function),__metadata(a120_0x24e5d5(0xba),[]),__metadata('design:returntype',Promise)],SettingController['prototype'],'killJobs',null),SettingController=__decorate([(0x0,common_1[a120_0x24e5d5(0xee)])('setting'),__metadata(a120_0x24e5d5(0xba),[setting_service_1[a120_0x24e5d5(0xe1)]])],SettingController),exports[a120_0x24e5d5(0xcb)]=SettingController;