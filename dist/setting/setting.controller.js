'use strict';const a120_0x401632=a120_0x13e0;(function(_0x3794d7,_0x3b8f32){const _0xb1a146=a120_0x13e0,_0xb89157=_0x3794d7();while(!![]){try{const _0x563786=-parseInt(_0xb1a146(0x16b))/0x1+-parseInt(_0xb1a146(0x181))/0x2*(-parseInt(_0xb1a146(0x17f))/0x3)+-parseInt(_0xb1a146(0x164))/0x4*(-parseInt(_0xb1a146(0x152))/0x5)+-parseInt(_0xb1a146(0x174))/0x6+parseInt(_0xb1a146(0x177))/0x7*(-parseInt(_0xb1a146(0x153))/0x8)+parseInt(_0xb1a146(0x158))/0x9*(-parseInt(_0xb1a146(0x18a))/0xa)+parseInt(_0xb1a146(0x188))/0xb;if(_0x563786===_0x3b8f32)break;else _0xb89157['push'](_0xb89157['shift']());}catch(_0x30f099){_0xb89157['push'](_0xb89157['shift']());}}}(a120_0x31a7,0x4a55f));function a120_0x31a7(){const _0x46ae5e=['30spZJww','schoolId','Controller','validateLicenseKey','Admin','child_process','Role','@nestjs/common','User','killJobs','__metadata','Param','error','Patch','prototype','UserSettingDto','update','pm2\x20restart\x20startUI\x20startApi','decorate','stdout','initalize',':id/user-setting','5rUyxZB','24hUHBse','maxUser','__decorate','RolesGuard','Get','690210wkZynp','BadRequestException','Body','./mappers/setting.mapper','UpdateSettingDto','__esModule','length','findFirst','userSetting','metadata','getOwnPropertyDescriptor','JwtAuthGuard','628048UDcwOP','../auth/guards/roles.guard','log','../auth/guards/jwt.guard','Viewer','exec','UseGuards','572116HpJxAh','SettingController','stderr','updateCode','isValid','create','design:type','setting','design:returntype','3498294vEMqoP','SettingService','Invalid\x20license\x20key','45381vKBEhU','__param','Post','settingService','object','updateUserSetting','Roles',':id/license','3UHfvFf','defineProperty','372336rmeJhK','Success\x20request\x20update\x20app\x20to\x20latest\x20version','../auth/enums/role.enum','design:paramtypes','mapSettingDocumentToDto','/update','Max\x20user\x20must\x20be\x20a\x20number','15025813MIZicU','function'];a120_0x31a7=function(){return _0x46ae5e;};return a120_0x31a7();}function a120_0x13e0(_0x3c2f35,_0x2b23fd){const _0x31a78a=a120_0x31a7();return a120_0x13e0=function(_0x13e082,_0x3ce946){_0x13e082=_0x13e082-0x152;let _0x3f72e9=_0x31a78a[_0x13e082];return _0x3f72e9;},a120_0x13e0(_0x3c2f35,_0x2b23fd);}var __decorate=this&&this[a120_0x401632(0x155)]||function(_0x528b7e,_0x322ac9,_0x50a06e,_0x4c2b5e){const _0x5b38b5=a120_0x401632;var _0x1eeb1f=arguments['length'],_0xf6d382=_0x1eeb1f<0x3?_0x322ac9:_0x4c2b5e===null?_0x4c2b5e=Object[_0x5b38b5(0x162)](_0x322ac9,_0x50a06e):_0x4c2b5e,_0x438a42;if(typeof Reflect===_0x5b38b5(0x17b)&&typeof Reflect[_0x5b38b5(0x19c)]===_0x5b38b5(0x189))_0xf6d382=Reflect['decorate'](_0x528b7e,_0x322ac9,_0x50a06e,_0x4c2b5e);else{for(var _0x2fc11b=_0x528b7e[_0x5b38b5(0x15e)]-0x1;_0x2fc11b>=0x0;_0x2fc11b--)if(_0x438a42=_0x528b7e[_0x2fc11b])_0xf6d382=(_0x1eeb1f<0x3?_0x438a42(_0xf6d382):_0x1eeb1f>0x3?_0x438a42(_0x322ac9,_0x50a06e,_0xf6d382):_0x438a42(_0x322ac9,_0x50a06e))||_0xf6d382;}return _0x1eeb1f>0x3&&_0xf6d382&&Object['defineProperty'](_0x322ac9,_0x50a06e,_0xf6d382),_0xf6d382;},__metadata=this&&this[a120_0x401632(0x194)]||function(_0x1862a9,_0x986b6){const _0x33350e=a120_0x401632;if(typeof Reflect===_0x33350e(0x17b)&&typeof Reflect[_0x33350e(0x161)]==='function')return Reflect[_0x33350e(0x161)](_0x1862a9,_0x986b6);},__param=this&&this[a120_0x401632(0x178)]||function(_0x5d7740,_0x35feb2){return function(_0x46e088,_0x33e024){_0x35feb2(_0x46e088,_0x33e024,_0x5d7740);};};Object[a120_0x401632(0x180)](exports,a120_0x401632(0x15d),{'value':!![]}),exports[a120_0x401632(0x16c)]=void 0x0;const common_1=require(a120_0x401632(0x191)),setting_service_1=require('./setting.service'),dto_1=require('./dto'),roles_decorator_1=require('../auth/decorators/roles.decorator'),role_enum_1=require(a120_0x401632(0x183)),jwt_guard_1=require(a120_0x401632(0x167)),roles_guard_1=require(a120_0x401632(0x165)),setting_mapper_1=require(a120_0x401632(0x15b)),child_process_1=require(a120_0x401632(0x18f)),user_setting_dto_1=require('./dto/user-setting.dto');let SettingController=class SettingController{constructor(_0x106ec7){this['settingService']=_0x106ec7,this['initalize']();}async['findFirst'](){const _0x51b459=a120_0x401632,_0x4f7964=await this['settingService']['findFirst'](),_0x572eb1=this[_0x51b459(0x17a)][_0x51b459(0x18d)](_0x4f7964['licenseKey'],_0x4f7964[_0x51b459(0x18b)]);return(0x0,setting_mapper_1[_0x51b459(0x185)])(_0x4f7964,_0x572eb1['expiryDate']);}async[a120_0x401632(0x16e)](){const _0x57e629=a120_0x401632,_0x3e4cb4=(0x0,child_process_1[_0x57e629(0x169)])(_0x57e629(0x19b));return console[_0x57e629(0x166)](_0x57e629(0x182)),_0x3e4cb4[_0x57e629(0x19d)]['on'](_0x57e629(0x196),_0x583cec=>{console['log'](_0x583cec);}),_0x3e4cb4['stdin']['on']('error',_0x56d765=>{console['log'](_0x56d765);}),_0x3e4cb4[_0x57e629(0x16d)]['on']('data',_0x537edd=>{const _0x5a0ffa=_0x57e629;console[_0x5a0ffa(0x166)](_0x537edd);}),_0x57e629(0x182);}async['update'](_0x4d8e1e,_0x746c95){const _0x1913e1=a120_0x401632,_0x19fc9b=this[_0x1913e1(0x17a)]['validateLicenseKey'](_0x746c95['licenseKey'],_0x746c95['schoolId']);if(!_0x19fc9b[_0x1913e1(0x16f)])throw new common_1[(_0x1913e1(0x159))](_0x1913e1(0x176));_0x746c95['isExpired']=![];const _0x4ea8d5=await this['settingService'][_0x1913e1(0x19a)](_0x4d8e1e,_0x746c95);return(0x0,setting_mapper_1[_0x1913e1(0x185)])(_0x4ea8d5,_0x19fc9b['expiryDate']);}async['updateUserSetting'](_0x10939a,_0x523338){const _0x386a6a=a120_0x401632;_0x523338['maxUser']=+_0x523338['maxUser'];if(isNaN(_0x523338[_0x386a6a(0x154)]))throw new common_1[(_0x386a6a(0x159))](_0x386a6a(0x187));const _0x521fff=await this[_0x386a6a(0x17a)][_0x386a6a(0x17c)](_0x523338);return _0x521fff[_0x386a6a(0x160)];}async['killJobs'](){const _0x29aefb=a120_0x401632;await this[_0x29aefb(0x17a)][_0x29aefb(0x193)]();}async[a120_0x401632(0x19e)](){const _0x3d39b9=a120_0x401632,_0x38226c=await this['settingService'][_0x3d39b9(0x15f)]();!_0x38226c&&await this[_0x3d39b9(0x17a)][_0x3d39b9(0x170)]({'schoolId':'','licenseKey':'','isExpired':!![]});}};__decorate([(0x0,common_1[a120_0x401632(0x157)])('/'),(0x0,common_1[a120_0x401632(0x16a)])(jwt_guard_1[a120_0x401632(0x163)],roles_guard_1[a120_0x401632(0x156)]),(0x0,roles_decorator_1[a120_0x401632(0x17d)])(role_enum_1[a120_0x401632(0x190)][a120_0x401632(0x18e)],role_enum_1[a120_0x401632(0x190)][a120_0x401632(0x192)],role_enum_1[a120_0x401632(0x190)][a120_0x401632(0x168)]),__metadata(a120_0x401632(0x171),Function),__metadata('design:paramtypes',[]),__metadata(a120_0x401632(0x173),Promise)],SettingController[a120_0x401632(0x198)],a120_0x401632(0x15f),null),__decorate([(0x0,common_1['Post'])(a120_0x401632(0x186)),(0x0,common_1[a120_0x401632(0x16a)])(jwt_guard_1[a120_0x401632(0x163)],roles_guard_1[a120_0x401632(0x156)]),(0x0,roles_decorator_1['Roles'])(role_enum_1[a120_0x401632(0x190)][a120_0x401632(0x18e)],role_enum_1[a120_0x401632(0x190)][a120_0x401632(0x192)]),__metadata(a120_0x401632(0x171),Function),__metadata(a120_0x401632(0x184),[]),__metadata(a120_0x401632(0x173),Promise)],SettingController[a120_0x401632(0x198)],a120_0x401632(0x16e),null),__decorate([(0x0,common_1[a120_0x401632(0x197)])(a120_0x401632(0x17e)),(0x0,common_1[a120_0x401632(0x16a)])(jwt_guard_1[a120_0x401632(0x163)],roles_guard_1['RolesGuard']),(0x0,roles_decorator_1[a120_0x401632(0x17d)])(role_enum_1[a120_0x401632(0x190)]['Admin'],role_enum_1[a120_0x401632(0x190)][a120_0x401632(0x192)]),__param(0x0,(0x0,common_1[a120_0x401632(0x195)])('id')),__param(0x1,(0x0,common_1[a120_0x401632(0x15a)])()),__metadata(a120_0x401632(0x171),Function),__metadata(a120_0x401632(0x184),[String,dto_1[a120_0x401632(0x15c)]]),__metadata(a120_0x401632(0x173),Promise)],SettingController[a120_0x401632(0x198)],'update',null),__decorate([(0x0,common_1[a120_0x401632(0x197)])(a120_0x401632(0x19f)),(0x0,common_1[a120_0x401632(0x16a)])(jwt_guard_1[a120_0x401632(0x163)],roles_guard_1[a120_0x401632(0x156)]),(0x0,roles_decorator_1[a120_0x401632(0x17d)])(role_enum_1[a120_0x401632(0x190)]['Master']),__param(0x0,(0x0,common_1[a120_0x401632(0x195)])('id')),__param(0x1,(0x0,common_1['Body'])()),__metadata('design:type',Function),__metadata(a120_0x401632(0x184),[String,user_setting_dto_1[a120_0x401632(0x199)]]),__metadata(a120_0x401632(0x173),Promise)],SettingController[a120_0x401632(0x198)],a120_0x401632(0x17c),null),__decorate([(0x0,common_1[a120_0x401632(0x179)])('/kill-jobs'),(0x0,common_1[a120_0x401632(0x16a)])(jwt_guard_1[a120_0x401632(0x163)],roles_guard_1[a120_0x401632(0x156)]),(0x0,roles_decorator_1[a120_0x401632(0x17d)])(role_enum_1[a120_0x401632(0x190)][a120_0x401632(0x18e)],role_enum_1[a120_0x401632(0x190)][a120_0x401632(0x192)]),__metadata(a120_0x401632(0x171),Function),__metadata(a120_0x401632(0x184),[]),__metadata(a120_0x401632(0x173),Promise)],SettingController[a120_0x401632(0x198)],a120_0x401632(0x193),null),SettingController=__decorate([(0x0,common_1[a120_0x401632(0x18c)])(a120_0x401632(0x172)),__metadata(a120_0x401632(0x184),[setting_service_1[a120_0x401632(0x175)]])],SettingController),exports[a120_0x401632(0x16c)]=SettingController;