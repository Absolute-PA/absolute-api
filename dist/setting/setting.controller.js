'use strict';const a120_0x2e92e3=a120_0x3d87;(function(_0x524b78,_0x3ddfb4){const _0x3c8f72=a120_0x3d87,_0x549ede=_0x524b78();while(!![]){try{const _0xcb653c=parseInt(_0x3c8f72(0xe5))/0x1+parseInt(_0x3c8f72(0xda))/0x2+-parseInt(_0x3c8f72(0xec))/0x3+parseInt(_0x3c8f72(0xf3))/0x4*(parseInt(_0x3c8f72(0x104))/0x5)+-parseInt(_0x3c8f72(0xe0))/0x6+parseInt(_0x3c8f72(0x102))/0x7*(-parseInt(_0x3c8f72(0xc8))/0x8)+-parseInt(_0x3c8f72(0xe3))/0x9*(-parseInt(_0x3c8f72(0xc3))/0xa);if(_0xcb653c===_0x3ddfb4)break;else _0x549ede['push'](_0x549ede['shift']());}catch(_0x3db9ac){_0x549ede['push'](_0x549ede['shift']());}}}(a120_0x2012,0x19dc5));var __decorate=this&&this[a120_0x2e92e3(0xc2)]||function(_0x2c301b,_0x2f4aee,_0x2fd3a0,_0x33e828){const _0x6e0c55=a120_0x2e92e3;var _0x18423e=arguments['length'],_0x19dc59=_0x18423e<0x3?_0x2f4aee:_0x33e828===null?_0x33e828=Object[_0x6e0c55(0xfb)](_0x2f4aee,_0x2fd3a0):_0x33e828,_0xc8ec2e;if(typeof Reflect==='object'&&typeof Reflect[_0x6e0c55(0xdd)]==='function')_0x19dc59=Reflect[_0x6e0c55(0xdd)](_0x2c301b,_0x2f4aee,_0x2fd3a0,_0x33e828);else{for(var _0x56121a=_0x2c301b[_0x6e0c55(0x110)]-0x1;_0x56121a>=0x0;_0x56121a--)if(_0xc8ec2e=_0x2c301b[_0x56121a])_0x19dc59=(_0x18423e<0x3?_0xc8ec2e(_0x19dc59):_0x18423e>0x3?_0xc8ec2e(_0x2f4aee,_0x2fd3a0,_0x19dc59):_0xc8ec2e(_0x2f4aee,_0x2fd3a0))||_0x19dc59;}return _0x18423e>0x3&&_0x19dc59&&Object[_0x6e0c55(0xf4)](_0x2f4aee,_0x2fd3a0,_0x19dc59),_0x19dc59;},__metadata=this&&this[a120_0x2e92e3(0xd5)]||function(_0x4366d1,_0x9d5502){const _0x3fd7ae=a120_0x2e92e3;if(typeof Reflect===_0x3fd7ae(0xef)&&typeof Reflect[_0x3fd7ae(0xeb)]===_0x3fd7ae(0x10f))return Reflect['metadata'](_0x4366d1,_0x9d5502);},__param=this&&this[a120_0x2e92e3(0x10d)]||function(_0x2f3f3f,_0x3cd6c0){return function(_0x41bf21,_0x33ecb1){_0x3cd6c0(_0x41bf21,_0x33ecb1,_0x2f3f3f);};};Object[a120_0x2e92e3(0xf4)](exports,'__esModule',{'value':!![]}),exports['SettingController']=void 0x0;function a120_0x3d87(_0x8afdc9,_0x155d40){const _0x20129f=a120_0x2012();return a120_0x3d87=function(_0x3d874e,_0x2540db){_0x3d874e=_0x3d874e-0xc2;let _0x13b58a=_0x20129f[_0x3d874e];return _0x13b58a;},a120_0x3d87(_0x8afdc9,_0x155d40);}const common_1=require(a120_0x2e92e3(0xc4)),setting_service_1=require(a120_0x2e92e3(0xd8)),dto_1=require(a120_0x2e92e3(0xf6)),roles_decorator_1=require(a120_0x2e92e3(0x107)),role_enum_1=require(a120_0x2e92e3(0xc9)),jwt_guard_1=require(a120_0x2e92e3(0xca)),roles_guard_1=require(a120_0x2e92e3(0xee)),setting_mapper_1=require('./mappers/setting.mapper'),child_process_1=require(a120_0x2e92e3(0xc6)),user_setting_dto_1=require(a120_0x2e92e3(0xc7));function a120_0x2012(){const _0x3ef950=['Max\x20user\x20must\x20be\x20a\x20number','decorate','isExpired','/update','704772HFvlRw','isValid','killJobs','54DNtlTY','mapSettingDocumentToDto','65804JYwzou','update',':id/license','maxUser','updateCode','Controller','metadata','300906JVTFzv','error','../auth/guards/roles.guard','object','UpdateSettingDto','stdout','Body','20bbGduN','defineProperty','prototype','./dto','Viewer','design:paramtypes','BadRequestException','Post','getOwnPropertyDescriptor','/kill-jobs','initalize','settingService','Roles','RolesGuard','SettingController','5089BYtPlM','updateUserSetting','108055RjoZpt','data','stderr','../auth/decorators/roles.decorator','design:returntype','create',':id/user-setting','log','design:type','__param','Success\x20request\x20update\x20app\x20to\x20latest\x20version','function','length','schoolId','__decorate','333430FzUxKX','@nestjs/common','Invalid\x20license\x20key','child_process','./dto/user-setting.dto','624QwZarU','../auth/enums/role.enum','../auth/guards/jwt.guard','SettingService','Patch','Role','Admin','UseGuards','validateLicenseKey','User','pm2\x20restart\x20startUI\x20startApi','userSetting','JwtAuthGuard','__metadata','Param','findFirst','./setting.service','expiryDate','12956yDLMKs','licenseKey'];a120_0x2012=function(){return _0x3ef950;};return a120_0x2012();}let SettingController=class SettingController{constructor(_0x498acd){const _0xde47aa=a120_0x2e92e3;this[_0xde47aa(0xfe)]=_0x498acd,this[_0xde47aa(0xfd)]();}async['findFirst'](){const _0x2979b0=a120_0x2e92e3,_0x358466=await this[_0x2979b0(0xfe)][_0x2979b0(0xd7)](),_0x2c73e0=this['settingService'][_0x2979b0(0xd0)](_0x358466[_0x2979b0(0xdb)],_0x358466[_0x2979b0(0x111)]);return(0x0,setting_mapper_1[_0x2979b0(0xe4)])(_0x358466,_0x2c73e0[_0x2979b0(0xd9)]);}async[a120_0x2e92e3(0xe9)](){const _0x433cb8=a120_0x2e92e3,_0x11d708=(0x0,child_process_1['exec'])(_0x433cb8(0xd2));return console[_0x433cb8(0x10b)](_0x433cb8(0x10e)),_0x11d708[_0x433cb8(0xf1)]['on']('error',_0x15e366=>{const _0x269d48=_0x433cb8;console[_0x269d48(0x10b)](_0x15e366);}),_0x11d708['stdin']['on'](_0x433cb8(0xed),_0x72710=>{const _0x1afd74=_0x433cb8;console[_0x1afd74(0x10b)](_0x72710);}),_0x11d708[_0x433cb8(0x106)]['on'](_0x433cb8(0x105),_0xd8a47a=>{const _0x59af02=_0x433cb8;console[_0x59af02(0x10b)](_0xd8a47a);}),_0x433cb8(0x10e);}async['update'](_0x4c83ef,_0x4dfed7){const _0x4b018c=a120_0x2e92e3,_0x4929d4=this[_0x4b018c(0xfe)]['validateLicenseKey'](_0x4dfed7[_0x4b018c(0xdb)],_0x4dfed7[_0x4b018c(0x111)]);if(!_0x4929d4[_0x4b018c(0xe1)])throw new common_1[(_0x4b018c(0xf9))](_0x4b018c(0xc5));_0x4dfed7[_0x4b018c(0xde)]=![];const _0xb281cd=await this[_0x4b018c(0xfe)][_0x4b018c(0xe6)](_0x4c83ef,_0x4dfed7);return(0x0,setting_mapper_1[_0x4b018c(0xe4)])(_0xb281cd,_0x4929d4[_0x4b018c(0xd9)]);}async['updateUserSetting'](_0x263db2,_0x428dc0){const _0x37aefd=a120_0x2e92e3;_0x428dc0[_0x37aefd(0xe8)]=+_0x428dc0[_0x37aefd(0xe8)];if(isNaN(_0x428dc0[_0x37aefd(0xe8)]))throw new common_1['BadRequestException'](_0x37aefd(0xdc));const _0x218d2e=await this[_0x37aefd(0xfe)][_0x37aefd(0x103)](_0x428dc0);return _0x218d2e[_0x37aefd(0xd3)];}async['killJobs'](){const _0x3301ae=a120_0x2e92e3;await this[_0x3301ae(0xfe)][_0x3301ae(0xe2)]();}async['initalize'](){const _0x4a0188=a120_0x2e92e3,_0x526418=await this[_0x4a0188(0xfe)][_0x4a0188(0xd7)]();!_0x526418&&await this[_0x4a0188(0xfe)][_0x4a0188(0x109)]({'schoolId':'','licenseKey':'','isExpired':!![]});}};__decorate([(0x0,common_1['Get'])('/'),(0x0,common_1[a120_0x2e92e3(0xcf)])(jwt_guard_1[a120_0x2e92e3(0xd4)],roles_guard_1[a120_0x2e92e3(0x100)]),(0x0,roles_decorator_1[a120_0x2e92e3(0xff)])(role_enum_1[a120_0x2e92e3(0xcd)]['Admin'],role_enum_1['Role'][a120_0x2e92e3(0xd1)],role_enum_1[a120_0x2e92e3(0xcd)][a120_0x2e92e3(0xf7)]),__metadata(a120_0x2e92e3(0x10c),Function),__metadata(a120_0x2e92e3(0xf8),[]),__metadata(a120_0x2e92e3(0x108),Promise)],SettingController['prototype'],a120_0x2e92e3(0xd7),null),__decorate([(0x0,common_1[a120_0x2e92e3(0xfa)])(a120_0x2e92e3(0xdf)),(0x0,common_1[a120_0x2e92e3(0xcf)])(jwt_guard_1[a120_0x2e92e3(0xd4)],roles_guard_1['RolesGuard']),(0x0,roles_decorator_1['Roles'])(role_enum_1[a120_0x2e92e3(0xcd)]['Admin'],role_enum_1[a120_0x2e92e3(0xcd)]['User']),__metadata(a120_0x2e92e3(0x10c),Function),__metadata(a120_0x2e92e3(0xf8),[]),__metadata(a120_0x2e92e3(0x108),Promise)],SettingController[a120_0x2e92e3(0xf5)],a120_0x2e92e3(0xe9),null),__decorate([(0x0,common_1[a120_0x2e92e3(0xcc)])(a120_0x2e92e3(0xe7)),(0x0,common_1[a120_0x2e92e3(0xcf)])(jwt_guard_1[a120_0x2e92e3(0xd4)],roles_guard_1[a120_0x2e92e3(0x100)]),(0x0,roles_decorator_1[a120_0x2e92e3(0xff)])(role_enum_1['Role']['Admin'],role_enum_1[a120_0x2e92e3(0xcd)][a120_0x2e92e3(0xd1)]),__param(0x0,(0x0,common_1[a120_0x2e92e3(0xd6)])('id')),__param(0x1,(0x0,common_1[a120_0x2e92e3(0xf2)])()),__metadata('design:type',Function),__metadata(a120_0x2e92e3(0xf8),[String,dto_1[a120_0x2e92e3(0xf0)]]),__metadata('design:returntype',Promise)],SettingController[a120_0x2e92e3(0xf5)],'update',null),__decorate([(0x0,common_1['Patch'])(a120_0x2e92e3(0x10a)),(0x0,common_1[a120_0x2e92e3(0xcf)])(jwt_guard_1[a120_0x2e92e3(0xd4)],roles_guard_1[a120_0x2e92e3(0x100)]),(0x0,roles_decorator_1[a120_0x2e92e3(0xff)])(role_enum_1[a120_0x2e92e3(0xcd)]['Master']),__param(0x0,(0x0,common_1[a120_0x2e92e3(0xd6)])('id')),__param(0x1,(0x0,common_1[a120_0x2e92e3(0xf2)])()),__metadata('design:type',Function),__metadata('design:paramtypes',[String,user_setting_dto_1['UserSettingDto']]),__metadata(a120_0x2e92e3(0x108),Promise)],SettingController['prototype'],a120_0x2e92e3(0x103),null),__decorate([(0x0,common_1[a120_0x2e92e3(0xfa)])(a120_0x2e92e3(0xfc)),(0x0,common_1['UseGuards'])(jwt_guard_1['JwtAuthGuard'],roles_guard_1[a120_0x2e92e3(0x100)]),(0x0,roles_decorator_1['Roles'])(role_enum_1[a120_0x2e92e3(0xcd)][a120_0x2e92e3(0xce)],role_enum_1[a120_0x2e92e3(0xcd)][a120_0x2e92e3(0xd1)]),__metadata(a120_0x2e92e3(0x10c),Function),__metadata(a120_0x2e92e3(0xf8),[]),__metadata(a120_0x2e92e3(0x108),Promise)],SettingController[a120_0x2e92e3(0xf5)],a120_0x2e92e3(0xe2),null),SettingController=__decorate([(0x0,common_1[a120_0x2e92e3(0xea)])('setting'),__metadata(a120_0x2e92e3(0xf8),[setting_service_1[a120_0x2e92e3(0xcb)]])],SettingController),exports[a120_0x2e92e3(0x101)]=SettingController;