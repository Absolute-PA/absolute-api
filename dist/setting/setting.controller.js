'use strict';const a120_0x5dfa29=a120_0x1f1d;(function(_0xef95cf,_0x372e42){const _0x791e1c=a120_0x1f1d,_0x22c03f=_0xef95cf();while(!![]){try{const _0x257c92=parseInt(_0x791e1c(0x186))/0x1*(parseInt(_0x791e1c(0x1b4))/0x2)+parseInt(_0x791e1c(0x191))/0x3*(parseInt(_0x791e1c(0x1ac))/0x4)+parseInt(_0x791e1c(0x192))/0x5*(-parseInt(_0x791e1c(0x1bc))/0x6)+parseInt(_0x791e1c(0x1a3))/0x7*(-parseInt(_0x791e1c(0x1a1))/0x8)+parseInt(_0x791e1c(0x1b7))/0x9+-parseInt(_0x791e1c(0x175))/0xa*(-parseInt(_0x791e1c(0x1a6))/0xb)+parseInt(_0x791e1c(0x1a0))/0xc*(-parseInt(_0x791e1c(0x182))/0xd);if(_0x257c92===_0x372e42)break;else _0x22c03f['push'](_0x22c03f['shift']());}catch(_0x24314d){_0x22c03f['push'](_0x22c03f['shift']());}}}(a120_0x4156,0xb8b3f));var __decorate=this&&this[a120_0x5dfa29(0x19e)]||function(_0x53da0b,_0x238cb5,_0x3c4ebb,_0x45e7b6){const _0x565321=a120_0x5dfa29;var _0x592d27=arguments[_0x565321(0x197)],_0xd5c777=_0x592d27<0x3?_0x238cb5:_0x45e7b6===null?_0x45e7b6=Object[_0x565321(0x189)](_0x238cb5,_0x3c4ebb):_0x45e7b6,_0x189311;if(typeof Reflect==='object'&&typeof Reflect[_0x565321(0x1ae)]===_0x565321(0x185))_0xd5c777=Reflect[_0x565321(0x1ae)](_0x53da0b,_0x238cb5,_0x3c4ebb,_0x45e7b6);else{for(var _0x5cf93c=_0x53da0b['length']-0x1;_0x5cf93c>=0x0;_0x5cf93c--)if(_0x189311=_0x53da0b[_0x5cf93c])_0xd5c777=(_0x592d27<0x3?_0x189311(_0xd5c777):_0x592d27>0x3?_0x189311(_0x238cb5,_0x3c4ebb,_0xd5c777):_0x189311(_0x238cb5,_0x3c4ebb))||_0xd5c777;}return _0x592d27>0x3&&_0xd5c777&&Object[_0x565321(0x180)](_0x238cb5,_0x3c4ebb,_0xd5c777),_0xd5c777;},__metadata=this&&this[a120_0x5dfa29(0x1ab)]||function(_0x13af73,_0x2aec20){const _0x182256=a120_0x5dfa29;if(typeof Reflect===_0x182256(0x1b6)&&typeof Reflect['metadata']===_0x182256(0x185))return Reflect[_0x182256(0x1b1)](_0x13af73,_0x2aec20);},__param=this&&this[a120_0x5dfa29(0x1ba)]||function(_0x89a0eb,_0x2726d3){return function(_0x3cc75d,_0x5e1d8e){_0x2726d3(_0x3cc75d,_0x5e1d8e,_0x89a0eb);};};Object[a120_0x5dfa29(0x180)](exports,a120_0x5dfa29(0x1a5),{'value':!![]}),exports[a120_0x5dfa29(0x1bf)]=void 0x0;const common_1=require(a120_0x5dfa29(0x17e)),setting_service_1=require('./setting.service'),dto_1=require(a120_0x5dfa29(0x177)),roles_decorator_1=require(a120_0x5dfa29(0x1b3)),role_enum_1=require(a120_0x5dfa29(0x17a)),jwt_guard_1=require('../auth/guards/jwt.guard'),roles_guard_1=require(a120_0x5dfa29(0x19d)),setting_mapper_1=require(a120_0x5dfa29(0x1a4)),child_process_1=require(a120_0x5dfa29(0x18d)),user_setting_dto_1=require(a120_0x5dfa29(0x1b8));let SettingController=class SettingController{constructor(_0x5bc3df){const _0x2c9981=a120_0x5dfa29;this['settingService']=_0x5bc3df,this[_0x2c9981(0x17f)]();}async[a120_0x5dfa29(0x176)](){const _0x185fd9=a120_0x5dfa29,_0x5d1c37=await this[_0x185fd9(0x187)]['findFirst'](),_0x4dd6ae=this[_0x185fd9(0x187)][_0x185fd9(0x1b0)](_0x5d1c37['licenseKey'],_0x5d1c37[_0x185fd9(0x1b2)]);return(0x0,setting_mapper_1['mapSettingDocumentToDto'])(_0x5d1c37,_0x4dd6ae[_0x185fd9(0x1a7)]);}async[a120_0x5dfa29(0x19c)](){const _0xe021dd=a120_0x5dfa29,_0x32d6c4=(0x0,child_process_1['exec'])(_0xe021dd(0x181));return console[_0xe021dd(0x190)](_0xe021dd(0x1a9)),_0x32d6c4[_0xe021dd(0x1c1)]['on'](_0xe021dd(0x19b),_0x2e4d0b=>{const _0x5a2364=_0xe021dd;console[_0x5a2364(0x190)](_0x2e4d0b);}),_0x32d6c4['stdin']['on'](_0xe021dd(0x19b),_0x43e775=>{console['log'](_0x43e775);}),_0x32d6c4['stderr']['on']('data',_0x5f07a0=>{const _0x3e3f25=_0xe021dd;console[_0x3e3f25(0x190)](_0x5f07a0);}),_0xe021dd(0x1a9);}async[a120_0x5dfa29(0x19f)](_0x52aa2e,_0x225475){const _0x18d0f2=a120_0x5dfa29,_0x23cac6=this[_0x18d0f2(0x187)][_0x18d0f2(0x1b0)](_0x225475['licenseKey'],_0x225475['schoolId']);if(!_0x23cac6[_0x18d0f2(0x1c3)])throw new common_1[(_0x18d0f2(0x195))](_0x18d0f2(0x193));_0x225475['isExpired']=![];const _0x5ac6fe=await this[_0x18d0f2(0x187)]['update'](_0x52aa2e,_0x225475);return(0x0,setting_mapper_1[_0x18d0f2(0x179)])(_0x5ac6fe,_0x23cac6['expiryDate']);}async[a120_0x5dfa29(0x18c)](_0x42da8e,_0x237804){const _0x3a0dd3=a120_0x5dfa29;_0x237804['maxUser']=+_0x237804[_0x3a0dd3(0x1ad)];if(isNaN(_0x237804['maxUser']))throw new common_1[(_0x3a0dd3(0x195))]('Max\x20user\x20must\x20be\x20a\x20number');const _0x1273af=await this[_0x3a0dd3(0x187)]['updateUserSetting'](_0x237804);return _0x1273af[_0x3a0dd3(0x1a2)];}async[a120_0x5dfa29(0x1af)](){const _0x2acb73=a120_0x5dfa29;await this[_0x2acb73(0x187)][_0x2acb73(0x1af)]();}async[a120_0x5dfa29(0x17f)](){const _0x488c9e=a120_0x5dfa29,_0x2ec26d=await this[_0x488c9e(0x187)]['findFirst']();!_0x2ec26d&&await this[_0x488c9e(0x187)]['create']({'schoolId':'','licenseKey':'','isExpired':!![]});}};function a120_0x4156(){const _0x16426e=['maxUser','decorate','killJobs','validateLicenseKey','metadata','schoolId','../auth/decorators/roles.decorator','13718vrfufQ','design:type','object','6971418ujpklh','./dto/user-setting.dto','Master','__param','/kill-jobs','8117718nzhKeu','SettingService','JwtAuthGuard','SettingController','Param','stdout','UpdateSettingDto','isValid',':id/license','17210oOKPzw','findFirst','./dto','Controller','mapSettingDocumentToDto','../auth/enums/role.enum','/update','Role','prototype','@nestjs/common','initalize','defineProperty','pm2\x20restart\x20startUI\x20startApi','78JPiBmD','Viewer','Patch','function','170iZJjRa','settingService','Roles','getOwnPropertyDescriptor','setting','User','updateUserSetting','child_process','Admin','design:paramtypes','log','4286154fMwNkG','5nZQRCI','Invalid\x20license\x20key','design:returntype','BadRequestException','RolesGuard','length','UseGuards','Post','UserSettingDto','error','updateCode','../auth/guards/roles.guard','__decorate','update','3070296EWcAMU','8IWaaIb','userSetting','3686844GjGkQZ','./mappers/setting.mapper','__esModule','5126HYONna','expiryDate','Body','Success\x20request\x20update\x20app\x20to\x20latest\x20version',':id/user-setting','__metadata','4qSHGyM'];a120_0x4156=function(){return _0x16426e;};return a120_0x4156();}function a120_0x1f1d(_0x4283c6,_0x590e07){const _0x415666=a120_0x4156();return a120_0x1f1d=function(_0x1f1d38,_0x3e3d37){_0x1f1d38=_0x1f1d38-0x175;let _0x4d981d=_0x415666[_0x1f1d38];return _0x4d981d;},a120_0x1f1d(_0x4283c6,_0x590e07);}__decorate([(0x0,common_1['Get'])('/'),(0x0,common_1[a120_0x5dfa29(0x198)])(jwt_guard_1[a120_0x5dfa29(0x1be)],roles_guard_1[a120_0x5dfa29(0x196)]),(0x0,roles_decorator_1[a120_0x5dfa29(0x188)])(role_enum_1[a120_0x5dfa29(0x17c)][a120_0x5dfa29(0x18e)],role_enum_1['Role'][a120_0x5dfa29(0x18b)],role_enum_1[a120_0x5dfa29(0x17c)][a120_0x5dfa29(0x183)]),__metadata(a120_0x5dfa29(0x1b5),Function),__metadata(a120_0x5dfa29(0x18f),[]),__metadata(a120_0x5dfa29(0x194),Promise)],SettingController[a120_0x5dfa29(0x17d)],a120_0x5dfa29(0x176),null),__decorate([(0x0,common_1['Post'])(a120_0x5dfa29(0x17b)),(0x0,common_1['UseGuards'])(jwt_guard_1[a120_0x5dfa29(0x1be)],roles_guard_1[a120_0x5dfa29(0x196)]),(0x0,roles_decorator_1[a120_0x5dfa29(0x188)])(role_enum_1[a120_0x5dfa29(0x17c)]['Admin'],role_enum_1['Role'][a120_0x5dfa29(0x18b)]),__metadata(a120_0x5dfa29(0x1b5),Function),__metadata(a120_0x5dfa29(0x18f),[]),__metadata(a120_0x5dfa29(0x194),Promise)],SettingController['prototype'],'updateCode',null),__decorate([(0x0,common_1[a120_0x5dfa29(0x184)])(a120_0x5dfa29(0x1c4)),(0x0,common_1['UseGuards'])(jwt_guard_1['JwtAuthGuard'],roles_guard_1['RolesGuard']),(0x0,roles_decorator_1[a120_0x5dfa29(0x188)])(role_enum_1['Role'][a120_0x5dfa29(0x18e)],role_enum_1[a120_0x5dfa29(0x17c)][a120_0x5dfa29(0x18b)]),__param(0x0,(0x0,common_1[a120_0x5dfa29(0x1c0)])('id')),__param(0x1,(0x0,common_1[a120_0x5dfa29(0x1a8)])()),__metadata('design:type',Function),__metadata(a120_0x5dfa29(0x18f),[String,dto_1[a120_0x5dfa29(0x1c2)]]),__metadata(a120_0x5dfa29(0x194),Promise)],SettingController['prototype'],'update',null),__decorate([(0x0,common_1['Patch'])(a120_0x5dfa29(0x1aa)),(0x0,common_1[a120_0x5dfa29(0x198)])(jwt_guard_1['JwtAuthGuard'],roles_guard_1[a120_0x5dfa29(0x196)]),(0x0,roles_decorator_1[a120_0x5dfa29(0x188)])(role_enum_1[a120_0x5dfa29(0x17c)][a120_0x5dfa29(0x1b9)]),__param(0x0,(0x0,common_1[a120_0x5dfa29(0x1c0)])('id')),__param(0x1,(0x0,common_1[a120_0x5dfa29(0x1a8)])()),__metadata(a120_0x5dfa29(0x1b5),Function),__metadata('design:paramtypes',[String,user_setting_dto_1[a120_0x5dfa29(0x19a)]]),__metadata(a120_0x5dfa29(0x194),Promise)],SettingController[a120_0x5dfa29(0x17d)],a120_0x5dfa29(0x18c),null),__decorate([(0x0,common_1[a120_0x5dfa29(0x199)])(a120_0x5dfa29(0x1bb)),(0x0,common_1[a120_0x5dfa29(0x198)])(jwt_guard_1['JwtAuthGuard'],roles_guard_1['RolesGuard']),(0x0,roles_decorator_1['Roles'])(role_enum_1[a120_0x5dfa29(0x17c)][a120_0x5dfa29(0x18e)],role_enum_1[a120_0x5dfa29(0x17c)][a120_0x5dfa29(0x18b)]),__metadata(a120_0x5dfa29(0x1b5),Function),__metadata(a120_0x5dfa29(0x18f),[]),__metadata(a120_0x5dfa29(0x194),Promise)],SettingController['prototype'],a120_0x5dfa29(0x1af),null),SettingController=__decorate([(0x0,common_1[a120_0x5dfa29(0x178)])(a120_0x5dfa29(0x18a)),__metadata(a120_0x5dfa29(0x18f),[setting_service_1[a120_0x5dfa29(0x1bd)]])],SettingController),exports[a120_0x5dfa29(0x1bf)]=SettingController;