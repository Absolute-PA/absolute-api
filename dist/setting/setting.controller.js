'use strict';const a120_0x2ada8d=a120_0x3306;(function(_0x1b608e,_0x8da5ef){const _0x2a80c1=a120_0x3306,_0x33f0b1=_0x1b608e();while(!![]){try{const _0x1e2354=parseInt(_0x2a80c1(0x205))/0x1*(-parseInt(_0x2a80c1(0x1fc))/0x2)+-parseInt(_0x2a80c1(0x1dd))/0x3*(parseInt(_0x2a80c1(0x21e))/0x4)+-parseInt(_0x2a80c1(0x1f0))/0x5*(parseInt(_0x2a80c1(0x20f))/0x6)+-parseInt(_0x2a80c1(0x1da))/0x7*(parseInt(_0x2a80c1(0x1e7))/0x8)+parseInt(_0x2a80c1(0x204))/0x9*(-parseInt(_0x2a80c1(0x1e2))/0xa)+-parseInt(_0x2a80c1(0x1f9))/0xb*(-parseInt(_0x2a80c1(0x1ff))/0xc)+parseInt(_0x2a80c1(0x1ee))/0xd;if(_0x1e2354===_0x8da5ef)break;else _0x33f0b1['push'](_0x33f0b1['shift']());}catch(_0x4fac3f){_0x33f0b1['push'](_0x33f0b1['shift']());}}}(a120_0x58b6,0x881a4));function a120_0x3306(_0x4ac9a9,_0x2339b1){const _0x58b6f1=a120_0x58b6();return a120_0x3306=function(_0x33069a,_0x48e7d4){_0x33069a=_0x33069a-0x1d6;let _0x12da3c=_0x58b6f1[_0x33069a];return _0x12da3c;},a120_0x3306(_0x4ac9a9,_0x2339b1);}var __decorate=this&&this['__decorate']||function(_0x3f6f27,_0x4e29dc,_0x12f694,_0x5a7125){const _0x9461f1=a120_0x3306;var _0xf29db6=arguments[_0x9461f1(0x1e8)],_0x329f6f=_0xf29db6<0x3?_0x4e29dc:_0x5a7125===null?_0x5a7125=Object[_0x9461f1(0x203)](_0x4e29dc,_0x12f694):_0x5a7125,_0x187b37;if(typeof Reflect===_0x9461f1(0x1f4)&&typeof Reflect[_0x9461f1(0x219)]==='function')_0x329f6f=Reflect[_0x9461f1(0x219)](_0x3f6f27,_0x4e29dc,_0x12f694,_0x5a7125);else{for(var _0x535486=_0x3f6f27['length']-0x1;_0x535486>=0x0;_0x535486--)if(_0x187b37=_0x3f6f27[_0x535486])_0x329f6f=(_0xf29db6<0x3?_0x187b37(_0x329f6f):_0xf29db6>0x3?_0x187b37(_0x4e29dc,_0x12f694,_0x329f6f):_0x187b37(_0x4e29dc,_0x12f694))||_0x329f6f;}return _0xf29db6>0x3&&_0x329f6f&&Object[_0x9461f1(0x1f8)](_0x4e29dc,_0x12f694,_0x329f6f),_0x329f6f;},__metadata=this&&this['__metadata']||function(_0x522bd9,_0x1141a5){const _0xeec4e=a120_0x3306;if(typeof Reflect===_0xeec4e(0x1f4)&&typeof Reflect['metadata']===_0xeec4e(0x1f2))return Reflect['metadata'](_0x522bd9,_0x1141a5);},__param=this&&this[a120_0x2ada8d(0x1fa)]||function(_0x1859c9,_0x46543f){return function(_0x133837,_0x2d82d3){_0x46543f(_0x133837,_0x2d82d3,_0x1859c9);};};Object[a120_0x2ada8d(0x1f8)](exports,'__esModule',{'value':!![]}),exports[a120_0x2ada8d(0x214)]=void 0x0;const common_1=require(a120_0x2ada8d(0x1e5)),setting_service_1=require(a120_0x2ada8d(0x1d7)),dto_1=require(a120_0x2ada8d(0x1e9)),roles_decorator_1=require(a120_0x2ada8d(0x206)),role_enum_1=require(a120_0x2ada8d(0x1ef)),jwt_guard_1=require('../auth/guards/jwt.guard'),roles_guard_1=require('../auth/guards/roles.guard'),setting_mapper_1=require('./mappers/setting.mapper'),child_process_1=require('child_process'),user_setting_dto_1=require(a120_0x2ada8d(0x20e));let SettingController=class SettingController{constructor(_0x157d9c){const _0x39aad4=a120_0x2ada8d;this['settingService']=_0x157d9c,this[_0x39aad4(0x1f1)]();}async[a120_0x2ada8d(0x209)](){const _0x472d5e=a120_0x2ada8d,_0x3e6b55=await this[_0x472d5e(0x1fd)][_0x472d5e(0x209)](),_0x4c0145=this[_0x472d5e(0x1fd)]['validateLicenseKey'](_0x3e6b55[_0x472d5e(0x1eb)],_0x3e6b55['schoolId']);return(0x0,setting_mapper_1[_0x472d5e(0x20c)])(_0x3e6b55,_0x4c0145[_0x472d5e(0x1e3)]);}async[a120_0x2ada8d(0x211)](){const _0x2f8a88=a120_0x2ada8d,_0x466c29=(0x0,child_process_1[_0x2f8a88(0x1ea)])('pm2\x20restart\x20startUI\x20startApi');return console[_0x2f8a88(0x216)](_0x2f8a88(0x1e6)),_0x466c29['stdout']['on'](_0x2f8a88(0x218),_0xf436ed=>{console['log'](_0xf436ed);}),_0x466c29['stdin']['on'](_0x2f8a88(0x218),_0x2c7b7c=>{console['log'](_0x2c7b7c);}),_0x466c29[_0x2f8a88(0x1db)]['on'](_0x2f8a88(0x1dc),_0x49b8bf=>{const _0x11ff9c=_0x2f8a88;console[_0x11ff9c(0x216)](_0x49b8bf);}),_0x2f8a88(0x1e6);}async[a120_0x2ada8d(0x1e1)](_0x5cf612,_0x51485b){const _0x18cc7c=a120_0x2ada8d,_0xa58a2e=this['settingService']['validateLicenseKey'](_0x51485b[_0x18cc7c(0x1eb)],_0x51485b[_0x18cc7c(0x1de)]);if(!_0xa58a2e[_0x18cc7c(0x217)])throw new common_1[(_0x18cc7c(0x1f3))]('Invalid\x20license\x20key');_0x51485b[_0x18cc7c(0x212)]=![];const _0xcb774=await this[_0x18cc7c(0x1fd)][_0x18cc7c(0x1e1)](_0x5cf612,_0x51485b);return(0x0,setting_mapper_1['mapSettingDocumentToDto'])(_0xcb774,_0xa58a2e[_0x18cc7c(0x1e3)]);}async[a120_0x2ada8d(0x21a)](_0x1461f6,_0x374ed4){const _0x33adc5=a120_0x2ada8d;_0x374ed4[_0x33adc5(0x202)]=+_0x374ed4[_0x33adc5(0x202)];if(isNaN(_0x374ed4[_0x33adc5(0x202)]))throw new common_1['BadRequestException'](_0x33adc5(0x1e0));const _0x12ad64=await this['settingService'][_0x33adc5(0x21a)](_0x374ed4);return _0x12ad64[_0x33adc5(0x1d9)];}async[a120_0x2ada8d(0x213)](){const _0x44546a=a120_0x2ada8d;await this[_0x44546a(0x1fd)][_0x44546a(0x213)]();}async['initalize'](){const _0x1082c2=a120_0x2ada8d,_0x20797c=await this[_0x1082c2(0x1fd)]['findFirst']();!_0x20797c&&await this[_0x1082c2(0x1fd)][_0x1082c2(0x1e4)]({'schoolId':'','licenseKey':'','isExpired':!![]});}};__decorate([(0x0,common_1[a120_0x2ada8d(0x1fe)])('/'),(0x0,common_1['UseGuards'])(jwt_guard_1[a120_0x2ada8d(0x21f)],roles_guard_1[a120_0x2ada8d(0x1f6)]),(0x0,roles_decorator_1[a120_0x2ada8d(0x21d)])(role_enum_1[a120_0x2ada8d(0x1df)]['Admin'],role_enum_1[a120_0x2ada8d(0x1df)][a120_0x2ada8d(0x20b)],role_enum_1['Role'][a120_0x2ada8d(0x20a)]),__metadata(a120_0x2ada8d(0x1f7),Function),__metadata(a120_0x2ada8d(0x1f5),[]),__metadata(a120_0x2ada8d(0x220),Promise)],SettingController[a120_0x2ada8d(0x21c)],a120_0x2ada8d(0x209),null),__decorate([(0x0,common_1[a120_0x2ada8d(0x1d8)])('/update'),(0x0,common_1[a120_0x2ada8d(0x1d6)])(jwt_guard_1['JwtAuthGuard'],roles_guard_1[a120_0x2ada8d(0x1f6)]),(0x0,roles_decorator_1[a120_0x2ada8d(0x21d)])(role_enum_1[a120_0x2ada8d(0x1df)][a120_0x2ada8d(0x207)],role_enum_1[a120_0x2ada8d(0x1df)][a120_0x2ada8d(0x20b)]),__metadata(a120_0x2ada8d(0x1f7),Function),__metadata(a120_0x2ada8d(0x1f5),[]),__metadata(a120_0x2ada8d(0x220),Promise)],SettingController[a120_0x2ada8d(0x21c)],a120_0x2ada8d(0x211),null),__decorate([(0x0,common_1['Patch'])(':id/license'),(0x0,common_1[a120_0x2ada8d(0x1d6)])(jwt_guard_1[a120_0x2ada8d(0x21f)],roles_guard_1[a120_0x2ada8d(0x1f6)]),(0x0,roles_decorator_1['Roles'])(role_enum_1[a120_0x2ada8d(0x1df)]['Admin'],role_enum_1[a120_0x2ada8d(0x1df)][a120_0x2ada8d(0x20b)]),__param(0x0,(0x0,common_1['Param'])('id')),__param(0x1,(0x0,common_1[a120_0x2ada8d(0x215)])()),__metadata(a120_0x2ada8d(0x1f7),Function),__metadata(a120_0x2ada8d(0x1f5),[String,dto_1[a120_0x2ada8d(0x201)]]),__metadata(a120_0x2ada8d(0x220),Promise)],SettingController['prototype'],'update',null),__decorate([(0x0,common_1[a120_0x2ada8d(0x1fb)])(a120_0x2ada8d(0x208)),(0x0,common_1[a120_0x2ada8d(0x1d6)])(jwt_guard_1[a120_0x2ada8d(0x21f)],roles_guard_1[a120_0x2ada8d(0x1f6)]),(0x0,roles_decorator_1['Roles'])(role_enum_1[a120_0x2ada8d(0x1df)][a120_0x2ada8d(0x1ec)]),__param(0x0,(0x0,common_1[a120_0x2ada8d(0x210)])('id')),__param(0x1,(0x0,common_1[a120_0x2ada8d(0x215)])()),__metadata(a120_0x2ada8d(0x1f7),Function),__metadata(a120_0x2ada8d(0x1f5),[String,user_setting_dto_1[a120_0x2ada8d(0x20d)]]),__metadata(a120_0x2ada8d(0x220),Promise)],SettingController[a120_0x2ada8d(0x21c)],a120_0x2ada8d(0x21a),null),__decorate([(0x0,common_1[a120_0x2ada8d(0x1d8)])(a120_0x2ada8d(0x1ed)),(0x0,common_1[a120_0x2ada8d(0x1d6)])(jwt_guard_1[a120_0x2ada8d(0x21f)],roles_guard_1[a120_0x2ada8d(0x1f6)]),(0x0,roles_decorator_1['Roles'])(role_enum_1[a120_0x2ada8d(0x1df)][a120_0x2ada8d(0x207)],role_enum_1[a120_0x2ada8d(0x1df)][a120_0x2ada8d(0x20b)]),__metadata(a120_0x2ada8d(0x1f7),Function),__metadata(a120_0x2ada8d(0x1f5),[]),__metadata(a120_0x2ada8d(0x220),Promise)],SettingController[a120_0x2ada8d(0x21c)],a120_0x2ada8d(0x213),null),SettingController=__decorate([(0x0,common_1[a120_0x2ada8d(0x21b)])('setting'),__metadata(a120_0x2ada8d(0x1f5),[setting_service_1[a120_0x2ada8d(0x200)]])],SettingController),exports[a120_0x2ada8d(0x214)]=SettingController;function a120_0x58b6(){const _0x3d3c77=['20aXkQDS','initalize','function','BadRequestException','object','design:paramtypes','RolesGuard','design:type','defineProperty','2167jilPvi','__param','Patch','2uosxRq','settingService','Get','27204dtrJNQ','SettingService','UpdateSettingDto','maxUser','getOwnPropertyDescriptor','409446WVynnF','386612ETcYiy','../auth/decorators/roles.decorator','Admin',':id/user-setting','findFirst','Viewer','User','mapSettingDocumentToDto','UserSettingDto','./dto/user-setting.dto','507324dKefgM','Param','updateCode','isExpired','killJobs','SettingController','Body','log','isValid','error','decorate','updateUserSetting','Controller','prototype','Roles','28CJSXrE','JwtAuthGuard','design:returntype','UseGuards','./setting.service','Post','userSetting','21URcbnt','stderr','data','59544msEWor','schoolId','Role','Max\x20user\x20must\x20be\x20a\x20number','update','20YNzcab','expiryDate','create','@nestjs/common','Success\x20request\x20update\x20app\x20to\x20latest\x20version','474920eLpTqt','length','./dto','exec','licenseKey','Master','/kill-jobs','16168412xygnRX','../auth/enums/role.enum'];a120_0x58b6=function(){return _0x3d3c77;};return a120_0x58b6();}