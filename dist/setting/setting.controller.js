'use strict';const a123_0x48446d=a123_0x2803;function a123_0x5a8f(){const _0x4c76ad=['prototype','2879811lywFsp','expiryDate','./dto','Invalid\x20license\x20key','Post','userSetting','../auth/guards/roles.guard','log','child_process','5487950ALRhjn','settingService','getOwnPropertyDescriptor','mapSettingDocumentToDto','UserSettingDto','updateCode','update','SettingService','Role','function','design:returntype','./mappers/setting.mapper','length','maxUser','5476tQQxLp','error','isExpired','design:type','../auth/guards/jwt.guard','metadata','JwtAuthGuard','killJobs','__metadata','3258455HYbcem','Admin','object','/update','./dto/user-setting.dto','stderr','SettingController','pm2\x20restart\x20startUI\x20startApi','RolesGuard','Param','1826973yetJIL','./setting.service','design:paramtypes','setting','licenseKey','2088863tJTpUl','Success\x20request\x20update\x20app\x20to\x20latest\x20version','4wQWrrC','__param','isValid','updateUserSetting','430800gfkbny','validateLicenseKey','24eXLMcx','UseGuards','defineProperty','../auth/decorators/roles.decorator','UpdateSettingDto','Get','Controller','decorate','270lgDoqE',':id/license','Roles','BadRequestException','initalize','Body','User','schoolId','findFirst'];a123_0x5a8f=function(){return _0x4c76ad;};return a123_0x5a8f();}(function(_0x36dc37,_0x11fc2c){const _0x473ffa=a123_0x2803,_0x4dc053=_0x36dc37();while(!![]){try{const _0xb89a1d=-parseInt(_0x473ffa(0xf4))/0x1*(parseInt(_0x473ffa(0xd3))/0x2)+parseInt(_0x473ffa(0xdd))/0x3+-parseInt(_0x473ffa(0xc5))/0x4*(parseInt(_0x473ffa(0xfd))/0x5)+parseInt(_0x473ffa(0xc9))/0x6+-parseInt(_0x473ffa(0xc3))/0x7+parseInt(_0x473ffa(0xcb))/0x8*(parseInt(_0x473ffa(0x107))/0x9)+parseInt(_0x473ffa(0xe6))/0xa;if(_0xb89a1d===_0x11fc2c)break;else _0x4dc053['push'](_0x4dc053['shift']());}catch(_0x5177ab){_0x4dc053['push'](_0x4dc053['shift']());}}}(a123_0x5a8f,0x7a1c3));var __decorate=this&&this['__decorate']||function(_0x4ebc05,_0x1b2b6a,_0x6b2087,_0x24da97){const _0x452122=a123_0x2803;var _0x3191a9=arguments[_0x452122(0xf2)],_0x4ed257=_0x3191a9<0x3?_0x1b2b6a:_0x24da97===null?_0x24da97=Object[_0x452122(0xe8)](_0x1b2b6a,_0x6b2087):_0x24da97,_0x4e36d0;if(typeof Reflect==='object'&&typeof Reflect[_0x452122(0xd2)]===_0x452122(0xef))_0x4ed257=Reflect[_0x452122(0xd2)](_0x4ebc05,_0x1b2b6a,_0x6b2087,_0x24da97);else{for(var _0x28c64c=_0x4ebc05['length']-0x1;_0x28c64c>=0x0;_0x28c64c--)if(_0x4e36d0=_0x4ebc05[_0x28c64c])_0x4ed257=(_0x3191a9<0x3?_0x4e36d0(_0x4ed257):_0x3191a9>0x3?_0x4e36d0(_0x1b2b6a,_0x6b2087,_0x4ed257):_0x4e36d0(_0x1b2b6a,_0x6b2087))||_0x4ed257;}return _0x3191a9>0x3&&_0x4ed257&&Object['defineProperty'](_0x1b2b6a,_0x6b2087,_0x4ed257),_0x4ed257;},__metadata=this&&this[a123_0x48446d(0xfc)]||function(_0xec0fa7,_0x818716){const _0x3eef03=a123_0x48446d;if(typeof Reflect===_0x3eef03(0xff)&&typeof Reflect[_0x3eef03(0xf9)]===_0x3eef03(0xef))return Reflect[_0x3eef03(0xf9)](_0xec0fa7,_0x818716);},__param=this&&this[a123_0x48446d(0xc6)]||function(_0x3a60b7,_0x565744){return function(_0x282c6e,_0x648c00){_0x565744(_0x282c6e,_0x648c00,_0x3a60b7);};};Object[a123_0x48446d(0xcd)](exports,'__esModule',{'value':!![]}),exports['SettingController']=void 0x0;const common_1=require('@nestjs/common'),setting_service_1=require(a123_0x48446d(0x108)),dto_1=require(a123_0x48446d(0xdf)),roles_decorator_1=require(a123_0x48446d(0xce)),role_enum_1=require('../auth/enums/role.enum'),jwt_guard_1=require(a123_0x48446d(0xf8)),roles_guard_1=require(a123_0x48446d(0xe3)),setting_mapper_1=require(a123_0x48446d(0xf1)),child_process_1=require(a123_0x48446d(0xe5)),user_setting_dto_1=require(a123_0x48446d(0x101));function a123_0x2803(_0x55d093,_0x2a0e8c){const _0x5a8f1c=a123_0x5a8f();return a123_0x2803=function(_0x280317,_0x3b358e){_0x280317=_0x280317-0xc1;let _0x3ab862=_0x5a8f1c[_0x280317];return _0x3ab862;},a123_0x2803(_0x55d093,_0x2a0e8c);}let SettingController=class SettingController{constructor(_0x23e23d){const _0x41de73=a123_0x48446d;this['settingService']=_0x23e23d,this[_0x41de73(0xd7)]();}async[a123_0x48446d(0xdb)](){const _0x55fa69=a123_0x48446d,_0x52b96c=await this[_0x55fa69(0xe7)]['findFirst'](),_0x2fa478=this[_0x55fa69(0xe7)][_0x55fa69(0xca)](_0x52b96c[_0x55fa69(0xc2)],_0x52b96c[_0x55fa69(0xda)]);return(0x0,setting_mapper_1['mapSettingDocumentToDto'])(_0x52b96c,_0x2fa478[_0x55fa69(0xde)]);}async['updateCode'](){const _0x121d14=a123_0x48446d,_0x1e056c=(0x0,child_process_1['exec'])(_0x121d14(0x104));return console[_0x121d14(0xe4)](_0x121d14(0xc4)),_0x1e056c['stdout']['on'](_0x121d14(0xf5),_0x2f9c9a=>{const _0x4a8dd0=_0x121d14;console[_0x4a8dd0(0xe4)](_0x2f9c9a);}),_0x1e056c['stdin']['on']('error',_0x39eb6e=>{console['log'](_0x39eb6e);}),_0x1e056c[_0x121d14(0x102)]['on']('data',_0x1dc70e=>{const _0x41183f=_0x121d14;console[_0x41183f(0xe4)](_0x1dc70e);}),_0x121d14(0xc4);}async[a123_0x48446d(0xec)](_0x6c9c82,_0x226a1f){const _0x27cef9=a123_0x48446d,_0x978de8=this['settingService']['validateLicenseKey'](_0x226a1f[_0x27cef9(0xc2)],_0x226a1f[_0x27cef9(0xda)]);if(!_0x978de8[_0x27cef9(0xc7)])throw new common_1[(_0x27cef9(0xd6))](_0x27cef9(0xe0));_0x226a1f[_0x27cef9(0xf6)]=![];const _0x27585e=await this[_0x27cef9(0xe7)]['update'](_0x6c9c82,_0x226a1f);return(0x0,setting_mapper_1[_0x27cef9(0xe9)])(_0x27585e,_0x978de8[_0x27cef9(0xde)]);}async[a123_0x48446d(0xc8)](_0x5aa9c5,_0x4a6514){const _0x20e94e=a123_0x48446d;_0x4a6514['maxUser']=+_0x4a6514[_0x20e94e(0xf3)];if(isNaN(_0x4a6514[_0x20e94e(0xf3)]))throw new common_1[(_0x20e94e(0xd6))]('Max\x20user\x20must\x20be\x20a\x20number');const _0x84d0e7=await this[_0x20e94e(0xe7)]['updateUserSetting'](_0x4a6514);return _0x84d0e7[_0x20e94e(0xe2)];}async['killJobs'](){const _0x864d70=a123_0x48446d;await this[_0x864d70(0xe7)][_0x864d70(0xfb)]();}async[a123_0x48446d(0xd7)](){const _0x1525db=a123_0x48446d,_0x5f2d0b=await this['settingService']['findFirst']();!_0x5f2d0b&&await this[_0x1525db(0xe7)]['create']({'schoolId':'','licenseKey':'','isExpired':!![]});}};__decorate([(0x0,common_1[a123_0x48446d(0xd0)])('/'),(0x0,common_1[a123_0x48446d(0xcc)])(jwt_guard_1[a123_0x48446d(0xfa)],roles_guard_1[a123_0x48446d(0x105)]),(0x0,roles_decorator_1[a123_0x48446d(0xd5)])(role_enum_1[a123_0x48446d(0xee)][a123_0x48446d(0xfe)],role_enum_1['Role'][a123_0x48446d(0xd9)],role_enum_1['Role']['Viewer']),__metadata(a123_0x48446d(0xf7),Function),__metadata(a123_0x48446d(0x109),[]),__metadata('design:returntype',Promise)],SettingController[a123_0x48446d(0xdc)],'findFirst',null),__decorate([(0x0,common_1[a123_0x48446d(0xe1)])(a123_0x48446d(0x100)),(0x0,common_1[a123_0x48446d(0xcc)])(jwt_guard_1['JwtAuthGuard'],roles_guard_1['RolesGuard']),(0x0,roles_decorator_1[a123_0x48446d(0xd5)])(role_enum_1[a123_0x48446d(0xee)][a123_0x48446d(0xfe)],role_enum_1['Role']['User']),__metadata(a123_0x48446d(0xf7),Function),__metadata(a123_0x48446d(0x109),[]),__metadata('design:returntype',Promise)],SettingController[a123_0x48446d(0xdc)],a123_0x48446d(0xeb),null),__decorate([(0x0,common_1['Patch'])(a123_0x48446d(0xd4)),(0x0,common_1[a123_0x48446d(0xcc)])(jwt_guard_1[a123_0x48446d(0xfa)],roles_guard_1['RolesGuard']),(0x0,roles_decorator_1['Roles'])(role_enum_1[a123_0x48446d(0xee)]['Admin'],role_enum_1[a123_0x48446d(0xee)]['User']),__param(0x0,(0x0,common_1[a123_0x48446d(0x106)])('id')),__param(0x1,(0x0,common_1[a123_0x48446d(0xd8)])()),__metadata(a123_0x48446d(0xf7),Function),__metadata(a123_0x48446d(0x109),[String,dto_1[a123_0x48446d(0xcf)]]),__metadata(a123_0x48446d(0xf0),Promise)],SettingController[a123_0x48446d(0xdc)],a123_0x48446d(0xec),null),__decorate([(0x0,common_1['Patch'])(':id/user-setting'),(0x0,common_1[a123_0x48446d(0xcc)])(jwt_guard_1['JwtAuthGuard'],roles_guard_1[a123_0x48446d(0x105)]),(0x0,roles_decorator_1[a123_0x48446d(0xd5)])(role_enum_1[a123_0x48446d(0xee)]['Master']),__param(0x0,(0x0,common_1[a123_0x48446d(0x106)])('id')),__param(0x1,(0x0,common_1[a123_0x48446d(0xd8)])()),__metadata('design:type',Function),__metadata(a123_0x48446d(0x109),[String,user_setting_dto_1[a123_0x48446d(0xea)]]),__metadata(a123_0x48446d(0xf0),Promise)],SettingController[a123_0x48446d(0xdc)],'updateUserSetting',null),__decorate([(0x0,common_1[a123_0x48446d(0xe1)])('/kill-jobs'),(0x0,common_1[a123_0x48446d(0xcc)])(jwt_guard_1[a123_0x48446d(0xfa)],roles_guard_1[a123_0x48446d(0x105)]),(0x0,roles_decorator_1[a123_0x48446d(0xd5)])(role_enum_1[a123_0x48446d(0xee)][a123_0x48446d(0xfe)],role_enum_1['Role']['User']),__metadata(a123_0x48446d(0xf7),Function),__metadata(a123_0x48446d(0x109),[]),__metadata('design:returntype',Promise)],SettingController[a123_0x48446d(0xdc)],a123_0x48446d(0xfb),null),SettingController=__decorate([(0x0,common_1[a123_0x48446d(0xd1)])(a123_0x48446d(0xc1)),__metadata(a123_0x48446d(0x109),[setting_service_1[a123_0x48446d(0xed)]])],SettingController),exports[a123_0x48446d(0x103)]=SettingController;