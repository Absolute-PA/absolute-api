'use strict';const a120_0x37d0d4=a120_0x15f5;(function(_0x135404,_0x5ad65f){const _0xef563d=a120_0x15f5,_0x5502d2=_0x135404();while(!![]){try{const _0x447ff3=-parseInt(_0xef563d(0x7a))/0x1+parseInt(_0xef563d(0x8b))/0x2*(-parseInt(_0xef563d(0x6d))/0x3)+parseInt(_0xef563d(0x73))/0x4+parseInt(_0xef563d(0xaa))/0x5*(parseInt(_0xef563d(0x8e))/0x6)+-parseInt(_0xef563d(0x89))/0x7+-parseInt(_0xef563d(0x71))/0x8*(parseInt(_0xef563d(0x76))/0x9)+parseInt(_0xef563d(0x6f))/0xa;if(_0x447ff3===_0x5ad65f)break;else _0x5502d2['push'](_0x5502d2['shift']());}catch(_0x7bd860){_0x5502d2['push'](_0x5502d2['shift']());}}}(a120_0xbd63,0xe50c6));var __decorate=this&&this[a120_0x37d0d4(0x9a)]||function(_0x199d7c,_0x5c30cc,_0x54b0c1,_0x155da5){const _0x5eda75=a120_0x37d0d4;var _0x44a097=arguments[_0x5eda75(0xa5)],_0x317913=_0x44a097<0x3?_0x5c30cc:_0x155da5===null?_0x155da5=Object[_0x5eda75(0xa4)](_0x5c30cc,_0x54b0c1):_0x155da5,_0x853c06;if(typeof Reflect===_0x5eda75(0x94)&&typeof Reflect[_0x5eda75(0x9d)]===_0x5eda75(0xa3))_0x317913=Reflect['decorate'](_0x199d7c,_0x5c30cc,_0x54b0c1,_0x155da5);else{for(var _0x4d644d=_0x199d7c['length']-0x1;_0x4d644d>=0x0;_0x4d644d--)if(_0x853c06=_0x199d7c[_0x4d644d])_0x317913=(_0x44a097<0x3?_0x853c06(_0x317913):_0x44a097>0x3?_0x853c06(_0x5c30cc,_0x54b0c1,_0x317913):_0x853c06(_0x5c30cc,_0x54b0c1))||_0x317913;}return _0x44a097>0x3&&_0x317913&&Object[_0x5eda75(0x86)](_0x5c30cc,_0x54b0c1,_0x317913),_0x317913;},__metadata=this&&this[a120_0x37d0d4(0x8a)]||function(_0x59487e,_0x169fa6){const _0x5144cf=a120_0x37d0d4;if(typeof Reflect==='object'&&typeof Reflect[_0x5144cf(0x75)]===_0x5144cf(0xa3))return Reflect[_0x5144cf(0x75)](_0x59487e,_0x169fa6);},__param=this&&this[a120_0x37d0d4(0x6c)]||function(_0x553f19,_0xea5824){return function(_0x2a2489,_0x157774){_0xea5824(_0x2a2489,_0x157774,_0x553f19);};};Object[a120_0x37d0d4(0x86)](exports,a120_0x37d0d4(0x99),{'value':!![]}),exports['SettingController']=void 0x0;function a120_0xbd63(){const _0x210214=['schoolId','121896HdLFZc','User','829800QJPvXF','UserSettingDto','metadata','369YGlkJl','../auth/guards/jwt.guard','settingService','/update','1779406cyHtgF','validateLicenseKey','Body','log','Get',':id/license','SettingController','design:paramtypes','Master','maxUser','Roles','Patch','defineProperty','design:returntype','prototype','4125947SaapOB','__metadata','7034djHfwH','@nestjs/common','initalize','292038zWggbE','stdin','mapSettingDocumentToDto','killJobs','error','data','object','JwtAuthGuard','Invalid\x20license\x20key','userSetting','UseGuards','__esModule','__decorate','stderr','SettingService','decorate','findFirst','Role','../auth/guards/roles.guard','Param','./dto','function','getOwnPropertyDescriptor','length','child_process','updateCode','BadRequestException','design:type','115aKYNeJ','Post','UpdateSettingDto','updateUserSetting','isExpired','isValid','Controller','update','RolesGuard','Max\x20user\x20must\x20be\x20a\x20number','Viewer','__param','309rISirF','Admin','29670480XvjwSY'];a120_0xbd63=function(){return _0x210214;};return a120_0xbd63();}const common_1=require(a120_0x37d0d4(0x8c)),setting_service_1=require('./setting.service'),dto_1=require(a120_0x37d0d4(0xa2)),roles_decorator_1=require('../auth/decorators/roles.decorator'),role_enum_1=require('../auth/enums/role.enum'),jwt_guard_1=require(a120_0x37d0d4(0x77)),roles_guard_1=require(a120_0x37d0d4(0xa0)),setting_mapper_1=require('./mappers/setting.mapper'),child_process_1=require(a120_0x37d0d4(0xa6)),user_setting_dto_1=require('./dto/user-setting.dto');function a120_0x15f5(_0x4c32a9,_0x302cef){const _0xbd6359=a120_0xbd63();return a120_0x15f5=function(_0x15f53f,_0x149f63){_0x15f53f=_0x15f53f-0x64;let _0x4ada2c=_0xbd6359[_0x15f53f];return _0x4ada2c;},a120_0x15f5(_0x4c32a9,_0x302cef);}let SettingController=class SettingController{constructor(_0x1cec2f){const _0x8f44de=a120_0x37d0d4;this[_0x8f44de(0x78)]=_0x1cec2f,this[_0x8f44de(0x8d)]();}async[a120_0x37d0d4(0x9e)](){const _0x15d1c8=a120_0x37d0d4,_0x2668d5=await this['settingService']['findFirst'](),_0xf817e2=this['settingService'][_0x15d1c8(0x7b)](_0x2668d5['licenseKey'],_0x2668d5[_0x15d1c8(0x70)]);return(0x0,setting_mapper_1[_0x15d1c8(0x90)])(_0x2668d5,_0xf817e2['expiryDate']);}async[a120_0x37d0d4(0xa7)](){const _0x36a15e=a120_0x37d0d4,_0x21c33d=(0x0,child_process_1['exec'])('pm2\x20restart\x20startUI\x20startApi');return console[_0x36a15e(0x7d)]('Success\x20request\x20update\x20app\x20to\x20latest\x20version'),_0x21c33d['stdout']['on'](_0x36a15e(0x92),_0x24d162=>{const _0x48459f=_0x36a15e;console[_0x48459f(0x7d)](_0x24d162);}),_0x21c33d[_0x36a15e(0x8f)]['on'](_0x36a15e(0x92),_0x3ad829=>{const _0x22b470=_0x36a15e;console[_0x22b470(0x7d)](_0x3ad829);}),_0x21c33d[_0x36a15e(0x9b)]['on'](_0x36a15e(0x93),_0x396d77=>{const _0x17a796=_0x36a15e;console[_0x17a796(0x7d)](_0x396d77);}),'Success\x20request\x20update\x20app\x20to\x20latest\x20version';}async[a120_0x37d0d4(0x68)](_0x4c397d,_0x52ddea){const _0x1b4d5c=a120_0x37d0d4,_0x4b97db=this[_0x1b4d5c(0x78)]['validateLicenseKey'](_0x52ddea['licenseKey'],_0x52ddea[_0x1b4d5c(0x70)]);if(!_0x4b97db[_0x1b4d5c(0x66)])throw new common_1[(_0x1b4d5c(0xa8))](_0x1b4d5c(0x96));_0x52ddea[_0x1b4d5c(0x65)]=![];const _0x4bff10=await this['settingService'][_0x1b4d5c(0x68)](_0x4c397d,_0x52ddea);return(0x0,setting_mapper_1['mapSettingDocumentToDto'])(_0x4bff10,_0x4b97db['expiryDate']);}async['updateUserSetting'](_0x70976a,_0x28fbfa){const _0x103c90=a120_0x37d0d4;_0x28fbfa[_0x103c90(0x83)]=+_0x28fbfa[_0x103c90(0x83)];if(isNaN(_0x28fbfa[_0x103c90(0x83)]))throw new common_1['BadRequestException'](_0x103c90(0x6a));const _0x42df6f=await this[_0x103c90(0x78)]['updateUserSetting'](_0x28fbfa);return _0x42df6f[_0x103c90(0x97)];}async['killJobs'](){const _0x117827=a120_0x37d0d4;await this[_0x117827(0x78)][_0x117827(0x91)]();}async[a120_0x37d0d4(0x8d)](){const _0x1e3c16=a120_0x37d0d4,_0x4cd73f=await this['settingService']['findFirst']();!_0x4cd73f&&await this[_0x1e3c16(0x78)]['create']({'schoolId':'','licenseKey':'','isExpired':!![]});}};__decorate([(0x0,common_1[a120_0x37d0d4(0x7e)])('/'),(0x0,common_1[a120_0x37d0d4(0x98)])(jwt_guard_1[a120_0x37d0d4(0x95)],roles_guard_1[a120_0x37d0d4(0x69)]),(0x0,roles_decorator_1[a120_0x37d0d4(0x84)])(role_enum_1[a120_0x37d0d4(0x9f)]['Admin'],role_enum_1['Role'][a120_0x37d0d4(0x72)],role_enum_1[a120_0x37d0d4(0x9f)][a120_0x37d0d4(0x6b)]),__metadata(a120_0x37d0d4(0xa9),Function),__metadata('design:paramtypes',[]),__metadata(a120_0x37d0d4(0x87),Promise)],SettingController['prototype'],a120_0x37d0d4(0x9e),null),__decorate([(0x0,common_1[a120_0x37d0d4(0xab)])(a120_0x37d0d4(0x79)),(0x0,common_1[a120_0x37d0d4(0x98)])(jwt_guard_1[a120_0x37d0d4(0x95)],roles_guard_1['RolesGuard']),(0x0,roles_decorator_1['Roles'])(role_enum_1[a120_0x37d0d4(0x9f)][a120_0x37d0d4(0x6e)],role_enum_1['Role'][a120_0x37d0d4(0x72)]),__metadata(a120_0x37d0d4(0xa9),Function),__metadata(a120_0x37d0d4(0x81),[]),__metadata('design:returntype',Promise)],SettingController['prototype'],'updateCode',null),__decorate([(0x0,common_1[a120_0x37d0d4(0x85)])(a120_0x37d0d4(0x7f)),(0x0,common_1['UseGuards'])(jwt_guard_1[a120_0x37d0d4(0x95)],roles_guard_1[a120_0x37d0d4(0x69)]),(0x0,roles_decorator_1[a120_0x37d0d4(0x84)])(role_enum_1[a120_0x37d0d4(0x9f)][a120_0x37d0d4(0x6e)],role_enum_1[a120_0x37d0d4(0x9f)]['User']),__param(0x0,(0x0,common_1[a120_0x37d0d4(0xa1)])('id')),__param(0x1,(0x0,common_1[a120_0x37d0d4(0x7c)])()),__metadata(a120_0x37d0d4(0xa9),Function),__metadata(a120_0x37d0d4(0x81),[String,dto_1[a120_0x37d0d4(0xac)]]),__metadata(a120_0x37d0d4(0x87),Promise)],SettingController[a120_0x37d0d4(0x88)],a120_0x37d0d4(0x68),null),__decorate([(0x0,common_1['Patch'])(':id/user-setting'),(0x0,common_1['UseGuards'])(jwt_guard_1[a120_0x37d0d4(0x95)],roles_guard_1['RolesGuard']),(0x0,roles_decorator_1[a120_0x37d0d4(0x84)])(role_enum_1[a120_0x37d0d4(0x9f)][a120_0x37d0d4(0x82)]),__param(0x0,(0x0,common_1[a120_0x37d0d4(0xa1)])('id')),__param(0x1,(0x0,common_1[a120_0x37d0d4(0x7c)])()),__metadata(a120_0x37d0d4(0xa9),Function),__metadata(a120_0x37d0d4(0x81),[String,user_setting_dto_1[a120_0x37d0d4(0x74)]]),__metadata(a120_0x37d0d4(0x87),Promise)],SettingController[a120_0x37d0d4(0x88)],a120_0x37d0d4(0x64),null),__decorate([(0x0,common_1['Post'])('/kill-jobs'),(0x0,common_1['UseGuards'])(jwt_guard_1[a120_0x37d0d4(0x95)],roles_guard_1['RolesGuard']),(0x0,roles_decorator_1[a120_0x37d0d4(0x84)])(role_enum_1[a120_0x37d0d4(0x9f)][a120_0x37d0d4(0x6e)],role_enum_1[a120_0x37d0d4(0x9f)][a120_0x37d0d4(0x72)]),__metadata(a120_0x37d0d4(0xa9),Function),__metadata(a120_0x37d0d4(0x81),[]),__metadata(a120_0x37d0d4(0x87),Promise)],SettingController[a120_0x37d0d4(0x88)],a120_0x37d0d4(0x91),null),SettingController=__decorate([(0x0,common_1[a120_0x37d0d4(0x67)])('setting'),__metadata('design:paramtypes',[setting_service_1[a120_0x37d0d4(0x9c)]])],SettingController),exports[a120_0x37d0d4(0x80)]=SettingController;