'use strict';const a123_0x82660e=a123_0x3196;(function(_0x353f28,_0x4d0a77){const _0x99367c=a123_0x3196,_0x2f2990=_0x353f28();while(!![]){try{const _0x4b3d8e=-parseInt(_0x99367c(0x1f0))/0x1*(parseInt(_0x99367c(0x211))/0x2)+parseInt(_0x99367c(0x1df))/0x3+-parseInt(_0x99367c(0x1ec))/0x4+parseInt(_0x99367c(0x1e6))/0x5+parseInt(_0x99367c(0x1f7))/0x6+parseInt(_0x99367c(0x20d))/0x7+-parseInt(_0x99367c(0x1d0))/0x8*(parseInt(_0x99367c(0x1d7))/0x9);if(_0x4b3d8e===_0x4d0a77)break;else _0x2f2990['push'](_0x2f2990['shift']());}catch(_0x45e18d){_0x2f2990['push'](_0x2f2990['shift']());}}}(a123_0x153e,0x7db44));function a123_0x3196(_0x12f81d,_0x51ace8){const _0x153e3c=a123_0x153e();return a123_0x3196=function(_0x3196f6,_0x1b5f4e){_0x3196f6=_0x3196f6-0x1ca;let _0x17a71c=_0x153e3c[_0x3196f6];return _0x17a71c;},a123_0x3196(_0x12f81d,_0x51ace8);}function a123_0x153e(){const _0x464db2=['JwtAuthGuard','Invalid\x20license\x20key','/update','2819dTnEtt','User','function','../auth/decorators/roles.decorator','design:returntype','./setting.service','updateUserSetting','2138400ZHsOiZ','design:paramtypes',':id/user-setting','Body','__decorate','expiryDate','Success\x20request\x20update\x20app\x20to\x20latest\x20version','SettingController','Roles','../auth/guards/roles.guard','Param','decorate','length','killJobs','Get','maxUser','@nestjs/common','__metadata','stdin','initalize','UseGuards','Max\x20user\x20must\x20be\x20a\x20number','2647141CSKStj','Viewer','design:type','Post','412JRcGsI','SettingService','schoolId','./dto/user-setting.dto','UserSettingDto','UpdateSettingDto','BadRequestException','mapSettingDocumentToDto',':id/license','Admin','1826504oNAXMa','./dto','isValid','object','findFirst','Patch','__param','27ghygTl','setting','data','stderr','licenseKey','defineProperty','updateCode','Role','2747763hmLZnm','Master','settingService','update','../auth/guards/jwt.guard','log','stdout','2048010WUHLZP','metadata','RolesGuard','prototype','exec','error','1118196rrTZqU'];a123_0x153e=function(){return _0x464db2;};return a123_0x153e();}var __decorate=this&&this[a123_0x82660e(0x1fb)]||function(_0x532471,_0x112514,_0x3a7d9d,_0x2ac5cb){const _0x2facfa=a123_0x82660e;var _0x1a5899=arguments[_0x2facfa(0x203)],_0x438fcf=_0x1a5899<0x3?_0x112514:_0x2ac5cb===null?_0x2ac5cb=Object['getOwnPropertyDescriptor'](_0x112514,_0x3a7d9d):_0x2ac5cb,_0x4ac297;if(typeof Reflect===_0x2facfa(0x1d3)&&typeof Reflect[_0x2facfa(0x202)]==='function')_0x438fcf=Reflect[_0x2facfa(0x202)](_0x532471,_0x112514,_0x3a7d9d,_0x2ac5cb);else{for(var _0x18a0ab=_0x532471['length']-0x1;_0x18a0ab>=0x0;_0x18a0ab--)if(_0x4ac297=_0x532471[_0x18a0ab])_0x438fcf=(_0x1a5899<0x3?_0x4ac297(_0x438fcf):_0x1a5899>0x3?_0x4ac297(_0x112514,_0x3a7d9d,_0x438fcf):_0x4ac297(_0x112514,_0x3a7d9d))||_0x438fcf;}return _0x1a5899>0x3&&_0x438fcf&&Object['defineProperty'](_0x112514,_0x3a7d9d,_0x438fcf),_0x438fcf;},__metadata=this&&this[a123_0x82660e(0x208)]||function(_0x35ba1f,_0x2218fb){const _0x499af6=a123_0x82660e;if(typeof Reflect===_0x499af6(0x1d3)&&typeof Reflect[_0x499af6(0x1e7)]===_0x499af6(0x1f2))return Reflect[_0x499af6(0x1e7)](_0x35ba1f,_0x2218fb);},__param=this&&this[a123_0x82660e(0x1d6)]||function(_0x1ba3ca,_0x3d933b){return function(_0x350fa3,_0x1288ae){_0x3d933b(_0x350fa3,_0x1288ae,_0x1ba3ca);};};Object[a123_0x82660e(0x1dc)](exports,'__esModule',{'value':!![]}),exports[a123_0x82660e(0x1fe)]=void 0x0;const common_1=require(a123_0x82660e(0x207)),setting_service_1=require(a123_0x82660e(0x1f5)),dto_1=require(a123_0x82660e(0x1d1)),roles_decorator_1=require(a123_0x82660e(0x1f3)),role_enum_1=require('../auth/enums/role.enum'),jwt_guard_1=require(a123_0x82660e(0x1e3)),roles_guard_1=require(a123_0x82660e(0x200)),setting_mapper_1=require('./mappers/setting.mapper'),child_process_1=require('child_process'),user_setting_dto_1=require(a123_0x82660e(0x214));let SettingController=class SettingController{constructor(_0x2e45a0){const _0x179cb4=a123_0x82660e;this[_0x179cb4(0x1e1)]=_0x2e45a0,this[_0x179cb4(0x20a)]();}async[a123_0x82660e(0x1d4)](){const _0x553a11=a123_0x82660e,_0x156546=await this[_0x553a11(0x1e1)]['findFirst'](),_0xc21af0=this['settingService']['validateLicenseKey'](_0x156546[_0x553a11(0x1db)],_0x156546[_0x553a11(0x213)]);return(0x0,setting_mapper_1['mapSettingDocumentToDto'])(_0x156546,_0xc21af0[_0x553a11(0x1fc)]);}async[a123_0x82660e(0x1dd)](){const _0x5ef249=a123_0x82660e,_0x135d53=(0x0,child_process_1[_0x5ef249(0x1ea)])('pm2\x20restart\x20startUI\x20startApi');return console['log'](_0x5ef249(0x1fd)),_0x135d53[_0x5ef249(0x1e5)]['on'](_0x5ef249(0x1eb),_0x210832=>{const _0x2a5c17=_0x5ef249;console[_0x2a5c17(0x1e4)](_0x210832);}),_0x135d53[_0x5ef249(0x209)]['on']('error',_0x427ad7=>{console['log'](_0x427ad7);}),_0x135d53[_0x5ef249(0x1da)]['on'](_0x5ef249(0x1d9),_0x4d667f=>{console['log'](_0x4d667f);}),_0x5ef249(0x1fd);}async['update'](_0x221503,_0x1dbf0f){const _0x5c5649=a123_0x82660e,_0x402d27=this[_0x5c5649(0x1e1)]['validateLicenseKey'](_0x1dbf0f[_0x5c5649(0x1db)],_0x1dbf0f['schoolId']);if(!_0x402d27[_0x5c5649(0x1d2)])throw new common_1[(_0x5c5649(0x1cc))](_0x5c5649(0x1ee));_0x1dbf0f['isExpired']=![];const _0xd5e504=await this['settingService']['update'](_0x221503,_0x1dbf0f);return(0x0,setting_mapper_1[_0x5c5649(0x1cd)])(_0xd5e504,_0x402d27['expiryDate']);}async[a123_0x82660e(0x1f6)](_0x10b941,_0x357fd6){const _0x4d6125=a123_0x82660e;_0x357fd6[_0x4d6125(0x206)]=+_0x357fd6[_0x4d6125(0x206)];if(isNaN(_0x357fd6[_0x4d6125(0x206)]))throw new common_1[(_0x4d6125(0x1cc))](_0x4d6125(0x20c));const _0x165c3b=await this[_0x4d6125(0x1e1)]['updateUserSetting'](_0x357fd6);return _0x165c3b['userSetting'];}async['killJobs'](){const _0x1dcc13=a123_0x82660e;await this[_0x1dcc13(0x1e1)][_0x1dcc13(0x204)]();}async[a123_0x82660e(0x20a)](){const _0x29b6c4=a123_0x82660e,_0x134b5c=await this['settingService'][_0x29b6c4(0x1d4)]();!_0x134b5c&&await this['settingService']['create']({'schoolId':'','licenseKey':'','isExpired':!![]});}};__decorate([(0x0,common_1[a123_0x82660e(0x205)])('/'),(0x0,common_1[a123_0x82660e(0x20b)])(jwt_guard_1[a123_0x82660e(0x1ed)],roles_guard_1['RolesGuard']),(0x0,roles_decorator_1[a123_0x82660e(0x1ff)])(role_enum_1['Role'][a123_0x82660e(0x1cf)],role_enum_1['Role'][a123_0x82660e(0x1f1)],role_enum_1['Role'][a123_0x82660e(0x20e)]),__metadata(a123_0x82660e(0x20f),Function),__metadata('design:paramtypes',[]),__metadata(a123_0x82660e(0x1f4),Promise)],SettingController[a123_0x82660e(0x1e9)],'findFirst',null),__decorate([(0x0,common_1[a123_0x82660e(0x210)])(a123_0x82660e(0x1ef)),(0x0,common_1[a123_0x82660e(0x20b)])(jwt_guard_1[a123_0x82660e(0x1ed)],roles_guard_1['RolesGuard']),(0x0,roles_decorator_1[a123_0x82660e(0x1ff)])(role_enum_1['Role'][a123_0x82660e(0x1cf)],role_enum_1[a123_0x82660e(0x1de)][a123_0x82660e(0x1f1)]),__metadata(a123_0x82660e(0x20f),Function),__metadata(a123_0x82660e(0x1f8),[]),__metadata('design:returntype',Promise)],SettingController['prototype'],a123_0x82660e(0x1dd),null),__decorate([(0x0,common_1[a123_0x82660e(0x1d5)])(a123_0x82660e(0x1ce)),(0x0,common_1[a123_0x82660e(0x20b)])(jwt_guard_1[a123_0x82660e(0x1ed)],roles_guard_1[a123_0x82660e(0x1e8)]),(0x0,roles_decorator_1[a123_0x82660e(0x1ff)])(role_enum_1[a123_0x82660e(0x1de)]['Admin'],role_enum_1[a123_0x82660e(0x1de)][a123_0x82660e(0x1f1)]),__param(0x0,(0x0,common_1[a123_0x82660e(0x201)])('id')),__param(0x1,(0x0,common_1[a123_0x82660e(0x1fa)])()),__metadata(a123_0x82660e(0x20f),Function),__metadata(a123_0x82660e(0x1f8),[String,dto_1[a123_0x82660e(0x1cb)]]),__metadata(a123_0x82660e(0x1f4),Promise)],SettingController[a123_0x82660e(0x1e9)],a123_0x82660e(0x1e2),null),__decorate([(0x0,common_1['Patch'])(a123_0x82660e(0x1f9)),(0x0,common_1[a123_0x82660e(0x20b)])(jwt_guard_1['JwtAuthGuard'],roles_guard_1[a123_0x82660e(0x1e8)]),(0x0,roles_decorator_1['Roles'])(role_enum_1[a123_0x82660e(0x1de)][a123_0x82660e(0x1e0)]),__param(0x0,(0x0,common_1[a123_0x82660e(0x201)])('id')),__param(0x1,(0x0,common_1[a123_0x82660e(0x1fa)])()),__metadata(a123_0x82660e(0x20f),Function),__metadata(a123_0x82660e(0x1f8),[String,user_setting_dto_1[a123_0x82660e(0x1ca)]]),__metadata(a123_0x82660e(0x1f4),Promise)],SettingController[a123_0x82660e(0x1e9)],a123_0x82660e(0x1f6),null),__decorate([(0x0,common_1[a123_0x82660e(0x210)])('/kill-jobs'),(0x0,common_1[a123_0x82660e(0x20b)])(jwt_guard_1[a123_0x82660e(0x1ed)],roles_guard_1[a123_0x82660e(0x1e8)]),(0x0,roles_decorator_1[a123_0x82660e(0x1ff)])(role_enum_1['Role']['Admin'],role_enum_1[a123_0x82660e(0x1de)][a123_0x82660e(0x1f1)]),__metadata('design:type',Function),__metadata(a123_0x82660e(0x1f8),[]),__metadata('design:returntype',Promise)],SettingController[a123_0x82660e(0x1e9)],a123_0x82660e(0x204),null),SettingController=__decorate([(0x0,common_1['Controller'])(a123_0x82660e(0x1d8)),__metadata('design:paramtypes',[setting_service_1[a123_0x82660e(0x212)]])],SettingController),exports[a123_0x82660e(0x1fe)]=SettingController;