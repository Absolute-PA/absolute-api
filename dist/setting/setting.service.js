'use strict';const a125_0x4e1d5f=a125_0x3bdc;(function(_0x53cb0f,_0x55bba4){const _0x3085e3=a125_0x3bdc,_0x25aae2=_0x53cb0f();while(!![]){try{const _0x1cb1bf=parseInt(_0x3085e3(0x135))/0x1+-parseInt(_0x3085e3(0x136))/0x2+-parseInt(_0x3085e3(0x140))/0x3+-parseInt(_0x3085e3(0x158))/0x4+-parseInt(_0x3085e3(0x155))/0x5+-parseInt(_0x3085e3(0x131))/0x6*(parseInt(_0x3085e3(0x14e))/0x7)+-parseInt(_0x3085e3(0x13e))/0x8*(-parseInt(_0x3085e3(0x133))/0x9);if(_0x1cb1bf===_0x55bba4)break;else _0x25aae2['push'](_0x25aae2['shift']());}catch(_0x477575){_0x25aae2['push'](_0x25aae2['shift']());}}}(a125_0x5852,0x938ea));var __decorate=this&&this[a125_0x4e1d5f(0x12e)]||function(_0x5e62ff,_0x355b0f,_0x3b7410,_0x5e5b86){const _0x2cf1c8=a125_0x4e1d5f;var _0x5c9ad3=arguments[_0x2cf1c8(0x157)],_0xbbd3a4=_0x5c9ad3<0x3?_0x355b0f:_0x5e5b86===null?_0x5e5b86=Object['getOwnPropertyDescriptor'](_0x355b0f,_0x3b7410):_0x5e5b86,_0x51d53f;if(typeof Reflect===_0x2cf1c8(0x13d)&&typeof Reflect[_0x2cf1c8(0x14d)]===_0x2cf1c8(0x148))_0xbbd3a4=Reflect[_0x2cf1c8(0x14d)](_0x5e62ff,_0x355b0f,_0x3b7410,_0x5e5b86);else{for(var _0x434095=_0x5e62ff[_0x2cf1c8(0x157)]-0x1;_0x434095>=0x0;_0x434095--)if(_0x51d53f=_0x5e62ff[_0x434095])_0xbbd3a4=(_0x5c9ad3<0x3?_0x51d53f(_0xbbd3a4):_0x5c9ad3>0x3?_0x51d53f(_0x355b0f,_0x3b7410,_0xbbd3a4):_0x51d53f(_0x355b0f,_0x3b7410))||_0xbbd3a4;}return _0x5c9ad3>0x3&&_0xbbd3a4&&Object['defineProperty'](_0x355b0f,_0x3b7410,_0xbbd3a4),_0xbbd3a4;},__metadata=this&&this[a125_0x4e1d5f(0x14f)]||function(_0x559dd1,_0x3593bb){const _0x39ce13=a125_0x4e1d5f;if(typeof Reflect===_0x39ce13(0x13d)&&typeof Reflect[_0x39ce13(0x139)]==='function')return Reflect[_0x39ce13(0x139)](_0x559dd1,_0x3593bb);},__param=this&&this[a125_0x4e1d5f(0x129)]||function(_0x39d24a,_0xf08487){return function(_0x483588,_0x5d1d53){_0xf08487(_0x483588,_0x5d1d53,_0x39d24a);};};function a125_0x5852(){const _0x4f6587=['DD/MM/YYYY','updateUserSetting','killAll','setting','decorate','24633wjtWjY','__metadata','SettingService','maxUser','create','Base64','killJobs','200235mDjbhm','licenseKey','length','3788264VCoxay','crypto-js','Utf8','enc','findByIdAndUpdate','validTo','DEFAULT_MAX_USER','__param','save','settingModel','validateLicenseKey','dayjs','__decorate','updateExpiryStatus','mongoose','1332qCafoG','userSetting','13074858MKQeEb','toDate','1050545xuRGPX','128200XoKUau','Setting','findFirst','metadata','assign','design:paramtypes','find','object','8VxuAmn','defineProperty','199446YuHRzy','__esModule','update','_id','exec','parse','PROCESS_CACHE','./constants','function'];a125_0x5852=function(){return _0x4f6587;};return a125_0x5852();}Object[a125_0x4e1d5f(0x13f)](exports,a125_0x4e1d5f(0x141),{'value':!![]}),exports[a125_0x4e1d5f(0x150)]=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require(a125_0x4e1d5f(0x130)),CryptoJS=require(a125_0x4e1d5f(0x159)),dayjs=require(a125_0x4e1d5f(0x12d)),crypto_1=require('../common/crypto'),job_1=require('../common/job'),constants_1=require(a125_0x4e1d5f(0x147)),SECRET='QVBFVFVMT1NCQQ==';let SettingService=class SettingService{constructor(_0x52f3d4){const _0x1b5229=a125_0x4e1d5f;this[_0x1b5229(0x12b)]=_0x52f3d4;}async[a125_0x4e1d5f(0x152)](_0x18318a){const _0x257faf=a125_0x4e1d5f,_0x254b7b=new this[(_0x257faf(0x12b))](_0x18318a);return _0x254b7b[_0x257faf(0x12a)]();}async['findFirst'](){const _0x1339cb=a125_0x4e1d5f;var _0xca04cc,_0x2de1be,_0x52b0cc;const _0x4c34d7=await this[_0x1339cb(0x12b)][_0x1339cb(0x13c)]()[_0x1339cb(0x144)](),_0x5f5cb3=(_0xca04cc=_0x4c34d7[0x0])===null||_0xca04cc===void 0x0?void 0x0:_0xca04cc['toObject']();if(!_0x5f5cb3)return;return Object[_0x1339cb(0x13a)](Object['assign']({},_0x5f5cb3),{'userSetting':Object[_0x1339cb(0x13a)](Object[_0x1339cb(0x13a)]({},_0x5f5cb3[_0x1339cb(0x132)]),{'maxUser':(_0x52b0cc=(_0x2de1be=_0x5f5cb3[_0x1339cb(0x132)])===null||_0x2de1be===void 0x0?void 0x0:_0x2de1be[_0x1339cb(0x151)])!==null&&_0x52b0cc!==void 0x0?_0x52b0cc:constants_1[_0x1339cb(0x128)]})});}async[a125_0x4e1d5f(0x142)](_0x1f5d7e,_0x1639de){const _0x2ff01d=a125_0x4e1d5f,_0x90499b=await this[_0x2ff01d(0x12b)][_0x2ff01d(0x126)](_0x1f5d7e,Object[_0x2ff01d(0x13a)](Object[_0x2ff01d(0x13a)]({},_0x1639de),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x2ff01d(0x144)]();return _0x90499b;}async[a125_0x4e1d5f(0x12f)](){const _0x593eec=a125_0x4e1d5f,_0x7f340a=await this[_0x593eec(0x138)](),_0x404520=this['validateLicenseKey'](_0x7f340a[_0x593eec(0x156)],_0x7f340a['schoolId']);return this[_0x593eec(0x142)](_0x7f340a[_0x593eec(0x143)],{'isExpired':!_0x404520['isValid']});}async[a125_0x4e1d5f(0x14a)](_0x247ecf){const _0x25a369=a125_0x4e1d5f,_0x14e433=await this['findFirst']();return console['log'](_0x14e433,_0x25a369(0x14c)),this[_0x25a369(0x142)](_0x14e433[_0x25a369(0x143)],{'userSetting':_0x247ecf});}[a125_0x4e1d5f(0x12c)](_0x3b66d0,_0x3328a8){const _0xc2d936=a125_0x4e1d5f;try{if(!_0x3b66d0)return{'isValid':![],'expiryDate':''};const _0x382ec5=(0x0,crypto_1['decrypt'])(_0x3b66d0,CryptoJS['enc'][_0xc2d936(0x153)][_0xc2d936(0x145)](SECRET)['toString'](CryptoJS[_0xc2d936(0x125)][_0xc2d936(0x15a)]));if(_0x382ec5['schoolId']!==_0x3328a8)return{'isValid':![],'expiryDate':''};const _0xd7df57=dayjs(_0x382ec5['validFrom'],_0xc2d936(0x149))[_0xc2d936(0x134)](),_0x38e71d=dayjs(_0x382ec5[_0xc2d936(0x127)],_0xc2d936(0x149))['toDate'](),_0x345df9=dayjs()[_0xc2d936(0x134)]();if(_0x345df9<_0xd7df57||_0x345df9>_0x38e71d)return{'isValid':![],'expiryDate':_0x382ec5[_0xc2d936(0x127)]};return{'isValid':!![],'expiryDate':_0x382ec5['validTo']};}catch(_0x4b330d){return{'isValid':![],'expiryDate':''};}}async[a125_0x4e1d5f(0x154)](){const _0xfee105=a125_0x4e1d5f;job_1[_0xfee105(0x146)][_0xfee105(0x14b)]();}};function a125_0x3bdc(_0x175a30,_0x4b8194){const _0x5852bd=a125_0x5852();return a125_0x3bdc=function(_0x3bdc6e,_0x16989d){_0x3bdc6e=_0x3bdc6e-0x125;let _0x752a44=_0x5852bd[_0x3bdc6e];return _0x752a44;},a125_0x3bdc(_0x175a30,_0x4b8194);}SettingService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_1['InjectModel'])(a125_0x4e1d5f(0x137))),__metadata(a125_0x4e1d5f(0x13b),[mongoose_2['Model']])],SettingService),exports[a125_0x4e1d5f(0x150)]=SettingService;