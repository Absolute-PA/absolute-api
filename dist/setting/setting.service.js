'use strict';const a125_0x274b78=a125_0xce36;function a125_0x9dd4(){const _0x44580f=['@nestjs/mongoose','QVBFVFVMT1NCQQ==','killAll','__param','save','updateExpiryStatus','length','licenseKey','validateLicenseKey','function','enc','toDate','schoolId','Base64','200672qQaoCg','create','exec','1669090LPyIWC','assign','killJobs','metadata','dayjs','87TYkzTp','_id','isValid','mongoose','7911774MWCXbZ','./constants','setting','131264QtRnEv','validFrom','DEFAULT_MAX_USER','158188BwFrKi','SettingService','InjectModel','toObject','findFirst','crypto-js','update','getOwnPropertyDescriptor','userSetting','Setting','settingModel','findByIdAndUpdate','validTo','14kcmdnn','__decorate','parse','1wkvIvI','toString','DD/MM/YYYY','2341415FSzdFk','88sIDSqd','decrypt','Utf8','defineProperty','find','8442240QrIQGP','object'];a125_0x9dd4=function(){return _0x44580f;};return a125_0x9dd4();}(function(_0x1bb9ff,_0x328272){const _0x3ab42f=a125_0xce36,_0x5ace81=_0x1bb9ff();while(!![]){try{const _0x3f2622=-parseInt(_0x3ab42f(0x12c))/0x1*(parseInt(_0x3ab42f(0x11c))/0x2)+parseInt(_0x3ab42f(0x112))/0x3*(-parseInt(_0x3ab42f(0x10a))/0x4)+parseInt(_0x3ab42f(0x12f))/0x5+parseInt(_0x3ab42f(0x135))/0x6+parseInt(_0x3ab42f(0x129))/0x7*(parseInt(_0x3ab42f(0x119))/0x8)+-parseInt(_0x3ab42f(0x116))/0x9+parseInt(_0x3ab42f(0x10d))/0xa*(parseInt(_0x3ab42f(0x130))/0xb);if(_0x3f2622===_0x328272)break;else _0x5ace81['push'](_0x5ace81['shift']());}catch(_0x274106){_0x5ace81['push'](_0x5ace81['shift']());}}}(a125_0x9dd4,0xcab97));function a125_0xce36(_0x1fe7fc,_0x35c5fd){const _0x9dd40c=a125_0x9dd4();return a125_0xce36=function(_0xce3690,_0x16bab6){_0xce3690=_0xce3690-0x10a;let _0x3622fe=_0x9dd40c[_0xce3690];return _0x3622fe;},a125_0xce36(_0x1fe7fc,_0x35c5fd);}var __decorate=this&&this[a125_0x274b78(0x12a)]||function(_0x53067c,_0x2900d0,_0x27618a,_0x590304){const _0x4d86af=a125_0x274b78;var _0x477c93=arguments[_0x4d86af(0x13d)],_0x58c719=_0x477c93<0x3?_0x2900d0:_0x590304===null?_0x590304=Object[_0x4d86af(0x123)](_0x2900d0,_0x27618a):_0x590304,_0x6f427b;if(typeof Reflect===_0x4d86af(0x136)&&typeof Reflect['decorate']===_0x4d86af(0x140))_0x58c719=Reflect['decorate'](_0x53067c,_0x2900d0,_0x27618a,_0x590304);else{for(var _0x30639c=_0x53067c[_0x4d86af(0x13d)]-0x1;_0x30639c>=0x0;_0x30639c--)if(_0x6f427b=_0x53067c[_0x30639c])_0x58c719=(_0x477c93<0x3?_0x6f427b(_0x58c719):_0x477c93>0x3?_0x6f427b(_0x2900d0,_0x27618a,_0x58c719):_0x6f427b(_0x2900d0,_0x27618a))||_0x58c719;}return _0x477c93>0x3&&_0x58c719&&Object[_0x4d86af(0x133)](_0x2900d0,_0x27618a,_0x58c719),_0x58c719;},__metadata=this&&this['__metadata']||function(_0x185436,_0x11c183){const _0x50c325=a125_0x274b78;if(typeof Reflect===_0x50c325(0x136)&&typeof Reflect['metadata']==='function')return Reflect[_0x50c325(0x110)](_0x185436,_0x11c183);},__param=this&&this[a125_0x274b78(0x13a)]||function(_0x184407,_0x458d22){return function(_0x5a3064,_0x4aa795){_0x458d22(_0x5a3064,_0x4aa795,_0x184407);};};Object[a125_0x274b78(0x133)](exports,'__esModule',{'value':!![]}),exports[a125_0x274b78(0x11d)]=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a125_0x274b78(0x137)),mongoose_2=require(a125_0x274b78(0x115)),CryptoJS=require(a125_0x274b78(0x121)),dayjs=require(a125_0x274b78(0x111)),crypto_1=require('../common/crypto'),job_1=require('../common/job'),constants_1=require(a125_0x274b78(0x117)),SECRET=a125_0x274b78(0x138);let SettingService=class SettingService{constructor(_0x5b7b4d){const _0x13e357=a125_0x274b78;this[_0x13e357(0x126)]=_0x5b7b4d;}async[a125_0x274b78(0x10b)](_0x1c8abe){const _0xbbf48d=a125_0x274b78,_0x3e2a07=new this[(_0xbbf48d(0x126))](_0x1c8abe);return _0x3e2a07[_0xbbf48d(0x13b)]();}async[a125_0x274b78(0x120)](){const _0x2f0b9e=a125_0x274b78;var _0x4c5b32,_0x3c0fde,_0x243943;const _0x271151=await this[_0x2f0b9e(0x126)][_0x2f0b9e(0x134)]()[_0x2f0b9e(0x10c)](),_0x40bd54=(_0x4c5b32=_0x271151[0x0])===null||_0x4c5b32===void 0x0?void 0x0:_0x4c5b32[_0x2f0b9e(0x11f)]();if(!_0x40bd54)return;return Object[_0x2f0b9e(0x10e)](Object[_0x2f0b9e(0x10e)]({},_0x40bd54),{'userSetting':Object[_0x2f0b9e(0x10e)](Object[_0x2f0b9e(0x10e)]({},_0x40bd54[_0x2f0b9e(0x124)]),{'maxUser':(_0x243943=(_0x3c0fde=_0x40bd54['userSetting'])===null||_0x3c0fde===void 0x0?void 0x0:_0x3c0fde['maxUser'])!==null&&_0x243943!==void 0x0?_0x243943:constants_1[_0x2f0b9e(0x11b)]})});}async[a125_0x274b78(0x122)](_0x1d14bd,_0x2052fa){const _0x57ebd8=a125_0x274b78,_0x4da2ea=await this[_0x57ebd8(0x126)][_0x57ebd8(0x127)](_0x1d14bd,Object[_0x57ebd8(0x10e)](Object[_0x57ebd8(0x10e)]({},_0x2052fa),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x57ebd8(0x10c)]();return _0x4da2ea;}async[a125_0x274b78(0x13c)](){const _0x5718ec=a125_0x274b78,_0x48c9c7=await this[_0x5718ec(0x120)](),_0x315e15=this[_0x5718ec(0x13f)](_0x48c9c7[_0x5718ec(0x13e)],_0x48c9c7[_0x5718ec(0x143)]);return this[_0x5718ec(0x122)](_0x48c9c7[_0x5718ec(0x113)],{'isExpired':!_0x315e15[_0x5718ec(0x114)]});}async['updateUserSetting'](_0x4485f6){const _0x538f15=a125_0x274b78,_0x223c61=await this['findFirst']();return console['log'](_0x223c61,_0x538f15(0x118)),this[_0x538f15(0x122)](_0x223c61[_0x538f15(0x113)],{'userSetting':_0x4485f6});}[a125_0x274b78(0x13f)](_0x3f3b48,_0x2135e1){const _0x11f671=a125_0x274b78;try{if(!_0x3f3b48)return{'isValid':![],'expiryDate':''};const _0x4bc14b=(0x0,crypto_1[_0x11f671(0x131)])(_0x3f3b48,CryptoJS[_0x11f671(0x141)][_0x11f671(0x144)][_0x11f671(0x12b)](SECRET)[_0x11f671(0x12d)](CryptoJS[_0x11f671(0x141)][_0x11f671(0x132)]));if(_0x4bc14b[_0x11f671(0x143)]!==_0x2135e1)return{'isValid':![],'expiryDate':''};const _0x5d00f6=dayjs(_0x4bc14b[_0x11f671(0x11a)],_0x11f671(0x12e))['toDate'](),_0x5a838f=dayjs(_0x4bc14b[_0x11f671(0x128)],'DD/MM/YYYY')[_0x11f671(0x142)](),_0x221a6c=dayjs()[_0x11f671(0x142)]();if(_0x221a6c<_0x5d00f6||_0x221a6c>_0x5a838f)return{'isValid':![],'expiryDate':_0x4bc14b[_0x11f671(0x128)]};return{'isValid':!![],'expiryDate':_0x4bc14b[_0x11f671(0x128)]};}catch(_0x560ad2){return{'isValid':![],'expiryDate':''};}}async[a125_0x274b78(0x10f)](){const _0x43cc73=a125_0x274b78;job_1['PROCESS_CACHE'][_0x43cc73(0x139)]();}};SettingService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_1[a125_0x274b78(0x11e)])(a125_0x274b78(0x125))),__metadata('design:paramtypes',[mongoose_2['Model']])],SettingService),exports[a125_0x274b78(0x11d)]=SettingService;