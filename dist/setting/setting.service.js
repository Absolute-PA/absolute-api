'use strict';const a122_0x582521=a122_0x5e07;(function(_0xa19115,_0x5a28fe){const _0x89ef74=a122_0x5e07,_0x1f0d16=_0xa19115();while(!![]){try{const _0x154a3e=-parseInt(_0x89ef74(0xd6))/0x1*(parseInt(_0x89ef74(0xc2))/0x2)+parseInt(_0x89ef74(0xe6))/0x3*(parseInt(_0x89ef74(0xbc))/0x4)+-parseInt(_0x89ef74(0xe9))/0x5+-parseInt(_0x89ef74(0xcc))/0x6*(parseInt(_0x89ef74(0xe7))/0x7)+-parseInt(_0x89ef74(0xd1))/0x8*(parseInt(_0x89ef74(0xbd))/0x9)+parseInt(_0x89ef74(0xe2))/0xa*(parseInt(_0x89ef74(0xed))/0xb)+parseInt(_0x89ef74(0xb5))/0xc*(parseInt(_0x89ef74(0xcb))/0xd);if(_0x154a3e===_0x5a28fe)break;else _0x1f0d16['push'](_0x1f0d16['shift']());}catch(_0x4a5033){_0x1f0d16['push'](_0x1f0d16['shift']());}}}(a122_0x3dea,0x38389));function a122_0x3dea(){const _0x58fd09=['1294389YIDBBu','16331Lvlnvy','SettingService','848100ocQUKQ','__esModule','__param','_id','11KPOItR','766716gEOCqy','validateLicenseKey','create','assign','decrypt','toDate','licenseKey','4gZhsgo','234vyLFEk','killAll','schoolId','DEFAULT_MAX_USER','find','16TjdVBg','QVBFVFVMT1NCQQ==','userSetting','DD/MM/YYYY','update','defineProperty','./constants','@nestjs/mongoose','Base64','104rFBXOP','1026HntJxU','settingModel','crypto-js','updateExpiryStatus','findFirst','43984NghtCg','../common/crypto','enc','parse','__decorate','50878dfapHq','validTo','Utf8','design:paramtypes','PROCESS_CACHE','__metadata','../common/job','exec','toString','toObject','metadata','mongoose','4062090kaBYiK','length','function','object'];a122_0x3dea=function(){return _0x58fd09;};return a122_0x3dea();}var __decorate=this&&this[a122_0x582521(0xd5)]||function(_0xc0705e,_0x356bdf,_0x1d8b8e,_0x3ea1f6){const _0x301cc6=a122_0x582521;var _0x5b3b7a=arguments[_0x301cc6(0xe3)],_0x199d9e=_0x5b3b7a<0x3?_0x356bdf:_0x3ea1f6===null?_0x3ea1f6=Object['getOwnPropertyDescriptor'](_0x356bdf,_0x1d8b8e):_0x3ea1f6,_0x253962;if(typeof Reflect===_0x301cc6(0xe5)&&typeof Reflect['decorate']==='function')_0x199d9e=Reflect['decorate'](_0xc0705e,_0x356bdf,_0x1d8b8e,_0x3ea1f6);else{for(var _0x44e479=_0xc0705e[_0x301cc6(0xe3)]-0x1;_0x44e479>=0x0;_0x44e479--)if(_0x253962=_0xc0705e[_0x44e479])_0x199d9e=(_0x5b3b7a<0x3?_0x253962(_0x199d9e):_0x5b3b7a>0x3?_0x253962(_0x356bdf,_0x1d8b8e,_0x199d9e):_0x253962(_0x356bdf,_0x1d8b8e))||_0x199d9e;}return _0x5b3b7a>0x3&&_0x199d9e&&Object[_0x301cc6(0xc7)](_0x356bdf,_0x1d8b8e,_0x199d9e),_0x199d9e;},__metadata=this&&this[a122_0x582521(0xdb)]||function(_0x467e48,_0x1e7b3b){const _0x53616f=a122_0x582521;if(typeof Reflect===_0x53616f(0xe5)&&typeof Reflect[_0x53616f(0xe0)]===_0x53616f(0xe4))return Reflect['metadata'](_0x467e48,_0x1e7b3b);},__param=this&&this[a122_0x582521(0xeb)]||function(_0x30ef1f,_0x460c48){return function(_0xca2983,_0x2ef27c){_0x460c48(_0xca2983,_0x2ef27c,_0x30ef1f);};};Object[a122_0x582521(0xc7)](exports,a122_0x582521(0xea),{'value':!![]}),exports[a122_0x582521(0xe8)]=void 0x0;function a122_0x5e07(_0x177f52,_0x4ae3d5){const _0x3dea4b=a122_0x3dea();return a122_0x5e07=function(_0x5e07a5,_0x3b91f9){_0x5e07a5=_0x5e07a5-0xb5;let _0x2455e2=_0x3dea4b[_0x5e07a5];return _0x2455e2;},a122_0x5e07(_0x177f52,_0x4ae3d5);}const common_1=require('@nestjs/common'),mongoose_1=require(a122_0x582521(0xc9)),mongoose_2=require(a122_0x582521(0xe1)),CryptoJS=require(a122_0x582521(0xce)),dayjs=require('dayjs'),crypto_1=require(a122_0x582521(0xd2)),job_1=require(a122_0x582521(0xdc)),constants_1=require(a122_0x582521(0xc8)),SECRET=a122_0x582521(0xc3);let SettingService=class SettingService{constructor(_0x3e38a2){const _0x1e0c1c=a122_0x582521;this[_0x1e0c1c(0xcd)]=_0x3e38a2;}async[a122_0x582521(0xb7)](_0x33e249){const _0x401442=new this['settingModel'](_0x33e249);return _0x401442['save']();}async[a122_0x582521(0xd0)](){const _0x3f4f0f=a122_0x582521;var _0x5411ab,_0x134c41,_0x23b040;const _0x10387a=await this[_0x3f4f0f(0xcd)][_0x3f4f0f(0xc1)]()[_0x3f4f0f(0xdd)](),_0x5ccb51=(_0x5411ab=_0x10387a[0x0])===null||_0x5411ab===void 0x0?void 0x0:_0x5411ab[_0x3f4f0f(0xdf)]();if(!_0x5ccb51)return;return Object[_0x3f4f0f(0xb8)](Object[_0x3f4f0f(0xb8)]({},_0x5ccb51),{'userSetting':Object[_0x3f4f0f(0xb8)](Object['assign']({},_0x5ccb51[_0x3f4f0f(0xc4)]),{'maxUser':(_0x23b040=(_0x134c41=_0x5ccb51[_0x3f4f0f(0xc4)])===null||_0x134c41===void 0x0?void 0x0:_0x134c41['maxUser'])!==null&&_0x23b040!==void 0x0?_0x23b040:constants_1[_0x3f4f0f(0xc0)]})});}async[a122_0x582521(0xc6)](_0x1ef814,_0xe1170a){const _0x218cab=a122_0x582521,_0x68357b=await this['settingModel']['findByIdAndUpdate'](_0x1ef814,Object[_0x218cab(0xb8)](Object[_0x218cab(0xb8)]({},_0xe1170a),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x218cab(0xdd)]();return _0x68357b;}async[a122_0x582521(0xcf)](){const _0x30fa51=a122_0x582521,_0x59e12c=await this['findFirst'](),_0x31163a=this[_0x30fa51(0xb6)](_0x59e12c[_0x30fa51(0xbb)],_0x59e12c['schoolId']);return this[_0x30fa51(0xc6)](_0x59e12c[_0x30fa51(0xec)],{'isExpired':!_0x31163a['isValid']});}async['updateUserSetting'](_0x8f97f0){const _0x1514e6=a122_0x582521,_0x445835=await this[_0x1514e6(0xd0)]();return console['log'](_0x445835,'setting'),this['update'](_0x445835[_0x1514e6(0xec)],{'userSetting':_0x8f97f0});}[a122_0x582521(0xb6)](_0x2c1b31,_0x5793e9){const _0x35a7b8=a122_0x582521;try{if(!_0x2c1b31)return{'isValid':![],'expiryDate':''};const _0x747859=(0x0,crypto_1[_0x35a7b8(0xb9)])(_0x2c1b31,CryptoJS['enc'][_0x35a7b8(0xca)][_0x35a7b8(0xd4)](SECRET)[_0x35a7b8(0xde)](CryptoJS[_0x35a7b8(0xd3)][_0x35a7b8(0xd8)]));if(_0x747859[_0x35a7b8(0xbf)]!==_0x5793e9)return{'isValid':![],'expiryDate':''};const _0x3413dc=dayjs(_0x747859['validFrom'],_0x35a7b8(0xc5))['toDate'](),_0x547433=dayjs(_0x747859[_0x35a7b8(0xd7)],_0x35a7b8(0xc5))[_0x35a7b8(0xba)](),_0x1403b9=dayjs()[_0x35a7b8(0xba)]();if(_0x1403b9<_0x3413dc||_0x1403b9>_0x547433)return{'isValid':![],'expiryDate':_0x747859['validTo']};return{'isValid':!![],'expiryDate':_0x747859[_0x35a7b8(0xd7)]};}catch(_0x31ac84){return{'isValid':![],'expiryDate':''};}}async['killJobs'](){const _0x3d49b6=a122_0x582521;job_1[_0x3d49b6(0xda)][_0x3d49b6(0xbe)]();}};SettingService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_1['InjectModel'])('Setting')),__metadata(a122_0x582521(0xd9),[mongoose_2['Model']])],SettingService),exports[a122_0x582521(0xe8)]=SettingService;