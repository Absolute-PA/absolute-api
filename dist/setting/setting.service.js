'use strict';function a125_0x2522(){const _0x5b8cc0=['setting','5642765AikMsB','log','PROCESS_CACHE','_id','toObject','__metadata','5810HrTpda','QVBFVFVMT1NCQQ==','userSetting','3603bWlZlw','licenseKey','updateExpiryStatus','enc','schoolId','assign','isValid','1066884xtRkGO','4864cQyuZS','toString','@nestjs/mongoose','update','DEFAULT_MAX_USER','@nestjs/common','settingModel','save','Model','../common/job','__esModule','getOwnPropertyDescriptor','parse','findByIdAndUpdate','killAll','toDate','1796HCjooT','./constants','find','DD/MM/YYYY','object','defineProperty','decorate','5659520XrIqqE','validFrom','findFirst','maxUser','6fWwZLS','Utf8','updateUserSetting','InjectModel','Base64','SettingService','validTo','decrypt','length','38341140XniCpf','function','validateLicenseKey','exec','14644089mSRYOD','killJobs','metadata','crypto-js','Injectable'];a125_0x2522=function(){return _0x5b8cc0;};return a125_0x2522();}const a125_0x3ef17b=a125_0x1d18;(function(_0x3e1d78,_0x82579e){const _0x170873=a125_0x1d18,_0x620e13=_0x3e1d78();while(!![]){try{const _0x442108=-parseInt(_0x170873(0x169))/0x1+parseInt(_0x170873(0x13b))/0x2*(parseInt(_0x170873(0x162))/0x3)+parseInt(_0x170873(0x142))/0x4+-parseInt(_0x170873(0x159))/0x5*(-parseInt(_0x170873(0x146))/0x6)+parseInt(_0x170873(0x15f))/0x7*(parseInt(_0x170873(0x16a))/0x8)+parseInt(_0x170873(0x153))/0x9+-parseInt(_0x170873(0x14f))/0xa;if(_0x442108===_0x82579e)break;else _0x620e13['push'](_0x620e13['shift']());}catch(_0x264288){_0x620e13['push'](_0x620e13['shift']());}}}(a125_0x2522,0xd02d6));function a125_0x1d18(_0x1420eb,_0x4919b2){const _0x2522fc=a125_0x2522();return a125_0x1d18=function(_0x1d18d3,_0x58a6f8){_0x1d18d3=_0x1d18d3-0x134;let _0x443762=_0x2522fc[_0x1d18d3];return _0x443762;},a125_0x1d18(_0x1420eb,_0x4919b2);}var __decorate=this&&this['__decorate']||function(_0x328468,_0x172332,_0x496627,_0x5a2212){const _0x107270=a125_0x1d18;var _0x4dfa64=arguments[_0x107270(0x14e)],_0x3abe1f=_0x4dfa64<0x3?_0x172332:_0x5a2212===null?_0x5a2212=Object[_0x107270(0x136)](_0x172332,_0x496627):_0x5a2212,_0x121b96;if(typeof Reflect===_0x107270(0x13f)&&typeof Reflect[_0x107270(0x141)]===_0x107270(0x150))_0x3abe1f=Reflect['decorate'](_0x328468,_0x172332,_0x496627,_0x5a2212);else{for(var _0x85819=_0x328468['length']-0x1;_0x85819>=0x0;_0x85819--)if(_0x121b96=_0x328468[_0x85819])_0x3abe1f=(_0x4dfa64<0x3?_0x121b96(_0x3abe1f):_0x4dfa64>0x3?_0x121b96(_0x172332,_0x496627,_0x3abe1f):_0x121b96(_0x172332,_0x496627))||_0x3abe1f;}return _0x4dfa64>0x3&&_0x3abe1f&&Object[_0x107270(0x140)](_0x172332,_0x496627,_0x3abe1f),_0x3abe1f;},__metadata=this&&this[a125_0x3ef17b(0x15e)]||function(_0x2eabf8,_0x56de10){const _0x23a455=a125_0x3ef17b;if(typeof Reflect===_0x23a455(0x13f)&&typeof Reflect[_0x23a455(0x155)]===_0x23a455(0x150))return Reflect[_0x23a455(0x155)](_0x2eabf8,_0x56de10);},__param=this&&this['__param']||function(_0x54ec83,_0x40f637){return function(_0x406ac2,_0x5211e9){_0x40f637(_0x406ac2,_0x5211e9,_0x54ec83);};};Object[a125_0x3ef17b(0x140)](exports,a125_0x3ef17b(0x135),{'value':!![]}),exports[a125_0x3ef17b(0x14b)]=void 0x0;const common_1=require(a125_0x3ef17b(0x16f)),mongoose_1=require(a125_0x3ef17b(0x16c)),mongoose_2=require('mongoose'),CryptoJS=require(a125_0x3ef17b(0x156)),dayjs=require('dayjs'),crypto_1=require('../common/crypto'),job_1=require(a125_0x3ef17b(0x134)),constants_1=require(a125_0x3ef17b(0x13c)),SECRET=a125_0x3ef17b(0x160);let SettingService=class SettingService{constructor(_0x135b81){const _0x57059c=a125_0x3ef17b;this[_0x57059c(0x170)]=_0x135b81;}async['create'](_0x5b8007){const _0x2aef50=a125_0x3ef17b,_0x35fe19=new this[(_0x2aef50(0x170))](_0x5b8007);return _0x35fe19[_0x2aef50(0x171)]();}async[a125_0x3ef17b(0x144)](){const _0x3813ef=a125_0x3ef17b;var _0xd7c32f,_0x49fef8,_0xa5a9da;const _0x3a6f9a=await this['settingModel'][_0x3813ef(0x13d)]()[_0x3813ef(0x152)](),_0x2996a7=(_0xd7c32f=_0x3a6f9a[0x0])===null||_0xd7c32f===void 0x0?void 0x0:_0xd7c32f[_0x3813ef(0x15d)]();if(!_0x2996a7)return;return Object[_0x3813ef(0x167)](Object['assign']({},_0x2996a7),{'userSetting':Object[_0x3813ef(0x167)](Object[_0x3813ef(0x167)]({},_0x2996a7[_0x3813ef(0x161)]),{'maxUser':(_0xa5a9da=(_0x49fef8=_0x2996a7[_0x3813ef(0x161)])===null||_0x49fef8===void 0x0?void 0x0:_0x49fef8[_0x3813ef(0x145)])!==null&&_0xa5a9da!==void 0x0?_0xa5a9da:constants_1[_0x3813ef(0x16e)]})});}async['update'](_0x12681b,_0x59153c){const _0x5a0e8d=a125_0x3ef17b,_0x2b2852=await this[_0x5a0e8d(0x170)][_0x5a0e8d(0x138)](_0x12681b,Object[_0x5a0e8d(0x167)](Object[_0x5a0e8d(0x167)]({},_0x59153c),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x5a0e8d(0x152)]();return _0x2b2852;}async[a125_0x3ef17b(0x164)](){const _0x3f1a0f=a125_0x3ef17b,_0x24ce96=await this[_0x3f1a0f(0x144)](),_0x39ccae=this[_0x3f1a0f(0x151)](_0x24ce96[_0x3f1a0f(0x163)],_0x24ce96[_0x3f1a0f(0x166)]);return this[_0x3f1a0f(0x16d)](_0x24ce96[_0x3f1a0f(0x15c)],{'isExpired':!_0x39ccae[_0x3f1a0f(0x168)]});}async[a125_0x3ef17b(0x148)](_0x463898){const _0x586ca1=a125_0x3ef17b,_0xc36c70=await this[_0x586ca1(0x144)]();return console[_0x586ca1(0x15a)](_0xc36c70,_0x586ca1(0x158)),this['update'](_0xc36c70[_0x586ca1(0x15c)],{'userSetting':_0x463898});}[a125_0x3ef17b(0x151)](_0x4fd271,_0x555cca){const _0x16927c=a125_0x3ef17b;try{if(!_0x4fd271)return{'isValid':![],'expiryDate':''};const _0x414379=(0x0,crypto_1[_0x16927c(0x14d)])(_0x4fd271,CryptoJS[_0x16927c(0x165)][_0x16927c(0x14a)][_0x16927c(0x137)](SECRET)[_0x16927c(0x16b)](CryptoJS[_0x16927c(0x165)][_0x16927c(0x147)]));if(_0x414379[_0x16927c(0x166)]!==_0x555cca)return{'isValid':![],'expiryDate':''};const _0x3260b9=dayjs(_0x414379[_0x16927c(0x143)],_0x16927c(0x13e))[_0x16927c(0x13a)](),_0x30aef4=dayjs(_0x414379['validTo'],_0x16927c(0x13e))['toDate'](),_0xee1fad=dayjs()[_0x16927c(0x13a)]();if(_0xee1fad<_0x3260b9||_0xee1fad>_0x30aef4)return{'isValid':![],'expiryDate':_0x414379['validTo']};return{'isValid':!![],'expiryDate':_0x414379[_0x16927c(0x14c)]};}catch(_0x1ea349){return{'isValid':![],'expiryDate':''};}}async[a125_0x3ef17b(0x154)](){const _0x3118bb=a125_0x3ef17b;job_1[_0x3118bb(0x15b)][_0x3118bb(0x139)]();}};SettingService=__decorate([(0x0,common_1[a125_0x3ef17b(0x157)])(),__param(0x0,(0x0,mongoose_1[a125_0x3ef17b(0x149)])('Setting')),__metadata('design:paramtypes',[mongoose_2[a125_0x3ef17b(0x172)]])],SettingService),exports[a125_0x3ef17b(0x14b)]=SettingService;