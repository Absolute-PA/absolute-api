'use strict';function a122_0x5187(_0x34d557,_0x539eaf){const _0x4d4c99=a122_0x4d4c();return a122_0x5187=function(_0x51873d,_0x609175){_0x51873d=_0x51873d-0x110;let _0x4ce4b5=_0x4d4c99[_0x51873d];return _0x4ce4b5;},a122_0x5187(_0x34d557,_0x539eaf);}const a122_0x617a48=a122_0x5187;(function(_0x3bc63e,_0x5dc94a){const _0x8ea80d=a122_0x5187,_0x101b81=_0x3bc63e();while(!![]){try{const _0x2f25dd=parseInt(_0x8ea80d(0x121))/0x1+parseInt(_0x8ea80d(0x11c))/0x2*(-parseInt(_0x8ea80d(0x119))/0x3)+-parseInt(_0x8ea80d(0x143))/0x4+-parseInt(_0x8ea80d(0x11d))/0x5*(-parseInt(_0x8ea80d(0x12e))/0x6)+parseInt(_0x8ea80d(0x118))/0x7+-parseInt(_0x8ea80d(0x12c))/0x8*(-parseInt(_0x8ea80d(0x141))/0x9)+-parseInt(_0x8ea80d(0x14b))/0xa*(-parseInt(_0x8ea80d(0x147))/0xb);if(_0x2f25dd===_0x5dc94a)break;else _0x101b81['push'](_0x101b81['shift']());}catch(_0x5c4ba4){_0x101b81['push'](_0x101b81['shift']());}}}(a122_0x4d4c,0x7fb86));var __decorate=this&&this[a122_0x617a48(0x149)]||function(_0x1670b0,_0x19001b,_0x3a6cc7,_0x2c609b){const _0x575740=a122_0x617a48;var _0x4723ec=arguments[_0x575740(0x126)],_0x4966ff=_0x4723ec<0x3?_0x19001b:_0x2c609b===null?_0x2c609b=Object[_0x575740(0x145)](_0x19001b,_0x3a6cc7):_0x2c609b,_0x1bacc6;if(typeof Reflect===_0x575740(0x11a)&&typeof Reflect[_0x575740(0x142)]===_0x575740(0x12a))_0x4966ff=Reflect[_0x575740(0x142)](_0x1670b0,_0x19001b,_0x3a6cc7,_0x2c609b);else{for(var _0x41a305=_0x1670b0['length']-0x1;_0x41a305>=0x0;_0x41a305--)if(_0x1bacc6=_0x1670b0[_0x41a305])_0x4966ff=(_0x4723ec<0x3?_0x1bacc6(_0x4966ff):_0x4723ec>0x3?_0x1bacc6(_0x19001b,_0x3a6cc7,_0x4966ff):_0x1bacc6(_0x19001b,_0x3a6cc7))||_0x4966ff;}return _0x4723ec>0x3&&_0x4966ff&&Object['defineProperty'](_0x19001b,_0x3a6cc7,_0x4966ff),_0x4966ff;},__metadata=this&&this[a122_0x617a48(0x131)]||function(_0x50b221,_0x278e9b){const _0x135738=a122_0x617a48;if(typeof Reflect===_0x135738(0x11a)&&typeof Reflect[_0x135738(0x137)]===_0x135738(0x12a))return Reflect[_0x135738(0x137)](_0x50b221,_0x278e9b);},__param=this&&this['__param']||function(_0x1df2a9,_0x3043d7){return function(_0x5ef87a,_0x1db8ea){_0x3043d7(_0x5ef87a,_0x1db8ea,_0x1df2a9);};};function a122_0x4d4c(){const _0x14c7cd=['updateExpiryStatus','toDate','SettingService','function','setting','110464LqhpTb','enc','19746CYhdDQ','update','licenseKey','__metadata','validFrom','InjectModel','__esModule','maxUser','validTo','metadata','killAll','validateLicenseKey','Injectable','Base64','save','schoolId','updateUserSetting','toObject','@nestjs/mongoose','423ggiCcJ','decorate','2006340qxQrCC','DD/MM/YYYY','getOwnPropertyDescriptor','../common/job','781JoLHFt','settingModel','__decorate','findByIdAndUpdate','9070alkLtH','create','decrypt','QVBFVFVMT1NCQQ==','mongoose','exec','PROCESS_CACHE','DEFAULT_MAX_USER','parse','defineProperty','1826377vRHmAH','1093557LUlHKI','object','isValid','2ztQeLQ','60bLrRhM','assign','findFirst','./constants','375470keVrge','log','_id','Model','killJobs','length'];a122_0x4d4c=function(){return _0x14c7cd;};return a122_0x4d4c();}Object[a122_0x617a48(0x117)](exports,a122_0x617a48(0x134),{'value':!![]}),exports[a122_0x617a48(0x129)]=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a122_0x617a48(0x140)),mongoose_2=require(a122_0x617a48(0x112)),CryptoJS=require('crypto-js'),dayjs=require('dayjs'),crypto_1=require('../common/crypto'),job_1=require(a122_0x617a48(0x146)),constants_1=require(a122_0x617a48(0x120)),SECRET=a122_0x617a48(0x111);let SettingService=class SettingService{constructor(_0xc6e5e8){this['settingModel']=_0xc6e5e8;}async[a122_0x617a48(0x14c)](_0x106285){const _0xe758fc=a122_0x617a48,_0x44d7ad=new this[(_0xe758fc(0x148))](_0x106285);return _0x44d7ad[_0xe758fc(0x13c)]();}async[a122_0x617a48(0x11f)](){const _0x22a8fa=a122_0x617a48;var _0x5daee4,_0x2ba8d1;const _0x4cbd13=await this[_0x22a8fa(0x148)]['find']()[_0x22a8fa(0x113)](),_0x41e80a=_0x4cbd13[0x0][_0x22a8fa(0x13f)]();return Object[_0x22a8fa(0x11e)](Object['assign']({},_0x41e80a),{'userSetting':Object['assign'](Object[_0x22a8fa(0x11e)]({},_0x41e80a['userSetting']),{'maxUser':(_0x2ba8d1=(_0x5daee4=_0x41e80a['userSetting'])===null||_0x5daee4===void 0x0?void 0x0:_0x5daee4[_0x22a8fa(0x135)])!==null&&_0x2ba8d1!==void 0x0?_0x2ba8d1:constants_1[_0x22a8fa(0x115)]})});}async[a122_0x617a48(0x12f)](_0x203ef7,_0x50f67d){const _0x8493da=a122_0x617a48,_0x41fdad=await this[_0x8493da(0x148)][_0x8493da(0x14a)](_0x203ef7,Object[_0x8493da(0x11e)](Object[_0x8493da(0x11e)]({},_0x50f67d),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x8493da(0x113)]();return _0x41fdad;}async[a122_0x617a48(0x127)](){const _0x5b3ec8=a122_0x617a48,_0xe8c88c=await this[_0x5b3ec8(0x11f)](),_0x2a6cd0=this['validateLicenseKey'](_0xe8c88c[_0x5b3ec8(0x130)],_0xe8c88c[_0x5b3ec8(0x13d)]);return this['update'](_0xe8c88c[_0x5b3ec8(0x123)],{'isExpired':!_0x2a6cd0[_0x5b3ec8(0x11b)]});}async[a122_0x617a48(0x13e)](_0x5eec5c){const _0x166b60=a122_0x617a48,_0x18ced2=await this['findFirst']();return console[_0x166b60(0x122)](_0x18ced2,_0x166b60(0x12b)),this['update'](_0x18ced2[_0x166b60(0x123)],{'userSetting':_0x5eec5c});}[a122_0x617a48(0x139)](_0x302c86,_0x451828){const _0x2131af=a122_0x617a48;try{if(!_0x302c86)return{'isValid':![],'expiryDate':''};const _0xdbeecd=(0x0,crypto_1[_0x2131af(0x110)])(_0x302c86,CryptoJS[_0x2131af(0x12d)][_0x2131af(0x13b)][_0x2131af(0x116)](SECRET)['toString'](CryptoJS[_0x2131af(0x12d)]['Utf8']));if(_0xdbeecd[_0x2131af(0x13d)]!==_0x451828)return{'isValid':![],'expiryDate':''};const _0x3baad2=dayjs(_0xdbeecd[_0x2131af(0x132)],_0x2131af(0x144))[_0x2131af(0x128)](),_0x16b2ee=dayjs(_0xdbeecd[_0x2131af(0x136)],'DD/MM/YYYY')[_0x2131af(0x128)](),_0x298b4d=dayjs()['toDate']();if(_0x298b4d<_0x3baad2||_0x298b4d>_0x16b2ee)return{'isValid':![],'expiryDate':_0xdbeecd[_0x2131af(0x136)]};return{'isValid':!![],'expiryDate':_0xdbeecd[_0x2131af(0x136)]};}catch(_0x10821f){return{'isValid':![],'expiryDate':''};}}async[a122_0x617a48(0x125)](){const _0x124a53=a122_0x617a48;job_1[_0x124a53(0x114)][_0x124a53(0x138)]();}};SettingService=__decorate([(0x0,common_1[a122_0x617a48(0x13a)])(),__param(0x0,(0x0,mongoose_1[a122_0x617a48(0x133)])('Setting')),__metadata('design:paramtypes',[mongoose_2[a122_0x617a48(0x124)]])],SettingService),exports['SettingService']=SettingService;