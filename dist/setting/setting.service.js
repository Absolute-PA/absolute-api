'use strict';const a122_0x1cb28f=a122_0x1e9c;(function(_0x2eaa62,_0xdaa416){const _0x7c27=a122_0x1e9c,_0x2184d5=_0x2eaa62();while(!![]){try{const _0x53a676=parseInt(_0x7c27(0x128))/0x1*(-parseInt(_0x7c27(0xfc))/0x2)+parseInt(_0x7c27(0x109))/0x3+parseInt(_0x7c27(0x124))/0x4*(parseInt(_0x7c27(0x10b))/0x5)+-parseInt(_0x7c27(0xfd))/0x6*(-parseInt(_0x7c27(0x10f))/0x7)+-parseInt(_0x7c27(0xfe))/0x8*(parseInt(_0x7c27(0x105))/0x9)+-parseInt(_0x7c27(0x117))/0xa+-parseInt(_0x7c27(0x12c))/0xb*(-parseInt(_0x7c27(0x12b))/0xc);if(_0x53a676===_0xdaa416)break;else _0x2184d5['push'](_0x2184d5['shift']());}catch(_0x45b9a9){_0x2184d5['push'](_0x2184d5['shift']());}}}(a122_0x246a,0xbf0f6));function a122_0x1e9c(_0x1e40e3,_0x28ab93){const _0x246aa5=a122_0x246a();return a122_0x1e9c=function(_0x1e9c86,_0x497199){_0x1e9c86=_0x1e9c86-0xf9;let _0x2df07f=_0x246aa5[_0x1e9c86];return _0x2df07f;},a122_0x1e9c(_0x1e40e3,_0x28ab93);}function a122_0x246a(){const _0xcac4be=['@nestjs/common','1803711XCNQRL','killAll','7925HrgIBK','getOwnPropertyDescriptor','length','userSetting','4361RmLuFu','killJobs','toObject','exec','updateUserSetting','./constants','defineProperty','create','6125480LNgMPM','../common/crypto','settingModel','setting','crypto-js','object','parse','validateLicenseKey','find','DEFAULT_MAX_USER','mongoose','dayjs','DD/MM/YYYY','2980lAWiYU','__metadata','metadata','SettingService','149CcZvTA','findByIdAndUpdate','isValid','300ufWIfQ','286814oYQuFE','function','updateExpiryStatus','Utf8','log','__decorate','decorate','toDate','Model','enc','update','3698JXIcZW','918lRsdYy','2400dshYYy','validFrom','Setting','__param','schoolId','assign','_id','25758uhlLBc','validTo','findFirst'];a122_0x246a=function(){return _0xcac4be;};return a122_0x246a();}var __decorate=this&&this[a122_0x1cb28f(0x131)]||function(_0x3456ce,_0x5380bb,_0x383e8f,_0x61ce1f){const _0x311969=a122_0x1cb28f;var _0xa4210a=arguments['length'],_0x4efe10=_0xa4210a<0x3?_0x5380bb:_0x61ce1f===null?_0x61ce1f=Object[_0x311969(0x10c)](_0x5380bb,_0x383e8f):_0x61ce1f,_0x3a55e8;if(typeof Reflect===_0x311969(0x11c)&&typeof Reflect[_0x311969(0x132)]==='function')_0x4efe10=Reflect['decorate'](_0x3456ce,_0x5380bb,_0x383e8f,_0x61ce1f);else{for(var _0x67a54=_0x3456ce[_0x311969(0x10d)]-0x1;_0x67a54>=0x0;_0x67a54--)if(_0x3a55e8=_0x3456ce[_0x67a54])_0x4efe10=(_0xa4210a<0x3?_0x3a55e8(_0x4efe10):_0xa4210a>0x3?_0x3a55e8(_0x5380bb,_0x383e8f,_0x4efe10):_0x3a55e8(_0x5380bb,_0x383e8f))||_0x4efe10;}return _0xa4210a>0x3&&_0x4efe10&&Object[_0x311969(0x115)](_0x5380bb,_0x383e8f,_0x4efe10),_0x4efe10;},__metadata=this&&this[a122_0x1cb28f(0x125)]||function(_0x8756f0,_0xe9eb16){const _0x3b4e72=a122_0x1cb28f;if(typeof Reflect===_0x3b4e72(0x11c)&&typeof Reflect['metadata']===_0x3b4e72(0x12d))return Reflect[_0x3b4e72(0x126)](_0x8756f0,_0xe9eb16);},__param=this&&this[a122_0x1cb28f(0x101)]||function(_0x4ed6ea,_0x1ff639){return function(_0x55bce5,_0x12d84c){_0x1ff639(_0x55bce5,_0x12d84c,_0x4ed6ea);};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a122_0x1cb28f(0x127)]=void 0x0;const common_1=require(a122_0x1cb28f(0x108)),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require(a122_0x1cb28f(0x121)),CryptoJS=require(a122_0x1cb28f(0x11b)),dayjs=require(a122_0x1cb28f(0x122)),crypto_1=require(a122_0x1cb28f(0x118)),job_1=require('../common/job'),constants_1=require(a122_0x1cb28f(0x114)),SECRET='QVBFVFVMT1NCQQ==';let SettingService=class SettingService{constructor(_0x446826){const _0x46b279=a122_0x1cb28f;this[_0x46b279(0x119)]=_0x446826;}async[a122_0x1cb28f(0x116)](_0x46f391){const _0x5d4a68=new this['settingModel'](_0x46f391);return _0x5d4a68['save']();}async['findFirst'](){const _0x2e31b6=a122_0x1cb28f;var _0x26828c,_0x2fdf33;const _0x359481=await this[_0x2e31b6(0x119)][_0x2e31b6(0x11f)]()[_0x2e31b6(0x112)](),_0x38eeb8=_0x359481[0x0][_0x2e31b6(0x111)]();return Object[_0x2e31b6(0x103)](Object[_0x2e31b6(0x103)]({},_0x38eeb8),{'userSetting':Object[_0x2e31b6(0x103)](Object[_0x2e31b6(0x103)]({},_0x38eeb8[_0x2e31b6(0x10e)]),{'maxUser':(_0x2fdf33=(_0x26828c=_0x38eeb8['userSetting'])===null||_0x26828c===void 0x0?void 0x0:_0x26828c['maxUser'])!==null&&_0x2fdf33!==void 0x0?_0x2fdf33:constants_1[_0x2e31b6(0x120)]})});}async[a122_0x1cb28f(0xfb)](_0x510752,_0x3faeaa){const _0x388784=a122_0x1cb28f,_0x2de398=await this[_0x388784(0x119)][_0x388784(0x129)](_0x510752,Object[_0x388784(0x103)](Object['assign']({},_0x3faeaa),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x388784(0x112)]();return _0x2de398;}async[a122_0x1cb28f(0x12e)](){const _0x129daa=a122_0x1cb28f,_0x3ca59e=await this[_0x129daa(0x107)](),_0x218c6e=this[_0x129daa(0x11e)](_0x3ca59e['licenseKey'],_0x3ca59e[_0x129daa(0x102)]);return this['update'](_0x3ca59e[_0x129daa(0x104)],{'isExpired':!_0x218c6e[_0x129daa(0x12a)]});}async[a122_0x1cb28f(0x113)](_0x591ab7){const _0x32f8b3=a122_0x1cb28f,_0x9f8d77=await this['findFirst']();return console[_0x32f8b3(0x130)](_0x9f8d77,_0x32f8b3(0x11a)),this[_0x32f8b3(0xfb)](_0x9f8d77[_0x32f8b3(0x104)],{'userSetting':_0x591ab7});}[a122_0x1cb28f(0x11e)](_0xf149e7,_0x1795a8){const _0x2805ac=a122_0x1cb28f;try{if(!_0xf149e7)return{'isValid':![],'expiryDate':''};const _0x427e4a=(0x0,crypto_1['decrypt'])(_0xf149e7,CryptoJS[_0x2805ac(0xfa)]['Base64'][_0x2805ac(0x11d)](SECRET)['toString'](CryptoJS[_0x2805ac(0xfa)][_0x2805ac(0x12f)]));if(_0x427e4a['schoolId']!==_0x1795a8)return{'isValid':![],'expiryDate':''};const _0x28bb9c=dayjs(_0x427e4a[_0x2805ac(0xff)],'DD/MM/YYYY')['toDate'](),_0x2642e1=dayjs(_0x427e4a[_0x2805ac(0x106)],_0x2805ac(0x123))['toDate'](),_0x1a9f09=dayjs()[_0x2805ac(0x133)]();if(_0x1a9f09<_0x28bb9c||_0x1a9f09>_0x2642e1)return{'isValid':![],'expiryDate':_0x427e4a['validTo']};return{'isValid':!![],'expiryDate':_0x427e4a[_0x2805ac(0x106)]};}catch(_0x1611ff){return{'isValid':![],'expiryDate':''};}}async[a122_0x1cb28f(0x110)](){const _0x178bdd=a122_0x1cb28f;job_1['PROCESS_CACHE'][_0x178bdd(0x10a)]();}};SettingService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_1['InjectModel'])(a122_0x1cb28f(0x100))),__metadata('design:paramtypes',[mongoose_2[a122_0x1cb28f(0xf9)]])],SettingService),exports['SettingService']=SettingService;