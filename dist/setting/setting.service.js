'use strict';function a122_0x2c39(_0x48634b,_0x54994b){const _0x3b3969=a122_0x3b39();return a122_0x2c39=function(_0x2c3987,_0x4c37c8){_0x2c3987=_0x2c3987-0x15e;let _0x4c234e=_0x3b3969[_0x2c3987];return _0x4c234e;},a122_0x2c39(_0x48634b,_0x54994b);}function a122_0x3b39(){const _0x3c6e0b=['update','validTo','decrypt','userSetting','DEFAULT_MAX_USER','dayjs','__param','../common/job','1665540AHYxvu','getOwnPropertyDescriptor','killAll','validateLicenseKey','__esModule','SettingService','crypto-js','1728852BSsVZZ','schoolId','609423dJIZhN','setting','DD/MM/YYYY','defineProperty','settingModel','parse','log','exec','Setting','enc','killJobs','13670664ukjOxW','__metadata','Model','InjectModel','../common/crypto','object','findByIdAndUpdate','__decorate','toString','metadata','Base64','5ZXCQbQ','@nestjs/mongoose','find','3858820QbBJfM','updateExpiryStatus','licenseKey','save','_id','@nestjs/common','718631kuXXwI','isValid','findFirst','Utf8','length','maxUser','./constants','toDate','Injectable','decorate','546076TpDQLv','assign','toObject','function'];a122_0x3b39=function(){return _0x3c6e0b;};return a122_0x3b39();}const a122_0x178fc2=a122_0x2c39;(function(_0x5f0866,_0x44eaa3){const _0x525ef6=a122_0x2c39,_0x273bda=_0x5f0866();while(!![]){try{const _0x4a1672=-parseInt(_0x525ef6(0x17f))/0x1+-parseInt(_0x525ef6(0x189))/0x2+-parseInt(_0x525ef6(0x160))/0x3+-parseInt(_0x525ef6(0x195))/0x4+parseInt(_0x525ef6(0x176))/0x5*(-parseInt(_0x525ef6(0x15e))/0x6)+parseInt(_0x525ef6(0x179))/0x7+parseInt(_0x525ef6(0x16b))/0x8;if(_0x4a1672===_0x44eaa3)break;else _0x273bda['push'](_0x273bda['shift']());}catch(_0x1e1687){_0x273bda['push'](_0x273bda['shift']());}}}(a122_0x3b39,0x58134));var __decorate=this&&this[a122_0x178fc2(0x172)]||function(_0x32022e,_0x1403f8,_0x50c274,_0x52d781){const _0x431151=a122_0x178fc2;var _0x3d0b34=arguments['length'],_0x16fc7d=_0x3d0b34<0x3?_0x1403f8:_0x52d781===null?_0x52d781=Object[_0x431151(0x196)](_0x1403f8,_0x50c274):_0x52d781,_0xe61025;if(typeof Reflect==='object'&&typeof Reflect[_0x431151(0x188)]===_0x431151(0x18c))_0x16fc7d=Reflect[_0x431151(0x188)](_0x32022e,_0x1403f8,_0x50c274,_0x52d781);else{for(var _0x2f399e=_0x32022e[_0x431151(0x183)]-0x1;_0x2f399e>=0x0;_0x2f399e--)if(_0xe61025=_0x32022e[_0x2f399e])_0x16fc7d=(_0x3d0b34<0x3?_0xe61025(_0x16fc7d):_0x3d0b34>0x3?_0xe61025(_0x1403f8,_0x50c274,_0x16fc7d):_0xe61025(_0x1403f8,_0x50c274))||_0x16fc7d;}return _0x3d0b34>0x3&&_0x16fc7d&&Object[_0x431151(0x163)](_0x1403f8,_0x50c274,_0x16fc7d),_0x16fc7d;},__metadata=this&&this[a122_0x178fc2(0x16c)]||function(_0x3d282d,_0x2d22d4){const _0x4041a0=a122_0x178fc2;if(typeof Reflect===_0x4041a0(0x170)&&typeof Reflect[_0x4041a0(0x174)]===_0x4041a0(0x18c))return Reflect[_0x4041a0(0x174)](_0x3d282d,_0x2d22d4);},__param=this&&this[a122_0x178fc2(0x193)]||function(_0x589a31,_0xe5b13a){return function(_0x31a6f7,_0x3e4552){_0xe5b13a(_0x31a6f7,_0x3e4552,_0x589a31);};};Object['defineProperty'](exports,a122_0x178fc2(0x199),{'value':!![]}),exports[a122_0x178fc2(0x19a)]=void 0x0;const common_1=require(a122_0x178fc2(0x17e)),mongoose_1=require(a122_0x178fc2(0x177)),mongoose_2=require('mongoose'),CryptoJS=require(a122_0x178fc2(0x19b)),dayjs=require(a122_0x178fc2(0x192)),crypto_1=require(a122_0x178fc2(0x16f)),job_1=require(a122_0x178fc2(0x194)),constants_1=require(a122_0x178fc2(0x185)),SECRET='QVBFVFVMT1NCQQ==';let SettingService=class SettingService{constructor(_0x5e369f){const _0x4866d5=a122_0x178fc2;this[_0x4866d5(0x164)]=_0x5e369f;}async['create'](_0x597a2e){const _0x3adb21=a122_0x178fc2,_0x5d3033=new this['settingModel'](_0x597a2e);return _0x5d3033[_0x3adb21(0x17c)]();}async[a122_0x178fc2(0x181)](){const _0x458d2c=a122_0x178fc2;var _0x3dbccd,_0x110e36,_0x558080;const _0x396ea4=await this[_0x458d2c(0x164)][_0x458d2c(0x178)]()[_0x458d2c(0x167)](),_0x5c9874=(_0x3dbccd=_0x396ea4[0x0])===null||_0x3dbccd===void 0x0?void 0x0:_0x3dbccd[_0x458d2c(0x18b)]();if(!_0x5c9874)return;return Object['assign'](Object[_0x458d2c(0x18a)]({},_0x5c9874),{'userSetting':Object[_0x458d2c(0x18a)](Object['assign']({},_0x5c9874[_0x458d2c(0x190)]),{'maxUser':(_0x558080=(_0x110e36=_0x5c9874[_0x458d2c(0x190)])===null||_0x110e36===void 0x0?void 0x0:_0x110e36[_0x458d2c(0x184)])!==null&&_0x558080!==void 0x0?_0x558080:constants_1[_0x458d2c(0x191)]})});}async[a122_0x178fc2(0x18d)](_0x46b2c9,_0x1cf725){const _0x1bc57d=a122_0x178fc2,_0x3506f6=await this['settingModel'][_0x1bc57d(0x171)](_0x46b2c9,Object[_0x1bc57d(0x18a)](Object['assign']({},_0x1cf725),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x1bc57d(0x167)]();return _0x3506f6;}async[a122_0x178fc2(0x17a)](){const _0xb03387=a122_0x178fc2,_0x3b25e2=await this[_0xb03387(0x181)](),_0x27cf22=this[_0xb03387(0x198)](_0x3b25e2[_0xb03387(0x17b)],_0x3b25e2[_0xb03387(0x15f)]);return this['update'](_0x3b25e2[_0xb03387(0x17d)],{'isExpired':!_0x27cf22[_0xb03387(0x180)]});}async['updateUserSetting'](_0x2c3eb9){const _0x305253=a122_0x178fc2,_0x569dc1=await this['findFirst']();return console[_0x305253(0x166)](_0x569dc1,_0x305253(0x161)),this[_0x305253(0x18d)](_0x569dc1['_id'],{'userSetting':_0x2c3eb9});}[a122_0x178fc2(0x198)](_0x5a96df,_0x454afd){const _0x44280a=a122_0x178fc2;try{if(!_0x5a96df)return{'isValid':![],'expiryDate':''};const _0x178c2c=(0x0,crypto_1[_0x44280a(0x18f)])(_0x5a96df,CryptoJS['enc'][_0x44280a(0x175)][_0x44280a(0x165)](SECRET)[_0x44280a(0x173)](CryptoJS[_0x44280a(0x169)][_0x44280a(0x182)]));if(_0x178c2c[_0x44280a(0x15f)]!==_0x454afd)return{'isValid':![],'expiryDate':''};const _0x5efdff=dayjs(_0x178c2c['validFrom'],_0x44280a(0x162))[_0x44280a(0x186)](),_0x13cfb3=dayjs(_0x178c2c['validTo'],_0x44280a(0x162))[_0x44280a(0x186)](),_0x18fe4f=dayjs()['toDate']();if(_0x18fe4f<_0x5efdff||_0x18fe4f>_0x13cfb3)return{'isValid':![],'expiryDate':_0x178c2c[_0x44280a(0x18e)]};return{'isValid':!![],'expiryDate':_0x178c2c['validTo']};}catch(_0x195c4a){return{'isValid':![],'expiryDate':''};}}async[a122_0x178fc2(0x16a)](){const _0x412ed6=a122_0x178fc2;job_1['PROCESS_CACHE'][_0x412ed6(0x197)]();}};SettingService=__decorate([(0x0,common_1[a122_0x178fc2(0x187)])(),__param(0x0,(0x0,mongoose_1[a122_0x178fc2(0x16e)])(a122_0x178fc2(0x168))),__metadata('design:paramtypes',[mongoose_2[a122_0x178fc2(0x16d)]])],SettingService),exports[a122_0x178fc2(0x19a)]=SettingService;