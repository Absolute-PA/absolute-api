'use strict';const a125_0x4a1540=a125_0x118a;(function(_0xf8b63f,_0x578fd0){const _0x38b38a=a125_0x118a,_0x1c3cb6=_0xf8b63f();while(!![]){try{const _0x4eb926=parseInt(_0x38b38a(0x17e))/0x1+parseInt(_0x38b38a(0x179))/0x2+-parseInt(_0x38b38a(0x158))/0x3+parseInt(_0x38b38a(0x15a))/0x4+-parseInt(_0x38b38a(0x16d))/0x5+parseInt(_0x38b38a(0x163))/0x6+parseInt(_0x38b38a(0x170))/0x7;if(_0x4eb926===_0x578fd0)break;else _0x1c3cb6['push'](_0x1c3cb6['shift']());}catch(_0x2248a0){_0x1c3cb6['push'](_0x1c3cb6['shift']());}}}(a125_0x36e6,0x9ee03));function a125_0x118a(_0x2633f8,_0x5918a1){const _0x36e6ab=a125_0x36e6();return a125_0x118a=function(_0x118a55,_0x2c0f15){_0x118a55=_0x118a55-0x14c;let _0x1e2b9d=_0x36e6ab[_0x118a55];return _0x1e2b9d;},a125_0x118a(_0x2633f8,_0x5918a1);}function a125_0x36e6(){const _0x18f51b=['171832ZxAPYF','setting','isValid','create','find','1065478eKXDDh','crypto-js','Utf8','design:paramtypes','__param','DD/MM/YYYY','__decorate','log','length','function','SettingService','enc','InjectModel','@nestjs/common','object','__metadata','metadata','findByIdAndUpdate','1889010zMmyln','toDate','53284hHdEPO','_id','Injectable','mongoose','./constants','../common/job','@nestjs/mongoose','updateUserSetting','findFirst','1492860kwPhXh','toString','settingModel','defineProperty','Base64','save','validTo','Model','exec','validateLicenseKey','3864675ZfxFAh','killJobs','update','4478845XvWbnl','assign','toObject','DEFAULT_MAX_USER','validFrom','killAll','QVBFVFVMT1NCQQ==','userSetting','decorate'];a125_0x36e6=function(){return _0x18f51b;};return a125_0x36e6();}var __decorate=this&&this[a125_0x4a1540(0x14c)]||function(_0x275e46,_0x301737,_0x1d0e80,_0x36e622){const _0x3b92d5=a125_0x4a1540;var _0x4f2a3a=arguments['length'],_0x2c123f=_0x4f2a3a<0x3?_0x301737:_0x36e622===null?_0x36e622=Object['getOwnPropertyDescriptor'](_0x301737,_0x1d0e80):_0x36e622,_0x1fd4f8;if(typeof Reflect===_0x3b92d5(0x154)&&typeof Reflect[_0x3b92d5(0x178)]===_0x3b92d5(0x14f))_0x2c123f=Reflect[_0x3b92d5(0x178)](_0x275e46,_0x301737,_0x1d0e80,_0x36e622);else{for(var _0x147024=_0x275e46[_0x3b92d5(0x14e)]-0x1;_0x147024>=0x0;_0x147024--)if(_0x1fd4f8=_0x275e46[_0x147024])_0x2c123f=(_0x4f2a3a<0x3?_0x1fd4f8(_0x2c123f):_0x4f2a3a>0x3?_0x1fd4f8(_0x301737,_0x1d0e80,_0x2c123f):_0x1fd4f8(_0x301737,_0x1d0e80))||_0x2c123f;}return _0x4f2a3a>0x3&&_0x2c123f&&Object[_0x3b92d5(0x166)](_0x301737,_0x1d0e80,_0x2c123f),_0x2c123f;},__metadata=this&&this[a125_0x4a1540(0x155)]||function(_0x4fcdc5,_0x40186a){const _0x2adebc=a125_0x4a1540;if(typeof Reflect===_0x2adebc(0x154)&&typeof Reflect[_0x2adebc(0x156)]==='function')return Reflect[_0x2adebc(0x156)](_0x4fcdc5,_0x40186a);},__param=this&&this[a125_0x4a1540(0x182)]||function(_0x2c27ed,_0x1d1e66){return function(_0x19e3be,_0x5edff2){_0x1d1e66(_0x19e3be,_0x5edff2,_0x2c27ed);};};Object[a125_0x4a1540(0x166)](exports,'__esModule',{'value':!![]}),exports[a125_0x4a1540(0x150)]=void 0x0;const common_1=require(a125_0x4a1540(0x153)),mongoose_1=require(a125_0x4a1540(0x160)),mongoose_2=require(a125_0x4a1540(0x15d)),CryptoJS=require(a125_0x4a1540(0x17f)),dayjs=require('dayjs'),crypto_1=require('../common/crypto'),job_1=require(a125_0x4a1540(0x15f)),constants_1=require(a125_0x4a1540(0x15e)),SECRET=a125_0x4a1540(0x176);let SettingService=class SettingService{constructor(_0x2c216f){const _0x2ed5cf=a125_0x4a1540;this[_0x2ed5cf(0x165)]=_0x2c216f;}async[a125_0x4a1540(0x17c)](_0x329fb6){const _0x499044=a125_0x4a1540,_0x1ae1ac=new this[(_0x499044(0x165))](_0x329fb6);return _0x1ae1ac[_0x499044(0x168)]();}async[a125_0x4a1540(0x162)](){const _0x3cf7f1=a125_0x4a1540;var _0x4dcb54,_0x1338b4,_0x27cdec;const _0x435f0a=await this[_0x3cf7f1(0x165)][_0x3cf7f1(0x17d)]()[_0x3cf7f1(0x16b)](),_0x1d2572=(_0x4dcb54=_0x435f0a[0x0])===null||_0x4dcb54===void 0x0?void 0x0:_0x4dcb54[_0x3cf7f1(0x172)]();if(!_0x1d2572)return;return Object['assign'](Object['assign']({},_0x1d2572),{'userSetting':Object[_0x3cf7f1(0x171)](Object[_0x3cf7f1(0x171)]({},_0x1d2572[_0x3cf7f1(0x177)]),{'maxUser':(_0x27cdec=(_0x1338b4=_0x1d2572[_0x3cf7f1(0x177)])===null||_0x1338b4===void 0x0?void 0x0:_0x1338b4['maxUser'])!==null&&_0x27cdec!==void 0x0?_0x27cdec:constants_1[_0x3cf7f1(0x173)]})});}async[a125_0x4a1540(0x16f)](_0x4dbc77,_0x1d5fd7){const _0x4f9a72=a125_0x4a1540,_0x2fe265=await this['settingModel'][_0x4f9a72(0x157)](_0x4dbc77,Object[_0x4f9a72(0x171)](Object['assign']({},_0x1d5fd7),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x4f9a72(0x16b)]();return _0x2fe265;}async['updateExpiryStatus'](){const _0x517e2f=a125_0x4a1540,_0x4b7fe4=await this[_0x517e2f(0x162)](),_0x5b7f85=this[_0x517e2f(0x16c)](_0x4b7fe4['licenseKey'],_0x4b7fe4['schoolId']);return this[_0x517e2f(0x16f)](_0x4b7fe4[_0x517e2f(0x15b)],{'isExpired':!_0x5b7f85[_0x517e2f(0x17b)]});}async[a125_0x4a1540(0x161)](_0x536d59){const _0x40a00f=a125_0x4a1540,_0x434b12=await this[_0x40a00f(0x162)]();return console[_0x40a00f(0x14d)](_0x434b12,_0x40a00f(0x17a)),this[_0x40a00f(0x16f)](_0x434b12[_0x40a00f(0x15b)],{'userSetting':_0x536d59});}['validateLicenseKey'](_0x64a295,_0x3b6841){const _0x1a4084=a125_0x4a1540;try{if(!_0x64a295)return{'isValid':![],'expiryDate':''};const _0x52f363=(0x0,crypto_1['decrypt'])(_0x64a295,CryptoJS[_0x1a4084(0x151)][_0x1a4084(0x167)]['parse'](SECRET)[_0x1a4084(0x164)](CryptoJS[_0x1a4084(0x151)][_0x1a4084(0x180)]));if(_0x52f363['schoolId']!==_0x3b6841)return{'isValid':![],'expiryDate':''};const _0x3bdcb3=dayjs(_0x52f363[_0x1a4084(0x174)],_0x1a4084(0x183))[_0x1a4084(0x159)](),_0x482611=dayjs(_0x52f363[_0x1a4084(0x169)],_0x1a4084(0x183))[_0x1a4084(0x159)](),_0x194fc5=dayjs()[_0x1a4084(0x159)]();if(_0x194fc5<_0x3bdcb3||_0x194fc5>_0x482611)return{'isValid':![],'expiryDate':_0x52f363['validTo']};return{'isValid':!![],'expiryDate':_0x52f363[_0x1a4084(0x169)]};}catch(_0x306150){return{'isValid':![],'expiryDate':''};}}async[a125_0x4a1540(0x16e)](){const _0x3a4cf3=a125_0x4a1540;job_1['PROCESS_CACHE'][_0x3a4cf3(0x175)]();}};SettingService=__decorate([(0x0,common_1[a125_0x4a1540(0x15c)])(),__param(0x0,(0x0,mongoose_1[a125_0x4a1540(0x152)])('Setting')),__metadata(a125_0x4a1540(0x181),[mongoose_2[a125_0x4a1540(0x16a)]])],SettingService),exports[a125_0x4a1540(0x150)]=SettingService;