'use strict';const a122_0x140109=a122_0x5a52;(function(_0x3d9522,_0xb15351){const _0x13533b=a122_0x5a52,_0x1c5a9f=_0x3d9522();while(!![]){try{const _0x4e6c61=parseInt(_0x13533b(0x18c))/0x1*(-parseInt(_0x13533b(0x170))/0x2)+parseInt(_0x13533b(0x197))/0x3*(-parseInt(_0x13533b(0x179))/0x4)+parseInt(_0x13533b(0x177))/0x5+-parseInt(_0x13533b(0x167))/0x6*(parseInt(_0x13533b(0x17e))/0x7)+-parseInt(_0x13533b(0x182))/0x8*(-parseInt(_0x13533b(0x168))/0x9)+parseInt(_0x13533b(0x195))/0xa*(-parseInt(_0x13533b(0x181))/0xb)+-parseInt(_0x13533b(0x18b))/0xc*(-parseInt(_0x13533b(0x174))/0xd);if(_0x4e6c61===_0xb15351)break;else _0x1c5a9f['push'](_0x1c5a9f['shift']());}catch(_0x461311){_0x1c5a9f['push'](_0x1c5a9f['shift']());}}}(a122_0x7293,0xb2685));var __decorate=this&&this[a122_0x140109(0x186)]||function(_0x325376,_0xd7dcba,_0x30b5b0,_0x24791d){const _0x2b920e=a122_0x140109;var _0x78b1c2=arguments[_0x2b920e(0x18a)],_0x149bf7=_0x78b1c2<0x3?_0xd7dcba:_0x24791d===null?_0x24791d=Object[_0x2b920e(0x184)](_0xd7dcba,_0x30b5b0):_0x24791d,_0x2d509e;if(typeof Reflect==='object'&&typeof Reflect[_0x2b920e(0x178)]==='function')_0x149bf7=Reflect[_0x2b920e(0x178)](_0x325376,_0xd7dcba,_0x30b5b0,_0x24791d);else{for(var _0x5f424c=_0x325376[_0x2b920e(0x18a)]-0x1;_0x5f424c>=0x0;_0x5f424c--)if(_0x2d509e=_0x325376[_0x5f424c])_0x149bf7=(_0x78b1c2<0x3?_0x2d509e(_0x149bf7):_0x78b1c2>0x3?_0x2d509e(_0xd7dcba,_0x30b5b0,_0x149bf7):_0x2d509e(_0xd7dcba,_0x30b5b0))||_0x149bf7;}return _0x78b1c2>0x3&&_0x149bf7&&Object[_0x2b920e(0x166)](_0xd7dcba,_0x30b5b0,_0x149bf7),_0x149bf7;},__metadata=this&&this[a122_0x140109(0x17b)]||function(_0x317b58,_0x1d1845){const _0x40553e=a122_0x140109;if(typeof Reflect==='object'&&typeof Reflect['metadata']==='function')return Reflect[_0x40553e(0x17c)](_0x317b58,_0x1d1845);},__param=this&&this['__param']||function(_0x4bb1b9,_0x52772b){return function(_0x324dc0,_0x446cb0){_0x52772b(_0x324dc0,_0x446cb0,_0x4bb1b9);};};Object[a122_0x140109(0x166)](exports,a122_0x140109(0x15e),{'value':!![]}),exports['SettingService']=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require('mongoose'),CryptoJS=require(a122_0x140109(0x163)),dayjs=require('dayjs'),crypto_1=require(a122_0x140109(0x16f)),job_1=require(a122_0x140109(0x161)),constants_1=require(a122_0x140109(0x171)),SECRET=a122_0x140109(0x18f);function a122_0x5a52(_0xd981fb,_0x3c166a){const _0x729378=a122_0x7293();return a122_0x5a52=function(_0x5a52a5,_0x331dd5){_0x5a52a5=_0x5a52a5-0x15e;let _0x275542=_0x729378[_0x5a52a5];return _0x275542;},a122_0x5a52(_0xd981fb,_0x3c166a);}function a122_0x7293(){const _0x3345f1=['findFirst','validTo','../common/job','PROCESS_CACHE','crypto-js','create','parse','defineProperty','13746mbiaEm','1197711tBdTxA','killAll','save','log','updateUserSetting','licenseKey','toDate','../common/crypto','2913922ZFyJIS','./constants','decrypt','enc','4147BqYoIg','Setting','toObject','6677645ZThCqQ','decorate','408krAMWq','schoolId','__metadata','metadata','Base64','1918SIYwtp','SettingService','Injectable','759SocZfR','8LwiDqJ','InjectModel','getOwnPropertyDescriptor','update','__decorate','userSetting','_id','exec','length','107964vjtAxs','1TTjXqI','assign','setting','QVBFVFVMT1NCQQ==','validFrom','DD/MM/YYYY','find','validateLicenseKey','settingModel','19030QcRZrb','Model','40938LneLCI','__esModule'];a122_0x7293=function(){return _0x3345f1;};return a122_0x7293();}let SettingService=class SettingService{constructor(_0x2a06f7){const _0x32cbf7=a122_0x140109;this[_0x32cbf7(0x194)]=_0x2a06f7;}async[a122_0x140109(0x164)](_0x37046c){const _0x8f5fc4=a122_0x140109,_0x463395=new this['settingModel'](_0x37046c);return _0x463395[_0x8f5fc4(0x16a)]();}async[a122_0x140109(0x15f)](){const _0x2f4193=a122_0x140109;var _0x306850,_0x2e8171,_0x10b8dd;const _0x3ed4d3=await this[_0x2f4193(0x194)][_0x2f4193(0x192)]()[_0x2f4193(0x189)](),_0x5dd4b8=(_0x306850=_0x3ed4d3[0x0])===null||_0x306850===void 0x0?void 0x0:_0x306850[_0x2f4193(0x176)]();if(!_0x5dd4b8)return;return Object[_0x2f4193(0x18d)](Object[_0x2f4193(0x18d)]({},_0x5dd4b8),{'userSetting':Object[_0x2f4193(0x18d)](Object[_0x2f4193(0x18d)]({},_0x5dd4b8['userSetting']),{'maxUser':(_0x10b8dd=(_0x2e8171=_0x5dd4b8[_0x2f4193(0x187)])===null||_0x2e8171===void 0x0?void 0x0:_0x2e8171['maxUser'])!==null&&_0x10b8dd!==void 0x0?_0x10b8dd:constants_1['DEFAULT_MAX_USER']})});}async[a122_0x140109(0x185)](_0x3597a7,_0x549b1c){const _0x272aaf=a122_0x140109,_0x2b1298=await this[_0x272aaf(0x194)]['findByIdAndUpdate'](_0x3597a7,Object[_0x272aaf(0x18d)](Object['assign']({},_0x549b1c),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x272aaf(0x189)]();return _0x2b1298;}async['updateExpiryStatus'](){const _0x17119e=a122_0x140109,_0x388f83=await this[_0x17119e(0x15f)](),_0x501539=this[_0x17119e(0x193)](_0x388f83[_0x17119e(0x16d)],_0x388f83[_0x17119e(0x17a)]);return this[_0x17119e(0x185)](_0x388f83[_0x17119e(0x188)],{'isExpired':!_0x501539['isValid']});}async[a122_0x140109(0x16c)](_0x393eed){const _0x40ee55=a122_0x140109,_0x3d62a4=await this[_0x40ee55(0x15f)]();return console[_0x40ee55(0x16b)](_0x3d62a4,_0x40ee55(0x18e)),this[_0x40ee55(0x185)](_0x3d62a4[_0x40ee55(0x188)],{'userSetting':_0x393eed});}['validateLicenseKey'](_0x25065b,_0x3acf10){const _0xc1532f=a122_0x140109;try{if(!_0x25065b)return{'isValid':![],'expiryDate':''};const _0x2fc119=(0x0,crypto_1[_0xc1532f(0x172)])(_0x25065b,CryptoJS[_0xc1532f(0x173)][_0xc1532f(0x17d)][_0xc1532f(0x165)](SECRET)['toString'](CryptoJS[_0xc1532f(0x173)]['Utf8']));if(_0x2fc119[_0xc1532f(0x17a)]!==_0x3acf10)return{'isValid':![],'expiryDate':''};const _0x86d1d0=dayjs(_0x2fc119[_0xc1532f(0x190)],_0xc1532f(0x191))[_0xc1532f(0x16e)](),_0x326b6c=dayjs(_0x2fc119[_0xc1532f(0x160)],_0xc1532f(0x191))[_0xc1532f(0x16e)](),_0x1dad03=dayjs()['toDate']();if(_0x1dad03<_0x86d1d0||_0x1dad03>_0x326b6c)return{'isValid':![],'expiryDate':_0x2fc119['validTo']};return{'isValid':!![],'expiryDate':_0x2fc119[_0xc1532f(0x160)]};}catch(_0xdfd305){return{'isValid':![],'expiryDate':''};}}async['killJobs'](){const _0x58c6be=a122_0x140109;job_1[_0x58c6be(0x162)][_0x58c6be(0x169)]();}};SettingService=__decorate([(0x0,common_1[a122_0x140109(0x180)])(),__param(0x0,(0x0,mongoose_1[a122_0x140109(0x183)])(a122_0x140109(0x175))),__metadata('design:paramtypes',[mongoose_2[a122_0x140109(0x196)]])],SettingService),exports[a122_0x140109(0x17f)]=SettingService;