'use strict';const a122_0x4e5167=a122_0x4a97;(function(_0x247d7a,_0xb8fd22){const _0x59463b=a122_0x4a97,_0x1b92d9=_0x247d7a();while(!![]){try{const _0x314d3c=parseInt(_0x59463b(0x168))/0x1*(parseInt(_0x59463b(0x196))/0x2)+parseInt(_0x59463b(0x174))/0x3+-parseInt(_0x59463b(0x195))/0x4+-parseInt(_0x59463b(0x17c))/0x5+-parseInt(_0x59463b(0x18f))/0x6*(-parseInt(_0x59463b(0x17f))/0x7)+-parseInt(_0x59463b(0x178))/0x8*(-parseInt(_0x59463b(0x159))/0x9)+-parseInt(_0x59463b(0x15b))/0xa*(-parseInt(_0x59463b(0x16a))/0xb);if(_0x314d3c===_0xb8fd22)break;else _0x1b92d9['push'](_0x1b92d9['shift']());}catch(_0x3eb25f){_0x1b92d9['push'](_0x1b92d9['shift']());}}}(a122_0x592a,0xa2290));var __decorate=this&&this[a122_0x4e5167(0x161)]||function(_0x10eafd,_0x4a7c11,_0x55306c,_0x1dee00){const _0x40be3b=a122_0x4e5167;var _0x15c1a6=arguments[_0x40be3b(0x18e)],_0x580ff8=_0x15c1a6<0x3?_0x4a7c11:_0x1dee00===null?_0x1dee00=Object[_0x40be3b(0x170)](_0x4a7c11,_0x55306c):_0x1dee00,_0xee168;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x580ff8=Reflect[_0x40be3b(0x173)](_0x10eafd,_0x4a7c11,_0x55306c,_0x1dee00);else{for(var _0x529059=_0x10eafd[_0x40be3b(0x18e)]-0x1;_0x529059>=0x0;_0x529059--)if(_0xee168=_0x10eafd[_0x529059])_0x580ff8=(_0x15c1a6<0x3?_0xee168(_0x580ff8):_0x15c1a6>0x3?_0xee168(_0x4a7c11,_0x55306c,_0x580ff8):_0xee168(_0x4a7c11,_0x55306c))||_0x580ff8;}return _0x15c1a6>0x3&&_0x580ff8&&Object[_0x40be3b(0x198)](_0x4a7c11,_0x55306c,_0x580ff8),_0x580ff8;},__metadata=this&&this[a122_0x4e5167(0x16f)]||function(_0x59acf0,_0x154084){const _0x1947c3=a122_0x4e5167;if(typeof Reflect===_0x1947c3(0x189)&&typeof Reflect[_0x1947c3(0x197)]===_0x1947c3(0x182))return Reflect[_0x1947c3(0x197)](_0x59acf0,_0x154084);},__param=this&&this[a122_0x4e5167(0x188)]||function(_0x3d0ac1,_0x3942a2){return function(_0x31dca7,_0x2238c1){_0x3942a2(_0x31dca7,_0x2238c1,_0x3d0ac1);};};Object[a122_0x4e5167(0x198)](exports,a122_0x4e5167(0x17e),{'value':!![]}),exports['SettingService']=void 0x0;function a122_0x592a(){const _0x3e934b=['__param','object','@nestjs/mongoose','Model','findByIdAndUpdate','toDate','length','20814cMyixu','setting','SettingService','schoolId','../common/crypto','validTo','4729496RMAPlp','2QYEijC','metadata','defineProperty','597879jnTNoB','@nestjs/common','35110rgyDjn','InjectModel','decrypt','toString','settingModel','killJobs','__decorate','crypto-js','../common/job','toObject','PROCESS_CACHE','design:paramtypes','dayjs','935447SeNhcx','maxUser','286fvfjBq','Injectable','./constants','save','DD/MM/YYYY','__metadata','getOwnPropertyDescriptor','findFirst','killAll','decorate','2151459fYgYLW','assign','Base64','update','40rfMfjO','_id','parse','QVBFVFVMT1NCQQ==','4772400rypjbi','mongoose','__esModule','1463aDnGKi','enc','exec','function','DEFAULT_MAX_USER','log','licenseKey','validFrom','userSetting'];a122_0x592a=function(){return _0x3e934b;};return a122_0x592a();}function a122_0x4a97(_0x5d5d15,_0x4c4735){const _0x592a32=a122_0x592a();return a122_0x4a97=function(_0x4a97b1,_0x49f0fe){_0x4a97b1=_0x4a97b1-0x159;let _0x2fe875=_0x592a32[_0x4a97b1];return _0x2fe875;},a122_0x4a97(_0x5d5d15,_0x4c4735);}const common_1=require(a122_0x4e5167(0x15a)),mongoose_1=require(a122_0x4e5167(0x18a)),mongoose_2=require(a122_0x4e5167(0x17d)),CryptoJS=require(a122_0x4e5167(0x162)),dayjs=require(a122_0x4e5167(0x167)),crypto_1=require(a122_0x4e5167(0x193)),job_1=require(a122_0x4e5167(0x163)),constants_1=require(a122_0x4e5167(0x16c)),SECRET=a122_0x4e5167(0x17b);let SettingService=class SettingService{constructor(_0x23c9ad){const _0x22d1c5=a122_0x4e5167;this[_0x22d1c5(0x15f)]=_0x23c9ad;}async['create'](_0x21eb8f){const _0x49420e=a122_0x4e5167,_0x41f260=new this[(_0x49420e(0x15f))](_0x21eb8f);return _0x41f260[_0x49420e(0x16d)]();}async[a122_0x4e5167(0x171)](){const _0x5bb05f=a122_0x4e5167;var _0x44fd69,_0x174ad2,_0xbe8739;const _0x1d4179=await this[_0x5bb05f(0x15f)]['find']()[_0x5bb05f(0x181)](),_0x586a31=(_0x44fd69=_0x1d4179[0x0])===null||_0x44fd69===void 0x0?void 0x0:_0x44fd69[_0x5bb05f(0x164)]();if(!_0x586a31)return;return Object[_0x5bb05f(0x175)](Object[_0x5bb05f(0x175)]({},_0x586a31),{'userSetting':Object[_0x5bb05f(0x175)](Object[_0x5bb05f(0x175)]({},_0x586a31[_0x5bb05f(0x187)]),{'maxUser':(_0xbe8739=(_0x174ad2=_0x586a31[_0x5bb05f(0x187)])===null||_0x174ad2===void 0x0?void 0x0:_0x174ad2[_0x5bb05f(0x169)])!==null&&_0xbe8739!==void 0x0?_0xbe8739:constants_1[_0x5bb05f(0x183)]})});}async[a122_0x4e5167(0x177)](_0x5cf346,_0x123119){const _0x5d6f17=a122_0x4e5167,_0x458d12=await this[_0x5d6f17(0x15f)][_0x5d6f17(0x18c)](_0x5cf346,Object[_0x5d6f17(0x175)](Object[_0x5d6f17(0x175)]({},_0x123119),{'updatedAtUtc':new Date()}),{'new':!![]})['exec']();return _0x458d12;}async['updateExpiryStatus'](){const _0x2c4823=a122_0x4e5167,_0x150681=await this[_0x2c4823(0x171)](),_0x18ee7c=this['validateLicenseKey'](_0x150681[_0x2c4823(0x185)],_0x150681[_0x2c4823(0x192)]);return this[_0x2c4823(0x177)](_0x150681[_0x2c4823(0x179)],{'isExpired':!_0x18ee7c['isValid']});}async['updateUserSetting'](_0x2cf91f){const _0x31eb7c=a122_0x4e5167,_0x1e1f7f=await this['findFirst']();return console[_0x31eb7c(0x184)](_0x1e1f7f,_0x31eb7c(0x190)),this[_0x31eb7c(0x177)](_0x1e1f7f[_0x31eb7c(0x179)],{'userSetting':_0x2cf91f});}['validateLicenseKey'](_0x580efb,_0x50941b){const _0x20ce47=a122_0x4e5167;try{if(!_0x580efb)return{'isValid':![],'expiryDate':''};const _0x3e90d4=(0x0,crypto_1[_0x20ce47(0x15d)])(_0x580efb,CryptoJS[_0x20ce47(0x180)][_0x20ce47(0x176)][_0x20ce47(0x17a)](SECRET)[_0x20ce47(0x15e)](CryptoJS[_0x20ce47(0x180)]['Utf8']));if(_0x3e90d4['schoolId']!==_0x50941b)return{'isValid':![],'expiryDate':''};const _0xd724a=dayjs(_0x3e90d4[_0x20ce47(0x186)],'DD/MM/YYYY')[_0x20ce47(0x18d)](),_0x509361=dayjs(_0x3e90d4[_0x20ce47(0x194)],_0x20ce47(0x16e))[_0x20ce47(0x18d)](),_0x3c9b51=dayjs()[_0x20ce47(0x18d)]();if(_0x3c9b51<_0xd724a||_0x3c9b51>_0x509361)return{'isValid':![],'expiryDate':_0x3e90d4[_0x20ce47(0x194)]};return{'isValid':!![],'expiryDate':_0x3e90d4[_0x20ce47(0x194)]};}catch(_0x3fb6a9){return{'isValid':![],'expiryDate':''};}}async[a122_0x4e5167(0x160)](){const _0x1e1606=a122_0x4e5167;job_1[_0x1e1606(0x165)][_0x1e1606(0x172)]();}};SettingService=__decorate([(0x0,common_1[a122_0x4e5167(0x16b)])(),__param(0x0,(0x0,mongoose_1[a122_0x4e5167(0x15c)])('Setting')),__metadata(a122_0x4e5167(0x166),[mongoose_2[a122_0x4e5167(0x18b)]])],SettingService),exports[a122_0x4e5167(0x191)]=SettingService;