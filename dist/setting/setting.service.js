'use strict';const a122_0x42249a=a122_0x3352;function a122_0x3352(_0x484b79,_0x587aed){const _0x46c9b5=a122_0x46c9();return a122_0x3352=function(_0x335274,_0x441f01){_0x335274=_0x335274-0xcf;let _0x5805da=_0x46c9b5[_0x335274];return _0x5805da;},a122_0x3352(_0x484b79,_0x587aed);}(function(_0x350afc,_0x578514){const _0x235852=a122_0x3352,_0xaefc5c=_0x350afc();while(!![]){try{const _0x1a2105=-parseInt(_0x235852(0xe7))/0x1+-parseInt(_0x235852(0xea))/0x2*(-parseInt(_0x235852(0xdf))/0x3)+-parseInt(_0x235852(0xf5))/0x4*(-parseInt(_0x235852(0xf3))/0x5)+-parseInt(_0x235852(0xfe))/0x6+-parseInt(_0x235852(0xe9))/0x7+-parseInt(_0x235852(0xdc))/0x8+parseInt(_0x235852(0xee))/0x9;if(_0x1a2105===_0x578514)break;else _0xaefc5c['push'](_0xaefc5c['shift']());}catch(_0x1dad81){_0xaefc5c['push'](_0xaefc5c['shift']());}}}(a122_0x46c9,0xd6c7a));var __decorate=this&&this[a122_0x42249a(0xd5)]||function(_0xbd69ba,_0x1759ce,_0x5804f4,_0x4abaa1){const _0x26e956=a122_0x42249a;var _0x25e241=arguments[_0x26e956(0xf9)],_0x12fac2=_0x25e241<0x3?_0x1759ce:_0x4abaa1===null?_0x4abaa1=Object[_0x26e956(0x101)](_0x1759ce,_0x5804f4):_0x4abaa1,_0x438de5;if(typeof Reflect===_0x26e956(0xeb)&&typeof Reflect['decorate']===_0x26e956(0xf2))_0x12fac2=Reflect[_0x26e956(0xf7)](_0xbd69ba,_0x1759ce,_0x5804f4,_0x4abaa1);else{for(var _0x37050f=_0xbd69ba[_0x26e956(0xf9)]-0x1;_0x37050f>=0x0;_0x37050f--)if(_0x438de5=_0xbd69ba[_0x37050f])_0x12fac2=(_0x25e241<0x3?_0x438de5(_0x12fac2):_0x25e241>0x3?_0x438de5(_0x1759ce,_0x5804f4,_0x12fac2):_0x438de5(_0x1759ce,_0x5804f4))||_0x12fac2;}return _0x25e241>0x3&&_0x12fac2&&Object[_0x26e956(0x107)](_0x1759ce,_0x5804f4,_0x12fac2),_0x12fac2;},__metadata=this&&this[a122_0x42249a(0xe5)]||function(_0x3a1f19,_0x50496a){const _0x26f382=a122_0x42249a;if(typeof Reflect===_0x26f382(0xeb)&&typeof Reflect[_0x26f382(0xd9)]===_0x26f382(0xf2))return Reflect[_0x26f382(0xd9)](_0x3a1f19,_0x50496a);},__param=this&&this[a122_0x42249a(0xec)]||function(_0x2f39a3,_0x42cff7){return function(_0x2a7ab3,_0x20543a){_0x42cff7(_0x2a7ab3,_0x20543a,_0x2f39a3);};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a122_0x42249a(0x10a)]=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a122_0x42249a(0x103)),mongoose_2=require(a122_0x42249a(0xfb)),CryptoJS=require(a122_0x42249a(0xe2)),dayjs=require(a122_0x42249a(0xf0)),crypto_1=require('../common/crypto'),job_1=require(a122_0x42249a(0x105)),constants_1=require(a122_0x42249a(0x104)),SECRET='QVBFVFVMT1NCQQ==';let SettingService=class SettingService{constructor(_0xd632ef){const _0xcbe78c=a122_0x42249a;this[_0xcbe78c(0xf8)]=_0xd632ef;}async[a122_0x42249a(0xd7)](_0x45af99){const _0x2f2962=a122_0x42249a,_0xd8fe99=new this[(_0x2f2962(0xf8))](_0x45af99);return _0xd8fe99[_0x2f2962(0xdd)]();}async[a122_0x42249a(0x108)](){const _0x1fdd8f=a122_0x42249a;var _0x1843e,_0x3cfc4b,_0x50277b;const _0xb3285c=await this[_0x1fdd8f(0xf8)][_0x1fdd8f(0xe6)]()[_0x1fdd8f(0xd1)](),_0x29e3e5=(_0x1843e=_0xb3285c[0x0])===null||_0x1843e===void 0x0?void 0x0:_0x1843e[_0x1fdd8f(0xde)]();if(!_0x29e3e5)return;return Object['assign'](Object['assign']({},_0x29e3e5),{'userSetting':Object[_0x1fdd8f(0xcf)](Object['assign']({},_0x29e3e5[_0x1fdd8f(0x106)]),{'maxUser':(_0x50277b=(_0x3cfc4b=_0x29e3e5[_0x1fdd8f(0x106)])===null||_0x3cfc4b===void 0x0?void 0x0:_0x3cfc4b[_0x1fdd8f(0xff)])!==null&&_0x50277b!==void 0x0?_0x50277b:constants_1['DEFAULT_MAX_USER']})});}async[a122_0x42249a(0xd4)](_0x26b394,_0x23b13c){const _0x346cf5=a122_0x42249a,_0x391654=await this[_0x346cf5(0xf8)][_0x346cf5(0xfc)](_0x26b394,Object[_0x346cf5(0xcf)](Object[_0x346cf5(0xcf)]({},_0x23b13c),{'updatedAtUtc':new Date()}),{'new':!![]})['exec']();return _0x391654;}async['updateExpiryStatus'](){const _0x51a9cb=a122_0x42249a,_0x4a7af1=await this[_0x51a9cb(0x108)](),_0x518fda=this[_0x51a9cb(0xf6)](_0x4a7af1[_0x51a9cb(0xda)],_0x4a7af1['schoolId']);return this[_0x51a9cb(0xd4)](_0x4a7af1['_id'],{'isExpired':!_0x518fda['isValid']});}async[a122_0x42249a(0xd2)](_0x3d3109){const _0x1f10d7=a122_0x42249a,_0x14129d=await this[_0x1f10d7(0x108)]();return console[_0x1f10d7(0xdb)](_0x14129d,_0x1f10d7(0xd6)),this['update'](_0x14129d[_0x1f10d7(0xe1)],{'userSetting':_0x3d3109});}[a122_0x42249a(0xf6)](_0x3cdf5c,_0x24b758){const _0x343bdd=a122_0x42249a;try{if(!_0x3cdf5c)return{'isValid':![],'expiryDate':''};const _0x2ab6dc=(0x0,crypto_1[_0x343bdd(0x109)])(_0x3cdf5c,CryptoJS['enc'][_0x343bdd(0xe8)][_0x343bdd(0xe4)](SECRET)[_0x343bdd(0xe3)](CryptoJS[_0x343bdd(0xfd)]['Utf8']));if(_0x2ab6dc[_0x343bdd(0xed)]!==_0x24b758)return{'isValid':![],'expiryDate':''};const _0x361715=dayjs(_0x2ab6dc[_0x343bdd(0xd0)],_0x343bdd(0xe0))[_0x343bdd(0xd8)](),_0x4d96f0=dayjs(_0x2ab6dc['validTo'],_0x343bdd(0xe0))[_0x343bdd(0xd8)](),_0x1084d4=dayjs()[_0x343bdd(0xd8)]();if(_0x1084d4<_0x361715||_0x1084d4>_0x4d96f0)return{'isValid':![],'expiryDate':_0x2ab6dc[_0x343bdd(0xf4)]};return{'isValid':!![],'expiryDate':_0x2ab6dc[_0x343bdd(0xf4)]};}catch(_0x23e7ad){return{'isValid':![],'expiryDate':''};}}async[a122_0x42249a(0xef)](){const _0x58f530=a122_0x42249a;job_1[_0x58f530(0xd3)][_0x58f530(0x100)]();}};function a122_0x46c9(){const _0x9ec9cb=['userSetting','defineProperty','findFirst','decrypt','SettingService','assign','validFrom','exec','updateUserSetting','PROCESS_CACHE','update','__decorate','setting','create','toDate','metadata','licenseKey','log','6758032qaNbpy','save','toObject','3jUCHjt','DD/MM/YYYY','_id','crypto-js','toString','parse','__metadata','find','37642GekQaJ','Base64','12125673fBhOFW','97010ESbBOi','object','__param','schoolId','33554619pmKTUe','killJobs','dayjs','design:paramtypes','function','145unDFWw','validTo','149628bJmXLb','validateLicenseKey','decorate','settingModel','length','InjectModel','mongoose','findByIdAndUpdate','enc','8203356AoGUNw','maxUser','killAll','getOwnPropertyDescriptor','Injectable','@nestjs/mongoose','./constants','../common/job'];a122_0x46c9=function(){return _0x9ec9cb;};return a122_0x46c9();}SettingService=__decorate([(0x0,common_1[a122_0x42249a(0x102)])(),__param(0x0,(0x0,mongoose_1[a122_0x42249a(0xfa)])('Setting')),__metadata(a122_0x42249a(0xf1),[mongoose_2['Model']])],SettingService),exports[a122_0x42249a(0x10a)]=SettingService;