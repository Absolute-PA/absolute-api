'use strict';const a125_0xec16bc=a125_0xb2c2;(function(_0x5d68c7,_0xc0776){const _0x586d3c=a125_0xb2c2,_0x398cc9=_0x5d68c7();while(!![]){try{const _0x5a065c=-parseInt(_0x586d3c(0x99))/0x1+parseInt(_0x586d3c(0xa2))/0x2*(parseInt(_0x586d3c(0xba))/0x3)+parseInt(_0x586d3c(0x88))/0x4*(-parseInt(_0x586d3c(0x8e))/0x5)+parseInt(_0x586d3c(0x9a))/0x6+-parseInt(_0x586d3c(0xa5))/0x7+parseInt(_0x586d3c(0xa3))/0x8+parseInt(_0x586d3c(0xb5))/0x9;if(_0x5a065c===_0xc0776)break;else _0x398cc9['push'](_0x398cc9['shift']());}catch(_0x302ae8){_0x398cc9['push'](_0x398cc9['shift']());}}}(a125_0x4d03,0xc21cc));var __decorate=this&&this['__decorate']||function(_0x557de2,_0x2c96b8,_0x21f2e9,_0x45a50b){const _0x24f160=a125_0xb2c2;var _0x141012=arguments[_0x24f160(0xb9)],_0x36dc0f=_0x141012<0x3?_0x2c96b8:_0x45a50b===null?_0x45a50b=Object['getOwnPropertyDescriptor'](_0x2c96b8,_0x21f2e9):_0x45a50b,_0x310dab;if(typeof Reflect===_0x24f160(0x8a)&&typeof Reflect[_0x24f160(0xaf)]===_0x24f160(0xb3))_0x36dc0f=Reflect['decorate'](_0x557de2,_0x2c96b8,_0x21f2e9,_0x45a50b);else{for(var _0x1dd95e=_0x557de2['length']-0x1;_0x1dd95e>=0x0;_0x1dd95e--)if(_0x310dab=_0x557de2[_0x1dd95e])_0x36dc0f=(_0x141012<0x3?_0x310dab(_0x36dc0f):_0x141012>0x3?_0x310dab(_0x2c96b8,_0x21f2e9,_0x36dc0f):_0x310dab(_0x2c96b8,_0x21f2e9))||_0x36dc0f;}return _0x141012>0x3&&_0x36dc0f&&Object[_0x24f160(0x90)](_0x2c96b8,_0x21f2e9,_0x36dc0f),_0x36dc0f;},__metadata=this&&this['__metadata']||function(_0x15c2c4,_0x41d4bf){const _0x34cf26=a125_0xb2c2;if(typeof Reflect===_0x34cf26(0x8a)&&typeof Reflect[_0x34cf26(0xbb)]===_0x34cf26(0xb3))return Reflect['metadata'](_0x15c2c4,_0x41d4bf);},__param=this&&this[a125_0xec16bc(0x97)]||function(_0x13bb16,_0x39b179){return function(_0x1e3134,_0xcd8005){_0x39b179(_0x1e3134,_0xcd8005,_0x13bb16);};};Object[a125_0xec16bc(0x90)](exports,'__esModule',{'value':!![]}),exports['SettingService']=void 0x0;function a125_0xb2c2(_0x52a3a0,_0x51c165){const _0x4d03d5=a125_0x4d03();return a125_0xb2c2=function(_0xb2c2d7,_0x1eb21b){_0xb2c2d7=_0xb2c2d7-0x88;let _0x455975=_0x4d03d5[_0xb2c2d7];return _0x455975;},a125_0xb2c2(_0x52a3a0,_0x51c165);}const common_1=require(a125_0xec16bc(0x96)),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require('mongoose'),CryptoJS=require(a125_0xec16bc(0xa7)),dayjs=require(a125_0xec16bc(0xbe)),crypto_1=require('../common/crypto'),job_1=require(a125_0xec16bc(0xb1)),constants_1=require(a125_0xec16bc(0x9f)),SECRET='QVBFVFVMT1NCQQ==';let SettingService=class SettingService{constructor(_0x58851e){const _0x224ad2=a125_0xec16bc;this[_0x224ad2(0x98)]=_0x58851e;}async[a125_0xec16bc(0x8f)](_0x256d56){const _0x3fc324=a125_0xec16bc,_0x4307e3=new this[(_0x3fc324(0x98))](_0x256d56);return _0x4307e3['save']();}async[a125_0xec16bc(0xa0)](){const _0x3a609b=a125_0xec16bc;var _0x19013a,_0x1b1a4b,_0x2b0a27;const _0x6b86ef=await this[_0x3a609b(0x98)][_0x3a609b(0x94)]()[_0x3a609b(0xad)](),_0x263f66=(_0x19013a=_0x6b86ef[0x0])===null||_0x19013a===void 0x0?void 0x0:_0x19013a[_0x3a609b(0xac)]();if(!_0x263f66)return;return Object['assign'](Object['assign']({},_0x263f66),{'userSetting':Object['assign'](Object[_0x3a609b(0xb6)]({},_0x263f66[_0x3a609b(0xbd)]),{'maxUser':(_0x2b0a27=(_0x1b1a4b=_0x263f66['userSetting'])===null||_0x1b1a4b===void 0x0?void 0x0:_0x1b1a4b[_0x3a609b(0xb0)])!==null&&_0x2b0a27!==void 0x0?_0x2b0a27:constants_1[_0x3a609b(0xa9)]})});}async[a125_0xec16bc(0xb4)](_0x285147,_0x5724f9){const _0x1351b0=a125_0xec16bc,_0xb434fd=await this['settingModel'][_0x1351b0(0x8b)](_0x285147,Object[_0x1351b0(0xb6)](Object[_0x1351b0(0xb6)]({},_0x5724f9),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x1351b0(0xad)]();return _0xb434fd;}async['updateExpiryStatus'](){const _0xae3d91=a125_0xec16bc,_0x36f997=await this['findFirst'](),_0x109bcb=this['validateLicenseKey'](_0x36f997[_0xae3d91(0x95)],_0x36f997['schoolId']);return this[_0xae3d91(0xb4)](_0x36f997[_0xae3d91(0xb8)],{'isExpired':!_0x109bcb[_0xae3d91(0x8c)]});}async[a125_0xec16bc(0xbc)](_0x4a8794){const _0x50a1c8=a125_0xec16bc,_0x163b19=await this[_0x50a1c8(0xa0)]();return console[_0x50a1c8(0x9d)](_0x163b19,_0x50a1c8(0x89)),this[_0x50a1c8(0xb4)](_0x163b19['_id'],{'userSetting':_0x4a8794});}['validateLicenseKey'](_0x56ff44,_0x1fae22){const _0x1f4a6f=a125_0xec16bc;try{if(!_0x56ff44)return{'isValid':![],'expiryDate':''};const _0x3b96f2=(0x0,crypto_1['decrypt'])(_0x56ff44,CryptoJS[_0x1f4a6f(0x93)][_0x1f4a6f(0x9e)]['parse'](SECRET)['toString'](CryptoJS[_0x1f4a6f(0x93)][_0x1f4a6f(0x9c)]));if(_0x3b96f2[_0x1f4a6f(0xa4)]!==_0x1fae22)return{'isValid':![],'expiryDate':''};const _0x107c01=dayjs(_0x3b96f2[_0x1f4a6f(0x91)],_0x1f4a6f(0xab))[_0x1f4a6f(0xb2)](),_0xed9b1e=dayjs(_0x3b96f2[_0x1f4a6f(0xb7)],_0x1f4a6f(0xab))[_0x1f4a6f(0xb2)](),_0x3413c9=dayjs()[_0x1f4a6f(0xb2)]();if(_0x3413c9<_0x107c01||_0x3413c9>_0xed9b1e)return{'isValid':![],'expiryDate':_0x3b96f2[_0x1f4a6f(0xb7)]};return{'isValid':!![],'expiryDate':_0x3b96f2['validTo']};}catch(_0x40930d){return{'isValid':![],'expiryDate':''};}}async[a125_0xec16bc(0x9b)](){const _0x26862d=a125_0xec16bc;job_1[_0x26862d(0xa1)][_0x26862d(0xa8)]();}};function a125_0x4d03(){const _0x506264=['Model','10qwmQcm','create','defineProperty','validFrom','SettingService','enc','find','licenseKey','@nestjs/common','__param','settingModel','1072301ndASDe','4476486CnHvyh','killJobs','Utf8','log','Base64','./constants','findFirst','PROCESS_CACHE','2108xBtiSt','2734504bDPgCb','schoolId','7428232nOZrYx','design:paramtypes','crypto-js','killAll','DEFAULT_MAX_USER','Setting','DD/MM/YYYY','toObject','exec','Injectable','decorate','maxUser','../common/job','toDate','function','update','20030229WNqfAX','assign','validTo','_id','length','1380ANdgIO','metadata','updateUserSetting','userSetting','dayjs','1739508sATbnt','setting','object','findByIdAndUpdate','isValid'];a125_0x4d03=function(){return _0x506264;};return a125_0x4d03();}SettingService=__decorate([(0x0,common_1[a125_0xec16bc(0xae)])(),__param(0x0,(0x0,mongoose_1['InjectModel'])(a125_0xec16bc(0xaa))),__metadata(a125_0xec16bc(0xa6),[mongoose_2[a125_0xec16bc(0x8d)]])],SettingService),exports[a125_0xec16bc(0x92)]=SettingService;