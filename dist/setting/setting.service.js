'use strict';const a122_0x38e6b0=a122_0x53ef;(function(_0x20ed8a,_0x11924e){const _0x18ad74=a122_0x53ef,_0x594b5f=_0x20ed8a();while(!![]){try{const _0x54cf2b=-parseInt(_0x18ad74(0x178))/0x1*(parseInt(_0x18ad74(0x169))/0x2)+-parseInt(_0x18ad74(0x154))/0x3*(parseInt(_0x18ad74(0x175))/0x4)+-parseInt(_0x18ad74(0x177))/0x5+-parseInt(_0x18ad74(0x141))/0x6*(-parseInt(_0x18ad74(0x16e))/0x7)+parseInt(_0x18ad74(0x158))/0x8*(parseInt(_0x18ad74(0x157))/0x9)+parseInt(_0x18ad74(0x146))/0xa+parseInt(_0x18ad74(0x17e))/0xb;if(_0x54cf2b===_0x11924e)break;else _0x594b5f['push'](_0x594b5f['shift']());}catch(_0x174a26){_0x594b5f['push'](_0x594b5f['shift']());}}}(a122_0x3e34,0xe7e05));var __decorate=this&&this[a122_0x38e6b0(0x167)]||function(_0x383051,_0x2c45a5,_0x823bbb,_0x5d1d3f){const _0x3d2fe0=a122_0x38e6b0;var _0x2016f3=arguments[_0x3d2fe0(0x15d)],_0x2d88d2=_0x2016f3<0x3?_0x2c45a5:_0x5d1d3f===null?_0x5d1d3f=Object[_0x3d2fe0(0x14a)](_0x2c45a5,_0x823bbb):_0x5d1d3f,_0x158e21;if(typeof Reflect===_0x3d2fe0(0x165)&&typeof Reflect[_0x3d2fe0(0x176)]===_0x3d2fe0(0x162))_0x2d88d2=Reflect[_0x3d2fe0(0x176)](_0x383051,_0x2c45a5,_0x823bbb,_0x5d1d3f);else{for(var _0x4f2df0=_0x383051['length']-0x1;_0x4f2df0>=0x0;_0x4f2df0--)if(_0x158e21=_0x383051[_0x4f2df0])_0x2d88d2=(_0x2016f3<0x3?_0x158e21(_0x2d88d2):_0x2016f3>0x3?_0x158e21(_0x2c45a5,_0x823bbb,_0x2d88d2):_0x158e21(_0x2c45a5,_0x823bbb))||_0x2d88d2;}return _0x2016f3>0x3&&_0x2d88d2&&Object['defineProperty'](_0x2c45a5,_0x823bbb,_0x2d88d2),_0x2d88d2;},__metadata=this&&this[a122_0x38e6b0(0x173)]||function(_0x431a7c,_0xabc033){const _0x4b5750=a122_0x38e6b0;if(typeof Reflect===_0x4b5750(0x165)&&typeof Reflect[_0x4b5750(0x15e)]===_0x4b5750(0x162))return Reflect[_0x4b5750(0x15e)](_0x431a7c,_0xabc033);},__param=this&&this[a122_0x38e6b0(0x142)]||function(_0x3a40f9,_0x3e656a){return function(_0x21cae9,_0x1dfc34){_0x3e656a(_0x21cae9,_0x1dfc34,_0x3a40f9);};};Object[a122_0x38e6b0(0x151)](exports,a122_0x38e6b0(0x17a),{'value':!![]}),exports[a122_0x38e6b0(0x17f)]=void 0x0;function a122_0x53ef(_0x550caa,_0x551ea0){const _0x3e34f2=a122_0x3e34();return a122_0x53ef=function(_0x53efaf,_0x56dee8){_0x53efaf=_0x53efaf-0x141;let _0x52a3bb=_0x3e34f2[_0x53efaf];return _0x52a3bb;},a122_0x53ef(_0x550caa,_0x551ea0);}const common_1=require(a122_0x38e6b0(0x145)),mongoose_1=require(a122_0x38e6b0(0x14f)),mongoose_2=require(a122_0x38e6b0(0x144)),CryptoJS=require(a122_0x38e6b0(0x16d)),dayjs=require(a122_0x38e6b0(0x166)),crypto_1=require(a122_0x38e6b0(0x14b)),job_1=require(a122_0x38e6b0(0x155)),constants_1=require(a122_0x38e6b0(0x159)),SECRET='QVBFVFVMT1NCQQ==';let SettingService=class SettingService{constructor(_0xf33be5){const _0x6757a2=a122_0x38e6b0;this[_0x6757a2(0x147)]=_0xf33be5;}async[a122_0x38e6b0(0x171)](_0x4d7def){const _0x54c497=new this['settingModel'](_0x4d7def);return _0x54c497['save']();}async[a122_0x38e6b0(0x174)](){const _0x4fd93e=a122_0x38e6b0;var _0x4311ad,_0x1bc069,_0x30e1f9;const _0x2dee38=await this[_0x4fd93e(0x147)][_0x4fd93e(0x150)]()[_0x4fd93e(0x15b)](),_0x2db158=(_0x4311ad=_0x2dee38[0x0])===null||_0x4311ad===void 0x0?void 0x0:_0x4311ad[_0x4fd93e(0x168)]();if(!_0x2db158)return;return Object['assign'](Object[_0x4fd93e(0x16f)]({},_0x2db158),{'userSetting':Object['assign'](Object['assign']({},_0x2db158[_0x4fd93e(0x161)]),{'maxUser':(_0x30e1f9=(_0x1bc069=_0x2db158['userSetting'])===null||_0x1bc069===void 0x0?void 0x0:_0x1bc069[_0x4fd93e(0x156)])!==null&&_0x30e1f9!==void 0x0?_0x30e1f9:constants_1[_0x4fd93e(0x153)]})});}async[a122_0x38e6b0(0x17d)](_0x48ba3b,_0x348710){const _0x13b524=a122_0x38e6b0,_0x382422=await this[_0x13b524(0x147)]['findByIdAndUpdate'](_0x48ba3b,Object[_0x13b524(0x16f)](Object[_0x13b524(0x16f)]({},_0x348710),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x13b524(0x15b)]();return _0x382422;}async[a122_0x38e6b0(0x16b)](){const _0x517f18=a122_0x38e6b0,_0x55b0cf=await this[_0x517f18(0x174)](),_0x3a2b4e=this[_0x517f18(0x14e)](_0x55b0cf[_0x517f18(0x16c)],_0x55b0cf['schoolId']);return this[_0x517f18(0x17d)](_0x55b0cf['_id'],{'isExpired':!_0x3a2b4e[_0x517f18(0x16a)]});}async[a122_0x38e6b0(0x17b)](_0x551d17){const _0xa6d0f0=a122_0x38e6b0,_0x2eaf54=await this[_0xa6d0f0(0x174)]();return console[_0xa6d0f0(0x14d)](_0x2eaf54,_0xa6d0f0(0x163)),this[_0xa6d0f0(0x17d)](_0x2eaf54[_0xa6d0f0(0x143)],{'userSetting':_0x551d17});}[a122_0x38e6b0(0x14e)](_0x2bb276,_0x3cdb20){const _0x1a4ead=a122_0x38e6b0;try{if(!_0x2bb276)return{'isValid':![],'expiryDate':''};const _0x5956e4=(0x0,crypto_1[_0x1a4ead(0x179)])(_0x2bb276,CryptoJS['enc'][_0x1a4ead(0x160)]['parse'](SECRET)[_0x1a4ead(0x172)](CryptoJS['enc']['Utf8']));if(_0x5956e4[_0x1a4ead(0x15a)]!==_0x3cdb20)return{'isValid':![],'expiryDate':''};const _0x28382a=dayjs(_0x5956e4['validFrom'],_0x1a4ead(0x15f))[_0x1a4ead(0x152)](),_0x409b42=dayjs(_0x5956e4[_0x1a4ead(0x164)],_0x1a4ead(0x15f))[_0x1a4ead(0x152)](),_0x88d2c1=dayjs()[_0x1a4ead(0x152)]();if(_0x88d2c1<_0x28382a||_0x88d2c1>_0x409b42)return{'isValid':![],'expiryDate':_0x5956e4['validTo']};return{'isValid':!![],'expiryDate':_0x5956e4['validTo']};}catch(_0x311959){return{'isValid':![],'expiryDate':''};}}async[a122_0x38e6b0(0x17c)](){const _0x2dc280=a122_0x38e6b0;job_1[_0x2dc280(0x149)]['killAll']();}};function a122_0x3e34(){const _0x2c83fb=['@nestjs/common','4762740dHeoMk','settingModel','Model','PROCESS_CACHE','getOwnPropertyDescriptor','../common/crypto','InjectModel','log','validateLicenseKey','@nestjs/mongoose','find','defineProperty','toDate','DEFAULT_MAX_USER','5517nvuVQn','../common/job','maxUser','216VCKAem','474792wIWthE','./constants','schoolId','exec','Setting','length','metadata','DD/MM/YYYY','Base64','userSetting','function','setting','validTo','object','dayjs','__decorate','toObject','88ReYwbB','isValid','updateExpiryStatus','licenseKey','crypto-js','287isdsfn','assign','Injectable','create','toString','__metadata','findFirst','2732dbzaAh','decorate','7600205IDAmzR','39981pjgFIJ','decrypt','__esModule','updateUserSetting','killJobs','update','32391876ZkpiTO','SettingService','93606bPNUsc','__param','_id','mongoose'];a122_0x3e34=function(){return _0x2c83fb;};return a122_0x3e34();}SettingService=__decorate([(0x0,common_1[a122_0x38e6b0(0x170)])(),__param(0x0,(0x0,mongoose_1[a122_0x38e6b0(0x14c)])(a122_0x38e6b0(0x15c))),__metadata('design:paramtypes',[mongoose_2[a122_0x38e6b0(0x148)]])],SettingService),exports['SettingService']=SettingService;