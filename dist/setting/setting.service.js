'use strict';const a122_0x1d07c0=a122_0x1afa;(function(_0x4ec996,_0x332a5e){const _0x14718e=a122_0x1afa,_0x46a698=_0x4ec996();while(!![]){try{const _0x24b5ac=-parseInt(_0x14718e(0x13d))/0x1+parseInt(_0x14718e(0x14a))/0x2+-parseInt(_0x14718e(0x129))/0x3+parseInt(_0x14718e(0x15f))/0x4*(parseInt(_0x14718e(0x133))/0x5)+-parseInt(_0x14718e(0x12b))/0x6+parseInt(_0x14718e(0x153))/0x7+parseInt(_0x14718e(0x138))/0x8;if(_0x24b5ac===_0x332a5e)break;else _0x46a698['push'](_0x46a698['shift']());}catch(_0x50311c){_0x46a698['push'](_0x46a698['shift']());}}}(a122_0x1128,0x8f546));var __decorate=this&&this[a122_0x1d07c0(0x14c)]||function(_0x10669f,_0x392168,_0x1f7d65,_0x2ce0b2){const _0x1878a2=a122_0x1d07c0;var _0x478aaf=arguments['length'],_0x32070e=_0x478aaf<0x3?_0x392168:_0x2ce0b2===null?_0x2ce0b2=Object[_0x1878a2(0x14f)](_0x392168,_0x1f7d65):_0x2ce0b2,_0x3a89bb;if(typeof Reflect===_0x1878a2(0x142)&&typeof Reflect['decorate']==='function')_0x32070e=Reflect[_0x1878a2(0x134)](_0x10669f,_0x392168,_0x1f7d65,_0x2ce0b2);else{for(var _0x43e1e8=_0x10669f['length']-0x1;_0x43e1e8>=0x0;_0x43e1e8--)if(_0x3a89bb=_0x10669f[_0x43e1e8])_0x32070e=(_0x478aaf<0x3?_0x3a89bb(_0x32070e):_0x478aaf>0x3?_0x3a89bb(_0x392168,_0x1f7d65,_0x32070e):_0x3a89bb(_0x392168,_0x1f7d65))||_0x32070e;}return _0x478aaf>0x3&&_0x32070e&&Object[_0x1878a2(0x15b)](_0x392168,_0x1f7d65,_0x32070e),_0x32070e;},__metadata=this&&this['__metadata']||function(_0x2d0740,_0x6dcf80){const _0x1f951a=a122_0x1d07c0;if(typeof Reflect==='object'&&typeof Reflect[_0x1f951a(0x158)]===_0x1f951a(0x137))return Reflect[_0x1f951a(0x158)](_0x2d0740,_0x6dcf80);},__param=this&&this[a122_0x1d07c0(0x146)]||function(_0x42378d,_0x58c749){return function(_0x2fc937,_0x162c52){_0x58c749(_0x2fc937,_0x162c52,_0x42378d);};};Object[a122_0x1d07c0(0x15b)](exports,a122_0x1d07c0(0x156),{'value':!![]}),exports['SettingService']=void 0x0;const common_1=require(a122_0x1d07c0(0x147)),mongoose_1=require(a122_0x1d07c0(0x136)),mongoose_2=require(a122_0x1d07c0(0x140)),CryptoJS=require('crypto-js'),dayjs=require(a122_0x1d07c0(0x12e)),crypto_1=require(a122_0x1d07c0(0x155)),job_1=require(a122_0x1d07c0(0x141)),constants_1=require(a122_0x1d07c0(0x150)),SECRET=a122_0x1d07c0(0x144);function a122_0x1afa(_0xee0f5e,_0x2f9f92){const _0x11287c=a122_0x1128();return a122_0x1afa=function(_0x1afaca,_0xb7b9e9){_0x1afaca=_0x1afaca-0x128;let _0x14e4da=_0x11287c[_0x1afaca];return _0x14e4da;},a122_0x1afa(_0xee0f5e,_0x2f9f92);}let SettingService=class SettingService{constructor(_0x3afd94){this['settingModel']=_0x3afd94;}async[a122_0x1d07c0(0x15a)](_0x31ed21){const _0x2ebc2b=new this['settingModel'](_0x31ed21);return _0x2ebc2b['save']();}async[a122_0x1d07c0(0x139)](){const _0x139e66=a122_0x1d07c0;var _0x2b461b,_0xa9c053,_0x31d76c;const _0x2d161e=await this['settingModel'][_0x139e66(0x14e)]()[_0x139e66(0x154)](),_0x193a22=(_0x2b461b=_0x2d161e[0x0])===null||_0x2b461b===void 0x0?void 0x0:_0x2b461b['toObject']();if(!_0x193a22)return;return Object[_0x139e66(0x14b)](Object[_0x139e66(0x14b)]({},_0x193a22),{'userSetting':Object[_0x139e66(0x14b)](Object[_0x139e66(0x14b)]({},_0x193a22[_0x139e66(0x130)]),{'maxUser':(_0x31d76c=(_0xa9c053=_0x193a22[_0x139e66(0x130)])===null||_0xa9c053===void 0x0?void 0x0:_0xa9c053[_0x139e66(0x161)])!==null&&_0x31d76c!==void 0x0?_0x31d76c:constants_1[_0x139e66(0x13c)]})});}async[a122_0x1d07c0(0x128)](_0x444f9d,_0x44c56a){const _0x49a105=a122_0x1d07c0,_0x2f7a1f=await this[_0x49a105(0x148)]['findByIdAndUpdate'](_0x444f9d,Object[_0x49a105(0x14b)](Object['assign']({},_0x44c56a),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x49a105(0x154)]();return _0x2f7a1f;}async[a122_0x1d07c0(0x14d)](){const _0x128f8c=a122_0x1d07c0,_0x4c533b=await this[_0x128f8c(0x139)](),_0x1aa4e1=this[_0x128f8c(0x149)](_0x4c533b[_0x128f8c(0x13f)],_0x4c533b[_0x128f8c(0x159)]);return this[_0x128f8c(0x128)](_0x4c533b[_0x128f8c(0x152)],{'isExpired':!_0x1aa4e1[_0x128f8c(0x131)]});}async[a122_0x1d07c0(0x13b)](_0x3be469){const _0x88441c=a122_0x1d07c0,_0x18479e=await this[_0x88441c(0x139)]();return console[_0x88441c(0x12a)](_0x18479e,'setting'),this[_0x88441c(0x128)](_0x18479e[_0x88441c(0x152)],{'userSetting':_0x3be469});}[a122_0x1d07c0(0x149)](_0x5ab279,_0x1f2741){const _0x316e4f=a122_0x1d07c0;try{if(!_0x5ab279)return{'isValid':![],'expiryDate':''};const _0x1bd22e=(0x0,crypto_1['decrypt'])(_0x5ab279,CryptoJS['enc']['Base64'][_0x316e4f(0x15c)](SECRET)[_0x316e4f(0x13e)](CryptoJS[_0x316e4f(0x12c)][_0x316e4f(0x132)]));if(_0x1bd22e[_0x316e4f(0x159)]!==_0x1f2741)return{'isValid':![],'expiryDate':''};const _0x44fa6f=dayjs(_0x1bd22e[_0x316e4f(0x160)],_0x316e4f(0x15e))[_0x316e4f(0x143)](),_0x209ed5=dayjs(_0x1bd22e['validTo'],_0x316e4f(0x15e))[_0x316e4f(0x143)](),_0xe825ae=dayjs()['toDate']();if(_0xe825ae<_0x44fa6f||_0xe825ae>_0x209ed5)return{'isValid':![],'expiryDate':_0x1bd22e['validTo']};return{'isValid':!![],'expiryDate':_0x1bd22e[_0x316e4f(0x135)]};}catch(_0xa6d776){return{'isValid':![],'expiryDate':''};}}async[a122_0x1d07c0(0x13a)](){const _0x2ecef4=a122_0x1d07c0;job_1[_0x2ecef4(0x12f)]['killAll']();}};function a122_0x1128(){const _0x28150b=['InjectModel','_id','2005073KylxJV','exec','../common/crypto','__esModule','Setting','metadata','schoolId','create','defineProperty','parse','SettingService','DD/MM/YYYY','4gwHyvN','validFrom','maxUser','update','3478626DhNiuf','log','2054502VlQzfY','enc','design:paramtypes','dayjs','PROCESS_CACHE','userSetting','isValid','Utf8','4495495SHgMEt','decorate','validTo','@nestjs/mongoose','function','1273952kGJFtr','findFirst','killJobs','updateUserSetting','DEFAULT_MAX_USER','73142XzhHkk','toString','licenseKey','mongoose','../common/job','object','toDate','QVBFVFVMT1NCQQ==','Model','__param','@nestjs/common','settingModel','validateLicenseKey','1634794WsXBKp','assign','__decorate','updateExpiryStatus','find','getOwnPropertyDescriptor','./constants'];a122_0x1128=function(){return _0x28150b;};return a122_0x1128();}SettingService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_1[a122_0x1d07c0(0x151)])(a122_0x1d07c0(0x157))),__metadata(a122_0x1d07c0(0x12d),[mongoose_2[a122_0x1d07c0(0x145)]])],SettingService),exports[a122_0x1d07c0(0x15d)]=SettingService;