'use strict';const a122_0x2acd11=a122_0x1f58;(function(_0x4e24b2,_0x116d85){const _0x1fb475=a122_0x1f58,_0x5cfa3d=_0x4e24b2();while(!![]){try{const _0xe880f1=parseInt(_0x1fb475(0x139))/0x1+-parseInt(_0x1fb475(0x11d))/0x2*(parseInt(_0x1fb475(0x103))/0x3)+-parseInt(_0x1fb475(0x126))/0x4*(parseInt(_0x1fb475(0x129))/0x5)+-parseInt(_0x1fb475(0x13b))/0x6+parseInt(_0x1fb475(0x130))/0x7*(parseInt(_0x1fb475(0x105))/0x8)+-parseInt(_0x1fb475(0x12d))/0x9+parseInt(_0x1fb475(0x104))/0xa*(parseInt(_0x1fb475(0x125))/0xb);if(_0xe880f1===_0x116d85)break;else _0x5cfa3d['push'](_0x5cfa3d['shift']());}catch(_0x4c1496){_0x5cfa3d['push'](_0x5cfa3d['shift']());}}}(a122_0x1b6a,0x8df8b));var __decorate=this&&this[a122_0x2acd11(0x12e)]||function(_0x22d13a,_0x53fcc1,_0x1658bb,_0x2f4f52){const _0x2ff539=a122_0x2acd11;var _0xb402=arguments['length'],_0x33c6fa=_0xb402<0x3?_0x53fcc1:_0x2f4f52===null?_0x2f4f52=Object['getOwnPropertyDescriptor'](_0x53fcc1,_0x1658bb):_0x2f4f52,_0x50440f;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x2ff539(0x123))_0x33c6fa=Reflect['decorate'](_0x22d13a,_0x53fcc1,_0x1658bb,_0x2f4f52);else{for(var _0x1da9c2=_0x22d13a[_0x2ff539(0x10b)]-0x1;_0x1da9c2>=0x0;_0x1da9c2--)if(_0x50440f=_0x22d13a[_0x1da9c2])_0x33c6fa=(_0xb402<0x3?_0x50440f(_0x33c6fa):_0xb402>0x3?_0x50440f(_0x53fcc1,_0x1658bb,_0x33c6fa):_0x50440f(_0x53fcc1,_0x1658bb))||_0x33c6fa;}return _0xb402>0x3&&_0x33c6fa&&Object[_0x2ff539(0x11a)](_0x53fcc1,_0x1658bb,_0x33c6fa),_0x33c6fa;},__metadata=this&&this[a122_0x2acd11(0x118)]||function(_0x949ad8,_0x419d0a){const _0x255f33=a122_0x2acd11;if(typeof Reflect===_0x255f33(0x107)&&typeof Reflect['metadata']===_0x255f33(0x123))return Reflect[_0x255f33(0x131)](_0x949ad8,_0x419d0a);},__param=this&&this[a122_0x2acd11(0x12f)]||function(_0x236540,_0x4a2b5a){return function(_0x22bbdb,_0xf6e31e){_0x4a2b5a(_0x22bbdb,_0xf6e31e,_0x236540);};};Object['defineProperty'](exports,a122_0x2acd11(0x12b),{'value':!![]}),exports[a122_0x2acd11(0x111)]=void 0x0;const common_1=require(a122_0x2acd11(0x124)),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require(a122_0x2acd11(0x128)),CryptoJS=require(a122_0x2acd11(0x10e)),dayjs=require(a122_0x2acd11(0x13d)),crypto_1=require(a122_0x2acd11(0x11f)),job_1=require('../common/job'),constants_1=require(a122_0x2acd11(0x122)),SECRET=a122_0x2acd11(0x109);function a122_0x1f58(_0x13a97e,_0x2ad427){const _0x1b6a60=a122_0x1b6a();return a122_0x1f58=function(_0x1f5880,_0x53c318){_0x1f5880=_0x1f5880-0x103;let _0x59396b=_0x1b6a60[_0x1f5880];return _0x59396b;},a122_0x1f58(_0x13a97e,_0x2ad427);}function a122_0x1b6a(){const _0x123d61=['validTo','SettingService','toDate','findFirst','findByIdAndUpdate','licenseKey','PROCESS_CACHE','isValid','__metadata','schoolId','defineProperty','find','toObject','542wXyaMD','log','../common/crypto','enc','design:paramtypes','./constants','function','@nestjs/common','11mnpggz','640756IXRsFd','killJobs','mongoose','5JcvVra','Injectable','__esModule','Model','6888150BNcJFE','__decorate','__param','1198589VbcLKO','metadata','setting','save','_id','create','updateExpiryStatus','Base64','decrypt','918486pEWIiM','settingModel','130242pxVqzg','validFrom','dayjs','parse','Utf8','12183KFBNws','11971250uuDpkl','24yqHKmG','userSetting','object','exec','QVBFVFVMT1NCQQ==','validateLicenseKey','length','DD/MM/YYYY','assign','crypto-js','update'];a122_0x1b6a=function(){return _0x123d61;};return a122_0x1b6a();}let SettingService=class SettingService{constructor(_0x49a35b){const _0x4b5efc=a122_0x2acd11;this[_0x4b5efc(0x13a)]=_0x49a35b;}async[a122_0x2acd11(0x135)](_0x4a6861){const _0xb86fb4=a122_0x2acd11,_0x541158=new this[(_0xb86fb4(0x13a))](_0x4a6861);return _0x541158[_0xb86fb4(0x133)]();}async[a122_0x2acd11(0x113)](){const _0x5de0da=a122_0x2acd11;var _0x3a4336,_0x315ab6;const _0x1879b6=await this[_0x5de0da(0x13a)][_0x5de0da(0x11b)]()[_0x5de0da(0x108)](),_0x399665=_0x1879b6[0x0][_0x5de0da(0x11c)]();return Object[_0x5de0da(0x10d)](Object[_0x5de0da(0x10d)]({},_0x399665),{'userSetting':Object[_0x5de0da(0x10d)](Object[_0x5de0da(0x10d)]({},_0x399665[_0x5de0da(0x106)]),{'maxUser':(_0x315ab6=(_0x3a4336=_0x399665[_0x5de0da(0x106)])===null||_0x3a4336===void 0x0?void 0x0:_0x3a4336['maxUser'])!==null&&_0x315ab6!==void 0x0?_0x315ab6:constants_1['DEFAULT_MAX_USER']})});}async[a122_0x2acd11(0x10f)](_0x5724fb,_0x14d98){const _0x94d0ed=a122_0x2acd11,_0x50961f=await this[_0x94d0ed(0x13a)][_0x94d0ed(0x114)](_0x5724fb,Object[_0x94d0ed(0x10d)](Object[_0x94d0ed(0x10d)]({},_0x14d98),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x94d0ed(0x108)]();return _0x50961f;}async[a122_0x2acd11(0x136)](){const _0x32e2ea=a122_0x2acd11,_0x2d5fd5=await this['findFirst'](),_0x4bcad9=this[_0x32e2ea(0x10a)](_0x2d5fd5[_0x32e2ea(0x115)],_0x2d5fd5[_0x32e2ea(0x119)]);return this[_0x32e2ea(0x10f)](_0x2d5fd5[_0x32e2ea(0x134)],{'isExpired':!_0x4bcad9[_0x32e2ea(0x117)]});}async['updateUserSetting'](_0x206f60){const _0x3cda49=a122_0x2acd11,_0x3f497a=await this[_0x3cda49(0x113)]();return console[_0x3cda49(0x11e)](_0x3f497a,_0x3cda49(0x132)),this[_0x3cda49(0x10f)](_0x3f497a[_0x3cda49(0x134)],{'userSetting':_0x206f60});}[a122_0x2acd11(0x10a)](_0x4af76c,_0x214b78){const _0x5c581d=a122_0x2acd11;try{if(!_0x4af76c)return{'isValid':![],'expiryDate':''};const _0x3903a6=(0x0,crypto_1[_0x5c581d(0x138)])(_0x4af76c,CryptoJS['enc'][_0x5c581d(0x137)][_0x5c581d(0x13e)](SECRET)['toString'](CryptoJS[_0x5c581d(0x120)][_0x5c581d(0x13f)]));if(_0x3903a6[_0x5c581d(0x119)]!==_0x214b78)return{'isValid':![],'expiryDate':''};const _0xb9cbae=dayjs(_0x3903a6[_0x5c581d(0x13c)],_0x5c581d(0x10c))[_0x5c581d(0x112)](),_0x429d0d=dayjs(_0x3903a6['validTo'],'DD/MM/YYYY')[_0x5c581d(0x112)](),_0x234baa=dayjs()[_0x5c581d(0x112)]();if(_0x234baa<_0xb9cbae||_0x234baa>_0x429d0d)return{'isValid':![],'expiryDate':_0x3903a6[_0x5c581d(0x110)]};return{'isValid':!![],'expiryDate':_0x3903a6['validTo']};}catch(_0x463350){return{'isValid':![],'expiryDate':''};}}async[a122_0x2acd11(0x127)](){const _0x47c071=a122_0x2acd11;job_1[_0x47c071(0x116)]['killAll']();}};SettingService=__decorate([(0x0,common_1[a122_0x2acd11(0x12a)])(),__param(0x0,(0x0,mongoose_1['InjectModel'])('Setting')),__metadata(a122_0x2acd11(0x121),[mongoose_2[a122_0x2acd11(0x12c)]])],SettingService),exports[a122_0x2acd11(0x111)]=SettingService;