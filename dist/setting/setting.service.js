'use strict';const a125_0x53a576=a125_0x448c;(function(_0x4b3eb9,_0x35173c){const _0x18e750=a125_0x448c,_0x1cafe7=_0x4b3eb9();while(!![]){try{const _0x17309b=parseInt(_0x18e750(0x1fa))/0x1+parseInt(_0x18e750(0x1da))/0x2+parseInt(_0x18e750(0x1cf))/0x3*(-parseInt(_0x18e750(0x1ed))/0x4)+-parseInt(_0x18e750(0x1db))/0x5*(-parseInt(_0x18e750(0x1dc))/0x6)+parseInt(_0x18e750(0x1f7))/0x7+parseInt(_0x18e750(0x1e2))/0x8*(-parseInt(_0x18e750(0x1f5))/0x9)+-parseInt(_0x18e750(0x1ea))/0xa;if(_0x17309b===_0x35173c)break;else _0x1cafe7['push'](_0x1cafe7['shift']());}catch(_0x337a9f){_0x1cafe7['push'](_0x1cafe7['shift']());}}}(a125_0x2b8c,0x6a668));function a125_0x448c(_0x254523,_0x2ad21a){const _0x2b8cfc=a125_0x2b8c();return a125_0x448c=function(_0x448c6a,_0x49ae26){_0x448c6a=_0x448c6a-0x1cd;let _0x4f6f97=_0x2b8cfc[_0x448c6a];return _0x4f6f97;},a125_0x448c(_0x254523,_0x2ad21a);}var __decorate=this&&this['__decorate']||function(_0x16bccf,_0x54673d,_0x45104a,_0x512291){const _0x3df6c2=a125_0x448c;var _0x50df70=arguments['length'],_0x45e98b=_0x50df70<0x3?_0x54673d:_0x512291===null?_0x512291=Object[_0x3df6c2(0x1e7)](_0x54673d,_0x45104a):_0x512291,_0x561aed;if(typeof Reflect===_0x3df6c2(0x1e4)&&typeof Reflect[_0x3df6c2(0x1d2)]==='function')_0x45e98b=Reflect[_0x3df6c2(0x1d2)](_0x16bccf,_0x54673d,_0x45104a,_0x512291);else{for(var _0x4e3a6e=_0x16bccf['length']-0x1;_0x4e3a6e>=0x0;_0x4e3a6e--)if(_0x561aed=_0x16bccf[_0x4e3a6e])_0x45e98b=(_0x50df70<0x3?_0x561aed(_0x45e98b):_0x50df70>0x3?_0x561aed(_0x54673d,_0x45104a,_0x45e98b):_0x561aed(_0x54673d,_0x45104a))||_0x45e98b;}return _0x50df70>0x3&&_0x45e98b&&Object[_0x3df6c2(0x1f2)](_0x54673d,_0x45104a,_0x45e98b),_0x45e98b;},__metadata=this&&this['__metadata']||function(_0x3a25cc,_0x2b35b9){const _0x73ee5d=a125_0x448c;if(typeof Reflect===_0x73ee5d(0x1e4)&&typeof Reflect[_0x73ee5d(0x1d3)]===_0x73ee5d(0x1de))return Reflect[_0x73ee5d(0x1d3)](_0x3a25cc,_0x2b35b9);},__param=this&&this[a125_0x53a576(0x200)]||function(_0x27d76c,_0x2eff6){return function(_0x543fb4,_0x376003){_0x2eff6(_0x543fb4,_0x376003,_0x27d76c);};};Object[a125_0x53a576(0x1f2)](exports,a125_0x53a576(0x1ef),{'value':!![]}),exports[a125_0x53a576(0x1e0)]=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a125_0x53a576(0x1d7)),mongoose_2=require(a125_0x53a576(0x1d0)),CryptoJS=require(a125_0x53a576(0x1d6)),dayjs=require(a125_0x53a576(0x1eb)),crypto_1=require(a125_0x53a576(0x1fc)),job_1=require('../common/job'),constants_1=require('./constants'),SECRET='QVBFVFVMT1NCQQ==';let SettingService=class SettingService{constructor(_0xc28310){this['settingModel']=_0xc28310;}async[a125_0x53a576(0x1dd)](_0x7aadc){const _0x5a10eb=new this['settingModel'](_0x7aadc);return _0x5a10eb['save']();}async[a125_0x53a576(0x1d5)](){const _0x515f33=a125_0x53a576;var _0xde434c,_0x24ef8c,_0x5b9ae5;const _0x971b45=await this[_0x515f33(0x1d8)]['find']()[_0x515f33(0x201)](),_0x170d8f=(_0xde434c=_0x971b45[0x0])===null||_0xde434c===void 0x0?void 0x0:_0xde434c[_0x515f33(0x1d4)]();if(!_0x170d8f)return;return Object[_0x515f33(0x1ff)](Object[_0x515f33(0x1ff)]({},_0x170d8f),{'userSetting':Object['assign'](Object[_0x515f33(0x1ff)]({},_0x170d8f['userSetting']),{'maxUser':(_0x5b9ae5=(_0x24ef8c=_0x170d8f[_0x515f33(0x1e1)])===null||_0x24ef8c===void 0x0?void 0x0:_0x24ef8c[_0x515f33(0x1e6)])!==null&&_0x5b9ae5!==void 0x0?_0x5b9ae5:constants_1['DEFAULT_MAX_USER']})});}async[a125_0x53a576(0x1f3)](_0x40423c,_0x5aba54){const _0x3c7fba=a125_0x53a576,_0x373abc=await this[_0x3c7fba(0x1d8)]['findByIdAndUpdate'](_0x40423c,Object[_0x3c7fba(0x1ff)](Object[_0x3c7fba(0x1ff)]({},_0x5aba54),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x3c7fba(0x201)]();return _0x373abc;}async[a125_0x53a576(0x1fd)](){const _0x13c434=a125_0x53a576,_0x567a5f=await this[_0x13c434(0x1d5)](),_0x3e5ca2=this['validateLicenseKey'](_0x567a5f[_0x13c434(0x1cd)],_0x567a5f['schoolId']);return this[_0x13c434(0x1f3)](_0x567a5f['_id'],{'isExpired':!_0x3e5ca2[_0x13c434(0x1f0)]});}async[a125_0x53a576(0x1fe)](_0x2d8161){const _0x1fa0b3=a125_0x53a576,_0x102232=await this['findFirst']();return console[_0x1fa0b3(0x1f8)](_0x102232,'setting'),this[_0x1fa0b3(0x1f3)](_0x102232['_id'],{'userSetting':_0x2d8161});}['validateLicenseKey'](_0x17af21,_0x3aa9b8){const _0x55295b=a125_0x53a576;try{if(!_0x17af21)return{'isValid':![],'expiryDate':''};const _0xc06f82=(0x0,crypto_1[_0x55295b(0x1e3)])(_0x17af21,CryptoJS[_0x55295b(0x1e9)]['Base64'][_0x55295b(0x1e8)](SECRET)[_0x55295b(0x1f9)](CryptoJS[_0x55295b(0x1e9)][_0x55295b(0x1f6)]));if(_0xc06f82['schoolId']!==_0x3aa9b8)return{'isValid':![],'expiryDate':''};const _0x3e5283=dayjs(_0xc06f82[_0x55295b(0x1d1)],_0x55295b(0x1f4))['toDate'](),_0x4cfacb=dayjs(_0xc06f82[_0x55295b(0x1d9)],_0x55295b(0x1f4))[_0x55295b(0x1f1)](),_0x3ed66e=dayjs()[_0x55295b(0x1f1)]();if(_0x3ed66e<_0x3e5283||_0x3ed66e>_0x4cfacb)return{'isValid':![],'expiryDate':_0xc06f82[_0x55295b(0x1d9)]};return{'isValid':!![],'expiryDate':_0xc06f82[_0x55295b(0x1d9)]};}catch(_0x81bfc2){return{'isValid':![],'expiryDate':''};}}async[a125_0x53a576(0x1df)](){const _0x3da6e2=a125_0x53a576;job_1[_0x3da6e2(0x1e5)][_0x3da6e2(0x1ee)]();}};function a125_0x2b8c(){const _0x2020d1=['log','toString','681446DcaEap','Model','../common/crypto','updateExpiryStatus','updateUserSetting','assign','__param','exec','licenseKey','design:paramtypes','753IZFyLY','mongoose','validFrom','decorate','metadata','toObject','findFirst','crypto-js','@nestjs/mongoose','settingModel','validTo','1626688apepKd','25KbRpqN','798078aDaTiz','create','function','killJobs','SettingService','userSetting','16KEiBEn','decrypt','object','PROCESS_CACHE','maxUser','getOwnPropertyDescriptor','parse','enc','11258490KPJRVp','dayjs','Injectable','6284gWSBZr','killAll','__esModule','isValid','toDate','defineProperty','update','DD/MM/YYYY','1699722oDGfwb','Utf8','1216929wAyNcP'];a125_0x2b8c=function(){return _0x2020d1;};return a125_0x2b8c();}SettingService=__decorate([(0x0,common_1[a125_0x53a576(0x1ec)])(),__param(0x0,(0x0,mongoose_1['InjectModel'])('Setting')),__metadata(a125_0x53a576(0x1ce),[mongoose_2[a125_0x53a576(0x1fb)]])],SettingService),exports[a125_0x53a576(0x1e0)]=SettingService;