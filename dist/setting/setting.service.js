'use strict';const a122_0x4c975a=a122_0x25a5;function a122_0x25a5(_0x54ca02,_0x21e009){const _0x34930c=a122_0x3493();return a122_0x25a5=function(_0x25a56c,_0x524816){_0x25a56c=_0x25a56c-0x11c;let _0x33cbd7=_0x34930c[_0x25a56c];return _0x33cbd7;},a122_0x25a5(_0x54ca02,_0x21e009);}(function(_0x3eece8,_0x51d6d3){const _0x1083be=a122_0x25a5,_0x4b448e=_0x3eece8();while(!![]){try{const _0x36a367=parseInt(_0x1083be(0x137))/0x1*(parseInt(_0x1083be(0x132))/0x2)+parseInt(_0x1083be(0x133))/0x3+parseInt(_0x1083be(0x142))/0x4+parseInt(_0x1083be(0x145))/0x5+-parseInt(_0x1083be(0x12f))/0x6*(-parseInt(_0x1083be(0x14e))/0x7)+parseInt(_0x1083be(0x125))/0x8*(parseInt(_0x1083be(0x12a))/0x9)+parseInt(_0x1083be(0x153))/0xa*(-parseInt(_0x1083be(0x14a))/0xb);if(_0x36a367===_0x51d6d3)break;else _0x4b448e['push'](_0x4b448e['shift']());}catch(_0x263484){_0x4b448e['push'](_0x4b448e['shift']());}}}(a122_0x3493,0x319af));var __decorate=this&&this['__decorate']||function(_0x351cd8,_0x3f5819,_0x1c937c,_0x11f60b){const _0xa205c7=a122_0x25a5;var _0x3d9499=arguments[_0xa205c7(0x12d)],_0xe277d9=_0x3d9499<0x3?_0x3f5819:_0x11f60b===null?_0x11f60b=Object[_0xa205c7(0x139)](_0x3f5819,_0x1c937c):_0x11f60b,_0xba40db;if(typeof Reflect==='object'&&typeof Reflect[_0xa205c7(0x14d)]==='function')_0xe277d9=Reflect[_0xa205c7(0x14d)](_0x351cd8,_0x3f5819,_0x1c937c,_0x11f60b);else{for(var _0x169bfb=_0x351cd8[_0xa205c7(0x12d)]-0x1;_0x169bfb>=0x0;_0x169bfb--)if(_0xba40db=_0x351cd8[_0x169bfb])_0xe277d9=(_0x3d9499<0x3?_0xba40db(_0xe277d9):_0x3d9499>0x3?_0xba40db(_0x3f5819,_0x1c937c,_0xe277d9):_0xba40db(_0x3f5819,_0x1c937c))||_0xe277d9;}return _0x3d9499>0x3&&_0xe277d9&&Object['defineProperty'](_0x3f5819,_0x1c937c,_0xe277d9),_0xe277d9;},__metadata=this&&this[a122_0x4c975a(0x11c)]||function(_0x3b4222,_0x29e472){const _0x9ec56a=a122_0x4c975a;if(typeof Reflect===_0x9ec56a(0x131)&&typeof Reflect[_0x9ec56a(0x128)]===_0x9ec56a(0x121))return Reflect[_0x9ec56a(0x128)](_0x3b4222,_0x29e472);},__param=this&&this[a122_0x4c975a(0x155)]||function(_0x2d931e,_0x2e7b17){return function(_0xea2f13,_0x96de53){_0x2e7b17(_0xea2f13,_0x96de53,_0x2d931e);};};Object[a122_0x4c975a(0x14c)](exports,a122_0x4c975a(0x140),{'value':!![]}),exports[a122_0x4c975a(0x13a)]=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require('mongoose'),CryptoJS=require(a122_0x4c975a(0x12b)),dayjs=require(a122_0x4c975a(0x138)),crypto_1=require(a122_0x4c975a(0x13f)),job_1=require(a122_0x4c975a(0x126)),constants_1=require('./constants'),SECRET=a122_0x4c975a(0x141);let SettingService=class SettingService{constructor(_0x2e9136){this['settingModel']=_0x2e9136;}async['create'](_0x2fd64b){const _0x4c49b4=a122_0x4c975a,_0x2f08fd=new this[(_0x4c49b4(0x150))](_0x2fd64b);return _0x2f08fd[_0x4c49b4(0x14f)]();}async[a122_0x4c975a(0x135)](){const _0x56b4fd=a122_0x4c975a;var _0x5b9d07,_0x162f5b;const _0x17345a=await this['settingModel'][_0x56b4fd(0x11f)]()['exec'](),_0x54220b=_0x17345a[0x0][_0x56b4fd(0x152)]();return Object['assign'](Object[_0x56b4fd(0x13b)]({},_0x54220b),{'userSetting':Object[_0x56b4fd(0x13b)](Object[_0x56b4fd(0x13b)]({},_0x54220b[_0x56b4fd(0x136)]),{'maxUser':(_0x162f5b=(_0x5b9d07=_0x54220b[_0x56b4fd(0x136)])===null||_0x5b9d07===void 0x0?void 0x0:_0x5b9d07[_0x56b4fd(0x14b)])!==null&&_0x162f5b!==void 0x0?_0x162f5b:constants_1[_0x56b4fd(0x12e)]})});}async[a122_0x4c975a(0x123)](_0x5b5cbb,_0x124ce5){const _0x2808f4=a122_0x4c975a,_0x21b418=await this[_0x2808f4(0x150)]['findByIdAndUpdate'](_0x5b5cbb,Object[_0x2808f4(0x13b)](Object[_0x2808f4(0x13b)]({},_0x124ce5),{'updatedAtUtc':new Date()}),{'new':!![]})['exec']();return _0x21b418;}async[a122_0x4c975a(0x127)](){const _0x110985=a122_0x4c975a,_0x4b93bf=await this[_0x110985(0x135)](),_0x522d4c=this['validateLicenseKey'](_0x4b93bf[_0x110985(0x151)],_0x4b93bf['schoolId']);return this['update'](_0x4b93bf['_id'],{'isExpired':!_0x522d4c['isValid']});}async[a122_0x4c975a(0x122)](_0x1be064){const _0x23a000=a122_0x4c975a,_0x2bf96d=await this[_0x23a000(0x135)]();return console[_0x23a000(0x11d)](_0x2bf96d,'setting'),this[_0x23a000(0x123)](_0x2bf96d[_0x23a000(0x148)],{'userSetting':_0x1be064});}[a122_0x4c975a(0x147)](_0x4d1922,_0x5a0596){const _0x49b787=a122_0x4c975a;try{if(!_0x4d1922)return{'isValid':![],'expiryDate':''};const _0x5d0925=(0x0,crypto_1[_0x49b787(0x120)])(_0x4d1922,CryptoJS['enc'][_0x49b787(0x13c)][_0x49b787(0x13e)](SECRET)[_0x49b787(0x129)](CryptoJS[_0x49b787(0x143)]['Utf8']));if(_0x5d0925[_0x49b787(0x144)]!==_0x5a0596)return{'isValid':![],'expiryDate':''};const _0x170e65=dayjs(_0x5d0925['validFrom'],_0x49b787(0x149))[_0x49b787(0x11e)](),_0x3f4130=dayjs(_0x5d0925[_0x49b787(0x154)],_0x49b787(0x149))[_0x49b787(0x11e)](),_0x315a05=dayjs()[_0x49b787(0x11e)]();if(_0x315a05<_0x170e65||_0x315a05>_0x3f4130)return{'isValid':![],'expiryDate':_0x5d0925[_0x49b787(0x154)]};return{'isValid':!![],'expiryDate':_0x5d0925[_0x49b787(0x154)]};}catch(_0x1e4519){return{'isValid':![],'expiryDate':''};}}async[a122_0x4c975a(0x130)](){const _0x1bc2fc=a122_0x4c975a;job_1[_0x1bc2fc(0x134)]['killAll']();}};SettingService=__decorate([(0x0,common_1[a122_0x4c975a(0x146)])(),__param(0x0,(0x0,mongoose_1[a122_0x4c975a(0x12c)])(a122_0x4c975a(0x13d))),__metadata(a122_0x4c975a(0x124),[mongoose_2['Model']])],SettingService),exports['SettingService']=SettingService;function a122_0x3493(){const _0x1522ed=['enc','schoolId','1552400lxVKhw','Injectable','validateLicenseKey','_id','DD/MM/YYYY','6655oYgagr','maxUser','defineProperty','decorate','965321iTgGZW','save','settingModel','licenseKey','toObject','20510nZYhkG','validTo','__param','__metadata','log','toDate','find','decrypt','function','updateUserSetting','update','design:paramtypes','42752jxSPqe','../common/job','updateExpiryStatus','metadata','toString','342bIcNOM','crypto-js','InjectModel','length','DEFAULT_MAX_USER','6AxpgXb','killJobs','object','623548nbMsLr','1034661MNWlbp','PROCESS_CACHE','findFirst','userSetting','1BWoPFs','dayjs','getOwnPropertyDescriptor','SettingService','assign','Base64','Setting','parse','../common/crypto','__esModule','QVBFVFVMT1NCQQ==','543688ApycXV'];a122_0x3493=function(){return _0x1522ed;};return a122_0x3493();}