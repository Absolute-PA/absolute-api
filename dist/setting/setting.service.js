'use strict';const a122_0x4d1e9e=a122_0x26f0;function a122_0x321b(){const _0x13370e=['mongoose','exec','363fUkKJg','crypto-js','dayjs','285510oaAHiX','findFirst','decorate','822109euGLsH','findByIdAndUpdate','Setting','105cpqXpO','Utf8','5ytvthW','_id','4511712nbwBte','7KMChCU','enc','settingModel','parse','updateUserSetting','design:paramtypes','object','InjectModel','update','18TvDLcr','Model','licenseKey','QVBFVFVMT1NCQQ==','isValid','__param','killJobs','defineProperty','19846guKSUf','__esModule','908140nYXjbP','userSetting','toDate','assign','length','validateLicenseKey','__metadata','../common/crypto','maxUser','3324816pIUXOK','updateExpiryStatus','schoolId','./constants','toString','function','__decorate','validTo','307644DqMxbg','metadata','decrypt','log','getOwnPropertyDescriptor','../common/job'];a122_0x321b=function(){return _0x13370e;};return a122_0x321b();}(function(_0x585bff,_0x57c91c){const _0x20f9e3=a122_0x26f0,_0x271bb4=_0x585bff();while(!![]){try{const _0x2f88b6=-parseInt(_0x20f9e3(0x180))/0x1+-parseInt(_0x20f9e3(0x199))/0x2*(parseInt(_0x20f9e3(0x183))/0x3)+parseInt(_0x20f9e3(0x19b))/0x4*(-parseInt(_0x20f9e3(0x185))/0x5)+parseInt(_0x20f9e3(0x1a4))/0x6+parseInt(_0x20f9e3(0x188))/0x7*(parseInt(_0x20f9e3(0x187))/0x8)+parseInt(_0x20f9e3(0x191))/0x9*(-parseInt(_0x20f9e3(0x17d))/0xa)+-parseInt(_0x20f9e3(0x17a))/0xb*(-parseInt(_0x20f9e3(0x1ac))/0xc);if(_0x2f88b6===_0x57c91c)break;else _0x271bb4['push'](_0x271bb4['shift']());}catch(_0x1c58bf){_0x271bb4['push'](_0x271bb4['shift']());}}}(a122_0x321b,0x7ca6a));function a122_0x26f0(_0x2b255f,_0x1ffd3c){const _0x321b23=a122_0x321b();return a122_0x26f0=function(_0x26f00d,_0x443c2e){_0x26f00d=_0x26f00d-0x175;let _0x49e327=_0x321b23[_0x26f00d];return _0x49e327;},a122_0x26f0(_0x2b255f,_0x1ffd3c);}var __decorate=this&&this[a122_0x4d1e9e(0x1aa)]||function(_0x40f97d,_0xff335e,_0x4bdbe3,_0x345c2c){const _0x31e167=a122_0x4d1e9e;var _0x312460=arguments['length'],_0x10a0dc=_0x312460<0x3?_0xff335e:_0x345c2c===null?_0x345c2c=Object[_0x31e167(0x176)](_0xff335e,_0x4bdbe3):_0x345c2c,_0x124b93;if(typeof Reflect==='object'&&typeof Reflect[_0x31e167(0x17f)]===_0x31e167(0x1a9))_0x10a0dc=Reflect[_0x31e167(0x17f)](_0x40f97d,_0xff335e,_0x4bdbe3,_0x345c2c);else{for(var _0x516a58=_0x40f97d[_0x31e167(0x19f)]-0x1;_0x516a58>=0x0;_0x516a58--)if(_0x124b93=_0x40f97d[_0x516a58])_0x10a0dc=(_0x312460<0x3?_0x124b93(_0x10a0dc):_0x312460>0x3?_0x124b93(_0xff335e,_0x4bdbe3,_0x10a0dc):_0x124b93(_0xff335e,_0x4bdbe3))||_0x10a0dc;}return _0x312460>0x3&&_0x10a0dc&&Object[_0x31e167(0x198)](_0xff335e,_0x4bdbe3,_0x10a0dc),_0x10a0dc;},__metadata=this&&this[a122_0x4d1e9e(0x1a1)]||function(_0x3e11c7,_0x51ce87){const _0x8102f6=a122_0x4d1e9e;if(typeof Reflect===_0x8102f6(0x18e)&&typeof Reflect[_0x8102f6(0x1ad)]===_0x8102f6(0x1a9))return Reflect['metadata'](_0x3e11c7,_0x51ce87);},__param=this&&this[a122_0x4d1e9e(0x196)]||function(_0x2eeaba,_0x1aecc2){return function(_0x2ebfd9,_0xfdd9a9){_0x1aecc2(_0x2ebfd9,_0xfdd9a9,_0x2eeaba);};};Object[a122_0x4d1e9e(0x198)](exports,a122_0x4d1e9e(0x19a),{'value':!![]}),exports['SettingService']=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require(a122_0x4d1e9e(0x178)),CryptoJS=require(a122_0x4d1e9e(0x17b)),dayjs=require(a122_0x4d1e9e(0x17c)),crypto_1=require(a122_0x4d1e9e(0x1a2)),job_1=require(a122_0x4d1e9e(0x177)),constants_1=require(a122_0x4d1e9e(0x1a7)),SECRET=a122_0x4d1e9e(0x194);let SettingService=class SettingService{constructor(_0x27e564){this['settingModel']=_0x27e564;}async['create'](_0x577fd4){const _0x4eed26=a122_0x4d1e9e,_0x18e251=new this[(_0x4eed26(0x18a))](_0x577fd4);return _0x18e251['save']();}async['findFirst'](){const _0x495faa=a122_0x4d1e9e;var _0x3dc558,_0x431d47;const _0x2f5db0=await this['settingModel']['find']()['exec'](),_0x40fe3f=_0x2f5db0[0x0]['toObject']();return Object[_0x495faa(0x19e)](Object[_0x495faa(0x19e)]({},_0x40fe3f),{'userSetting':Object[_0x495faa(0x19e)](Object[_0x495faa(0x19e)]({},_0x40fe3f['userSetting']),{'maxUser':(_0x431d47=(_0x3dc558=_0x40fe3f[_0x495faa(0x19c)])===null||_0x3dc558===void 0x0?void 0x0:_0x3dc558[_0x495faa(0x1a3)])!==null&&_0x431d47!==void 0x0?_0x431d47:constants_1['DEFAULT_MAX_USER']})});}async[a122_0x4d1e9e(0x190)](_0x506f74,_0x4ab875){const _0x2a7666=a122_0x4d1e9e,_0x3bd32f=await this[_0x2a7666(0x18a)][_0x2a7666(0x181)](_0x506f74,Object['assign'](Object[_0x2a7666(0x19e)]({},_0x4ab875),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x2a7666(0x179)]();return _0x3bd32f;}async[a122_0x4d1e9e(0x1a5)](){const _0x50feff=a122_0x4d1e9e,_0x4053ac=await this[_0x50feff(0x17e)](),_0x2f1c94=this['validateLicenseKey'](_0x4053ac[_0x50feff(0x193)],_0x4053ac[_0x50feff(0x1a6)]);return this[_0x50feff(0x190)](_0x4053ac['_id'],{'isExpired':!_0x2f1c94[_0x50feff(0x195)]});}async[a122_0x4d1e9e(0x18c)](_0x1dab12){const _0x1e58ca=a122_0x4d1e9e,_0x4c2bea=await this[_0x1e58ca(0x17e)]();return console[_0x1e58ca(0x175)](_0x4c2bea,'setting'),this[_0x1e58ca(0x190)](_0x4c2bea[_0x1e58ca(0x186)],{'userSetting':_0x1dab12});}[a122_0x4d1e9e(0x1a0)](_0x76e818,_0x29cd37){const _0x1228f6=a122_0x4d1e9e;try{if(!_0x76e818)return{'isValid':![],'expiryDate':''};const _0x114aa6=(0x0,crypto_1[_0x1228f6(0x1ae)])(_0x76e818,CryptoJS['enc']['Base64'][_0x1228f6(0x18b)](SECRET)[_0x1228f6(0x1a8)](CryptoJS[_0x1228f6(0x189)][_0x1228f6(0x184)]));if(_0x114aa6['schoolId']!==_0x29cd37)return{'isValid':![],'expiryDate':''};const _0x158064=dayjs(_0x114aa6['validFrom'],'DD/MM/YYYY')['toDate'](),_0x4c2f06=dayjs(_0x114aa6[_0x1228f6(0x1ab)],'DD/MM/YYYY')[_0x1228f6(0x19d)](),_0x2df31a=dayjs()[_0x1228f6(0x19d)]();if(_0x2df31a<_0x158064||_0x2df31a>_0x4c2f06)return{'isValid':![],'expiryDate':_0x114aa6[_0x1228f6(0x1ab)]};return{'isValid':!![],'expiryDate':_0x114aa6[_0x1228f6(0x1ab)]};}catch(_0x191c79){return{'isValid':![],'expiryDate':''};}}async[a122_0x4d1e9e(0x197)](){job_1['PROCESS_CACHE']['killAll']();}};SettingService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_1[a122_0x4d1e9e(0x18f)])(a122_0x4d1e9e(0x182))),__metadata(a122_0x4d1e9e(0x18d),[mongoose_2[a122_0x4d1e9e(0x192)]])],SettingService),exports['SettingService']=SettingService;