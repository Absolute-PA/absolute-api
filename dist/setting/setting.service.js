'use strict';function a125_0x5dab(_0xb91147,_0x4247b6){const _0x14a60d=a125_0x14a6();return a125_0x5dab=function(_0x5dab5f,_0x5347d1){_0x5dab5f=_0x5dab5f-0x99;let _0x1284fe=_0x14a60d[_0x5dab5f];return _0x1284fe;},a125_0x5dab(_0xb91147,_0x4247b6);}const a125_0x172dc4=a125_0x5dab;(function(_0x459151,_0x36a32c){const _0x1dbf57=a125_0x5dab,_0xe26dd=_0x459151();while(!![]){try{const _0x3d0c61=parseInt(_0x1dbf57(0xa1))/0x1*(-parseInt(_0x1dbf57(0xc1))/0x2)+parseInt(_0x1dbf57(0x9f))/0x3*(parseInt(_0x1dbf57(0x9e))/0x4)+parseInt(_0x1dbf57(0xd7))/0x5+parseInt(_0x1dbf57(0xc6))/0x6+-parseInt(_0x1dbf57(0xcf))/0x7*(-parseInt(_0x1dbf57(0xb2))/0x8)+-parseInt(_0x1dbf57(0x9b))/0x9*(-parseInt(_0x1dbf57(0xc9))/0xa)+-parseInt(_0x1dbf57(0xd5))/0xb*(parseInt(_0x1dbf57(0xa0))/0xc);if(_0x3d0c61===_0x36a32c)break;else _0xe26dd['push'](_0xe26dd['shift']());}catch(_0x48e12b){_0xe26dd['push'](_0xe26dd['shift']());}}}(a125_0x14a6,0xec57e));function a125_0x14a6(){const _0x1ae304=['DEFAULT_MAX_USER','setting','_id','33671pGDVnm','mongoose','760470MrpWWi','Model','isValid','design:paramtypes','dayjs','__param','20187zyjNPg','Injectable','object','4XRGWnM','4916139zeOxPk','15264XxewkT','7MIiAuy','Base64','killAll','@nestjs/common','__decorate','getOwnPropertyDescriptor','validFrom','PROCESS_CACHE','schoolId','./constants','__metadata','validateLicenseKey','toString','decorate','validTo','findFirst','updateExpiryStatus','1506728CssMyv','toDate','decrypt','DD/MM/YYYY','assign','update','findByIdAndUpdate','crypto-js','InjectModel','exec','parse','updateUserSetting','create','__esModule','maxUser','123076JkOYSf','Setting','settingModel','log','QVBFVFVMT1NCQQ==','10338762bKSZiN','find','licenseKey','5410bJonPK','@nestjs/mongoose','metadata','function','length','defineProperty','21iFplln','../common/crypto','toObject'];a125_0x14a6=function(){return _0x1ae304;};return a125_0x14a6();}var __decorate=this&&this[a125_0x172dc4(0xa5)]||function(_0xbab5e2,_0x3d0276,_0x49f3b0,_0x24a651){const _0x253339=a125_0x172dc4;var _0x1b871f=arguments['length'],_0xdcbcae=_0x1b871f<0x3?_0x3d0276:_0x24a651===null?_0x24a651=Object[_0x253339(0xa6)](_0x3d0276,_0x49f3b0):_0x24a651,_0x3a5e63;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x253339(0xcc))_0xdcbcae=Reflect[_0x253339(0xae)](_0xbab5e2,_0x3d0276,_0x49f3b0,_0x24a651);else{for(var _0x157e71=_0xbab5e2[_0x253339(0xcd)]-0x1;_0x157e71>=0x0;_0x157e71--)if(_0x3a5e63=_0xbab5e2[_0x157e71])_0xdcbcae=(_0x1b871f<0x3?_0x3a5e63(_0xdcbcae):_0x1b871f>0x3?_0x3a5e63(_0x3d0276,_0x49f3b0,_0xdcbcae):_0x3a5e63(_0x3d0276,_0x49f3b0))||_0xdcbcae;}return _0x1b871f>0x3&&_0xdcbcae&&Object[_0x253339(0xce)](_0x3d0276,_0x49f3b0,_0xdcbcae),_0xdcbcae;},__metadata=this&&this[a125_0x172dc4(0xab)]||function(_0x99d888,_0x57a375){const _0x53ea09=a125_0x172dc4;if(typeof Reflect===_0x53ea09(0x9d)&&typeof Reflect[_0x53ea09(0xcb)]===_0x53ea09(0xcc))return Reflect['metadata'](_0x99d888,_0x57a375);},__param=this&&this[a125_0x172dc4(0x9a)]||function(_0x456060,_0x3a7998){return function(_0x48382e,_0xba240d){_0x3a7998(_0x48382e,_0xba240d,_0x456060);};};Object['defineProperty'](exports,a125_0x172dc4(0xbf),{'value':!![]}),exports['SettingService']=void 0x0;const common_1=require(a125_0x172dc4(0xa4)),mongoose_1=require(a125_0x172dc4(0xca)),mongoose_2=require(a125_0x172dc4(0xd6)),CryptoJS=require(a125_0x172dc4(0xb9)),dayjs=require(a125_0x172dc4(0x99)),crypto_1=require(a125_0x172dc4(0xd0)),job_1=require('../common/job'),constants_1=require(a125_0x172dc4(0xaa)),SECRET=a125_0x172dc4(0xc5);let SettingService=class SettingService{constructor(_0xdac4db){const _0x19f2a9=a125_0x172dc4;this[_0x19f2a9(0xc3)]=_0xdac4db;}async[a125_0x172dc4(0xbe)](_0x400bd3){const _0x27bf21=a125_0x172dc4,_0x2c9191=new this[(_0x27bf21(0xc3))](_0x400bd3);return _0x2c9191['save']();}async[a125_0x172dc4(0xb0)](){const _0x3d5109=a125_0x172dc4;var _0x58f30d,_0x59f0d3,_0x1d0c9;const _0x38d3ac=await this[_0x3d5109(0xc3)][_0x3d5109(0xc7)]()[_0x3d5109(0xbb)](),_0x4cd4d5=(_0x58f30d=_0x38d3ac[0x0])===null||_0x58f30d===void 0x0?void 0x0:_0x58f30d[_0x3d5109(0xd1)]();if(!_0x4cd4d5)return;return Object[_0x3d5109(0xb6)](Object[_0x3d5109(0xb6)]({},_0x4cd4d5),{'userSetting':Object[_0x3d5109(0xb6)](Object[_0x3d5109(0xb6)]({},_0x4cd4d5['userSetting']),{'maxUser':(_0x1d0c9=(_0x59f0d3=_0x4cd4d5['userSetting'])===null||_0x59f0d3===void 0x0?void 0x0:_0x59f0d3[_0x3d5109(0xc0)])!==null&&_0x1d0c9!==void 0x0?_0x1d0c9:constants_1[_0x3d5109(0xd2)]})});}async[a125_0x172dc4(0xb7)](_0x2bd635,_0x4503cb){const _0x408dcd=a125_0x172dc4,_0xad17e2=await this['settingModel'][_0x408dcd(0xb8)](_0x2bd635,Object[_0x408dcd(0xb6)](Object[_0x408dcd(0xb6)]({},_0x4503cb),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x408dcd(0xbb)]();return _0xad17e2;}async[a125_0x172dc4(0xb1)](){const _0x3e9df4=a125_0x172dc4,_0x1de448=await this[_0x3e9df4(0xb0)](),_0x1dd9b7=this[_0x3e9df4(0xac)](_0x1de448[_0x3e9df4(0xc8)],_0x1de448[_0x3e9df4(0xa9)]);return this[_0x3e9df4(0xb7)](_0x1de448[_0x3e9df4(0xd4)],{'isExpired':!_0x1dd9b7[_0x3e9df4(0xd9)]});}async[a125_0x172dc4(0xbd)](_0x37c4a2){const _0x108a7b=a125_0x172dc4,_0x54e136=await this['findFirst']();return console[_0x108a7b(0xc4)](_0x54e136,_0x108a7b(0xd3)),this[_0x108a7b(0xb7)](_0x54e136['_id'],{'userSetting':_0x37c4a2});}[a125_0x172dc4(0xac)](_0x3638b8,_0x202e1a){const _0x471a35=a125_0x172dc4;try{if(!_0x3638b8)return{'isValid':![],'expiryDate':''};const _0x1f02ec=(0x0,crypto_1[_0x471a35(0xb4)])(_0x3638b8,CryptoJS['enc'][_0x471a35(0xa2)][_0x471a35(0xbc)](SECRET)[_0x471a35(0xad)](CryptoJS['enc']['Utf8']));if(_0x1f02ec[_0x471a35(0xa9)]!==_0x202e1a)return{'isValid':![],'expiryDate':''};const _0xc1ff36=dayjs(_0x1f02ec[_0x471a35(0xa7)],_0x471a35(0xb5))['toDate'](),_0x937e44=dayjs(_0x1f02ec['validTo'],_0x471a35(0xb5))['toDate'](),_0xdb5f88=dayjs()[_0x471a35(0xb3)]();if(_0xdb5f88<_0xc1ff36||_0xdb5f88>_0x937e44)return{'isValid':![],'expiryDate':_0x1f02ec[_0x471a35(0xaf)]};return{'isValid':!![],'expiryDate':_0x1f02ec[_0x471a35(0xaf)]};}catch(_0xc1a3c4){return{'isValid':![],'expiryDate':''};}}async['killJobs'](){const _0x56e6ac=a125_0x172dc4;job_1[_0x56e6ac(0xa8)][_0x56e6ac(0xa3)]();}};SettingService=__decorate([(0x0,common_1[a125_0x172dc4(0x9c)])(),__param(0x0,(0x0,mongoose_1[a125_0x172dc4(0xba)])(a125_0x172dc4(0xc2))),__metadata(a125_0x172dc4(0xda),[mongoose_2[a125_0x172dc4(0xd8)]])],SettingService),exports['SettingService']=SettingService;