'use strict';const a122_0x29507f=a122_0x326e;(function(_0x561a60,_0x5be6cd){const _0x3aabe0=a122_0x326e,_0x18f564=_0x561a60();while(!![]){try{const _0x9225c1=parseInt(_0x3aabe0(0x141))/0x1+-parseInt(_0x3aabe0(0x163))/0x2*(-parseInt(_0x3aabe0(0x166))/0x3)+-parseInt(_0x3aabe0(0x152))/0x4+parseInt(_0x3aabe0(0x158))/0x5+parseInt(_0x3aabe0(0x155))/0x6+-parseInt(_0x3aabe0(0x15a))/0x7+-parseInt(_0x3aabe0(0x13a))/0x8*(parseInt(_0x3aabe0(0x160))/0x9);if(_0x9225c1===_0x5be6cd)break;else _0x18f564['push'](_0x18f564['shift']());}catch(_0x5cd9d5){_0x18f564['push'](_0x18f564['shift']());}}}(a122_0x5a9c,0xa52fd));function a122_0x5a9c(){const _0x596d74=['create','Injectable','validFrom','__metadata','design:paramtypes','@nestjs/mongoose','updateUserSetting','schoolId','../common/job','parse','9868888qRpZBF','Model','toObject','length','toString','killAll','log','490276eAcCBn','exec','settingModel','assign','crypto-js','save','Setting','metadata','validTo','getOwnPropertyDescriptor','defineProperty','Utf8','setting','dayjs','function','validateLicenseKey','object','1813124CeNYJf','decorate','DD/MM/YYYY','5770362gwHedD','toDate','QVBFVFVMT1NCQQ==','1236635kkTvHc','__esModule','1019921qPAurC','InjectModel','mongoose','DEFAULT_MAX_USER','__param','update','9QoyGCA','maxUser','SettingService','1090hHrKsc','updateExpiryStatus','_id','4458YYOXXt','enc','../common/crypto','Base64','findFirst','@nestjs/common','./constants','userSetting'];a122_0x5a9c=function(){return _0x596d74;};return a122_0x5a9c();}function a122_0x326e(_0x1c77ba,_0x23e310){const _0x5a9cf6=a122_0x5a9c();return a122_0x326e=function(_0x326e31,_0x13d14c){_0x326e31=_0x326e31-0x134;let _0x50e3dc=_0x5a9cf6[_0x326e31];return _0x50e3dc;},a122_0x326e(_0x1c77ba,_0x23e310);}var __decorate=this&&this['__decorate']||function(_0x47f9c6,_0x2cde3d,_0x180bc7,_0x43749c){const _0x507f03=a122_0x326e;var _0x200a8a=arguments[_0x507f03(0x13d)],_0x334e4c=_0x200a8a<0x3?_0x2cde3d:_0x43749c===null?_0x43749c=Object[_0x507f03(0x14a)](_0x2cde3d,_0x180bc7):_0x43749c,_0x4cd367;if(typeof Reflect===_0x507f03(0x151)&&typeof Reflect['decorate']===_0x507f03(0x14f))_0x334e4c=Reflect[_0x507f03(0x153)](_0x47f9c6,_0x2cde3d,_0x180bc7,_0x43749c);else{for(var _0x5efb58=_0x47f9c6[_0x507f03(0x13d)]-0x1;_0x5efb58>=0x0;_0x5efb58--)if(_0x4cd367=_0x47f9c6[_0x5efb58])_0x334e4c=(_0x200a8a<0x3?_0x4cd367(_0x334e4c):_0x200a8a>0x3?_0x4cd367(_0x2cde3d,_0x180bc7,_0x334e4c):_0x4cd367(_0x2cde3d,_0x180bc7))||_0x334e4c;}return _0x200a8a>0x3&&_0x334e4c&&Object[_0x507f03(0x14b)](_0x2cde3d,_0x180bc7,_0x334e4c),_0x334e4c;},__metadata=this&&this[a122_0x29507f(0x171)]||function(_0x4db77c,_0x571b3c){const _0x247dc6=a122_0x29507f;if(typeof Reflect==='object'&&typeof Reflect[_0x247dc6(0x148)]===_0x247dc6(0x14f))return Reflect[_0x247dc6(0x148)](_0x4db77c,_0x571b3c);},__param=this&&this[a122_0x29507f(0x15e)]||function(_0x128667,_0x4ffd2f){return function(_0x2d16ce,_0x4f00c8){_0x4ffd2f(_0x2d16ce,_0x4f00c8,_0x128667);};};Object[a122_0x29507f(0x14b)](exports,a122_0x29507f(0x159),{'value':!![]}),exports[a122_0x29507f(0x162)]=void 0x0;const common_1=require(a122_0x29507f(0x16b)),mongoose_1=require(a122_0x29507f(0x135)),mongoose_2=require(a122_0x29507f(0x15c)),CryptoJS=require(a122_0x29507f(0x145)),dayjs=require(a122_0x29507f(0x14e)),crypto_1=require(a122_0x29507f(0x168)),job_1=require(a122_0x29507f(0x138)),constants_1=require(a122_0x29507f(0x16c)),SECRET=a122_0x29507f(0x157);let SettingService=class SettingService{constructor(_0x2333d8){const _0x353c84=a122_0x29507f;this[_0x353c84(0x143)]=_0x2333d8;}async[a122_0x29507f(0x16e)](_0x51ac9a){const _0x14360c=a122_0x29507f,_0x537b59=new this[(_0x14360c(0x143))](_0x51ac9a);return _0x537b59[_0x14360c(0x146)]();}async[a122_0x29507f(0x16a)](){const _0x10c008=a122_0x29507f;var _0x400c09,_0x2dbc10,_0x4e084b;const _0x4bc8da=await this[_0x10c008(0x143)]['find']()[_0x10c008(0x142)](),_0x139d82=(_0x400c09=_0x4bc8da[0x0])===null||_0x400c09===void 0x0?void 0x0:_0x400c09[_0x10c008(0x13c)]();if(!_0x139d82)return;return Object[_0x10c008(0x144)](Object[_0x10c008(0x144)]({},_0x139d82),{'userSetting':Object['assign'](Object['assign']({},_0x139d82[_0x10c008(0x16d)]),{'maxUser':(_0x4e084b=(_0x2dbc10=_0x139d82[_0x10c008(0x16d)])===null||_0x2dbc10===void 0x0?void 0x0:_0x2dbc10[_0x10c008(0x161)])!==null&&_0x4e084b!==void 0x0?_0x4e084b:constants_1[_0x10c008(0x15d)]})});}async[a122_0x29507f(0x15f)](_0x1d9af6,_0x436054){const _0xc4e0ee=a122_0x29507f,_0x42e8ec=await this[_0xc4e0ee(0x143)]['findByIdAndUpdate'](_0x1d9af6,Object[_0xc4e0ee(0x144)](Object[_0xc4e0ee(0x144)]({},_0x436054),{'updatedAtUtc':new Date()}),{'new':!![]})[_0xc4e0ee(0x142)]();return _0x42e8ec;}async[a122_0x29507f(0x164)](){const _0x6a9c9b=a122_0x29507f,_0x319656=await this[_0x6a9c9b(0x16a)](),_0x7c745b=this[_0x6a9c9b(0x150)](_0x319656['licenseKey'],_0x319656[_0x6a9c9b(0x137)]);return this['update'](_0x319656['_id'],{'isExpired':!_0x7c745b['isValid']});}async[a122_0x29507f(0x136)](_0x2cee2c){const _0x5dbf93=a122_0x29507f,_0x2c4404=await this[_0x5dbf93(0x16a)]();return console[_0x5dbf93(0x140)](_0x2c4404,_0x5dbf93(0x14d)),this[_0x5dbf93(0x15f)](_0x2c4404[_0x5dbf93(0x165)],{'userSetting':_0x2cee2c});}[a122_0x29507f(0x150)](_0x3fcc3b,_0x9bb509){const _0x2ea81b=a122_0x29507f;try{if(!_0x3fcc3b)return{'isValid':![],'expiryDate':''};const _0x1b4655=(0x0,crypto_1['decrypt'])(_0x3fcc3b,CryptoJS[_0x2ea81b(0x167)][_0x2ea81b(0x169)][_0x2ea81b(0x139)](SECRET)[_0x2ea81b(0x13e)](CryptoJS[_0x2ea81b(0x167)][_0x2ea81b(0x14c)]));if(_0x1b4655[_0x2ea81b(0x137)]!==_0x9bb509)return{'isValid':![],'expiryDate':''};const _0x4faaff=dayjs(_0x1b4655[_0x2ea81b(0x170)],_0x2ea81b(0x154))[_0x2ea81b(0x156)](),_0x27ccd6=dayjs(_0x1b4655['validTo'],_0x2ea81b(0x154))[_0x2ea81b(0x156)](),_0x3b37b1=dayjs()[_0x2ea81b(0x156)]();if(_0x3b37b1<_0x4faaff||_0x3b37b1>_0x27ccd6)return{'isValid':![],'expiryDate':_0x1b4655[_0x2ea81b(0x149)]};return{'isValid':!![],'expiryDate':_0x1b4655[_0x2ea81b(0x149)]};}catch(_0x5d7351){return{'isValid':![],'expiryDate':''};}}async['killJobs'](){const _0x447d11=a122_0x29507f;job_1['PROCESS_CACHE'][_0x447d11(0x13f)]();}};SettingService=__decorate([(0x0,common_1[a122_0x29507f(0x16f)])(),__param(0x0,(0x0,mongoose_1[a122_0x29507f(0x15b)])(a122_0x29507f(0x147))),__metadata(a122_0x29507f(0x134),[mongoose_2[a122_0x29507f(0x13b)]])],SettingService),exports[a122_0x29507f(0x162)]=SettingService;