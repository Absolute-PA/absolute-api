'use strict';function a122_0x249c(_0x356326,_0x183977){const _0x478600=a122_0x4786();return a122_0x249c=function(_0x249ca3,_0x2e24cd){_0x249ca3=_0x249ca3-0x1c6;let _0x620f5c=_0x478600[_0x249ca3];return _0x620f5c;},a122_0x249c(_0x356326,_0x183977);}const a122_0x3a8d4f=a122_0x249c;(function(_0x2f2341,_0x4d8ee7){const _0x1b23da=a122_0x249c,_0x5b3c57=_0x2f2341();while(!![]){try{const _0x5a463f=parseInt(_0x1b23da(0x1fa))/0x1*(parseInt(_0x1b23da(0x1ce))/0x2)+-parseInt(_0x1b23da(0x1cb))/0x3*(parseInt(_0x1b23da(0x1f5))/0x4)+parseInt(_0x1b23da(0x1da))/0x5*(-parseInt(_0x1b23da(0x1d6))/0x6)+-parseInt(_0x1b23da(0x1f4))/0x7+-parseInt(_0x1b23da(0x1eb))/0x8+-parseInt(_0x1b23da(0x1f2))/0x9+parseInt(_0x1b23da(0x1ec))/0xa;if(_0x5a463f===_0x4d8ee7)break;else _0x5b3c57['push'](_0x5b3c57['shift']());}catch(_0xbd7a12){_0x5b3c57['push'](_0x5b3c57['shift']());}}}(a122_0x4786,0x93527));var __decorate=this&&this[a122_0x3a8d4f(0x1d4)]||function(_0x90f31,_0x1c9150,_0x167da4,_0x1952f3){const _0x5b99af=a122_0x3a8d4f;var _0x5118e8=arguments[_0x5b99af(0x1ea)],_0x2284f8=_0x5118e8<0x3?_0x1c9150:_0x1952f3===null?_0x1952f3=Object[_0x5b99af(0x1e0)](_0x1c9150,_0x167da4):_0x1952f3,_0x4ebafe;if(typeof Reflect===_0x5b99af(0x1fe)&&typeof Reflect[_0x5b99af(0x1f6)]===_0x5b99af(0x1f1))_0x2284f8=Reflect[_0x5b99af(0x1f6)](_0x90f31,_0x1c9150,_0x167da4,_0x1952f3);else{for(var _0x122d0e=_0x90f31[_0x5b99af(0x1ea)]-0x1;_0x122d0e>=0x0;_0x122d0e--)if(_0x4ebafe=_0x90f31[_0x122d0e])_0x2284f8=(_0x5118e8<0x3?_0x4ebafe(_0x2284f8):_0x5118e8>0x3?_0x4ebafe(_0x1c9150,_0x167da4,_0x2284f8):_0x4ebafe(_0x1c9150,_0x167da4))||_0x2284f8;}return _0x5118e8>0x3&&_0x2284f8&&Object[_0x5b99af(0x202)](_0x1c9150,_0x167da4,_0x2284f8),_0x2284f8;},__metadata=this&&this['__metadata']||function(_0x429380,_0x1f1955){const _0x1db7c8=a122_0x3a8d4f;if(typeof Reflect===_0x1db7c8(0x1fe)&&typeof Reflect[_0x1db7c8(0x1d7)]===_0x1db7c8(0x1f1))return Reflect[_0x1db7c8(0x1d7)](_0x429380,_0x1f1955);},__param=this&&this[a122_0x3a8d4f(0x1d2)]||function(_0x157081,_0x2208fc){return function(_0x3d59c1,_0x22c0d0){_0x2208fc(_0x3d59c1,_0x22c0d0,_0x157081);};};Object[a122_0x3a8d4f(0x202)](exports,a122_0x3a8d4f(0x1c7),{'value':!![]}),exports['SettingService']=void 0x0;const common_1=require(a122_0x3a8d4f(0x1d5)),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require(a122_0x3a8d4f(0x1de)),CryptoJS=require(a122_0x3a8d4f(0x1e1)),dayjs=require(a122_0x3a8d4f(0x1d1)),crypto_1=require(a122_0x3a8d4f(0x200)),job_1=require(a122_0x3a8d4f(0x1ef)),constants_1=require(a122_0x3a8d4f(0x1f8)),SECRET=a122_0x3a8d4f(0x1e6);function a122_0x4786(){const _0x30d3f7=['DD/MM/YYYY','__decorate','@nestjs/common','2935986uiloSD','metadata','design:paramtypes','Model','10MOoiPo','assign','setting','_id','mongoose','PROCESS_CACHE','getOwnPropertyDescriptor','crypto-js','DEFAULT_MAX_USER','toDate','updateUserSetting','parse','QVBFVFVMT1NCQQ==','toString','validateLicenseKey','InjectModel','length','4027496PCuJNl','32808990jhiHZN','decrypt','settingModel','../common/job','findFirst','function','6302988ewCZqJ','maxUser','2503333jXxSLi','28LxVWtl','decorate','isValid','./constants','killAll','39243iwifyl','userSetting','findByIdAndUpdate','create','object','killJobs','../common/crypto','Setting','defineProperty','exec','__esModule','schoolId','save','validTo','512991gmkiLL','updateExpiryStatus','Base64','54OzPMxy','update','Injectable','dayjs','__param'];a122_0x4786=function(){return _0x30d3f7;};return a122_0x4786();}let SettingService=class SettingService{constructor(_0x26ec4f){const _0x53274d=a122_0x3a8d4f;this[_0x53274d(0x1ee)]=_0x26ec4f;}async[a122_0x3a8d4f(0x1fd)](_0x342365){const _0x45098a=a122_0x3a8d4f,_0x157c29=new this['settingModel'](_0x342365);return _0x157c29[_0x45098a(0x1c9)]();}async[a122_0x3a8d4f(0x1f0)](){const _0x47865f=a122_0x3a8d4f;var _0x1861b2,_0x493abd;const _0x216bcb=await this[_0x47865f(0x1ee)]['find']()[_0x47865f(0x1c6)](),_0x5d60f4=_0x216bcb[0x0]['toObject']();return Object[_0x47865f(0x1db)](Object[_0x47865f(0x1db)]({},_0x5d60f4),{'userSetting':Object[_0x47865f(0x1db)](Object[_0x47865f(0x1db)]({},_0x5d60f4['userSetting']),{'maxUser':(_0x493abd=(_0x1861b2=_0x5d60f4[_0x47865f(0x1fb)])===null||_0x1861b2===void 0x0?void 0x0:_0x1861b2[_0x47865f(0x1f3)])!==null&&_0x493abd!==void 0x0?_0x493abd:constants_1[_0x47865f(0x1e2)]})});}async[a122_0x3a8d4f(0x1cf)](_0x2befa8,_0x3eb314){const _0x18c34c=a122_0x3a8d4f,_0x1c4741=await this['settingModel'][_0x18c34c(0x1fc)](_0x2befa8,Object[_0x18c34c(0x1db)](Object['assign']({},_0x3eb314),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x18c34c(0x1c6)]();return _0x1c4741;}async[a122_0x3a8d4f(0x1cc)](){const _0x2605a9=a122_0x3a8d4f,_0xa7adfc=await this[_0x2605a9(0x1f0)](),_0x25ac6c=this[_0x2605a9(0x1e8)](_0xa7adfc['licenseKey'],_0xa7adfc[_0x2605a9(0x1c8)]);return this[_0x2605a9(0x1cf)](_0xa7adfc[_0x2605a9(0x1dd)],{'isExpired':!_0x25ac6c[_0x2605a9(0x1f7)]});}async[a122_0x3a8d4f(0x1e4)](_0xa2f7f9){const _0x201327=a122_0x3a8d4f,_0x3781f8=await this['findFirst']();return console['log'](_0x3781f8,_0x201327(0x1dc)),this[_0x201327(0x1cf)](_0x3781f8[_0x201327(0x1dd)],{'userSetting':_0xa2f7f9});}[a122_0x3a8d4f(0x1e8)](_0x2d043b,_0x8095c6){const _0x56dbe2=a122_0x3a8d4f;try{if(!_0x2d043b)return{'isValid':![],'expiryDate':''};const _0x3866c4=(0x0,crypto_1[_0x56dbe2(0x1ed)])(_0x2d043b,CryptoJS['enc'][_0x56dbe2(0x1cd)][_0x56dbe2(0x1e5)](SECRET)[_0x56dbe2(0x1e7)](CryptoJS['enc']['Utf8']));if(_0x3866c4['schoolId']!==_0x8095c6)return{'isValid':![],'expiryDate':''};const _0x3ff773=dayjs(_0x3866c4['validFrom'],_0x56dbe2(0x1d3))[_0x56dbe2(0x1e3)](),_0x5dcaed=dayjs(_0x3866c4[_0x56dbe2(0x1ca)],_0x56dbe2(0x1d3))[_0x56dbe2(0x1e3)](),_0x45834a=dayjs()[_0x56dbe2(0x1e3)]();if(_0x45834a<_0x3ff773||_0x45834a>_0x5dcaed)return{'isValid':![],'expiryDate':_0x3866c4['validTo']};return{'isValid':!![],'expiryDate':_0x3866c4[_0x56dbe2(0x1ca)]};}catch(_0x3d0255){return{'isValid':![],'expiryDate':''};}}async[a122_0x3a8d4f(0x1ff)](){const _0x29174b=a122_0x3a8d4f;job_1[_0x29174b(0x1df)][_0x29174b(0x1f9)]();}};SettingService=__decorate([(0x0,common_1[a122_0x3a8d4f(0x1d0)])(),__param(0x0,(0x0,mongoose_1[a122_0x3a8d4f(0x1e9)])(a122_0x3a8d4f(0x201))),__metadata(a122_0x3a8d4f(0x1d8),[mongoose_2[a122_0x3a8d4f(0x1d9)]])],SettingService),exports['SettingService']=SettingService;