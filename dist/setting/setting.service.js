'use strict';const a122_0x30fc62=a122_0x2e3d;function a122_0x2e3d(_0x4f47c3,_0x40d77a){const _0x729b8=a122_0x729b();return a122_0x2e3d=function(_0x2e3dcb,_0x5d05bf){_0x2e3dcb=_0x2e3dcb-0x148;let _0x4091fc=_0x729b8[_0x2e3dcb];return _0x4091fc;},a122_0x2e3d(_0x4f47c3,_0x40d77a);}function a122_0x729b(){const _0x559b02=['QVBFVFVMT1NCQQ==','validTo','userSetting','8qnWOhT','toString','DEFAULT_MAX_USER','83541hhidzW','function','3213564OPkltp','metadata','enc','toObject','decrypt','7KBsLpD','create','4304335VmRSHg','__decorate','Model','__param','DD/MM/YYYY','11vdCRby','maxUser','design:paramtypes','../common/job','setting','PROCESS_CACHE','SettingService','44GVrLIM','assign','length','28zdghau','crypto-js','decorate','__esModule','update','schoolId','log','InjectModel','findFirst','@nestjs/mongoose','licenseKey','findByIdAndUpdate','parse','Setting','mongoose','@nestjs/common','killJobs','_id','12130236rvIxIe','defineProperty','../common/crypto','Injectable','95791IVNXIB','10942810tbzHiT','validateLicenseKey','Base64','7038882BTgKwS','getOwnPropertyDescriptor','find','settingModel','toDate','updateExpiryStatus'];a122_0x729b=function(){return _0x559b02;};return a122_0x729b();}(function(_0x4ac095,_0x378d5f){const _0x5927aa=a122_0x2e3d,_0xfbd948=_0x4ac095();while(!![]){try{const _0x471d78=parseInt(_0x5927aa(0x157))/0x1*(-parseInt(_0x5927aa(0x17f))/0x2)+-parseInt(_0x5927aa(0x167))/0x3*(-parseInt(_0x5927aa(0x17c))/0x4)+parseInt(_0x5927aa(0x170))/0x5+parseInt(_0x5927aa(0x15b))/0x6*(parseInt(_0x5927aa(0x16e))/0x7)+parseInt(_0x5927aa(0x164))/0x8*(parseInt(_0x5927aa(0x153))/0x9)+-parseInt(_0x5927aa(0x158))/0xa+parseInt(_0x5927aa(0x175))/0xb*(-parseInt(_0x5927aa(0x169))/0xc);if(_0x471d78===_0x378d5f)break;else _0xfbd948['push'](_0xfbd948['shift']());}catch(_0x2bc6ca){_0xfbd948['push'](_0xfbd948['shift']());}}}(a122_0x729b,0xf0797));var __decorate=this&&this[a122_0x30fc62(0x171)]||function(_0x453ef1,_0x9f5e67,_0x2d01c9,_0x604151){const _0x33ea17=a122_0x30fc62;var _0x121b79=arguments[_0x33ea17(0x17e)],_0x11a236=_0x121b79<0x3?_0x9f5e67:_0x604151===null?_0x604151=Object[_0x33ea17(0x15c)](_0x9f5e67,_0x2d01c9):_0x604151,_0x8ccef3;if(typeof Reflect==='object'&&typeof Reflect[_0x33ea17(0x181)]===_0x33ea17(0x168))_0x11a236=Reflect[_0x33ea17(0x181)](_0x453ef1,_0x9f5e67,_0x2d01c9,_0x604151);else{for(var _0x4ac529=_0x453ef1[_0x33ea17(0x17e)]-0x1;_0x4ac529>=0x0;_0x4ac529--)if(_0x8ccef3=_0x453ef1[_0x4ac529])_0x11a236=(_0x121b79<0x3?_0x8ccef3(_0x11a236):_0x121b79>0x3?_0x8ccef3(_0x9f5e67,_0x2d01c9,_0x11a236):_0x8ccef3(_0x9f5e67,_0x2d01c9))||_0x11a236;}return _0x121b79>0x3&&_0x11a236&&Object['defineProperty'](_0x9f5e67,_0x2d01c9,_0x11a236),_0x11a236;},__metadata=this&&this['__metadata']||function(_0x4a8630,_0xafbc6d){const _0x136b92=a122_0x30fc62;if(typeof Reflect==='object'&&typeof Reflect[_0x136b92(0x16a)]===_0x136b92(0x168))return Reflect[_0x136b92(0x16a)](_0x4a8630,_0xafbc6d);},__param=this&&this[a122_0x30fc62(0x173)]||function(_0x4c1a91,_0x5b4781){return function(_0x1ec23c,_0x505048){_0x5b4781(_0x1ec23c,_0x505048,_0x4c1a91);};};Object[a122_0x30fc62(0x154)](exports,a122_0x30fc62(0x182),{'value':!![]}),exports['SettingService']=void 0x0;const common_1=require(a122_0x30fc62(0x150)),mongoose_1=require(a122_0x30fc62(0x14a)),mongoose_2=require(a122_0x30fc62(0x14f)),CryptoJS=require(a122_0x30fc62(0x180)),dayjs=require('dayjs'),crypto_1=require(a122_0x30fc62(0x155)),job_1=require(a122_0x30fc62(0x178)),constants_1=require('./constants'),SECRET=a122_0x30fc62(0x161);let SettingService=class SettingService{constructor(_0x5d1571){this['settingModel']=_0x5d1571;}async[a122_0x30fc62(0x16f)](_0x15f60b){const _0x515a5e=a122_0x30fc62,_0x40ca94=new this[(_0x515a5e(0x15e))](_0x15f60b);return _0x40ca94['save']();}async[a122_0x30fc62(0x149)](){const _0x55d30b=a122_0x30fc62;var _0x213bdb,_0x50b584,_0x6fb987;const _0x1c3287=await this[_0x55d30b(0x15e)][_0x55d30b(0x15d)]()['exec'](),_0x4d56e1=(_0x213bdb=_0x1c3287[0x0])===null||_0x213bdb===void 0x0?void 0x0:_0x213bdb[_0x55d30b(0x16c)]();if(!_0x4d56e1)return;return Object[_0x55d30b(0x17d)](Object[_0x55d30b(0x17d)]({},_0x4d56e1),{'userSetting':Object[_0x55d30b(0x17d)](Object['assign']({},_0x4d56e1[_0x55d30b(0x163)]),{'maxUser':(_0x6fb987=(_0x50b584=_0x4d56e1[_0x55d30b(0x163)])===null||_0x50b584===void 0x0?void 0x0:_0x50b584[_0x55d30b(0x176)])!==null&&_0x6fb987!==void 0x0?_0x6fb987:constants_1[_0x55d30b(0x166)]})});}async[a122_0x30fc62(0x183)](_0x2c7b77,_0x2b1ff5){const _0x42da56=a122_0x30fc62,_0x1ed529=await this[_0x42da56(0x15e)][_0x42da56(0x14c)](_0x2c7b77,Object[_0x42da56(0x17d)](Object[_0x42da56(0x17d)]({},_0x2b1ff5),{'updatedAtUtc':new Date()}),{'new':!![]})['exec']();return _0x1ed529;}async[a122_0x30fc62(0x160)](){const _0xe4042b=a122_0x30fc62,_0x4af98e=await this[_0xe4042b(0x149)](),_0x2ff9ca=this[_0xe4042b(0x159)](_0x4af98e[_0xe4042b(0x14b)],_0x4af98e[_0xe4042b(0x184)]);return this[_0xe4042b(0x183)](_0x4af98e[_0xe4042b(0x152)],{'isExpired':!_0x2ff9ca['isValid']});}async['updateUserSetting'](_0x167fb8){const _0x313aeb=a122_0x30fc62,_0x136081=await this['findFirst']();return console[_0x313aeb(0x185)](_0x136081,_0x313aeb(0x179)),this[_0x313aeb(0x183)](_0x136081[_0x313aeb(0x152)],{'userSetting':_0x167fb8});}[a122_0x30fc62(0x159)](_0x5840b8,_0x1b86de){const _0x487494=a122_0x30fc62;try{if(!_0x5840b8)return{'isValid':![],'expiryDate':''};const _0x458569=(0x0,crypto_1[_0x487494(0x16d)])(_0x5840b8,CryptoJS[_0x487494(0x16b)][_0x487494(0x15a)][_0x487494(0x14d)](SECRET)[_0x487494(0x165)](CryptoJS['enc']['Utf8']));if(_0x458569['schoolId']!==_0x1b86de)return{'isValid':![],'expiryDate':''};const _0xaca34d=dayjs(_0x458569['validFrom'],_0x487494(0x174))[_0x487494(0x15f)](),_0x5449eb=dayjs(_0x458569[_0x487494(0x162)],_0x487494(0x174))[_0x487494(0x15f)](),_0x1bad3d=dayjs()[_0x487494(0x15f)]();if(_0x1bad3d<_0xaca34d||_0x1bad3d>_0x5449eb)return{'isValid':![],'expiryDate':_0x458569[_0x487494(0x162)]};return{'isValid':!![],'expiryDate':_0x458569[_0x487494(0x162)]};}catch(_0x461eb3){return{'isValid':![],'expiryDate':''};}}async[a122_0x30fc62(0x151)](){const _0x51a7b6=a122_0x30fc62;job_1[_0x51a7b6(0x17a)]['killAll']();}};SettingService=__decorate([(0x0,common_1[a122_0x30fc62(0x156)])(),__param(0x0,(0x0,mongoose_1[a122_0x30fc62(0x148)])(a122_0x30fc62(0x14e))),__metadata(a122_0x30fc62(0x177),[mongoose_2[a122_0x30fc62(0x172)]])],SettingService),exports[a122_0x30fc62(0x17b)]=SettingService;