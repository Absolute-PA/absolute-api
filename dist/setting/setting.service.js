'use strict';function a125_0x1a16(_0x5a1729,_0x2342f0){const _0x563a8c=a125_0x563a();return a125_0x1a16=function(_0x1a1622,_0x24ebc8){_0x1a1622=_0x1a1622-0x1d6;let _0x3ebfc2=_0x563a8c[_0x1a1622];return _0x3ebfc2;},a125_0x1a16(_0x5a1729,_0x2342f0);}const a125_0x3f2f68=a125_0x1a16;(function(_0xee0a09,_0x500249){const _0x2c8995=a125_0x1a16,_0x469f70=_0xee0a09();while(!![]){try{const _0x5d4f1c=parseInt(_0x2c8995(0x1fa))/0x1+-parseInt(_0x2c8995(0x204))/0x2+parseInt(_0x2c8995(0x1f0))/0x3*(parseInt(_0x2c8995(0x1e7))/0x4)+-parseInt(_0x2c8995(0x1e3))/0x5*(-parseInt(_0x2c8995(0x1e8))/0x6)+-parseInt(_0x2c8995(0x1e4))/0x7*(parseInt(_0x2c8995(0x1f5))/0x8)+parseInt(_0x2c8995(0x1d6))/0x9+parseInt(_0x2c8995(0x20a))/0xa*(-parseInt(_0x2c8995(0x20e))/0xb);if(_0x5d4f1c===_0x500249)break;else _0x469f70['push'](_0x469f70['shift']());}catch(_0x48cd48){_0x469f70['push'](_0x469f70['shift']());}}}(a125_0x563a,0xa371c));var __decorate=this&&this[a125_0x3f2f68(0x1dd)]||function(_0x8ea2a1,_0x534770,_0x4e4c67,_0x130ca8){const _0x1a7c53=a125_0x3f2f68;var _0x10b48f=arguments[_0x1a7c53(0x1f7)],_0x2957b7=_0x10b48f<0x3?_0x534770:_0x130ca8===null?_0x130ca8=Object[_0x1a7c53(0x1eb)](_0x534770,_0x4e4c67):_0x130ca8,_0x47b593;if(typeof Reflect==='object'&&typeof Reflect[_0x1a7c53(0x1fc)]==='function')_0x2957b7=Reflect[_0x1a7c53(0x1fc)](_0x8ea2a1,_0x534770,_0x4e4c67,_0x130ca8);else{for(var _0x6ad973=_0x8ea2a1[_0x1a7c53(0x1f7)]-0x1;_0x6ad973>=0x0;_0x6ad973--)if(_0x47b593=_0x8ea2a1[_0x6ad973])_0x2957b7=(_0x10b48f<0x3?_0x47b593(_0x2957b7):_0x10b48f>0x3?_0x47b593(_0x534770,_0x4e4c67,_0x2957b7):_0x47b593(_0x534770,_0x4e4c67))||_0x2957b7;}return _0x10b48f>0x3&&_0x2957b7&&Object[_0x1a7c53(0x1db)](_0x534770,_0x4e4c67,_0x2957b7),_0x2957b7;},__metadata=this&&this[a125_0x3f2f68(0x20d)]||function(_0x554055,_0x45caf9){const _0x5928be=a125_0x3f2f68;if(typeof Reflect===_0x5928be(0x209)&&typeof Reflect[_0x5928be(0x1f8)]===_0x5928be(0x1df))return Reflect[_0x5928be(0x1f8)](_0x554055,_0x45caf9);},__param=this&&this[a125_0x3f2f68(0x1de)]||function(_0x1d25af,_0x5f6aba){return function(_0x1955b5,_0x383b0e){_0x5f6aba(_0x1955b5,_0x383b0e,_0x1d25af);};};Object[a125_0x3f2f68(0x1db)](exports,a125_0x3f2f68(0x1da),{'value':!![]}),exports['SettingService']=void 0x0;function a125_0x563a(){const _0x423e6d=['__metadata','11tqAmSD','update','../common/crypto','3698658QUSqmA','parse','findFirst','find','__esModule','defineProperty','decrypt','__decorate','__param','function','updateUserSetting','licenseKey','updateExpiryStatus','15hOIjZO','1631wycLxm','exec','mongoose','4296988ezxRlV','962994FiZlCb','validFrom','userSetting','getOwnPropertyDescriptor','Base64','schoolId','Utf8','enc','3JLcqIo','dayjs','create','Injectable','crypto-js','20712DfVWrj','toObject','length','metadata','settingModel','851525qkDxBG','DEFAULT_MAX_USER','decorate','assign','isValid','_id','log','setting','validTo','toString','562348ZICPCM','Setting','DD/MM/YYYY','QVBFVFVMT1NCQQ==','killJobs','object','12643520WcJyNt','toDate','validateLicenseKey'];a125_0x563a=function(){return _0x423e6d;};return a125_0x563a();}const common_1=require('@nestjs/common'),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require(a125_0x3f2f68(0x1e6)),CryptoJS=require(a125_0x3f2f68(0x1f4)),dayjs=require(a125_0x3f2f68(0x1f1)),crypto_1=require(a125_0x3f2f68(0x210)),job_1=require('../common/job'),constants_1=require('./constants'),SECRET=a125_0x3f2f68(0x207);let SettingService=class SettingService{constructor(_0x7ef4f2){this['settingModel']=_0x7ef4f2;}async[a125_0x3f2f68(0x1f2)](_0x430a02){const _0x5c5956=a125_0x3f2f68,_0x2b66a4=new this[(_0x5c5956(0x1f9))](_0x430a02);return _0x2b66a4['save']();}async['findFirst'](){const _0x4768d1=a125_0x3f2f68;var _0x1a8a67,_0x42658d,_0xa227ad;const _0x12bab8=await this[_0x4768d1(0x1f9)][_0x4768d1(0x1d9)]()['exec'](),_0x2d8940=(_0x1a8a67=_0x12bab8[0x0])===null||_0x1a8a67===void 0x0?void 0x0:_0x1a8a67[_0x4768d1(0x1f6)]();if(!_0x2d8940)return;return Object[_0x4768d1(0x1fd)](Object[_0x4768d1(0x1fd)]({},_0x2d8940),{'userSetting':Object[_0x4768d1(0x1fd)](Object['assign']({},_0x2d8940[_0x4768d1(0x1ea)]),{'maxUser':(_0xa227ad=(_0x42658d=_0x2d8940['userSetting'])===null||_0x42658d===void 0x0?void 0x0:_0x42658d['maxUser'])!==null&&_0xa227ad!==void 0x0?_0xa227ad:constants_1[_0x4768d1(0x1fb)]})});}async[a125_0x3f2f68(0x20f)](_0x1cb7f9,_0x3f0cc8){const _0x13929a=a125_0x3f2f68,_0x583925=await this[_0x13929a(0x1f9)]['findByIdAndUpdate'](_0x1cb7f9,Object[_0x13929a(0x1fd)](Object['assign']({},_0x3f0cc8),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x13929a(0x1e5)]();return _0x583925;}async[a125_0x3f2f68(0x1e2)](){const _0xb1de93=a125_0x3f2f68,_0x43011a=await this[_0xb1de93(0x1d8)](),_0x43f6c0=this[_0xb1de93(0x20c)](_0x43011a[_0xb1de93(0x1e1)],_0x43011a[_0xb1de93(0x1ed)]);return this[_0xb1de93(0x20f)](_0x43011a[_0xb1de93(0x1ff)],{'isExpired':!_0x43f6c0[_0xb1de93(0x1fe)]});}async[a125_0x3f2f68(0x1e0)](_0x5b1e8a){const _0xb9274f=a125_0x3f2f68,_0x229d20=await this[_0xb9274f(0x1d8)]();return console[_0xb9274f(0x200)](_0x229d20,_0xb9274f(0x201)),this[_0xb9274f(0x20f)](_0x229d20[_0xb9274f(0x1ff)],{'userSetting':_0x5b1e8a});}['validateLicenseKey'](_0x236eea,_0x12be7d){const _0x3b9730=a125_0x3f2f68;try{if(!_0x236eea)return{'isValid':![],'expiryDate':''};const _0x442982=(0x0,crypto_1[_0x3b9730(0x1dc)])(_0x236eea,CryptoJS[_0x3b9730(0x1ef)][_0x3b9730(0x1ec)][_0x3b9730(0x1d7)](SECRET)[_0x3b9730(0x203)](CryptoJS[_0x3b9730(0x1ef)][_0x3b9730(0x1ee)]));if(_0x442982[_0x3b9730(0x1ed)]!==_0x12be7d)return{'isValid':![],'expiryDate':''};const _0x4fd2d5=dayjs(_0x442982[_0x3b9730(0x1e9)],'DD/MM/YYYY')[_0x3b9730(0x20b)](),_0x3fab78=dayjs(_0x442982[_0x3b9730(0x202)],_0x3b9730(0x206))[_0x3b9730(0x20b)](),_0x1ea400=dayjs()['toDate']();if(_0x1ea400<_0x4fd2d5||_0x1ea400>_0x3fab78)return{'isValid':![],'expiryDate':_0x442982[_0x3b9730(0x202)]};return{'isValid':!![],'expiryDate':_0x442982[_0x3b9730(0x202)]};}catch(_0x5a049a){return{'isValid':![],'expiryDate':''};}}async[a125_0x3f2f68(0x208)](){job_1['PROCESS_CACHE']['killAll']();}};SettingService=__decorate([(0x0,common_1[a125_0x3f2f68(0x1f3)])(),__param(0x0,(0x0,mongoose_1['InjectModel'])(a125_0x3f2f68(0x205))),__metadata('design:paramtypes',[mongoose_2['Model']])],SettingService),exports['SettingService']=SettingService;