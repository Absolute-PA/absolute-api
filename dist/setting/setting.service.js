'use strict';const a125_0x4bc3ca=a125_0x4736;function a125_0x4736(_0x207c11,_0x4a511c){const _0x1a2ae7=a125_0x1a2a();return a125_0x4736=function(_0x473674,_0x290d43){_0x473674=_0x473674-0xef;let _0x5264c8=_0x1a2ae7[_0x473674];return _0x5264c8;},a125_0x4736(_0x207c11,_0x4a511c);}(function(_0x56c88a,_0x43e4bf){const _0x3872a5=a125_0x4736,_0x25d8c5=_0x56c88a();while(!![]){try{const _0x2ba135=-parseInt(_0x3872a5(0x119))/0x1*(-parseInt(_0x3872a5(0x115))/0x2)+-parseInt(_0x3872a5(0xfc))/0x3+parseInt(_0x3872a5(0x100))/0x4+parseInt(_0x3872a5(0x10a))/0x5*(parseInt(_0x3872a5(0xf2))/0x6)+parseInt(_0x3872a5(0xef))/0x7*(-parseInt(_0x3872a5(0x10e))/0x8)+parseInt(_0x3872a5(0x122))/0x9*(-parseInt(_0x3872a5(0xf1))/0xa)+parseInt(_0x3872a5(0x121))/0xb;if(_0x2ba135===_0x43e4bf)break;else _0x25d8c5['push'](_0x25d8c5['shift']());}catch(_0x5034fc){_0x25d8c5['push'](_0x25d8c5['shift']());}}}(a125_0x1a2a,0x779e8));var __decorate=this&&this[a125_0x4bc3ca(0x108)]||function(_0x41c000,_0x1d0ce5,_0x350cb4,_0x57bb72){const _0xdfe374=a125_0x4bc3ca;var _0x12c2f4=arguments[_0xdfe374(0x109)],_0x2104a8=_0x12c2f4<0x3?_0x1d0ce5:_0x57bb72===null?_0x57bb72=Object['getOwnPropertyDescriptor'](_0x1d0ce5,_0x350cb4):_0x57bb72,_0x390d02;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0xdfe374(0x11b))_0x2104a8=Reflect['decorate'](_0x41c000,_0x1d0ce5,_0x350cb4,_0x57bb72);else{for(var _0x3797cd=_0x41c000[_0xdfe374(0x109)]-0x1;_0x3797cd>=0x0;_0x3797cd--)if(_0x390d02=_0x41c000[_0x3797cd])_0x2104a8=(_0x12c2f4<0x3?_0x390d02(_0x2104a8):_0x12c2f4>0x3?_0x390d02(_0x1d0ce5,_0x350cb4,_0x2104a8):_0x390d02(_0x1d0ce5,_0x350cb4))||_0x2104a8;}return _0x12c2f4>0x3&&_0x2104a8&&Object[_0xdfe374(0x10c)](_0x1d0ce5,_0x350cb4,_0x2104a8),_0x2104a8;},__metadata=this&&this['__metadata']||function(_0x2aaacd,_0x3ef554){const _0x1c7036=a125_0x4bc3ca;if(typeof Reflect==='object'&&typeof Reflect['metadata']==='function')return Reflect[_0x1c7036(0x11d)](_0x2aaacd,_0x3ef554);},__param=this&&this['__param']||function(_0x1ff23f,_0x515e28){return function(_0x30e413,_0x3d4c74){_0x515e28(_0x30e413,_0x3d4c74,_0x1ff23f);};};Object[a125_0x4bc3ca(0x10c)](exports,a125_0x4bc3ca(0x10f),{'value':!![]}),exports[a125_0x4bc3ca(0x107)]=void 0x0;const common_1=require(a125_0x4bc3ca(0x113)),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require(a125_0x4bc3ca(0x104)),CryptoJS=require('crypto-js'),dayjs=require('dayjs'),crypto_1=require(a125_0x4bc3ca(0x118)),job_1=require(a125_0x4bc3ca(0xf9)),constants_1=require(a125_0x4bc3ca(0xfa)),SECRET=a125_0x4bc3ca(0x112);let SettingService=class SettingService{constructor(_0x109d1c){const _0x3bd080=a125_0x4bc3ca;this[_0x3bd080(0x110)]=_0x109d1c;}async[a125_0x4bc3ca(0x126)](_0x125717){const _0x20150d=a125_0x4bc3ca,_0x4c7e81=new this[(_0x20150d(0x110))](_0x125717);return _0x4c7e81[_0x20150d(0x114)]();}async[a125_0x4bc3ca(0xfb)](){const _0x28c582=a125_0x4bc3ca;var _0xc2bbc0,_0x26f082,_0x3f8c97;const _0x19c772=await this[_0x28c582(0x110)][_0x28c582(0x117)]()['exec'](),_0x3b325d=(_0xc2bbc0=_0x19c772[0x0])===null||_0xc2bbc0===void 0x0?void 0x0:_0xc2bbc0[_0x28c582(0xf8)]();if(!_0x3b325d)return;return Object[_0x28c582(0x11c)](Object['assign']({},_0x3b325d),{'userSetting':Object[_0x28c582(0x11c)](Object['assign']({},_0x3b325d['userSetting']),{'maxUser':(_0x3f8c97=(_0x26f082=_0x3b325d['userSetting'])===null||_0x26f082===void 0x0?void 0x0:_0x26f082['maxUser'])!==null&&_0x3f8c97!==void 0x0?_0x3f8c97:constants_1['DEFAULT_MAX_USER']})});}async['update'](_0x2cbdad,_0x49eafb){const _0x3571d7=a125_0x4bc3ca,_0x1d0e91=await this[_0x3571d7(0x110)][_0x3571d7(0x123)](_0x2cbdad,Object[_0x3571d7(0x11c)](Object['assign']({},_0x49eafb),{'updatedAtUtc':new Date()}),{'new':!![]})['exec']();return _0x1d0e91;}async[a125_0x4bc3ca(0x106)](){const _0x13c890=a125_0x4bc3ca,_0x4debef=await this[_0x13c890(0xfb)](),_0x460b31=this['validateLicenseKey'](_0x4debef[_0x13c890(0x102)],_0x4debef[_0x13c890(0x103)]);return this['update'](_0x4debef[_0x13c890(0x101)],{'isExpired':!_0x460b31['isValid']});}async[a125_0x4bc3ca(0x125)](_0x344563){const _0x462068=a125_0x4bc3ca,_0x5ed462=await this[_0x462068(0xfb)]();return console[_0x462068(0xf0)](_0x5ed462,_0x462068(0xfe)),this[_0x462068(0xf5)](_0x5ed462['_id'],{'userSetting':_0x344563});}[a125_0x4bc3ca(0x124)](_0x1db685,_0x1c2bc1){const _0x5d65fa=a125_0x4bc3ca;try{if(!_0x1db685)return{'isValid':![],'expiryDate':''};const _0x1d90bb=(0x0,crypto_1['decrypt'])(_0x1db685,CryptoJS[_0x5d65fa(0xf3)][_0x5d65fa(0xf6)][_0x5d65fa(0x116)](SECRET)[_0x5d65fa(0x10b)](CryptoJS[_0x5d65fa(0xf3)][_0x5d65fa(0xfd)]));if(_0x1d90bb[_0x5d65fa(0x103)]!==_0x1c2bc1)return{'isValid':![],'expiryDate':''};const _0x576625=dayjs(_0x1d90bb[_0x5d65fa(0xff)],_0x5d65fa(0xf4))[_0x5d65fa(0x11e)](),_0x498c05=dayjs(_0x1d90bb['validTo'],_0x5d65fa(0xf4))[_0x5d65fa(0x11e)](),_0xb1b270=dayjs()[_0x5d65fa(0x11e)]();if(_0xb1b270<_0x576625||_0xb1b270>_0x498c05)return{'isValid':![],'expiryDate':_0x1d90bb[_0x5d65fa(0x120)]};return{'isValid':!![],'expiryDate':_0x1d90bb['validTo']};}catch(_0x5f4d7a){return{'isValid':![],'expiryDate':''};}}async[a125_0x4bc3ca(0x11f)](){const _0x1f9a38=a125_0x4bc3ca;job_1[_0x1f9a38(0x105)][_0x1f9a38(0x11a)]();}};function a125_0x1a2a(){const _0xa28093=['1904qBVrrL','__esModule','settingModel','Model','QVBFVFVMT1NCQQ==','@nestjs/common','save','97318KotrBk','parse','find','../common/crypto','11vxGBhi','killAll','function','assign','metadata','toDate','killJobs','validTo','1234431KcVdcf','9YemJYs','findByIdAndUpdate','validateLicenseKey','updateUserSetting','create','2933ilVFPb','log','2625830DwYubb','4320714dcMJEx','enc','DD/MM/YYYY','update','Base64','InjectModel','toObject','../common/job','./constants','findFirst','1763475MFrYgL','Utf8','setting','validFrom','290004GlxYSk','_id','licenseKey','schoolId','mongoose','PROCESS_CACHE','updateExpiryStatus','SettingService','__decorate','length','5GafiYC','toString','defineProperty','Injectable'];a125_0x1a2a=function(){return _0xa28093;};return a125_0x1a2a();}SettingService=__decorate([(0x0,common_1[a125_0x4bc3ca(0x10d)])(),__param(0x0,(0x0,mongoose_1[a125_0x4bc3ca(0xf7)])('Setting')),__metadata('design:paramtypes',[mongoose_2[a125_0x4bc3ca(0x111)]])],SettingService),exports[a125_0x4bc3ca(0x107)]=SettingService;