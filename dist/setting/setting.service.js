'use strict';const a122_0x3f3b02=a122_0x1242;function a122_0x1242(_0x553ef4,_0x1b7122){const _0x4906bb=a122_0x4906();return a122_0x1242=function(_0x1242ca,_0x39d7a9){_0x1242ca=_0x1242ca-0x143;let _0x3fbce6=_0x4906bb[_0x1242ca];return _0x3fbce6;},a122_0x1242(_0x553ef4,_0x1b7122);}(function(_0x24903d,_0x12010a){const _0x3645e0=a122_0x1242,_0x552ac7=_0x24903d();while(!![]){try{const _0x58922d=parseInt(_0x3645e0(0x155))/0x1+parseInt(_0x3645e0(0x168))/0x2+parseInt(_0x3645e0(0x174))/0x3*(-parseInt(_0x3645e0(0x161))/0x4)+parseInt(_0x3645e0(0x16c))/0x5*(-parseInt(_0x3645e0(0x172))/0x6)+parseInt(_0x3645e0(0x144))/0x7+parseInt(_0x3645e0(0x164))/0x8*(-parseInt(_0x3645e0(0x159))/0x9)+parseInt(_0x3645e0(0x16a))/0xa*(parseInt(_0x3645e0(0x171))/0xb);if(_0x58922d===_0x12010a)break;else _0x552ac7['push'](_0x552ac7['shift']());}catch(_0x561f4e){_0x552ac7['push'](_0x552ac7['shift']());}}}(a122_0x4906,0xd5f5c));function a122_0x4906(){const _0x551991=['defineProperty','6flRGpC','getOwnPropertyDescriptor','killJobs','save','__decorate','mongoose','@nestjs/mongoose','__esModule','InjectModel','log','1702050QczUna','length','toObject','DEFAULT_MAX_USER','DD/MM/YYYY','metadata','decorate','schoolId','__metadata','./constants','validateLicenseKey','userSetting','findFirst','toString','parse','exec','enc','839749WRshbe','Injectable','settingModel','maxUser','15542118nbxkmc','Base64','__param','licenseKey','dayjs','@nestjs/common','validTo','updateUserSetting','3208556hVxhKO','assign','object','8vYUaog','Utf8','../common/crypto','isValid','2321180fkKViE','toDate','4020100huvKlj','SettingService','10095XkUHjb','Model','update','../common/job','setting','77WqoEVr','2526rSAUbY'];a122_0x4906=function(){return _0x551991;};return a122_0x4906();}var __decorate=this&&this[a122_0x3f3b02(0x178)]||function(_0x48522a,_0x1a8cca,_0x11f19f,_0x3affe0){const _0x2c45ef=a122_0x3f3b02;var _0x56c900=arguments[_0x2c45ef(0x145)],_0x582ccb=_0x56c900<0x3?_0x1a8cca:_0x3affe0===null?_0x3affe0=Object[_0x2c45ef(0x175)](_0x1a8cca,_0x11f19f):_0x3affe0,_0x3a259e;if(typeof Reflect==='object'&&typeof Reflect[_0x2c45ef(0x14a)]==='function')_0x582ccb=Reflect[_0x2c45ef(0x14a)](_0x48522a,_0x1a8cca,_0x11f19f,_0x3affe0);else{for(var _0x943ed=_0x48522a[_0x2c45ef(0x145)]-0x1;_0x943ed>=0x0;_0x943ed--)if(_0x3a259e=_0x48522a[_0x943ed])_0x582ccb=(_0x56c900<0x3?_0x3a259e(_0x582ccb):_0x56c900>0x3?_0x3a259e(_0x1a8cca,_0x11f19f,_0x582ccb):_0x3a259e(_0x1a8cca,_0x11f19f))||_0x582ccb;}return _0x56c900>0x3&&_0x582ccb&&Object[_0x2c45ef(0x173)](_0x1a8cca,_0x11f19f,_0x582ccb),_0x582ccb;},__metadata=this&&this[a122_0x3f3b02(0x14c)]||function(_0x2465c1,_0x5aec17){const _0x28da78=a122_0x3f3b02;if(typeof Reflect===_0x28da78(0x163)&&typeof Reflect['metadata']==='function')return Reflect[_0x28da78(0x149)](_0x2465c1,_0x5aec17);},__param=this&&this[a122_0x3f3b02(0x15b)]||function(_0x532886,_0xdbc60){return function(_0x3151da,_0x3e6451){_0xdbc60(_0x3151da,_0x3e6451,_0x532886);};};Object['defineProperty'](exports,a122_0x3f3b02(0x17b),{'value':!![]}),exports[a122_0x3f3b02(0x16b)]=void 0x0;const common_1=require(a122_0x3f3b02(0x15e)),mongoose_1=require(a122_0x3f3b02(0x17a)),mongoose_2=require(a122_0x3f3b02(0x179)),CryptoJS=require('crypto-js'),dayjs=require(a122_0x3f3b02(0x15d)),crypto_1=require(a122_0x3f3b02(0x166)),job_1=require(a122_0x3f3b02(0x16f)),constants_1=require(a122_0x3f3b02(0x14d)),SECRET='QVBFVFVMT1NCQQ==';let SettingService=class SettingService{constructor(_0x3a500b){this['settingModel']=_0x3a500b;}async['create'](_0x24b741){const _0x5b060e=a122_0x3f3b02,_0x3a8b68=new this[(_0x5b060e(0x157))](_0x24b741);return _0x3a8b68[_0x5b060e(0x177)]();}async[a122_0x3f3b02(0x150)](){const _0x50b851=a122_0x3f3b02;var _0x218302,_0x406d57,_0x5fd1a7;const _0x20e9d5=await this[_0x50b851(0x157)]['find']()[_0x50b851(0x153)](),_0x5e11ea=(_0x218302=_0x20e9d5[0x0])===null||_0x218302===void 0x0?void 0x0:_0x218302[_0x50b851(0x146)]();if(!_0x5e11ea)return;return Object[_0x50b851(0x162)](Object[_0x50b851(0x162)]({},_0x5e11ea),{'userSetting':Object['assign'](Object[_0x50b851(0x162)]({},_0x5e11ea['userSetting']),{'maxUser':(_0x5fd1a7=(_0x406d57=_0x5e11ea[_0x50b851(0x14f)])===null||_0x406d57===void 0x0?void 0x0:_0x406d57[_0x50b851(0x158)])!==null&&_0x5fd1a7!==void 0x0?_0x5fd1a7:constants_1[_0x50b851(0x147)]})});}async[a122_0x3f3b02(0x16e)](_0xac2240,_0x3cc15e){const _0x1cc3bb=a122_0x3f3b02,_0x20e9bd=await this[_0x1cc3bb(0x157)]['findByIdAndUpdate'](_0xac2240,Object[_0x1cc3bb(0x162)](Object[_0x1cc3bb(0x162)]({},_0x3cc15e),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x1cc3bb(0x153)]();return _0x20e9bd;}async['updateExpiryStatus'](){const _0x32c428=a122_0x3f3b02,_0x26b662=await this[_0x32c428(0x150)](),_0x1b48f9=this[_0x32c428(0x14e)](_0x26b662[_0x32c428(0x15c)],_0x26b662['schoolId']);return this['update'](_0x26b662['_id'],{'isExpired':!_0x1b48f9[_0x32c428(0x167)]});}async[a122_0x3f3b02(0x160)](_0x4c14e0){const _0x3bc53d=a122_0x3f3b02,_0x316bd9=await this[_0x3bc53d(0x150)]();return console[_0x3bc53d(0x143)](_0x316bd9,_0x3bc53d(0x170)),this['update'](_0x316bd9['_id'],{'userSetting':_0x4c14e0});}[a122_0x3f3b02(0x14e)](_0x2d6f04,_0x40e307){const _0x3c2569=a122_0x3f3b02;try{if(!_0x2d6f04)return{'isValid':![],'expiryDate':''};const _0xddcbee=(0x0,crypto_1['decrypt'])(_0x2d6f04,CryptoJS[_0x3c2569(0x154)][_0x3c2569(0x15a)][_0x3c2569(0x152)](SECRET)[_0x3c2569(0x151)](CryptoJS[_0x3c2569(0x154)][_0x3c2569(0x165)]));if(_0xddcbee[_0x3c2569(0x14b)]!==_0x40e307)return{'isValid':![],'expiryDate':''};const _0x53df0f=dayjs(_0xddcbee['validFrom'],_0x3c2569(0x148))[_0x3c2569(0x169)](),_0x49e98e=dayjs(_0xddcbee['validTo'],_0x3c2569(0x148))[_0x3c2569(0x169)](),_0x512a67=dayjs()[_0x3c2569(0x169)]();if(_0x512a67<_0x53df0f||_0x512a67>_0x49e98e)return{'isValid':![],'expiryDate':_0xddcbee[_0x3c2569(0x15f)]};return{'isValid':!![],'expiryDate':_0xddcbee[_0x3c2569(0x15f)]};}catch(_0x535dbc){return{'isValid':![],'expiryDate':''};}}async[a122_0x3f3b02(0x176)](){job_1['PROCESS_CACHE']['killAll']();}};SettingService=__decorate([(0x0,common_1[a122_0x3f3b02(0x156)])(),__param(0x0,(0x0,mongoose_1[a122_0x3f3b02(0x17c)])('Setting')),__metadata('design:paramtypes',[mongoose_2[a122_0x3f3b02(0x16d)]])],SettingService),exports['SettingService']=SettingService;