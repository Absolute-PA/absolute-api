'use strict';const a122_0x73b2d5=a122_0x10e8;function a122_0x5952(){const _0x4ef4a8=['__metadata','log','__param','@nestjs/common','mongoose','2058778ZAKJQp','./constants','getOwnPropertyDescriptor','schoolId','QVBFVFVMT1NCQQ==','2954HBfhMF','defineProperty','userSetting','Base64','parse','function','../common/crypto','assign','517NlThDZ','94376KXSepb','5008sEHbPk','Model','Setting','toString','Injectable','6620mclEkA','design:paramtypes','setting','SettingService','1416474OYKcIG','_id','364324jYIiWk','enc','findByIdAndUpdate','findFirst','update','licenseKey','exec','validTo','create','settingModel','33BapXRN','InjectModel','updateUserSetting','__esModule','50bhPIWC','Utf8','dayjs','save','object','killJobs','metadata','334272cfrwPM','decorate','DD/MM/YYYY','killAll','toDate','crypto-js','validFrom','decrypt'];a122_0x5952=function(){return _0x4ef4a8;};return a122_0x5952();}function a122_0x10e8(_0x1bd9c0,_0x299e4e){const _0x595283=a122_0x5952();return a122_0x10e8=function(_0x10e829,_0x2761b8){_0x10e829=_0x10e829-0x119;let _0x5d1106=_0x595283[_0x10e829];return _0x5d1106;},a122_0x10e8(_0x1bd9c0,_0x299e4e);}(function(_0x282c14,_0x597364){const _0xdd9e94=a122_0x10e8,_0x1f5187=_0x282c14();while(!![]){try{const _0x3c165b=parseInt(_0xdd9e94(0x121))/0x1+parseInt(_0xdd9e94(0x14f))/0x2+-parseInt(_0xdd9e94(0x137))/0x3*(parseInt(_0xdd9e94(0x12d))/0x4)+parseInt(_0xdd9e94(0x13b))/0x5*(parseInt(_0xdd9e94(0x142))/0x6)+-parseInt(_0xdd9e94(0x154))/0x7*(parseInt(_0xdd9e94(0x122))/0x8)+parseInt(_0xdd9e94(0x12b))/0x9+-parseInt(_0xdd9e94(0x127))/0xa*(parseInt(_0xdd9e94(0x120))/0xb);if(_0x3c165b===_0x597364)break;else _0x1f5187['push'](_0x1f5187['shift']());}catch(_0x68dc0d){_0x1f5187['push'](_0x1f5187['shift']());}}}(a122_0x5952,0x841a6));var __decorate=this&&this['__decorate']||function(_0x2a54c1,_0x556ce3,_0x1cf70f,_0xce7c75){const _0x5615cb=a122_0x10e8;var _0xaec18e=arguments['length'],_0x49996d=_0xaec18e<0x3?_0x556ce3:_0xce7c75===null?_0xce7c75=Object[_0x5615cb(0x151)](_0x556ce3,_0x1cf70f):_0xce7c75,_0x119490;if(typeof Reflect===_0x5615cb(0x13f)&&typeof Reflect['decorate']===_0x5615cb(0x11d))_0x49996d=Reflect[_0x5615cb(0x143)](_0x2a54c1,_0x556ce3,_0x1cf70f,_0xce7c75);else{for(var _0x5454ba=_0x2a54c1['length']-0x1;_0x5454ba>=0x0;_0x5454ba--)if(_0x119490=_0x2a54c1[_0x5454ba])_0x49996d=(_0xaec18e<0x3?_0x119490(_0x49996d):_0xaec18e>0x3?_0x119490(_0x556ce3,_0x1cf70f,_0x49996d):_0x119490(_0x556ce3,_0x1cf70f))||_0x49996d;}return _0xaec18e>0x3&&_0x49996d&&Object['defineProperty'](_0x556ce3,_0x1cf70f,_0x49996d),_0x49996d;},__metadata=this&&this[a122_0x73b2d5(0x14a)]||function(_0x14dac5,_0x10d666){const _0x1fd829=a122_0x73b2d5;if(typeof Reflect==='object'&&typeof Reflect[_0x1fd829(0x141)]===_0x1fd829(0x11d))return Reflect[_0x1fd829(0x141)](_0x14dac5,_0x10d666);},__param=this&&this[a122_0x73b2d5(0x14c)]||function(_0x4f3d2e,_0x446997){return function(_0x3320b8,_0x1371a5){_0x446997(_0x3320b8,_0x1371a5,_0x4f3d2e);};};Object[a122_0x73b2d5(0x119)](exports,a122_0x73b2d5(0x13a),{'value':!![]}),exports[a122_0x73b2d5(0x12a)]=void 0x0;const common_1=require(a122_0x73b2d5(0x14d)),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require(a122_0x73b2d5(0x14e)),CryptoJS=require(a122_0x73b2d5(0x147)),dayjs=require(a122_0x73b2d5(0x13d)),crypto_1=require(a122_0x73b2d5(0x11e)),job_1=require('../common/job'),constants_1=require(a122_0x73b2d5(0x150)),SECRET=a122_0x73b2d5(0x153);let SettingService=class SettingService{constructor(_0x1d473e){const _0x115b59=a122_0x73b2d5;this[_0x115b59(0x136)]=_0x1d473e;}async[a122_0x73b2d5(0x135)](_0x391335){const _0x2ac7ef=a122_0x73b2d5,_0xc101a2=new this[(_0x2ac7ef(0x136))](_0x391335);return _0xc101a2[_0x2ac7ef(0x13e)]();}async[a122_0x73b2d5(0x130)](){const _0x290e4c=a122_0x73b2d5;var _0x2f6c4a,_0x3cd511,_0x34c958;const _0x3739ae=await this[_0x290e4c(0x136)]['find']()[_0x290e4c(0x133)](),_0x255cad=(_0x2f6c4a=_0x3739ae[0x0])===null||_0x2f6c4a===void 0x0?void 0x0:_0x2f6c4a['toObject']();return Object['assign'](Object[_0x290e4c(0x11f)]({},_0x255cad),{'userSetting':Object[_0x290e4c(0x11f)](Object[_0x290e4c(0x11f)]({},_0x255cad[_0x290e4c(0x11a)]),{'maxUser':(_0x34c958=(_0x3cd511=_0x255cad[_0x290e4c(0x11a)])===null||_0x3cd511===void 0x0?void 0x0:_0x3cd511['maxUser'])!==null&&_0x34c958!==void 0x0?_0x34c958:constants_1['DEFAULT_MAX_USER']})});}async['update'](_0x3ed521,_0xd34540){const _0x5328cc=a122_0x73b2d5,_0x456097=await this['settingModel'][_0x5328cc(0x12f)](_0x3ed521,Object['assign'](Object['assign']({},_0xd34540),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x5328cc(0x133)]();return _0x456097;}async['updateExpiryStatus'](){const _0x2f524b=a122_0x73b2d5,_0xf3665a=await this['findFirst'](),_0x150a59=this['validateLicenseKey'](_0xf3665a[_0x2f524b(0x132)],_0xf3665a[_0x2f524b(0x152)]);return this['update'](_0xf3665a[_0x2f524b(0x12c)],{'isExpired':!_0x150a59['isValid']});}async[a122_0x73b2d5(0x139)](_0x5d8d67){const _0x36b735=a122_0x73b2d5,_0x4945cf=await this[_0x36b735(0x130)]();return console[_0x36b735(0x14b)](_0x4945cf,_0x36b735(0x129)),this[_0x36b735(0x131)](_0x4945cf['_id'],{'userSetting':_0x5d8d67});}['validateLicenseKey'](_0x4adbd7,_0x2f837a){const _0x2802da=a122_0x73b2d5;try{if(!_0x4adbd7)return{'isValid':![],'expiryDate':''};const _0x63c862=(0x0,crypto_1[_0x2802da(0x149)])(_0x4adbd7,CryptoJS[_0x2802da(0x12e)][_0x2802da(0x11b)][_0x2802da(0x11c)](SECRET)[_0x2802da(0x125)](CryptoJS['enc'][_0x2802da(0x13c)]));if(_0x63c862['schoolId']!==_0x2f837a)return{'isValid':![],'expiryDate':''};const _0x38617e=dayjs(_0x63c862[_0x2802da(0x148)],'DD/MM/YYYY')['toDate'](),_0x572a6c=dayjs(_0x63c862[_0x2802da(0x134)],_0x2802da(0x144))[_0x2802da(0x146)](),_0x113d79=dayjs()[_0x2802da(0x146)]();if(_0x113d79<_0x38617e||_0x113d79>_0x572a6c)return{'isValid':![],'expiryDate':_0x63c862[_0x2802da(0x134)]};return{'isValid':!![],'expiryDate':_0x63c862[_0x2802da(0x134)]};}catch(_0x1e562a){return{'isValid':![],'expiryDate':''};}}async[a122_0x73b2d5(0x140)](){const _0xa44cad=a122_0x73b2d5;job_1['PROCESS_CACHE'][_0xa44cad(0x145)]();}};SettingService=__decorate([(0x0,common_1[a122_0x73b2d5(0x126)])(),__param(0x0,(0x0,mongoose_1[a122_0x73b2d5(0x138)])(a122_0x73b2d5(0x124))),__metadata(a122_0x73b2d5(0x128),[mongoose_2[a122_0x73b2d5(0x123)]])],SettingService),exports['SettingService']=SettingService;