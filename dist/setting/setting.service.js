'use strict';const a125_0x5bfaf5=a125_0x4d20;(function(_0x588261,_0x1c04df){const _0x5ea6fe=a125_0x4d20,_0x6bc1b8=_0x588261();while(!![]){try{const _0x4fe080=-parseInt(_0x5ea6fe(0x18a))/0x1*(-parseInt(_0x5ea6fe(0x18d))/0x2)+parseInt(_0x5ea6fe(0x193))/0x3*(-parseInt(_0x5ea6fe(0x16e))/0x4)+parseInt(_0x5ea6fe(0x183))/0x5+parseInt(_0x5ea6fe(0x180))/0x6+-parseInt(_0x5ea6fe(0x19d))/0x7*(parseInt(_0x5ea6fe(0x16d))/0x8)+parseInt(_0x5ea6fe(0x17a))/0x9*(-parseInt(_0x5ea6fe(0x194))/0xa)+-parseInt(_0x5ea6fe(0x177))/0xb*(-parseInt(_0x5ea6fe(0x17f))/0xc);if(_0x4fe080===_0x1c04df)break;else _0x6bc1b8['push'](_0x6bc1b8['shift']());}catch(_0x4898c8){_0x6bc1b8['push'](_0x6bc1b8['shift']());}}}(a125_0x2ae4,0xd735a));var __decorate=this&&this['__decorate']||function(_0x140b42,_0x4f3887,_0x1ea6e6,_0x49b162){const _0x15a8ac=a125_0x4d20;var _0x4f7760=arguments['length'],_0x387b51=_0x4f7760<0x3?_0x4f3887:_0x49b162===null?_0x49b162=Object[_0x15a8ac(0x17e)](_0x4f3887,_0x1ea6e6):_0x49b162,_0x49b536;if(typeof Reflect===_0x15a8ac(0x174)&&typeof Reflect[_0x15a8ac(0x191)]===_0x15a8ac(0x190))_0x387b51=Reflect['decorate'](_0x140b42,_0x4f3887,_0x1ea6e6,_0x49b162);else{for(var _0x699749=_0x140b42[_0x15a8ac(0x19b)]-0x1;_0x699749>=0x0;_0x699749--)if(_0x49b536=_0x140b42[_0x699749])_0x387b51=(_0x4f7760<0x3?_0x49b536(_0x387b51):_0x4f7760>0x3?_0x49b536(_0x4f3887,_0x1ea6e6,_0x387b51):_0x49b536(_0x4f3887,_0x1ea6e6))||_0x387b51;}return _0x4f7760>0x3&&_0x387b51&&Object[_0x15a8ac(0x16b)](_0x4f3887,_0x1ea6e6,_0x387b51),_0x387b51;},__metadata=this&&this[a125_0x5bfaf5(0x18b)]||function(_0x33e353,_0xc527bd){const _0x48a9a6=a125_0x5bfaf5;if(typeof Reflect===_0x48a9a6(0x174)&&typeof Reflect[_0x48a9a6(0x179)]==='function')return Reflect['metadata'](_0x33e353,_0xc527bd);},__param=this&&this[a125_0x5bfaf5(0x195)]||function(_0x68aae1,_0x4e3370){return function(_0x24d376,_0x3e6b95){_0x4e3370(_0x24d376,_0x3e6b95,_0x68aae1);};};Object[a125_0x5bfaf5(0x16b)](exports,a125_0x5bfaf5(0x192),{'value':!![]}),exports[a125_0x5bfaf5(0x173)]=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a125_0x5bfaf5(0x19c)),mongoose_2=require('mongoose'),CryptoJS=require(a125_0x5bfaf5(0x175)),dayjs=require(a125_0x5bfaf5(0x19a)),crypto_1=require(a125_0x5bfaf5(0x160)),job_1=require(a125_0x5bfaf5(0x189)),constants_1=require(a125_0x5bfaf5(0x197)),SECRET=a125_0x5bfaf5(0x165);let SettingService=class SettingService{constructor(_0x33bd12){const _0x582f4e=a125_0x5bfaf5;this[_0x582f4e(0x16f)]=_0x33bd12;}async[a125_0x5bfaf5(0x16a)](_0x5b484f){const _0x4e2a9f=a125_0x5bfaf5,_0x42b7ce=new this[(_0x4e2a9f(0x16f))](_0x5b484f);return _0x42b7ce['save']();}async[a125_0x5bfaf5(0x186)](){const _0x3f80c8=a125_0x5bfaf5;var _0x1e618a,_0x42145c,_0x223412;const _0x194925=await this[_0x3f80c8(0x16f)][_0x3f80c8(0x164)]()[_0x3f80c8(0x169)](),_0x3916be=(_0x1e618a=_0x194925[0x0])===null||_0x1e618a===void 0x0?void 0x0:_0x1e618a[_0x3f80c8(0x17c)]();if(!_0x3916be)return;return Object[_0x3f80c8(0x199)](Object['assign']({},_0x3916be),{'userSetting':Object[_0x3f80c8(0x199)](Object[_0x3f80c8(0x199)]({},_0x3916be[_0x3f80c8(0x18c)]),{'maxUser':(_0x223412=(_0x42145c=_0x3916be['userSetting'])===null||_0x42145c===void 0x0?void 0x0:_0x42145c[_0x3f80c8(0x184)])!==null&&_0x223412!==void 0x0?_0x223412:constants_1['DEFAULT_MAX_USER']})});}async[a125_0x5bfaf5(0x162)](_0x4e99e8,_0x577c48){const _0x51e0f0=a125_0x5bfaf5,_0xf07466=await this[_0x51e0f0(0x16f)]['findByIdAndUpdate'](_0x4e99e8,Object[_0x51e0f0(0x199)](Object[_0x51e0f0(0x199)]({},_0x577c48),{'updatedAtUtc':new Date()}),{'new':!![]})['exec']();return _0xf07466;}async[a125_0x5bfaf5(0x178)](){const _0x4f6477=a125_0x5bfaf5,_0x541935=await this[_0x4f6477(0x186)](),_0x1565ab=this[_0x4f6477(0x172)](_0x541935[_0x4f6477(0x182)],_0x541935['schoolId']);return this['update'](_0x541935['_id'],{'isExpired':!_0x1565ab[_0x4f6477(0x18f)]});}async[a125_0x5bfaf5(0x171)](_0x5765c7){const _0x409d77=a125_0x5bfaf5,_0xc49306=await this['findFirst']();return console[_0x409d77(0x15e)](_0xc49306,_0x409d77(0x168)),this[_0x409d77(0x162)](_0xc49306[_0x409d77(0x187)],{'userSetting':_0x5765c7});}[a125_0x5bfaf5(0x172)](_0x4ff959,_0x296031){const _0x21279d=a125_0x5bfaf5;try{if(!_0x4ff959)return{'isValid':![],'expiryDate':''};const _0x31b8d0=(0x0,crypto_1[_0x21279d(0x163)])(_0x4ff959,CryptoJS[_0x21279d(0x181)][_0x21279d(0x176)][_0x21279d(0x170)](SECRET)[_0x21279d(0x198)](CryptoJS['enc'][_0x21279d(0x166)]));if(_0x31b8d0['schoolId']!==_0x296031)return{'isValid':![],'expiryDate':''};const _0x36698b=dayjs(_0x31b8d0[_0x21279d(0x18e)],_0x21279d(0x15f))['toDate'](),_0x1b2186=dayjs(_0x31b8d0[_0x21279d(0x161)],_0x21279d(0x15f))[_0x21279d(0x16c)](),_0x131f1f=dayjs()[_0x21279d(0x16c)]();if(_0x131f1f<_0x36698b||_0x131f1f>_0x1b2186)return{'isValid':![],'expiryDate':_0x31b8d0[_0x21279d(0x161)]};return{'isValid':!![],'expiryDate':_0x31b8d0[_0x21279d(0x161)]};}catch(_0x2dbab7){return{'isValid':![],'expiryDate':''};}}async['killJobs'](){const _0x3d386f=a125_0x5bfaf5;job_1[_0x3d386f(0x17b)][_0x3d386f(0x196)]();}};function a125_0x4d20(_0x3ecb85,_0x4feea3){const _0x2ae4e7=a125_0x2ae4();return a125_0x4d20=function(_0x4d20e4,_0x2e0f60){_0x4d20e4=_0x4d20e4-0x15e;let _0x4d65df=_0x2ae4e7[_0x4d20e4];return _0x4d65df;},a125_0x4d20(_0x3ecb85,_0x4feea3);}SettingService=__decorate([(0x0,common_1[a125_0x5bfaf5(0x167)])(),__param(0x0,(0x0,mongoose_1['InjectModel'])(a125_0x5bfaf5(0x17d))),__metadata(a125_0x5bfaf5(0x188),[mongoose_2[a125_0x5bfaf5(0x185)]])],SettingService),exports[a125_0x5bfaf5(0x173)]=SettingService;function a125_0x2ae4(){const _0x1e1570=['userSetting','808754swDPuj','validFrom','isValid','function','decorate','__esModule','54IRmiNM','10McKFoX','__param','killAll','./constants','toString','assign','dayjs','length','@nestjs/mongoose','7WUjPVx','log','DD/MM/YYYY','../common/crypto','validTo','update','decrypt','find','QVBFVFVMT1NCQQ==','Utf8','Injectable','setting','exec','create','defineProperty','toDate','3831752FJEAeU','208368BViWNS','settingModel','parse','updateUserSetting','validateLicenseKey','SettingService','object','crypto-js','Base64','401995zhnMjo','updateExpiryStatus','metadata','8146917pthvDV','PROCESS_CACHE','toObject','Setting','getOwnPropertyDescriptor','216jJHXhB','774960LziTWz','enc','licenseKey','6016175BGkONn','maxUser','Model','findFirst','_id','design:paramtypes','../common/job','3zHJYtB','__metadata'];a125_0x2ae4=function(){return _0x1e1570;};return a125_0x2ae4();}