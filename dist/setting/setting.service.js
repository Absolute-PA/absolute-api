'use strict';function a122_0x291e(_0x378beb,_0x49704a){const _0x27cb30=a122_0x27cb();return a122_0x291e=function(_0x291e17,_0xd110e9){_0x291e17=_0x291e17-0xb4;let _0x40db3f=_0x27cb30[_0x291e17];return _0x40db3f;},a122_0x291e(_0x378beb,_0x49704a);}const a122_0x2a1638=a122_0x291e;(function(_0x39bdb4,_0x46708c){const _0x394601=a122_0x291e,_0x2ea9ca=_0x39bdb4();while(!![]){try{const _0x322ad0=parseInt(_0x394601(0xd4))/0x1+parseInt(_0x394601(0xb4))/0x2+-parseInt(_0x394601(0xdd))/0x3+-parseInt(_0x394601(0xb5))/0x4+parseInt(_0x394601(0xc9))/0x5*(parseInt(_0x394601(0xcf))/0x6)+parseInt(_0x394601(0xe7))/0x7+-parseInt(_0x394601(0xe3))/0x8;if(_0x322ad0===_0x46708c)break;else _0x2ea9ca['push'](_0x2ea9ca['shift']());}catch(_0x5b7237){_0x2ea9ca['push'](_0x2ea9ca['shift']());}}}(a122_0x27cb,0x971a3));function a122_0x27cb(){const _0x110fcd=['killJobs','722576ZTyFFK','3057400WODIZD','settingModel','Utf8','defineProperty','schoolId','__param','Injectable','validateLicenseKey','toDate','validFrom','licenseKey','updateUserSetting','getOwnPropertyDescriptor','findFirst','toObject','dayjs','_id','Setting','log','length','5633655MuYsce','enc','save','update','toString','userSetting','6AsJXWv','DD/MM/YYYY','./constants','assign','parse','442346fYnwQL','PROCESS_CACHE','__esModule','killAll','QVBFVFVMT1NCQQ==','object','@nestjs/common','SettingService','__metadata','194973LStvUh','Base64','__decorate','../common/job','maxUser','crypto-js','6758776crwJRq','validTo','metadata','findByIdAndUpdate','2539166LYFHVD','find','setting','decorate','exec','../common/crypto'];a122_0x27cb=function(){return _0x110fcd;};return a122_0x27cb();}var __decorate=this&&this[a122_0x2a1638(0xdf)]||function(_0x16b00b,_0x5052ab,_0x3decd3,_0x202675){const _0x396b84=a122_0x2a1638;var _0x32616c=arguments[_0x396b84(0xc8)],_0x8fbc48=_0x32616c<0x3?_0x5052ab:_0x202675===null?_0x202675=Object[_0x396b84(0xc1)](_0x5052ab,_0x3decd3):_0x202675,_0x34deff;if(typeof Reflect===_0x396b84(0xd9)&&typeof Reflect[_0x396b84(0xea)]==='function')_0x8fbc48=Reflect['decorate'](_0x16b00b,_0x5052ab,_0x3decd3,_0x202675);else{for(var _0x4ad4b0=_0x16b00b[_0x396b84(0xc8)]-0x1;_0x4ad4b0>=0x0;_0x4ad4b0--)if(_0x34deff=_0x16b00b[_0x4ad4b0])_0x8fbc48=(_0x32616c<0x3?_0x34deff(_0x8fbc48):_0x32616c>0x3?_0x34deff(_0x5052ab,_0x3decd3,_0x8fbc48):_0x34deff(_0x5052ab,_0x3decd3))||_0x8fbc48;}return _0x32616c>0x3&&_0x8fbc48&&Object[_0x396b84(0xb8)](_0x5052ab,_0x3decd3,_0x8fbc48),_0x8fbc48;},__metadata=this&&this[a122_0x2a1638(0xdc)]||function(_0x557553,_0x241fdf){const _0x334699=a122_0x2a1638;if(typeof Reflect==='object'&&typeof Reflect[_0x334699(0xe5)]==='function')return Reflect[_0x334699(0xe5)](_0x557553,_0x241fdf);},__param=this&&this[a122_0x2a1638(0xba)]||function(_0x52488a,_0x391752){return function(_0x3faac1,_0x6f0660){_0x391752(_0x3faac1,_0x6f0660,_0x52488a);};};Object[a122_0x2a1638(0xb8)](exports,a122_0x2a1638(0xd6),{'value':!![]}),exports['SettingService']=void 0x0;const common_1=require(a122_0x2a1638(0xda)),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require('mongoose'),CryptoJS=require(a122_0x2a1638(0xe2)),dayjs=require(a122_0x2a1638(0xc4)),crypto_1=require(a122_0x2a1638(0xec)),job_1=require(a122_0x2a1638(0xe0)),constants_1=require(a122_0x2a1638(0xd1)),SECRET=a122_0x2a1638(0xd8);let SettingService=class SettingService{constructor(_0x1f3156){const _0x5402ac=a122_0x2a1638;this[_0x5402ac(0xb6)]=_0x1f3156;}async['create'](_0x209cdd){const _0x25690b=a122_0x2a1638,_0xfa1eab=new this[(_0x25690b(0xb6))](_0x209cdd);return _0xfa1eab[_0x25690b(0xcb)]();}async['findFirst'](){const _0x3e7ada=a122_0x2a1638;var _0x20551d,_0x390ff2,_0x128df3;const _0x52ca45=await this[_0x3e7ada(0xb6)][_0x3e7ada(0xe8)]()[_0x3e7ada(0xeb)](),_0x2fe602=(_0x20551d=_0x52ca45[0x0])===null||_0x20551d===void 0x0?void 0x0:_0x20551d[_0x3e7ada(0xc3)]();if(!_0x2fe602)return;return Object[_0x3e7ada(0xd2)](Object[_0x3e7ada(0xd2)]({},_0x2fe602),{'userSetting':Object[_0x3e7ada(0xd2)](Object['assign']({},_0x2fe602[_0x3e7ada(0xce)]),{'maxUser':(_0x128df3=(_0x390ff2=_0x2fe602['userSetting'])===null||_0x390ff2===void 0x0?void 0x0:_0x390ff2[_0x3e7ada(0xe1)])!==null&&_0x128df3!==void 0x0?_0x128df3:constants_1['DEFAULT_MAX_USER']})});}async[a122_0x2a1638(0xcc)](_0x1dd8a5,_0x366b01){const _0xf3fb26=a122_0x2a1638,_0x33736c=await this['settingModel'][_0xf3fb26(0xe6)](_0x1dd8a5,Object[_0xf3fb26(0xd2)](Object['assign']({},_0x366b01),{'updatedAtUtc':new Date()}),{'new':!![]})['exec']();return _0x33736c;}async['updateExpiryStatus'](){const _0x155fe3=a122_0x2a1638,_0x1c5231=await this[_0x155fe3(0xc2)](),_0x4ee960=this[_0x155fe3(0xbc)](_0x1c5231[_0x155fe3(0xbf)],_0x1c5231[_0x155fe3(0xb9)]);return this[_0x155fe3(0xcc)](_0x1c5231[_0x155fe3(0xc5)],{'isExpired':!_0x4ee960['isValid']});}async[a122_0x2a1638(0xc0)](_0x51f3c4){const _0x48c5cb=a122_0x2a1638,_0x50d3dc=await this[_0x48c5cb(0xc2)]();return console[_0x48c5cb(0xc7)](_0x50d3dc,_0x48c5cb(0xe9)),this['update'](_0x50d3dc[_0x48c5cb(0xc5)],{'userSetting':_0x51f3c4});}[a122_0x2a1638(0xbc)](_0x17778c,_0x3db23c){const _0x1b300d=a122_0x2a1638;try{if(!_0x17778c)return{'isValid':![],'expiryDate':''};const _0x505ca9=(0x0,crypto_1['decrypt'])(_0x17778c,CryptoJS[_0x1b300d(0xca)][_0x1b300d(0xde)][_0x1b300d(0xd3)](SECRET)[_0x1b300d(0xcd)](CryptoJS[_0x1b300d(0xca)][_0x1b300d(0xb7)]));if(_0x505ca9[_0x1b300d(0xb9)]!==_0x3db23c)return{'isValid':![],'expiryDate':''};const _0x46d5b1=dayjs(_0x505ca9[_0x1b300d(0xbe)],_0x1b300d(0xd0))[_0x1b300d(0xbd)](),_0x1c6863=dayjs(_0x505ca9[_0x1b300d(0xe4)],_0x1b300d(0xd0))[_0x1b300d(0xbd)](),_0x3c7ad8=dayjs()['toDate']();if(_0x3c7ad8<_0x46d5b1||_0x3c7ad8>_0x1c6863)return{'isValid':![],'expiryDate':_0x505ca9[_0x1b300d(0xe4)]};return{'isValid':!![],'expiryDate':_0x505ca9[_0x1b300d(0xe4)]};}catch(_0x2134ca){return{'isValid':![],'expiryDate':''};}}async[a122_0x2a1638(0xed)](){const _0x4e8edb=a122_0x2a1638;job_1[_0x4e8edb(0xd5)][_0x4e8edb(0xd7)]();}};SettingService=__decorate([(0x0,common_1[a122_0x2a1638(0xbb)])(),__param(0x0,(0x0,mongoose_1['InjectModel'])(a122_0x2a1638(0xc6))),__metadata('design:paramtypes',[mongoose_2['Model']])],SettingService),exports[a122_0x2a1638(0xdb)]=SettingService;