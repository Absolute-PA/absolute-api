'use strict';const a125_0x34b6f4=a125_0x91bc;(function(_0xdefba6,_0x57d214){const _0x2c7112=a125_0x91bc,_0x5b240b=_0xdefba6();while(!![]){try{const _0x33883b=parseInt(_0x2c7112(0x109))/0x1*(-parseInt(_0x2c7112(0x135))/0x2)+-parseInt(_0x2c7112(0x13b))/0x3+parseInt(_0x2c7112(0x140))/0x4*(parseInt(_0x2c7112(0x106))/0x5)+-parseInt(_0x2c7112(0x138))/0x6+parseInt(_0x2c7112(0x13a))/0x7+-parseInt(_0x2c7112(0x12c))/0x8*(parseInt(_0x2c7112(0x13d))/0x9)+parseInt(_0x2c7112(0x12e))/0xa;if(_0x33883b===_0x57d214)break;else _0x5b240b['push'](_0x5b240b['shift']());}catch(_0x3ab83a){_0x5b240b['push'](_0x5b240b['shift']());}}}(a125_0x2c65,0x8d4bf));var __decorate=this&&this[a125_0x34b6f4(0x125)]||function(_0x405482,_0xd57f89,_0x396ab5,_0x58f20c){const _0x2e9901=a125_0x34b6f4;var _0x255098=arguments[_0x2e9901(0x116)],_0x258db7=_0x255098<0x3?_0xd57f89:_0x58f20c===null?_0x58f20c=Object[_0x2e9901(0x111)](_0xd57f89,_0x396ab5):_0x58f20c,_0x51ec29;if(typeof Reflect==='object'&&typeof Reflect[_0x2e9901(0x12f)]==='function')_0x258db7=Reflect['decorate'](_0x405482,_0xd57f89,_0x396ab5,_0x58f20c);else{for(var _0x15e2c1=_0x405482[_0x2e9901(0x116)]-0x1;_0x15e2c1>=0x0;_0x15e2c1--)if(_0x51ec29=_0x405482[_0x15e2c1])_0x258db7=(_0x255098<0x3?_0x51ec29(_0x258db7):_0x255098>0x3?_0x51ec29(_0xd57f89,_0x396ab5,_0x258db7):_0x51ec29(_0xd57f89,_0x396ab5))||_0x258db7;}return _0x255098>0x3&&_0x258db7&&Object[_0x2e9901(0x12b)](_0xd57f89,_0x396ab5,_0x258db7),_0x258db7;},__metadata=this&&this[a125_0x34b6f4(0x137)]||function(_0x253c6d,_0x51542f){const _0x94fa48=a125_0x34b6f4;if(typeof Reflect===_0x94fa48(0x13e)&&typeof Reflect['metadata']===_0x94fa48(0x10a))return Reflect[_0x94fa48(0x13f)](_0x253c6d,_0x51542f);},__param=this&&this['__param']||function(_0x5c86e9,_0x3c1c12){return function(_0x21e57c,_0x39c4de){_0x3c1c12(_0x21e57c,_0x39c4de,_0x5c86e9);};};Object[a125_0x34b6f4(0x12b)](exports,'__esModule',{'value':!![]}),exports[a125_0x34b6f4(0x12a)]=void 0x0;const common_1=require(a125_0x34b6f4(0x110)),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require(a125_0x34b6f4(0x117)),CryptoJS=require(a125_0x34b6f4(0x114)),dayjs=require(a125_0x34b6f4(0x121)),crypto_1=require(a125_0x34b6f4(0x118)),job_1=require('../common/job'),constants_1=require('./constants'),SECRET=a125_0x34b6f4(0x120);let SettingService=class SettingService{constructor(_0x10e554){const _0x2fa300=a125_0x34b6f4;this[_0x2fa300(0x119)]=_0x10e554;}async[a125_0x34b6f4(0x112)](_0x3cddaa){const _0x129a43=a125_0x34b6f4,_0x534510=new this[(_0x129a43(0x119))](_0x3cddaa);return _0x534510[_0x129a43(0x130)]();}async[a125_0x34b6f4(0x10d)](){const _0x559142=a125_0x34b6f4;var _0x57d997,_0x4cebd2,_0x2c3a06;const _0x27dc1b=await this[_0x559142(0x119)][_0x559142(0x142)]()[_0x559142(0x131)](),_0x77ed39=(_0x57d997=_0x27dc1b[0x0])===null||_0x57d997===void 0x0?void 0x0:_0x57d997[_0x559142(0x129)]();if(!_0x77ed39)return;return Object[_0x559142(0x11d)](Object[_0x559142(0x11d)]({},_0x77ed39),{'userSetting':Object[_0x559142(0x11d)](Object['assign']({},_0x77ed39[_0x559142(0x11b)]),{'maxUser':(_0x2c3a06=(_0x4cebd2=_0x77ed39[_0x559142(0x11b)])===null||_0x4cebd2===void 0x0?void 0x0:_0x4cebd2['maxUser'])!==null&&_0x2c3a06!==void 0x0?_0x2c3a06:constants_1[_0x559142(0x11e)]})});}async['update'](_0x399347,_0x2af3d8){const _0x12d13f=a125_0x34b6f4,_0x1cd23a=await this[_0x12d13f(0x119)][_0x12d13f(0x115)](_0x399347,Object[_0x12d13f(0x11d)](Object[_0x12d13f(0x11d)]({},_0x2af3d8),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x12d13f(0x131)]();return _0x1cd23a;}async[a125_0x34b6f4(0x10e)](){const _0x447b25=a125_0x34b6f4,_0x2dde99=await this[_0x447b25(0x10d)](),_0x23d892=this['validateLicenseKey'](_0x2dde99['licenseKey'],_0x2dde99[_0x447b25(0x123)]);return this[_0x447b25(0x107)](_0x2dde99['_id'],{'isExpired':!_0x23d892[_0x447b25(0x139)]});}async[a125_0x34b6f4(0x128)](_0x5dec8d){const _0x591cfd=a125_0x34b6f4,_0x523e49=await this['findFirst']();return console[_0x591cfd(0x124)](_0x523e49,_0x591cfd(0x133)),this['update'](_0x523e49[_0x591cfd(0x113)],{'userSetting':_0x5dec8d});}[a125_0x34b6f4(0x108)](_0xa6f417,_0x4196a8){const _0x575d01=a125_0x34b6f4;try{if(!_0xa6f417)return{'isValid':![],'expiryDate':''};const _0x3a3154=(0x0,crypto_1[_0x575d01(0x134)])(_0xa6f417,CryptoJS[_0x575d01(0x127)][_0x575d01(0x12d)][_0x575d01(0x10c)](SECRET)[_0x575d01(0x126)](CryptoJS[_0x575d01(0x127)][_0x575d01(0x132)]));if(_0x3a3154['schoolId']!==_0x4196a8)return{'isValid':![],'expiryDate':''};const _0x538089=dayjs(_0x3a3154[_0x575d01(0x141)],'DD/MM/YYYY')['toDate'](),_0x5089c8=dayjs(_0x3a3154['validTo'],_0x575d01(0x10b))[_0x575d01(0x136)](),_0x437017=dayjs()[_0x575d01(0x136)]();if(_0x437017<_0x538089||_0x437017>_0x5089c8)return{'isValid':![],'expiryDate':_0x3a3154[_0x575d01(0x11c)]};return{'isValid':!![],'expiryDate':_0x3a3154[_0x575d01(0x11c)]};}catch(_0x38b82a){return{'isValid':![],'expiryDate':''};}}async[a125_0x34b6f4(0x13c)](){const _0x565841=a125_0x34b6f4;job_1['PROCESS_CACHE'][_0x565841(0x10f)]();}};SettingService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_1[a125_0x34b6f4(0x11f)])(a125_0x34b6f4(0x11a))),__metadata('design:paramtypes',[mongoose_2[a125_0x34b6f4(0x122)]])],SettingService),exports[a125_0x34b6f4(0x12a)]=SettingService;function a125_0x91bc(_0xf97cd,_0x4bea4a){const _0x2c655d=a125_0x2c65();return a125_0x91bc=function(_0x91bc81,_0x18bcf6){_0x91bc81=_0x91bc81-0x106;let _0x48ba7f=_0x2c655d[_0x91bc81];return _0x48ba7f;},a125_0x91bc(_0xf97cd,_0x4bea4a);}function a125_0x2c65(){const _0x425336=['getOwnPropertyDescriptor','create','_id','crypto-js','findByIdAndUpdate','length','mongoose','../common/crypto','settingModel','Setting','userSetting','validTo','assign','DEFAULT_MAX_USER','InjectModel','QVBFVFVMT1NCQQ==','dayjs','Model','schoolId','log','__decorate','toString','enc','updateUserSetting','toObject','SettingService','defineProperty','4568ldawbZ','Base64','28727500xXaYmn','decorate','save','exec','Utf8','setting','decrypt','2camuzp','toDate','__metadata','4417674jpoKJQ','isValid','578599BvXanH','2644944SYvLcv','killJobs','12087McxdAx','object','metadata','1868SOosqR','validFrom','find','3595udzvCI','update','validateLicenseKey','327649XhGOfs','function','DD/MM/YYYY','parse','findFirst','updateExpiryStatus','killAll','@nestjs/common'];a125_0x2c65=function(){return _0x425336;};return a125_0x2c65();}