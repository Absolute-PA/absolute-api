'use strict';const a125_0x86595f=a125_0x288c;(function(_0x2ee364,_0x2942a8){const _0x56bfb6=a125_0x288c,_0x413373=_0x2ee364();while(!![]){try{const _0x2d564b=-parseInt(_0x56bfb6(0x10e))/0x1+parseInt(_0x56bfb6(0x122))/0x2*(parseInt(_0x56bfb6(0x129))/0x3)+parseInt(_0x56bfb6(0x10c))/0x4+-parseInt(_0x56bfb6(0x105))/0x5+parseInt(_0x56bfb6(0x113))/0x6+parseInt(_0x56bfb6(0x12c))/0x7+-parseInt(_0x56bfb6(0x132))/0x8;if(_0x2d564b===_0x2942a8)break;else _0x413373['push'](_0x413373['shift']());}catch(_0x4116a3){_0x413373['push'](_0x413373['shift']());}}}(a125_0x1a71,0x2c515));function a125_0x288c(_0x3d8789,_0x5d4bcd){const _0x1a71bc=a125_0x1a71();return a125_0x288c=function(_0x288cb7,_0x4b4948){_0x288cb7=_0x288cb7-0x105;let _0x58af70=_0x1a71bc[_0x288cb7];return _0x58af70;},a125_0x288c(_0x3d8789,_0x5d4bcd);}var __decorate=this&&this[a125_0x86595f(0x123)]||function(_0x3fccdb,_0x341fba,_0xc028eb,_0x1fd589){const _0x1a814f=a125_0x86595f;var _0x29d29a=arguments['length'],_0x547209=_0x29d29a<0x3?_0x341fba:_0x1fd589===null?_0x1fd589=Object[_0x1a814f(0x13f)](_0x341fba,_0xc028eb):_0x1fd589,_0x53bd20;if(typeof Reflect===_0x1a814f(0x112)&&typeof Reflect[_0x1a814f(0x135)]===_0x1a814f(0x130))_0x547209=Reflect[_0x1a814f(0x135)](_0x3fccdb,_0x341fba,_0xc028eb,_0x1fd589);else{for(var _0x570402=_0x3fccdb[_0x1a814f(0x13b)]-0x1;_0x570402>=0x0;_0x570402--)if(_0x53bd20=_0x3fccdb[_0x570402])_0x547209=(_0x29d29a<0x3?_0x53bd20(_0x547209):_0x29d29a>0x3?_0x53bd20(_0x341fba,_0xc028eb,_0x547209):_0x53bd20(_0x341fba,_0xc028eb))||_0x547209;}return _0x29d29a>0x3&&_0x547209&&Object['defineProperty'](_0x341fba,_0xc028eb,_0x547209),_0x547209;},__metadata=this&&this['__metadata']||function(_0xf72c4c,_0x265ba8){const _0x3f817a=a125_0x86595f;if(typeof Reflect===_0x3f817a(0x112)&&typeof Reflect[_0x3f817a(0x10b)]===_0x3f817a(0x130))return Reflect[_0x3f817a(0x10b)](_0xf72c4c,_0x265ba8);},__param=this&&this[a125_0x86595f(0x109)]||function(_0x48285e,_0x45bc45){return function(_0x1d2c09,_0x37cc2c){_0x45bc45(_0x1d2c09,_0x37cc2c,_0x48285e);};};function a125_0x1a71(){const _0x5b660e=['find','log','licenseKey','function','DEFAULT_MAX_USER','4892136elIQze','killJobs','design:paramtypes','decorate','QVBFVFVMT1NCQQ==','dayjs','toDate','validFrom','Utf8','length','crypto-js','schoolId','../common/job','getOwnPropertyDescriptor','Setting','994655zmJagY','validTo','PROCESS_CACHE','decrypt','__param','defineProperty','metadata','1213752FRMyTR','settingModel','98225NjBBDK','isValid','findByIdAndUpdate','./constants','object','1214184QMvene','Base64','save','exec','_id','toString','maxUser','userSetting','validateLicenseKey','@nestjs/mongoose','toObject','parse','enc','DD/MM/YYYY','assign','298pTeisQ','__decorate','Model','__esModule','setting','killAll','mongoose','6567espjGR','SettingService','update','1807645vRIBps'];a125_0x1a71=function(){return _0x5b660e;};return a125_0x1a71();}Object[a125_0x86595f(0x10a)](exports,a125_0x86595f(0x125),{'value':!![]}),exports['SettingService']=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a125_0x86595f(0x11c)),mongoose_2=require(a125_0x86595f(0x128)),CryptoJS=require(a125_0x86595f(0x13c)),dayjs=require(a125_0x86595f(0x137)),crypto_1=require('../common/crypto'),job_1=require(a125_0x86595f(0x13e)),constants_1=require(a125_0x86595f(0x111)),SECRET=a125_0x86595f(0x136);let SettingService=class SettingService{constructor(_0x4e6f2d){const _0x40340e=a125_0x86595f;this[_0x40340e(0x10d)]=_0x4e6f2d;}async['create'](_0x1375c0){const _0x1fbd25=a125_0x86595f,_0x20d80c=new this[(_0x1fbd25(0x10d))](_0x1375c0);return _0x20d80c[_0x1fbd25(0x115)]();}async['findFirst'](){const _0x463e1e=a125_0x86595f;var _0xa46490,_0x595f5c,_0x306dcf;const _0x25232d=await this[_0x463e1e(0x10d)][_0x463e1e(0x12d)]()[_0x463e1e(0x116)](),_0x6dac4b=(_0xa46490=_0x25232d[0x0])===null||_0xa46490===void 0x0?void 0x0:_0xa46490[_0x463e1e(0x11d)]();if(!_0x6dac4b)return;return Object[_0x463e1e(0x121)](Object[_0x463e1e(0x121)]({},_0x6dac4b),{'userSetting':Object[_0x463e1e(0x121)](Object['assign']({},_0x6dac4b['userSetting']),{'maxUser':(_0x306dcf=(_0x595f5c=_0x6dac4b[_0x463e1e(0x11a)])===null||_0x595f5c===void 0x0?void 0x0:_0x595f5c[_0x463e1e(0x119)])!==null&&_0x306dcf!==void 0x0?_0x306dcf:constants_1[_0x463e1e(0x131)]})});}async[a125_0x86595f(0x12b)](_0x50b8cd,_0x23088f){const _0x51df20=a125_0x86595f,_0xaeb85f=await this[_0x51df20(0x10d)][_0x51df20(0x110)](_0x50b8cd,Object['assign'](Object[_0x51df20(0x121)]({},_0x23088f),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x51df20(0x116)]();return _0xaeb85f;}async['updateExpiryStatus'](){const _0x4e728d=a125_0x86595f,_0x512a1d=await this['findFirst'](),_0x3b9388=this['validateLicenseKey'](_0x512a1d[_0x4e728d(0x12f)],_0x512a1d[_0x4e728d(0x13d)]);return this[_0x4e728d(0x12b)](_0x512a1d[_0x4e728d(0x117)],{'isExpired':!_0x3b9388[_0x4e728d(0x10f)]});}async['updateUserSetting'](_0xdfba07){const _0x21e375=a125_0x86595f,_0x359697=await this['findFirst']();return console[_0x21e375(0x12e)](_0x359697,_0x21e375(0x126)),this[_0x21e375(0x12b)](_0x359697['_id'],{'userSetting':_0xdfba07});}[a125_0x86595f(0x11b)](_0x391098,_0x292631){const _0x46d3cb=a125_0x86595f;try{if(!_0x391098)return{'isValid':![],'expiryDate':''};const _0x47c898=(0x0,crypto_1[_0x46d3cb(0x108)])(_0x391098,CryptoJS[_0x46d3cb(0x11f)][_0x46d3cb(0x114)][_0x46d3cb(0x11e)](SECRET)[_0x46d3cb(0x118)](CryptoJS[_0x46d3cb(0x11f)][_0x46d3cb(0x13a)]));if(_0x47c898[_0x46d3cb(0x13d)]!==_0x292631)return{'isValid':![],'expiryDate':''};const _0x2b4ebb=dayjs(_0x47c898[_0x46d3cb(0x139)],_0x46d3cb(0x120))['toDate'](),_0x3457cd=dayjs(_0x47c898[_0x46d3cb(0x106)],_0x46d3cb(0x120))[_0x46d3cb(0x138)](),_0x447e0e=dayjs()[_0x46d3cb(0x138)]();if(_0x447e0e<_0x2b4ebb||_0x447e0e>_0x3457cd)return{'isValid':![],'expiryDate':_0x47c898['validTo']};return{'isValid':!![],'expiryDate':_0x47c898[_0x46d3cb(0x106)]};}catch(_0x362869){return{'isValid':![],'expiryDate':''};}}async[a125_0x86595f(0x133)](){const _0xee62fd=a125_0x86595f;job_1[_0xee62fd(0x107)][_0xee62fd(0x127)]();}};SettingService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_1['InjectModel'])(a125_0x86595f(0x140))),__metadata(a125_0x86595f(0x134),[mongoose_2[a125_0x86595f(0x124)]])],SettingService),exports[a125_0x86595f(0x12a)]=SettingService;