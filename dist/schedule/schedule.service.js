'use strict';const a108_0x13c075=a108_0x3120;(function(_0xc26116,_0x2bc49d){const _0x5262be=a108_0x3120,_0x119b9d=_0xc26116();while(!![]){try{const _0x1bcbd6=parseInt(_0x5262be(0x147))/0x1+parseInt(_0x5262be(0x141))/0x2+parseInt(_0x5262be(0x169))/0x3+-parseInt(_0x5262be(0x154))/0x4+parseInt(_0x5262be(0x170))/0x5*(parseInt(_0x5262be(0x15e))/0x6)+-parseInt(_0x5262be(0x140))/0x7+-parseInt(_0x5262be(0x16c))/0x8*(parseInt(_0x5262be(0x13b))/0x9);if(_0x1bcbd6===_0x2bc49d)break;else _0x119b9d['push'](_0x119b9d['shift']());}catch(_0x1727c1){_0x119b9d['push'](_0x119b9d['shift']());}}}(a108_0x28a8,0xaa97f));var __decorate=this&&this[a108_0x13c075(0x152)]||function(_0x529df1,_0x6b322b,_0x42c256,_0x286b5e){const _0xeab1a9=a108_0x13c075;var _0x72451d=arguments[_0xeab1a9(0x155)],_0x72f6=_0x72451d<0x3?_0x6b322b:_0x286b5e===null?_0x286b5e=Object['getOwnPropertyDescriptor'](_0x6b322b,_0x42c256):_0x286b5e,_0x83cfea;if(typeof Reflect===_0xeab1a9(0x12d)&&typeof Reflect['decorate']==='function')_0x72f6=Reflect[_0xeab1a9(0x13a)](_0x529df1,_0x6b322b,_0x42c256,_0x286b5e);else{for(var _0x170245=_0x529df1['length']-0x1;_0x170245>=0x0;_0x170245--)if(_0x83cfea=_0x529df1[_0x170245])_0x72f6=(_0x72451d<0x3?_0x83cfea(_0x72f6):_0x72451d>0x3?_0x83cfea(_0x6b322b,_0x42c256,_0x72f6):_0x83cfea(_0x6b322b,_0x42c256))||_0x72f6;}return _0x72451d>0x3&&_0x72f6&&Object[_0xeab1a9(0x14e)](_0x6b322b,_0x42c256,_0x72f6),_0x72f6;},__metadata=this&&this[a108_0x13c075(0x164)]||function(_0x498d72,_0x49664){const _0x458164=a108_0x13c075;if(typeof Reflect===_0x458164(0x12d)&&typeof Reflect[_0x458164(0x16d)]===_0x458164(0x151))return Reflect[_0x458164(0x16d)](_0x498d72,_0x49664);},__param=this&&this[a108_0x13c075(0x13f)]||function(_0x44b3c0,_0x459293){return function(_0x57c88d,_0x1b4f67){_0x459293(_0x57c88d,_0x1b4f67,_0x44b3c0);};};function a108_0x28a8(){const _0x5e4d87=['Model','clone','12luBful','../common/utils','Schedule','dayjs','findAll','includeDates','__metadata','exec','findIndex','assign','startOf','3589326UVIjnZ','InjectModel','push','20680416MHSaPS','metadata','findById','toISOString','1958475ryLwDv','format','setDate','object','findByIdAndDelete','findOne','mongoose','all','filter','toObject','uuid','toDate','find','Injectable','update','getDate','decorate','9iDKLqT','day','addIncludeDate','save','__param','4342401yqtvSB','2673796aVGZzQ','map','findByIdAndUpdate','design:paramtypes','scheduleModel','sort','1145289oGpyHD','findAllActiveSchedules','ScheduleService','events','getDay','create','updatedAtUtc','defineProperty','findEligibleScheduleBetween','remove','function','__decorate','isAfter','2231492pqpNdi','length','includes','findEligibleSchedule','YYYY-MM-DD','removeOtherExistingIncludeDates','getTime','weekDays'];a108_0x28a8=function(){return _0x5e4d87;};return a108_0x28a8();}function a108_0x3120(_0x5af37d,_0x8502b5){const _0x28a8ec=a108_0x28a8();return a108_0x3120=function(_0x3120dc,_0x2bd60c){_0x3120dc=_0x3120dc-0x12d;let _0x3b5179=_0x28a8ec[_0x3120dc];return _0x3b5179;},a108_0x3120(_0x5af37d,_0x8502b5);}Object[a108_0x13c075(0x14e)](exports,'__esModule',{'value':!![]}),exports[a108_0x13c075(0x149)]=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require(a108_0x13c075(0x130)),dayjs=require(a108_0x13c075(0x161)),utils_1=require(a108_0x13c075(0x15f)),schedulePrioritySort=(_0x417dc6,_0x4b83c8)=>dayjs(_0x417dc6['createdAtUtc'])[a108_0x13c075(0x153)](dayjs(_0x4b83c8['createdAtUtc']))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0x288dac){const _0x42faf9=a108_0x13c075;this[_0x42faf9(0x145)]=_0x288dac;}async[a108_0x13c075(0x14c)](_0x24025f){const _0x135878=a108_0x13c075,_0x51eac5=new this[(_0x135878(0x145))](_0x24025f);return _0x51eac5[_0x135878(0x13e)]();}async[a108_0x13c075(0x162)](){const _0x57ba6b=a108_0x13c075,_0x1e83ee=await this[_0x57ba6b(0x145)]['find']()[_0x57ba6b(0x165)]();return _0x1e83ee;}async['findOne'](_0x52f632){const _0x4a8492=a108_0x13c075,_0xa21409=await this['scheduleModel'][_0x4a8492(0x16e)](_0x52f632);return _0xa21409;}async[a108_0x13c075(0x157)](_0x248ccf){const _0x47239c=a108_0x13c075,_0x16c902=await this[_0x47239c(0x148)](_0x248ccf),_0x59f9d9=_0x16c902[_0x47239c(0x132)](_0x30da0c=>_0x30da0c['includeDates'][_0x47239c(0x155)]>0x0&&_0x30da0c[_0x47239c(0x163)][_0x47239c(0x142)](_0x5933ec=>dayjs(_0x5933ec)[_0x47239c(0x171)](_0x47239c(0x158)))['includes'](dayjs(_0x248ccf)[_0x47239c(0x171)](_0x47239c(0x158))))[_0x47239c(0x146)](schedulePrioritySort);if(_0x59f9d9[_0x47239c(0x155)]>0x0)return _0x59f9d9[0x0];const _0xdf87d2=_0x16c902[_0x47239c(0x132)](_0x2aabf0=>_0x2aabf0[_0x47239c(0x15b)][_0x47239c(0x156)](_0x248ccf[_0x47239c(0x14b)]()))[_0x47239c(0x146)](schedulePrioritySort);if(_0xdf87d2[_0x47239c(0x155)]>0x0)return _0xdf87d2[0x0];return null;}async[a108_0x13c075(0x148)](_0x39189d){const _0x18a9d8=a108_0x13c075,_0x54bcc5=dayjs(_0x39189d)[_0x18a9d8(0x168)](_0x18a9d8(0x13c))[_0x18a9d8(0x135)](),_0xc07995={'$and':[{'$or':[{'startDate':{'$lte':_0x39189d},'endDate':{'$gte':_0x39189d}},{'startDate':{'$lte':_0x39189d},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x39189d}}]},{'excludeDates':{'$nin':[_0x54bcc5]}}]},_0x46333d=await this[_0x18a9d8(0x145)][_0x18a9d8(0x136)](_0xc07995)[_0x18a9d8(0x165)]();return _0x46333d;}async[a108_0x13c075(0x14f)](_0x2dc77c,_0x5aaa88){const _0x168953=a108_0x13c075,_0x17dc3f=new Date(_0x2dc77c),_0x4e8c39={};while(_0x17dc3f<=_0x5aaa88){const _0xae233c=await this[_0x168953(0x157)](_0x17dc3f);_0xae233c&&(_0x4e8c39[dayjs(_0x17dc3f)[_0x168953(0x171)](_0x168953(0x158))]=_0xae233c),_0x17dc3f[_0x168953(0x172)](_0x17dc3f[_0x168953(0x139)]()+0x1);}return _0x4e8c39;}async[a108_0x13c075(0x138)](_0x578875,_0x32933a){const _0x2cbc2a=a108_0x13c075,_0x81b150=await this[_0x2cbc2a(0x145)][_0x2cbc2a(0x143)](_0x578875,Object[_0x2cbc2a(0x167)](Object[_0x2cbc2a(0x167)]({},_0x32933a),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x2cbc2a(0x165)]();return _0x81b150['includeDates']&&await this[_0x2cbc2a(0x159)](_0x578875,_0x81b150[_0x2cbc2a(0x163)]),_0x81b150;}async[a108_0x13c075(0x150)](_0xc03f3a){const _0x4f651e=a108_0x13c075,_0x322101=await this[_0x4f651e(0x145)][_0x4f651e(0x12e)](_0xc03f3a)[_0x4f651e(0x165)]();return _0x322101;}async[a108_0x13c075(0x13d)](_0x2da967,_0xea83c2){const _0xfe1acb=a108_0x13c075,_0x1bb3e0=await this[_0xfe1acb(0x12f)](_0x2da967);_0x1bb3e0[_0xfe1acb(0x163)][_0xfe1acb(0x166)](_0x5bb65d=>_0x5bb65d[_0xfe1acb(0x15a)]()===_0xea83c2[_0xfe1acb(0x15a)]())===-0x1&&_0x1bb3e0[_0xfe1acb(0x163)][_0xfe1acb(0x16b)](_0xea83c2);const _0x2ac209=await _0x1bb3e0[_0xfe1acb(0x13e)]();return await this['removeOtherExistingIncludeDates'](_0x2da967,[_0xea83c2]),_0x2ac209;}async[a108_0x13c075(0x159)](_0x56d13c,_0x913349){const _0x4a9bea=a108_0x13c075,_0xc158e4=await this[_0x4a9bea(0x145)]['find']({'_id':{'$ne':_0x56d13c},'includeDates':{'$in':_0x913349}})[_0x4a9bea(0x165)](),_0x4062fe=_0x913349['map'](_0x30416e=>_0x30416e['toISOString']());await Promise[_0x4a9bea(0x131)](_0xc158e4['map'](_0x302c41=>{const _0x205d3f=_0x4a9bea,_0x1c641=_0x302c41[_0x205d3f(0x163)][_0x205d3f(0x132)](_0x43bf3f=>!_0x4062fe[_0x205d3f(0x156)](_0x43bf3f[_0x205d3f(0x16f)]()));return _0x302c41[_0x205d3f(0x163)]=_0x1c641,_0x302c41[_0x205d3f(0x14d)]=new Date(),_0x302c41[_0x205d3f(0x13e)]();}));}async[a108_0x13c075(0x15d)](_0x4babf0){const _0x2cfbd5=a108_0x13c075,_0x49f76a=await this[_0x2cfbd5(0x12f)](_0x4babf0),_0x1be39f=_0x49f76a[_0x2cfbd5(0x14a)][_0x2cfbd5(0x142)](_0x591367=>Object['assign'](Object[_0x2cfbd5(0x167)]({},_0x591367),{'id':(0x0,utils_1[_0x2cfbd5(0x134)])()})),_0x1c6c5b=new this['scheduleModel'](Object[_0x2cfbd5(0x167)](Object[_0x2cfbd5(0x167)]({},_0x49f76a[_0x2cfbd5(0x133)]()),{'events':_0x1be39f,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x1c6c5b[_0x2cfbd5(0x13e)]();}};ScheduleService=__decorate([(0x0,common_1[a108_0x13c075(0x137)])(),__param(0x0,(0x0,mongoose_1[a108_0x13c075(0x16a)])(a108_0x13c075(0x160))),__metadata(a108_0x13c075(0x144),[mongoose_2[a108_0x13c075(0x15c)]])],ScheduleService),exports[a108_0x13c075(0x149)]=ScheduleService;