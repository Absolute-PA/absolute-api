'use strict';const a111_0x5972e3=a111_0x161a;(function(_0x50c6fc,_0x1a19d4){const _0x4f88bf=a111_0x161a,_0x1a72e7=_0x50c6fc();while(!![]){try{const _0x42f006=parseInt(_0x4f88bf(0x195))/0x1*(-parseInt(_0x4f88bf(0x17e))/0x2)+-parseInt(_0x4f88bf(0x1a7))/0x3+parseInt(_0x4f88bf(0x18f))/0x4*(parseInt(_0x4f88bf(0x18b))/0x5)+-parseInt(_0x4f88bf(0x1ad))/0x6+parseInt(_0x4f88bf(0x196))/0x7*(-parseInt(_0x4f88bf(0x190))/0x8)+-parseInt(_0x4f88bf(0x177))/0x9+parseInt(_0x4f88bf(0x17b))/0xa*(parseInt(_0x4f88bf(0x192))/0xb);if(_0x42f006===_0x1a19d4)break;else _0x1a72e7['push'](_0x1a72e7['shift']());}catch(_0x52228c){_0x1a72e7['push'](_0x1a72e7['shift']());}}}(a111_0x22e1,0x7116b));var __decorate=this&&this[a111_0x5972e3(0x1ac)]||function(_0x2815f5,_0x12464d,_0x1b7165,_0x5e096a){const _0x42d8ab=a111_0x5972e3;var _0x3d962b=arguments['length'],_0xa713dd=_0x3d962b<0x3?_0x12464d:_0x5e096a===null?_0x5e096a=Object['getOwnPropertyDescriptor'](_0x12464d,_0x1b7165):_0x5e096a,_0x5c10fd;if(typeof Reflect===_0x42d8ab(0x189)&&typeof Reflect[_0x42d8ab(0x174)]==='function')_0xa713dd=Reflect['decorate'](_0x2815f5,_0x12464d,_0x1b7165,_0x5e096a);else{for(var _0x51df16=_0x2815f5[_0x42d8ab(0x17d)]-0x1;_0x51df16>=0x0;_0x51df16--)if(_0x5c10fd=_0x2815f5[_0x51df16])_0xa713dd=(_0x3d962b<0x3?_0x5c10fd(_0xa713dd):_0x3d962b>0x3?_0x5c10fd(_0x12464d,_0x1b7165,_0xa713dd):_0x5c10fd(_0x12464d,_0x1b7165))||_0xa713dd;}return _0x3d962b>0x3&&_0xa713dd&&Object[_0x42d8ab(0x18c)](_0x12464d,_0x1b7165,_0xa713dd),_0xa713dd;},__metadata=this&&this[a111_0x5972e3(0x1a8)]||function(_0x402cf9,_0x23b945){const _0x5d789e=a111_0x5972e3;if(typeof Reflect===_0x5d789e(0x189)&&typeof Reflect['metadata']===_0x5d789e(0x178))return Reflect[_0x5d789e(0x18d)](_0x402cf9,_0x23b945);},__param=this&&this[a111_0x5972e3(0x186)]||function(_0x2b7a6e,_0x2bffc5){return function(_0xf2cc0c,_0x3d09fb){_0x2bffc5(_0xf2cc0c,_0x3d09fb,_0x2b7a6e);};};Object[a111_0x5972e3(0x18c)](exports,a111_0x5972e3(0x198),{'value':!![]}),exports['ScheduleService']=void 0x0;const common_1=require(a111_0x5972e3(0x1a2)),mongoose_1=require(a111_0x5972e3(0x172)),mongoose_2=require(a111_0x5972e3(0x185)),dayjs=require(a111_0x5972e3(0x182)),utils_1=require('../common/utils'),schedulePrioritySort=(_0x202e32,_0x14f8eb)=>dayjs(_0x202e32[a111_0x5972e3(0x1b1)])['isAfter'](dayjs(_0x14f8eb['createdAtUtc']))?-0x1:0x1;function a111_0x161a(_0x21a06a,_0x39913b){const _0x22e109=a111_0x22e1();return a111_0x161a=function(_0x161a60,_0x1a8b7b){_0x161a60=_0x161a60-0x16e;let _0x546218=_0x22e109[_0x161a60];return _0x546218;},a111_0x161a(_0x21a06a,_0x39913b);}let ScheduleService=class ScheduleService{constructor(_0x3bbe41){const _0x4b7aae=a111_0x5972e3;this[_0x4b7aae(0x1ab)]=_0x3bbe41;}async['create'](_0x4edae6){const _0x35e12f=a111_0x5972e3,_0x23c810=new this['scheduleModel'](_0x4edae6);return _0x23c810[_0x35e12f(0x194)]();}async['findAll'](){const _0x4bd861=a111_0x5972e3,_0x328efd=await this['scheduleModel'][_0x4bd861(0x170)]()['exec']();return _0x328efd;}async[a111_0x5972e3(0x173)](_0x3cf9e6){const _0x550364=a111_0x5972e3,_0x2cdc14=await this[_0x550364(0x1ab)][_0x550364(0x1aa)](_0x3cf9e6);return _0x2cdc14;}async[a111_0x5972e3(0x1af)](_0x3f21c6){const _0x305c1c=a111_0x5972e3,_0x449a9b=await this[_0x305c1c(0x197)](_0x3f21c6),_0x495b8f=_0x449a9b[_0x305c1c(0x1a5)](_0x1c72ec=>_0x1c72ec['includeDates']['length']>0x0&&_0x1c72ec[_0x305c1c(0x17f)]['map'](_0x1fe7c7=>dayjs(_0x1fe7c7)[_0x305c1c(0x19f)](_0x305c1c(0x1a4)))[_0x305c1c(0x16e)](dayjs(_0x3f21c6)[_0x305c1c(0x19f)](_0x305c1c(0x1a4))))[_0x305c1c(0x18e)](schedulePrioritySort);if(_0x495b8f[_0x305c1c(0x17d)]>0x0)return _0x495b8f[0x0];const _0x9e7949=_0x449a9b[_0x305c1c(0x1a5)](_0x4c42ca=>_0x4c42ca[_0x305c1c(0x183)][_0x305c1c(0x16e)](_0x3f21c6[_0x305c1c(0x1a3)]()))['sort'](schedulePrioritySort);if(_0x9e7949[_0x305c1c(0x17d)]>0x0)return _0x9e7949[0x0];return null;}async[a111_0x5972e3(0x197)](_0x4933bf){const _0x222b5b=a111_0x5972e3,_0x49be12=dayjs(_0x4933bf)[_0x222b5b(0x175)](_0x222b5b(0x19e))['toDate'](),_0x428d19={'$and':[{'$or':[{'startDate':{'$lte':_0x4933bf},'endDate':{'$gte':_0x4933bf}},{'startDate':{'$lte':_0x4933bf},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x4933bf}}]},{'excludeDates':{'$nin':[_0x49be12]}}]},_0xd7adf5=await this[_0x222b5b(0x1ab)][_0x222b5b(0x170)](_0x428d19)[_0x222b5b(0x179)]();return _0xd7adf5;}async[a111_0x5972e3(0x199)](_0x183754,_0x55ad54){const _0x22a210=a111_0x5972e3,_0x5591cf=new Date(_0x183754),_0x351a74={};while(_0x5591cf<=_0x55ad54){const _0x3e648a=await this[_0x22a210(0x1af)](_0x5591cf);_0x3e648a&&(_0x351a74[dayjs(_0x5591cf)['format'](_0x22a210(0x1a4))]=_0x3e648a),_0x5591cf[_0x22a210(0x17c)](_0x5591cf[_0x22a210(0x18a)]()+0x1);}return _0x351a74;}async[a111_0x5972e3(0x19b)](_0x4cea12,_0x31557d){const _0x257532=a111_0x5972e3,_0x4fc617=await this[_0x257532(0x1ab)][_0x257532(0x171)](_0x4cea12,Object['assign'](Object[_0x257532(0x1a1)]({},_0x31557d),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x257532(0x179)]();return _0x4fc617[_0x257532(0x17f)]&&await this[_0x257532(0x191)](_0x4cea12,_0x4fc617['includeDates']),_0x4fc617;}async['remove'](_0x1afdd7){const _0x393669=a111_0x5972e3,_0x2a2b48=await this[_0x393669(0x1ab)][_0x393669(0x176)](_0x1afdd7)[_0x393669(0x179)]();return _0x2a2b48;}async[a111_0x5972e3(0x19c)](_0x33e78f,_0x209865){const _0x1a8360=a111_0x5972e3,_0x21c614=await this[_0x1a8360(0x173)](_0x33e78f);_0x21c614['includeDates'][_0x1a8360(0x188)](_0x4fb5db=>_0x4fb5db[_0x1a8360(0x16f)]()===_0x209865[_0x1a8360(0x16f)]())===-0x1&&_0x21c614[_0x1a8360(0x17f)][_0x1a8360(0x1a9)](_0x209865);const _0x174ad3=await _0x21c614[_0x1a8360(0x194)]();return await this[_0x1a8360(0x191)](_0x33e78f,[_0x209865]),_0x174ad3;}async['removeOtherExistingIncludeDates'](_0x2a4bdb,_0x162f74){const _0x4e5497=a111_0x5972e3,_0x46ac7b=await this[_0x4e5497(0x1ab)][_0x4e5497(0x170)]({'_id':{'$ne':_0x2a4bdb},'includeDates':{'$in':_0x162f74}})['exec'](),_0x1e3227=_0x162f74[_0x4e5497(0x1a6)](_0x2233ad=>_0x2233ad[_0x4e5497(0x184)]());await Promise[_0x4e5497(0x19d)](_0x46ac7b['map'](_0x11b841=>{const _0x21b971=_0x4e5497,_0x16ea60=_0x11b841['includeDates'][_0x21b971(0x1a5)](_0x2fbc20=>!_0x1e3227[_0x21b971(0x16e)](_0x2fbc20['toISOString']()));return _0x11b841[_0x21b971(0x17f)]=_0x16ea60,_0x11b841['updatedAtUtc']=new Date(),_0x11b841['save']();}));}async[a111_0x5972e3(0x181)](_0x52f1dd){const _0xc0a5af=a111_0x5972e3,_0x5ec62e=await this[_0xc0a5af(0x173)](_0x52f1dd),_0x502e8a=_0x5ec62e[_0xc0a5af(0x1ae)][_0xc0a5af(0x1a6)](_0xb56e7e=>Object[_0xc0a5af(0x1a1)](Object['assign']({},_0xb56e7e),{'id':(0x0,utils_1[_0xc0a5af(0x19a)])()})),_0x5b6859=new this[(_0xc0a5af(0x1ab))](Object[_0xc0a5af(0x1a1)](Object[_0xc0a5af(0x1a1)]({},_0x5ec62e[_0xc0a5af(0x180)]()),{'events':_0x502e8a,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x5b6859[_0xc0a5af(0x194)]();}};function a111_0x22e1(){const _0x46b295=['includes','getTime','find','findByIdAndUpdate','@nestjs/mongoose','findOne','decorate','startOf','findByIdAndDelete','896868MvpuWC','function','exec','Model','710MLiImd','setDate','length','142uTmOiu','includeDates','toObject','clone','dayjs','weekDays','toISOString','mongoose','__param','Schedule','findIndex','object','getDate','895715mUqGzK','defineProperty','metadata','sort','4PTjtWR','8YbLZyY','removeOtherExistingIncludeDates','237875ueyXbc','ScheduleService','save','9100sgdTZL','418908HNzfad','findAllActiveSchedules','__esModule','findEligibleScheduleBetween','uuid','update','addIncludeDate','all','day','format','InjectModel','assign','@nestjs/common','getDay','YYYY-MM-DD','filter','map','110106GWXqwW','__metadata','push','findById','scheduleModel','__decorate','2454054QRsduE','events','findEligibleSchedule','design:paramtypes','createdAtUtc'];a111_0x22e1=function(){return _0x46b295;};return a111_0x22e1();}ScheduleService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_1[a111_0x5972e3(0x1a0)])(a111_0x5972e3(0x187))),__metadata(a111_0x5972e3(0x1b0),[mongoose_2[a111_0x5972e3(0x17a)]])],ScheduleService),exports[a111_0x5972e3(0x193)]=ScheduleService;