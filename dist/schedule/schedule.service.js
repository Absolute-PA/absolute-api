'use strict';const a108_0x2eebd2=a108_0x3eab;(function(_0x53d30d,_0xf78c16){const _0x46c533=a108_0x3eab,_0x4732be=_0x53d30d();while(!![]){try{const _0x280f6d=-parseInt(_0x46c533(0x19d))/0x1+parseInt(_0x46c533(0x197))/0x2+parseInt(_0x46c533(0x179))/0x3*(-parseInt(_0x46c533(0x187))/0x4)+-parseInt(_0x46c533(0x193))/0x5*(-parseInt(_0x46c533(0x182))/0x6)+parseInt(_0x46c533(0x1a4))/0x7+parseInt(_0x46c533(0x185))/0x8+parseInt(_0x46c533(0x18d))/0x9*(parseInt(_0x46c533(0x177))/0xa);if(_0x280f6d===_0xf78c16)break;else _0x4732be['push'](_0x4732be['shift']());}catch(_0x26805d){_0x4732be['push'](_0x4732be['shift']());}}}(a108_0x3b6c,0xc2e8d));var __decorate=this&&this[a108_0x2eebd2(0x173)]||function(_0x1cc700,_0xa4d783,_0x3c359b,_0x460581){const _0x59105c=a108_0x2eebd2;var _0x1bfc4a=arguments['length'],_0x401812=_0x1bfc4a<0x3?_0xa4d783:_0x460581===null?_0x460581=Object[_0x59105c(0x164)](_0xa4d783,_0x3c359b):_0x460581,_0xad93ea;if(typeof Reflect===_0x59105c(0x1a6)&&typeof Reflect[_0x59105c(0x18a)]===_0x59105c(0x196))_0x401812=Reflect[_0x59105c(0x18a)](_0x1cc700,_0xa4d783,_0x3c359b,_0x460581);else{for(var _0x4bbd2e=_0x1cc700[_0x59105c(0x192)]-0x1;_0x4bbd2e>=0x0;_0x4bbd2e--)if(_0xad93ea=_0x1cc700[_0x4bbd2e])_0x401812=(_0x1bfc4a<0x3?_0xad93ea(_0x401812):_0x1bfc4a>0x3?_0xad93ea(_0xa4d783,_0x3c359b,_0x401812):_0xad93ea(_0xa4d783,_0x3c359b))||_0x401812;}return _0x1bfc4a>0x3&&_0x401812&&Object[_0x59105c(0x190)](_0xa4d783,_0x3c359b,_0x401812),_0x401812;},__metadata=this&&this[a108_0x2eebd2(0x1a1)]||function(_0x3fed25,_0x216374){const _0x5c9080=a108_0x2eebd2;if(typeof Reflect==='object'&&typeof Reflect[_0x5c9080(0x18b)]===_0x5c9080(0x196))return Reflect[_0x5c9080(0x18b)](_0x3fed25,_0x216374);},__param=this&&this[a108_0x2eebd2(0x175)]||function(_0x469477,_0x56a3c1){return function(_0x565a48,_0x2bf32e){_0x56a3c1(_0x565a48,_0x2bf32e,_0x469477);};};function a108_0x3eab(_0x4dbe27,_0x522a92){const _0x3b6c31=a108_0x3b6c();return a108_0x3eab=function(_0x3eab8d,_0x262bf9){_0x3eab8d=_0x3eab8d-0x164;let _0xe49aa4=_0x3b6c31[_0x3eab8d];return _0xe49aa4;},a108_0x3eab(_0x4dbe27,_0x522a92);}function a108_0x3b6c(){const _0x132368=['toISOString','isAfter','map','findAllActiveSchedules','format','findEligibleSchedule','Injectable','2901666qeOJwk','createdAtUtc','design:paramtypes','8208752QAbFpm','includeDates','299044NKZOjL','events','uuid','decorate','metadata','sort','24948MVkqmw','scheduleModel','findByIdAndDelete','defineProperty','getDate','length','5SrLZpJ','InjectModel','find','function','699438dRQYHs','findAll','assign','startOf','ScheduleService','getTime','1288463pADSmO','day','save','all','__metadata','../common/utils','removeOtherExistingIncludeDates','7868735IMNLcz','filter','object','addIncludeDate','getOwnPropertyDescriptor','push','weekDays','Model','findOne','getDay','@nestjs/common','findByIdAndUpdate','mongoose','YYYY-MM-DD','exec','clone','setDate','findIndex','create','__decorate','includes','__param','toObject','1350jQiUSw','remove','51mMPbFM','@nestjs/mongoose'];a108_0x3b6c=function(){return _0x132368;};return a108_0x3b6c();}Object[a108_0x2eebd2(0x190)](exports,'__esModule',{'value':!![]}),exports[a108_0x2eebd2(0x19b)]=void 0x0;const common_1=require(a108_0x2eebd2(0x16a)),mongoose_1=require(a108_0x2eebd2(0x17a)),mongoose_2=require(a108_0x2eebd2(0x16c)),dayjs=require('dayjs'),utils_1=require(a108_0x2eebd2(0x1a2)),schedulePrioritySort=(_0x4d3b14,_0x594ab4)=>dayjs(_0x4d3b14[a108_0x2eebd2(0x183)])[a108_0x2eebd2(0x17c)](dayjs(_0x594ab4[a108_0x2eebd2(0x183)]))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0x305a5a){const _0x3291aa=a108_0x2eebd2;this[_0x3291aa(0x18e)]=_0x305a5a;}async[a108_0x2eebd2(0x172)](_0x1adb3f){const _0x331702=a108_0x2eebd2,_0x3eef20=new this['scheduleModel'](_0x1adb3f);return _0x3eef20[_0x331702(0x19f)]();}async[a108_0x2eebd2(0x198)](){const _0x1fd0ee=a108_0x2eebd2,_0x4f2391=await this['scheduleModel']['find']()[_0x1fd0ee(0x16e)]();return _0x4f2391;}async[a108_0x2eebd2(0x168)](_0x16ff46){const _0x15f366=a108_0x2eebd2,_0x2e2aa6=await this[_0x15f366(0x18e)]['findById'](_0x16ff46);return _0x2e2aa6;}async['findEligibleSchedule'](_0x51c9f5){const _0x391fac=a108_0x2eebd2,_0x38ce89=await this[_0x391fac(0x17e)](_0x51c9f5),_0x3a59a4=_0x38ce89[_0x391fac(0x1a5)](_0x440dd9=>_0x440dd9['includeDates'][_0x391fac(0x192)]>0x0&&_0x440dd9[_0x391fac(0x186)]['map'](_0x453dda=>dayjs(_0x453dda)[_0x391fac(0x17f)](_0x391fac(0x16d)))[_0x391fac(0x174)](dayjs(_0x51c9f5)['format'](_0x391fac(0x16d))))[_0x391fac(0x18c)](schedulePrioritySort);if(_0x3a59a4[_0x391fac(0x192)]>0x0)return _0x3a59a4[0x0];const _0x3e4798=_0x38ce89[_0x391fac(0x1a5)](_0x174ca5=>_0x174ca5[_0x391fac(0x166)][_0x391fac(0x174)](_0x51c9f5[_0x391fac(0x169)]()))[_0x391fac(0x18c)](schedulePrioritySort);if(_0x3e4798[_0x391fac(0x192)]>0x0)return _0x3e4798[0x0];return null;}async['findAllActiveSchedules'](_0x4f2e9a){const _0x34c126=a108_0x2eebd2,_0x573042=dayjs(_0x4f2e9a)[_0x34c126(0x19a)](_0x34c126(0x19e))['toDate'](),_0x257ebd={'$and':[{'$or':[{'startDate':{'$lte':_0x4f2e9a},'endDate':{'$gte':_0x4f2e9a}},{'startDate':{'$lte':_0x4f2e9a},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x4f2e9a}}]},{'excludeDates':{'$nin':[_0x573042]}}]},_0x4e65e1=await this[_0x34c126(0x18e)][_0x34c126(0x195)](_0x257ebd)[_0x34c126(0x16e)]();return _0x4e65e1;}async['findEligibleScheduleBetween'](_0x461e1e,_0x2f3471){const _0x3e05d8=a108_0x2eebd2,_0x43b5bf=new Date(_0x461e1e),_0xb62d57={};while(_0x43b5bf<=_0x2f3471){const _0x4c3653=await this[_0x3e05d8(0x180)](_0x43b5bf);_0x4c3653&&(_0xb62d57[dayjs(_0x43b5bf)[_0x3e05d8(0x17f)](_0x3e05d8(0x16d))]=_0x4c3653),_0x43b5bf[_0x3e05d8(0x170)](_0x43b5bf[_0x3e05d8(0x191)]()+0x1);}return _0xb62d57;}async['update'](_0x30592e,_0xbab836){const _0x3362c0=a108_0x2eebd2,_0x42d6e1=await this[_0x3362c0(0x18e)][_0x3362c0(0x16b)](_0x30592e,Object[_0x3362c0(0x199)](Object[_0x3362c0(0x199)]({},_0xbab836),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x3362c0(0x16e)]();return _0x42d6e1[_0x3362c0(0x186)]&&await this['removeOtherExistingIncludeDates'](_0x30592e,_0x42d6e1[_0x3362c0(0x186)]),_0x42d6e1;}async[a108_0x2eebd2(0x178)](_0x4c8969){const _0x5512a7=a108_0x2eebd2,_0x275eeb=await this['scheduleModel'][_0x5512a7(0x18f)](_0x4c8969)['exec']();return _0x275eeb;}async[a108_0x2eebd2(0x1a7)](_0x5ac31d,_0x150fc8){const _0x14097b=a108_0x2eebd2,_0x4a5578=await this[_0x14097b(0x168)](_0x5ac31d);_0x4a5578[_0x14097b(0x186)][_0x14097b(0x171)](_0x75516d=>_0x75516d[_0x14097b(0x19c)]()===_0x150fc8[_0x14097b(0x19c)]())===-0x1&&_0x4a5578['includeDates'][_0x14097b(0x165)](_0x150fc8);const _0x468a68=await _0x4a5578['save']();return await this[_0x14097b(0x1a3)](_0x5ac31d,[_0x150fc8]),_0x468a68;}async[a108_0x2eebd2(0x1a3)](_0x40baf1,_0x258137){const _0x1a9ca4=a108_0x2eebd2,_0x40f2c4=await this['scheduleModel']['find']({'_id':{'$ne':_0x40baf1},'includeDates':{'$in':_0x258137}})[_0x1a9ca4(0x16e)](),_0x5559f7=_0x258137[_0x1a9ca4(0x17d)](_0x339bea=>_0x339bea['toISOString']());await Promise[_0x1a9ca4(0x1a0)](_0x40f2c4[_0x1a9ca4(0x17d)](_0x364c1f=>{const _0x115c01=_0x1a9ca4,_0x3db093=_0x364c1f[_0x115c01(0x186)][_0x115c01(0x1a5)](_0xf8f814=>!_0x5559f7[_0x115c01(0x174)](_0xf8f814[_0x115c01(0x17b)]()));return _0x364c1f[_0x115c01(0x186)]=_0x3db093,_0x364c1f['updatedAtUtc']=new Date(),_0x364c1f['save']();}));}async[a108_0x2eebd2(0x16f)](_0x3a3b13){const _0x1d3c82=a108_0x2eebd2,_0xaf05cd=await this['findOne'](_0x3a3b13),_0x417086=_0xaf05cd[_0x1d3c82(0x188)][_0x1d3c82(0x17d)](_0xf85c7=>Object['assign'](Object[_0x1d3c82(0x199)]({},_0xf85c7),{'id':(0x0,utils_1[_0x1d3c82(0x189)])()})),_0x59930d=new this[(_0x1d3c82(0x18e))](Object['assign'](Object[_0x1d3c82(0x199)]({},_0xaf05cd[_0x1d3c82(0x176)]()),{'events':_0x417086,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x59930d[_0x1d3c82(0x19f)]();}};ScheduleService=__decorate([(0x0,common_1[a108_0x2eebd2(0x181)])(),__param(0x0,(0x0,mongoose_1[a108_0x2eebd2(0x194)])('Schedule')),__metadata(a108_0x2eebd2(0x184),[mongoose_2[a108_0x2eebd2(0x167)]])],ScheduleService),exports[a108_0x2eebd2(0x19b)]=ScheduleService;