'use strict';const a108_0x26844b=a108_0x3d62;function a108_0x1cc6(){const _0x3126a5=['createdAtUtc','6CxWHTA','includeDates','findAllActiveSchedules','defineProperty','sort','YYYY-MM-DD','getTime','length','findByIdAndDelete','3424389dPnghb','9670AMGDjQ','removeOtherExistingIncludeDates','events','day','filter','toISOString','__metadata','uuid','assign','ScheduleService','find','Injectable','6885236YWutnC','findEligibleSchedule','Schedule','__param','dayjs','53ZgTcpC','InjectModel','map','__decorate','scheduleModel','findOne','exec','setDate','@nestjs/mongoose','startOf','all','../common/utils','__esModule','getDate','findByIdAndUpdate','44847kFEHwW','function','updatedAtUtc','design:paramtypes','metadata','includes','save','clone','30426jRVTXY','6203160MzNPjF','push','Model','findEligibleScheduleBetween','6908405UCnfBJ','toDate','9alNQpL','object','toObject','6550516bANzCy','update','format','decorate','findIndex','mongoose','findAll','isAfter','@nestjs/common'];a108_0x1cc6=function(){return _0x3126a5;};return a108_0x1cc6();}(function(_0x263128,_0xa7960e){const _0x1438fd=a108_0x3d62,_0x95492a=_0x263128();while(!![]){try{const _0xaf6ee0=-parseInt(_0x1438fd(0x1c4))/0x1*(-parseInt(_0x1438fd(0x195))/0x2)+parseInt(_0x1438fd(0x1b2))/0x3+parseInt(_0x1438fd(0x1bf))/0x4+parseInt(_0x1438fd(0x19a))/0x5+parseInt(_0x1438fd(0x1a9))/0x6*(-parseInt(_0x1438fd(0x19f))/0x7)+-parseInt(_0x1438fd(0x196))/0x8*(-parseInt(_0x1438fd(0x19c))/0x9)+parseInt(_0x1438fd(0x1b3))/0xa*(-parseInt(_0x1438fd(0x1d3))/0xb);if(_0xaf6ee0===_0xa7960e)break;else _0x95492a['push'](_0x95492a['shift']());}catch(_0xe14ecd){_0x95492a['push'](_0x95492a['shift']());}}}(a108_0x1cc6,0xe76b2));var __decorate=this&&this[a108_0x26844b(0x1c7)]||function(_0x2a0a61,_0x1e12b9,_0x5b38dd,_0x40bf9e){const _0x3c120b=a108_0x26844b;var _0x196f7b=arguments[_0x3c120b(0x1b0)],_0xf843b8=_0x196f7b<0x3?_0x1e12b9:_0x40bf9e===null?_0x40bf9e=Object['getOwnPropertyDescriptor'](_0x1e12b9,_0x5b38dd):_0x40bf9e,_0x216520;if(typeof Reflect==='object'&&typeof Reflect[_0x3c120b(0x1a2)]===_0x3c120b(0x18e))_0xf843b8=Reflect[_0x3c120b(0x1a2)](_0x2a0a61,_0x1e12b9,_0x5b38dd,_0x40bf9e);else{for(var _0x1233f8=_0x2a0a61[_0x3c120b(0x1b0)]-0x1;_0x1233f8>=0x0;_0x1233f8--)if(_0x216520=_0x2a0a61[_0x1233f8])_0xf843b8=(_0x196f7b<0x3?_0x216520(_0xf843b8):_0x196f7b>0x3?_0x216520(_0x1e12b9,_0x5b38dd,_0xf843b8):_0x216520(_0x1e12b9,_0x5b38dd))||_0xf843b8;}return _0x196f7b>0x3&&_0xf843b8&&Object[_0x3c120b(0x1ac)](_0x1e12b9,_0x5b38dd,_0xf843b8),_0xf843b8;},__metadata=this&&this[a108_0x26844b(0x1b9)]||function(_0xf26645,_0x378f14){const _0x13b4aa=a108_0x26844b;if(typeof Reflect===_0x13b4aa(0x19d)&&typeof Reflect[_0x13b4aa(0x191)]===_0x13b4aa(0x18e))return Reflect[_0x13b4aa(0x191)](_0xf26645,_0x378f14);},__param=this&&this[a108_0x26844b(0x1c2)]||function(_0x99da6a,_0x173a68){return function(_0x518611,_0x44e08d){_0x173a68(_0x518611,_0x44e08d,_0x99da6a);};};Object[a108_0x26844b(0x1ac)](exports,a108_0x26844b(0x1d0),{'value':!![]}),exports[a108_0x26844b(0x1bc)]=void 0x0;function a108_0x3d62(_0x1b107d,_0x26f99a){const _0x1cc63e=a108_0x1cc6();return a108_0x3d62=function(_0x3d624d,_0x34e4b6){_0x3d624d=_0x3d624d-0x18e;let _0x3c0172=_0x1cc63e[_0x3d624d];return _0x3c0172;},a108_0x3d62(_0x1b107d,_0x26f99a);}const common_1=require(a108_0x26844b(0x1a7)),mongoose_1=require(a108_0x26844b(0x1cc)),mongoose_2=require(a108_0x26844b(0x1a4)),dayjs=require(a108_0x26844b(0x1c3)),utils_1=require(a108_0x26844b(0x1cf)),schedulePrioritySort=(_0x27b419,_0x35210b)=>dayjs(_0x27b419[a108_0x26844b(0x1a8)])[a108_0x26844b(0x1a6)](dayjs(_0x35210b[a108_0x26844b(0x1a8)]))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0x356849){const _0x3a2548=a108_0x26844b;this[_0x3a2548(0x1c8)]=_0x356849;}async['create'](_0x4cdbbc){const _0x1f31fc=a108_0x26844b,_0x385955=new this[(_0x1f31fc(0x1c8))](_0x4cdbbc);return _0x385955[_0x1f31fc(0x193)]();}async[a108_0x26844b(0x1a5)](){const _0x5006ef=a108_0x26844b,_0x140642=await this[_0x5006ef(0x1c8)][_0x5006ef(0x1bd)]()[_0x5006ef(0x1ca)]();return _0x140642;}async[a108_0x26844b(0x1c9)](_0x5c7dc9){const _0x27c7f0=a108_0x26844b,_0x233dbc=await this[_0x27c7f0(0x1c8)]['findById'](_0x5c7dc9);return _0x233dbc;}async[a108_0x26844b(0x1c0)](_0x985214){const _0x339304=a108_0x26844b,_0x4acc5b=await this[_0x339304(0x1ab)](_0x985214),_0x515bde=_0x4acc5b[_0x339304(0x1b7)](_0x2eb323=>_0x2eb323[_0x339304(0x1aa)][_0x339304(0x1b0)]>0x0&&_0x2eb323[_0x339304(0x1aa)][_0x339304(0x1c6)](_0x3317f8=>dayjs(_0x3317f8)[_0x339304(0x1a1)](_0x339304(0x1ae)))['includes'](dayjs(_0x985214)[_0x339304(0x1a1)](_0x339304(0x1ae))))['sort'](schedulePrioritySort);if(_0x515bde[_0x339304(0x1b0)]>0x0)return _0x515bde[0x0];const _0x42fc8c=_0x4acc5b[_0x339304(0x1b7)](_0x38f7d6=>_0x38f7d6['weekDays'][_0x339304(0x192)](_0x985214['getDay']()))[_0x339304(0x1ad)](schedulePrioritySort);if(_0x42fc8c[_0x339304(0x1b0)]>0x0)return _0x42fc8c[0x0];return null;}async[a108_0x26844b(0x1ab)](_0x29b36c){const _0x300761=a108_0x26844b,_0x297346=dayjs(_0x29b36c)[_0x300761(0x1cd)](_0x300761(0x1b6))[_0x300761(0x19b)](),_0x4dd77b={'$and':[{'$or':[{'startDate':{'$lte':_0x29b36c},'endDate':{'$gte':_0x29b36c}},{'startDate':{'$lte':_0x29b36c},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x29b36c}}]},{'excludeDates':{'$nin':[_0x297346]}}]},_0x537cc9=await this[_0x300761(0x1c8)][_0x300761(0x1bd)](_0x4dd77b)[_0x300761(0x1ca)]();return _0x537cc9;}async[a108_0x26844b(0x199)](_0x4608c4,_0x34536a){const _0x2af923=a108_0x26844b,_0x2efb6c=new Date(_0x4608c4),_0x3274dd={};while(_0x2efb6c<=_0x34536a){const _0x307965=await this['findEligibleSchedule'](_0x2efb6c);_0x307965&&(_0x3274dd[dayjs(_0x2efb6c)[_0x2af923(0x1a1)](_0x2af923(0x1ae))]=_0x307965),_0x2efb6c[_0x2af923(0x1cb)](_0x2efb6c[_0x2af923(0x1d1)]()+0x1);}return _0x3274dd;}async[a108_0x26844b(0x1a0)](_0x56778e,_0x5a0d0b){const _0x312bf0=a108_0x26844b,_0x472c07=await this[_0x312bf0(0x1c8)][_0x312bf0(0x1d2)](_0x56778e,Object[_0x312bf0(0x1bb)](Object[_0x312bf0(0x1bb)]({},_0x5a0d0b),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x312bf0(0x1ca)]();return _0x472c07[_0x312bf0(0x1aa)]&&await this[_0x312bf0(0x1b4)](_0x56778e,_0x472c07[_0x312bf0(0x1aa)]),_0x472c07;}async['remove'](_0x180d38){const _0x13422b=a108_0x26844b,_0x1af756=await this[_0x13422b(0x1c8)][_0x13422b(0x1b1)](_0x180d38)[_0x13422b(0x1ca)]();return _0x1af756;}async['addIncludeDate'](_0x5f231c,_0x4e2d1f){const _0x5815c0=a108_0x26844b,_0x408c82=await this[_0x5815c0(0x1c9)](_0x5f231c);_0x408c82[_0x5815c0(0x1aa)][_0x5815c0(0x1a3)](_0x4eebda=>_0x4eebda['getTime']()===_0x4e2d1f[_0x5815c0(0x1af)]())===-0x1&&_0x408c82[_0x5815c0(0x1aa)][_0x5815c0(0x197)](_0x4e2d1f);const _0x35dc36=await _0x408c82[_0x5815c0(0x193)]();return await this['removeOtherExistingIncludeDates'](_0x5f231c,[_0x4e2d1f]),_0x35dc36;}async[a108_0x26844b(0x1b4)](_0x20a593,_0x64c367){const _0x5a032d=a108_0x26844b,_0x5bd90d=await this[_0x5a032d(0x1c8)][_0x5a032d(0x1bd)]({'_id':{'$ne':_0x20a593},'includeDates':{'$in':_0x64c367}})['exec'](),_0x63609d=_0x64c367['map'](_0x1a377d=>_0x1a377d[_0x5a032d(0x1b8)]());await Promise[_0x5a032d(0x1ce)](_0x5bd90d[_0x5a032d(0x1c6)](_0xd19b46=>{const _0x19b73a=_0x5a032d,_0x4c3d72=_0xd19b46[_0x19b73a(0x1aa)][_0x19b73a(0x1b7)](_0x44b759=>!_0x63609d['includes'](_0x44b759['toISOString']()));return _0xd19b46[_0x19b73a(0x1aa)]=_0x4c3d72,_0xd19b46[_0x19b73a(0x18f)]=new Date(),_0xd19b46['save']();}));}async[a108_0x26844b(0x194)](_0x3e7b2f){const _0x15adbf=a108_0x26844b,_0x3c2340=await this[_0x15adbf(0x1c9)](_0x3e7b2f),_0x1405b6=_0x3c2340[_0x15adbf(0x1b5)]['map'](_0x3173e9=>Object[_0x15adbf(0x1bb)](Object[_0x15adbf(0x1bb)]({},_0x3173e9),{'id':(0x0,utils_1[_0x15adbf(0x1ba)])()})),_0x393dd4=new this[(_0x15adbf(0x1c8))](Object[_0x15adbf(0x1bb)](Object[_0x15adbf(0x1bb)]({},_0x3c2340[_0x15adbf(0x19e)]()),{'events':_0x1405b6,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x393dd4[_0x15adbf(0x193)]();}};ScheduleService=__decorate([(0x0,common_1[a108_0x26844b(0x1be)])(),__param(0x0,(0x0,mongoose_1[a108_0x26844b(0x1c5)])(a108_0x26844b(0x1c1))),__metadata(a108_0x26844b(0x190),[mongoose_2[a108_0x26844b(0x198)]])],ScheduleService),exports['ScheduleService']=ScheduleService;