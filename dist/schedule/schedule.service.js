'use strict';function a108_0x555e(){const _0x46b46c=['clone','weekDays','removeOtherExistingIncludeDates','366140LXSyao','length','11473wQOYGU','ScheduleService','exec','1489738PgoUSW','findEligibleSchedule','object','day','includes','find','map','__decorate','3786VQYJYZ','save','findEligibleScheduleBetween','toObject','dayjs','findByIdAndDelete','10308008QinglA','getDate','update','updatedAtUtc','create','function','findOne','2367ZFzZQW','sort','findAll','__param','mongoose','format','38510WJKfHP','Schedule','decorate','380858dlenDZ','getDay','isAfter','findById','metadata','addIncludeDate','findAllActiveSchedules','toDate','assign','push','findByIdAndUpdate','Injectable','defineProperty','getTime','includeDates','75Jzdbdh','YYYY-MM-DD','remove','@nestjs/mongoose','design:paramtypes','findIndex','filter','all','__metadata','2133078xZtJve','Model','createdAtUtc','scheduleModel','toISOString','@nestjs/common'];a108_0x555e=function(){return _0x46b46c;};return a108_0x555e();}const a108_0x24b44d=a108_0x517e;function a108_0x517e(_0x1b39b8,_0x43655e){const _0x555e27=a108_0x555e();return a108_0x517e=function(_0x517e1b,_0x141c06){_0x517e1b=_0x517e1b-0x112;let _0x221c5e=_0x555e27[_0x517e1b];return _0x221c5e;},a108_0x517e(_0x1b39b8,_0x43655e);}(function(_0x44f74b,_0x50ed84){const _0x40b4b6=a108_0x517e,_0x4af114=_0x44f74b();while(!![]){try{const _0x59d585=parseInt(_0x40b4b6(0x125))/0x1+parseInt(_0x40b4b6(0x143))/0x2+-parseInt(_0x40b4b6(0x117))/0x3+parseInt(_0x40b4b6(0x120))/0x4*(-parseInt(_0x40b4b6(0x152))/0x5)+-parseInt(_0x40b4b6(0x12d))/0x6*(parseInt(_0x40b4b6(0x122))/0x7)+parseInt(_0x40b4b6(0x133))/0x8+-parseInt(_0x40b4b6(0x13a))/0x9*(-parseInt(_0x40b4b6(0x140))/0xa);if(_0x59d585===_0x50ed84)break;else _0x4af114['push'](_0x4af114['shift']());}catch(_0xd2f62f){_0x4af114['push'](_0x4af114['shift']());}}}(a108_0x555e,0xd2bf5));var __decorate=this&&this[a108_0x24b44d(0x12c)]||function(_0x2803bb,_0x6704e4,_0xe5d62d,_0xfe1e9a){const _0x1d7542=a108_0x24b44d;var _0x1cfc01=arguments[_0x1d7542(0x121)],_0x559401=_0x1cfc01<0x3?_0x6704e4:_0xfe1e9a===null?_0xfe1e9a=Object['getOwnPropertyDescriptor'](_0x6704e4,_0xe5d62d):_0xfe1e9a,_0x2785a6;if(typeof Reflect===_0x1d7542(0x127)&&typeof Reflect[_0x1d7542(0x142)]===_0x1d7542(0x138))_0x559401=Reflect[_0x1d7542(0x142)](_0x2803bb,_0x6704e4,_0xe5d62d,_0xfe1e9a);else{for(var _0x168dd4=_0x2803bb[_0x1d7542(0x121)]-0x1;_0x168dd4>=0x0;_0x168dd4--)if(_0x2785a6=_0x2803bb[_0x168dd4])_0x559401=(_0x1cfc01<0x3?_0x2785a6(_0x559401):_0x1cfc01>0x3?_0x2785a6(_0x6704e4,_0xe5d62d,_0x559401):_0x2785a6(_0x6704e4,_0xe5d62d))||_0x559401;}return _0x1cfc01>0x3&&_0x559401&&Object[_0x1d7542(0x14f)](_0x6704e4,_0xe5d62d,_0x559401),_0x559401;},__metadata=this&&this[a108_0x24b44d(0x116)]||function(_0x317817,_0x393b40){const _0x4395f0=a108_0x24b44d;if(typeof Reflect===_0x4395f0(0x127)&&typeof Reflect[_0x4395f0(0x147)]===_0x4395f0(0x138))return Reflect['metadata'](_0x317817,_0x393b40);},__param=this&&this[a108_0x24b44d(0x13d)]||function(_0x323741,_0x47a2dd){return function(_0x3c4903,_0x1a9362){_0x47a2dd(_0x3c4903,_0x1a9362,_0x323741);};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a108_0x24b44d(0x123)]=void 0x0;const common_1=require(a108_0x24b44d(0x11c)),mongoose_1=require(a108_0x24b44d(0x155)),mongoose_2=require(a108_0x24b44d(0x13e)),dayjs=require(a108_0x24b44d(0x131)),utils_1=require('../common/utils'),schedulePrioritySort=(_0x3a3305,_0x4854be)=>dayjs(_0x3a3305[a108_0x24b44d(0x119)])[a108_0x24b44d(0x145)](dayjs(_0x4854be['createdAtUtc']))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0x5daa46){this['scheduleModel']=_0x5daa46;}async[a108_0x24b44d(0x137)](_0x3d0068){const _0x22b618=a108_0x24b44d,_0x355ecf=new this[(_0x22b618(0x11a))](_0x3d0068);return _0x355ecf[_0x22b618(0x12e)]();}async[a108_0x24b44d(0x13c)](){const _0x4360cf=a108_0x24b44d,_0x1a7a20=await this[_0x4360cf(0x11a)][_0x4360cf(0x12a)]()[_0x4360cf(0x124)]();return _0x1a7a20;}async[a108_0x24b44d(0x139)](_0x45e50d){const _0x5f3072=a108_0x24b44d,_0x48a525=await this[_0x5f3072(0x11a)][_0x5f3072(0x146)](_0x45e50d);return _0x48a525;}async[a108_0x24b44d(0x126)](_0xe36f72){const _0x2593e7=a108_0x24b44d,_0xd10b79=await this['findAllActiveSchedules'](_0xe36f72),_0x170e85=_0xd10b79[_0x2593e7(0x114)](_0x4a153a=>_0x4a153a[_0x2593e7(0x151)][_0x2593e7(0x121)]>0x0&&_0x4a153a[_0x2593e7(0x151)]['map'](_0x228624=>dayjs(_0x228624)[_0x2593e7(0x13f)](_0x2593e7(0x153)))[_0x2593e7(0x129)](dayjs(_0xe36f72)[_0x2593e7(0x13f)](_0x2593e7(0x153))))[_0x2593e7(0x13b)](schedulePrioritySort);if(_0x170e85[_0x2593e7(0x121)]>0x0)return _0x170e85[0x0];const _0x54eb02=_0xd10b79[_0x2593e7(0x114)](_0x38bd9c=>_0x38bd9c[_0x2593e7(0x11e)][_0x2593e7(0x129)](_0xe36f72[_0x2593e7(0x144)]()))[_0x2593e7(0x13b)](schedulePrioritySort);if(_0x54eb02['length']>0x0)return _0x54eb02[0x0];return null;}async[a108_0x24b44d(0x149)](_0x34354a){const _0x162518=a108_0x24b44d,_0x3d5d12=dayjs(_0x34354a)['startOf'](_0x162518(0x128))[_0x162518(0x14a)](),_0x15ee56={'$and':[{'$or':[{'startDate':{'$lte':_0x34354a},'endDate':{'$gte':_0x34354a}},{'startDate':{'$lte':_0x34354a},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x34354a}}]},{'excludeDates':{'$nin':[_0x3d5d12]}}]},_0x1e7ff3=await this[_0x162518(0x11a)][_0x162518(0x12a)](_0x15ee56)[_0x162518(0x124)]();return _0x1e7ff3;}async[a108_0x24b44d(0x12f)](_0x166208,_0xf3490c){const _0x12b378=a108_0x24b44d,_0x46217c=new Date(_0x166208),_0x4c5287={};while(_0x46217c<=_0xf3490c){const _0xcf148a=await this[_0x12b378(0x126)](_0x46217c);_0xcf148a&&(_0x4c5287[dayjs(_0x46217c)[_0x12b378(0x13f)](_0x12b378(0x153))]=_0xcf148a),_0x46217c['setDate'](_0x46217c[_0x12b378(0x134)]()+0x1);}return _0x4c5287;}async[a108_0x24b44d(0x135)](_0x18a26c,_0x483dd6){const _0x541661=a108_0x24b44d,_0x167db1=await this[_0x541661(0x11a)][_0x541661(0x14d)](_0x18a26c,Object[_0x541661(0x14b)](Object[_0x541661(0x14b)]({},_0x483dd6),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x541661(0x124)]();return _0x167db1[_0x541661(0x151)]&&await this[_0x541661(0x11f)](_0x18a26c,_0x167db1[_0x541661(0x151)]),_0x167db1;}async[a108_0x24b44d(0x154)](_0x2724c1){const _0x18821c=a108_0x24b44d,_0x210ca8=await this['scheduleModel'][_0x18821c(0x132)](_0x2724c1)[_0x18821c(0x124)]();return _0x210ca8;}async[a108_0x24b44d(0x148)](_0x2d0ba1,_0x413919){const _0x4e66a3=a108_0x24b44d,_0x364f65=await this['findOne'](_0x2d0ba1);_0x364f65[_0x4e66a3(0x151)][_0x4e66a3(0x113)](_0x5de451=>_0x5de451[_0x4e66a3(0x150)]()===_0x413919[_0x4e66a3(0x150)]())===-0x1&&_0x364f65['includeDates'][_0x4e66a3(0x14c)](_0x413919);const _0x55ed12=await _0x364f65[_0x4e66a3(0x12e)]();return await this[_0x4e66a3(0x11f)](_0x2d0ba1,[_0x413919]),_0x55ed12;}async[a108_0x24b44d(0x11f)](_0x247a3a,_0x4217a2){const _0x20239=a108_0x24b44d,_0xb504f2=await this['scheduleModel'][_0x20239(0x12a)]({'_id':{'$ne':_0x247a3a},'includeDates':{'$in':_0x4217a2}})['exec'](),_0x17b0eb=_0x4217a2[_0x20239(0x12b)](_0x5deb10=>_0x5deb10[_0x20239(0x11b)]());await Promise[_0x20239(0x115)](_0xb504f2[_0x20239(0x12b)](_0x5470cf=>{const _0x232092=_0x20239,_0x4b68f4=_0x5470cf[_0x232092(0x151)][_0x232092(0x114)](_0x523016=>!_0x17b0eb[_0x232092(0x129)](_0x523016[_0x232092(0x11b)]()));return _0x5470cf[_0x232092(0x151)]=_0x4b68f4,_0x5470cf[_0x232092(0x136)]=new Date(),_0x5470cf['save']();}));}async[a108_0x24b44d(0x11d)](_0x59b961){const _0x55d984=a108_0x24b44d,_0xfc5995=await this[_0x55d984(0x139)](_0x59b961),_0x58dbd8=_0xfc5995['events'][_0x55d984(0x12b)](_0x5ea0fa=>Object[_0x55d984(0x14b)](Object[_0x55d984(0x14b)]({},_0x5ea0fa),{'id':(0x0,utils_1['uuid'])()})),_0x6ac235=new this[(_0x55d984(0x11a))](Object['assign'](Object[_0x55d984(0x14b)]({},_0xfc5995[_0x55d984(0x130)]()),{'events':_0x58dbd8,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x6ac235[_0x55d984(0x12e)]();}};ScheduleService=__decorate([(0x0,common_1[a108_0x24b44d(0x14e)])(),__param(0x0,(0x0,mongoose_1['InjectModel'])(a108_0x24b44d(0x141))),__metadata(a108_0x24b44d(0x112),[mongoose_2[a108_0x24b44d(0x118)]])],ScheduleService),exports[a108_0x24b44d(0x123)]=ScheduleService;