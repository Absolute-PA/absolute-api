'use strict';const a108_0xf48201=a108_0x57d6;function a108_0x20d7(){const _0x1105a0=['dayjs','updatedAtUtc','uuid','createdAtUtc','InjectModel','sort','findEligibleSchedule','toISOString','includes','findByIdAndDelete','setDate','402335wMmLLe','decorate','findOne','findByIdAndUpdate','object','push','function','format','update','findAllActiveSchedules','Model','toObject','findAll','startOf','create','removeOtherExistingIncludeDates','__metadata','day','2478564qnhldW','Schedule','@nestjs/common','includeDates','toDate','6481uNgxLm','6831720EXhMnj','getDay','getOwnPropertyDescriptor','getTime','../common/utils','9EBeDpm','map','design:paramtypes','length','2231322YeurHU','events','defineProperty','__esModule','findEligibleScheduleBetween','ScheduleService','getDate','7221984BhWYSP','YYYY-MM-DD','assign','mongoose','isAfter','10318376MUVYVn','@nestjs/mongoose','exec','save','findById','scheduleModel','find','filter','226uNBFGK'];a108_0x20d7=function(){return _0x1105a0;};return a108_0x20d7();}(function(_0x2b9f94,_0x201143){const _0x4e112e=a108_0x57d6,_0x215088=_0x2b9f94();while(!![]){try{const _0x4cf670=parseInt(_0x4e112e(0xd5))/0x1*(-parseInt(_0x4e112e(0xf3))/0x2)+-parseInt(_0x4e112e(0xdf))/0x3+parseInt(_0x4e112e(0xd0))/0x4+parseInt(_0x4e112e(0xbe))/0x5+parseInt(_0x4e112e(0xd6))/0x6+-parseInt(_0x4e112e(0xe6))/0x7+-parseInt(_0x4e112e(0xeb))/0x8*(-parseInt(_0x4e112e(0xdb))/0x9);if(_0x4cf670===_0x201143)break;else _0x215088['push'](_0x215088['shift']());}catch(_0x42dde8){_0x215088['push'](_0x215088['shift']());}}}(a108_0x20d7,0x9788e));var __decorate=this&&this['__decorate']||function(_0x4da711,_0x57bc59,_0x536a67,_0x3c5c00){const _0x48cab2=a108_0x57d6;var _0x41be03=arguments[_0x48cab2(0xde)],_0x3ac2a7=_0x41be03<0x3?_0x57bc59:_0x3c5c00===null?_0x3c5c00=Object[_0x48cab2(0xd8)](_0x57bc59,_0x536a67):_0x3c5c00,_0x4c4cb9;if(typeof Reflect===_0x48cab2(0xc2)&&typeof Reflect[_0x48cab2(0xbf)]==='function')_0x3ac2a7=Reflect['decorate'](_0x4da711,_0x57bc59,_0x536a67,_0x3c5c00);else{for(var _0x4877b1=_0x4da711[_0x48cab2(0xde)]-0x1;_0x4877b1>=0x0;_0x4877b1--)if(_0x4c4cb9=_0x4da711[_0x4877b1])_0x3ac2a7=(_0x41be03<0x3?_0x4c4cb9(_0x3ac2a7):_0x41be03>0x3?_0x4c4cb9(_0x57bc59,_0x536a67,_0x3ac2a7):_0x4c4cb9(_0x57bc59,_0x536a67))||_0x3ac2a7;}return _0x41be03>0x3&&_0x3ac2a7&&Object[_0x48cab2(0xe1)](_0x57bc59,_0x536a67,_0x3ac2a7),_0x3ac2a7;},__metadata=this&&this[a108_0xf48201(0xce)]||function(_0x14b2b3,_0x4898c1){const _0x1d58b3=a108_0xf48201;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x1d58b3(0xc4))return Reflect['metadata'](_0x14b2b3,_0x4898c1);},__param=this&&this['__param']||function(_0x234231,_0x1e2fc3){return function(_0xe9bb08,_0xfbe31a){_0x1e2fc3(_0xe9bb08,_0xfbe31a,_0x234231);};};Object[a108_0xf48201(0xe1)](exports,a108_0xf48201(0xe2),{'value':!![]}),exports[a108_0xf48201(0xe4)]=void 0x0;function a108_0x57d6(_0x43029c,_0x65da8f){const _0x20d720=a108_0x20d7();return a108_0x57d6=function(_0x57d660,_0x13b5db){_0x57d660=_0x57d660-0xb5;let _0x483494=_0x20d720[_0x57d660];return _0x483494;},a108_0x57d6(_0x43029c,_0x65da8f);}const common_1=require(a108_0xf48201(0xd2)),mongoose_1=require(a108_0xf48201(0xec)),mongoose_2=require(a108_0xf48201(0xe9)),dayjs=require(a108_0xf48201(0xf4)),utils_1=require(a108_0xf48201(0xda)),schedulePrioritySort=(_0x1bef99,_0x27abab)=>dayjs(_0x1bef99[a108_0xf48201(0xb6)])[a108_0xf48201(0xea)](dayjs(_0x27abab[a108_0xf48201(0xb6)]))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0x167089){this['scheduleModel']=_0x167089;}async[a108_0xf48201(0xcc)](_0x3c5ec5){const _0xca0ba=new this['scheduleModel'](_0x3c5ec5);return _0xca0ba['save']();}async[a108_0xf48201(0xca)](){const _0x5acd7b=a108_0xf48201,_0x4e88ec=await this['scheduleModel'][_0x5acd7b(0xf1)]()[_0x5acd7b(0xed)]();return _0x4e88ec;}async['findOne'](_0x5ea60a){const _0x262589=a108_0xf48201,_0x34113f=await this[_0x262589(0xf0)][_0x262589(0xef)](_0x5ea60a);return _0x34113f;}async[a108_0xf48201(0xb9)](_0x3d2e34){const _0xfc6cf2=a108_0xf48201,_0x4f185c=await this[_0xfc6cf2(0xc7)](_0x3d2e34),_0x13e786=_0x4f185c['filter'](_0x220cd0=>_0x220cd0[_0xfc6cf2(0xd3)][_0xfc6cf2(0xde)]>0x0&&_0x220cd0[_0xfc6cf2(0xd3)][_0xfc6cf2(0xdc)](_0x120a66=>dayjs(_0x120a66)[_0xfc6cf2(0xc5)](_0xfc6cf2(0xe7)))[_0xfc6cf2(0xbb)](dayjs(_0x3d2e34)[_0xfc6cf2(0xc5)](_0xfc6cf2(0xe7))))[_0xfc6cf2(0xb8)](schedulePrioritySort);if(_0x13e786[_0xfc6cf2(0xde)]>0x0)return _0x13e786[0x0];const _0x166663=_0x4f185c[_0xfc6cf2(0xf2)](_0x58ba80=>_0x58ba80['weekDays'][_0xfc6cf2(0xbb)](_0x3d2e34[_0xfc6cf2(0xd7)]()))['sort'](schedulePrioritySort);if(_0x166663[_0xfc6cf2(0xde)]>0x0)return _0x166663[0x0];return null;}async[a108_0xf48201(0xc7)](_0x1c0955){const _0x37fcfb=a108_0xf48201,_0x2fb75f=dayjs(_0x1c0955)[_0x37fcfb(0xcb)](_0x37fcfb(0xcf))[_0x37fcfb(0xd4)](),_0x2e625d={'$and':[{'$or':[{'startDate':{'$lte':_0x1c0955},'endDate':{'$gte':_0x1c0955}},{'startDate':{'$lte':_0x1c0955},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x1c0955}}]},{'excludeDates':{'$nin':[_0x2fb75f]}}]},_0x31e23c=await this[_0x37fcfb(0xf0)][_0x37fcfb(0xf1)](_0x2e625d)['exec']();return _0x31e23c;}async[a108_0xf48201(0xe3)](_0x4f942e,_0x8cad3f){const _0x225501=a108_0xf48201,_0x1c96cb=new Date(_0x4f942e),_0x5e582a={};while(_0x1c96cb<=_0x8cad3f){const _0x507f9e=await this[_0x225501(0xb9)](_0x1c96cb);_0x507f9e&&(_0x5e582a[dayjs(_0x1c96cb)[_0x225501(0xc5)]('YYYY-MM-DD')]=_0x507f9e),_0x1c96cb[_0x225501(0xbd)](_0x1c96cb[_0x225501(0xe5)]()+0x1);}return _0x5e582a;}async[a108_0xf48201(0xc6)](_0x3bf134,_0x493c00){const _0x3ff0a2=a108_0xf48201,_0x1b44e9=await this[_0x3ff0a2(0xf0)][_0x3ff0a2(0xc1)](_0x3bf134,Object[_0x3ff0a2(0xe8)](Object[_0x3ff0a2(0xe8)]({},_0x493c00),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x3ff0a2(0xed)]();return _0x1b44e9['includeDates']&&await this[_0x3ff0a2(0xcd)](_0x3bf134,_0x1b44e9[_0x3ff0a2(0xd3)]),_0x1b44e9;}async['remove'](_0x1063d1){const _0x2ec642=a108_0xf48201,_0x40f219=await this[_0x2ec642(0xf0)][_0x2ec642(0xbc)](_0x1063d1)[_0x2ec642(0xed)]();return _0x40f219;}async['addIncludeDate'](_0x34f74d,_0x1e6e0c){const _0x2c61ec=a108_0xf48201,_0x1979b6=await this['findOne'](_0x34f74d);_0x1979b6['includeDates']['findIndex'](_0x32f99d=>_0x32f99d[_0x2c61ec(0xd9)]()===_0x1e6e0c['getTime']())===-0x1&&_0x1979b6[_0x2c61ec(0xd3)][_0x2c61ec(0xc3)](_0x1e6e0c);const _0x251aad=await _0x1979b6['save']();return await this[_0x2c61ec(0xcd)](_0x34f74d,[_0x1e6e0c]),_0x251aad;}async['removeOtherExistingIncludeDates'](_0x26694b,_0x144c4d){const _0x4a740d=a108_0xf48201,_0x1238b9=await this['scheduleModel'][_0x4a740d(0xf1)]({'_id':{'$ne':_0x26694b},'includeDates':{'$in':_0x144c4d}})[_0x4a740d(0xed)](),_0x9ebf00=_0x144c4d[_0x4a740d(0xdc)](_0x28cac9=>_0x28cac9[_0x4a740d(0xba)]());await Promise['all'](_0x1238b9[_0x4a740d(0xdc)](_0x1c2c83=>{const _0x6927cd=_0x4a740d,_0x3cf9f1=_0x1c2c83['includeDates'][_0x6927cd(0xf2)](_0x2b8ca9=>!_0x9ebf00[_0x6927cd(0xbb)](_0x2b8ca9[_0x6927cd(0xba)]()));return _0x1c2c83['includeDates']=_0x3cf9f1,_0x1c2c83[_0x6927cd(0xf5)]=new Date(),_0x1c2c83[_0x6927cd(0xee)]();}));}async['clone'](_0x21fe95){const _0x21d7c8=a108_0xf48201,_0xe4f286=await this[_0x21d7c8(0xc0)](_0x21fe95),_0x2d0c66=_0xe4f286[_0x21d7c8(0xe0)][_0x21d7c8(0xdc)](_0x1bc439=>Object[_0x21d7c8(0xe8)](Object['assign']({},_0x1bc439),{'id':(0x0,utils_1[_0x21d7c8(0xb5)])()})),_0xfdf8a2=new this[(_0x21d7c8(0xf0))](Object[_0x21d7c8(0xe8)](Object[_0x21d7c8(0xe8)]({},_0xe4f286[_0x21d7c8(0xc9)]()),{'events':_0x2d0c66,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0xfdf8a2[_0x21d7c8(0xee)]();}};ScheduleService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_1[a108_0xf48201(0xb7)])(a108_0xf48201(0xd1))),__metadata(a108_0xf48201(0xdd),[mongoose_2[a108_0xf48201(0xc8)]])],ScheduleService),exports[a108_0xf48201(0xe4)]=ScheduleService;