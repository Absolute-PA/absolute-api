'use strict';function a108_0x4bc5(_0x52ec8f,_0x391f42){const _0x2507b8=a108_0x2507();return a108_0x4bc5=function(_0x4bc57e,_0x20aba3){_0x4bc57e=_0x4bc57e-0x14a;let _0x2ac4f1=_0x2507b8[_0x4bc57e];return _0x2ac4f1;},a108_0x4bc5(_0x52ec8f,_0x391f42);}const a108_0x4e36bc=a108_0x4bc5;(function(_0x4bd0c4,_0x23d7be){const _0x5ec72b=a108_0x4bc5,_0x2af81a=_0x4bd0c4();while(!![]){try{const _0x2db02d=parseInt(_0x5ec72b(0x176))/0x1+parseInt(_0x5ec72b(0x172))/0x2+-parseInt(_0x5ec72b(0x15c))/0x3*(-parseInt(_0x5ec72b(0x183))/0x4)+parseInt(_0x5ec72b(0x17e))/0x5+parseInt(_0x5ec72b(0x177))/0x6*(parseInt(_0x5ec72b(0x163))/0x7)+parseInt(_0x5ec72b(0x181))/0x8*(-parseInt(_0x5ec72b(0x16b))/0x9)+-parseInt(_0x5ec72b(0x17f))/0xa;if(_0x2db02d===_0x23d7be)break;else _0x2af81a['push'](_0x2af81a['shift']());}catch(_0x3e11c3){_0x2af81a['push'](_0x2af81a['shift']());}}}(a108_0x2507,0x6ac76));var __decorate=this&&this[a108_0x4e36bc(0x178)]||function(_0x4571ce,_0x57ca6e,_0x4ac83d,_0x17330a){const _0x4efe52=a108_0x4e36bc;var _0x8581ad=arguments[_0x4efe52(0x189)],_0x4331d9=_0x8581ad<0x3?_0x57ca6e:_0x17330a===null?_0x17330a=Object[_0x4efe52(0x159)](_0x57ca6e,_0x4ac83d):_0x17330a,_0x3b2541;if(typeof Reflect===_0x4efe52(0x15f)&&typeof Reflect[_0x4efe52(0x180)]===_0x4efe52(0x185))_0x4331d9=Reflect['decorate'](_0x4571ce,_0x57ca6e,_0x4ac83d,_0x17330a);else{for(var _0x42d05f=_0x4571ce['length']-0x1;_0x42d05f>=0x0;_0x42d05f--)if(_0x3b2541=_0x4571ce[_0x42d05f])_0x4331d9=(_0x8581ad<0x3?_0x3b2541(_0x4331d9):_0x8581ad>0x3?_0x3b2541(_0x57ca6e,_0x4ac83d,_0x4331d9):_0x3b2541(_0x57ca6e,_0x4ac83d))||_0x4331d9;}return _0x8581ad>0x3&&_0x4331d9&&Object[_0x4efe52(0x16a)](_0x57ca6e,_0x4ac83d,_0x4331d9),_0x4331d9;},__metadata=this&&this[a108_0x4e36bc(0x14a)]||function(_0x5accac,_0x290a2b){const _0x3e7419=a108_0x4e36bc;if(typeof Reflect===_0x3e7419(0x15f)&&typeof Reflect[_0x3e7419(0x166)]==='function')return Reflect['metadata'](_0x5accac,_0x290a2b);},__param=this&&this['__param']||function(_0xe07bdd,_0x900ced){return function(_0x318e77,_0x343612){_0x900ced(_0x318e77,_0x343612,_0xe07bdd);};};Object[a108_0x4e36bc(0x16a)](exports,'__esModule',{'value':!![]}),exports[a108_0x4e36bc(0x15b)]=void 0x0;const common_1=require(a108_0x4e36bc(0x175)),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require(a108_0x4e36bc(0x158)),dayjs=require('dayjs'),utils_1=require(a108_0x4e36bc(0x171)),schedulePrioritySort=(_0x5ea602,_0x5e08bf)=>dayjs(_0x5ea602[a108_0x4e36bc(0x164)])['isAfter'](dayjs(_0x5e08bf['createdAtUtc']))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0x16096a){const _0x171611=a108_0x4e36bc;this[_0x171611(0x150)]=_0x16096a;}async['create'](_0x3d4111){const _0x256ee7=a108_0x4e36bc,_0x10798b=new this['scheduleModel'](_0x3d4111);return _0x10798b[_0x256ee7(0x153)]();}async['findAll'](){const _0x162966=a108_0x4e36bc,_0x3a2304=await this['scheduleModel'][_0x162966(0x160)]()[_0x162966(0x186)]();return _0x3a2304;}async[a108_0x4e36bc(0x182)](_0x24c4c2){const _0x2c041b=a108_0x4e36bc,_0x4fdc16=await this['scheduleModel'][_0x2c041b(0x14b)](_0x24c4c2);return _0x4fdc16;}async[a108_0x4e36bc(0x157)](_0x20b768){const _0x4bab08=a108_0x4e36bc,_0x5dd07f=await this[_0x4bab08(0x187)](_0x20b768),_0x2026f3=_0x5dd07f['filter'](_0x25493a=>_0x25493a['includeDates'][_0x4bab08(0x189)]>0x0&&_0x25493a['includeDates'][_0x4bab08(0x174)](_0x2e1a5e=>dayjs(_0x2e1a5e)[_0x4bab08(0x161)](_0x4bab08(0x17c)))[_0x4bab08(0x162)](dayjs(_0x20b768)[_0x4bab08(0x161)](_0x4bab08(0x17c))))[_0x4bab08(0x156)](schedulePrioritySort);if(_0x2026f3[_0x4bab08(0x189)]>0x0)return _0x2026f3[0x0];const _0x2fbdec=_0x5dd07f[_0x4bab08(0x15e)](_0x45537c=>_0x45537c['weekDays']['includes'](_0x20b768['getDay']()))[_0x4bab08(0x156)](schedulePrioritySort);if(_0x2fbdec[_0x4bab08(0x189)]>0x0)return _0x2fbdec[0x0];return null;}async[a108_0x4e36bc(0x187)](_0x236ab6){const _0x3480a3=a108_0x4e36bc,_0x1d6d27=dayjs(_0x236ab6)[_0x3480a3(0x14e)](_0x3480a3(0x15d))['toDate'](),_0x123c75={'$and':[{'$or':[{'startDate':{'$lte':_0x236ab6},'endDate':{'$gte':_0x236ab6}},{'startDate':{'$lte':_0x236ab6},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x236ab6}}]},{'excludeDates':{'$nin':[_0x1d6d27]}}]},_0x4f605e=await this[_0x3480a3(0x150)][_0x3480a3(0x160)](_0x123c75)[_0x3480a3(0x186)]();return _0x4f605e;}async[a108_0x4e36bc(0x179)](_0x57a05e,_0x4d462e){const _0x3f011b=a108_0x4e36bc,_0x470b79=new Date(_0x57a05e),_0x2fc4f={};while(_0x470b79<=_0x4d462e){const _0x4a0675=await this[_0x3f011b(0x157)](_0x470b79);_0x4a0675&&(_0x2fc4f[dayjs(_0x470b79)[_0x3f011b(0x161)](_0x3f011b(0x17c))]=_0x4a0675),_0x470b79['setDate'](_0x470b79[_0x3f011b(0x165)]()+0x1);}return _0x2fc4f;}async[a108_0x4e36bc(0x14d)](_0x985c93,_0x2d2175){const _0x2eb8a2=a108_0x4e36bc,_0x4aede3=await this['scheduleModel'][_0x2eb8a2(0x14c)](_0x985c93,Object[_0x2eb8a2(0x15a)](Object[_0x2eb8a2(0x15a)]({},_0x2d2175),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x2eb8a2(0x186)]();return _0x4aede3[_0x2eb8a2(0x151)]&&await this['removeOtherExistingIncludeDates'](_0x985c93,_0x4aede3[_0x2eb8a2(0x151)]),_0x4aede3;}async[a108_0x4e36bc(0x16d)](_0x3b783b){const _0x2faac4=a108_0x4e36bc,_0x34cc81=await this['scheduleModel'][_0x2faac4(0x168)](_0x3b783b)['exec']();return _0x34cc81;}async[a108_0x4e36bc(0x17a)](_0x472412,_0x419d59){const _0x3bfe51=a108_0x4e36bc,_0x3da857=await this[_0x3bfe51(0x182)](_0x472412);_0x3da857[_0x3bfe51(0x151)][_0x3bfe51(0x169)](_0x24c784=>_0x24c784[_0x3bfe51(0x14f)]()===_0x419d59[_0x3bfe51(0x14f)]())===-0x1&&_0x3da857['includeDates'][_0x3bfe51(0x17b)](_0x419d59);const _0x29c478=await _0x3da857[_0x3bfe51(0x153)]();return await this['removeOtherExistingIncludeDates'](_0x472412,[_0x419d59]),_0x29c478;}async[a108_0x4e36bc(0x16f)](_0xfb4b16,_0x127eec){const _0x42b4cf=a108_0x4e36bc,_0x3ba3f2=await this[_0x42b4cf(0x150)]['find']({'_id':{'$ne':_0xfb4b16},'includeDates':{'$in':_0x127eec}})[_0x42b4cf(0x186)](),_0xb5be5e=_0x127eec[_0x42b4cf(0x174)](_0xb47471=>_0xb47471['toISOString']());await Promise[_0x42b4cf(0x17d)](_0x3ba3f2[_0x42b4cf(0x174)](_0x155a80=>{const _0x14ce95=_0x42b4cf,_0x41310b=_0x155a80[_0x14ce95(0x151)][_0x14ce95(0x15e)](_0x45b130=>!_0xb5be5e[_0x14ce95(0x162)](_0x45b130[_0x14ce95(0x155)]()));return _0x155a80[_0x14ce95(0x151)]=_0x41310b,_0x155a80[_0x14ce95(0x167)]=new Date(),_0x155a80['save']();}));}async[a108_0x4e36bc(0x170)](_0x29e0c1){const _0x5e6e31=a108_0x4e36bc,_0xb21d74=await this[_0x5e6e31(0x182)](_0x29e0c1),_0xb75337=_0xb21d74[_0x5e6e31(0x173)]['map'](_0x3efbf2=>Object['assign'](Object[_0x5e6e31(0x15a)]({},_0x3efbf2),{'id':(0x0,utils_1[_0x5e6e31(0x16c)])()})),_0x415261=new this[(_0x5e6e31(0x150))](Object[_0x5e6e31(0x15a)](Object[_0x5e6e31(0x15a)]({},_0xb21d74[_0x5e6e31(0x16e)]()),{'events':_0xb75337,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x415261[_0x5e6e31(0x153)]();}};function a108_0x2507(){const _0x50939f=['find','format','includes','1967lvOpXq','createdAtUtc','getDate','metadata','updatedAtUtc','findByIdAndDelete','findIndex','defineProperty','2739303MTnZIL','uuid','remove','toObject','removeOtherExistingIncludeDates','clone','../common/utils','275970hDqfMT','events','map','@nestjs/common','85510atEVaE','6978IbanIC','__decorate','findEligibleScheduleBetween','addIncludeDate','push','YYYY-MM-DD','all','87000nJjznt','6430bSoMih','decorate','16JjbJvt','findOne','28afcwwy','InjectModel','function','exec','findAllActiveSchedules','Model','length','__metadata','findById','findByIdAndUpdate','update','startOf','getTime','scheduleModel','includeDates','design:paramtypes','save','Injectable','toISOString','sort','findEligibleSchedule','mongoose','getOwnPropertyDescriptor','assign','ScheduleService','205305RiCqda','day','filter','object'];a108_0x2507=function(){return _0x50939f;};return a108_0x2507();}ScheduleService=__decorate([(0x0,common_1[a108_0x4e36bc(0x154)])(),__param(0x0,(0x0,mongoose_1[a108_0x4e36bc(0x184)])('Schedule')),__metadata(a108_0x4e36bc(0x152),[mongoose_2[a108_0x4e36bc(0x188)]])],ScheduleService),exports[a108_0x4e36bc(0x15b)]=ScheduleService;