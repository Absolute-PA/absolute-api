'use strict';const a108_0x279cce=a108_0x3736;(function(_0x3941ba,_0x168149){const _0x4ec30a=a108_0x3736,_0x2992c8=_0x3941ba();while(!![]){try{const _0x50faf9=-parseInt(_0x4ec30a(0x1d4))/0x1+parseInt(_0x4ec30a(0x1d2))/0x2*(parseInt(_0x4ec30a(0x1ba))/0x3)+-parseInt(_0x4ec30a(0x1c9))/0x4*(-parseInt(_0x4ec30a(0x1b7))/0x5)+parseInt(_0x4ec30a(0x1da))/0x6+parseInt(_0x4ec30a(0x1bb))/0x7*(parseInt(_0x4ec30a(0x1f2))/0x8)+parseInt(_0x4ec30a(0x1d9))/0x9+-parseInt(_0x4ec30a(0x1e8))/0xa*(parseInt(_0x4ec30a(0x1e4))/0xb);if(_0x50faf9===_0x168149)break;else _0x2992c8['push'](_0x2992c8['shift']());}catch(_0x1bd7c6){_0x2992c8['push'](_0x2992c8['shift']());}}}(a108_0x5c28,0xef120));var __decorate=this&&this[a108_0x279cce(0x1d1)]||function(_0x536da6,_0x39b8fe,_0x3c103f,_0x238ea4){const _0x589a60=a108_0x279cce;var _0x4ffb01=arguments['length'],_0xc170a3=_0x4ffb01<0x3?_0x39b8fe:_0x238ea4===null?_0x238ea4=Object[_0x589a60(0x1f0)](_0x39b8fe,_0x3c103f):_0x238ea4,_0x24645f;if(typeof Reflect===_0x589a60(0x1c3)&&typeof Reflect[_0x589a60(0x1c2)]===_0x589a60(0x1c6))_0xc170a3=Reflect[_0x589a60(0x1c2)](_0x536da6,_0x39b8fe,_0x3c103f,_0x238ea4);else{for(var _0xc73dc8=_0x536da6[_0x589a60(0x1ce)]-0x1;_0xc73dc8>=0x0;_0xc73dc8--)if(_0x24645f=_0x536da6[_0xc73dc8])_0xc170a3=(_0x4ffb01<0x3?_0x24645f(_0xc170a3):_0x4ffb01>0x3?_0x24645f(_0x39b8fe,_0x3c103f,_0xc170a3):_0x24645f(_0x39b8fe,_0x3c103f))||_0xc170a3;}return _0x4ffb01>0x3&&_0xc170a3&&Object[_0x589a60(0x1de)](_0x39b8fe,_0x3c103f,_0xc170a3),_0xc170a3;},__metadata=this&&this[a108_0x279cce(0x1e3)]||function(_0x57a25e,_0xd75715){const _0x80863f=a108_0x279cce;if(typeof Reflect===_0x80863f(0x1c3)&&typeof Reflect[_0x80863f(0x1c7)]===_0x80863f(0x1c6))return Reflect[_0x80863f(0x1c7)](_0x57a25e,_0xd75715);},__param=this&&this[a108_0x279cce(0x1ea)]||function(_0x2e9dcc,_0x4d257e){return function(_0x5852d6,_0x1a8bd4){_0x4d257e(_0x5852d6,_0x1a8bd4,_0x2e9dcc);};};function a108_0x5c28(){const _0x5dabb5=['remove','__decorate','12WpYcuW','includeDates','1865604jkgLUK','day','clone','save','assign','3839787IPAhOh','7225212ahSXuT','removeOtherExistingIncludeDates','findEligibleScheduleBetween','findAllActiveSchedules','defineProperty','create','YYYY-MM-DD','sort','find','__metadata','1434796nBNgqB','InjectModel','findOne','getDate','150KOtmQZ','exec','__param','startOf','toObject','getTime','findByIdAndUpdate','includes','getOwnPropertyDescriptor','Injectable','126120VDwjCN','filter','all','getDay','findAll','updatedAtUtc','toISOString','401845lRgpqO','format','isAfter','700272IiWLDJ','322XErojl','addIncludeDate','toDate','push','findEligibleSchedule','findById','@nestjs/mongoose','decorate','object','setDate','ScheduleService','function','metadata','@nestjs/common','52hwjnOr','createdAtUtc','__esModule','map','weekDays','length','scheduleModel'];a108_0x5c28=function(){return _0x5dabb5;};return a108_0x5c28();}function a108_0x3736(_0x287c60,_0x29014a){const _0x5c282f=a108_0x5c28();return a108_0x3736=function(_0x3736a3,_0x165863){_0x3736a3=_0x3736a3-0x1b3;let _0x177404=_0x5c282f[_0x3736a3];return _0x177404;},a108_0x3736(_0x287c60,_0x29014a);}Object['defineProperty'](exports,a108_0x279cce(0x1cb),{'value':!![]}),exports[a108_0x279cce(0x1c5)]=void 0x0;const common_1=require(a108_0x279cce(0x1c8)),mongoose_1=require(a108_0x279cce(0x1c1)),mongoose_2=require('mongoose'),dayjs=require('dayjs'),utils_1=require('../common/utils'),schedulePrioritySort=(_0x218a5c,_0x14c2dd)=>dayjs(_0x218a5c[a108_0x279cce(0x1ca)])[a108_0x279cce(0x1b9)](dayjs(_0x14c2dd[a108_0x279cce(0x1ca)]))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0x314a9f){const _0x56adf1=a108_0x279cce;this[_0x56adf1(0x1cf)]=_0x314a9f;}async[a108_0x279cce(0x1df)](_0x11ac25){const _0x2b9051=a108_0x279cce,_0x2dff11=new this[(_0x2b9051(0x1cf))](_0x11ac25);return _0x2dff11[_0x2b9051(0x1d7)]();}async[a108_0x279cce(0x1b4)](){const _0x548a20=a108_0x279cce,_0x5cbb10=await this[_0x548a20(0x1cf)][_0x548a20(0x1e2)]()['exec']();return _0x5cbb10;}async[a108_0x279cce(0x1e6)](_0xd29ed9){const _0x4612ff=a108_0x279cce,_0x90056f=await this[_0x4612ff(0x1cf)][_0x4612ff(0x1c0)](_0xd29ed9);return _0x90056f;}async[a108_0x279cce(0x1bf)](_0xb6d53e){const _0x53657f=a108_0x279cce,_0x482239=await this[_0x53657f(0x1dd)](_0xb6d53e),_0xeda9f5=_0x482239[_0x53657f(0x1f3)](_0x58802a=>_0x58802a['includeDates']['length']>0x0&&_0x58802a['includeDates'][_0x53657f(0x1cc)](_0x381ffd=>dayjs(_0x381ffd)['format']('YYYY-MM-DD'))[_0x53657f(0x1ef)](dayjs(_0xb6d53e)['format'](_0x53657f(0x1e0))))[_0x53657f(0x1e1)](schedulePrioritySort);if(_0xeda9f5[_0x53657f(0x1ce)]>0x0)return _0xeda9f5[0x0];const _0x13ea88=_0x482239[_0x53657f(0x1f3)](_0x1ce236=>_0x1ce236[_0x53657f(0x1cd)][_0x53657f(0x1ef)](_0xb6d53e[_0x53657f(0x1b3)]()))[_0x53657f(0x1e1)](schedulePrioritySort);if(_0x13ea88[_0x53657f(0x1ce)]>0x0)return _0x13ea88[0x0];return null;}async[a108_0x279cce(0x1dd)](_0x340cf5){const _0x1bd78f=a108_0x279cce,_0x363f6e=dayjs(_0x340cf5)[_0x1bd78f(0x1eb)](_0x1bd78f(0x1d5))[_0x1bd78f(0x1bd)](),_0x2a8a98={'$and':[{'$or':[{'startDate':{'$lte':_0x340cf5},'endDate':{'$gte':_0x340cf5}},{'startDate':{'$lte':_0x340cf5},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x340cf5}}]},{'excludeDates':{'$nin':[_0x363f6e]}}]},_0x15b09e=await this[_0x1bd78f(0x1cf)][_0x1bd78f(0x1e2)](_0x2a8a98)[_0x1bd78f(0x1e9)]();return _0x15b09e;}async[a108_0x279cce(0x1dc)](_0x24977c,_0x4190af){const _0x357457=a108_0x279cce,_0x4c7f11=new Date(_0x24977c),_0x1b1b74={};while(_0x4c7f11<=_0x4190af){const _0x3d837a=await this['findEligibleSchedule'](_0x4c7f11);_0x3d837a&&(_0x1b1b74[dayjs(_0x4c7f11)[_0x357457(0x1b8)](_0x357457(0x1e0))]=_0x3d837a),_0x4c7f11[_0x357457(0x1c4)](_0x4c7f11[_0x357457(0x1e7)]()+0x1);}return _0x1b1b74;}async['update'](_0x1681f4,_0x446f36){const _0x4b2705=a108_0x279cce,_0x482221=await this[_0x4b2705(0x1cf)][_0x4b2705(0x1ee)](_0x1681f4,Object['assign'](Object[_0x4b2705(0x1d8)]({},_0x446f36),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x4b2705(0x1e9)]();return _0x482221[_0x4b2705(0x1d3)]&&await this[_0x4b2705(0x1db)](_0x1681f4,_0x482221[_0x4b2705(0x1d3)]),_0x482221;}async[a108_0x279cce(0x1d0)](_0x428ee1){const _0x271505=a108_0x279cce,_0x2af507=await this['scheduleModel']['findByIdAndDelete'](_0x428ee1)[_0x271505(0x1e9)]();return _0x2af507;}async[a108_0x279cce(0x1bc)](_0x668be4,_0xb18374){const _0x10685c=a108_0x279cce,_0x1775f8=await this[_0x10685c(0x1e6)](_0x668be4);_0x1775f8[_0x10685c(0x1d3)]['findIndex'](_0x1d70f1=>_0x1d70f1[_0x10685c(0x1ed)]()===_0xb18374[_0x10685c(0x1ed)]())===-0x1&&_0x1775f8[_0x10685c(0x1d3)][_0x10685c(0x1be)](_0xb18374);const _0x3784ff=await _0x1775f8[_0x10685c(0x1d7)]();return await this[_0x10685c(0x1db)](_0x668be4,[_0xb18374]),_0x3784ff;}async[a108_0x279cce(0x1db)](_0xb6ab27,_0x1c1b8b){const _0x2ede7e=a108_0x279cce,_0x17dc76=await this[_0x2ede7e(0x1cf)][_0x2ede7e(0x1e2)]({'_id':{'$ne':_0xb6ab27},'includeDates':{'$in':_0x1c1b8b}})[_0x2ede7e(0x1e9)](),_0x2d08ba=_0x1c1b8b['map'](_0x47a19c=>_0x47a19c['toISOString']());await Promise[_0x2ede7e(0x1f4)](_0x17dc76['map'](_0x2d9886=>{const _0x1aa46f=_0x2ede7e,_0x24bfe5=_0x2d9886[_0x1aa46f(0x1d3)]['filter'](_0x57f8be=>!_0x2d08ba['includes'](_0x57f8be[_0x1aa46f(0x1b6)]()));return _0x2d9886['includeDates']=_0x24bfe5,_0x2d9886[_0x1aa46f(0x1b5)]=new Date(),_0x2d9886[_0x1aa46f(0x1d7)]();}));}async[a108_0x279cce(0x1d6)](_0x1c26ea){const _0x3b3566=a108_0x279cce,_0x35f04d=await this[_0x3b3566(0x1e6)](_0x1c26ea),_0x1bf81d=_0x35f04d['events'][_0x3b3566(0x1cc)](_0x2ba617=>Object[_0x3b3566(0x1d8)](Object[_0x3b3566(0x1d8)]({},_0x2ba617),{'id':(0x0,utils_1['uuid'])()})),_0x2926ea=new this['scheduleModel'](Object['assign'](Object[_0x3b3566(0x1d8)]({},_0x35f04d[_0x3b3566(0x1ec)]()),{'events':_0x1bf81d,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x2926ea[_0x3b3566(0x1d7)]();}};ScheduleService=__decorate([(0x0,common_1[a108_0x279cce(0x1f1)])(),__param(0x0,(0x0,mongoose_1[a108_0x279cce(0x1e5)])('Schedule')),__metadata('design:paramtypes',[mongoose_2['Model']])],ScheduleService),exports[a108_0x279cce(0x1c5)]=ScheduleService;