'use strict';const a111_0x411941=a111_0x5960;(function(_0x2a3c95,_0x28a995){const _0x13c12c=a111_0x5960,_0x316be6=_0x2a3c95();while(!![]){try{const _0x40635d=-parseInt(_0x13c12c(0x115))/0x1+parseInt(_0x13c12c(0xf5))/0x2+parseInt(_0x13c12c(0x125))/0x3+-parseInt(_0x13c12c(0xfb))/0x4*(parseInt(_0x13c12c(0xff))/0x5)+-parseInt(_0x13c12c(0xf0))/0x6+-parseInt(_0x13c12c(0xe9))/0x7+parseInt(_0x13c12c(0xee))/0x8;if(_0x40635d===_0x28a995)break;else _0x316be6['push'](_0x316be6['shift']());}catch(_0xcacdce){_0x316be6['push'](_0x316be6['shift']());}}}(a111_0x480e,0xaad7f));function a111_0x5960(_0x47eb1a,_0x134a4c){const _0x480ef1=a111_0x480e();return a111_0x5960=function(_0x59603e,_0x1e6527){_0x59603e=_0x59603e-0xe9;let _0xd774b9=_0x480ef1[_0x59603e];return _0xd774b9;},a111_0x5960(_0x47eb1a,_0x134a4c);}var __decorate=this&&this[a111_0x411941(0x11a)]||function(_0x88f5ba,_0x3c88f3,_0x4233f4,_0x21912c){const _0x5a6716=a111_0x411941;var _0x300499=arguments[_0x5a6716(0xef)],_0x586610=_0x300499<0x3?_0x3c88f3:_0x21912c===null?_0x21912c=Object[_0x5a6716(0x111)](_0x3c88f3,_0x4233f4):_0x21912c,_0x5aa1c0;if(typeof Reflect===_0x5a6716(0x101)&&typeof Reflect[_0x5a6716(0x10b)]===_0x5a6716(0x126))_0x586610=Reflect['decorate'](_0x88f5ba,_0x3c88f3,_0x4233f4,_0x21912c);else{for(var _0x51c119=_0x88f5ba['length']-0x1;_0x51c119>=0x0;_0x51c119--)if(_0x5aa1c0=_0x88f5ba[_0x51c119])_0x586610=(_0x300499<0x3?_0x5aa1c0(_0x586610):_0x300499>0x3?_0x5aa1c0(_0x3c88f3,_0x4233f4,_0x586610):_0x5aa1c0(_0x3c88f3,_0x4233f4))||_0x586610;}return _0x300499>0x3&&_0x586610&&Object[_0x5a6716(0xfd)](_0x3c88f3,_0x4233f4,_0x586610),_0x586610;},__metadata=this&&this[a111_0x411941(0x119)]||function(_0x3514ba,_0x43f71d){const _0x5307a2=a111_0x411941;if(typeof Reflect===_0x5307a2(0x101)&&typeof Reflect[_0x5307a2(0x100)]===_0x5307a2(0x126))return Reflect['metadata'](_0x3514ba,_0x43f71d);},__param=this&&this[a111_0x411941(0x11c)]||function(_0x3f0eee,_0x1bdb9e){return function(_0x4b493b,_0x2df955){_0x1bdb9e(_0x4b493b,_0x2df955,_0x3f0eee);};};Object[a111_0x411941(0xfd)](exports,a111_0x411941(0xec),{'value':!![]}),exports[a111_0x411941(0x123)]=void 0x0;const common_1=require(a111_0x411941(0x105)),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require('mongoose'),dayjs=require(a111_0x411941(0x124)),utils_1=require(a111_0x411941(0xf3)),schedulePrioritySort=(_0x3e998d,_0x38bf8a)=>dayjs(_0x3e998d['createdAtUtc'])[a111_0x411941(0x106)](dayjs(_0x38bf8a['createdAtUtc']))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0x16603e){const _0x4badc2=a111_0x411941;this[_0x4badc2(0x107)]=_0x16603e;}async['create'](_0xdc0d5a){const _0x33e7e0=a111_0x411941,_0x5e6b31=new this[(_0x33e7e0(0x107))](_0xdc0d5a);return _0x5e6b31[_0x33e7e0(0x108)]();}async[a111_0x411941(0x110)](){const _0x49e1eb=a111_0x411941,_0x154b65=await this[_0x49e1eb(0x107)][_0x49e1eb(0x116)]()[_0x49e1eb(0xf6)]();return _0x154b65;}async[a111_0x411941(0xeb)](_0x5e67f0){const _0x3f4f83=a111_0x411941,_0x472eda=await this[_0x3f4f83(0x107)][_0x3f4f83(0x122)](_0x5e67f0);return _0x472eda;}async[a111_0x411941(0x11e)](_0x2bc0ef){const _0x443593=a111_0x411941,_0x1b864c=await this['findAllActiveSchedules'](_0x2bc0ef),_0x495eaa=_0x1b864c['filter'](_0x528612=>_0x528612[_0x443593(0x109)][_0x443593(0xef)]>0x0&&_0x528612['includeDates']['map'](_0x774878=>dayjs(_0x774878)['format'](_0x443593(0x114)))[_0x443593(0x118)](dayjs(_0x2bc0ef)[_0x443593(0x113)](_0x443593(0x114))))['sort'](schedulePrioritySort);if(_0x495eaa[_0x443593(0xef)]>0x0)return _0x495eaa[0x0];const _0x512b46=_0x1b864c['filter'](_0x5121a6=>_0x5121a6[_0x443593(0xf1)]['includes'](_0x2bc0ef[_0x443593(0x10a)]()))['sort'](schedulePrioritySort);if(_0x512b46[_0x443593(0xef)]>0x0)return _0x512b46[0x0];return null;}async['findAllActiveSchedules'](_0x132fca){const _0xa85aed=a111_0x411941,_0x398c85=dayjs(_0x132fca)['startOf'](_0xa85aed(0xf8))['toDate'](),_0x2df0c6={'$and':[{'$or':[{'startDate':{'$lte':_0x132fca},'endDate':{'$gte':_0x132fca}},{'startDate':{'$lte':_0x132fca},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x132fca}}]},{'excludeDates':{'$nin':[_0x398c85]}}]},_0x1060df=await this['scheduleModel'][_0xa85aed(0x116)](_0x2df0c6)[_0xa85aed(0xf6)]();return _0x1060df;}async[a111_0x411941(0xf4)](_0x30329c,_0x2c263b){const _0x469273=a111_0x411941,_0x27ee54=new Date(_0x30329c),_0x4ff704={};while(_0x27ee54<=_0x2c263b){const _0x52de7d=await this['findEligibleSchedule'](_0x27ee54);_0x52de7d&&(_0x4ff704[dayjs(_0x27ee54)['format']('YYYY-MM-DD')]=_0x52de7d),_0x27ee54[_0x469273(0xf9)](_0x27ee54[_0x469273(0xf2)]()+0x1);}return _0x4ff704;}async[a111_0x411941(0x10e)](_0x16e304,_0x376675){const _0x2872b9=a111_0x411941,_0x3ccef0=await this['scheduleModel'][_0x2872b9(0x11d)](_0x16e304,Object[_0x2872b9(0x10f)](Object[_0x2872b9(0x10f)]({},_0x376675),{'updatedAtUtc':new Date()}),{'new':!![]})['exec']();return _0x3ccef0['includeDates']&&await this[_0x2872b9(0x11b)](_0x16e304,_0x3ccef0['includeDates']),_0x3ccef0;}async['remove'](_0x41c14d){const _0x2de868=a111_0x411941,_0xb23a35=await this[_0x2de868(0x107)][_0x2de868(0xed)](_0x41c14d)[_0x2de868(0xf6)]();return _0xb23a35;}async[a111_0x411941(0x121)](_0x2b2d6d,_0x3fdc9a){const _0x2b0967=a111_0x411941,_0xb42eb0=await this[_0x2b0967(0xeb)](_0x2b2d6d);_0xb42eb0['includeDates']['findIndex'](_0x1a723a=>_0x1a723a[_0x2b0967(0x10d)]()===_0x3fdc9a['getTime']())===-0x1&&_0xb42eb0[_0x2b0967(0x109)]['push'](_0x3fdc9a);const _0x669fe2=await _0xb42eb0[_0x2b0967(0x108)]();return await this[_0x2b0967(0x11b)](_0x2b2d6d,[_0x3fdc9a]),_0x669fe2;}async['removeOtherExistingIncludeDates'](_0x494325,_0x2b65ba){const _0x39f1a9=a111_0x411941,_0x5c054b=await this[_0x39f1a9(0x107)]['find']({'_id':{'$ne':_0x494325},'includeDates':{'$in':_0x2b65ba}})[_0x39f1a9(0xf6)](),_0x4cc206=_0x2b65ba[_0x39f1a9(0x11f)](_0x19a936=>_0x19a936['toISOString']());await Promise[_0x39f1a9(0xf7)](_0x5c054b[_0x39f1a9(0x11f)](_0x2e4c82=>{const _0x562301=_0x39f1a9,_0x7f3cb7=_0x2e4c82[_0x562301(0x109)]['filter'](_0x1bcce2=>!_0x4cc206['includes'](_0x1bcce2[_0x562301(0x104)]()));return _0x2e4c82[_0x562301(0x109)]=_0x7f3cb7,_0x2e4c82[_0x562301(0xea)]=new Date(),_0x2e4c82[_0x562301(0x108)]();}));}async[a111_0x411941(0x103)](_0x4d7ca4){const _0x19674f=a111_0x411941,_0x55d5f9=await this[_0x19674f(0xeb)](_0x4d7ca4),_0x446584=_0x55d5f9[_0x19674f(0x117)][_0x19674f(0x11f)](_0x104e57=>Object[_0x19674f(0x10f)](Object[_0x19674f(0x10f)]({},_0x104e57),{'id':(0x0,utils_1[_0x19674f(0xfe)])()})),_0x26dcf3=new this[(_0x19674f(0x107))](Object[_0x19674f(0x10f)](Object[_0x19674f(0x10f)]({},_0x55d5f9[_0x19674f(0x10c)]()),{'events':_0x446584,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x26dcf3[_0x19674f(0x108)]();}};ScheduleService=__decorate([(0x0,common_1[a111_0x411941(0x120)])(),__param(0x0,(0x0,mongoose_1[a111_0x411941(0xfa)])(a111_0x411941(0x112))),__metadata(a111_0x411941(0x102),[mongoose_2[a111_0x411941(0xfc)]])],ScheduleService),exports[a111_0x411941(0x123)]=ScheduleService;function a111_0x480e(){const _0xa7592c=['addIncludeDate','findById','ScheduleService','dayjs','1983459RDiAvo','function','4579197kHqoaH','updatedAtUtc','findOne','__esModule','findByIdAndDelete','22873808dsaXEs','length','6970344zQPvPa','weekDays','getDate','../common/utils','findEligibleScheduleBetween','841820TPUsuh','exec','all','day','setDate','InjectModel','2594756rjmvto','Model','defineProperty','uuid','5UTtNld','metadata','object','design:paramtypes','clone','toISOString','@nestjs/common','isAfter','scheduleModel','save','includeDates','getDay','decorate','toObject','getTime','update','assign','findAll','getOwnPropertyDescriptor','Schedule','format','YYYY-MM-DD','776930tsqCPu','find','events','includes','__metadata','__decorate','removeOtherExistingIncludeDates','__param','findByIdAndUpdate','findEligibleSchedule','map','Injectable'];a111_0x480e=function(){return _0xa7592c;};return a111_0x480e();}