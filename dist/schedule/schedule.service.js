'use strict';const a111_0x137d1e=a111_0x1eea;(function(_0x12cf2f,_0x21cafc){const _0x1e9423=a111_0x1eea,_0x4241c1=_0x12cf2f();while(!![]){try{const _0x1870a2=-parseInt(_0x1e9423(0x112))/0x1+parseInt(_0x1e9423(0x111))/0x2*(parseInt(_0x1e9423(0x131))/0x3)+-parseInt(_0x1e9423(0x12a))/0x4+-parseInt(_0x1e9423(0x126))/0x5+parseInt(_0x1e9423(0x127))/0x6*(-parseInt(_0x1e9423(0x110))/0x7)+parseInt(_0x1e9423(0x138))/0x8*(parseInt(_0x1e9423(0x113))/0x9)+parseInt(_0x1e9423(0x11b))/0xa;if(_0x1870a2===_0x21cafc)break;else _0x4241c1['push'](_0x4241c1['shift']());}catch(_0x511359){_0x4241c1['push'](_0x4241c1['shift']());}}}(a111_0x3084,0x3cfff));function a111_0x1eea(_0x126185,_0x48fdb0){const _0x30845d=a111_0x3084();return a111_0x1eea=function(_0x1eeab3,_0xadada1){_0x1eeab3=_0x1eeab3-0xfa;let _0x515c50=_0x30845d[_0x1eeab3];return _0x515c50;},a111_0x1eea(_0x126185,_0x48fdb0);}function a111_0x3084(){const _0xa1e31a=['events','create','__esModule','../common/utils','findEligibleSchedule','Injectable','includes','toISOString','toDate','createdAtUtc','removeOtherExistingIncludeDates','getDay','includeDates','7iUWokB','44KdXNJT','374025ENDAYG','90QUZxYD','@nestjs/common','exec','findByIdAndUpdate','__param','save','findEligibleScheduleBetween','decorate','8973840MMmSvS','findIndex','ScheduleService','Schedule','find','findOne','assign','format','scheduleModel','update','findAll','309830ihIMTO','437172HSknko','YYYY-MM-DD','InjectModel','1900536ivlZxj','all','metadata','toObject','findById','sort','defineProperty','8187KctyoF','remove','getOwnPropertyDescriptor','function','getDate','map','day','221136tjwayC','uuid','getTime','length','mongoose','findAllActiveSchedules','startOf','updatedAtUtc','object','__decorate'];a111_0x3084=function(){return _0xa1e31a;};return a111_0x3084();}var __decorate=this&&this[a111_0x137d1e(0x102)]||function(_0x447753,_0x2268b1,_0x525aec,_0x2aeb4f){const _0x13c85d=a111_0x137d1e;var _0x1a0bda=arguments[_0x13c85d(0xfc)],_0x44db44=_0x1a0bda<0x3?_0x2268b1:_0x2aeb4f===null?_0x2aeb4f=Object[_0x13c85d(0x133)](_0x2268b1,_0x525aec):_0x2aeb4f,_0x50fb11;if(typeof Reflect==='object'&&typeof Reflect[_0x13c85d(0x11a)]===_0x13c85d(0x134))_0x44db44=Reflect[_0x13c85d(0x11a)](_0x447753,_0x2268b1,_0x525aec,_0x2aeb4f);else{for(var _0x2424af=_0x447753[_0x13c85d(0xfc)]-0x1;_0x2424af>=0x0;_0x2424af--)if(_0x50fb11=_0x447753[_0x2424af])_0x44db44=(_0x1a0bda<0x3?_0x50fb11(_0x44db44):_0x1a0bda>0x3?_0x50fb11(_0x2268b1,_0x525aec,_0x44db44):_0x50fb11(_0x2268b1,_0x525aec))||_0x44db44;}return _0x1a0bda>0x3&&_0x44db44&&Object[_0x13c85d(0x130)](_0x2268b1,_0x525aec,_0x44db44),_0x44db44;},__metadata=this&&this['__metadata']||function(_0x2c0c64,_0x50a640){const _0xc3edaf=a111_0x137d1e;if(typeof Reflect===_0xc3edaf(0x101)&&typeof Reflect[_0xc3edaf(0x12c)]===_0xc3edaf(0x134))return Reflect['metadata'](_0x2c0c64,_0x50a640);},__param=this&&this[a111_0x137d1e(0x117)]||function(_0x37d70e,_0x4851af){return function(_0x558580,_0x1af4ea){_0x4851af(_0x558580,_0x1af4ea,_0x37d70e);};};Object['defineProperty'](exports,a111_0x137d1e(0x105),{'value':!![]}),exports[a111_0x137d1e(0x11d)]=void 0x0;const common_1=require(a111_0x137d1e(0x114)),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require(a111_0x137d1e(0xfd)),dayjs=require('dayjs'),utils_1=require(a111_0x137d1e(0x106)),schedulePrioritySort=(_0x5a87b6,_0x3e1288)=>dayjs(_0x5a87b6[a111_0x137d1e(0x10c)])['isAfter'](dayjs(_0x3e1288['createdAtUtc']))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0x4f2f7b){const _0x5b707a=a111_0x137d1e;this[_0x5b707a(0x123)]=_0x4f2f7b;}async[a111_0x137d1e(0x104)](_0x2480c6){const _0x45bc74=a111_0x137d1e,_0x14b4cf=new this['scheduleModel'](_0x2480c6);return _0x14b4cf[_0x45bc74(0x118)]();}async[a111_0x137d1e(0x125)](){const _0x2694f9=a111_0x137d1e,_0x36fe51=await this[_0x2694f9(0x123)]['find']()['exec']();return _0x36fe51;}async[a111_0x137d1e(0x120)](_0x531e25){const _0x2bf625=a111_0x137d1e,_0x2ed6f6=await this[_0x2bf625(0x123)][_0x2bf625(0x12e)](_0x531e25);return _0x2ed6f6;}async[a111_0x137d1e(0x107)](_0x5a145c){const _0x818b3b=a111_0x137d1e,_0x443b49=await this['findAllActiveSchedules'](_0x5a145c),_0x5c6c48=_0x443b49['filter'](_0x4d99d0=>_0x4d99d0[_0x818b3b(0x10f)][_0x818b3b(0xfc)]>0x0&&_0x4d99d0[_0x818b3b(0x10f)]['map'](_0x4eb8e7=>dayjs(_0x4eb8e7)[_0x818b3b(0x122)](_0x818b3b(0x128)))['includes'](dayjs(_0x5a145c)[_0x818b3b(0x122)](_0x818b3b(0x128))))[_0x818b3b(0x12f)](schedulePrioritySort);if(_0x5c6c48['length']>0x0)return _0x5c6c48[0x0];const _0x3fe48c=_0x443b49['filter'](_0x3e8971=>_0x3e8971['weekDays'][_0x818b3b(0x109)](_0x5a145c[_0x818b3b(0x10e)]()))[_0x818b3b(0x12f)](schedulePrioritySort);if(_0x3fe48c[_0x818b3b(0xfc)]>0x0)return _0x3fe48c[0x0];return null;}async[a111_0x137d1e(0xfe)](_0x3d5728){const _0x3f992=a111_0x137d1e,_0x130311=dayjs(_0x3d5728)[_0x3f992(0xff)](_0x3f992(0x137))[_0x3f992(0x10b)](),_0x3b5147={'$and':[{'$or':[{'startDate':{'$lte':_0x3d5728},'endDate':{'$gte':_0x3d5728}},{'startDate':{'$lte':_0x3d5728},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x3d5728}}]},{'excludeDates':{'$nin':[_0x130311]}}]},_0x4daef4=await this[_0x3f992(0x123)][_0x3f992(0x11f)](_0x3b5147)[_0x3f992(0x115)]();return _0x4daef4;}async[a111_0x137d1e(0x119)](_0x387594,_0x57ae48){const _0x50b2b3=a111_0x137d1e,_0x30c867=new Date(_0x387594),_0x49011d={};while(_0x30c867<=_0x57ae48){const _0x5540c2=await this[_0x50b2b3(0x107)](_0x30c867);_0x5540c2&&(_0x49011d[dayjs(_0x30c867)[_0x50b2b3(0x122)](_0x50b2b3(0x128))]=_0x5540c2),_0x30c867['setDate'](_0x30c867[_0x50b2b3(0x135)]()+0x1);}return _0x49011d;}async[a111_0x137d1e(0x124)](_0x4d21cd,_0xc81a25){const _0x27aade=a111_0x137d1e,_0x198f08=await this[_0x27aade(0x123)][_0x27aade(0x116)](_0x4d21cd,Object[_0x27aade(0x121)](Object[_0x27aade(0x121)]({},_0xc81a25),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x27aade(0x115)]();return _0x198f08[_0x27aade(0x10f)]&&await this['removeOtherExistingIncludeDates'](_0x4d21cd,_0x198f08[_0x27aade(0x10f)]),_0x198f08;}async[a111_0x137d1e(0x132)](_0x55719d){const _0x338fbb=a111_0x137d1e,_0x1e734f=await this[_0x338fbb(0x123)]['findByIdAndDelete'](_0x55719d)[_0x338fbb(0x115)]();return _0x1e734f;}async['addIncludeDate'](_0x625662,_0x331b23){const _0x26aeda=a111_0x137d1e,_0x473801=await this[_0x26aeda(0x120)](_0x625662);_0x473801[_0x26aeda(0x10f)][_0x26aeda(0x11c)](_0x42cbb8=>_0x42cbb8[_0x26aeda(0xfb)]()===_0x331b23['getTime']())===-0x1&&_0x473801[_0x26aeda(0x10f)]['push'](_0x331b23);const _0x5da923=await _0x473801[_0x26aeda(0x118)]();return await this[_0x26aeda(0x10d)](_0x625662,[_0x331b23]),_0x5da923;}async['removeOtherExistingIncludeDates'](_0x36abda,_0x241d42){const _0x38e758=a111_0x137d1e,_0x3f47b8=await this[_0x38e758(0x123)][_0x38e758(0x11f)]({'_id':{'$ne':_0x36abda},'includeDates':{'$in':_0x241d42}})['exec'](),_0x462108=_0x241d42['map'](_0x28e9dc=>_0x28e9dc[_0x38e758(0x10a)]());await Promise[_0x38e758(0x12b)](_0x3f47b8['map'](_0x2fb05d=>{const _0x12e552=_0x38e758,_0x5bd393=_0x2fb05d[_0x12e552(0x10f)]['filter'](_0x4a17b2=>!_0x462108[_0x12e552(0x109)](_0x4a17b2[_0x12e552(0x10a)]()));return _0x2fb05d[_0x12e552(0x10f)]=_0x5bd393,_0x2fb05d[_0x12e552(0x100)]=new Date(),_0x2fb05d['save']();}));}async['clone'](_0x495b80){const _0x491327=a111_0x137d1e,_0x175a82=await this[_0x491327(0x120)](_0x495b80),_0xb4a1ec=_0x175a82[_0x491327(0x103)][_0x491327(0x136)](_0x349eb4=>Object['assign'](Object[_0x491327(0x121)]({},_0x349eb4),{'id':(0x0,utils_1[_0x491327(0xfa)])()})),_0x2d6dee=new this['scheduleModel'](Object['assign'](Object[_0x491327(0x121)]({},_0x175a82[_0x491327(0x12d)]()),{'events':_0xb4a1ec,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x2d6dee[_0x491327(0x118)]();}};ScheduleService=__decorate([(0x0,common_1[a111_0x137d1e(0x108)])(),__param(0x0,(0x0,mongoose_1[a111_0x137d1e(0x129)])(a111_0x137d1e(0x11e))),__metadata('design:paramtypes',[mongoose_2['Model']])],ScheduleService),exports[a111_0x137d1e(0x11d)]=ScheduleService;