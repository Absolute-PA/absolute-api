'use strict';const a108_0x4a754e=a108_0x1f3b;(function(_0x5481ab,_0x1b1f84){const _0x5cc6d5=a108_0x1f3b,_0x35d178=_0x5481ab();while(!![]){try{const _0x5a0736=-parseInt(_0x5cc6d5(0x1a0))/0x1*(parseInt(_0x5cc6d5(0x1dd))/0x2)+-parseInt(_0x5cc6d5(0x1a2))/0x3+-parseInt(_0x5cc6d5(0x1c1))/0x4+-parseInt(_0x5cc6d5(0x1d7))/0x5*(-parseInt(_0x5cc6d5(0x19f))/0x6)+parseInt(_0x5cc6d5(0x1cf))/0x7+-parseInt(_0x5cc6d5(0x1a7))/0x8+-parseInt(_0x5cc6d5(0x1e3))/0x9*(-parseInt(_0x5cc6d5(0x1c6))/0xa);if(_0x5a0736===_0x1b1f84)break;else _0x35d178['push'](_0x35d178['shift']());}catch(_0x29abc1){_0x35d178['push'](_0x35d178['shift']());}}}(a108_0x1c94,0xe61f9));function a108_0x1c94(){const _0x2eb4ea=['getDay','findAllActiveSchedules','dayjs','length','../common/utils','isAfter','update','YYYY-MM-DD','assign','format','3171888akyZmS','getDate','create','toISOString','filter','250060YVFVBG','findEligibleScheduleBetween','clone','all','uuid','day','decorate','Model','remove','12936133enmIlo','toDate','findOne','scheduleModel','getTime','setDate','object','sort','5paRqTQ','__param','ScheduleService','push','findByIdAndUpdate','Schedule','2128dQsQDP','@nestjs/common','updatedAtUtc','map','exec','Injectable','216TXdkev','findAll','2891022ytsdwP','219UPEdBs','removeOtherExistingIncludeDates','2446455EqMWfX','startOf','find','metadata','includeDates','1167536OALCCr','findEligibleSchedule','save','mongoose','design:paramtypes','__metadata','weekDays','@nestjs/mongoose','defineProperty','createdAtUtc','function','__esModule','includes','findIndex','addIncludeDate','findById'];a108_0x1c94=function(){return _0x2eb4ea;};return a108_0x1c94();}var __decorate=this&&this['__decorate']||function(_0x24544e,_0x101725,_0x5919b3,_0x38c2df){const _0x35d775=a108_0x1f3b;var _0x3a0c23=arguments[_0x35d775(0x1ba)],_0x1e1386=_0x3a0c23<0x3?_0x101725:_0x38c2df===null?_0x38c2df=Object['getOwnPropertyDescriptor'](_0x101725,_0x5919b3):_0x38c2df,_0x524e2a;if(typeof Reflect===_0x35d775(0x1d5)&&typeof Reflect[_0x35d775(0x1cc)]===_0x35d775(0x1b1))_0x1e1386=Reflect[_0x35d775(0x1cc)](_0x24544e,_0x101725,_0x5919b3,_0x38c2df);else{for(var _0x199b74=_0x24544e[_0x35d775(0x1ba)]-0x1;_0x199b74>=0x0;_0x199b74--)if(_0x524e2a=_0x24544e[_0x199b74])_0x1e1386=(_0x3a0c23<0x3?_0x524e2a(_0x1e1386):_0x3a0c23>0x3?_0x524e2a(_0x101725,_0x5919b3,_0x1e1386):_0x524e2a(_0x101725,_0x5919b3))||_0x1e1386;}return _0x3a0c23>0x3&&_0x1e1386&&Object[_0x35d775(0x1af)](_0x101725,_0x5919b3,_0x1e1386),_0x1e1386;},__metadata=this&&this[a108_0x4a754e(0x1ac)]||function(_0x43598f,_0x1f4ec4){const _0x42e894=a108_0x4a754e;if(typeof Reflect==='object'&&typeof Reflect[_0x42e894(0x1a5)]===_0x42e894(0x1b1))return Reflect['metadata'](_0x43598f,_0x1f4ec4);},__param=this&&this[a108_0x4a754e(0x1d8)]||function(_0x57308f,_0x11c9ff){return function(_0x557756,_0x4d8647){_0x11c9ff(_0x557756,_0x4d8647,_0x57308f);};};Object['defineProperty'](exports,a108_0x4a754e(0x1b2),{'value':!![]}),exports['ScheduleService']=void 0x0;function a108_0x1f3b(_0x100494,_0x986a69){const _0x1c9439=a108_0x1c94();return a108_0x1f3b=function(_0x1f3b13,_0x53790b){_0x1f3b13=_0x1f3b13-0x19e;let _0xedb92c=_0x1c9439[_0x1f3b13];return _0xedb92c;},a108_0x1f3b(_0x100494,_0x986a69);}const common_1=require(a108_0x4a754e(0x1de)),mongoose_1=require(a108_0x4a754e(0x1ae)),mongoose_2=require(a108_0x4a754e(0x1aa)),dayjs=require(a108_0x4a754e(0x1b9)),utils_1=require(a108_0x4a754e(0x1bb)),schedulePrioritySort=(_0x38f9d5,_0x27c46c)=>dayjs(_0x38f9d5['createdAtUtc'])[a108_0x4a754e(0x1bc)](dayjs(_0x27c46c[a108_0x4a754e(0x1b0)]))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0x17ba7b){const _0x4acd0e=a108_0x4a754e;this[_0x4acd0e(0x1d2)]=_0x17ba7b;}async[a108_0x4a754e(0x1c3)](_0x24bdf1){const _0x2a1371=a108_0x4a754e,_0x2b02c8=new this[(_0x2a1371(0x1d2))](_0x24bdf1);return _0x2b02c8[_0x2a1371(0x1a9)]();}async[a108_0x4a754e(0x19e)](){const _0x25e084=a108_0x4a754e,_0x30ec86=await this[_0x25e084(0x1d2)]['find']()['exec']();return _0x30ec86;}async[a108_0x4a754e(0x1d1)](_0x25c6ef){const _0x284953=a108_0x4a754e,_0x497e70=await this[_0x284953(0x1d2)][_0x284953(0x1b6)](_0x25c6ef);return _0x497e70;}async[a108_0x4a754e(0x1a8)](_0x1ab781){const _0x48167a=a108_0x4a754e,_0x5eceb9=await this[_0x48167a(0x1b8)](_0x1ab781),_0x1091fd=_0x5eceb9['filter'](_0xa03c94=>_0xa03c94[_0x48167a(0x1a6)][_0x48167a(0x1ba)]>0x0&&_0xa03c94[_0x48167a(0x1a6)][_0x48167a(0x1e0)](_0x2d13b4=>dayjs(_0x2d13b4)['format']('YYYY-MM-DD'))[_0x48167a(0x1b3)](dayjs(_0x1ab781)[_0x48167a(0x1c0)](_0x48167a(0x1be))))[_0x48167a(0x1d6)](schedulePrioritySort);if(_0x1091fd['length']>0x0)return _0x1091fd[0x0];const _0x17c32f=_0x5eceb9[_0x48167a(0x1c5)](_0x46814f=>_0x46814f[_0x48167a(0x1ad)][_0x48167a(0x1b3)](_0x1ab781[_0x48167a(0x1b7)]()))[_0x48167a(0x1d6)](schedulePrioritySort);if(_0x17c32f[_0x48167a(0x1ba)]>0x0)return _0x17c32f[0x0];return null;}async['findAllActiveSchedules'](_0x5eaa89){const _0x15d5b4=a108_0x4a754e,_0x367e0a=dayjs(_0x5eaa89)[_0x15d5b4(0x1a3)](_0x15d5b4(0x1cb))[_0x15d5b4(0x1d0)](),_0x276079={'$and':[{'$or':[{'startDate':{'$lte':_0x5eaa89},'endDate':{'$gte':_0x5eaa89}},{'startDate':{'$lte':_0x5eaa89},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x5eaa89}}]},{'excludeDates':{'$nin':[_0x367e0a]}}]},_0x158cc9=await this[_0x15d5b4(0x1d2)][_0x15d5b4(0x1a4)](_0x276079)[_0x15d5b4(0x1e1)]();return _0x158cc9;}async[a108_0x4a754e(0x1c7)](_0x2b88d1,_0x5f0dbc){const _0x1d3c9c=a108_0x4a754e,_0x3cf1b8=new Date(_0x2b88d1),_0x3ed641={};while(_0x3cf1b8<=_0x5f0dbc){const _0x5e4619=await this[_0x1d3c9c(0x1a8)](_0x3cf1b8);_0x5e4619&&(_0x3ed641[dayjs(_0x3cf1b8)[_0x1d3c9c(0x1c0)]('YYYY-MM-DD')]=_0x5e4619),_0x3cf1b8[_0x1d3c9c(0x1d4)](_0x3cf1b8[_0x1d3c9c(0x1c2)]()+0x1);}return _0x3ed641;}async[a108_0x4a754e(0x1bd)](_0x249d0a,_0x9baae4){const _0x400e3b=a108_0x4a754e,_0x365975=await this[_0x400e3b(0x1d2)][_0x400e3b(0x1db)](_0x249d0a,Object[_0x400e3b(0x1bf)](Object[_0x400e3b(0x1bf)]({},_0x9baae4),{'updatedAtUtc':new Date()}),{'new':!![]})['exec']();return _0x365975['includeDates']&&await this[_0x400e3b(0x1a1)](_0x249d0a,_0x365975['includeDates']),_0x365975;}async[a108_0x4a754e(0x1ce)](_0x52a7a1){const _0x439519=a108_0x4a754e,_0x441502=await this[_0x439519(0x1d2)]['findByIdAndDelete'](_0x52a7a1)[_0x439519(0x1e1)]();return _0x441502;}async[a108_0x4a754e(0x1b5)](_0xeaed10,_0x29faff){const _0x227cb9=a108_0x4a754e,_0x2ec5da=await this['findOne'](_0xeaed10);_0x2ec5da[_0x227cb9(0x1a6)][_0x227cb9(0x1b4)](_0x55537d=>_0x55537d[_0x227cb9(0x1d3)]()===_0x29faff[_0x227cb9(0x1d3)]())===-0x1&&_0x2ec5da[_0x227cb9(0x1a6)][_0x227cb9(0x1da)](_0x29faff);const _0x32d2ae=await _0x2ec5da[_0x227cb9(0x1a9)]();return await this['removeOtherExistingIncludeDates'](_0xeaed10,[_0x29faff]),_0x32d2ae;}async[a108_0x4a754e(0x1a1)](_0x56935d,_0x565a93){const _0x2782be=a108_0x4a754e,_0x4daa87=await this['scheduleModel'][_0x2782be(0x1a4)]({'_id':{'$ne':_0x56935d},'includeDates':{'$in':_0x565a93}})[_0x2782be(0x1e1)](),_0x4907d1=_0x565a93['map'](_0x439787=>_0x439787[_0x2782be(0x1c4)]());await Promise[_0x2782be(0x1c9)](_0x4daa87[_0x2782be(0x1e0)](_0xed1dc0=>{const _0x15d100=_0x2782be,_0x4eac2c=_0xed1dc0[_0x15d100(0x1a6)][_0x15d100(0x1c5)](_0x2f7592=>!_0x4907d1[_0x15d100(0x1b3)](_0x2f7592[_0x15d100(0x1c4)]()));return _0xed1dc0[_0x15d100(0x1a6)]=_0x4eac2c,_0xed1dc0[_0x15d100(0x1df)]=new Date(),_0xed1dc0[_0x15d100(0x1a9)]();}));}async[a108_0x4a754e(0x1c8)](_0x3cbaa2){const _0x512480=a108_0x4a754e,_0x20bae8=await this[_0x512480(0x1d1)](_0x3cbaa2),_0xf9fa90=_0x20bae8['events']['map'](_0x47d246=>Object['assign'](Object['assign']({},_0x47d246),{'id':(0x0,utils_1[_0x512480(0x1ca)])()})),_0x400606=new this[(_0x512480(0x1d2))](Object[_0x512480(0x1bf)](Object[_0x512480(0x1bf)]({},_0x20bae8['toObject']()),{'events':_0xf9fa90,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x400606[_0x512480(0x1a9)]();}};ScheduleService=__decorate([(0x0,common_1[a108_0x4a754e(0x1e2)])(),__param(0x0,(0x0,mongoose_1['InjectModel'])(a108_0x4a754e(0x1dc))),__metadata(a108_0x4a754e(0x1ab),[mongoose_2[a108_0x4a754e(0x1cd)]])],ScheduleService),exports[a108_0x4a754e(0x1d9)]=ScheduleService;