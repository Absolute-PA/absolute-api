'use strict';function a108_0x1419(_0x2d4ca3,_0x310897){const _0x5ed1fb=a108_0x5ed1();return a108_0x1419=function(_0x141959,_0x236efc){_0x141959=_0x141959-0x185;let _0x508236=_0x5ed1fb[_0x141959];return _0x508236;},a108_0x1419(_0x2d4ca3,_0x310897);}const a108_0x50d0af=a108_0x1419;function a108_0x5ed1(){const _0x3af5a3=['find','getDate','Model','sort','function','format','addIncludeDate','map','__decorate','findByIdAndUpdate','Schedule','clone','findById','findEligibleSchedule','1009566sOYMUW','__param','updatedAtUtc','weekDays','toDate','setDate','findAllActiveSchedules','object','createdAtUtc','InjectModel','getTime','defineProperty','includeDates','length','update','__metadata','includes','18ykzpna','6641748nLoUro','getOwnPropertyDescriptor','4mmCLAi','scheduleModel','decorate','push','findOne','events','ScheduleService','mongoose','findIndex','findByIdAndDelete','2243960iRJtoh','remove','10258759SSApvq','isAfter','create','../common/utils','dayjs','8ykKveh','74609579rqsIHi','toISOString','removeOtherExistingIncludeDates','5092970UPWsMi','findEligibleScheduleBetween','YYYY-MM-DD','2vBkoDP','2801733XJCZtu','uuid','metadata','exec','day','assign','filter','save'];a108_0x5ed1=function(){return _0x3af5a3;};return a108_0x5ed1();}(function(_0x3f8457,_0x50d790){const _0xcfd551=a108_0x1419,_0x417c0f=_0x3f8457();while(!![]){try{const _0x1b8fa2=-parseInt(_0xcfd551(0x1a7))/0x1+-parseInt(_0xcfd551(0x190))/0x2*(parseInt(_0xcfd551(0x191))/0x3)+parseInt(_0xcfd551(0x1bb))/0x4*(-parseInt(_0xcfd551(0x1c5))/0x5)+-parseInt(_0xcfd551(0x1b9))/0x6+parseInt(_0xcfd551(0x1c7))/0x7*(-parseInt(_0xcfd551(0x189))/0x8)+parseInt(_0xcfd551(0x1b8))/0x9*(-parseInt(_0xcfd551(0x18d))/0xa)+parseInt(_0xcfd551(0x18a))/0xb;if(_0x1b8fa2===_0x50d790)break;else _0x417c0f['push'](_0x417c0f['shift']());}catch(_0x2d4d8e){_0x417c0f['push'](_0x417c0f['shift']());}}}(a108_0x5ed1,0xc3263));var __decorate=this&&this[a108_0x50d0af(0x1a1)]||function(_0x4d6468,_0x2c21d6,_0x1c6749,_0x3daf2f){const _0x321709=a108_0x50d0af;var _0x9e1efd=arguments[_0x321709(0x1b4)],_0x295880=_0x9e1efd<0x3?_0x2c21d6:_0x3daf2f===null?_0x3daf2f=Object[_0x321709(0x1ba)](_0x2c21d6,_0x1c6749):_0x3daf2f,_0x523ecf;if(typeof Reflect===_0x321709(0x1ae)&&typeof Reflect[_0x321709(0x1bd)]===_0x321709(0x19d))_0x295880=Reflect['decorate'](_0x4d6468,_0x2c21d6,_0x1c6749,_0x3daf2f);else{for(var _0x1f0647=_0x4d6468['length']-0x1;_0x1f0647>=0x0;_0x1f0647--)if(_0x523ecf=_0x4d6468[_0x1f0647])_0x295880=(_0x9e1efd<0x3?_0x523ecf(_0x295880):_0x9e1efd>0x3?_0x523ecf(_0x2c21d6,_0x1c6749,_0x295880):_0x523ecf(_0x2c21d6,_0x1c6749))||_0x295880;}return _0x9e1efd>0x3&&_0x295880&&Object[_0x321709(0x1b2)](_0x2c21d6,_0x1c6749,_0x295880),_0x295880;},__metadata=this&&this[a108_0x50d0af(0x1b6)]||function(_0x378b4c,_0x15c4c1){const _0x1ed1b6=a108_0x50d0af;if(typeof Reflect===_0x1ed1b6(0x1ae)&&typeof Reflect['metadata']===_0x1ed1b6(0x19d))return Reflect[_0x1ed1b6(0x193)](_0x378b4c,_0x15c4c1);},__param=this&&this[a108_0x50d0af(0x1a8)]||function(_0x5c5067,_0x26b042){return function(_0x40ace2,_0x34ed67){_0x26b042(_0x40ace2,_0x34ed67,_0x5c5067);};};Object[a108_0x50d0af(0x1b2)](exports,'__esModule',{'value':!![]}),exports[a108_0x50d0af(0x1c1)]=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require(a108_0x50d0af(0x1c2)),dayjs=require(a108_0x50d0af(0x188)),utils_1=require(a108_0x50d0af(0x187)),schedulePrioritySort=(_0x12c4a3,_0x59cfab)=>dayjs(_0x12c4a3['createdAtUtc'])[a108_0x50d0af(0x185)](dayjs(_0x59cfab[a108_0x50d0af(0x1af)]))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0x585820){const _0x2b050a=a108_0x50d0af;this[_0x2b050a(0x1bc)]=_0x585820;}async[a108_0x50d0af(0x186)](_0x4a96b1){const _0x20368f=a108_0x50d0af,_0x1c9002=new this[(_0x20368f(0x1bc))](_0x4a96b1);return _0x1c9002[_0x20368f(0x198)]();}async['findAll'](){const _0x5a8700=a108_0x50d0af,_0x1dc7fa=await this[_0x5a8700(0x1bc)][_0x5a8700(0x199)]()[_0x5a8700(0x194)]();return _0x1dc7fa;}async['findOne'](_0x213af1){const _0x34d673=a108_0x50d0af,_0x5d9dc3=await this[_0x34d673(0x1bc)][_0x34d673(0x1a5)](_0x213af1);return _0x5d9dc3;}async[a108_0x50d0af(0x1a6)](_0x464eb7){const _0x402e6c=a108_0x50d0af,_0x138e55=await this[_0x402e6c(0x1ad)](_0x464eb7),_0x5e0433=_0x138e55[_0x402e6c(0x197)](_0x1c78d7=>_0x1c78d7['includeDates'][_0x402e6c(0x1b4)]>0x0&&_0x1c78d7[_0x402e6c(0x1b3)][_0x402e6c(0x1a0)](_0x1fea58=>dayjs(_0x1fea58)[_0x402e6c(0x19e)]('YYYY-MM-DD'))['includes'](dayjs(_0x464eb7)[_0x402e6c(0x19e)]('YYYY-MM-DD')))[_0x402e6c(0x19c)](schedulePrioritySort);if(_0x5e0433[_0x402e6c(0x1b4)]>0x0)return _0x5e0433[0x0];const _0x13e947=_0x138e55[_0x402e6c(0x197)](_0x4ae04b=>_0x4ae04b[_0x402e6c(0x1aa)][_0x402e6c(0x1b7)](_0x464eb7['getDay']()))[_0x402e6c(0x19c)](schedulePrioritySort);if(_0x13e947['length']>0x0)return _0x13e947[0x0];return null;}async[a108_0x50d0af(0x1ad)](_0x24f2cd){const _0xba678a=a108_0x50d0af,_0x1da266=dayjs(_0x24f2cd)['startOf'](_0xba678a(0x195))[_0xba678a(0x1ab)](),_0x340d83={'$and':[{'$or':[{'startDate':{'$lte':_0x24f2cd},'endDate':{'$gte':_0x24f2cd}},{'startDate':{'$lte':_0x24f2cd},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x24f2cd}}]},{'excludeDates':{'$nin':[_0x1da266]}}]},_0x27e142=await this[_0xba678a(0x1bc)][_0xba678a(0x199)](_0x340d83)[_0xba678a(0x194)]();return _0x27e142;}async[a108_0x50d0af(0x18e)](_0x12e08c,_0x3cfa14){const _0x17891c=a108_0x50d0af,_0xcd7137=new Date(_0x12e08c),_0x115b19={};while(_0xcd7137<=_0x3cfa14){const _0x476c49=await this['findEligibleSchedule'](_0xcd7137);_0x476c49&&(_0x115b19[dayjs(_0xcd7137)[_0x17891c(0x19e)](_0x17891c(0x18f))]=_0x476c49),_0xcd7137[_0x17891c(0x1ac)](_0xcd7137[_0x17891c(0x19a)]()+0x1);}return _0x115b19;}async[a108_0x50d0af(0x1b5)](_0xac141a,_0x4db205){const _0x38485a=a108_0x50d0af,_0x3151ea=await this[_0x38485a(0x1bc)][_0x38485a(0x1a2)](_0xac141a,Object[_0x38485a(0x196)](Object[_0x38485a(0x196)]({},_0x4db205),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x38485a(0x194)]();return _0x3151ea[_0x38485a(0x1b3)]&&await this['removeOtherExistingIncludeDates'](_0xac141a,_0x3151ea[_0x38485a(0x1b3)]),_0x3151ea;}async[a108_0x50d0af(0x1c6)](_0x395df9){const _0x108f04=a108_0x50d0af,_0x36e0ff=await this[_0x108f04(0x1bc)][_0x108f04(0x1c4)](_0x395df9)['exec']();return _0x36e0ff;}async[a108_0x50d0af(0x19f)](_0x430bb2,_0xd76cea){const _0x16103f=a108_0x50d0af,_0x2c24ac=await this[_0x16103f(0x1bf)](_0x430bb2);_0x2c24ac[_0x16103f(0x1b3)][_0x16103f(0x1c3)](_0x50312a=>_0x50312a[_0x16103f(0x1b1)]()===_0xd76cea[_0x16103f(0x1b1)]())===-0x1&&_0x2c24ac[_0x16103f(0x1b3)][_0x16103f(0x1be)](_0xd76cea);const _0x59aaba=await _0x2c24ac[_0x16103f(0x198)]();return await this[_0x16103f(0x18c)](_0x430bb2,[_0xd76cea]),_0x59aaba;}async[a108_0x50d0af(0x18c)](_0x2c9ebd,_0x428399){const _0x58371c=a108_0x50d0af,_0x37f72b=await this[_0x58371c(0x1bc)]['find']({'_id':{'$ne':_0x2c9ebd},'includeDates':{'$in':_0x428399}})[_0x58371c(0x194)](),_0xeea66b=_0x428399['map'](_0x368c3a=>_0x368c3a['toISOString']());await Promise['all'](_0x37f72b[_0x58371c(0x1a0)](_0x281a0d=>{const _0x189e62=_0x58371c,_0x5ae659=_0x281a0d[_0x189e62(0x1b3)]['filter'](_0x2e370=>!_0xeea66b['includes'](_0x2e370[_0x189e62(0x18b)]()));return _0x281a0d[_0x189e62(0x1b3)]=_0x5ae659,_0x281a0d[_0x189e62(0x1a9)]=new Date(),_0x281a0d[_0x189e62(0x198)]();}));}async[a108_0x50d0af(0x1a4)](_0x465f38){const _0x59d3a5=a108_0x50d0af,_0x5d14cf=await this[_0x59d3a5(0x1bf)](_0x465f38),_0x11f8ee=_0x5d14cf[_0x59d3a5(0x1c0)]['map'](_0x5552b7=>Object[_0x59d3a5(0x196)](Object[_0x59d3a5(0x196)]({},_0x5552b7),{'id':(0x0,utils_1[_0x59d3a5(0x192)])()})),_0x42bb61=new this['scheduleModel'](Object[_0x59d3a5(0x196)](Object[_0x59d3a5(0x196)]({},_0x5d14cf['toObject']()),{'events':_0x11f8ee,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x42bb61['save']();}};ScheduleService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_1[a108_0x50d0af(0x1b0)])(a108_0x50d0af(0x1a3))),__metadata('design:paramtypes',[mongoose_2[a108_0x50d0af(0x19b)]])],ScheduleService),exports[a108_0x50d0af(0x1c1)]=ScheduleService;