'use strict';const a108_0x16bd19=a108_0x48b9;(function(_0x52f573,_0x4572af){const _0x1baff7=a108_0x48b9,_0x5e6016=_0x52f573();while(!![]){try{const _0x119f2b=-parseInt(_0x1baff7(0x9c))/0x1+-parseInt(_0x1baff7(0x8e))/0x2+parseInt(_0x1baff7(0x89))/0x3+parseInt(_0x1baff7(0xa4))/0x4*(parseInt(_0x1baff7(0x68))/0x5)+-parseInt(_0x1baff7(0x81))/0x6*(parseInt(_0x1baff7(0x8a))/0x7)+parseInt(_0x1baff7(0x71))/0x8*(-parseInt(_0x1baff7(0x9d))/0x9)+parseInt(_0x1baff7(0x9e))/0xa;if(_0x119f2b===_0x4572af)break;else _0x5e6016['push'](_0x5e6016['shift']());}catch(_0x59baf5){_0x5e6016['push'](_0x5e6016['shift']());}}}(a108_0x52e8,0xb48a5));function a108_0x52e8(){const _0x34e9a4=['find','remove','update','uuid','push','12168AUJhzg','ScheduleService','toISOString','InjectModel','75BiHJFI','findEligibleScheduleBetween','findByIdAndUpdate','removeOtherExistingIncludeDates','function','findByIdAndDelete','clone','@nestjs/common','includes','8csQLKP','createdAtUtc','defineProperty','findOne','events','create','getOwnPropertyDescriptor','toDate','day','includeDates','object','../common/utils','all','sort','findById','map','5503362gsSTrE','addIncludeDate','Model','length','__decorate','decorate','getDate','YYYY-MM-DD','1941549jEGgQu','7MTCYTt','assign','updatedAtUtc','format','1619960ZgkckG','scheduleModel','getTime','Schedule','metadata','save','exec','findEligibleSchedule','__metadata','filter','isAfter','findAllActiveSchedules','setDate','weekDays','64067WfuqqM','71829bSOeXF','18459350Rxdota'];a108_0x52e8=function(){return _0x34e9a4;};return a108_0x52e8();}function a108_0x48b9(_0x22b804,_0x3f7754){const _0x52e8c2=a108_0x52e8();return a108_0x48b9=function(_0x48b913,_0x47248b){_0x48b913=_0x48b913-0x68;let _0x4993d8=_0x52e8c2[_0x48b913];return _0x4993d8;},a108_0x48b9(_0x22b804,_0x3f7754);}var __decorate=this&&this[a108_0x16bd19(0x85)]||function(_0x1c44fb,_0x2d7b08,_0x3d3743,_0x470b55){const _0x381c30=a108_0x16bd19;var _0x5035b6=arguments[_0x381c30(0x84)],_0x343b76=_0x5035b6<0x3?_0x2d7b08:_0x470b55===null?_0x470b55=Object[_0x381c30(0x77)](_0x2d7b08,_0x3d3743):_0x470b55,_0x34eedc;if(typeof Reflect===_0x381c30(0x7b)&&typeof Reflect['decorate']===_0x381c30(0x6c))_0x343b76=Reflect[_0x381c30(0x86)](_0x1c44fb,_0x2d7b08,_0x3d3743,_0x470b55);else{for(var _0x1890fe=_0x1c44fb[_0x381c30(0x84)]-0x1;_0x1890fe>=0x0;_0x1890fe--)if(_0x34eedc=_0x1c44fb[_0x1890fe])_0x343b76=(_0x5035b6<0x3?_0x34eedc(_0x343b76):_0x5035b6>0x3?_0x34eedc(_0x2d7b08,_0x3d3743,_0x343b76):_0x34eedc(_0x2d7b08,_0x3d3743))||_0x343b76;}return _0x5035b6>0x3&&_0x343b76&&Object[_0x381c30(0x73)](_0x2d7b08,_0x3d3743,_0x343b76),_0x343b76;},__metadata=this&&this[a108_0x16bd19(0x96)]||function(_0x430ef3,_0x4543c0){const _0xd128=a108_0x16bd19;if(typeof Reflect===_0xd128(0x7b)&&typeof Reflect[_0xd128(0x92)]===_0xd128(0x6c))return Reflect[_0xd128(0x92)](_0x430ef3,_0x4543c0);},__param=this&&this['__param']||function(_0x4555b9,_0xd598ef){return function(_0x12e16a,_0x4ad703){_0xd598ef(_0x12e16a,_0x4ad703,_0x4555b9);};};Object[a108_0x16bd19(0x73)](exports,'__esModule',{'value':!![]}),exports[a108_0x16bd19(0xa5)]=void 0x0;const common_1=require(a108_0x16bd19(0x6f)),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require('mongoose'),dayjs=require('dayjs'),utils_1=require(a108_0x16bd19(0x7c)),schedulePrioritySort=(_0x42e08f,_0x682634)=>dayjs(_0x42e08f[a108_0x16bd19(0x72)])[a108_0x16bd19(0x98)](dayjs(_0x682634[a108_0x16bd19(0x72)]))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0x1863ad){const _0x8ade0a=a108_0x16bd19;this[_0x8ade0a(0x8f)]=_0x1863ad;}async[a108_0x16bd19(0x76)](_0x591713){const _0x5cdf98=a108_0x16bd19,_0x9859fd=new this[(_0x5cdf98(0x8f))](_0x591713);return _0x9859fd[_0x5cdf98(0x93)]();}async['findAll'](){const _0x4c1ff4=a108_0x16bd19,_0x540374=await this[_0x4c1ff4(0x8f)][_0x4c1ff4(0x9f)]()[_0x4c1ff4(0x94)]();return _0x540374;}async[a108_0x16bd19(0x74)](_0x4d26a8){const _0x3168f4=a108_0x16bd19,_0x1657c3=await this[_0x3168f4(0x8f)][_0x3168f4(0x7f)](_0x4d26a8);return _0x1657c3;}async[a108_0x16bd19(0x95)](_0x4508ee){const _0x59a56a=a108_0x16bd19,_0x35bada=await this[_0x59a56a(0x99)](_0x4508ee),_0x558bd4=_0x35bada['filter'](_0x1e57fd=>_0x1e57fd[_0x59a56a(0x7a)][_0x59a56a(0x84)]>0x0&&_0x1e57fd[_0x59a56a(0x7a)][_0x59a56a(0x80)](_0x3271e6=>dayjs(_0x3271e6)[_0x59a56a(0x8d)](_0x59a56a(0x88)))['includes'](dayjs(_0x4508ee)[_0x59a56a(0x8d)](_0x59a56a(0x88))))[_0x59a56a(0x7e)](schedulePrioritySort);if(_0x558bd4[_0x59a56a(0x84)]>0x0)return _0x558bd4[0x0];const _0x5847be=_0x35bada[_0x59a56a(0x97)](_0x549c51=>_0x549c51[_0x59a56a(0x9b)]['includes'](_0x4508ee['getDay']()))[_0x59a56a(0x7e)](schedulePrioritySort);if(_0x5847be[_0x59a56a(0x84)]>0x0)return _0x5847be[0x0];return null;}async['findAllActiveSchedules'](_0x1a1497){const _0x1e1759=a108_0x16bd19,_0x3b2734=dayjs(_0x1a1497)['startOf'](_0x1e1759(0x79))[_0x1e1759(0x78)](),_0x16ddf0={'$and':[{'$or':[{'startDate':{'$lte':_0x1a1497},'endDate':{'$gte':_0x1a1497}},{'startDate':{'$lte':_0x1a1497},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x1a1497}}]},{'excludeDates':{'$nin':[_0x3b2734]}}]},_0x52b9ab=await this[_0x1e1759(0x8f)]['find'](_0x16ddf0)['exec']();return _0x52b9ab;}async[a108_0x16bd19(0x69)](_0x50119a,_0x3fa545){const _0x30fe42=a108_0x16bd19,_0x377245=new Date(_0x50119a),_0x169a8e={};while(_0x377245<=_0x3fa545){const _0xff10fc=await this[_0x30fe42(0x95)](_0x377245);_0xff10fc&&(_0x169a8e[dayjs(_0x377245)[_0x30fe42(0x8d)](_0x30fe42(0x88))]=_0xff10fc),_0x377245[_0x30fe42(0x9a)](_0x377245[_0x30fe42(0x87)]()+0x1);}return _0x169a8e;}async[a108_0x16bd19(0xa1)](_0x5ecc07,_0x5c5ab1){const _0x5b1332=a108_0x16bd19,_0x249ab7=await this[_0x5b1332(0x8f)][_0x5b1332(0x6a)](_0x5ecc07,Object[_0x5b1332(0x8b)](Object[_0x5b1332(0x8b)]({},_0x5c5ab1),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x5b1332(0x94)]();return _0x249ab7[_0x5b1332(0x7a)]&&await this[_0x5b1332(0x6b)](_0x5ecc07,_0x249ab7[_0x5b1332(0x7a)]),_0x249ab7;}async[a108_0x16bd19(0xa0)](_0x3f302b){const _0x56d9d5=a108_0x16bd19,_0x47deab=await this[_0x56d9d5(0x8f)][_0x56d9d5(0x6d)](_0x3f302b)[_0x56d9d5(0x94)]();return _0x47deab;}async[a108_0x16bd19(0x82)](_0x9f5035,_0x282f73){const _0x531b8e=a108_0x16bd19,_0x2cefb0=await this[_0x531b8e(0x74)](_0x9f5035);_0x2cefb0['includeDates']['findIndex'](_0x36c1b1=>_0x36c1b1[_0x531b8e(0x90)]()===_0x282f73['getTime']())===-0x1&&_0x2cefb0[_0x531b8e(0x7a)][_0x531b8e(0xa3)](_0x282f73);const _0x38963e=await _0x2cefb0[_0x531b8e(0x93)]();return await this['removeOtherExistingIncludeDates'](_0x9f5035,[_0x282f73]),_0x38963e;}async['removeOtherExistingIncludeDates'](_0x21280f,_0x318d4d){const _0x21de0d=a108_0x16bd19,_0x16d866=await this[_0x21de0d(0x8f)][_0x21de0d(0x9f)]({'_id':{'$ne':_0x21280f},'includeDates':{'$in':_0x318d4d}})[_0x21de0d(0x94)](),_0x1584f6=_0x318d4d['map'](_0x3d464a=>_0x3d464a[_0x21de0d(0xa6)]());await Promise[_0x21de0d(0x7d)](_0x16d866['map'](_0x27e85b=>{const _0x50519a=_0x21de0d,_0x508539=_0x27e85b[_0x50519a(0x7a)][_0x50519a(0x97)](_0x253cd5=>!_0x1584f6[_0x50519a(0x70)](_0x253cd5[_0x50519a(0xa6)]()));return _0x27e85b['includeDates']=_0x508539,_0x27e85b[_0x50519a(0x8c)]=new Date(),_0x27e85b[_0x50519a(0x93)]();}));}async[a108_0x16bd19(0x6e)](_0x517abb){const _0x3da411=a108_0x16bd19,_0xa81ef4=await this[_0x3da411(0x74)](_0x517abb),_0x3f49c7=_0xa81ef4[_0x3da411(0x75)][_0x3da411(0x80)](_0x5a2c8e=>Object[_0x3da411(0x8b)](Object[_0x3da411(0x8b)]({},_0x5a2c8e),{'id':(0x0,utils_1[_0x3da411(0xa2)])()})),_0x2a33c0=new this[(_0x3da411(0x8f))](Object['assign'](Object[_0x3da411(0x8b)]({},_0xa81ef4['toObject']()),{'events':_0x3f49c7,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x2a33c0[_0x3da411(0x93)]();}};ScheduleService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_1[a108_0x16bd19(0xa7)])(a108_0x16bd19(0x91))),__metadata('design:paramtypes',[mongoose_2[a108_0x16bd19(0x83)]])],ScheduleService),exports['ScheduleService']=ScheduleService;