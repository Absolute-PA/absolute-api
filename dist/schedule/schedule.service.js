'use strict';const a108_0x4aee3c=a108_0xe0d4;(function(_0x3610e3,_0x47b953){const _0x2b322f=a108_0xe0d4,_0x13f9b6=_0x3610e3();while(!![]){try{const _0x569764=-parseInt(_0x2b322f(0x70))/0x1*(parseInt(_0x2b322f(0x99))/0x2)+-parseInt(_0x2b322f(0x9b))/0x3+parseInt(_0x2b322f(0x73))/0x4*(parseInt(_0x2b322f(0xa9))/0x5)+parseInt(_0x2b322f(0x80))/0x6*(-parseInt(_0x2b322f(0x95))/0x7)+-parseInt(_0x2b322f(0x6b))/0x8*(parseInt(_0x2b322f(0x98))/0x9)+-parseInt(_0x2b322f(0xb0))/0xa*(-parseInt(_0x2b322f(0xa8))/0xb)+parseInt(_0x2b322f(0x74))/0xc;if(_0x569764===_0x47b953)break;else _0x13f9b6['push'](_0x13f9b6['shift']());}catch(_0x360b20){_0x13f9b6['push'](_0x13f9b6['shift']());}}}(a108_0x29d6,0x9ce0a));function a108_0x29d6(){const _0x4a1390=['4obSQMs','21729456leFicS','design:paramtypes','@nestjs/common','includes','Injectable','YYYY-MM-DD','updatedAtUtc','mongoose','clone','remove','getTime','addIncludeDate','1302AZQNfa','createdAtUtc','toISOString','__param','__metadata','findAllActiveSchedules','Schedule','isAfter','__esModule','defineProperty','uuid','assign','function','setDate','decorate','create','sort','findByIdAndUpdate','toObject','filter','findEligibleSchedule','630BhEoMe','metadata','getOwnPropertyDescriptor','3987YyDnGb','34ZfhkhA','findByIdAndDelete','1040856xLxOvb','findById','find','getDay','findOne','Model','update','day','object','toDate','removeOtherExistingIncludeDates','findAll','../common/utils','33PiUhlY','1504015RNAiOD','scheduleModel','all','weekDays','getDate','map','save','3204710RwwSyk','exec','21752EYFMUo','__decorate','format','events','includeDates','50555ESigeu','ScheduleService','length'];a108_0x29d6=function(){return _0x4a1390;};return a108_0x29d6();}var __decorate=this&&this[a108_0x4aee3c(0x6c)]||function(_0x960b7d,_0x288629,_0x23cce9,_0xca3220){const _0x30fb0c=a108_0x4aee3c;var _0x5c20c5=arguments[_0x30fb0c(0x72)],_0x5167e4=_0x5c20c5<0x3?_0x288629:_0xca3220===null?_0xca3220=Object[_0x30fb0c(0x97)](_0x288629,_0x23cce9):_0xca3220,_0x1f0e47;if(typeof Reflect===_0x30fb0c(0xa3)&&typeof Reflect[_0x30fb0c(0x8e)]===_0x30fb0c(0x8c))_0x5167e4=Reflect[_0x30fb0c(0x8e)](_0x960b7d,_0x288629,_0x23cce9,_0xca3220);else{for(var _0x1acc65=_0x960b7d[_0x30fb0c(0x72)]-0x1;_0x1acc65>=0x0;_0x1acc65--)if(_0x1f0e47=_0x960b7d[_0x1acc65])_0x5167e4=(_0x5c20c5<0x3?_0x1f0e47(_0x5167e4):_0x5c20c5>0x3?_0x1f0e47(_0x288629,_0x23cce9,_0x5167e4):_0x1f0e47(_0x288629,_0x23cce9))||_0x5167e4;}return _0x5c20c5>0x3&&_0x5167e4&&Object[_0x30fb0c(0x89)](_0x288629,_0x23cce9,_0x5167e4),_0x5167e4;},__metadata=this&&this[a108_0x4aee3c(0x84)]||function(_0x3c3bc6,_0xc37e16){const _0x119936=a108_0x4aee3c;if(typeof Reflect===_0x119936(0xa3)&&typeof Reflect[_0x119936(0x96)]===_0x119936(0x8c))return Reflect[_0x119936(0x96)](_0x3c3bc6,_0xc37e16);},__param=this&&this[a108_0x4aee3c(0x83)]||function(_0x32a470,_0x426a11){return function(_0x4f6118,_0x4895e9){_0x426a11(_0x4f6118,_0x4895e9,_0x32a470);};};Object['defineProperty'](exports,a108_0x4aee3c(0x88),{'value':!![]}),exports[a108_0x4aee3c(0x71)]=void 0x0;function a108_0xe0d4(_0x1a2828,_0x56ee16){const _0x29d677=a108_0x29d6();return a108_0xe0d4=function(_0xe0d4c7,_0x17c2bb){_0xe0d4c7=_0xe0d4c7-0x6b;let _0x3652cb=_0x29d677[_0xe0d4c7];return _0x3652cb;},a108_0xe0d4(_0x1a2828,_0x56ee16);}const common_1=require(a108_0x4aee3c(0x76)),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require(a108_0x4aee3c(0x7b)),dayjs=require('dayjs'),utils_1=require(a108_0x4aee3c(0xa7)),schedulePrioritySort=(_0x258ff3,_0x5d9ec2)=>dayjs(_0x258ff3[a108_0x4aee3c(0x81)])[a108_0x4aee3c(0x87)](dayjs(_0x5d9ec2[a108_0x4aee3c(0x81)]))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0x2c75cc){const _0x31ae9c=a108_0x4aee3c;this[_0x31ae9c(0xaa)]=_0x2c75cc;}async[a108_0x4aee3c(0x8f)](_0x4f82cf){const _0x4b8749=a108_0x4aee3c,_0x5d118b=new this[(_0x4b8749(0xaa))](_0x4f82cf);return _0x5d118b[_0x4b8749(0xaf)]();}async[a108_0x4aee3c(0xa6)](){const _0x3b71b3=a108_0x4aee3c,_0x4e5e7b=await this['scheduleModel'][_0x3b71b3(0x9d)]()['exec']();return _0x4e5e7b;}async[a108_0x4aee3c(0x9f)](_0x36eaae){const _0x37b710=a108_0x4aee3c,_0x3d8396=await this['scheduleModel'][_0x37b710(0x9c)](_0x36eaae);return _0x3d8396;}async[a108_0x4aee3c(0x94)](_0x3a13a1){const _0x44bc6c=a108_0x4aee3c,_0x2b40b5=await this[_0x44bc6c(0x85)](_0x3a13a1),_0x11b086=_0x2b40b5[_0x44bc6c(0x93)](_0x20b8b1=>_0x20b8b1[_0x44bc6c(0x6f)][_0x44bc6c(0x72)]>0x0&&_0x20b8b1[_0x44bc6c(0x6f)]['map'](_0x1c4e20=>dayjs(_0x1c4e20)[_0x44bc6c(0x6d)](_0x44bc6c(0x79)))['includes'](dayjs(_0x3a13a1)[_0x44bc6c(0x6d)](_0x44bc6c(0x79))))[_0x44bc6c(0x90)](schedulePrioritySort);if(_0x11b086['length']>0x0)return _0x11b086[0x0];const _0x48d382=_0x2b40b5[_0x44bc6c(0x93)](_0x4225b1=>_0x4225b1[_0x44bc6c(0xac)][_0x44bc6c(0x77)](_0x3a13a1[_0x44bc6c(0x9e)]()))[_0x44bc6c(0x90)](schedulePrioritySort);if(_0x48d382[_0x44bc6c(0x72)]>0x0)return _0x48d382[0x0];return null;}async['findAllActiveSchedules'](_0x5ebc7a){const _0x58a1e3=a108_0x4aee3c,_0x597958=dayjs(_0x5ebc7a)['startOf'](_0x58a1e3(0xa2))[_0x58a1e3(0xa4)](),_0x312a44={'$and':[{'$or':[{'startDate':{'$lte':_0x5ebc7a},'endDate':{'$gte':_0x5ebc7a}},{'startDate':{'$lte':_0x5ebc7a},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x5ebc7a}}]},{'excludeDates':{'$nin':[_0x597958]}}]},_0x1ef7e4=await this[_0x58a1e3(0xaa)][_0x58a1e3(0x9d)](_0x312a44)[_0x58a1e3(0xb1)]();return _0x1ef7e4;}async['findEligibleScheduleBetween'](_0x5dfc9f,_0x383f8d){const _0x31eebb=a108_0x4aee3c,_0x4fcfe9=new Date(_0x5dfc9f),_0x3bdc2b={};while(_0x4fcfe9<=_0x383f8d){const _0xaee37=await this[_0x31eebb(0x94)](_0x4fcfe9);_0xaee37&&(_0x3bdc2b[dayjs(_0x4fcfe9)[_0x31eebb(0x6d)]('YYYY-MM-DD')]=_0xaee37),_0x4fcfe9[_0x31eebb(0x8d)](_0x4fcfe9[_0x31eebb(0xad)]()+0x1);}return _0x3bdc2b;}async[a108_0x4aee3c(0xa1)](_0x2f1992,_0x28e6fc){const _0x1d3dc4=a108_0x4aee3c,_0xbede8a=await this[_0x1d3dc4(0xaa)][_0x1d3dc4(0x91)](_0x2f1992,Object[_0x1d3dc4(0x8b)](Object[_0x1d3dc4(0x8b)]({},_0x28e6fc),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x1d3dc4(0xb1)]();return _0xbede8a['includeDates']&&await this[_0x1d3dc4(0xa5)](_0x2f1992,_0xbede8a[_0x1d3dc4(0x6f)]),_0xbede8a;}async[a108_0x4aee3c(0x7d)](_0x192893){const _0x1c0280=a108_0x4aee3c,_0x3db8af=await this[_0x1c0280(0xaa)][_0x1c0280(0x9a)](_0x192893)[_0x1c0280(0xb1)]();return _0x3db8af;}async[a108_0x4aee3c(0x7f)](_0x112ceb,_0x44daf1){const _0x3e7984=a108_0x4aee3c,_0x82373b=await this[_0x3e7984(0x9f)](_0x112ceb);_0x82373b[_0x3e7984(0x6f)]['findIndex'](_0x1fcb35=>_0x1fcb35[_0x3e7984(0x7e)]()===_0x44daf1[_0x3e7984(0x7e)]())===-0x1&&_0x82373b[_0x3e7984(0x6f)]['push'](_0x44daf1);const _0x16b7b8=await _0x82373b[_0x3e7984(0xaf)]();return await this[_0x3e7984(0xa5)](_0x112ceb,[_0x44daf1]),_0x16b7b8;}async['removeOtherExistingIncludeDates'](_0x1038d2,_0x31a8d9){const _0x5a436c=a108_0x4aee3c,_0x21215e=await this[_0x5a436c(0xaa)][_0x5a436c(0x9d)]({'_id':{'$ne':_0x1038d2},'includeDates':{'$in':_0x31a8d9}})[_0x5a436c(0xb1)](),_0xa56b24=_0x31a8d9['map'](_0x1b116d=>_0x1b116d['toISOString']());await Promise[_0x5a436c(0xab)](_0x21215e[_0x5a436c(0xae)](_0x19226c=>{const _0x33c9f2=_0x5a436c,_0x11c5a6=_0x19226c['includeDates']['filter'](_0x1fc0b6=>!_0xa56b24[_0x33c9f2(0x77)](_0x1fc0b6[_0x33c9f2(0x82)]()));return _0x19226c[_0x33c9f2(0x6f)]=_0x11c5a6,_0x19226c[_0x33c9f2(0x7a)]=new Date(),_0x19226c['save']();}));}async[a108_0x4aee3c(0x7c)](_0xae1e57){const _0x22f268=a108_0x4aee3c,_0x3ec669=await this[_0x22f268(0x9f)](_0xae1e57),_0x2f9311=_0x3ec669[_0x22f268(0x6e)][_0x22f268(0xae)](_0x4819d2=>Object[_0x22f268(0x8b)](Object[_0x22f268(0x8b)]({},_0x4819d2),{'id':(0x0,utils_1[_0x22f268(0x8a)])()})),_0x390dec=new this[(_0x22f268(0xaa))](Object[_0x22f268(0x8b)](Object['assign']({},_0x3ec669[_0x22f268(0x92)]()),{'events':_0x2f9311,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x390dec['save']();}};ScheduleService=__decorate([(0x0,common_1[a108_0x4aee3c(0x78)])(),__param(0x0,(0x0,mongoose_1['InjectModel'])(a108_0x4aee3c(0x86))),__metadata(a108_0x4aee3c(0x75),[mongoose_2[a108_0x4aee3c(0xa0)]])],ScheduleService),exports[a108_0x4aee3c(0x71)]=ScheduleService;