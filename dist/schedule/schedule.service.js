'use strict';const a108_0x608d16=a108_0x582a;(function(_0x53a0a7,_0x550441){const _0x1c6a3e=a108_0x582a,_0xef357=_0x53a0a7();while(!![]){try{const _0x51bf7f=-parseInt(_0x1c6a3e(0x172))/0x1*(parseInt(_0x1c6a3e(0x16a))/0x2)+-parseInt(_0x1c6a3e(0x156))/0x3*(-parseInt(_0x1c6a3e(0x159))/0x4)+-parseInt(_0x1c6a3e(0x174))/0x5+parseInt(_0x1c6a3e(0x171))/0x6+parseInt(_0x1c6a3e(0x166))/0x7*(parseInt(_0x1c6a3e(0x182))/0x8)+parseInt(_0x1c6a3e(0x16c))/0x9+-parseInt(_0x1c6a3e(0x185))/0xa;if(_0x51bf7f===_0x550441)break;else _0xef357['push'](_0xef357['shift']());}catch(_0x298aa7){_0xef357['push'](_0xef357['shift']());}}}(a108_0xe338,0xd350f));var __decorate=this&&this[a108_0x608d16(0x165)]||function(_0x1ab7ea,_0x306647,_0x347510,_0x4ec4b9){const _0x4df896=a108_0x608d16;var _0x4a76ac=arguments[_0x4df896(0x177)],_0x16b6fe=_0x4a76ac<0x3?_0x306647:_0x4ec4b9===null?_0x4ec4b9=Object[_0x4df896(0x157)](_0x306647,_0x347510):_0x4ec4b9,_0x52907f;if(typeof Reflect===_0x4df896(0x147)&&typeof Reflect[_0x4df896(0x15e)]===_0x4df896(0x176))_0x16b6fe=Reflect[_0x4df896(0x15e)](_0x1ab7ea,_0x306647,_0x347510,_0x4ec4b9);else{for(var _0x109892=_0x1ab7ea['length']-0x1;_0x109892>=0x0;_0x109892--)if(_0x52907f=_0x1ab7ea[_0x109892])_0x16b6fe=(_0x4a76ac<0x3?_0x52907f(_0x16b6fe):_0x4a76ac>0x3?_0x52907f(_0x306647,_0x347510,_0x16b6fe):_0x52907f(_0x306647,_0x347510))||_0x16b6fe;}return _0x4a76ac>0x3&&_0x16b6fe&&Object[_0x4df896(0x15c)](_0x306647,_0x347510,_0x16b6fe),_0x16b6fe;},__metadata=this&&this[a108_0x608d16(0x148)]||function(_0x3ec37c,_0x5244b5){const _0x3647c6=a108_0x608d16;if(typeof Reflect===_0x3647c6(0x147)&&typeof Reflect[_0x3647c6(0x161)]===_0x3647c6(0x176))return Reflect[_0x3647c6(0x161)](_0x3ec37c,_0x5244b5);},__param=this&&this[a108_0x608d16(0x153)]||function(_0x125b2d,_0x4053a8){return function(_0x42d1d9,_0x5054fe){_0x4053a8(_0x42d1d9,_0x5054fe,_0x125b2d);};};function a108_0x582a(_0xd5e22d,_0xe70a47){const _0xe338e3=a108_0xe338();return a108_0x582a=function(_0x582a76,_0x3721b9){_0x582a76=_0x582a76-0x144;let _0x25e2c3=_0xe338e3[_0x582a76];return _0x25e2c3;},a108_0x582a(_0xd5e22d,_0xe70a47);}Object[a108_0x608d16(0x15c)](exports,a108_0x608d16(0x149),{'value':!![]}),exports[a108_0x608d16(0x146)]=void 0x0;const common_1=require(a108_0x608d16(0x168)),mongoose_1=require(a108_0x608d16(0x145)),mongoose_2=require(a108_0x608d16(0x16b)),dayjs=require(a108_0x608d16(0x187)),utils_1=require('../common/utils'),schedulePrioritySort=(_0x14f943,_0x5cc91d)=>dayjs(_0x14f943[a108_0x608d16(0x169)])[a108_0x608d16(0x17c)](dayjs(_0x5cc91d[a108_0x608d16(0x169)]))?-0x1:0x1;function a108_0xe338(){const _0x34449b=['8Ritikd','toObject','YYYY-MM-DD','16721960HrKxyb','toDate','dayjs','findAllActiveSchedules','filter','@nestjs/mongoose','ScheduleService','object','__metadata','__esModule','updatedAtUtc','sort','InjectModel','format','weekDays','find','getDay','remove','toISOString','__param','Model','create','9VBppVz','getOwnPropertyDescriptor','Injectable','206308IPZVvM','includeDates','findOne','defineProperty','getTime','decorate','map','setDate','metadata','includes','scheduleModel','events','__decorate','8889860QHDkxY','startOf','@nestjs/common','createdAtUtc','4PHnPDo','mongoose','14307858MyCZPR','exec','assign','findIndex','getDate','3033354EzhnoW','24186yuReiI','save','4669565NkZQey','update','function','length','clone','design:paramtypes','all','findAll','isAfter','findEligibleSchedule','removeOtherExistingIncludeDates','findById','addIncludeDate','uuid'];a108_0xe338=function(){return _0x34449b;};return a108_0xe338();}let ScheduleService=class ScheduleService{constructor(_0x1188ba){const _0x229cfb=a108_0x608d16;this[_0x229cfb(0x163)]=_0x1188ba;}async[a108_0x608d16(0x155)](_0x5d745c){const _0x35d4cb=a108_0x608d16,_0x516b69=new this[(_0x35d4cb(0x163))](_0x5d745c);return _0x516b69['save']();}async[a108_0x608d16(0x17b)](){const _0x5bd5b5=a108_0x608d16,_0x3b5c10=await this['scheduleModel'][_0x5bd5b5(0x14f)]()[_0x5bd5b5(0x16d)]();return _0x3b5c10;}async['findOne'](_0x357651){const _0x31a782=a108_0x608d16,_0x4446ee=await this[_0x31a782(0x163)][_0x31a782(0x17f)](_0x357651);return _0x4446ee;}async[a108_0x608d16(0x17d)](_0x388a68){const _0x1afb5a=a108_0x608d16,_0x588933=await this[_0x1afb5a(0x188)](_0x388a68),_0x1d4043=_0x588933[_0x1afb5a(0x144)](_0xc66734=>_0xc66734[_0x1afb5a(0x15a)]['length']>0x0&&_0xc66734[_0x1afb5a(0x15a)][_0x1afb5a(0x15f)](_0x2d43fb=>dayjs(_0x2d43fb)[_0x1afb5a(0x14d)]('YYYY-MM-DD'))[_0x1afb5a(0x162)](dayjs(_0x388a68)[_0x1afb5a(0x14d)](_0x1afb5a(0x184))))['sort'](schedulePrioritySort);if(_0x1d4043[_0x1afb5a(0x177)]>0x0)return _0x1d4043[0x0];const _0x32084e=_0x588933[_0x1afb5a(0x144)](_0x2f6eb6=>_0x2f6eb6[_0x1afb5a(0x14e)][_0x1afb5a(0x162)](_0x388a68[_0x1afb5a(0x150)]()))[_0x1afb5a(0x14b)](schedulePrioritySort);if(_0x32084e[_0x1afb5a(0x177)]>0x0)return _0x32084e[0x0];return null;}async[a108_0x608d16(0x188)](_0x5a1731){const _0xcc6aba=a108_0x608d16,_0x526ba7=dayjs(_0x5a1731)[_0xcc6aba(0x167)]('day')[_0xcc6aba(0x186)](),_0x5d6c56={'$and':[{'$or':[{'startDate':{'$lte':_0x5a1731},'endDate':{'$gte':_0x5a1731}},{'startDate':{'$lte':_0x5a1731},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x5a1731}}]},{'excludeDates':{'$nin':[_0x526ba7]}}]},_0x555a55=await this[_0xcc6aba(0x163)][_0xcc6aba(0x14f)](_0x5d6c56)['exec']();return _0x555a55;}async['findEligibleScheduleBetween'](_0x22595a,_0x4b5c1b){const _0x5ee7b3=a108_0x608d16,_0x2458b9=new Date(_0x22595a),_0x34cdc5={};while(_0x2458b9<=_0x4b5c1b){const _0x5ebbc6=await this[_0x5ee7b3(0x17d)](_0x2458b9);_0x5ebbc6&&(_0x34cdc5[dayjs(_0x2458b9)[_0x5ee7b3(0x14d)](_0x5ee7b3(0x184))]=_0x5ebbc6),_0x2458b9[_0x5ee7b3(0x160)](_0x2458b9[_0x5ee7b3(0x170)]()+0x1);}return _0x34cdc5;}async[a108_0x608d16(0x175)](_0x4a5909,_0x4ab16d){const _0x5ecf25=a108_0x608d16,_0x5274b5=await this['scheduleModel']['findByIdAndUpdate'](_0x4a5909,Object[_0x5ecf25(0x16e)](Object[_0x5ecf25(0x16e)]({},_0x4ab16d),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x5ecf25(0x16d)]();return _0x5274b5[_0x5ecf25(0x15a)]&&await this[_0x5ecf25(0x17e)](_0x4a5909,_0x5274b5[_0x5ecf25(0x15a)]),_0x5274b5;}async[a108_0x608d16(0x151)](_0x51a2b1){const _0x5c8caf=a108_0x608d16,_0xd27008=await this[_0x5c8caf(0x163)]['findByIdAndDelete'](_0x51a2b1)[_0x5c8caf(0x16d)]();return _0xd27008;}async[a108_0x608d16(0x180)](_0x371d95,_0x576aa1){const _0x45ac2c=a108_0x608d16,_0x59a43a=await this[_0x45ac2c(0x15b)](_0x371d95);_0x59a43a['includeDates'][_0x45ac2c(0x16f)](_0x460c77=>_0x460c77[_0x45ac2c(0x15d)]()===_0x576aa1[_0x45ac2c(0x15d)]())===-0x1&&_0x59a43a['includeDates']['push'](_0x576aa1);const _0x98d56=await _0x59a43a[_0x45ac2c(0x173)]();return await this[_0x45ac2c(0x17e)](_0x371d95,[_0x576aa1]),_0x98d56;}async[a108_0x608d16(0x17e)](_0x4c2cfd,_0x563f8b){const _0x3bdfce=a108_0x608d16,_0x1853b0=await this[_0x3bdfce(0x163)][_0x3bdfce(0x14f)]({'_id':{'$ne':_0x4c2cfd},'includeDates':{'$in':_0x563f8b}})[_0x3bdfce(0x16d)](),_0x56c0a7=_0x563f8b[_0x3bdfce(0x15f)](_0x2a6e54=>_0x2a6e54[_0x3bdfce(0x152)]());await Promise[_0x3bdfce(0x17a)](_0x1853b0[_0x3bdfce(0x15f)](_0xe03afc=>{const _0x1d29df=_0x3bdfce,_0x4cb085=_0xe03afc[_0x1d29df(0x15a)][_0x1d29df(0x144)](_0x586163=>!_0x56c0a7[_0x1d29df(0x162)](_0x586163[_0x1d29df(0x152)]()));return _0xe03afc['includeDates']=_0x4cb085,_0xe03afc[_0x1d29df(0x14a)]=new Date(),_0xe03afc['save']();}));}async[a108_0x608d16(0x178)](_0x3941e1){const _0x4154a5=a108_0x608d16,_0x4afac6=await this['findOne'](_0x3941e1),_0x1d26bb=_0x4afac6[_0x4154a5(0x164)][_0x4154a5(0x15f)](_0x251cf8=>Object[_0x4154a5(0x16e)](Object[_0x4154a5(0x16e)]({},_0x251cf8),{'id':(0x0,utils_1[_0x4154a5(0x181)])()})),_0x2b963d=new this[(_0x4154a5(0x163))](Object['assign'](Object['assign']({},_0x4afac6[_0x4154a5(0x183)]()),{'events':_0x1d26bb,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x2b963d[_0x4154a5(0x173)]();}};ScheduleService=__decorate([(0x0,common_1[a108_0x608d16(0x158)])(),__param(0x0,(0x0,mongoose_1[a108_0x608d16(0x14c)])('Schedule')),__metadata(a108_0x608d16(0x179),[mongoose_2[a108_0x608d16(0x154)]])],ScheduleService),exports[a108_0x608d16(0x146)]=ScheduleService;