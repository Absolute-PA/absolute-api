'use strict';const a108_0x4632fe=a108_0x1d8c;(function(_0x31ea78,_0x3190d4){const _0x25f94f=a108_0x1d8c,_0x42e402=_0x31ea78();while(!![]){try{const _0x5814be=-parseInt(_0x25f94f(0x1df))/0x1+parseInt(_0x25f94f(0x1db))/0x2+parseInt(_0x25f94f(0x201))/0x3*(-parseInt(_0x25f94f(0x1ee))/0x4)+-parseInt(_0x25f94f(0x1cf))/0x5*(-parseInt(_0x25f94f(0x210))/0x6)+parseInt(_0x25f94f(0x1e1))/0x7*(parseInt(_0x25f94f(0x1ed))/0x8)+parseInt(_0x25f94f(0x1e9))/0x9*(-parseInt(_0x25f94f(0x208))/0xa)+parseInt(_0x25f94f(0x1e0))/0xb*(parseInt(_0x25f94f(0x1dc))/0xc);if(_0x5814be===_0x3190d4)break;else _0x42e402['push'](_0x42e402['shift']());}catch(_0x11403c){_0x42e402['push'](_0x42e402['shift']());}}}(a108_0x4cd7,0x3d05f));var __decorate=this&&this['__decorate']||function(_0x17ac26,_0x3f84e7,_0x29c908,_0x1effb9){const _0x80ccf4=a108_0x1d8c;var _0xab7ec2=arguments['length'],_0x378caf=_0xab7ec2<0x3?_0x3f84e7:_0x1effb9===null?_0x1effb9=Object[_0x80ccf4(0x1fc)](_0x3f84e7,_0x29c908):_0x1effb9,_0x4112c5;if(typeof Reflect===_0x80ccf4(0x1d7)&&typeof Reflect[_0x80ccf4(0x202)]===_0x80ccf4(0x1e8))_0x378caf=Reflect[_0x80ccf4(0x202)](_0x17ac26,_0x3f84e7,_0x29c908,_0x1effb9);else{for(var _0x220c99=_0x17ac26['length']-0x1;_0x220c99>=0x0;_0x220c99--)if(_0x4112c5=_0x17ac26[_0x220c99])_0x378caf=(_0xab7ec2<0x3?_0x4112c5(_0x378caf):_0xab7ec2>0x3?_0x4112c5(_0x3f84e7,_0x29c908,_0x378caf):_0x4112c5(_0x3f84e7,_0x29c908))||_0x378caf;}return _0xab7ec2>0x3&&_0x378caf&&Object[_0x80ccf4(0x1fd)](_0x3f84e7,_0x29c908,_0x378caf),_0x378caf;},__metadata=this&&this[a108_0x4632fe(0x1d9)]||function(_0x24c1fb,_0xe25f9){const _0x243b21=a108_0x4632fe;if(typeof Reflect==='object'&&typeof Reflect[_0x243b21(0x203)]===_0x243b21(0x1e8))return Reflect[_0x243b21(0x203)](_0x24c1fb,_0xe25f9);},__param=this&&this[a108_0x4632fe(0x204)]||function(_0x507359,_0x596882){return function(_0xbfba1a,_0x44ae69){_0x596882(_0xbfba1a,_0x44ae69,_0x507359);};};Object[a108_0x4632fe(0x1fd)](exports,a108_0x4632fe(0x20a),{'value':!![]}),exports['ScheduleService']=void 0x0;function a108_0x1d8c(_0x40f18c,_0xb8deef){const _0x4cd7b5=a108_0x4cd7();return a108_0x1d8c=function(_0x1d8cde,_0x426227){_0x1d8cde=_0x1d8cde-0x1ce;let _0xb86dcb=_0x4cd7b5[_0x1d8cde];return _0xb86dcb;},a108_0x1d8c(_0x40f18c,_0xb8deef);}const common_1=require('@nestjs/common'),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require('mongoose'),dayjs=require(a108_0x4632fe(0x1d8)),utils_1=require(a108_0x4632fe(0x1f1)),schedulePrioritySort=(_0x5e99c7,_0x156e3a)=>dayjs(_0x5e99c7[a108_0x4632fe(0x1d3)])[a108_0x4632fe(0x1f3)](dayjs(_0x156e3a[a108_0x4632fe(0x1d3)]))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0x5bb545){const _0x23d901=a108_0x4632fe;this[_0x23d901(0x1ff)]=_0x5bb545;}async[a108_0x4632fe(0x1f7)](_0x251570){const _0x66a4c1=a108_0x4632fe,_0x5c849a=new this[(_0x66a4c1(0x1ff))](_0x251570);return _0x5c849a[_0x66a4c1(0x20d)]();}async['findAll'](){const _0x4ec351=a108_0x4632fe,_0x581917=await this['scheduleModel'][_0x4ec351(0x1ec)]()[_0x4ec351(0x1de)]();return _0x581917;}async[a108_0x4632fe(0x1e6)](_0x5ce5b4){const _0x3f9069=a108_0x4632fe,_0x123bfd=await this[_0x3f9069(0x1ff)][_0x3f9069(0x206)](_0x5ce5b4);return _0x123bfd;}async[a108_0x4632fe(0x1e5)](_0x4406d6){const _0x54fde2=a108_0x4632fe,_0xcc471a=await this[_0x54fde2(0x20e)](_0x4406d6),_0x1b4524=_0xcc471a[_0x54fde2(0x1d1)](_0xd89780=>_0xd89780[_0x54fde2(0x205)][_0x54fde2(0x20f)]>0x0&&_0xd89780[_0x54fde2(0x205)][_0x54fde2(0x20c)](_0x36fccd=>dayjs(_0x36fccd)[_0x54fde2(0x1d5)]('YYYY-MM-DD'))[_0x54fde2(0x207)](dayjs(_0x4406d6)[_0x54fde2(0x1d5)](_0x54fde2(0x1f9))))['sort'](schedulePrioritySort);if(_0x1b4524['length']>0x0)return _0x1b4524[0x0];const _0x2eebf4=_0xcc471a[_0x54fde2(0x1d1)](_0x1edaf5=>_0x1edaf5[_0x54fde2(0x1fb)][_0x54fde2(0x207)](_0x4406d6[_0x54fde2(0x1eb)]()))[_0x54fde2(0x200)](schedulePrioritySort);if(_0x2eebf4[_0x54fde2(0x20f)]>0x0)return _0x2eebf4[0x0];return null;}async['findAllActiveSchedules'](_0x1863dc){const _0x3ed4be=a108_0x4632fe,_0x2a02a1=dayjs(_0x1863dc)[_0x3ed4be(0x1e4)](_0x3ed4be(0x1f8))[_0x3ed4be(0x1ea)](),_0x52015c={'$and':[{'$or':[{'startDate':{'$lte':_0x1863dc},'endDate':{'$gte':_0x1863dc}},{'startDate':{'$lte':_0x1863dc},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x1863dc}}]},{'excludeDates':{'$nin':[_0x2a02a1]}}]},_0x57dbb8=await this[_0x3ed4be(0x1ff)]['find'](_0x52015c)[_0x3ed4be(0x1de)]();return _0x57dbb8;}async[a108_0x4632fe(0x1fe)](_0x9acf18,_0x852b5d){const _0x1273a3=a108_0x4632fe,_0x38f34f=new Date(_0x9acf18),_0x21cef6={};while(_0x38f34f<=_0x852b5d){const _0x5571dc=await this[_0x1273a3(0x1e5)](_0x38f34f);_0x5571dc&&(_0x21cef6[dayjs(_0x38f34f)[_0x1273a3(0x1d5)]('YYYY-MM-DD')]=_0x5571dc),_0x38f34f[_0x1273a3(0x1dd)](_0x38f34f['getDate']()+0x1);}return _0x21cef6;}async[a108_0x4632fe(0x1ef)](_0x420bb8,_0x53ca5e){const _0x41f864=a108_0x4632fe,_0x3fe4b5=await this['scheduleModel']['findByIdAndUpdate'](_0x420bb8,Object[_0x41f864(0x1d6)](Object[_0x41f864(0x1d6)]({},_0x53ca5e),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x41f864(0x1de)]();return _0x3fe4b5[_0x41f864(0x205)]&&await this[_0x41f864(0x1f2)](_0x420bb8,_0x3fe4b5[_0x41f864(0x205)]),_0x3fe4b5;}async[a108_0x4632fe(0x1fa)](_0xbe5c64){const _0x585268=a108_0x4632fe,_0x59954d=await this[_0x585268(0x1ff)]['findByIdAndDelete'](_0xbe5c64)[_0x585268(0x1de)]();return _0x59954d;}async[a108_0x4632fe(0x1d2)](_0x5e4f1f,_0x202042){const _0x505629=a108_0x4632fe,_0x50f17d=await this[_0x505629(0x1e6)](_0x5e4f1f);_0x50f17d[_0x505629(0x205)]['findIndex'](_0x25da57=>_0x25da57[_0x505629(0x20b)]()===_0x202042[_0x505629(0x20b)]())===-0x1&&_0x50f17d[_0x505629(0x205)][_0x505629(0x1da)](_0x202042);const _0xa4211b=await _0x50f17d[_0x505629(0x20d)]();return await this['removeOtherExistingIncludeDates'](_0x5e4f1f,[_0x202042]),_0xa4211b;}async['removeOtherExistingIncludeDates'](_0x4a72bc,_0x5d53a7){const _0x3fac6d=a108_0x4632fe,_0x512472=await this[_0x3fac6d(0x1ff)][_0x3fac6d(0x1ec)]({'_id':{'$ne':_0x4a72bc},'includeDates':{'$in':_0x5d53a7}})[_0x3fac6d(0x1de)](),_0x510025=_0x5d53a7[_0x3fac6d(0x20c)](_0x2cf209=>_0x2cf209[_0x3fac6d(0x1d4)]());await Promise[_0x3fac6d(0x1d0)](_0x512472[_0x3fac6d(0x20c)](_0xc6883d=>{const _0x51a926=_0x3fac6d,_0x35ac3e=_0xc6883d[_0x51a926(0x205)][_0x51a926(0x1d1)](_0x272471=>!_0x510025[_0x51a926(0x207)](_0x272471[_0x51a926(0x1d4)]()));return _0xc6883d['includeDates']=_0x35ac3e,_0xc6883d[_0x51a926(0x1e3)]=new Date(),_0xc6883d['save']();}));}async[a108_0x4632fe(0x211)](_0xd0e37d){const _0x37ebdd=a108_0x4632fe,_0x14dc33=await this[_0x37ebdd(0x1e6)](_0xd0e37d),_0xceb41d=_0x14dc33[_0x37ebdd(0x1f5)][_0x37ebdd(0x20c)](_0x262033=>Object['assign'](Object[_0x37ebdd(0x1d6)]({},_0x262033),{'id':(0x0,utils_1[_0x37ebdd(0x1f0)])()})),_0x188054=new this[(_0x37ebdd(0x1ff))](Object[_0x37ebdd(0x1d6)](Object[_0x37ebdd(0x1d6)]({},_0x14dc33['toObject']()),{'events':_0xceb41d,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x188054[_0x37ebdd(0x20d)]();}};ScheduleService=__decorate([(0x0,common_1[a108_0x4632fe(0x1f4)])(),__param(0x0,(0x0,mongoose_1[a108_0x4632fe(0x1ce)])(a108_0x4632fe(0x1e7))),__metadata(a108_0x4632fe(0x1f6),[mongoose_2[a108_0x4632fe(0x209)]])],ScheduleService),exports[a108_0x4632fe(0x1e2)]=ScheduleService;function a108_0x4cd7(){const _0xb17c3e=['updatedAtUtc','startOf','findEligibleSchedule','findOne','Schedule','function','567pAYdzF','toDate','getDay','find','424fhaLhz','2260ceQYVp','update','uuid','../common/utils','removeOtherExistingIncludeDates','isAfter','Injectable','events','design:paramtypes','create','day','YYYY-MM-DD','remove','weekDays','getOwnPropertyDescriptor','defineProperty','findEligibleScheduleBetween','scheduleModel','sort','150ZXihAD','decorate','metadata','__param','includeDates','findById','includes','4630qoISSP','Model','__esModule','getTime','map','save','findAllActiveSchedules','length','170022cJyANu','clone','InjectModel','15EDnHOx','all','filter','addIncludeDate','createdAtUtc','toISOString','format','assign','object','dayjs','__metadata','push','637132QtvAaY','132PkwIrv','setDate','exec','480494YBqcnw','347611jUMhrB','4844HBHyfo','ScheduleService'];a108_0x4cd7=function(){return _0xb17c3e;};return a108_0x4cd7();}