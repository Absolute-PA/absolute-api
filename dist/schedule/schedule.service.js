'use strict';const a111_0x358f90=a111_0x1c7d;(function(_0x2530f6,_0x9340e5){const _0x410d2b=a111_0x1c7d,_0x5bb4cd=_0x2530f6();while(!![]){try{const _0x2998f8=-parseInt(_0x410d2b(0x169))/0x1*(parseInt(_0x410d2b(0x1ab))/0x2)+parseInt(_0x410d2b(0x193))/0x3+parseInt(_0x410d2b(0x183))/0x4+parseInt(_0x410d2b(0x1a3))/0x5*(-parseInt(_0x410d2b(0x184))/0x6)+parseInt(_0x410d2b(0x1a7))/0x7*(parseInt(_0x410d2b(0x195))/0x8)+-parseInt(_0x410d2b(0x170))/0x9*(parseInt(_0x410d2b(0x197))/0xa)+parseInt(_0x410d2b(0x194))/0xb*(parseInt(_0x410d2b(0x1a9))/0xc);if(_0x2998f8===_0x9340e5)break;else _0x5bb4cd['push'](_0x5bb4cd['shift']());}catch(_0x5cf2ca){_0x5bb4cd['push'](_0x5bb4cd['shift']());}}}(a111_0xe1e5,0x9eedf));var __decorate=this&&this['__decorate']||function(_0xbdf602,_0x50d403,_0x280c40,_0x2ee614){const _0xf7f19d=a111_0x1c7d;var _0x1ef6a3=arguments[_0xf7f19d(0x180)],_0x4f5bb1=_0x1ef6a3<0x3?_0x50d403:_0x2ee614===null?_0x2ee614=Object[_0xf7f19d(0x17d)](_0x50d403,_0x280c40):_0x2ee614,_0x5a645c;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0xf7f19d(0x173))_0x4f5bb1=Reflect['decorate'](_0xbdf602,_0x50d403,_0x280c40,_0x2ee614);else{for(var _0x2649b8=_0xbdf602[_0xf7f19d(0x180)]-0x1;_0x2649b8>=0x0;_0x2649b8--)if(_0x5a645c=_0xbdf602[_0x2649b8])_0x4f5bb1=(_0x1ef6a3<0x3?_0x5a645c(_0x4f5bb1):_0x1ef6a3>0x3?_0x5a645c(_0x50d403,_0x280c40,_0x4f5bb1):_0x5a645c(_0x50d403,_0x280c40))||_0x4f5bb1;}return _0x1ef6a3>0x3&&_0x4f5bb1&&Object[_0xf7f19d(0x1a2)](_0x50d403,_0x280c40,_0x4f5bb1),_0x4f5bb1;},__metadata=this&&this[a111_0x358f90(0x176)]||function(_0x127280,_0x4251d2){const _0x3b4ba6=a111_0x358f90;if(typeof Reflect==='object'&&typeof Reflect[_0x3b4ba6(0x182)]===_0x3b4ba6(0x173))return Reflect[_0x3b4ba6(0x182)](_0x127280,_0x4251d2);},__param=this&&this['__param']||function(_0x3baa88,_0x8983cf){return function(_0x4f0182,_0x20af87){_0x8983cf(_0x4f0182,_0x20af87,_0x3baa88);};};Object[a111_0x358f90(0x1a2)](exports,a111_0x358f90(0x16d),{'value':!![]}),exports[a111_0x358f90(0x19e)]=void 0x0;function a111_0xe1e5(){const _0x240c59=['findAll','ScheduleService','assign','day','findByIdAndDelete','defineProperty','20hGsWYS','@nestjs/common','getDate','Schedule','42pljpzO','mongoose','3048gkObSK','toObject','34078NSgaDI','toDate','11zMGdXW','push','design:paramtypes','findEligibleSchedule','__esModule','uuid','findByIdAndUpdate','9pjSfXv','Model','../common/utils','function','format','findIndex','__metadata','addIncludeDate','update','findAllActiveSchedules','createdAtUtc','scheduleModel','exec','getOwnPropertyDescriptor','toISOString','create','length','updatedAtUtc','metadata','1493012Qnvyeq','317886cItmvm','getDay','filter','YYYY-MM-DD','removeOtherExistingIncludeDates','includes','isAfter','findById','sort','findEligibleScheduleBetween','setDate','findOne','@nestjs/mongoose','includeDates','dayjs','2073594lXptiF','26125msHsSP','541336CCVshX','find','10233750glXOPH','remove','save','all','startOf','map'];a111_0xe1e5=function(){return _0x240c59;};return a111_0xe1e5();}function a111_0x1c7d(_0x2715c2,_0x4e948c){const _0xe1e5d6=a111_0xe1e5();return a111_0x1c7d=function(_0x1c7d0b,_0x233552){_0x1c7d0b=_0x1c7d0b-0x168;let _0x39eb52=_0xe1e5d6[_0x1c7d0b];return _0x39eb52;},a111_0x1c7d(_0x2715c2,_0x4e948c);}const common_1=require(a111_0x358f90(0x1a4)),mongoose_1=require(a111_0x358f90(0x190)),mongoose_2=require(a111_0x358f90(0x1a8)),dayjs=require(a111_0x358f90(0x192)),utils_1=require(a111_0x358f90(0x172)),schedulePrioritySort=(_0x557505,_0xdb37a1)=>dayjs(_0x557505[a111_0x358f90(0x17a)])[a111_0x358f90(0x18a)](dayjs(_0xdb37a1['createdAtUtc']))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0x2e93b5){this['scheduleModel']=_0x2e93b5;}async[a111_0x358f90(0x17f)](_0x4b85f5){const _0x4ff768=a111_0x358f90,_0x25bc99=new this[(_0x4ff768(0x17b))](_0x4b85f5);return _0x25bc99[_0x4ff768(0x199)]();}async[a111_0x358f90(0x19d)](){const _0x14f18a=a111_0x358f90,_0x1a8381=await this[_0x14f18a(0x17b)][_0x14f18a(0x196)]()['exec']();return _0x1a8381;}async[a111_0x358f90(0x18f)](_0x404783){const _0x3df883=a111_0x358f90,_0x31f61d=await this['scheduleModel'][_0x3df883(0x18b)](_0x404783);return _0x31f61d;}async[a111_0x358f90(0x16c)](_0x389feb){const _0x405a46=a111_0x358f90,_0x5d633d=await this[_0x405a46(0x179)](_0x389feb),_0x2c8581=_0x5d633d[_0x405a46(0x186)](_0xda6022=>_0xda6022[_0x405a46(0x191)][_0x405a46(0x180)]>0x0&&_0xda6022[_0x405a46(0x191)]['map'](_0x5ec208=>dayjs(_0x5ec208)['format']('YYYY-MM-DD'))['includes'](dayjs(_0x389feb)[_0x405a46(0x174)](_0x405a46(0x187))))[_0x405a46(0x18c)](schedulePrioritySort);if(_0x2c8581['length']>0x0)return _0x2c8581[0x0];const _0x5a0bb0=_0x5d633d['filter'](_0x1d28f5=>_0x1d28f5['weekDays'][_0x405a46(0x189)](_0x389feb[_0x405a46(0x185)]()))['sort'](schedulePrioritySort);if(_0x5a0bb0['length']>0x0)return _0x5a0bb0[0x0];return null;}async[a111_0x358f90(0x179)](_0x401d65){const _0xbc2ee3=a111_0x358f90,_0x4383ef=dayjs(_0x401d65)[_0xbc2ee3(0x19b)](_0xbc2ee3(0x1a0))[_0xbc2ee3(0x168)](),_0x15e3cd={'$and':[{'$or':[{'startDate':{'$lte':_0x401d65},'endDate':{'$gte':_0x401d65}},{'startDate':{'$lte':_0x401d65},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x401d65}}]},{'excludeDates':{'$nin':[_0x4383ef]}}]},_0x388226=await this[_0xbc2ee3(0x17b)][_0xbc2ee3(0x196)](_0x15e3cd)['exec']();return _0x388226;}async[a111_0x358f90(0x18d)](_0x427a3a,_0x2f5938){const _0x13aa03=a111_0x358f90,_0x385809=new Date(_0x427a3a),_0x445c65={};while(_0x385809<=_0x2f5938){const _0x50c29a=await this[_0x13aa03(0x16c)](_0x385809);_0x50c29a&&(_0x445c65[dayjs(_0x385809)[_0x13aa03(0x174)](_0x13aa03(0x187))]=_0x50c29a),_0x385809[_0x13aa03(0x18e)](_0x385809[_0x13aa03(0x1a5)]()+0x1);}return _0x445c65;}async[a111_0x358f90(0x178)](_0x2183ec,_0x1ea377){const _0x18b4b6=a111_0x358f90,_0x754145=await this[_0x18b4b6(0x17b)][_0x18b4b6(0x16f)](_0x2183ec,Object[_0x18b4b6(0x19f)](Object['assign']({},_0x1ea377),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x18b4b6(0x17c)]();return _0x754145[_0x18b4b6(0x191)]&&await this['removeOtherExistingIncludeDates'](_0x2183ec,_0x754145[_0x18b4b6(0x191)]),_0x754145;}async[a111_0x358f90(0x198)](_0x481f53){const _0x1dcb02=a111_0x358f90,_0x49c2e5=await this[_0x1dcb02(0x17b)][_0x1dcb02(0x1a1)](_0x481f53)[_0x1dcb02(0x17c)]();return _0x49c2e5;}async[a111_0x358f90(0x177)](_0x46211c,_0x186fc5){const _0x197867=a111_0x358f90,_0x1c8b59=await this[_0x197867(0x18f)](_0x46211c);_0x1c8b59[_0x197867(0x191)][_0x197867(0x175)](_0x4e7a5c=>_0x4e7a5c['getTime']()===_0x186fc5['getTime']())===-0x1&&_0x1c8b59[_0x197867(0x191)][_0x197867(0x16a)](_0x186fc5);const _0x56bf49=await _0x1c8b59[_0x197867(0x199)]();return await this[_0x197867(0x188)](_0x46211c,[_0x186fc5]),_0x56bf49;}async['removeOtherExistingIncludeDates'](_0xb36e4e,_0x5384eb){const _0x3b1252=a111_0x358f90,_0x564b50=await this[_0x3b1252(0x17b)][_0x3b1252(0x196)]({'_id':{'$ne':_0xb36e4e},'includeDates':{'$in':_0x5384eb}})[_0x3b1252(0x17c)](),_0x1c1250=_0x5384eb[_0x3b1252(0x19c)](_0x48b01c=>_0x48b01c[_0x3b1252(0x17e)]());await Promise[_0x3b1252(0x19a)](_0x564b50[_0x3b1252(0x19c)](_0x34e61d=>{const _0x3bab2d=_0x3b1252,_0x483696=_0x34e61d[_0x3bab2d(0x191)][_0x3bab2d(0x186)](_0x15de6e=>!_0x1c1250[_0x3bab2d(0x189)](_0x15de6e[_0x3bab2d(0x17e)]()));return _0x34e61d[_0x3bab2d(0x191)]=_0x483696,_0x34e61d[_0x3bab2d(0x181)]=new Date(),_0x34e61d[_0x3bab2d(0x199)]();}));}async['clone'](_0x1a5d3b){const _0x4144d0=a111_0x358f90,_0x3a6f9e=await this[_0x4144d0(0x18f)](_0x1a5d3b),_0xfd223f=_0x3a6f9e['events']['map'](_0x5cce7e=>Object[_0x4144d0(0x19f)](Object[_0x4144d0(0x19f)]({},_0x5cce7e),{'id':(0x0,utils_1[_0x4144d0(0x16e)])()})),_0x3f935d=new this[(_0x4144d0(0x17b))](Object[_0x4144d0(0x19f)](Object[_0x4144d0(0x19f)]({},_0x3a6f9e[_0x4144d0(0x1aa)]()),{'events':_0xfd223f,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x3f935d['save']();}};ScheduleService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_1['InjectModel'])(a111_0x358f90(0x1a6))),__metadata(a111_0x358f90(0x16b),[mongoose_2[a111_0x358f90(0x171)]])],ScheduleService),exports[a111_0x358f90(0x19e)]=ScheduleService;