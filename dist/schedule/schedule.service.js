'use strict';const a111_0x9ba769=a111_0x3c03;(function(_0x5f2ecb,_0x4fa054){const _0x283ebe=a111_0x3c03,_0x4de55d=_0x5f2ecb();while(!![]){try{const _0x30b02a=parseInt(_0x283ebe(0x131))/0x1+parseInt(_0x283ebe(0x10f))/0x2*(-parseInt(_0x283ebe(0x12d))/0x3)+-parseInt(_0x283ebe(0x128))/0x4+parseInt(_0x283ebe(0x10c))/0x5*(-parseInt(_0x283ebe(0x120))/0x6)+parseInt(_0x283ebe(0x126))/0x7*(-parseInt(_0x283ebe(0x123))/0x8)+-parseInt(_0x283ebe(0x113))/0x9+parseInt(_0x283ebe(0xfd))/0xa*(parseInt(_0x283ebe(0xfc))/0xb);if(_0x30b02a===_0x4fa054)break;else _0x4de55d['push'](_0x4de55d['shift']());}catch(_0x3259c7){_0x4de55d['push'](_0x4de55d['shift']());}}}(a111_0x3da1,0x315e4));var __decorate=this&&this[a111_0x9ba769(0x118)]||function(_0x51279d,_0x2f6287,_0x4fda3a,_0x187884){const _0x3a3d91=a111_0x9ba769;var _0x58c546=arguments[_0x3a3d91(0x134)],_0x44f95e=_0x58c546<0x3?_0x2f6287:_0x187884===null?_0x187884=Object[_0x3a3d91(0x122)](_0x2f6287,_0x4fda3a):_0x187884,_0x16ab3d;if(typeof Reflect===_0x3a3d91(0x103)&&typeof Reflect['decorate']===_0x3a3d91(0x12a))_0x44f95e=Reflect[_0x3a3d91(0x104)](_0x51279d,_0x2f6287,_0x4fda3a,_0x187884);else{for(var _0x182ea1=_0x51279d[_0x3a3d91(0x134)]-0x1;_0x182ea1>=0x0;_0x182ea1--)if(_0x16ab3d=_0x51279d[_0x182ea1])_0x44f95e=(_0x58c546<0x3?_0x16ab3d(_0x44f95e):_0x58c546>0x3?_0x16ab3d(_0x2f6287,_0x4fda3a,_0x44f95e):_0x16ab3d(_0x2f6287,_0x4fda3a))||_0x44f95e;}return _0x58c546>0x3&&_0x44f95e&&Object[_0x3a3d91(0x109)](_0x2f6287,_0x4fda3a,_0x44f95e),_0x44f95e;},__metadata=this&&this[a111_0x9ba769(0x127)]||function(_0x50dc98,_0x3a86f4){const _0xf3b86c=a111_0x9ba769;if(typeof Reflect==='object'&&typeof Reflect['metadata']==='function')return Reflect[_0xf3b86c(0x129)](_0x50dc98,_0x3a86f4);},__param=this&&this[a111_0x9ba769(0x102)]||function(_0x19ed18,_0x2a1ca8){return function(_0x51b14d,_0x4a14ea){_0x2a1ca8(_0x51b14d,_0x4a14ea,_0x19ed18);};};Object[a111_0x9ba769(0x109)](exports,a111_0x9ba769(0x107),{'value':!![]}),exports[a111_0x9ba769(0x108)]=void 0x0;function a111_0x3c03(_0x2a8efe,_0x524153){const _0x3da1a1=a111_0x3da1();return a111_0x3c03=function(_0x3c035a,_0x14ec35){_0x3c035a=_0x3c035a-0xf2;let _0x2c26d7=_0x3da1a1[_0x3c035a];return _0x2c26d7;},a111_0x3c03(_0x2a8efe,_0x524153);}const common_1=require('@nestjs/common'),mongoose_1=require(a111_0x9ba769(0x121)),mongoose_2=require(a111_0x9ba769(0x10b)),dayjs=require(a111_0x9ba769(0x115)),utils_1=require('../common/utils'),schedulePrioritySort=(_0x4dc400,_0x22b8e1)=>dayjs(_0x4dc400[a111_0x9ba769(0x10a)])[a111_0x9ba769(0x10d)](dayjs(_0x22b8e1[a111_0x9ba769(0x10a)]))?-0x1:0x1;function a111_0x3da1(){const _0x19c2e8=['setDate','findByIdAndDelete','getDay','removeOtherExistingIncludeDates','design:paramtypes','getTime','assign','101916yMQfXX','@nestjs/mongoose','getOwnPropertyDescriptor','37744OHWNcU','create','save','7dpmOwz','__metadata','133228wJHZtr','metadata','function','findEligibleSchedule','findAllActiveSchedules','429612RnEWfv','Schedule','addIncludeDate','format','40964NxZxic','findEligibleScheduleBetween','push','length','filter','toISOString','updatedAtUtc','exec','clone','scheduleModel','map','find','includeDates','Injectable','194876YjFaEK','470bGxbOz','getDate','findAll','InjectModel','toDate','__param','object','decorate','findByIdAndUpdate','weekDays','__esModule','ScheduleService','defineProperty','createdAtUtc','mongoose','110jIYEcn','isAfter','sort','2KbnVuL','findOne','uuid','YYYY-MM-DD','1048347yWKdNR','includes','dayjs','events','update','__decorate'];a111_0x3da1=function(){return _0x19c2e8;};return a111_0x3da1();}let ScheduleService=class ScheduleService{constructor(_0x22d704){const _0x19b0ac=a111_0x9ba769;this[_0x19b0ac(0xf7)]=_0x22d704;}async[a111_0x9ba769(0x124)](_0x1643bb){const _0x340607=a111_0x9ba769,_0x17654c=new this[(_0x340607(0xf7))](_0x1643bb);return _0x17654c[_0x340607(0x125)]();}async[a111_0x9ba769(0xff)](){const _0x379760=a111_0x9ba769,_0x4c3ec8=await this['scheduleModel'][_0x379760(0xf9)]()['exec']();return _0x4c3ec8;}async['findOne'](_0x429015){const _0x5115f9=a111_0x9ba769,_0x2b30c7=await this[_0x5115f9(0xf7)]['findById'](_0x429015);return _0x2b30c7;}async[a111_0x9ba769(0x12b)](_0x25420f){const _0x1245ce=a111_0x9ba769,_0x489f65=await this['findAllActiveSchedules'](_0x25420f),_0x554d77=_0x489f65[_0x1245ce(0xf2)](_0x3dbe18=>_0x3dbe18[_0x1245ce(0xfa)][_0x1245ce(0x134)]>0x0&&_0x3dbe18[_0x1245ce(0xfa)][_0x1245ce(0xf8)](_0x40f3a0=>dayjs(_0x40f3a0)[_0x1245ce(0x130)](_0x1245ce(0x112)))[_0x1245ce(0x114)](dayjs(_0x25420f)[_0x1245ce(0x130)](_0x1245ce(0x112))))[_0x1245ce(0x10e)](schedulePrioritySort);if(_0x554d77[_0x1245ce(0x134)]>0x0)return _0x554d77[0x0];const _0x21f233=_0x489f65['filter'](_0x3630e8=>_0x3630e8[_0x1245ce(0x106)][_0x1245ce(0x114)](_0x25420f[_0x1245ce(0x11b)]()))['sort'](schedulePrioritySort);if(_0x21f233[_0x1245ce(0x134)]>0x0)return _0x21f233[0x0];return null;}async[a111_0x9ba769(0x12c)](_0x41499a){const _0x3c07bd=a111_0x9ba769,_0x3eeb98=dayjs(_0x41499a)['startOf']('day')[_0x3c07bd(0x101)](),_0x24524e={'$and':[{'$or':[{'startDate':{'$lte':_0x41499a},'endDate':{'$gte':_0x41499a}},{'startDate':{'$lte':_0x41499a},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x41499a}}]},{'excludeDates':{'$nin':[_0x3eeb98]}}]},_0x62fbc=await this[_0x3c07bd(0xf7)][_0x3c07bd(0xf9)](_0x24524e)[_0x3c07bd(0xf5)]();return _0x62fbc;}async[a111_0x9ba769(0x132)](_0xda302d,_0x434b94){const _0x3c0322=a111_0x9ba769,_0x32ded7=new Date(_0xda302d),_0x1b229e={};while(_0x32ded7<=_0x434b94){const _0x240926=await this[_0x3c0322(0x12b)](_0x32ded7);_0x240926&&(_0x1b229e[dayjs(_0x32ded7)[_0x3c0322(0x130)](_0x3c0322(0x112))]=_0x240926),_0x32ded7[_0x3c0322(0x119)](_0x32ded7[_0x3c0322(0xfe)]()+0x1);}return _0x1b229e;}async[a111_0x9ba769(0x117)](_0x52b8ad,_0x38e8dd){const _0xac1046=a111_0x9ba769,_0x51b716=await this[_0xac1046(0xf7)][_0xac1046(0x105)](_0x52b8ad,Object[_0xac1046(0x11f)](Object[_0xac1046(0x11f)]({},_0x38e8dd),{'updatedAtUtc':new Date()}),{'new':!![]})[_0xac1046(0xf5)]();return _0x51b716[_0xac1046(0xfa)]&&await this[_0xac1046(0x11c)](_0x52b8ad,_0x51b716[_0xac1046(0xfa)]),_0x51b716;}async['remove'](_0x44ec8d){const _0x5c22af=a111_0x9ba769,_0x57581c=await this[_0x5c22af(0xf7)][_0x5c22af(0x11a)](_0x44ec8d)[_0x5c22af(0xf5)]();return _0x57581c;}async[a111_0x9ba769(0x12f)](_0x1c8896,_0x3bdd6d){const _0x44912a=a111_0x9ba769,_0xd4cb15=await this[_0x44912a(0x110)](_0x1c8896);_0xd4cb15[_0x44912a(0xfa)]['findIndex'](_0x14be8f=>_0x14be8f[_0x44912a(0x11e)]()===_0x3bdd6d['getTime']())===-0x1&&_0xd4cb15[_0x44912a(0xfa)][_0x44912a(0x133)](_0x3bdd6d);const _0x3aac78=await _0xd4cb15[_0x44912a(0x125)]();return await this[_0x44912a(0x11c)](_0x1c8896,[_0x3bdd6d]),_0x3aac78;}async[a111_0x9ba769(0x11c)](_0x4257de,_0x3f7051){const _0x164e57=a111_0x9ba769,_0x38b83c=await this['scheduleModel']['find']({'_id':{'$ne':_0x4257de},'includeDates':{'$in':_0x3f7051}})['exec'](),_0x4bbf39=_0x3f7051[_0x164e57(0xf8)](_0x31f7aa=>_0x31f7aa['toISOString']());await Promise['all'](_0x38b83c[_0x164e57(0xf8)](_0x3e92eb=>{const _0x40df35=_0x164e57,_0x19c38d=_0x3e92eb[_0x40df35(0xfa)][_0x40df35(0xf2)](_0x49035a=>!_0x4bbf39[_0x40df35(0x114)](_0x49035a[_0x40df35(0xf3)]()));return _0x3e92eb['includeDates']=_0x19c38d,_0x3e92eb[_0x40df35(0xf4)]=new Date(),_0x3e92eb[_0x40df35(0x125)]();}));}async[a111_0x9ba769(0xf6)](_0x4dceb5){const _0x13ce04=a111_0x9ba769,_0x4df903=await this[_0x13ce04(0x110)](_0x4dceb5),_0x1de81d=_0x4df903[_0x13ce04(0x116)]['map'](_0x4ee5b7=>Object['assign'](Object[_0x13ce04(0x11f)]({},_0x4ee5b7),{'id':(0x0,utils_1[_0x13ce04(0x111)])()})),_0x1094fe=new this[(_0x13ce04(0xf7))](Object[_0x13ce04(0x11f)](Object[_0x13ce04(0x11f)]({},_0x4df903['toObject']()),{'events':_0x1de81d,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x1094fe[_0x13ce04(0x125)]();}};ScheduleService=__decorate([(0x0,common_1[a111_0x9ba769(0xfb)])(),__param(0x0,(0x0,mongoose_1[a111_0x9ba769(0x100)])(a111_0x9ba769(0x12e))),__metadata(a111_0x9ba769(0x11d),[mongoose_2['Model']])],ScheduleService),exports[a111_0x9ba769(0x108)]=ScheduleService;