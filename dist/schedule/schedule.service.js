'use strict';const a108_0x53af52=a108_0x1edc;(function(_0x4867b8,_0x2117fc){const _0x1fa9fe=a108_0x1edc,_0x1cb125=_0x4867b8();while(!![]){try{const _0x5ce61d=parseInt(_0x1fa9fe(0xad))/0x1*(-parseInt(_0x1fa9fe(0x8e))/0x2)+-parseInt(_0x1fa9fe(0xa3))/0x3*(-parseInt(_0x1fa9fe(0xb3))/0x4)+parseInt(_0x1fa9fe(0x9f))/0x5+parseInt(_0x1fa9fe(0xa8))/0x6*(parseInt(_0x1fa9fe(0x7e))/0x7)+-parseInt(_0x1fa9fe(0xa4))/0x8*(-parseInt(_0x1fa9fe(0xae))/0x9)+-parseInt(_0x1fa9fe(0x95))/0xa*(parseInt(_0x1fa9fe(0x80))/0xb)+-parseInt(_0x1fa9fe(0xa9))/0xc;if(_0x5ce61d===_0x2117fc)break;else _0x1cb125['push'](_0x1cb125['shift']());}catch(_0x967de6){_0x1cb125['push'](_0x1cb125['shift']());}}}(a108_0x556f,0xbff58));var __decorate=this&&this[a108_0x53af52(0x7b)]||function(_0x479e40,_0x7d581c,_0x496a5e,_0x12f947){const _0x29c013=a108_0x53af52;var _0x4fa6e0=arguments['length'],_0x432b21=_0x4fa6e0<0x3?_0x7d581c:_0x12f947===null?_0x12f947=Object[_0x29c013(0x93)](_0x7d581c,_0x496a5e):_0x12f947,_0x28256b;if(typeof Reflect===_0x29c013(0xa1)&&typeof Reflect['decorate']==='function')_0x432b21=Reflect[_0x29c013(0xab)](_0x479e40,_0x7d581c,_0x496a5e,_0x12f947);else{for(var _0x51922e=_0x479e40['length']-0x1;_0x51922e>=0x0;_0x51922e--)if(_0x28256b=_0x479e40[_0x51922e])_0x432b21=(_0x4fa6e0<0x3?_0x28256b(_0x432b21):_0x4fa6e0>0x3?_0x28256b(_0x7d581c,_0x496a5e,_0x432b21):_0x28256b(_0x7d581c,_0x496a5e))||_0x432b21;}return _0x4fa6e0>0x3&&_0x432b21&&Object['defineProperty'](_0x7d581c,_0x496a5e,_0x432b21),_0x432b21;},__metadata=this&&this[a108_0x53af52(0xac)]||function(_0x261ec9,_0x552589){const _0x3a8088=a108_0x53af52;if(typeof Reflect===_0x3a8088(0xa1)&&typeof Reflect[_0x3a8088(0xa7)]===_0x3a8088(0x7a))return Reflect['metadata'](_0x261ec9,_0x552589);},__param=this&&this[a108_0x53af52(0xb5)]||function(_0x38465a,_0x7e3c){return function(_0x419741,_0x2b9c35){_0x7e3c(_0x419741,_0x2b9c35,_0x38465a);};};function a108_0x556f(){const _0x1c5db4=['getDay','12560abmwOH','remove','../common/utils','defineProperty','findEligibleScheduleBetween','day','toISOString','findEligibleSchedule','Schedule','removeOtherExistingIncludeDates','4011120CqdAWS','findOne','object','startOf','309ppjaRo','184AAsQsM','save','clone','metadata','19518OSMSff','7865160Wdmszv','getDate','decorate','__metadata','894cYayKq','414837Cbthhg','findAll','findById','updatedAtUtc','ScheduleService','22972IyPUTU','toDate','__param','createdAtUtc','assign','scheduleModel','InjectModel','includes','includeDates','design:paramtypes','findAllActiveSchedules','addIncludeDate','format','function','__decorate','sort','push','546fytsKk','filter','10351hOygBs','setDate','weekDays','length','find','getTime','map','findByIdAndDelete','create','Injectable','update','exec','YYYY-MM-DD','findByIdAndUpdate','188zxAyRf','events','@nestjs/mongoose','__esModule','@nestjs/common','getOwnPropertyDescriptor'];a108_0x556f=function(){return _0x1c5db4;};return a108_0x556f();}Object[a108_0x53af52(0x98)](exports,a108_0x53af52(0x91),{'value':!![]}),exports[a108_0x53af52(0xb2)]=void 0x0;const common_1=require(a108_0x53af52(0x92)),mongoose_1=require(a108_0x53af52(0x90)),mongoose_2=require('mongoose'),dayjs=require('dayjs'),utils_1=require(a108_0x53af52(0x97)),schedulePrioritySort=(_0x104a33,_0x5a1545)=>dayjs(_0x104a33[a108_0x53af52(0xb6)])['isAfter'](dayjs(_0x5a1545[a108_0x53af52(0xb6)]))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0x36647d){const _0x1b8d5c=a108_0x53af52;this[_0x1b8d5c(0xb8)]=_0x36647d;}async[a108_0x53af52(0x88)](_0x358365){const _0x4ea00a=a108_0x53af52,_0x445e39=new this[(_0x4ea00a(0xb8))](_0x358365);return _0x445e39[_0x4ea00a(0xa5)]();}async[a108_0x53af52(0xaf)](){const _0x1c6f99=a108_0x53af52,_0x4f7dce=await this['scheduleModel'][_0x1c6f99(0x84)]()[_0x1c6f99(0x8b)]();return _0x4f7dce;}async[a108_0x53af52(0xa0)](_0xec3eed){const _0x411c47=a108_0x53af52,_0x5dd24c=await this[_0x411c47(0xb8)][_0x411c47(0xb0)](_0xec3eed);return _0x5dd24c;}async[a108_0x53af52(0x9c)](_0x54d7f6){const _0x2a225d=a108_0x53af52,_0x8457f1=await this[_0x2a225d(0x77)](_0x54d7f6),_0x3092f1=_0x8457f1['filter'](_0x3776d4=>_0x3776d4[_0x2a225d(0xbb)][_0x2a225d(0x83)]>0x0&&_0x3776d4[_0x2a225d(0xbb)][_0x2a225d(0x86)](_0x3b4495=>dayjs(_0x3b4495)[_0x2a225d(0x79)](_0x2a225d(0x8c)))[_0x2a225d(0xba)](dayjs(_0x54d7f6)['format'](_0x2a225d(0x8c))))['sort'](schedulePrioritySort);if(_0x3092f1[_0x2a225d(0x83)]>0x0)return _0x3092f1[0x0];const _0x1bd5e8=_0x8457f1[_0x2a225d(0x7f)](_0x1f1282=>_0x1f1282[_0x2a225d(0x82)][_0x2a225d(0xba)](_0x54d7f6[_0x2a225d(0x94)]()))[_0x2a225d(0x7c)](schedulePrioritySort);if(_0x1bd5e8[_0x2a225d(0x83)]>0x0)return _0x1bd5e8[0x0];return null;}async[a108_0x53af52(0x77)](_0xb1630d){const _0x87cc90=a108_0x53af52,_0x46d8a5=dayjs(_0xb1630d)[_0x87cc90(0xa2)](_0x87cc90(0x9a))[_0x87cc90(0xb4)](),_0x45e966={'$and':[{'$or':[{'startDate':{'$lte':_0xb1630d},'endDate':{'$gte':_0xb1630d}},{'startDate':{'$lte':_0xb1630d},'endDate':null},{'startDate':null,'endDate':{'$gte':_0xb1630d}}]},{'excludeDates':{'$nin':[_0x46d8a5]}}]},_0x1cdfed=await this[_0x87cc90(0xb8)][_0x87cc90(0x84)](_0x45e966)[_0x87cc90(0x8b)]();return _0x1cdfed;}async[a108_0x53af52(0x99)](_0x4ab7cd,_0x5ad522){const _0x295641=a108_0x53af52,_0x48c5f9=new Date(_0x4ab7cd),_0x3a81c8={};while(_0x48c5f9<=_0x5ad522){const _0x4c8f33=await this['findEligibleSchedule'](_0x48c5f9);_0x4c8f33&&(_0x3a81c8[dayjs(_0x48c5f9)[_0x295641(0x79)](_0x295641(0x8c))]=_0x4c8f33),_0x48c5f9[_0x295641(0x81)](_0x48c5f9[_0x295641(0xaa)]()+0x1);}return _0x3a81c8;}async[a108_0x53af52(0x8a)](_0x2107d8,_0x58e8aa){const _0xf514f=a108_0x53af52,_0x5bfd60=await this[_0xf514f(0xb8)][_0xf514f(0x8d)](_0x2107d8,Object[_0xf514f(0xb7)](Object[_0xf514f(0xb7)]({},_0x58e8aa),{'updatedAtUtc':new Date()}),{'new':!![]})['exec']();return _0x5bfd60['includeDates']&&await this[_0xf514f(0x9e)](_0x2107d8,_0x5bfd60['includeDates']),_0x5bfd60;}async[a108_0x53af52(0x96)](_0x377552){const _0x115c72=a108_0x53af52,_0x522047=await this[_0x115c72(0xb8)][_0x115c72(0x87)](_0x377552)[_0x115c72(0x8b)]();return _0x522047;}async[a108_0x53af52(0x78)](_0x423a8f,_0x5a7599){const _0x1f2a7e=a108_0x53af52,_0x7228be=await this[_0x1f2a7e(0xa0)](_0x423a8f);_0x7228be[_0x1f2a7e(0xbb)]['findIndex'](_0x6705c2=>_0x6705c2['getTime']()===_0x5a7599[_0x1f2a7e(0x85)]())===-0x1&&_0x7228be[_0x1f2a7e(0xbb)][_0x1f2a7e(0x7d)](_0x5a7599);const _0x516470=await _0x7228be['save']();return await this[_0x1f2a7e(0x9e)](_0x423a8f,[_0x5a7599]),_0x516470;}async[a108_0x53af52(0x9e)](_0xd43eb2,_0x176e9a){const _0x1d0411=a108_0x53af52,_0x97a07=await this['scheduleModel']['find']({'_id':{'$ne':_0xd43eb2},'includeDates':{'$in':_0x176e9a}})[_0x1d0411(0x8b)](),_0x15b7fe=_0x176e9a['map'](_0x4cf0fa=>_0x4cf0fa[_0x1d0411(0x9b)]());await Promise['all'](_0x97a07[_0x1d0411(0x86)](_0x3e6bca=>{const _0x2f9ceb=_0x1d0411,_0x357522=_0x3e6bca[_0x2f9ceb(0xbb)][_0x2f9ceb(0x7f)](_0x3ccfe1=>!_0x15b7fe['includes'](_0x3ccfe1[_0x2f9ceb(0x9b)]()));return _0x3e6bca[_0x2f9ceb(0xbb)]=_0x357522,_0x3e6bca[_0x2f9ceb(0xb1)]=new Date(),_0x3e6bca['save']();}));}async[a108_0x53af52(0xa6)](_0xb24e16){const _0xdd86b2=a108_0x53af52,_0x3790d2=await this[_0xdd86b2(0xa0)](_0xb24e16),_0x380b19=_0x3790d2[_0xdd86b2(0x8f)][_0xdd86b2(0x86)](_0x1b694b=>Object[_0xdd86b2(0xb7)](Object[_0xdd86b2(0xb7)]({},_0x1b694b),{'id':(0x0,utils_1['uuid'])()})),_0x2f0007=new this['scheduleModel'](Object[_0xdd86b2(0xb7)](Object[_0xdd86b2(0xb7)]({},_0x3790d2['toObject']()),{'events':_0x380b19,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x2f0007['save']();}};function a108_0x1edc(_0x28549e,_0x37417d){const _0x556f65=a108_0x556f();return a108_0x1edc=function(_0x1edcc7,_0x2dd73f){_0x1edcc7=_0x1edcc7-0x76;let _0x53262d=_0x556f65[_0x1edcc7];return _0x53262d;},a108_0x1edc(_0x28549e,_0x37417d);}ScheduleService=__decorate([(0x0,common_1[a108_0x53af52(0x89)])(),__param(0x0,(0x0,mongoose_1[a108_0x53af52(0xb9)])(a108_0x53af52(0x9d))),__metadata(a108_0x53af52(0x76),[mongoose_2['Model']])],ScheduleService),exports[a108_0x53af52(0xb2)]=ScheduleService;