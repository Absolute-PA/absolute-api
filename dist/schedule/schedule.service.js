'use strict';const a108_0xef86be=a108_0x1347;(function(_0x208946,_0x4cdbf9){const _0xda4fc5=a108_0x1347,_0x136407=_0x208946();while(!![]){try{const _0x593838=-parseInt(_0xda4fc5(0xea))/0x1*(parseInt(_0xda4fc5(0xf5))/0x2)+parseInt(_0xda4fc5(0x107))/0x3+-parseInt(_0xda4fc5(0x116))/0x4*(-parseInt(_0xda4fc5(0x108))/0x5)+parseInt(_0xda4fc5(0x103))/0x6+-parseInt(_0xda4fc5(0xf8))/0x7*(-parseInt(_0xda4fc5(0x11b))/0x8)+-parseInt(_0xda4fc5(0xf2))/0x9+-parseInt(_0xda4fc5(0x122))/0xa;if(_0x593838===_0x4cdbf9)break;else _0x136407['push'](_0x136407['shift']());}catch(_0x535732){_0x136407['push'](_0x136407['shift']());}}}(a108_0x5e4b,0x1ff59));function a108_0x1347(_0x2f65bd,_0x188e02){const _0x5e4bca=a108_0x5e4b();return a108_0x1347=function(_0x13475c,_0x593006){_0x13475c=_0x13475c-0xe1;let _0x5899c0=_0x5e4bca[_0x13475c];return _0x5899c0;},a108_0x1347(_0x2f65bd,_0x188e02);}function a108_0x5e4b(){const _0xc3ab25=['decorate','@nestjs/mongoose','exec','save','findIndex','function','1757510AxCNwj','includeDates','removeOtherExistingIncludeDates','remove','findEligibleScheduleBetween','object','@nestjs/common','map','createdAtUtc','day','includes','isAfter','events','1wqjuZH','findEligibleSchedule','findByIdAndDelete','setDate','Schedule','toDate','updatedAtUtc','create','580230gaiMzN','defineProperty','Model','289310JZtgDt','assign','format','449029AtOoUK','uuid','find','getDate','findAllActiveSchedules','__decorate','__metadata','Injectable','toObject','toISOString','findById','313434HfVyKL','addIncludeDate','push','scheduleModel','79347KDQjRi','20YKYRrB','getDay','metadata','findAll','design:paramtypes','__esModule','startOf','findOne','../common/utils','getOwnPropertyDescriptor','sort','ScheduleService','filter','getTime','244652Ochsgd','update','YYYY-MM-DD','length','InjectModel','24AfWWwH'];a108_0x5e4b=function(){return _0xc3ab25;};return a108_0x5e4b();}var __decorate=this&&this[a108_0xef86be(0xfd)]||function(_0x23a19f,_0x4607c0,_0x40f0e9,_0x115cd6){const _0x26ea49=a108_0xef86be;var _0x4802e7=arguments[_0x26ea49(0x119)],_0x5e4b53=_0x4802e7<0x3?_0x4607c0:_0x115cd6===null?_0x115cd6=Object[_0x26ea49(0x111)](_0x4607c0,_0x40f0e9):_0x115cd6,_0x5a8c1f;if(typeof Reflect===_0x26ea49(0xe2)&&typeof Reflect[_0x26ea49(0x11c)]==='function')_0x5e4b53=Reflect[_0x26ea49(0x11c)](_0x23a19f,_0x4607c0,_0x40f0e9,_0x115cd6);else{for(var _0x4f9d45=_0x23a19f[_0x26ea49(0x119)]-0x1;_0x4f9d45>=0x0;_0x4f9d45--)if(_0x5a8c1f=_0x23a19f[_0x4f9d45])_0x5e4b53=(_0x4802e7<0x3?_0x5a8c1f(_0x5e4b53):_0x4802e7>0x3?_0x5a8c1f(_0x4607c0,_0x40f0e9,_0x5e4b53):_0x5a8c1f(_0x4607c0,_0x40f0e9))||_0x5e4b53;}return _0x4802e7>0x3&&_0x5e4b53&&Object['defineProperty'](_0x4607c0,_0x40f0e9,_0x5e4b53),_0x5e4b53;},__metadata=this&&this[a108_0xef86be(0xfe)]||function(_0x2dbb0f,_0x256d39){const _0x4e9d83=a108_0xef86be;if(typeof Reflect===_0x4e9d83(0xe2)&&typeof Reflect['metadata']===_0x4e9d83(0x121))return Reflect[_0x4e9d83(0x10a)](_0x2dbb0f,_0x256d39);},__param=this&&this['__param']||function(_0x2dacdf,_0x4525cc){return function(_0x3f306d,_0x3847b3){_0x4525cc(_0x3f306d,_0x3847b3,_0x2dacdf);};};Object[a108_0xef86be(0xf3)](exports,a108_0xef86be(0x10d),{'value':!![]}),exports[a108_0xef86be(0x113)]=void 0x0;const common_1=require(a108_0xef86be(0xe3)),mongoose_1=require(a108_0xef86be(0x11d)),mongoose_2=require('mongoose'),dayjs=require('dayjs'),utils_1=require(a108_0xef86be(0x110)),schedulePrioritySort=(_0x1e8a92,_0x2ceefb)=>dayjs(_0x1e8a92[a108_0xef86be(0xe5)])[a108_0xef86be(0xe8)](dayjs(_0x2ceefb['createdAtUtc']))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0x3aa9ec){this['scheduleModel']=_0x3aa9ec;}async[a108_0xef86be(0xf1)](_0x3e2edd){const _0x298940=a108_0xef86be,_0x139544=new this[(_0x298940(0x106))](_0x3e2edd);return _0x139544[_0x298940(0x11f)]();}async[a108_0xef86be(0x10b)](){const _0x46588d=a108_0xef86be,_0x4c456e=await this['scheduleModel'][_0x46588d(0xfa)]()[_0x46588d(0x11e)]();return _0x4c456e;}async[a108_0xef86be(0x10f)](_0xf8b80b){const _0x22ced2=a108_0xef86be,_0xc0171=await this[_0x22ced2(0x106)][_0x22ced2(0x102)](_0xf8b80b);return _0xc0171;}async['findEligibleSchedule'](_0x56eba7){const _0x25bf9f=a108_0xef86be,_0x5745a4=await this[_0x25bf9f(0xfc)](_0x56eba7),_0x920644=_0x5745a4[_0x25bf9f(0x114)](_0x3ddc6a=>_0x3ddc6a[_0x25bf9f(0x123)][_0x25bf9f(0x119)]>0x0&&_0x3ddc6a['includeDates'][_0x25bf9f(0xe4)](_0x3c22f0=>dayjs(_0x3c22f0)[_0x25bf9f(0xf7)]('YYYY-MM-DD'))[_0x25bf9f(0xe7)](dayjs(_0x56eba7)[_0x25bf9f(0xf7)](_0x25bf9f(0x118))))['sort'](schedulePrioritySort);if(_0x920644[_0x25bf9f(0x119)]>0x0)return _0x920644[0x0];const _0x4e5930=_0x5745a4[_0x25bf9f(0x114)](_0x22c516=>_0x22c516['weekDays'][_0x25bf9f(0xe7)](_0x56eba7[_0x25bf9f(0x109)]()))[_0x25bf9f(0x112)](schedulePrioritySort);if(_0x4e5930['length']>0x0)return _0x4e5930[0x0];return null;}async[a108_0xef86be(0xfc)](_0x33ef93){const _0x598d01=a108_0xef86be,_0x5ef9a8=dayjs(_0x33ef93)[_0x598d01(0x10e)](_0x598d01(0xe6))[_0x598d01(0xef)](),_0x466033={'$and':[{'$or':[{'startDate':{'$lte':_0x33ef93},'endDate':{'$gte':_0x33ef93}},{'startDate':{'$lte':_0x33ef93},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x33ef93}}]},{'excludeDates':{'$nin':[_0x5ef9a8]}}]},_0x4d59dc=await this[_0x598d01(0x106)]['find'](_0x466033)[_0x598d01(0x11e)]();return _0x4d59dc;}async[a108_0xef86be(0xe1)](_0x368482,_0x2034f4){const _0x451609=a108_0xef86be,_0x1ee5ce=new Date(_0x368482),_0x2cf51f={};while(_0x1ee5ce<=_0x2034f4){const _0x238b66=await this[_0x451609(0xeb)](_0x1ee5ce);_0x238b66&&(_0x2cf51f[dayjs(_0x1ee5ce)['format'](_0x451609(0x118))]=_0x238b66),_0x1ee5ce[_0x451609(0xed)](_0x1ee5ce[_0x451609(0xfb)]()+0x1);}return _0x2cf51f;}async[a108_0xef86be(0x117)](_0x5a9941,_0x513d62){const _0x32e203=a108_0xef86be,_0x4b602a=await this[_0x32e203(0x106)]['findByIdAndUpdate'](_0x5a9941,Object[_0x32e203(0xf6)](Object[_0x32e203(0xf6)]({},_0x513d62),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x32e203(0x11e)]();return _0x4b602a[_0x32e203(0x123)]&&await this[_0x32e203(0x124)](_0x5a9941,_0x4b602a[_0x32e203(0x123)]),_0x4b602a;}async[a108_0xef86be(0x125)](_0x32dc16){const _0x6ca413=a108_0xef86be,_0x3678e2=await this[_0x6ca413(0x106)][_0x6ca413(0xec)](_0x32dc16)['exec']();return _0x3678e2;}async[a108_0xef86be(0x104)](_0x1f8346,_0x393dbc){const _0x24c98f=a108_0xef86be,_0x204c0b=await this[_0x24c98f(0x10f)](_0x1f8346);_0x204c0b[_0x24c98f(0x123)][_0x24c98f(0x120)](_0x46f059=>_0x46f059[_0x24c98f(0x115)]()===_0x393dbc[_0x24c98f(0x115)]())===-0x1&&_0x204c0b[_0x24c98f(0x123)][_0x24c98f(0x105)](_0x393dbc);const _0xe15276=await _0x204c0b[_0x24c98f(0x11f)]();return await this['removeOtherExistingIncludeDates'](_0x1f8346,[_0x393dbc]),_0xe15276;}async[a108_0xef86be(0x124)](_0x218e1b,_0x390b8f){const _0x2a9529=a108_0xef86be,_0x381d66=await this[_0x2a9529(0x106)][_0x2a9529(0xfa)]({'_id':{'$ne':_0x218e1b},'includeDates':{'$in':_0x390b8f}})[_0x2a9529(0x11e)](),_0x1a6ba3=_0x390b8f[_0x2a9529(0xe4)](_0x31984f=>_0x31984f[_0x2a9529(0x101)]());await Promise['all'](_0x381d66['map'](_0x5e5894=>{const _0x11add2=_0x2a9529,_0x59f788=_0x5e5894[_0x11add2(0x123)]['filter'](_0x4e1927=>!_0x1a6ba3[_0x11add2(0xe7)](_0x4e1927['toISOString']()));return _0x5e5894[_0x11add2(0x123)]=_0x59f788,_0x5e5894[_0x11add2(0xf0)]=new Date(),_0x5e5894[_0x11add2(0x11f)]();}));}async['clone'](_0xed31ee){const _0x3bd0f8=a108_0xef86be,_0x5aa89d=await this[_0x3bd0f8(0x10f)](_0xed31ee),_0x1c2224=_0x5aa89d[_0x3bd0f8(0xe9)][_0x3bd0f8(0xe4)](_0xf2e715=>Object[_0x3bd0f8(0xf6)](Object[_0x3bd0f8(0xf6)]({},_0xf2e715),{'id':(0x0,utils_1[_0x3bd0f8(0xf9)])()})),_0x3d1e49=new this[(_0x3bd0f8(0x106))](Object[_0x3bd0f8(0xf6)](Object[_0x3bd0f8(0xf6)]({},_0x5aa89d[_0x3bd0f8(0x100)]()),{'events':_0x1c2224,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x3d1e49[_0x3bd0f8(0x11f)]();}};ScheduleService=__decorate([(0x0,common_1[a108_0xef86be(0xff)])(),__param(0x0,(0x0,mongoose_1[a108_0xef86be(0x11a)])(a108_0xef86be(0xee))),__metadata(a108_0xef86be(0x10c),[mongoose_2[a108_0xef86be(0xf4)]])],ScheduleService),exports[a108_0xef86be(0x113)]=ScheduleService;