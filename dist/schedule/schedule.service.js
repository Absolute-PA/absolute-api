'use strict';const a111_0x8eac63=a111_0x3270;(function(_0x11bd83,_0x2fc5ee){const _0x4d9622=a111_0x3270,_0x57eca3=_0x11bd83();while(!![]){try{const _0x406778=parseInt(_0x4d9622(0xb0))/0x1*(parseInt(_0x4d9622(0xdb))/0x2)+parseInt(_0x4d9622(0xd9))/0x3*(parseInt(_0x4d9622(0xce))/0x4)+-parseInt(_0x4d9622(0xda))/0x5*(parseInt(_0x4d9622(0xb6))/0x6)+-parseInt(_0x4d9622(0xd0))/0x7+-parseInt(_0x4d9622(0xcb))/0x8+-parseInt(_0x4d9622(0xdd))/0x9+parseInt(_0x4d9622(0xc0))/0xa;if(_0x406778===_0x2fc5ee)break;else _0x57eca3['push'](_0x57eca3['shift']());}catch(_0x4d3ecd){_0x57eca3['push'](_0x57eca3['shift']());}}}(a111_0x5a46,0x6537a));function a111_0x3270(_0x1585e4,_0x5ca09e){const _0x5a46e5=a111_0x5a46();return a111_0x3270=function(_0x3270df,_0x4ca4bb){_0x3270df=_0x3270df-0xad;let _0x39eb87=_0x5a46e5[_0x3270df];return _0x39eb87;},a111_0x3270(_0x1585e4,_0x5ca09e);}var __decorate=this&&this['__decorate']||function(_0x1e41c2,_0x1c55f5,_0x344c91,_0x4b3e98){const _0x439ca4=a111_0x3270;var _0x484098=arguments[_0x439ca4(0xe8)],_0x23e93f=_0x484098<0x3?_0x1c55f5:_0x4b3e98===null?_0x4b3e98=Object['getOwnPropertyDescriptor'](_0x1c55f5,_0x344c91):_0x4b3e98,_0x236df7;if(typeof Reflect===_0x439ca4(0xc2)&&typeof Reflect[_0x439ca4(0xb4)]===_0x439ca4(0xc8))_0x23e93f=Reflect['decorate'](_0x1e41c2,_0x1c55f5,_0x344c91,_0x4b3e98);else{for(var _0x1af312=_0x1e41c2['length']-0x1;_0x1af312>=0x0;_0x1af312--)if(_0x236df7=_0x1e41c2[_0x1af312])_0x23e93f=(_0x484098<0x3?_0x236df7(_0x23e93f):_0x484098>0x3?_0x236df7(_0x1c55f5,_0x344c91,_0x23e93f):_0x236df7(_0x1c55f5,_0x344c91))||_0x23e93f;}return _0x484098>0x3&&_0x23e93f&&Object[_0x439ca4(0xc1)](_0x1c55f5,_0x344c91,_0x23e93f),_0x23e93f;},__metadata=this&&this['__metadata']||function(_0x24ee9,_0x1d77c8){const _0x3d0425=a111_0x3270;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x3d0425(0xc8))return Reflect[_0x3d0425(0xe1)](_0x24ee9,_0x1d77c8);},__param=this&&this['__param']||function(_0x2b2a5d,_0xb941d6){return function(_0x570786,_0x4ed57d){_0xb941d6(_0x570786,_0x4ed57d,_0x2b2a5d);};};Object[a111_0x8eac63(0xc1)](exports,'__esModule',{'value':!![]}),exports[a111_0x8eac63(0xad)]=void 0x0;const common_1=require(a111_0x8eac63(0xba)),mongoose_1=require(a111_0x8eac63(0xdc)),mongoose_2=require(a111_0x8eac63(0xcc)),dayjs=require(a111_0x8eac63(0xc6)),utils_1=require(a111_0x8eac63(0xb1)),schedulePrioritySort=(_0x5a2b33,_0x80e7ad)=>dayjs(_0x5a2b33[a111_0x8eac63(0xcd)])['isAfter'](dayjs(_0x80e7ad[a111_0x8eac63(0xcd)]))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0x399fcf){const _0x45e5ce=a111_0x8eac63;this[_0x45e5ce(0xc9)]=_0x399fcf;}async[a111_0x8eac63(0xae)](_0x98b061){const _0x53f588=a111_0x8eac63,_0x431d06=new this[(_0x53f588(0xc9))](_0x98b061);return _0x431d06[_0x53f588(0xe0)]();}async[a111_0x8eac63(0xaf)](){const _0x25a1b8=a111_0x8eac63,_0x5c3167=await this[_0x25a1b8(0xc9)]['find']()[_0x25a1b8(0xb9)]();return _0x5c3167;}async[a111_0x8eac63(0xbf)](_0x221b0f){const _0x3ce7e1=a111_0x8eac63,_0x52864c=await this['scheduleModel'][_0x3ce7e1(0xd7)](_0x221b0f);return _0x52864c;}async[a111_0x8eac63(0xbe)](_0x67079f){const _0x27ef12=a111_0x8eac63,_0x3fb1c4=await this[_0x27ef12(0xb8)](_0x67079f),_0x5ccff7=_0x3fb1c4['filter'](_0x46616e=>_0x46616e[_0x27ef12(0xc7)][_0x27ef12(0xe8)]>0x0&&_0x46616e[_0x27ef12(0xc7)][_0x27ef12(0xd3)](_0x2ba127=>dayjs(_0x2ba127)['format'](_0x27ef12(0xdf)))[_0x27ef12(0xb3)](dayjs(_0x67079f)['format']('YYYY-MM-DD')))[_0x27ef12(0xd5)](schedulePrioritySort);if(_0x5ccff7['length']>0x0)return _0x5ccff7[0x0];const _0x4c21df=_0x3fb1c4[_0x27ef12(0xb2)](_0x2e1d28=>_0x2e1d28[_0x27ef12(0xd8)][_0x27ef12(0xb3)](_0x67079f['getDay']()))[_0x27ef12(0xd5)](schedulePrioritySort);if(_0x4c21df['length']>0x0)return _0x4c21df[0x0];return null;}async[a111_0x8eac63(0xb8)](_0x5b70f5){const _0x3e5851=a111_0x8eac63,_0x12bde9=dayjs(_0x5b70f5)[_0x3e5851(0xd6)](_0x3e5851(0xcf))[_0x3e5851(0xd4)](),_0xbd3988={'$and':[{'$or':[{'startDate':{'$lte':_0x5b70f5},'endDate':{'$gte':_0x5b70f5}},{'startDate':{'$lte':_0x5b70f5},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x5b70f5}}]},{'excludeDates':{'$nin':[_0x12bde9]}}]},_0x22ec90=await this[_0x3e5851(0xc9)]['find'](_0xbd3988)[_0x3e5851(0xb9)]();return _0x22ec90;}async[a111_0x8eac63(0xd2)](_0x4f9319,_0x38b019){const _0x216156=a111_0x8eac63,_0x3db85e=new Date(_0x4f9319),_0x183be6={};while(_0x3db85e<=_0x38b019){const _0x2b2ccd=await this[_0x216156(0xbe)](_0x3db85e);_0x2b2ccd&&(_0x183be6[dayjs(_0x3db85e)['format'](_0x216156(0xdf))]=_0x2b2ccd),_0x3db85e[_0x216156(0xca)](_0x3db85e['getDate']()+0x1);}return _0x183be6;}async['update'](_0x3729e0,_0x578abe){const _0x2913dd=a111_0x8eac63,_0x470676=await this[_0x2913dd(0xc9)]['findByIdAndUpdate'](_0x3729e0,Object['assign'](Object[_0x2913dd(0xe2)]({},_0x578abe),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x2913dd(0xb9)]();return _0x470676[_0x2913dd(0xc7)]&&await this['removeOtherExistingIncludeDates'](_0x3729e0,_0x470676[_0x2913dd(0xc7)]),_0x470676;}async['remove'](_0x3314f9){const _0x429a3f=a111_0x8eac63,_0x1859b8=await this[_0x429a3f(0xc9)][_0x429a3f(0xc4)](_0x3314f9)[_0x429a3f(0xb9)]();return _0x1859b8;}async['addIncludeDate'](_0x5a57f1,_0x4c59a3){const _0x4185d3=a111_0x8eac63,_0x4464b2=await this[_0x4185d3(0xbf)](_0x5a57f1);_0x4464b2['includeDates'][_0x4185d3(0xc5)](_0x4b7b82=>_0x4b7b82[_0x4185d3(0xd1)]()===_0x4c59a3['getTime']())===-0x1&&_0x4464b2['includeDates'][_0x4185d3(0xbc)](_0x4c59a3);const _0x522223=await _0x4464b2[_0x4185d3(0xe0)]();return await this['removeOtherExistingIncludeDates'](_0x5a57f1,[_0x4c59a3]),_0x522223;}async['removeOtherExistingIncludeDates'](_0x59a948,_0x49ba68){const _0x44c442=a111_0x8eac63,_0x2d161b=await this[_0x44c442(0xc9)][_0x44c442(0xbb)]({'_id':{'$ne':_0x59a948},'includeDates':{'$in':_0x49ba68}})['exec'](),_0x59e87e=_0x49ba68[_0x44c442(0xd3)](_0x3660bb=>_0x3660bb[_0x44c442(0xb7)]());await Promise[_0x44c442(0xe6)](_0x2d161b[_0x44c442(0xd3)](_0x523d09=>{const _0x5d7708=_0x44c442,_0x54a5c4=_0x523d09['includeDates'][_0x5d7708(0xb2)](_0x2cfb89=>!_0x59e87e[_0x5d7708(0xb3)](_0x2cfb89[_0x5d7708(0xb7)]()));return _0x523d09['includeDates']=_0x54a5c4,_0x523d09[_0x5d7708(0xde)]=new Date(),_0x523d09[_0x5d7708(0xe0)]();}));}async[a111_0x8eac63(0xc3)](_0x2379c9){const _0x359cf1=a111_0x8eac63,_0x5aea88=await this[_0x359cf1(0xbf)](_0x2379c9),_0x54ba42=_0x5aea88[_0x359cf1(0xe4)]['map'](_0x180e3d=>Object[_0x359cf1(0xe2)](Object['assign']({},_0x180e3d),{'id':(0x0,utils_1[_0x359cf1(0xe7)])()})),_0x579c1e=new this[(_0x359cf1(0xc9))](Object['assign'](Object[_0x359cf1(0xe2)]({},_0x5aea88['toObject']()),{'events':_0x54ba42,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x579c1e['save']();}};function a111_0x5a46(){const _0x495913=['sort','startOf','findById','weekDays','3FvIRdk','145OIikhh','5774NARsvY','@nestjs/mongoose','6869862nyKgKF','updatedAtUtc','YYYY-MM-DD','save','metadata','assign','Injectable','events','design:paramtypes','all','uuid','length','ScheduleService','create','findAll','28HmPMAO','../common/utils','filter','includes','decorate','Model','23172vuSzDg','toISOString','findAllActiveSchedules','exec','@nestjs/common','find','push','InjectModel','findEligibleSchedule','findOne','19946690fzMIBd','defineProperty','object','clone','findByIdAndDelete','findIndex','dayjs','includeDates','function','scheduleModel','setDate','4376592ubfUvs','mongoose','createdAtUtc','1127852xHAQQT','day','3643444DWCpnC','getTime','findEligibleScheduleBetween','map','toDate'];a111_0x5a46=function(){return _0x495913;};return a111_0x5a46();}ScheduleService=__decorate([(0x0,common_1[a111_0x8eac63(0xe3)])(),__param(0x0,(0x0,mongoose_1[a111_0x8eac63(0xbd)])('Schedule')),__metadata(a111_0x8eac63(0xe5),[mongoose_2[a111_0x8eac63(0xb5)]])],ScheduleService),exports[a111_0x8eac63(0xad)]=ScheduleService;