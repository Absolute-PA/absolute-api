'use strict';const a108_0x255ece=a108_0x4e7e;(function(_0x4780e4,_0x1001dc){const _0x2b0761=a108_0x4e7e,_0x16cd37=_0x4780e4();while(!![]){try{const _0x118c64=parseInt(_0x2b0761(0x161))/0x1+-parseInt(_0x2b0761(0x150))/0x2*(-parseInt(_0x2b0761(0x166))/0x3)+parseInt(_0x2b0761(0x160))/0x4+-parseInt(_0x2b0761(0x185))/0x5*(parseInt(_0x2b0761(0x171))/0x6)+-parseInt(_0x2b0761(0x149))/0x7+parseInt(_0x2b0761(0x143))/0x8*(parseInt(_0x2b0761(0x186))/0x9)+-parseInt(_0x2b0761(0x15d))/0xa*(parseInt(_0x2b0761(0x17c))/0xb);if(_0x118c64===_0x1001dc)break;else _0x16cd37['push'](_0x16cd37['shift']());}catch(_0x4312fa){_0x16cd37['push'](_0x16cd37['shift']());}}}(a108_0x58dd,0x2bb58));function a108_0x58dd(){const _0x1f4c15=['scheduleModel','mongoose','550vUZjvY','remove','format','decorate','findEligibleScheduleBetween','__decorate','length','findByIdAndUpdate','Model','60745yWJEKm','63uweElx','findOne','includeDates','design:paramtypes','getTime','includes','5552keEkiV','getDate','@nestjs/mongoose','toObject','findIndex','__metadata','1018213ZQSBFT','filter','all','YYYY-MM-DD','findAllActiveSchedules','object','clone','10MNGXYq','day','__param','toISOString','function','getDay','ScheduleService','findByIdAndDelete','findAll','__esModule','exec','toDate','assign','370BUsZgY','updatedAtUtc','dayjs','1392260ApejFN','95862RhpPmS','Schedule','create','createdAtUtc','weekDays','6717LJivxG','isAfter','map','defineProperty','startOf','save','Injectable','uuid','metadata','@nestjs/common','sort','66rjgYiR','InjectModel','removeOtherExistingIncludeDates','events','find','getOwnPropertyDescriptor','findEligibleSchedule','addIncludeDate','push'];a108_0x58dd=function(){return _0x1f4c15;};return a108_0x58dd();}var __decorate=this&&this[a108_0x255ece(0x181)]||function(_0xbe2d63,_0x109e84,_0x247d07,_0x460637){const _0x56c8bf=a108_0x255ece;var _0x2aa7d5=arguments[_0x56c8bf(0x182)],_0x39d412=_0x2aa7d5<0x3?_0x109e84:_0x460637===null?_0x460637=Object[_0x56c8bf(0x176)](_0x109e84,_0x247d07):_0x460637,_0x137774;if(typeof Reflect==='object'&&typeof Reflect[_0x56c8bf(0x17f)]==='function')_0x39d412=Reflect[_0x56c8bf(0x17f)](_0xbe2d63,_0x109e84,_0x247d07,_0x460637);else{for(var _0x4fa60a=_0xbe2d63[_0x56c8bf(0x182)]-0x1;_0x4fa60a>=0x0;_0x4fa60a--)if(_0x137774=_0xbe2d63[_0x4fa60a])_0x39d412=(_0x2aa7d5<0x3?_0x137774(_0x39d412):_0x2aa7d5>0x3?_0x137774(_0x109e84,_0x247d07,_0x39d412):_0x137774(_0x109e84,_0x247d07))||_0x39d412;}return _0x2aa7d5>0x3&&_0x39d412&&Object[_0x56c8bf(0x169)](_0x109e84,_0x247d07,_0x39d412),_0x39d412;},__metadata=this&&this[a108_0x255ece(0x148)]||function(_0x321e46,_0x21399a){const _0x309094=a108_0x255ece;if(typeof Reflect===_0x309094(0x14e)&&typeof Reflect[_0x309094(0x16e)]===_0x309094(0x154))return Reflect[_0x309094(0x16e)](_0x321e46,_0x21399a);},__param=this&&this[a108_0x255ece(0x152)]||function(_0x5c41bc,_0x3b11fc){return function(_0x2fa8de,_0xd9d242){_0x3b11fc(_0x2fa8de,_0xd9d242,_0x5c41bc);};};Object['defineProperty'](exports,a108_0x255ece(0x159),{'value':!![]}),exports[a108_0x255ece(0x156)]=void 0x0;function a108_0x4e7e(_0x533248,_0x30b4e4){const _0x58dd1f=a108_0x58dd();return a108_0x4e7e=function(_0x4e7e2a,_0x581088){_0x4e7e2a=_0x4e7e2a-0x13e;let _0x30ad25=_0x58dd1f[_0x4e7e2a];return _0x30ad25;},a108_0x4e7e(_0x533248,_0x30b4e4);}const common_1=require(a108_0x255ece(0x16f)),mongoose_1=require(a108_0x255ece(0x145)),mongoose_2=require(a108_0x255ece(0x17b)),dayjs=require(a108_0x255ece(0x15f)),utils_1=require('../common/utils'),schedulePrioritySort=(_0x8c04c4,_0x4d4ecc)=>dayjs(_0x8c04c4['createdAtUtc'])[a108_0x255ece(0x167)](dayjs(_0x4d4ecc[a108_0x255ece(0x164)]))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0xf61047){const _0x469b53=a108_0x255ece;this[_0x469b53(0x17a)]=_0xf61047;}async[a108_0x255ece(0x163)](_0x5b70ac){const _0x446b88=new this['scheduleModel'](_0x5b70ac);return _0x446b88['save']();}async[a108_0x255ece(0x158)](){const _0x1a9e8a=a108_0x255ece,_0x4d2204=await this[_0x1a9e8a(0x17a)][_0x1a9e8a(0x175)]()['exec']();return _0x4d2204;}async[a108_0x255ece(0x13e)](_0x1148d5){const _0x2f3c97=a108_0x255ece,_0x3ee651=await this[_0x2f3c97(0x17a)]['findById'](_0x1148d5);return _0x3ee651;}async[a108_0x255ece(0x177)](_0x52b7d2){const _0xa9126f=a108_0x255ece,_0x2526d7=await this[_0xa9126f(0x14d)](_0x52b7d2),_0x27420c=_0x2526d7[_0xa9126f(0x14a)](_0x3429d6=>_0x3429d6[_0xa9126f(0x13f)]['length']>0x0&&_0x3429d6[_0xa9126f(0x13f)][_0xa9126f(0x168)](_0x168225=>dayjs(_0x168225)[_0xa9126f(0x17e)](_0xa9126f(0x14c)))['includes'](dayjs(_0x52b7d2)[_0xa9126f(0x17e)]('YYYY-MM-DD')))[_0xa9126f(0x170)](schedulePrioritySort);if(_0x27420c[_0xa9126f(0x182)]>0x0)return _0x27420c[0x0];const _0x59d34e=_0x2526d7['filter'](_0x487ef6=>_0x487ef6[_0xa9126f(0x165)][_0xa9126f(0x142)](_0x52b7d2[_0xa9126f(0x155)]()))[_0xa9126f(0x170)](schedulePrioritySort);if(_0x59d34e['length']>0x0)return _0x59d34e[0x0];return null;}async[a108_0x255ece(0x14d)](_0x51afe9){const _0x4e1f0b=a108_0x255ece,_0x2598be=dayjs(_0x51afe9)[_0x4e1f0b(0x16a)](_0x4e1f0b(0x151))[_0x4e1f0b(0x15b)](),_0x221b90={'$and':[{'$or':[{'startDate':{'$lte':_0x51afe9},'endDate':{'$gte':_0x51afe9}},{'startDate':{'$lte':_0x51afe9},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x51afe9}}]},{'excludeDates':{'$nin':[_0x2598be]}}]},_0x34f191=await this['scheduleModel'][_0x4e1f0b(0x175)](_0x221b90)[_0x4e1f0b(0x15a)]();return _0x34f191;}async[a108_0x255ece(0x180)](_0x2035c9,_0x13d0c0){const _0x15e2f2=a108_0x255ece,_0x1db5d6=new Date(_0x2035c9),_0x4abd28={};while(_0x1db5d6<=_0x13d0c0){const _0x5bfc18=await this[_0x15e2f2(0x177)](_0x1db5d6);_0x5bfc18&&(_0x4abd28[dayjs(_0x1db5d6)['format'](_0x15e2f2(0x14c))]=_0x5bfc18),_0x1db5d6['setDate'](_0x1db5d6[_0x15e2f2(0x144)]()+0x1);}return _0x4abd28;}async['update'](_0x1b5e33,_0x51f87b){const _0x29ab85=a108_0x255ece,_0x1fb581=await this['scheduleModel'][_0x29ab85(0x183)](_0x1b5e33,Object[_0x29ab85(0x15c)](Object[_0x29ab85(0x15c)]({},_0x51f87b),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x29ab85(0x15a)]();return _0x1fb581['includeDates']&&await this[_0x29ab85(0x173)](_0x1b5e33,_0x1fb581[_0x29ab85(0x13f)]),_0x1fb581;}async[a108_0x255ece(0x17d)](_0x99d0bd){const _0x4065d4=a108_0x255ece,_0x3ec25c=await this[_0x4065d4(0x17a)][_0x4065d4(0x157)](_0x99d0bd)[_0x4065d4(0x15a)]();return _0x3ec25c;}async[a108_0x255ece(0x178)](_0xb929dd,_0x2b086f){const _0x172939=a108_0x255ece,_0x1e62ee=await this[_0x172939(0x13e)](_0xb929dd);_0x1e62ee[_0x172939(0x13f)][_0x172939(0x147)](_0x590c82=>_0x590c82[_0x172939(0x141)]()===_0x2b086f[_0x172939(0x141)]())===-0x1&&_0x1e62ee[_0x172939(0x13f)][_0x172939(0x179)](_0x2b086f);const _0x44825d=await _0x1e62ee[_0x172939(0x16b)]();return await this['removeOtherExistingIncludeDates'](_0xb929dd,[_0x2b086f]),_0x44825d;}async[a108_0x255ece(0x173)](_0x46b3b6,_0x953a4c){const _0x341948=a108_0x255ece,_0x193a04=await this[_0x341948(0x17a)][_0x341948(0x175)]({'_id':{'$ne':_0x46b3b6},'includeDates':{'$in':_0x953a4c}})[_0x341948(0x15a)](),_0x3aa83b=_0x953a4c[_0x341948(0x168)](_0x5ac360=>_0x5ac360[_0x341948(0x153)]());await Promise[_0x341948(0x14b)](_0x193a04[_0x341948(0x168)](_0x1d9ff3=>{const _0x355505=_0x341948,_0x33e267=_0x1d9ff3[_0x355505(0x13f)][_0x355505(0x14a)](_0x2a5891=>!_0x3aa83b[_0x355505(0x142)](_0x2a5891[_0x355505(0x153)]()));return _0x1d9ff3[_0x355505(0x13f)]=_0x33e267,_0x1d9ff3[_0x355505(0x15e)]=new Date(),_0x1d9ff3[_0x355505(0x16b)]();}));}async[a108_0x255ece(0x14f)](_0x40058b){const _0x50536a=a108_0x255ece,_0x33969b=await this[_0x50536a(0x13e)](_0x40058b),_0xb92e6c=_0x33969b[_0x50536a(0x174)][_0x50536a(0x168)](_0x4a8e58=>Object[_0x50536a(0x15c)](Object[_0x50536a(0x15c)]({},_0x4a8e58),{'id':(0x0,utils_1[_0x50536a(0x16d)])()})),_0x2e5feb=new this[(_0x50536a(0x17a))](Object[_0x50536a(0x15c)](Object[_0x50536a(0x15c)]({},_0x33969b[_0x50536a(0x146)]()),{'events':_0xb92e6c,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x2e5feb[_0x50536a(0x16b)]();}};ScheduleService=__decorate([(0x0,common_1[a108_0x255ece(0x16c)])(),__param(0x0,(0x0,mongoose_1[a108_0x255ece(0x172)])(a108_0x255ece(0x162))),__metadata(a108_0x255ece(0x140),[mongoose_2[a108_0x255ece(0x184)]])],ScheduleService),exports[a108_0x255ece(0x156)]=ScheduleService;