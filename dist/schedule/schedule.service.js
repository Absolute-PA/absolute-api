'use strict';const a111_0x5dcf75=a111_0x5d3e;(function(_0x482062,_0xfb54ad){const _0x4801c0=a111_0x5d3e,_0x56965f=_0x482062();while(!![]){try{const _0x47f17d=parseInt(_0x4801c0(0x122))/0x1+parseInt(_0x4801c0(0x10d))/0x2*(-parseInt(_0x4801c0(0x14c))/0x3)+parseInt(_0x4801c0(0x14e))/0x4+-parseInt(_0x4801c0(0x119))/0x5+parseInt(_0x4801c0(0x116))/0x6*(parseInt(_0x4801c0(0x141))/0x7)+parseInt(_0x4801c0(0x11a))/0x8+-parseInt(_0x4801c0(0x12d))/0x9;if(_0x47f17d===_0xfb54ad)break;else _0x56965f['push'](_0x56965f['shift']());}catch(_0x198dee){_0x56965f['push'](_0x56965f['shift']());}}}(a111_0x3002,0xa5e3d));var __decorate=this&&this[a111_0x5dcf75(0x133)]||function(_0x462796,_0x6d904,_0xdcb920,_0x137ad0){const _0x31b9e7=a111_0x5dcf75;var _0x48459e=arguments['length'],_0xe88292=_0x48459e<0x3?_0x6d904:_0x137ad0===null?_0x137ad0=Object[_0x31b9e7(0x120)](_0x6d904,_0xdcb920):_0x137ad0,_0x23efc6;if(typeof Reflect===_0x31b9e7(0x11f)&&typeof Reflect[_0x31b9e7(0x10f)]===_0x31b9e7(0x13b))_0xe88292=Reflect['decorate'](_0x462796,_0x6d904,_0xdcb920,_0x137ad0);else{for(var _0x182f73=_0x462796['length']-0x1;_0x182f73>=0x0;_0x182f73--)if(_0x23efc6=_0x462796[_0x182f73])_0xe88292=(_0x48459e<0x3?_0x23efc6(_0xe88292):_0x48459e>0x3?_0x23efc6(_0x6d904,_0xdcb920,_0xe88292):_0x23efc6(_0x6d904,_0xdcb920))||_0xe88292;}return _0x48459e>0x3&&_0xe88292&&Object[_0x31b9e7(0x113)](_0x6d904,_0xdcb920,_0xe88292),_0xe88292;},__metadata=this&&this[a111_0x5dcf75(0x139)]||function(_0x2eab21,_0x547ecb){const _0x3667ce=a111_0x5dcf75;if(typeof Reflect===_0x3667ce(0x11f)&&typeof Reflect['metadata']===_0x3667ce(0x13b))return Reflect[_0x3667ce(0x124)](_0x2eab21,_0x547ecb);},__param=this&&this['__param']||function(_0x383bf8,_0xb3c6a){return function(_0x46774b,_0x496574){_0xb3c6a(_0x46774b,_0x496574,_0x383bf8);};};Object[a111_0x5dcf75(0x113)](exports,a111_0x5dcf75(0x126),{'value':!![]}),exports[a111_0x5dcf75(0x127)]=void 0x0;const common_1=require(a111_0x5dcf75(0x118)),mongoose_1=require(a111_0x5dcf75(0x123)),mongoose_2=require(a111_0x5dcf75(0x132)),dayjs=require('dayjs'),utils_1=require(a111_0x5dcf75(0x145)),schedulePrioritySort=(_0x18694b,_0x2484e5)=>dayjs(_0x18694b[a111_0x5dcf75(0x14b)])[a111_0x5dcf75(0x128)](dayjs(_0x2484e5['createdAtUtc']))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0x5d8aa1){const _0x34d8f4=a111_0x5dcf75;this[_0x34d8f4(0x130)]=_0x5d8aa1;}async[a111_0x5dcf75(0x12c)](_0x52c5b7){const _0xb350da=a111_0x5dcf75,_0x15b7dd=new this[(_0xb350da(0x130))](_0x52c5b7);return _0x15b7dd[_0xb350da(0x140)]();}async[a111_0x5dcf75(0x14a)](){const _0x524248=a111_0x5dcf75,_0x5b293d=await this[_0x524248(0x130)]['find']()[_0x524248(0x149)]();return _0x5b293d;}async[a111_0x5dcf75(0x137)](_0x1d8087){const _0x46d958=a111_0x5dcf75,_0x147bb8=await this[_0x46d958(0x130)][_0x46d958(0x111)](_0x1d8087);return _0x147bb8;}async[a111_0x5dcf75(0x12a)](_0x3241c2){const _0x187348=a111_0x5dcf75,_0x239b2e=await this[_0x187348(0x11d)](_0x3241c2),_0x58981d=_0x239b2e[_0x187348(0x147)](_0x4a1c75=>_0x4a1c75[_0x187348(0x136)][_0x187348(0x114)]>0x0&&_0x4a1c75[_0x187348(0x136)][_0x187348(0x144)](_0x507ff3=>dayjs(_0x507ff3)[_0x187348(0x13f)]('YYYY-MM-DD'))[_0x187348(0x135)](dayjs(_0x3241c2)[_0x187348(0x13f)](_0x187348(0x10e))))[_0x187348(0x134)](schedulePrioritySort);if(_0x58981d[_0x187348(0x114)]>0x0)return _0x58981d[0x0];const _0x25c6f2=_0x239b2e['filter'](_0x37a75f=>_0x37a75f[_0x187348(0x117)][_0x187348(0x135)](_0x3241c2['getDay']()))[_0x187348(0x134)](schedulePrioritySort);if(_0x25c6f2['length']>0x0)return _0x25c6f2[0x0];return null;}async[a111_0x5dcf75(0x11d)](_0x337b5f){const _0x4006f6=a111_0x5dcf75,_0x3f957b=dayjs(_0x337b5f)[_0x4006f6(0x13c)](_0x4006f6(0x115))[_0x4006f6(0x11b)](),_0x37719d={'$and':[{'$or':[{'startDate':{'$lte':_0x337b5f},'endDate':{'$gte':_0x337b5f}},{'startDate':{'$lte':_0x337b5f},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x337b5f}}]},{'excludeDates':{'$nin':[_0x3f957b]}}]},_0xb532df=await this['scheduleModel'][_0x4006f6(0x148)](_0x37719d)['exec']();return _0xb532df;}async[a111_0x5dcf75(0x11c)](_0x6366d,_0xe785ae){const _0x34aae2=a111_0x5dcf75,_0x7df1ca=new Date(_0x6366d),_0x38e0a0={};while(_0x7df1ca<=_0xe785ae){const _0x4d4f5b=await this['findEligibleSchedule'](_0x7df1ca);_0x4d4f5b&&(_0x38e0a0[dayjs(_0x7df1ca)[_0x34aae2(0x13f)]('YYYY-MM-DD')]=_0x4d4f5b),_0x7df1ca[_0x34aae2(0x125)](_0x7df1ca[_0x34aae2(0x12b)]()+0x1);}return _0x38e0a0;}async[a111_0x5dcf75(0x13a)](_0x4a5d4b,_0x4e96b7){const _0xba5a73=a111_0x5dcf75,_0x285e39=await this[_0xba5a73(0x130)][_0xba5a73(0x11e)](_0x4a5d4b,Object[_0xba5a73(0x110)](Object[_0xba5a73(0x110)]({},_0x4e96b7),{'updatedAtUtc':new Date()}),{'new':!![]})[_0xba5a73(0x149)]();return _0x285e39[_0xba5a73(0x136)]&&await this[_0xba5a73(0x12e)](_0x4a5d4b,_0x285e39[_0xba5a73(0x136)]),_0x285e39;}async[a111_0x5dcf75(0x146)](_0x4a0909){const _0x250964=a111_0x5dcf75,_0x383356=await this[_0x250964(0x130)]['findByIdAndDelete'](_0x4a0909)[_0x250964(0x149)]();return _0x383356;}async[a111_0x5dcf75(0x121)](_0x3b215c,_0x5e0d0c){const _0x27ac8c=a111_0x5dcf75,_0x4130d5=await this[_0x27ac8c(0x137)](_0x3b215c);_0x4130d5[_0x27ac8c(0x136)][_0x27ac8c(0x13e)](_0x416fda=>_0x416fda[_0x27ac8c(0x138)]()===_0x5e0d0c['getTime']())===-0x1&&_0x4130d5[_0x27ac8c(0x136)]['push'](_0x5e0d0c);const _0x9aa6a=await _0x4130d5['save']();return await this['removeOtherExistingIncludeDates'](_0x3b215c,[_0x5e0d0c]),_0x9aa6a;}async[a111_0x5dcf75(0x12e)](_0x124684,_0x41cefd){const _0x4ea723=a111_0x5dcf75,_0x2eee92=await this[_0x4ea723(0x130)][_0x4ea723(0x148)]({'_id':{'$ne':_0x124684},'includeDates':{'$in':_0x41cefd}})[_0x4ea723(0x149)](),_0x57cbd6=_0x41cefd['map'](_0x1df001=>_0x1df001[_0x4ea723(0x131)]());await Promise[_0x4ea723(0x129)](_0x2eee92[_0x4ea723(0x144)](_0x23806e=>{const _0x189827=_0x4ea723,_0x584445=_0x23806e[_0x189827(0x136)][_0x189827(0x147)](_0x1b2f3d=>!_0x57cbd6[_0x189827(0x135)](_0x1b2f3d[_0x189827(0x131)]()));return _0x23806e[_0x189827(0x136)]=_0x584445,_0x23806e['updatedAtUtc']=new Date(),_0x23806e[_0x189827(0x140)]();}));}async['clone'](_0x2806aa){const _0x13100a=a111_0x5dcf75,_0x1019a0=await this['findOne'](_0x2806aa),_0x30e672=_0x1019a0[_0x13100a(0x112)]['map'](_0x4dd828=>Object['assign'](Object[_0x13100a(0x110)]({},_0x4dd828),{'id':(0x0,utils_1[_0x13100a(0x12f)])()})),_0x19a1a2=new this['scheduleModel'](Object[_0x13100a(0x110)](Object[_0x13100a(0x110)]({},_0x1019a0[_0x13100a(0x13d)]()),{'events':_0x30e672,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x19a1a2[_0x13100a(0x140)]();}};function a111_0x5d3e(_0x15365c,_0xe91eb1){const _0x30027a=a111_0x3002();return a111_0x5d3e=function(_0x5d3e0a,_0x194700){_0x5d3e0a=_0x5d3e0a-0x10d;let _0x156fb0=_0x30027a[_0x5d3e0a];return _0x156fb0;},a111_0x5d3e(_0x15365c,_0xe91eb1);}function a111_0x3002(){const _0x37d2c2=['1022885RiEbjX','@nestjs/mongoose','metadata','setDate','__esModule','ScheduleService','isAfter','all','findEligibleSchedule','getDate','create','454941HDRNFb','removeOtherExistingIncludeDates','uuid','scheduleModel','toISOString','mongoose','__decorate','sort','includes','includeDates','findOne','getTime','__metadata','update','function','startOf','toObject','findIndex','format','save','224ZbEpZu','Model','Schedule','map','../common/utils','remove','filter','find','exec','findAll','createdAtUtc','20991BfaxFK','InjectModel','255548QuDUrE','266RNwuYm','YYYY-MM-DD','decorate','assign','findById','events','defineProperty','length','day','181464WAtBFA','weekDays','@nestjs/common','2131080FytvgL','258168EbxyTQ','toDate','findEligibleScheduleBetween','findAllActiveSchedules','findByIdAndUpdate','object','getOwnPropertyDescriptor','addIncludeDate'];a111_0x3002=function(){return _0x37d2c2;};return a111_0x3002();}ScheduleService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_1[a111_0x5dcf75(0x14d)])(a111_0x5dcf75(0x143))),__metadata('design:paramtypes',[mongoose_2[a111_0x5dcf75(0x142)]])],ScheduleService),exports[a111_0x5dcf75(0x127)]=ScheduleService;