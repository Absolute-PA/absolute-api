'use strict';const a111_0x5f154f=a111_0x480c;(function(_0x1428e5,_0x25604d){const _0x4b5f66=a111_0x480c,_0x199218=_0x1428e5();while(!![]){try{const _0x21d2f7=-parseInt(_0x4b5f66(0xb1))/0x1+parseInt(_0x4b5f66(0xac))/0x2*(-parseInt(_0x4b5f66(0x8d))/0x3)+-parseInt(_0x4b5f66(0xab))/0x4+parseInt(_0x4b5f66(0x88))/0x5*(parseInt(_0x4b5f66(0xb4))/0x6)+parseInt(_0x4b5f66(0xa0))/0x7+-parseInt(_0x4b5f66(0xb7))/0x8+parseInt(_0x4b5f66(0x9f))/0x9*(parseInt(_0x4b5f66(0x90))/0xa);if(_0x21d2f7===_0x25604d)break;else _0x199218['push'](_0x199218['shift']());}catch(_0x36be7e){_0x199218['push'](_0x199218['shift']());}}}(a111_0x3e3e,0x2b133));function a111_0x3e3e(){const _0x5ad2e9=['921882vPbiBH','__metadata','updatedAtUtc','2785520xiipjT','__decorate','exec','YYYY-MM-DD','events','toISOString','clone','Schedule','getTime','__param','Injectable','day','format','10IuYIdc','sort','update','weekDays','includes','3bCHAer','@nestjs/common','getDay','330ocLLXA','map','isAfter','findByIdAndUpdate','../common/utils','includeDates','function','length','@nestjs/mongoose','decorate','find','createdAtUtc','InjectModel','getDate','toObject','185355IESbfC','1183490cHLTpH','save','filter','removeOtherExistingIncludeDates','object','ScheduleService','findOne','addIncludeDate','findById','findAllActiveSchedules','findAll','143260GWSgkS','510244TWQLJQ','scheduleModel','__esModule','push','assign','340437oFNFnO','startOf','dayjs'];a111_0x3e3e=function(){return _0x5ad2e9;};return a111_0x3e3e();}var __decorate=this&&this[a111_0x5f154f(0xb8)]||function(_0x20add1,_0x53bcaf,_0x3766b4,_0x36d9a1){const _0xb12607=a111_0x5f154f;var _0x5813af=arguments[_0xb12607(0x97)],_0x5d8c81=_0x5813af<0x3?_0x53bcaf:_0x36d9a1===null?_0x36d9a1=Object['getOwnPropertyDescriptor'](_0x53bcaf,_0x3766b4):_0x36d9a1,_0x2ede06;if(typeof Reflect==='object'&&typeof Reflect[_0xb12607(0x99)]===_0xb12607(0x96))_0x5d8c81=Reflect['decorate'](_0x20add1,_0x53bcaf,_0x3766b4,_0x36d9a1);else{for(var _0xab759d=_0x20add1[_0xb12607(0x97)]-0x1;_0xab759d>=0x0;_0xab759d--)if(_0x2ede06=_0x20add1[_0xab759d])_0x5d8c81=(_0x5813af<0x3?_0x2ede06(_0x5d8c81):_0x5813af>0x3?_0x2ede06(_0x53bcaf,_0x3766b4,_0x5d8c81):_0x2ede06(_0x53bcaf,_0x3766b4))||_0x5d8c81;}return _0x5813af>0x3&&_0x5d8c81&&Object['defineProperty'](_0x53bcaf,_0x3766b4,_0x5d8c81),_0x5d8c81;},__metadata=this&&this[a111_0x5f154f(0xb5)]||function(_0x40da0a,_0x24bc61){const _0x467019=a111_0x5f154f;if(typeof Reflect===_0x467019(0xa4)&&typeof Reflect['metadata']===_0x467019(0x96))return Reflect['metadata'](_0x40da0a,_0x24bc61);},__param=this&&this[a111_0x5f154f(0x84)]||function(_0x1de162,_0x4e2af7){return function(_0x2f1cac,_0x3dbe62){_0x4e2af7(_0x2f1cac,_0x3dbe62,_0x1de162);};};Object['defineProperty'](exports,a111_0x5f154f(0xae),{'value':!![]}),exports['ScheduleService']=void 0x0;function a111_0x480c(_0x1f4101,_0x4ed68f){const _0x3e3edf=a111_0x3e3e();return a111_0x480c=function(_0x480c98,_0x50d853){_0x480c98=_0x480c98-0x83;let _0x55fd28=_0x3e3edf[_0x480c98];return _0x55fd28;},a111_0x480c(_0x1f4101,_0x4ed68f);}const common_1=require(a111_0x5f154f(0x8e)),mongoose_1=require(a111_0x5f154f(0x98)),mongoose_2=require('mongoose'),dayjs=require(a111_0x5f154f(0xb3)),utils_1=require(a111_0x5f154f(0x94)),schedulePrioritySort=(_0x41c4e0,_0x57c61c)=>dayjs(_0x41c4e0['createdAtUtc'])[a111_0x5f154f(0x92)](dayjs(_0x57c61c[a111_0x5f154f(0x9b)]))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0x1e3beb){const _0x1e3122=a111_0x5f154f;this[_0x1e3122(0xad)]=_0x1e3beb;}async['create'](_0x4c57ff){const _0xd056f6=a111_0x5f154f,_0x35d5a8=new this[(_0xd056f6(0xad))](_0x4c57ff);return _0x35d5a8[_0xd056f6(0xa1)]();}async[a111_0x5f154f(0xaa)](){const _0x7a70cd=a111_0x5f154f,_0x2166bd=await this['scheduleModel'][_0x7a70cd(0x9a)]()[_0x7a70cd(0xb9)]();return _0x2166bd;}async['findOne'](_0x467a5e){const _0x1da2f2=a111_0x5f154f,_0x153c12=await this[_0x1da2f2(0xad)][_0x1da2f2(0xa8)](_0x467a5e);return _0x153c12;}async['findEligibleSchedule'](_0x270e40){const _0xf7bfd9=a111_0x5f154f,_0x240686=await this['findAllActiveSchedules'](_0x270e40),_0x5abb4e=_0x240686[_0xf7bfd9(0xa2)](_0x43e8b1=>_0x43e8b1[_0xf7bfd9(0x95)][_0xf7bfd9(0x97)]>0x0&&_0x43e8b1[_0xf7bfd9(0x95)][_0xf7bfd9(0x91)](_0x56d71d=>dayjs(_0x56d71d)[_0xf7bfd9(0x87)](_0xf7bfd9(0xba)))[_0xf7bfd9(0x8c)](dayjs(_0x270e40)[_0xf7bfd9(0x87)](_0xf7bfd9(0xba))))[_0xf7bfd9(0x89)](schedulePrioritySort);if(_0x5abb4e[_0xf7bfd9(0x97)]>0x0)return _0x5abb4e[0x0];const _0x25ef93=_0x240686[_0xf7bfd9(0xa2)](_0x148d5a=>_0x148d5a[_0xf7bfd9(0x8b)][_0xf7bfd9(0x8c)](_0x270e40[_0xf7bfd9(0x8f)]()))[_0xf7bfd9(0x89)](schedulePrioritySort);if(_0x25ef93['length']>0x0)return _0x25ef93[0x0];return null;}async[a111_0x5f154f(0xa9)](_0x80dfdf){const _0x444a76=a111_0x5f154f,_0x53e687=dayjs(_0x80dfdf)[_0x444a76(0xb2)](_0x444a76(0x86))['toDate'](),_0x554a9d={'$and':[{'$or':[{'startDate':{'$lte':_0x80dfdf},'endDate':{'$gte':_0x80dfdf}},{'startDate':{'$lte':_0x80dfdf},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x80dfdf}}]},{'excludeDates':{'$nin':[_0x53e687]}}]},_0x4efe63=await this['scheduleModel'][_0x444a76(0x9a)](_0x554a9d)['exec']();return _0x4efe63;}async['findEligibleScheduleBetween'](_0x59044a,_0x4b1a36){const _0x2b20ae=a111_0x5f154f,_0x226028=new Date(_0x59044a),_0x23c025={};while(_0x226028<=_0x4b1a36){const _0x3aace7=await this['findEligibleSchedule'](_0x226028);_0x3aace7&&(_0x23c025[dayjs(_0x226028)[_0x2b20ae(0x87)](_0x2b20ae(0xba))]=_0x3aace7),_0x226028['setDate'](_0x226028[_0x2b20ae(0x9d)]()+0x1);}return _0x23c025;}async[a111_0x5f154f(0x8a)](_0x5d7abd,_0x241aa8){const _0x504692=a111_0x5f154f,_0x4e9e8f=await this[_0x504692(0xad)][_0x504692(0x93)](_0x5d7abd,Object[_0x504692(0xb0)](Object[_0x504692(0xb0)]({},_0x241aa8),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x504692(0xb9)]();return _0x4e9e8f[_0x504692(0x95)]&&await this[_0x504692(0xa3)](_0x5d7abd,_0x4e9e8f['includeDates']),_0x4e9e8f;}async['remove'](_0x86679a){const _0xd860a0=a111_0x5f154f,_0xfc316b=await this[_0xd860a0(0xad)]['findByIdAndDelete'](_0x86679a)['exec']();return _0xfc316b;}async[a111_0x5f154f(0xa7)](_0x1fb0e3,_0x574a38){const _0x4a1526=a111_0x5f154f,_0x349e3c=await this[_0x4a1526(0xa6)](_0x1fb0e3);_0x349e3c['includeDates']['findIndex'](_0x205dc9=>_0x205dc9[_0x4a1526(0x83)]()===_0x574a38[_0x4a1526(0x83)]())===-0x1&&_0x349e3c[_0x4a1526(0x95)][_0x4a1526(0xaf)](_0x574a38);const _0x1328e1=await _0x349e3c[_0x4a1526(0xa1)]();return await this['removeOtherExistingIncludeDates'](_0x1fb0e3,[_0x574a38]),_0x1328e1;}async[a111_0x5f154f(0xa3)](_0x36f2ca,_0x93a356){const _0x5bf10a=a111_0x5f154f,_0x305e7d=await this['scheduleModel']['find']({'_id':{'$ne':_0x36f2ca},'includeDates':{'$in':_0x93a356}})[_0x5bf10a(0xb9)](),_0x26a567=_0x93a356[_0x5bf10a(0x91)](_0x8f69fd=>_0x8f69fd['toISOString']());await Promise['all'](_0x305e7d['map'](_0x4e8202=>{const _0x95f6eb=_0x5bf10a,_0x386f39=_0x4e8202[_0x95f6eb(0x95)][_0x95f6eb(0xa2)](_0x591e37=>!_0x26a567[_0x95f6eb(0x8c)](_0x591e37[_0x95f6eb(0xbc)]()));return _0x4e8202[_0x95f6eb(0x95)]=_0x386f39,_0x4e8202[_0x95f6eb(0xb6)]=new Date(),_0x4e8202['save']();}));}async[a111_0x5f154f(0xbd)](_0x30863d){const _0x41a4b2=a111_0x5f154f,_0x25b4b5=await this[_0x41a4b2(0xa6)](_0x30863d),_0x3f74f2=_0x25b4b5[_0x41a4b2(0xbb)]['map'](_0x4330b8=>Object[_0x41a4b2(0xb0)](Object[_0x41a4b2(0xb0)]({},_0x4330b8),{'id':(0x0,utils_1['uuid'])()})),_0xc2558c=new this[(_0x41a4b2(0xad))](Object[_0x41a4b2(0xb0)](Object[_0x41a4b2(0xb0)]({},_0x25b4b5[_0x41a4b2(0x9e)]()),{'events':_0x3f74f2,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0xc2558c[_0x41a4b2(0xa1)]();}};ScheduleService=__decorate([(0x0,common_1[a111_0x5f154f(0x85)])(),__param(0x0,(0x0,mongoose_1[a111_0x5f154f(0x9c)])(a111_0x5f154f(0xbe))),__metadata('design:paramtypes',[mongoose_2['Model']])],ScheduleService),exports[a111_0x5f154f(0xa5)]=ScheduleService;