'use strict';function a108_0x22e9(){const _0x1f62b1=['assign','YYYY-MM-DD','__esModule','weekDays','findEligibleScheduleBetween','isAfter','object','push','exec','findById','includeDates','updatedAtUtc','10LgcKiI','findByIdAndDelete','getDay','length','create','update','find','949RQArre','day','49FmBWnQ','filter','241216DXJLfq','save','toISOString','2234353IduPRD','toObject','1994166JYclGc','66678oZLMJU','metadata','12868yvQUpv','events','removeOtherExistingIncludeDates','decorate','scheduleModel','findByIdAndUpdate','Model','includes','@nestjs/mongoose','__decorate','getTime','findAllActiveSchedules','32sYnhAD','setDate','addIncludeDate','toDate','102DCxSJY','sort','getOwnPropertyDescriptor','findOne','@nestjs/common','design:paramtypes','mongoose','function','../common/utils','defineProperty','format','clone','395130cYVKEv','8EnWPKc','map','createdAtUtc','findIndex','87864gXRccq','__param','dayjs','all','findEligibleSchedule','getDate','ScheduleService'];a108_0x22e9=function(){return _0x1f62b1;};return a108_0x22e9();}const a108_0x527d81=a108_0x5533;(function(_0x428c86,_0x2d88d6){const _0x5e8dd5=a108_0x5533,_0xcbcf18=_0x428c86();while(!![]){try{const _0x5b5b79=parseInt(_0x5e8dd5(0xd1))/0x1+-parseInt(_0x5e8dd5(0xd9))/0x2*(-parseInt(_0x5e8dd5(0xe9))/0x3)+parseInt(_0x5e8dd5(0xe5))/0x4*(-parseInt(_0x5e8dd5(0xae))/0x5)+-parseInt(_0x5e8dd5(0xd7))/0x6*(-parseInt(_0x5e8dd5(0xcf))/0x7)+-parseInt(_0x5e8dd5(0xaf))/0x8*(parseInt(_0x5e8dd5(0xd6))/0x9)+-parseInt(_0x5e8dd5(0xc6))/0xa*(-parseInt(_0x5e8dd5(0xd4))/0xb)+-parseInt(_0x5e8dd5(0xb3))/0xc*(-parseInt(_0x5e8dd5(0xcd))/0xd);if(_0x5b5b79===_0x2d88d6)break;else _0xcbcf18['push'](_0xcbcf18['shift']());}catch(_0x6a9da1){_0xcbcf18['push'](_0xcbcf18['shift']());}}}(a108_0x22e9,0x66eea));var __decorate=this&&this[a108_0x527d81(0xe2)]||function(_0x455514,_0x337a74,_0x5e364e,_0x4e051a){const _0x1b0bd6=a108_0x527d81;var _0x2013a4=arguments[_0x1b0bd6(0xc9)],_0x43fcda=_0x2013a4<0x3?_0x337a74:_0x4e051a===null?_0x4e051a=Object[_0x1b0bd6(0xa4)](_0x337a74,_0x5e364e):_0x4e051a,_0x155352;if(typeof Reflect===_0x1b0bd6(0xc0)&&typeof Reflect['decorate']===_0x1b0bd6(0xa9))_0x43fcda=Reflect[_0x1b0bd6(0xdc)](_0x455514,_0x337a74,_0x5e364e,_0x4e051a);else{for(var _0x527072=_0x455514[_0x1b0bd6(0xc9)]-0x1;_0x527072>=0x0;_0x527072--)if(_0x155352=_0x455514[_0x527072])_0x43fcda=(_0x2013a4<0x3?_0x155352(_0x43fcda):_0x2013a4>0x3?_0x155352(_0x337a74,_0x5e364e,_0x43fcda):_0x155352(_0x337a74,_0x5e364e))||_0x43fcda;}return _0x2013a4>0x3&&_0x43fcda&&Object[_0x1b0bd6(0xab)](_0x337a74,_0x5e364e,_0x43fcda),_0x43fcda;},__metadata=this&&this['__metadata']||function(_0x504267,_0x4c6ab4){const _0x5974d4=a108_0x527d81;if(typeof Reflect===_0x5974d4(0xc0)&&typeof Reflect[_0x5974d4(0xd8)]===_0x5974d4(0xa9))return Reflect['metadata'](_0x504267,_0x4c6ab4);},__param=this&&this[a108_0x527d81(0xb4)]||function(_0x2394a4,_0x2ada20){return function(_0x33120,_0x622220){_0x2ada20(_0x33120,_0x622220,_0x2394a4);};};function a108_0x5533(_0x50424d,_0x270a7a){const _0x22e932=a108_0x22e9();return a108_0x5533=function(_0x553349,_0x367c58){_0x553349=_0x553349-0xa3;let _0x36f2e8=_0x22e932[_0x553349];return _0x36f2e8;},a108_0x5533(_0x50424d,_0x270a7a);}Object['defineProperty'](exports,a108_0x527d81(0xbc),{'value':!![]}),exports[a108_0x527d81(0xb9)]=void 0x0;const common_1=require(a108_0x527d81(0xa6)),mongoose_1=require(a108_0x527d81(0xe1)),mongoose_2=require(a108_0x527d81(0xa8)),dayjs=require(a108_0x527d81(0xb5)),utils_1=require(a108_0x527d81(0xaa)),schedulePrioritySort=(_0x211678,_0x2fa97f)=>dayjs(_0x211678[a108_0x527d81(0xb1)])[a108_0x527d81(0xbf)](dayjs(_0x2fa97f[a108_0x527d81(0xb1)]))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0x887000){const _0x453f60=a108_0x527d81;this[_0x453f60(0xdd)]=_0x887000;}async[a108_0x527d81(0xca)](_0x3e272b){const _0x5ae0e1=a108_0x527d81,_0x341c3f=new this[(_0x5ae0e1(0xdd))](_0x3e272b);return _0x341c3f[_0x5ae0e1(0xd2)]();}async['findAll'](){const _0x243b46=a108_0x527d81,_0x11e6d2=await this[_0x243b46(0xdd)][_0x243b46(0xcc)]()[_0x243b46(0xc2)]();return _0x11e6d2;}async['findOne'](_0x4e7ff9){const _0x5675be=a108_0x527d81,_0x38a49d=await this[_0x5675be(0xdd)][_0x5675be(0xc3)](_0x4e7ff9);return _0x38a49d;}async[a108_0x527d81(0xb7)](_0x5714ef){const _0x340951=a108_0x527d81,_0x1b33d6=await this[_0x340951(0xe4)](_0x5714ef),_0x5e72ff=_0x1b33d6[_0x340951(0xd0)](_0x56e70b=>_0x56e70b['includeDates'][_0x340951(0xc9)]>0x0&&_0x56e70b[_0x340951(0xc4)][_0x340951(0xb0)](_0x110816=>dayjs(_0x110816)[_0x340951(0xac)](_0x340951(0xbb)))[_0x340951(0xe0)](dayjs(_0x5714ef)[_0x340951(0xac)]('YYYY-MM-DD')))[_0x340951(0xa3)](schedulePrioritySort);if(_0x5e72ff[_0x340951(0xc9)]>0x0)return _0x5e72ff[0x0];const _0x59e9cb=_0x1b33d6[_0x340951(0xd0)](_0x397ef5=>_0x397ef5[_0x340951(0xbd)][_0x340951(0xe0)](_0x5714ef[_0x340951(0xc8)]()))[_0x340951(0xa3)](schedulePrioritySort);if(_0x59e9cb[_0x340951(0xc9)]>0x0)return _0x59e9cb[0x0];return null;}async['findAllActiveSchedules'](_0x4b49e7){const _0x5a6f28=a108_0x527d81,_0x14098d=dayjs(_0x4b49e7)['startOf'](_0x5a6f28(0xce))[_0x5a6f28(0xe8)](),_0x2ee666={'$and':[{'$or':[{'startDate':{'$lte':_0x4b49e7},'endDate':{'$gte':_0x4b49e7}},{'startDate':{'$lte':_0x4b49e7},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x4b49e7}}]},{'excludeDates':{'$nin':[_0x14098d]}}]},_0x370a36=await this[_0x5a6f28(0xdd)][_0x5a6f28(0xcc)](_0x2ee666)[_0x5a6f28(0xc2)]();return _0x370a36;}async[a108_0x527d81(0xbe)](_0x197261,_0x12ea6a){const _0x2c7f06=a108_0x527d81,_0x38db7b=new Date(_0x197261),_0xc84932={};while(_0x38db7b<=_0x12ea6a){const _0x34ab5d=await this[_0x2c7f06(0xb7)](_0x38db7b);_0x34ab5d&&(_0xc84932[dayjs(_0x38db7b)[_0x2c7f06(0xac)](_0x2c7f06(0xbb))]=_0x34ab5d),_0x38db7b[_0x2c7f06(0xe6)](_0x38db7b[_0x2c7f06(0xb8)]()+0x1);}return _0xc84932;}async[a108_0x527d81(0xcb)](_0x26ce8d,_0x1e0d3e){const _0x3e43dd=a108_0x527d81,_0x23b51c=await this[_0x3e43dd(0xdd)][_0x3e43dd(0xde)](_0x26ce8d,Object[_0x3e43dd(0xba)](Object[_0x3e43dd(0xba)]({},_0x1e0d3e),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x3e43dd(0xc2)]();return _0x23b51c['includeDates']&&await this[_0x3e43dd(0xdb)](_0x26ce8d,_0x23b51c['includeDates']),_0x23b51c;}async['remove'](_0x491a4c){const _0x4f667b=a108_0x527d81,_0x4955e3=await this[_0x4f667b(0xdd)][_0x4f667b(0xc7)](_0x491a4c)[_0x4f667b(0xc2)]();return _0x4955e3;}async[a108_0x527d81(0xe7)](_0x55fbff,_0x151d66){const _0xe136ee=a108_0x527d81,_0xe9e50a=await this[_0xe136ee(0xa5)](_0x55fbff);_0xe9e50a[_0xe136ee(0xc4)][_0xe136ee(0xb2)](_0x378410=>_0x378410[_0xe136ee(0xe3)]()===_0x151d66['getTime']())===-0x1&&_0xe9e50a['includeDates'][_0xe136ee(0xc1)](_0x151d66);const _0x268e47=await _0xe9e50a[_0xe136ee(0xd2)]();return await this[_0xe136ee(0xdb)](_0x55fbff,[_0x151d66]),_0x268e47;}async[a108_0x527d81(0xdb)](_0x35c933,_0x4d8668){const _0x368ba0=a108_0x527d81,_0x38dfd6=await this[_0x368ba0(0xdd)][_0x368ba0(0xcc)]({'_id':{'$ne':_0x35c933},'includeDates':{'$in':_0x4d8668}})[_0x368ba0(0xc2)](),_0x3f40cd=_0x4d8668[_0x368ba0(0xb0)](_0x15c761=>_0x15c761[_0x368ba0(0xd3)]());await Promise[_0x368ba0(0xb6)](_0x38dfd6[_0x368ba0(0xb0)](_0xf03570=>{const _0x5cebcf=_0x368ba0,_0x6b5e5f=_0xf03570[_0x5cebcf(0xc4)][_0x5cebcf(0xd0)](_0x3fc7a9=>!_0x3f40cd[_0x5cebcf(0xe0)](_0x3fc7a9['toISOString']()));return _0xf03570[_0x5cebcf(0xc4)]=_0x6b5e5f,_0xf03570[_0x5cebcf(0xc5)]=new Date(),_0xf03570['save']();}));}async[a108_0x527d81(0xad)](_0x2e5190){const _0x401818=a108_0x527d81,_0x20f7cf=await this[_0x401818(0xa5)](_0x2e5190),_0x116876=_0x20f7cf[_0x401818(0xda)][_0x401818(0xb0)](_0x232b50=>Object[_0x401818(0xba)](Object[_0x401818(0xba)]({},_0x232b50),{'id':(0x0,utils_1['uuid'])()})),_0x2dab0f=new this['scheduleModel'](Object['assign'](Object[_0x401818(0xba)]({},_0x20f7cf[_0x401818(0xd5)]()),{'events':_0x116876,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x2dab0f['save']();}};ScheduleService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_1['InjectModel'])('Schedule')),__metadata(a108_0x527d81(0xa7),[mongoose_2[a108_0x527d81(0xdf)]])],ScheduleService),exports[a108_0x527d81(0xb9)]=ScheduleService;