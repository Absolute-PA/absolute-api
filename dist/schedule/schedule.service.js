'use strict';const a111_0x93be5f=a111_0x511a;function a111_0x511a(_0x4e3536,_0x341072){const _0x4e62fc=a111_0x4e62();return a111_0x511a=function(_0x511aca,_0x3a9a5c){_0x511aca=_0x511aca-0xfa;let _0x222644=_0x4e62fc[_0x511aca];return _0x222644;},a111_0x511a(_0x4e3536,_0x341072);}function a111_0x4e62(){const _0x2c1dec=['getDay','11ZfeChW','Injectable','10rrMJDc','1839786iGqPFq','__decorate','length','6350722pIWHJz','findEligibleSchedule','findById','243385QmKCqS','createdAtUtc','remove','__metadata','updatedAtUtc','update','findOne','2685596yqsHVi','decorate','scheduleModel','assign','design:paramtypes','findEligibleScheduleBetween','addIncludeDate','toISOString','YYYY-MM-DD','getOwnPropertyDescriptor','getDate','defineProperty','uuid','day','getTime','834320qQFsac','../common/utils','weekDays','toObject','map','clone','setDate','dayjs','findAllActiveSchedules','events','findByIdAndUpdate','metadata','39981520rvBmYb','@nestjs/mongoose','145075UmqXYn','9mgresC','ScheduleService','format','findByIdAndDelete','findAll','exec','startOf','filter','save','InjectModel','12pfmbIw','__param','function','includeDates','removeOtherExistingIncludeDates','all','find','__esModule','includes','create'];a111_0x4e62=function(){return _0x2c1dec;};return a111_0x4e62();}(function(_0x4e721a,_0x31dd7d){const _0x3fbd65=a111_0x511a,_0x134864=_0x4e721a();while(!![]){try{const _0x2b1d10=parseInt(_0x3fbd65(0x119))/0x1*(-parseInt(_0x3fbd65(0x112))/0x2)+-parseInt(_0x3fbd65(0x113))/0x3+-parseInt(_0x3fbd65(0x120))/0x4+-parseInt(_0x3fbd65(0xfa))/0x5*(-parseInt(_0x3fbd65(0x105))/0x6)+-parseInt(_0x3fbd65(0x116))/0x7+parseInt(_0x3fbd65(0x12f))/0x8*(parseInt(_0x3fbd65(0xfb))/0x9)+-parseInt(_0x3fbd65(0x13b))/0xa*(-parseInt(_0x3fbd65(0x110))/0xb);if(_0x2b1d10===_0x31dd7d)break;else _0x134864['push'](_0x134864['shift']());}catch(_0x2c1c27){_0x134864['push'](_0x134864['shift']());}}}(a111_0x4e62,0xb7818));var __decorate=this&&this[a111_0x93be5f(0x114)]||function(_0x610110,_0x3dac43,_0x2d5508,_0x278211){const _0x4b749e=a111_0x93be5f;var _0x45f956=arguments[_0x4b749e(0x115)],_0x22e571=_0x45f956<0x3?_0x3dac43:_0x278211===null?_0x278211=Object[_0x4b749e(0x129)](_0x3dac43,_0x2d5508):_0x278211,_0x421479;if(typeof Reflect==='object'&&typeof Reflect[_0x4b749e(0x121)]===_0x4b749e(0x107))_0x22e571=Reflect['decorate'](_0x610110,_0x3dac43,_0x2d5508,_0x278211);else{for(var _0x43d148=_0x610110[_0x4b749e(0x115)]-0x1;_0x43d148>=0x0;_0x43d148--)if(_0x421479=_0x610110[_0x43d148])_0x22e571=(_0x45f956<0x3?_0x421479(_0x22e571):_0x45f956>0x3?_0x421479(_0x3dac43,_0x2d5508,_0x22e571):_0x421479(_0x3dac43,_0x2d5508))||_0x22e571;}return _0x45f956>0x3&&_0x22e571&&Object[_0x4b749e(0x12b)](_0x3dac43,_0x2d5508,_0x22e571),_0x22e571;},__metadata=this&&this[a111_0x93be5f(0x11c)]||function(_0x345bce,_0x34dce0){const _0x2d2a94=a111_0x93be5f;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x2d2a94(0x107))return Reflect[_0x2d2a94(0x13a)](_0x345bce,_0x34dce0);},__param=this&&this[a111_0x93be5f(0x106)]||function(_0x4c5f30,_0x2f4317){return function(_0x5a5356,_0x28315a){_0x2f4317(_0x5a5356,_0x28315a,_0x4c5f30);};};Object[a111_0x93be5f(0x12b)](exports,a111_0x93be5f(0x10c),{'value':!![]}),exports['ScheduleService']=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a111_0x93be5f(0x13c)),mongoose_2=require('mongoose'),dayjs=require(a111_0x93be5f(0x136)),utils_1=require(a111_0x93be5f(0x130)),schedulePrioritySort=(_0x256c7f,_0x462f88)=>dayjs(_0x256c7f[a111_0x93be5f(0x11a)])['isAfter'](dayjs(_0x462f88[a111_0x93be5f(0x11a)]))?-0x1:0x1;let ScheduleService=class ScheduleService{constructor(_0x414c33){const _0x4f2b9c=a111_0x93be5f;this[_0x4f2b9c(0x122)]=_0x414c33;}async[a111_0x93be5f(0x10e)](_0x3ecf3e){const _0x3b8acd=a111_0x93be5f,_0x3461de=new this[(_0x3b8acd(0x122))](_0x3ecf3e);return _0x3461de[_0x3b8acd(0x103)]();}async[a111_0x93be5f(0xff)](){const _0x3f2a6c=a111_0x93be5f,_0x94a34f=await this[_0x3f2a6c(0x122)][_0x3f2a6c(0x10b)]()['exec']();return _0x94a34f;}async[a111_0x93be5f(0x11f)](_0x3a9387){const _0x23f405=a111_0x93be5f,_0x43c09b=await this['scheduleModel'][_0x23f405(0x118)](_0x3a9387);return _0x43c09b;}async[a111_0x93be5f(0x117)](_0x33ab01){const _0x3e165f=a111_0x93be5f,_0x239b98=await this[_0x3e165f(0x137)](_0x33ab01),_0x251937=_0x239b98[_0x3e165f(0x102)](_0x510578=>_0x510578[_0x3e165f(0x108)][_0x3e165f(0x115)]>0x0&&_0x510578[_0x3e165f(0x108)]['map'](_0x31a9e8=>dayjs(_0x31a9e8)[_0x3e165f(0xfd)](_0x3e165f(0x128)))['includes'](dayjs(_0x33ab01)[_0x3e165f(0xfd)](_0x3e165f(0x128))))['sort'](schedulePrioritySort);if(_0x251937[_0x3e165f(0x115)]>0x0)return _0x251937[0x0];const _0x426859=_0x239b98[_0x3e165f(0x102)](_0x2ab0b0=>_0x2ab0b0[_0x3e165f(0x131)][_0x3e165f(0x10d)](_0x33ab01[_0x3e165f(0x10f)]()))['sort'](schedulePrioritySort);if(_0x426859[_0x3e165f(0x115)]>0x0)return _0x426859[0x0];return null;}async[a111_0x93be5f(0x137)](_0x2640f3){const _0x1c5aff=a111_0x93be5f,_0x5ec1fc=dayjs(_0x2640f3)[_0x1c5aff(0x101)](_0x1c5aff(0x12d))['toDate'](),_0x4b149d={'$and':[{'$or':[{'startDate':{'$lte':_0x2640f3},'endDate':{'$gte':_0x2640f3}},{'startDate':{'$lte':_0x2640f3},'endDate':null},{'startDate':null,'endDate':{'$gte':_0x2640f3}}]},{'excludeDates':{'$nin':[_0x5ec1fc]}}]},_0x3f858b=await this[_0x1c5aff(0x122)][_0x1c5aff(0x10b)](_0x4b149d)[_0x1c5aff(0x100)]();return _0x3f858b;}async[a111_0x93be5f(0x125)](_0x2c060e,_0x151d06){const _0x1cee81=a111_0x93be5f,_0x2b0202=new Date(_0x2c060e),_0x367ec5={};while(_0x2b0202<=_0x151d06){const _0x2b1414=await this[_0x1cee81(0x117)](_0x2b0202);_0x2b1414&&(_0x367ec5[dayjs(_0x2b0202)['format'](_0x1cee81(0x128))]=_0x2b1414),_0x2b0202[_0x1cee81(0x135)](_0x2b0202[_0x1cee81(0x12a)]()+0x1);}return _0x367ec5;}async[a111_0x93be5f(0x11e)](_0x25d5b0,_0x5c3ee1){const _0x471f8b=a111_0x93be5f,_0x23030a=await this[_0x471f8b(0x122)][_0x471f8b(0x139)](_0x25d5b0,Object[_0x471f8b(0x123)](Object[_0x471f8b(0x123)]({},_0x5c3ee1),{'updatedAtUtc':new Date()}),{'new':!![]})[_0x471f8b(0x100)]();return _0x23030a[_0x471f8b(0x108)]&&await this[_0x471f8b(0x109)](_0x25d5b0,_0x23030a[_0x471f8b(0x108)]),_0x23030a;}async[a111_0x93be5f(0x11b)](_0x12dc62){const _0x440d98=a111_0x93be5f,_0x48f41b=await this[_0x440d98(0x122)][_0x440d98(0xfe)](_0x12dc62)['exec']();return _0x48f41b;}async[a111_0x93be5f(0x126)](_0x106c5d,_0x372083){const _0xd0e4bf=a111_0x93be5f,_0x1d1499=await this[_0xd0e4bf(0x11f)](_0x106c5d);_0x1d1499['includeDates']['findIndex'](_0x6f9c71=>_0x6f9c71[_0xd0e4bf(0x12e)]()===_0x372083[_0xd0e4bf(0x12e)]())===-0x1&&_0x1d1499[_0xd0e4bf(0x108)]['push'](_0x372083);const _0xa2571d=await _0x1d1499['save']();return await this[_0xd0e4bf(0x109)](_0x106c5d,[_0x372083]),_0xa2571d;}async[a111_0x93be5f(0x109)](_0x245bf3,_0x411ef7){const _0x5ca78b=a111_0x93be5f,_0x33a3d3=await this[_0x5ca78b(0x122)][_0x5ca78b(0x10b)]({'_id':{'$ne':_0x245bf3},'includeDates':{'$in':_0x411ef7}})['exec'](),_0x2db871=_0x411ef7[_0x5ca78b(0x133)](_0x286c74=>_0x286c74[_0x5ca78b(0x127)]());await Promise[_0x5ca78b(0x10a)](_0x33a3d3[_0x5ca78b(0x133)](_0x38b2ae=>{const _0x507546=_0x5ca78b,_0x2e2f88=_0x38b2ae[_0x507546(0x108)][_0x507546(0x102)](_0x18fb16=>!_0x2db871[_0x507546(0x10d)](_0x18fb16[_0x507546(0x127)]()));return _0x38b2ae[_0x507546(0x108)]=_0x2e2f88,_0x38b2ae[_0x507546(0x11d)]=new Date(),_0x38b2ae[_0x507546(0x103)]();}));}async[a111_0x93be5f(0x134)](_0x441d7f){const _0x4cb255=a111_0x93be5f,_0x1ecf4c=await this[_0x4cb255(0x11f)](_0x441d7f),_0x4add4f=_0x1ecf4c[_0x4cb255(0x138)][_0x4cb255(0x133)](_0x4c4b8e=>Object['assign'](Object[_0x4cb255(0x123)]({},_0x4c4b8e),{'id':(0x0,utils_1[_0x4cb255(0x12c)])()})),_0x52cca6=new this[(_0x4cb255(0x122))](Object[_0x4cb255(0x123)](Object['assign']({},_0x1ecf4c[_0x4cb255(0x132)]()),{'events':_0x4add4f,'_id':undefined,'createdAtUtc':new Date(),'updatedAtUtc':new Date()}));return _0x52cca6[_0x4cb255(0x103)]();}};ScheduleService=__decorate([(0x0,common_1[a111_0x93be5f(0x111)])(),__param(0x0,(0x0,mongoose_1[a111_0x93be5f(0x104)])('Schedule')),__metadata(a111_0x93be5f(0x124),[mongoose_2['Model']])],ScheduleService),exports[a111_0x93be5f(0xfc)]=ScheduleService;