'use strict';const a157_0x39180d=a157_0x177e;(function(_0x278424,_0x2de3a1){const _0x5edac3=a157_0x177e,_0x4be400=_0x278424();while(!![]){try{const _0x362567=parseInt(_0x5edac3(0x8e))/0x1+parseInt(_0x5edac3(0x9b))/0x2*(parseInt(_0x5edac3(0xa8))/0x3)+-parseInt(_0x5edac3(0xa6))/0x4*(-parseInt(_0x5edac3(0xc7))/0x5)+-parseInt(_0x5edac3(0x94))/0x6+-parseInt(_0x5edac3(0x97))/0x7+parseInt(_0x5edac3(0x88))/0x8+parseInt(_0x5edac3(0xba))/0x9*(-parseInt(_0x5edac3(0x86))/0xa);if(_0x362567===_0x2de3a1)break;else _0x4be400['push'](_0x4be400['shift']());}catch(_0x17ae43){_0x4be400['push'](_0x4be400['shift']());}}}(a157_0x4729,0x2dd90));var __decorate=this&&this[a157_0x39180d(0x93)]||function(_0x3b4b1d,_0x197514,_0x3bb0ed,_0x150202){const _0x2047b5=a157_0x39180d;var _0x1d628f=arguments['length'],_0x508967=_0x1d628f<0x3?_0x197514:_0x150202===null?_0x150202=Object[_0x2047b5(0xc4)](_0x197514,_0x3bb0ed):_0x150202,_0x20330b;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x2047b5(0xb6))_0x508967=Reflect['decorate'](_0x3b4b1d,_0x197514,_0x3bb0ed,_0x150202);else{for(var _0xa1a58b=_0x3b4b1d[_0x2047b5(0xac)]-0x1;_0xa1a58b>=0x0;_0xa1a58b--)if(_0x20330b=_0x3b4b1d[_0xa1a58b])_0x508967=(_0x1d628f<0x3?_0x20330b(_0x508967):_0x1d628f>0x3?_0x20330b(_0x197514,_0x3bb0ed,_0x508967):_0x20330b(_0x197514,_0x3bb0ed))||_0x508967;}return _0x1d628f>0x3&&_0x508967&&Object[_0x2047b5(0xaf)](_0x197514,_0x3bb0ed,_0x508967),_0x508967;},__metadata=this&&this[a157_0x39180d(0xab)]||function(_0x1635d6,_0x460c32){const _0x4540b1=a157_0x39180d;if(typeof Reflect===_0x4540b1(0x98)&&typeof Reflect[_0x4540b1(0x8a)]==='function')return Reflect['metadata'](_0x1635d6,_0x460c32);},__param=this&&this['__param']||function(_0x161369,_0x1bcfd3){return function(_0x1eee50,_0x51e7a4){_0x1bcfd3(_0x1eee50,_0x51e7a4,_0x161369);};},UserService_1;Object[a157_0x39180d(0xaf)](exports,a157_0x39180d(0xa0),{'value':!![]}),exports['UserService']=exports[a157_0x39180d(0xc1)]=void 0x0;function a157_0x4729(){const _0x5a1960=['JwtService','Email\x20is\x20exist','JWT_SECRET','save','4BuXoNc','@nestjs/mongoose','18groGqj','InjectModel','findByIdAndUpdate','__metadata','length','select','Injectable','defineProperty','User','Model','roles','deleteOne','absolutePA123@gmail.com','Logger','function','-password','create','@nestjs/common','36choibS','error','username','find','absolutePA123','Master','findUser','MasterUserUsername','env','../auth/verify','getOwnPropertyDescriptor','Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20','userModel','1713755NwjFUi','../setting/constants','SettingService','password','map','../setting/setting.service','1493410lRxNwN','email','2270960wUimbY','onModuleInit','metadata','DEFAULT_MAX_USER','updateUser','DEFAULT_PASSWORD','112150RhNLSw','findOne','userSetting','resetPassword','logger','__decorate','380580RxjgVz','toObject','getAllUser','827001BBcBaW','object','deleteUser','design:paramtypes','75986ktDemr','addUser','delete','maxUser','jwtService','__esModule','settingService'];a157_0x4729=function(){return _0x5a1960;};return a157_0x4729();}const common_1=require(a157_0x39180d(0xb9)),mongoose_1=require('mongoose'),mongoose_2=require(a157_0x39180d(0xa7)),role_enum_1=require('../auth/enums/role.enum'),jwt_1=require('@nestjs/jwt'),verify_1=require(a157_0x39180d(0xc3)),setting_service_1=require(a157_0x39180d(0xcc)),constants_1=require(a157_0x39180d(0xc8));exports[a157_0x39180d(0xc1)]=a157_0x39180d(0xbe);let UserService=UserService_1=class UserService{constructor(_0x2aef4a,_0x3da6fd,_0x7c702c){const _0x2b1dd5=a157_0x39180d;this[_0x2b1dd5(0xc6)]=_0x2aef4a,this[_0x2b1dd5(0x9f)]=_0x3da6fd,this[_0x2b1dd5(0xa1)]=_0x7c702c,this[_0x2b1dd5(0x92)]=new common_1[(_0x2b1dd5(0xb5))](UserService_1['name']);}async[a157_0x39180d(0x9c)](_0x2b00f7){const _0x596890=a157_0x39180d;var _0x2faeaf;const _0x2b6613=await this[_0x596890(0xc6)][_0x596890(0x8f)]({'email':_0x2b00f7[_0x596890(0x87)]});if(_0x2b6613)throw new Error(_0x596890(0xa3));const _0x2cb7e1=(await this[_0x596890(0xc6)][_0x596890(0xbd)]({}))[_0x596890(0xac)],_0x3407e0=((_0x2faeaf=(await this['settingService']['findFirst']())[_0x596890(0x90)])===null||_0x2faeaf===void 0x0?void 0x0:_0x2faeaf[_0x596890(0x9e)])||constants_1[_0x596890(0x8b)];if(_0x2cb7e1>_0x3407e0)throw new Error(_0x596890(0xc5)+_0x3407e0);const _0x88252=await this['userModel'][_0x596890(0xb8)](_0x2b00f7);return _0x88252[_0x596890(0xca)]=await(0x0,verify_1['hash'])(_0x88252[_0x596890(0xca)]),_0x88252[_0x596890(0xa5)]();}async[a157_0x39180d(0xc0)](_0x79212c){const _0x3ef1a9=a157_0x39180d,_0x3f968f=await this[_0x3ef1a9(0xc6)]['findOne']({'username':_0x79212c});return _0x3f968f;}async[a157_0x39180d(0x96)](){const _0x2c6803=a157_0x39180d,_0x17b0b8=await this[_0x2c6803(0xc6)][_0x2c6803(0xbd)]({'roles':{'$ne':role_enum_1['Role'][_0x2c6803(0xbf)]}})[_0x2c6803(0xad)](_0x2c6803(0xb7));return _0x17b0b8[_0x2c6803(0xcb)](_0x47b92d=>({'email':_0x47b92d[_0x2c6803(0x87)],'roles':_0x47b92d[_0x2c6803(0xb2)],'username':_0x47b92d[_0x2c6803(0xbc)],'id':_0x47b92d['id']}));}async[a157_0x39180d(0x8c)](_0x4c5944,_0x18a6ae){const _0x1aa867=a157_0x39180d;try{return await this[_0x1aa867(0xc6)][_0x1aa867(0xaa)](_0x4c5944,_0x18a6ae)[_0x1aa867(0xad)](_0x1aa867(0xb7));}catch(_0x5e0187){this[_0x1aa867(0x92)]['error'](_0x5e0187);return;}}async[a157_0x39180d(0x99)](_0xf248a9){const _0x477652=a157_0x39180d,_0x57d09c=await this[_0x477652(0xc6)]['findById'](_0xf248a9)['select']('-password');if(!_0x57d09c)return;return await _0x57d09c[_0x477652(0xb3)]();}async[a157_0x39180d(0x91)](_0x174f59){const _0x34670f=a157_0x39180d;try{const _0xfe8972=await this[_0x34670f(0xc6)]['findById'](_0x174f59)['select'](_0x34670f(0xb7));if(!_0xfe8972)return;return _0xfe8972[_0x34670f(0xca)]=await(0x0,verify_1['hash'])(process[_0x34670f(0xc2)][_0x34670f(0x8d)]),_0xfe8972[_0x34670f(0xa5)]();}catch(_0x419aaf){this[_0x34670f(0x92)][_0x34670f(0xbb)](_0x419aaf);}}async[a157_0x39180d(0x89)](){const _0x2763f2=a157_0x39180d;try{const _0x48a1c7=await this[_0x2763f2(0xc6)][_0x2763f2(0x8f)]({'username':exports[_0x2763f2(0xc1)]});_0x48a1c7&&await _0x48a1c7[_0x2763f2(0x9d)](),await this['addUser']({'username':exports['MasterUserUsername'],'email':_0x2763f2(0xb4),'roles':[role_enum_1['Role'][_0x2763f2(0xbf)]],'password':process[_0x2763f2(0xc2)]['MASTER_PASSWORD']});}catch(_0x5b1cab){this[_0x2763f2(0x92)][_0x2763f2(0xbb)](_0x5b1cab);throw _0x5b1cab;}}async['getMasterUserAccessToken'](){const _0x5afba8=a157_0x39180d,_0x1d0112=await this[_0x5afba8(0xc6)][_0x5afba8(0x8f)]({'username':exports[_0x5afba8(0xc1)]}),_0x58d971=await this[_0x5afba8(0x9f)]['sign'](_0x1d0112[_0x5afba8(0x95)](),{'secret':process['env'][_0x5afba8(0xa4)]});return _0x58d971;}};function a157_0x177e(_0x9b7a0f,_0x450e56){const _0x472999=a157_0x4729();return a157_0x177e=function(_0x177e11,_0x599bad){_0x177e11=_0x177e11-0x86;let _0x700a65=_0x472999[_0x177e11];return _0x700a65;},a157_0x177e(_0x9b7a0f,_0x450e56);}UserService=UserService_1=__decorate([(0x0,common_1[a157_0x39180d(0xae)])(),__param(0x0,(0x0,mongoose_2[a157_0x39180d(0xa9)])(a157_0x39180d(0xb0))),__metadata(a157_0x39180d(0x9a),[mongoose_1[a157_0x39180d(0xb1)],jwt_1[a157_0x39180d(0xa2)],setting_service_1[a157_0x39180d(0xc9)]])],UserService),exports['UserService']=UserService;