'use strict';const a157_0x286ca2=a157_0x6b03;function a157_0xe582(){const _0x201a1e=['findFirst','deleteUser','error','addUser','__metadata','__param','settingService','1499660XzKTBX','554550WhWGlP','2352721SWcXJB','Email\x20is\x20exist\x20','Master','__esModule','345238fpSlGR','Logger','Role','length','SettingService','../auth/verify','onModuleInit','findById','findByIdAndUpdate','roles','6481928GIvpRm','delete','metadata','JWT_SECRET','__decorate','findOne','findUser','forgotpassword','defineProperty','DefaultAdminUsername','Model','function','MasterUserUsername','-password','397348YBZcCM','find','select','toObject','DefaultAdminPassword','design:paramtypes','@nestjs/jwt','jwtService','absolutePA123','userSetting','Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20','DEFAULT_MAX_USER','name','../setting/constants','InjectModel','updateUser','save','userModel','mongoose','create','151908jqYgRv','getAllUser','sign','email','User','hash','object','logger','decorate','env','password','MASTER_PASSWORD','deleteOne','resetPassword','JwtService','admin@absolutepa','6zPUoci','UserService'];a157_0xe582=function(){return _0x201a1e;};return a157_0xe582();}(function(_0x2907fa,_0x18543b){const _0x38a3b1=a157_0x6b03,_0xe5e5b2=_0x2907fa();while(!![]){try{const _0x320d2c=parseInt(_0x38a3b1(0x1f8))/0x1+-parseInt(_0x38a3b1(0x1d9))/0x2+parseInt(_0x38a3b1(0x1f3))/0x3+-parseInt(_0x38a3b1(0x210))/0x4+parseInt(_0x38a3b1(0x1f2))/0x5+parseInt(_0x38a3b1(0x1e9))/0x6*(parseInt(_0x38a3b1(0x1f4))/0x7)+-parseInt(_0x38a3b1(0x202))/0x8;if(_0x320d2c===_0x18543b)break;else _0xe5e5b2['push'](_0xe5e5b2['shift']());}catch(_0x41589c){_0xe5e5b2['push'](_0xe5e5b2['shift']());}}}(a157_0xe582,0x2c16f));var __decorate=this&&this[a157_0x286ca2(0x206)]||function(_0x48557d,_0x5db167,_0x5aeac3,_0x310f04){const _0x31d568=a157_0x286ca2;var _0x1280a8=arguments[_0x31d568(0x1fb)],_0x65a371=_0x1280a8<0x3?_0x5db167:_0x310f04===null?_0x310f04=Object['getOwnPropertyDescriptor'](_0x5db167,_0x5aeac3):_0x310f04,_0x3cd6c9;if(typeof Reflect===_0x31d568(0x1df)&&typeof Reflect[_0x31d568(0x1e1)]===_0x31d568(0x20d))_0x65a371=Reflect[_0x31d568(0x1e1)](_0x48557d,_0x5db167,_0x5aeac3,_0x310f04);else{for(var _0x314bc2=_0x48557d['length']-0x1;_0x314bc2>=0x0;_0x314bc2--)if(_0x3cd6c9=_0x48557d[_0x314bc2])_0x65a371=(_0x1280a8<0x3?_0x3cd6c9(_0x65a371):_0x1280a8>0x3?_0x3cd6c9(_0x5db167,_0x5aeac3,_0x65a371):_0x3cd6c9(_0x5db167,_0x5aeac3))||_0x65a371;}return _0x1280a8>0x3&&_0x65a371&&Object[_0x31d568(0x20a)](_0x5db167,_0x5aeac3,_0x65a371),_0x65a371;},__metadata=this&&this[a157_0x286ca2(0x1ef)]||function(_0x530b23,_0x1310c4){const _0xc84dc5=a157_0x286ca2;if(typeof Reflect==='object'&&typeof Reflect[_0xc84dc5(0x204)]==='function')return Reflect[_0xc84dc5(0x204)](_0x530b23,_0x1310c4);},__param=this&&this[a157_0x286ca2(0x1f0)]||function(_0x502423,_0x3d09a1){return function(_0x3c5d32,_0x4de524){_0x3d09a1(_0x3c5d32,_0x4de524,_0x502423);};},UserService_1;Object[a157_0x286ca2(0x20a)](exports,a157_0x286ca2(0x1f7),{'value':!![]}),exports[a157_0x286ca2(0x1ea)]=exports[a157_0x286ca2(0x214)]=exports[a157_0x286ca2(0x20b)]=exports['MasterUserUsername']=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a157_0x286ca2(0x222)),mongoose_2=require('@nestjs/mongoose'),role_enum_1=require('../auth/enums/role.enum'),jwt_1=require(a157_0x286ca2(0x216)),verify_1=require(a157_0x286ca2(0x1fd)),setting_service_1=require('../setting/setting.service'),constants_1=require(a157_0x286ca2(0x21d));function a157_0x6b03(_0x4c9615,_0x4eb470){const _0xe5821a=a157_0xe582();return a157_0x6b03=function(_0x6b0300,_0x59e7dd){_0x6b0300=_0x6b0300-0x1d9;let _0x15688f=_0xe5821a[_0x6b0300];return _0x15688f;},a157_0x6b03(_0x4c9615,_0x4eb470);}exports[a157_0x286ca2(0x20e)]=a157_0x286ca2(0x218),exports['DefaultAdminUsername']=a157_0x286ca2(0x1e8),exports[a157_0x286ca2(0x214)]=a157_0x286ca2(0x209);let UserService=UserService_1=class UserService{constructor(_0x3c3654,_0x4c8b76,_0x10b98e){const _0x2aac39=a157_0x286ca2;this[_0x2aac39(0x221)]=_0x3c3654,this[_0x2aac39(0x217)]=_0x4c8b76,this[_0x2aac39(0x1f1)]=_0x10b98e,this[_0x2aac39(0x1e0)]=new common_1[(_0x2aac39(0x1f9))](UserService_1[_0x2aac39(0x21c)]);}async[a157_0x286ca2(0x1ee)](_0x241b52){const _0x178814=a157_0x286ca2;var _0x406b0f;const _0xa2dc8f=await this[_0x178814(0x221)][_0x178814(0x207)]({'email':_0x241b52[_0x178814(0x1dc)]});if(_0xa2dc8f)throw new Error(_0x178814(0x1f5)+_0x241b52['email']);const _0x19e569=(await this['userModel'][_0x178814(0x211)]({}))[_0x178814(0x1fb)],_0x5b158d=((_0x406b0f=(await this['settingService'][_0x178814(0x1eb)]())[_0x178814(0x219)])===null||_0x406b0f===void 0x0?void 0x0:_0x406b0f['maxUser'])||constants_1[_0x178814(0x21b)];if(_0x19e569>_0x5b158d)throw new Error(_0x178814(0x21a)+_0x5b158d);const _0x464d95=await this[_0x178814(0x221)][_0x178814(0x223)](_0x241b52);return _0x464d95[_0x178814(0x1e3)]=await(0x0,verify_1[_0x178814(0x1de)])(_0x464d95[_0x178814(0x1e3)]),_0x464d95[_0x178814(0x220)]();}async[a157_0x286ca2(0x208)](_0x2514eb){const _0x173cf4=a157_0x286ca2,_0x191649=await this['userModel'][_0x173cf4(0x207)]({'username':_0x2514eb});return _0x191649;}async[a157_0x286ca2(0x1da)](){const _0x29762f=a157_0x286ca2,_0x453363=await this[_0x29762f(0x221)][_0x29762f(0x211)]({'roles':{'$ne':role_enum_1[_0x29762f(0x1fa)][_0x29762f(0x1f6)]}})[_0x29762f(0x212)]('-password');return _0x453363['map'](_0x59ead5=>({'email':_0x59ead5[_0x29762f(0x1dc)],'roles':_0x59ead5[_0x29762f(0x201)],'username':_0x59ead5['username'],'id':_0x59ead5['id']}));}async[a157_0x286ca2(0x21f)](_0x3be456,_0x20822a){const _0x53511d=a157_0x286ca2;try{return await this[_0x53511d(0x221)][_0x53511d(0x200)](_0x3be456,_0x20822a)['select'](_0x53511d(0x20f));}catch(_0x293cb7){this['logger'][_0x53511d(0x1ed)](_0x293cb7);return;}}async[a157_0x286ca2(0x1ec)](_0x20dacd){const _0x15fac8=a157_0x286ca2,_0x22c398=await this[_0x15fac8(0x221)][_0x15fac8(0x1ff)](_0x20dacd)[_0x15fac8(0x212)](_0x15fac8(0x20f));if(!_0x22c398)return;return await _0x22c398[_0x15fac8(0x1e5)]();}async[a157_0x286ca2(0x1e6)](_0x18ed73){const _0xee1403=a157_0x286ca2;try{const _0x1dfa33=await this[_0xee1403(0x221)]['findById'](_0x18ed73)[_0xee1403(0x212)]('-password');if(!_0x1dfa33)return;return _0x1dfa33[_0xee1403(0x1e3)]=await(0x0,verify_1['hash'])(process['env']['DEFAULT_PASSWORD']),_0x1dfa33[_0xee1403(0x220)]();}catch(_0x1e1316){this[_0xee1403(0x1e0)][_0xee1403(0x1ed)](_0x1e1316);}}async[a157_0x286ca2(0x1fe)](){const _0x4f0a3d=a157_0x286ca2;try{const _0x39a9b7=await this['userModel'][_0x4f0a3d(0x207)]({'username':exports['MasterUserUsername']});_0x39a9b7&&await _0x39a9b7[_0x4f0a3d(0x203)]();await this[_0x4f0a3d(0x1ee)]({'username':exports[_0x4f0a3d(0x20e)],'email':'absolutePA123@gmail.com','roles':[role_enum_1['Role'][_0x4f0a3d(0x1f6)]],'password':process[_0x4f0a3d(0x1e2)][_0x4f0a3d(0x1e4)]});const _0x3c7b96=await this[_0x4f0a3d(0x221)][_0x4f0a3d(0x207)]({'username':exports[_0x4f0a3d(0x20b)]});_0x3c7b96&&await _0x3c7b96[_0x4f0a3d(0x203)](),await this['addUser']({'username':exports[_0x4f0a3d(0x20b)],'email':'admin@absolutepa','roles':[role_enum_1['Role']['Admin']],'password':exports[_0x4f0a3d(0x214)]});}catch(_0x55f6a4){this['logger'][_0x4f0a3d(0x1ed)](_0x55f6a4);}}async['getMasterUserAccessToken'](){const _0x26725d=a157_0x286ca2,_0x4f0637=await this['userModel'][_0x26725d(0x207)]({'username':exports['MasterUserUsername']}),_0x553cc4=await this['jwtService'][_0x26725d(0x1db)](_0x4f0637[_0x26725d(0x213)](),{'secret':process['env'][_0x26725d(0x205)]});return _0x553cc4;}};UserService=UserService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_2[a157_0x286ca2(0x21e)])(a157_0x286ca2(0x1dd))),__metadata(a157_0x286ca2(0x215),[mongoose_1[a157_0x286ca2(0x20c)],jwt_1[a157_0x286ca2(0x1e7)],setting_service_1[a157_0x286ca2(0x1fc)]])],UserService),exports['UserService']=UserService;