'use strict';const a160_0x428151=a160_0x32d3;(function(_0x1792f9,_0x47f628){const _0x42ff6d=a160_0x32d3,_0x1d4ec1=_0x1792f9();while(!![]){try{const _0x496d84=-parseInt(_0x42ff6d(0xb6))/0x1*(parseInt(_0x42ff6d(0x8e))/0x2)+-parseInt(_0x42ff6d(0x99))/0x3*(-parseInt(_0x42ff6d(0xbf))/0x4)+-parseInt(_0x42ff6d(0xb3))/0x5+parseInt(_0x42ff6d(0x97))/0x6+parseInt(_0x42ff6d(0xa8))/0x7+parseInt(_0x42ff6d(0xb8))/0x8*(-parseInt(_0x42ff6d(0x8b))/0x9)+parseInt(_0x42ff6d(0xb7))/0xa;if(_0x496d84===_0x47f628)break;else _0x1d4ec1['push'](_0x1d4ec1['shift']());}catch(_0x463b8d){_0x1d4ec1['push'](_0x1d4ec1['shift']());}}}(a160_0x9fd1,0xe1b36));function a160_0x9fd1(){const _0x4477cc=['object','sign','InjectModel','decorate','MasterUserUsername','3122649JHPSVh','name','Injectable','26MbCcuw','Master','Logger','find','findOne','onModuleInit','jwtService','deleteUser','defineProperty','62436bvDHJe','userSetting','4107327RTgiZO','metadata','JwtService','DefaultAdminPassword','DefaultAdminUsername','select','DEFAULT_MAX_USER','getOwnPropertyDescriptor','maxUser','hash','findById','getAllUser','@nestjs/mongoose','absolutePA123@gmail.com','__esModule','4729921raTDck','save','../setting/setting.service','env','error','username','function','Admin','findFirst','absolutePA123','length','1874050QBsuVA','userModel','logger','123787lmkfxS','22411370FUFVZl','32FqmrvD','MASTER_PASSWORD','DEFAULT_PASSWORD','settingService','addUser','design:paramtypes','resetPassword','4KXvJtP','../auth/verify','__metadata','@nestjs/jwt','UserService','toObject','email','../setting/constants','mongoose','updateUser','map','getMasterUserAccessToken','admin@absolutepa','delete','password','SettingService','Role','Model','-password'];a160_0x9fd1=function(){return _0x4477cc;};return a160_0x9fd1();}var __decorate=this&&this['__decorate']||function(_0x37f456,_0x43ce94,_0x304c6e,_0x44ea3f){const _0x1c4e3e=a160_0x32d3;var _0x18f639=arguments['length'],_0x4fe525=_0x18f639<0x3?_0x43ce94:_0x44ea3f===null?_0x44ea3f=Object[_0x1c4e3e(0xa0)](_0x43ce94,_0x304c6e):_0x44ea3f,_0x3f2755;if(typeof Reflect===_0x1c4e3e(0x86)&&typeof Reflect[_0x1c4e3e(0x89)]===_0x1c4e3e(0xae))_0x4fe525=Reflect[_0x1c4e3e(0x89)](_0x37f456,_0x43ce94,_0x304c6e,_0x44ea3f);else{for(var _0x20d4ce=_0x37f456['length']-0x1;_0x20d4ce>=0x0;_0x20d4ce--)if(_0x3f2755=_0x37f456[_0x20d4ce])_0x4fe525=(_0x18f639<0x3?_0x3f2755(_0x4fe525):_0x18f639>0x3?_0x3f2755(_0x43ce94,_0x304c6e,_0x4fe525):_0x3f2755(_0x43ce94,_0x304c6e))||_0x4fe525;}return _0x18f639>0x3&&_0x4fe525&&Object[_0x1c4e3e(0x96)](_0x43ce94,_0x304c6e,_0x4fe525),_0x4fe525;},__metadata=this&&this[a160_0x428151(0xc1)]||function(_0x1ce01c,_0xa2ebae){const _0x544dc6=a160_0x428151;if(typeof Reflect===_0x544dc6(0x86)&&typeof Reflect[_0x544dc6(0x9a)]===_0x544dc6(0xae))return Reflect[_0x544dc6(0x9a)](_0x1ce01c,_0xa2ebae);},__param=this&&this['__param']||function(_0x3e90a0,_0x287c39){return function(_0x58d5c7,_0x32142f){_0x287c39(_0x58d5c7,_0x32142f,_0x3e90a0);};},UserService_1;Object[a160_0x428151(0x96)](exports,a160_0x428151(0xa7),{'value':!![]}),exports[a160_0x428151(0x77)]=exports[a160_0x428151(0x9c)]=exports['DefaultAdminUsername']=exports[a160_0x428151(0x8a)]=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a160_0x428151(0x7b)),mongoose_2=require(a160_0x428151(0xa5)),role_enum_1=require('../auth/enums/role.enum'),jwt_1=require(a160_0x428151(0xc2)),verify_1=require(a160_0x428151(0xc0)),setting_service_1=require(a160_0x428151(0xaa)),constants_1=require(a160_0x428151(0x7a));exports[a160_0x428151(0x8a)]=a160_0x428151(0xb1),exports[a160_0x428151(0x9d)]=a160_0x428151(0x7f),exports[a160_0x428151(0x9c)]='forgotpassword';let UserService=UserService_1=class UserService{constructor(_0x277360,_0x51a42f,_0x282748){const _0x12b45e=a160_0x428151;this[_0x12b45e(0xb4)]=_0x277360,this[_0x12b45e(0x94)]=_0x51a42f,this['settingService']=_0x282748,this[_0x12b45e(0xb5)]=new common_1[(_0x12b45e(0x90))](UserService_1[_0x12b45e(0x8c)]);}async[a160_0x428151(0xbc)](_0x448889){const _0x2b9a35=a160_0x428151;var _0x5681ba;const _0x59cd42=await this[_0x2b9a35(0xb4)][_0x2b9a35(0x92)]({'email':_0x448889[_0x2b9a35(0x79)]});if(_0x59cd42)throw new Error('Email\x20is\x20exist\x20'+_0x448889[_0x2b9a35(0x79)]);const _0x56684f=(await this[_0x2b9a35(0xb4)]['find']({}))[_0x2b9a35(0xb2)],_0x50b593=((_0x5681ba=(await this[_0x2b9a35(0xbb)][_0x2b9a35(0xb0)]())[_0x2b9a35(0x98)])===null||_0x5681ba===void 0x0?void 0x0:_0x5681ba[_0x2b9a35(0xa1)])||constants_1[_0x2b9a35(0x9f)];if(_0x56684f>_0x50b593)throw new Error('Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20'+_0x50b593);const _0x585bf0=await this[_0x2b9a35(0xb4)]['create'](_0x448889);return _0x585bf0[_0x2b9a35(0x81)]=await(0x0,verify_1[_0x2b9a35(0xa2)])(_0x585bf0[_0x2b9a35(0x81)]),_0x585bf0[_0x2b9a35(0xa9)]();}async['findUser'](_0x586a54){const _0x3b4f22=await this['userModel']['findOne']({'username':_0x586a54});return _0x3b4f22;}async[a160_0x428151(0xa4)](){const _0x2add36=a160_0x428151,_0x3d8a37=await this[_0x2add36(0xb4)][_0x2add36(0x91)]({'roles':{'$ne':role_enum_1[_0x2add36(0x83)][_0x2add36(0x8f)]}})[_0x2add36(0x9e)]('-password');return _0x3d8a37[_0x2add36(0x7d)](_0x51bc31=>({'email':_0x51bc31[_0x2add36(0x79)],'roles':_0x51bc31['roles'],'username':_0x51bc31[_0x2add36(0xad)],'id':_0x51bc31['id']}));}async[a160_0x428151(0x7c)](_0x48f385,_0x56149b){const _0x5f18df=a160_0x428151;try{return await this[_0x5f18df(0xb4)]['findByIdAndUpdate'](_0x48f385,_0x56149b)[_0x5f18df(0x9e)](_0x5f18df(0x85));}catch(_0x5b42e0){this[_0x5f18df(0xb5)][_0x5f18df(0xac)](_0x5b42e0);return;}}async[a160_0x428151(0x95)](_0x3cf33a){const _0x322657=a160_0x428151,_0x486184=await this['userModel'][_0x322657(0xa3)](_0x3cf33a)['select'](_0x322657(0x85));if(!_0x486184)return;return await _0x486184['deleteOne']();}async[a160_0x428151(0xbe)](_0x39dc4c){const _0x378984=a160_0x428151;try{const _0x29fb9d=await this[_0x378984(0xb4)][_0x378984(0xa3)](_0x39dc4c)[_0x378984(0x9e)](_0x378984(0x85));if(!_0x29fb9d)return;return _0x29fb9d['password']=await(0x0,verify_1['hash'])(process[_0x378984(0xab)][_0x378984(0xba)]),_0x29fb9d[_0x378984(0xa9)]();}catch(_0x333a0c){this['logger'][_0x378984(0xac)](_0x333a0c);}}async[a160_0x428151(0x93)](){const _0x375b0d=a160_0x428151;try{const _0xc46564=await this[_0x375b0d(0xb4)][_0x375b0d(0x92)]({'username':exports[_0x375b0d(0x8a)]});_0xc46564&&await _0xc46564[_0x375b0d(0x80)]();await this[_0x375b0d(0xbc)]({'username':exports[_0x375b0d(0x8a)],'email':_0x375b0d(0xa6),'roles':[role_enum_1[_0x375b0d(0x83)][_0x375b0d(0x8f)]],'password':process['env'][_0x375b0d(0xb9)]});const _0xa17964=await this[_0x375b0d(0xb4)][_0x375b0d(0x92)]({'username':exports[_0x375b0d(0x9d)]});_0xa17964&&await _0xa17964[_0x375b0d(0x80)](),await this[_0x375b0d(0xbc)]({'username':exports[_0x375b0d(0x9d)],'email':'admin@absolutepa','roles':[role_enum_1[_0x375b0d(0x83)][_0x375b0d(0xaf)]],'password':exports[_0x375b0d(0x9c)]});}catch(_0x236462){this[_0x375b0d(0xb5)]['error'](_0x236462);}}async[a160_0x428151(0x7e)](){const _0x2e8ada=a160_0x428151,_0x52cf35=await this[_0x2e8ada(0xb4)][_0x2e8ada(0x92)]({'username':exports['MasterUserUsername']}),_0x4d1c66=await this[_0x2e8ada(0x94)][_0x2e8ada(0x87)](_0x52cf35[_0x2e8ada(0x78)](),{'secret':process['env']['JWT_SECRET']});return _0x4d1c66;}};function a160_0x32d3(_0x5cdbe3,_0x1d8aa0){const _0x9fd1d4=a160_0x9fd1();return a160_0x32d3=function(_0x32d3f9,_0x20b3b0){_0x32d3f9=_0x32d3f9-0x77;let _0x578a8d=_0x9fd1d4[_0x32d3f9];return _0x578a8d;},a160_0x32d3(_0x5cdbe3,_0x1d8aa0);}UserService=UserService_1=__decorate([(0x0,common_1[a160_0x428151(0x8d)])(),__param(0x0,(0x0,mongoose_2[a160_0x428151(0x88)])('User')),__metadata(a160_0x428151(0xbd),[mongoose_1[a160_0x428151(0x84)],jwt_1[a160_0x428151(0x9b)],setting_service_1[a160_0x428151(0x82)]])],UserService),exports['UserService']=UserService;