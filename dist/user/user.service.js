'use strict';const a157_0x83183b=a157_0x292e;function a157_0x292e(_0x35b242,_0x24cbe0){const _0x304f69=a157_0x304f();return a157_0x292e=function(_0x292e9f,_0x437ba7){_0x292e9f=_0x292e9f-0x15b;let _0x4c64a8=_0x304f69[_0x292e9f];return _0x4c64a8;},a157_0x292e(_0x35b242,_0x24cbe0);}(function(_0x5a6bd9,_0x2f438e){const _0x187993=a157_0x292e,_0x1d911e=_0x5a6bd9();while(!![]){try{const _0x26234c=parseInt(_0x187993(0x164))/0x1+parseInt(_0x187993(0x169))/0x2+-parseInt(_0x187993(0x179))/0x3*(-parseInt(_0x187993(0x172))/0x4)+-parseInt(_0x187993(0x16b))/0x5*(-parseInt(_0x187993(0x15e))/0x6)+parseInt(_0x187993(0x180))/0x7+parseInt(_0x187993(0x1a0))/0x8*(-parseInt(_0x187993(0x177))/0x9)+-parseInt(_0x187993(0x199))/0xa;if(_0x26234c===_0x2f438e)break;else _0x1d911e['push'](_0x1d911e['shift']());}catch(_0x4a9e76){_0x1d911e['push'](_0x1d911e['shift']());}}}(a157_0x304f,0xbea7a));var __decorate=this&&this['__decorate']||function(_0x165b6f,_0x1ef636,_0x20719d,_0xb78c04){const _0x18f5cc=a157_0x292e;var _0x23cd36=arguments[_0x18f5cc(0x194)],_0x3da6b2=_0x23cd36<0x3?_0x1ef636:_0xb78c04===null?_0xb78c04=Object[_0x18f5cc(0x15f)](_0x1ef636,_0x20719d):_0xb78c04,_0x31d6ec;if(typeof Reflect===_0x18f5cc(0x17b)&&typeof Reflect[_0x18f5cc(0x16e)]==='function')_0x3da6b2=Reflect[_0x18f5cc(0x16e)](_0x165b6f,_0x1ef636,_0x20719d,_0xb78c04);else{for(var _0xa7f4ce=_0x165b6f['length']-0x1;_0xa7f4ce>=0x0;_0xa7f4ce--)if(_0x31d6ec=_0x165b6f[_0xa7f4ce])_0x3da6b2=(_0x23cd36<0x3?_0x31d6ec(_0x3da6b2):_0x23cd36>0x3?_0x31d6ec(_0x1ef636,_0x20719d,_0x3da6b2):_0x31d6ec(_0x1ef636,_0x20719d))||_0x3da6b2;}return _0x23cd36>0x3&&_0x3da6b2&&Object[_0x18f5cc(0x17f)](_0x1ef636,_0x20719d,_0x3da6b2),_0x3da6b2;},__metadata=this&&this[a157_0x83183b(0x187)]||function(_0x5768c3,_0x34961b){const _0x3243d8=a157_0x83183b;if(typeof Reflect===_0x3243d8(0x17b)&&typeof Reflect['metadata']==='function')return Reflect['metadata'](_0x5768c3,_0x34961b);},__param=this&&this[a157_0x83183b(0x190)]||function(_0x28ba09,_0x1997ae){return function(_0x2d5cb4,_0x414f64){_0x1997ae(_0x2d5cb4,_0x414f64,_0x28ba09);};},UserService_1;Object['defineProperty'](exports,a157_0x83183b(0x189),{'value':!![]}),exports['UserService']=exports[a157_0x83183b(0x178)]=void 0x0;function a157_0x304f(){const _0x2ea770=['absolutePA123','resetPassword','37405250AzCtKX','-password','userSetting','../setting/setting.service','onModuleInit','Master','@nestjs/mongoose','8VJgeVw','findByIdAndUpdate','deleteOne','deleteUser','findById','../auth/verify','138FQbgqs','getOwnPropertyDescriptor','DEFAULT_PASSWORD','toObject','@nestjs/common','map','506089YEctqu','settingService','Logger','name','Model','2407170jvchal','error','298235igIhNB','mongoose','addUser','decorate','userModel','@nestjs/jwt','Role','76sZvlvx','findOne','getMasterUserAccessToken','create','updateUser','1734327MuxqMJ','MasterUserUsername','192273mGVjum','findFirst','object','hash','select','../auth/enums/role.enum','defineProperty','2904062XbMsdn','email','Email\x20is\x20exist','UserService','Injectable','JwtService','../setting/constants','__metadata','jwtService','__esModule','absolutePA123@gmail.com','env','design:paramtypes','InjectModel','save','findUser','__param','SettingService','logger','find','length','sign','password'];a157_0x304f=function(){return _0x2ea770;};return a157_0x304f();}const common_1=require(a157_0x83183b(0x162)),mongoose_1=require(a157_0x83183b(0x16c)),mongoose_2=require(a157_0x83183b(0x19f)),role_enum_1=require(a157_0x83183b(0x17e)),jwt_1=require(a157_0x83183b(0x170)),verify_1=require(a157_0x83183b(0x15d)),setting_service_1=require(a157_0x83183b(0x19c)),constants_1=require(a157_0x83183b(0x186));exports[a157_0x83183b(0x178)]=a157_0x83183b(0x197);let UserService=UserService_1=class UserService{constructor(_0x4bb802,_0x2576d9,_0x313e56){const _0x5cd6cd=a157_0x83183b;this[_0x5cd6cd(0x16f)]=_0x4bb802,this[_0x5cd6cd(0x188)]=_0x2576d9,this[_0x5cd6cd(0x165)]=_0x313e56,this[_0x5cd6cd(0x192)]=new common_1[(_0x5cd6cd(0x166))](UserService_1[_0x5cd6cd(0x167)]);}async[a157_0x83183b(0x16d)](_0x27b14e){const _0x57b8aa=a157_0x83183b;var _0x433210;const _0x4f653d=await this['userModel'][_0x57b8aa(0x173)]({'email':_0x27b14e['email']});if(_0x4f653d)throw new Error(_0x57b8aa(0x182));const _0x3a2b03=(await this['userModel'][_0x57b8aa(0x193)]({}))[_0x57b8aa(0x194)],_0xaaeed0=((_0x433210=(await this[_0x57b8aa(0x165)][_0x57b8aa(0x17a)]())[_0x57b8aa(0x19b)])===null||_0x433210===void 0x0?void 0x0:_0x433210['maxUser'])||constants_1['DEFAULT_MAX_USER'];if(_0x3a2b03>_0xaaeed0)throw new Error('Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20'+_0xaaeed0);const _0x3a5a96=await this['userModel'][_0x57b8aa(0x175)](_0x27b14e);return _0x3a5a96[_0x57b8aa(0x196)]=await(0x0,verify_1['hash'])(_0x3a5a96[_0x57b8aa(0x196)]),_0x3a5a96[_0x57b8aa(0x18e)]();}async[a157_0x83183b(0x18f)](_0x3fd683){const _0x48ce62=a157_0x83183b,_0x5f49d3=await this[_0x48ce62(0x16f)][_0x48ce62(0x173)]({'username':_0x3fd683});return _0x5f49d3;}async['getAllUser'](){const _0x21e939=a157_0x83183b,_0x566d93=await this[_0x21e939(0x16f)][_0x21e939(0x193)]({'roles':{'$ne':role_enum_1[_0x21e939(0x171)]['Master']}})[_0x21e939(0x17d)](_0x21e939(0x19a));return _0x566d93[_0x21e939(0x163)](_0x107562=>({'email':_0x107562[_0x21e939(0x181)],'roles':_0x107562['roles'],'username':_0x107562['username'],'id':_0x107562['id']}));}async[a157_0x83183b(0x176)](_0x299d7a,_0x3f0806){const _0x599926=a157_0x83183b;try{return await this[_0x599926(0x16f)][_0x599926(0x1a1)](_0x299d7a,_0x3f0806)['select']('-password');}catch(_0x2a90a9){this[_0x599926(0x192)]['error'](_0x2a90a9);return;}}async[a157_0x83183b(0x15b)](_0x8ff2bb){const _0x2ac856=a157_0x83183b,_0x3beb08=await this[_0x2ac856(0x16f)][_0x2ac856(0x15c)](_0x8ff2bb)[_0x2ac856(0x17d)](_0x2ac856(0x19a));if(!_0x3beb08)return;return await _0x3beb08[_0x2ac856(0x1a2)]();}async[a157_0x83183b(0x198)](_0x39879a){const _0x15fc85=a157_0x83183b;try{const _0x1660ec=await this[_0x15fc85(0x16f)][_0x15fc85(0x15c)](_0x39879a)['select']('-password');if(!_0x1660ec)return;return _0x1660ec[_0x15fc85(0x196)]=await(0x0,verify_1[_0x15fc85(0x17c)])(process[_0x15fc85(0x18b)][_0x15fc85(0x160)]),_0x1660ec['save']();}catch(_0x412209){this[_0x15fc85(0x192)]['error'](_0x412209);}}async[a157_0x83183b(0x19d)](){const _0x427931=a157_0x83183b;try{const _0x49b852=await this[_0x427931(0x16f)][_0x427931(0x173)]({'username':exports[_0x427931(0x178)]});_0x49b852&&await _0x49b852['delete'](),await this[_0x427931(0x16d)]({'username':exports[_0x427931(0x178)],'email':_0x427931(0x18a),'roles':[role_enum_1[_0x427931(0x171)][_0x427931(0x19e)]],'password':process[_0x427931(0x18b)]['MASTER_PASSWORD']});}catch(_0x3c524f){this['logger'][_0x427931(0x16a)](_0x3c524f);}}async[a157_0x83183b(0x174)](){const _0x458bc2=a157_0x83183b,_0x5cdb7b=await this[_0x458bc2(0x16f)][_0x458bc2(0x173)]({'username':exports[_0x458bc2(0x178)]}),_0x3cb225=await this[_0x458bc2(0x188)][_0x458bc2(0x195)](_0x5cdb7b[_0x458bc2(0x161)](),{'secret':process[_0x458bc2(0x18b)]['JWT_SECRET']});return _0x3cb225;}};UserService=UserService_1=__decorate([(0x0,common_1[a157_0x83183b(0x184)])(),__param(0x0,(0x0,mongoose_2[a157_0x83183b(0x18d)])('User')),__metadata(a157_0x83183b(0x18c),[mongoose_1[a157_0x83183b(0x168)],jwt_1[a157_0x83183b(0x185)],setting_service_1[a157_0x83183b(0x191)]])],UserService),exports[a157_0x83183b(0x183)]=UserService;