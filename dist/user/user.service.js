'use strict';const a157_0x11a823=a157_0x1502;(function(_0x51de41,_0x4b432d){const _0x58396f=a157_0x1502,_0x5467f6=_0x51de41();while(!![]){try{const _0x5bb1cc=-parseInt(_0x58396f(0x147))/0x1*(parseInt(_0x58396f(0x149))/0x2)+parseInt(_0x58396f(0x172))/0x3*(-parseInt(_0x58396f(0x156))/0x4)+-parseInt(_0x58396f(0x148))/0x5*(-parseInt(_0x58396f(0x17c))/0x6)+-parseInt(_0x58396f(0x145))/0x7+parseInt(_0x58396f(0x146))/0x8*(parseInt(_0x58396f(0x173))/0x9)+parseInt(_0x58396f(0x151))/0xa+parseInt(_0x58396f(0x174))/0xb*(parseInt(_0x58396f(0x161))/0xc);if(_0x5bb1cc===_0x4b432d)break;else _0x5467f6['push'](_0x5467f6['shift']());}catch(_0x57b87e){_0x5467f6['push'](_0x5467f6['shift']());}}}(a157_0x3ec6,0x383d6));function a157_0x3ec6(){const _0x20e63d=['1924885SSideG','103574uUFpkt','map','getMasterUserAccessToken','save','findById','../setting/setting.service','MasterUserUsername','DEFAULT_PASSWORD','2999570ozsMEn','error','@nestjs/mongoose','object','Logger','30248ZlbHLz','deleteOne','findUser','JwtService','User','deleteUser','InjectModel','email','decorate','design:paramtypes','Email\x20is\x20exist','966384BDCjgs','delete','maxUser','__decorate','UserService','metadata','findFirst','Model','Master','__metadata','SettingService','env','logger','userSetting','-password','addUser','resetPassword','168mLflkW','1542564YdNkmm','66PKTbpF','Role','roles','mongoose','Injectable','find','password','select','6TiIQyi','toObject','settingService','hash','length','userModel','absolutePA123@gmail.com','findOne','function','username','findByIdAndUpdate','absolutePA123','getAllUser','jwtService','create','3099544pwMSzh','16vDGIiy','8nQpwVM'];a157_0x3ec6=function(){return _0x20e63d;};return a157_0x3ec6();}var __decorate=this&&this[a157_0x11a823(0x164)]||function(_0x942bc6,_0x45fc4e,_0x10042c,_0x4e74e9){const _0x2ec571=a157_0x11a823;var _0x8339c5=arguments[_0x2ec571(0x180)],_0x139e56=_0x8339c5<0x3?_0x45fc4e:_0x4e74e9===null?_0x4e74e9=Object['getOwnPropertyDescriptor'](_0x45fc4e,_0x10042c):_0x4e74e9,_0x1e8cba;if(typeof Reflect===_0x2ec571(0x154)&&typeof Reflect[_0x2ec571(0x15e)]==='function')_0x139e56=Reflect[_0x2ec571(0x15e)](_0x942bc6,_0x45fc4e,_0x10042c,_0x4e74e9);else{for(var _0x3dc62d=_0x942bc6[_0x2ec571(0x180)]-0x1;_0x3dc62d>=0x0;_0x3dc62d--)if(_0x1e8cba=_0x942bc6[_0x3dc62d])_0x139e56=(_0x8339c5<0x3?_0x1e8cba(_0x139e56):_0x8339c5>0x3?_0x1e8cba(_0x45fc4e,_0x10042c,_0x139e56):_0x1e8cba(_0x45fc4e,_0x10042c))||_0x139e56;}return _0x8339c5>0x3&&_0x139e56&&Object['defineProperty'](_0x45fc4e,_0x10042c,_0x139e56),_0x139e56;},__metadata=this&&this[a157_0x11a823(0x16a)]||function(_0x36c2b0,_0x3c6518){const _0x49b302=a157_0x11a823;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x49b302(0x13e))return Reflect[_0x49b302(0x166)](_0x36c2b0,_0x3c6518);},__param=this&&this['__param']||function(_0x525ee4,_0x3f5f12){return function(_0x29ab55,_0x32b11e){_0x3f5f12(_0x29ab55,_0x32b11e,_0x525ee4);};},UserService_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a157_0x11a823(0x165)]=exports[a157_0x11a823(0x14f)]=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a157_0x11a823(0x177)),mongoose_2=require(a157_0x11a823(0x153)),role_enum_1=require('../auth/enums/role.enum'),jwt_1=require('@nestjs/jwt'),verify_1=require('../auth/verify'),setting_service_1=require(a157_0x11a823(0x14e)),constants_1=require('../setting/constants');function a157_0x1502(_0x4402fe,_0x5c2de2){const _0x3ec667=a157_0x3ec6();return a157_0x1502=function(_0x150291,_0x3838b6){_0x150291=_0x150291-0x13c;let _0x2beeac=_0x3ec667[_0x150291];return _0x2beeac;},a157_0x1502(_0x4402fe,_0x5c2de2);}exports[a157_0x11a823(0x14f)]=a157_0x11a823(0x141);let UserService=UserService_1=class UserService{constructor(_0x2bbfc,_0x49eb83,_0x5ddf86){const _0xe3917b=a157_0x11a823;this[_0xe3917b(0x181)]=_0x2bbfc,this['jwtService']=_0x49eb83,this['settingService']=_0x5ddf86,this['logger']=new common_1[(_0xe3917b(0x155))](UserService_1['name']);}async[a157_0x11a823(0x170)](_0x1d4348){const _0x36334d=a157_0x11a823;var _0x109318;const _0x2c8c9c=await this[_0x36334d(0x181)]['findOne']({'email':_0x1d4348['email']});if(_0x2c8c9c)throw new Error(_0x36334d(0x160));const _0x5431be=(await this['userModel'][_0x36334d(0x179)]({}))[_0x36334d(0x180)],_0xa71a23=((_0x109318=(await this[_0x36334d(0x17e)][_0x36334d(0x167)]())[_0x36334d(0x16e)])===null||_0x109318===void 0x0?void 0x0:_0x109318[_0x36334d(0x163)])||constants_1['DEFAULT_MAX_USER'];if(_0x5431be>_0xa71a23)throw new Error('Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20'+_0xa71a23);const _0x58374a=await this[_0x36334d(0x181)][_0x36334d(0x144)](_0x1d4348);return _0x58374a['password']=await(0x0,verify_1[_0x36334d(0x17f)])(_0x58374a['password']),_0x58374a['save']();}async[a157_0x11a823(0x158)](_0x53b817){const _0x425319=a157_0x11a823,_0xcf456a=await this[_0x425319(0x181)][_0x425319(0x13d)]({'username':_0x53b817});return _0xcf456a;}async[a157_0x11a823(0x142)](){const _0x530951=a157_0x11a823,_0x136925=await this[_0x530951(0x181)][_0x530951(0x179)]({'roles':{'$ne':role_enum_1[_0x530951(0x175)][_0x530951(0x169)]}})[_0x530951(0x17b)]('-password');return _0x136925[_0x530951(0x14a)](_0x15b1c6=>({'email':_0x15b1c6[_0x530951(0x15d)],'roles':_0x15b1c6[_0x530951(0x176)],'username':_0x15b1c6[_0x530951(0x13f)],'id':_0x15b1c6['id']}));}async['updateUser'](_0x54cce6,_0x3618f9){const _0x50fdf8=a157_0x11a823;try{return await this[_0x50fdf8(0x181)][_0x50fdf8(0x140)](_0x54cce6,_0x3618f9)['select'](_0x50fdf8(0x16f));}catch(_0x270302){this['logger']['error'](_0x270302);return;}}async[a157_0x11a823(0x15b)](_0x4b3436){const _0x2af201=a157_0x11a823,_0x540a36=await this[_0x2af201(0x181)][_0x2af201(0x14d)](_0x4b3436)[_0x2af201(0x17b)](_0x2af201(0x16f));if(!_0x540a36)return;return await _0x540a36[_0x2af201(0x157)]();}async[a157_0x11a823(0x171)](_0x1360bf){const _0x3bb6ba=a157_0x11a823;try{const _0x5a1a9c=await this['userModel'][_0x3bb6ba(0x14d)](_0x1360bf)[_0x3bb6ba(0x17b)](_0x3bb6ba(0x16f));if(!_0x5a1a9c)return;return _0x5a1a9c[_0x3bb6ba(0x17a)]=await(0x0,verify_1[_0x3bb6ba(0x17f)])(process[_0x3bb6ba(0x16c)][_0x3bb6ba(0x150)]),_0x5a1a9c[_0x3bb6ba(0x14c)]();}catch(_0x2c0c03){this[_0x3bb6ba(0x16d)][_0x3bb6ba(0x152)](_0x2c0c03);}}async['onModuleInit'](){const _0xc7d558=a157_0x11a823;try{const _0x4a0bb2=await this['userModel'][_0xc7d558(0x13d)]({'username':exports[_0xc7d558(0x14f)]});_0x4a0bb2&&await _0x4a0bb2[_0xc7d558(0x162)](),await this[_0xc7d558(0x170)]({'username':exports[_0xc7d558(0x14f)],'email':_0xc7d558(0x13c),'roles':[role_enum_1[_0xc7d558(0x175)][_0xc7d558(0x169)]],'password':process[_0xc7d558(0x16c)]['MASTER_PASSWORD']});}catch(_0x273e4d){this['logger'][_0xc7d558(0x152)](_0x273e4d);throw _0x273e4d;}}async[a157_0x11a823(0x14b)](){const _0x5da88a=a157_0x11a823,_0x73c6c0=await this[_0x5da88a(0x181)][_0x5da88a(0x13d)]({'username':exports[_0x5da88a(0x14f)]}),_0x5f51d9=await this[_0x5da88a(0x143)]['sign'](_0x73c6c0[_0x5da88a(0x17d)](),{'secret':process[_0x5da88a(0x16c)]['JWT_SECRET']});return _0x5f51d9;}};UserService=UserService_1=__decorate([(0x0,common_1[a157_0x11a823(0x178)])(),__param(0x0,(0x0,mongoose_2[a157_0x11a823(0x15c)])(a157_0x11a823(0x15a))),__metadata(a157_0x11a823(0x15f),[mongoose_1[a157_0x11a823(0x168)],jwt_1[a157_0x11a823(0x159)],setting_service_1[a157_0x11a823(0x16b)]])],UserService),exports[a157_0x11a823(0x165)]=UserService;