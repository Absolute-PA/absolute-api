'use strict';const a157_0x3ee318=a157_0x3178;function a157_0x25f5(){const _0x906c59=['delete','@nestjs/jwt','password','userModel','JwtService','Logger','resetPassword','2380904lbgBzf','12856059TaQYyZ','JWT_SECRET','__metadata','InjectModel','select','length','userSetting','save','map','deleteUser','1624cSYkXX','Role','@nestjs/common','DEFAULT_PASSWORD','Injectable','-password','13784XPoKDj','24316fpRGwc','UserService','logger','defineProperty','findById','metadata','design:paramtypes','../setting/setting.service','findByIdAndUpdate','Master','Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20','@nestjs/mongoose','addUser','env','error','email','object','../setting/constants','username','findFirst','absolutePA123@gmail.com','__esModule','jwtService','absolutePA123','onModuleInit','Model','1135843XbYpdm','settingService','Email\x20is\x20exist','updateUser','hash','MASTER_PASSWORD','findUser','7702626NKtumU','MasterUserUsername','../auth/verify','User','sign','findOne','mongoose','find','../auth/enums/role.enum','180AMJqDa','5wGzDph','maxUser','decorate','32403450TyDuow','__param','DEFAULT_MAX_USER','getAllUser','create','deleteOne','function','toObject'];a157_0x25f5=function(){return _0x906c59;};return a157_0x25f5();}(function(_0x15e3f5,_0x1f3f57){const _0x38f2d7=a157_0x3178,_0x19cca5=_0x15e3f5();while(!![]){try{const _0x1312be=-parseInt(_0x38f2d7(0x176))/0x1+-parseInt(_0x38f2d7(0x199))/0x2+-parseInt(_0x38f2d7(0x186))/0x3*(-parseInt(_0x38f2d7(0x15c))/0x4)+-parseInt(_0x38f2d7(0x187))/0x5*(-parseInt(_0x38f2d7(0x17d))/0x6)+parseInt(_0x38f2d7(0x155))/0x7*(-parseInt(_0x38f2d7(0x15b))/0x8)+-parseInt(_0x38f2d7(0x19a))/0x9+parseInt(_0x38f2d7(0x18a))/0xa;if(_0x1312be===_0x1f3f57)break;else _0x19cca5['push'](_0x19cca5['shift']());}catch(_0x4d50ed){_0x19cca5['push'](_0x19cca5['shift']());}}}(a157_0x25f5,0xb34a6));var __decorate=this&&this['__decorate']||function(_0x27fd8a,_0x204417,_0x3e98d5,_0xdcf288){const _0x55639c=a157_0x3178;var _0x272875=arguments[_0x55639c(0x150)],_0x3537cb=_0x272875<0x3?_0x204417:_0xdcf288===null?_0xdcf288=Object['getOwnPropertyDescriptor'](_0x204417,_0x3e98d5):_0xdcf288,_0x27f1b5;if(typeof Reflect===_0x55639c(0x16c)&&typeof Reflect[_0x55639c(0x189)]===_0x55639c(0x190))_0x3537cb=Reflect['decorate'](_0x27fd8a,_0x204417,_0x3e98d5,_0xdcf288);else{for(var _0x47b91c=_0x27fd8a[_0x55639c(0x150)]-0x1;_0x47b91c>=0x0;_0x47b91c--)if(_0x27f1b5=_0x27fd8a[_0x47b91c])_0x3537cb=(_0x272875<0x3?_0x27f1b5(_0x3537cb):_0x272875>0x3?_0x27f1b5(_0x204417,_0x3e98d5,_0x3537cb):_0x27f1b5(_0x204417,_0x3e98d5))||_0x3537cb;}return _0x272875>0x3&&_0x3537cb&&Object['defineProperty'](_0x204417,_0x3e98d5,_0x3537cb),_0x3537cb;},__metadata=this&&this[a157_0x3ee318(0x19c)]||function(_0x37e25f,_0x4762dc){const _0x3e3a61=a157_0x3ee318;if(typeof Reflect===_0x3e3a61(0x16c)&&typeof Reflect['metadata']===_0x3e3a61(0x190))return Reflect[_0x3e3a61(0x161)](_0x37e25f,_0x4762dc);},__param=this&&this[a157_0x3ee318(0x18b)]||function(_0x305a89,_0x4390a5){return function(_0x1f18b3,_0x4440dd){_0x4390a5(_0x1f18b3,_0x4440dd,_0x305a89);};},UserService_1;Object[a157_0x3ee318(0x15f)](exports,a157_0x3ee318(0x171),{'value':!![]}),exports[a157_0x3ee318(0x15d)]=exports[a157_0x3ee318(0x17e)]=void 0x0;function a157_0x3178(_0x31c3e7,_0xe995f){const _0x25f560=a157_0x25f5();return a157_0x3178=function(_0x317822,_0x32243c){_0x317822=_0x317822-0x14f;let _0x145483=_0x25f560[_0x317822];return _0x145483;},a157_0x3178(_0x31c3e7,_0xe995f);}const common_1=require(a157_0x3ee318(0x157)),mongoose_1=require(a157_0x3ee318(0x183)),mongoose_2=require(a157_0x3ee318(0x167)),role_enum_1=require(a157_0x3ee318(0x185)),jwt_1=require(a157_0x3ee318(0x193)),verify_1=require(a157_0x3ee318(0x17f)),setting_service_1=require(a157_0x3ee318(0x163)),constants_1=require(a157_0x3ee318(0x16d));exports[a157_0x3ee318(0x17e)]=a157_0x3ee318(0x173);let UserService=UserService_1=class UserService{constructor(_0x42c6da,_0x3903ca,_0x4c14ac){const _0x5ed36f=a157_0x3ee318;this[_0x5ed36f(0x195)]=_0x42c6da,this[_0x5ed36f(0x172)]=_0x3903ca,this[_0x5ed36f(0x177)]=_0x4c14ac,this[_0x5ed36f(0x15e)]=new common_1[(_0x5ed36f(0x197))](UserService_1['name']);}async['addUser'](_0x3be709){const _0x50f2d1=a157_0x3ee318;var _0x4fca5b;const _0x1a72fb=await this[_0x50f2d1(0x195)][_0x50f2d1(0x182)]({'email':_0x3be709[_0x50f2d1(0x16b)]});if(_0x1a72fb)throw new Error(_0x50f2d1(0x178));const _0x2ea360=(await this['userModel'][_0x50f2d1(0x184)]({}))['length'],_0x47fdbd=((_0x4fca5b=(await this[_0x50f2d1(0x177)][_0x50f2d1(0x16f)]())[_0x50f2d1(0x151)])===null||_0x4fca5b===void 0x0?void 0x0:_0x4fca5b[_0x50f2d1(0x188)])||constants_1[_0x50f2d1(0x18c)];if(_0x2ea360>_0x47fdbd)throw new Error(_0x50f2d1(0x166)+_0x47fdbd);const _0x40186b=await this[_0x50f2d1(0x195)][_0x50f2d1(0x18e)](_0x3be709);return _0x40186b[_0x50f2d1(0x194)]=await(0x0,verify_1[_0x50f2d1(0x17a)])(_0x40186b[_0x50f2d1(0x194)]),_0x40186b['save']();}async[a157_0x3ee318(0x17c)](_0x3679de){const _0x342394=a157_0x3ee318,_0x64b7cb=await this[_0x342394(0x195)]['findOne']({'username':_0x3679de});return _0x64b7cb;}async[a157_0x3ee318(0x18d)](){const _0x41f2b4=a157_0x3ee318,_0x433574=await this[_0x41f2b4(0x195)][_0x41f2b4(0x184)]({'roles':{'$ne':role_enum_1[_0x41f2b4(0x156)]['Master']}})[_0x41f2b4(0x14f)]('-password');return _0x433574[_0x41f2b4(0x153)](_0x4c3383=>({'email':_0x4c3383['email'],'roles':_0x4c3383['roles'],'username':_0x4c3383[_0x41f2b4(0x16e)],'id':_0x4c3383['id']}));}async[a157_0x3ee318(0x179)](_0x4ad99f,_0x5d1397){const _0x2549db=a157_0x3ee318;try{return await this[_0x2549db(0x195)][_0x2549db(0x164)](_0x4ad99f,_0x5d1397)[_0x2549db(0x14f)](_0x2549db(0x15a));}catch(_0x79f1d3){this[_0x2549db(0x15e)][_0x2549db(0x16a)](_0x79f1d3);return;}}async[a157_0x3ee318(0x154)](_0x4a894d){const _0x22c8e7=a157_0x3ee318,_0x58bb4d=await this[_0x22c8e7(0x195)][_0x22c8e7(0x160)](_0x4a894d)[_0x22c8e7(0x14f)](_0x22c8e7(0x15a));if(!_0x58bb4d)return;return await _0x58bb4d[_0x22c8e7(0x18f)]();}async[a157_0x3ee318(0x198)](_0x384a69){const _0x4e7fe6=a157_0x3ee318;try{const _0x51df47=await this['userModel']['findById'](_0x384a69)[_0x4e7fe6(0x14f)](_0x4e7fe6(0x15a));if(!_0x51df47)return;return _0x51df47['password']=await(0x0,verify_1[_0x4e7fe6(0x17a)])(process[_0x4e7fe6(0x169)][_0x4e7fe6(0x158)]),_0x51df47[_0x4e7fe6(0x152)]();}catch(_0x3f3c86){this[_0x4e7fe6(0x15e)]['error'](_0x3f3c86);}}async[a157_0x3ee318(0x174)](){const _0x1567c3=a157_0x3ee318;try{const _0x3d66fb=await this[_0x1567c3(0x195)][_0x1567c3(0x182)]({'username':exports['MasterUserUsername']});_0x3d66fb&&await _0x3d66fb[_0x1567c3(0x192)](),await this[_0x1567c3(0x168)]({'username':exports[_0x1567c3(0x17e)],'email':_0x1567c3(0x170),'roles':[role_enum_1['Role'][_0x1567c3(0x165)]],'password':process[_0x1567c3(0x169)][_0x1567c3(0x17b)]});}catch(_0x4a228a){this[_0x1567c3(0x15e)][_0x1567c3(0x16a)](_0x4a228a);throw _0x4a228a;}}async['getMasterUserAccessToken'](){const _0x66ef13=a157_0x3ee318,_0x533140=await this[_0x66ef13(0x195)]['findOne']({'username':exports[_0x66ef13(0x17e)]}),_0x14bce4=await this[_0x66ef13(0x172)][_0x66ef13(0x181)](_0x533140[_0x66ef13(0x191)](),{'secret':process['env'][_0x66ef13(0x19b)]});return _0x14bce4;}};UserService=UserService_1=__decorate([(0x0,common_1[a157_0x3ee318(0x159)])(),__param(0x0,(0x0,mongoose_2[a157_0x3ee318(0x19d)])(a157_0x3ee318(0x180))),__metadata(a157_0x3ee318(0x162),[mongoose_1[a157_0x3ee318(0x175)],jwt_1[a157_0x3ee318(0x196)],setting_service_1['SettingService']])],UserService),exports[a157_0x3ee318(0x15d)]=UserService;