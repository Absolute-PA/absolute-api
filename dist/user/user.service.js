'use strict';const a157_0x3a357d=a157_0x292a;(function(_0x31743b,_0x3b8afb){const _0x32e6cd=a157_0x292a,_0x5313ac=_0x31743b();while(!![]){try{const _0x5e2d22=parseInt(_0x32e6cd(0x153))/0x1*(parseInt(_0x32e6cd(0x145))/0x2)+parseInt(_0x32e6cd(0x132))/0x3*(-parseInt(_0x32e6cd(0x150))/0x4)+-parseInt(_0x32e6cd(0x138))/0x5*(-parseInt(_0x32e6cd(0x133))/0x6)+parseInt(_0x32e6cd(0x131))/0x7*(-parseInt(_0x32e6cd(0x113))/0x8)+parseInt(_0x32e6cd(0x14c))/0x9*(-parseInt(_0x32e6cd(0x11b))/0xa)+parseInt(_0x32e6cd(0x11f))/0xb+parseInt(_0x32e6cd(0x13b))/0xc*(parseInt(_0x32e6cd(0x13f))/0xd);if(_0x5e2d22===_0x3b8afb)break;else _0x5313ac['push'](_0x5313ac['shift']());}catch(_0x4a8d10){_0x5313ac['push'](_0x5313ac['shift']());}}}(a157_0x566d,0xb9006));var __decorate=this&&this[a157_0x3a357d(0x12b)]||function(_0x3a8a7e,_0x58724c,_0x5718c3,_0x5c1703){const _0x51a41b=a157_0x3a357d;var _0x34ee29=arguments[_0x51a41b(0x139)],_0x2e8f07=_0x34ee29<0x3?_0x58724c:_0x5c1703===null?_0x5c1703=Object[_0x51a41b(0x116)](_0x58724c,_0x5718c3):_0x5c1703,_0x1d0393;if(typeof Reflect==='object'&&typeof Reflect[_0x51a41b(0x135)]===_0x51a41b(0x118))_0x2e8f07=Reflect[_0x51a41b(0x135)](_0x3a8a7e,_0x58724c,_0x5718c3,_0x5c1703);else{for(var _0x9d96f2=_0x3a8a7e[_0x51a41b(0x139)]-0x1;_0x9d96f2>=0x0;_0x9d96f2--)if(_0x1d0393=_0x3a8a7e[_0x9d96f2])_0x2e8f07=(_0x34ee29<0x3?_0x1d0393(_0x2e8f07):_0x34ee29>0x3?_0x1d0393(_0x58724c,_0x5718c3,_0x2e8f07):_0x1d0393(_0x58724c,_0x5718c3))||_0x2e8f07;}return _0x34ee29>0x3&&_0x2e8f07&&Object[_0x51a41b(0x10f)](_0x58724c,_0x5718c3,_0x2e8f07),_0x2e8f07;},__metadata=this&&this[a157_0x3a357d(0x120)]||function(_0x367bf3,_0x1b1cc1){if(typeof Reflect==='object'&&typeof Reflect['metadata']==='function')return Reflect['metadata'](_0x367bf3,_0x1b1cc1);},__param=this&&this['__param']||function(_0x4cc1a5,_0x43d9a2){return function(_0x3fea2f,_0x273c67){_0x43d9a2(_0x3fea2f,_0x273c67,_0x4cc1a5);};},UserService_1;Object[a157_0x3a357d(0x10f)](exports,a157_0x3a357d(0x115),{'value':!![]}),exports[a157_0x3a357d(0x110)]=exports[a157_0x3a357d(0x10e)]=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a157_0x3a357d(0x157)),mongoose_2=require(a157_0x3a357d(0x11e)),role_enum_1=require('../auth/enums/role.enum'),jwt_1=require(a157_0x3a357d(0x152)),verify_1=require('../auth/verify'),setting_service_1=require(a157_0x3a357d(0x130)),constants_1=require(a157_0x3a357d(0x12a));function a157_0x292a(_0x32d012,_0x35ec84){const _0x566d3=a157_0x566d();return a157_0x292a=function(_0x292aa1,_0x1b073b){_0x292aa1=_0x292aa1-0x10d;let _0x368a2a=_0x566d3[_0x292aa1];return _0x368a2a;},a157_0x292a(_0x32d012,_0x35ec84);}exports[a157_0x3a357d(0x10e)]=a157_0x3a357d(0x122);let UserService=UserService_1=class UserService{constructor(_0x4490eb,_0x4c582e,_0x49a9e0){const _0x57fe39=a157_0x3a357d;this['userModel']=_0x4490eb,this[_0x57fe39(0x141)]=_0x4c582e,this[_0x57fe39(0x127)]=_0x49a9e0,this['logger']=new common_1[(_0x57fe39(0x14a))](UserService_1[_0x57fe39(0x142)]);}async[a157_0x3a357d(0x154)](_0x1f5699){const _0x3a189d=a157_0x3a357d;var _0x244f90;const _0x40619e=await this['userModel'][_0x3a189d(0x126)]({'email':_0x1f5699[_0x3a189d(0x11c)]});if(_0x40619e)throw new Error('Email\x20is\x20exist');const _0x56adfb=(await this[_0x3a189d(0x14f)][_0x3a189d(0x13c)]({}))[_0x3a189d(0x139)],_0x3617e6=((_0x244f90=(await this[_0x3a189d(0x127)][_0x3a189d(0x10d)]())[_0x3a189d(0x144)])===null||_0x244f90===void 0x0?void 0x0:_0x244f90[_0x3a189d(0x14e)])||constants_1[_0x3a189d(0x143)];if(_0x56adfb>_0x3617e6)throw new Error(_0x3a189d(0x146)+_0x3617e6);const _0x12cf68=await this[_0x3a189d(0x14f)][_0x3a189d(0x12f)](_0x1f5699);return _0x12cf68[_0x3a189d(0x12e)]=await(0x0,verify_1['hash'])(_0x12cf68[_0x3a189d(0x12e)]),_0x12cf68[_0x3a189d(0x111)]();}async[a157_0x3a357d(0x148)](_0x49ef70){const _0x53cce5=a157_0x3a357d,_0x495f5e=await this[_0x53cce5(0x14f)][_0x53cce5(0x126)]({'username':_0x49ef70});return _0x495f5e;}async[a157_0x3a357d(0x128)](){const _0x20e035=a157_0x3a357d,_0x18d073=await this[_0x20e035(0x14f)][_0x20e035(0x13c)]({'roles':{'$ne':role_enum_1[_0x20e035(0x112)][_0x20e035(0x11d)]}})[_0x20e035(0x117)]('-password');return _0x18d073[_0x20e035(0x140)](_0x34306b=>({'email':_0x34306b['email'],'roles':_0x34306b[_0x20e035(0x13a)],'username':_0x34306b['username'],'id':_0x34306b['id']}));}async[a157_0x3a357d(0x134)](_0x5286eb,_0x4b7f7a){const _0x24d8d9=a157_0x3a357d;try{return await this[_0x24d8d9(0x14f)][_0x24d8d9(0x151)](_0x5286eb,_0x4b7f7a)[_0x24d8d9(0x117)](_0x24d8d9(0x12c));}catch(_0x30d994){this[_0x24d8d9(0x14b)][_0x24d8d9(0x129)](_0x30d994);return;}}async[a157_0x3a357d(0x124)](_0x390d3d){const _0x2cbeda=a157_0x3a357d,_0x348c39=await this[_0x2cbeda(0x14f)]['findById'](_0x390d3d)[_0x2cbeda(0x117)]('-password');if(!_0x348c39)return;return await _0x348c39['deleteOne']();}async[a157_0x3a357d(0x121)](_0x13cdf9){const _0x581bdf=a157_0x3a357d;try{const _0x25aec9=await this[_0x581bdf(0x14f)][_0x581bdf(0x13e)](_0x13cdf9)[_0x581bdf(0x117)](_0x581bdf(0x12c));if(!_0x25aec9)return;return _0x25aec9[_0x581bdf(0x12e)]=await(0x0,verify_1[_0x581bdf(0x125)])(process[_0x581bdf(0x12d)][_0x581bdf(0x13d)]),_0x25aec9[_0x581bdf(0x111)]();}catch(_0x33ac34){this[_0x581bdf(0x14b)][_0x581bdf(0x129)](_0x33ac34);}}async['onModuleInit'](){const _0x41d072=a157_0x3a357d;try{const _0xd6d1cc=await this[_0x41d072(0x14f)]['findOne']({'username':exports[_0x41d072(0x10e)]});_0xd6d1cc&&await _0xd6d1cc[_0x41d072(0x114)](),await this['addUser']({'username':exports['MasterUserUsername'],'email':_0x41d072(0x155),'roles':[role_enum_1[_0x41d072(0x112)]['Master']],'password':process[_0x41d072(0x12d)][_0x41d072(0x147)]});}catch(_0x4da5ac){this[_0x41d072(0x14b)][_0x41d072(0x129)](_0x4da5ac);throw _0x4da5ac;}}async[a157_0x3a357d(0x156)](){const _0x1b94f6=a157_0x3a357d,_0x39afb9=await this[_0x1b94f6(0x14f)][_0x1b94f6(0x126)]({'username':exports[_0x1b94f6(0x10e)]}),_0x5ce372=await this['jwtService'][_0x1b94f6(0x119)](_0x39afb9[_0x1b94f6(0x137)](),{'secret':process[_0x1b94f6(0x12d)]['JWT_SECRET']});return _0x5ce372;}};function a157_0x566d(){const _0x5e5d0c=['Role','10074072uMczFA','delete','__esModule','getOwnPropertyDescriptor','select','function','sign','Injectable','9950ninFfS','email','Master','@nestjs/mongoose','6776594QCSdiU','__metadata','resetPassword','absolutePA123','Model','deleteUser','hash','findOne','settingService','getAllUser','error','../setting/constants','__decorate','-password','env','password','create','../setting/setting.service','7UltDgk','67839HYqmQI','3958782odChIi','updateUser','decorate','JwtService','toObject','5nveqOP','length','roles','12984RLHmcR','find','DEFAULT_PASSWORD','findById','13858wojyas','map','jwtService','name','DEFAULT_MAX_USER','userSetting','120322sJPpBh','Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20','MASTER_PASSWORD','findUser','InjectModel','Logger','logger','7596MpCWLn','design:paramtypes','maxUser','userModel','84MJyOGr','findByIdAndUpdate','@nestjs/jwt','15siMQKU','addUser','absolutePA123@gmail.com','getMasterUserAccessToken','mongoose','User','SettingService','findFirst','MasterUserUsername','defineProperty','UserService','save'];a157_0x566d=function(){return _0x5e5d0c;};return a157_0x566d();}UserService=UserService_1=__decorate([(0x0,common_1[a157_0x3a357d(0x11a)])(),__param(0x0,(0x0,mongoose_2[a157_0x3a357d(0x149)])(a157_0x3a357d(0x158))),__metadata(a157_0x3a357d(0x14d),[mongoose_1[a157_0x3a357d(0x123)],jwt_1[a157_0x3a357d(0x136)],setting_service_1[a157_0x3a357d(0x159)]])],UserService),exports['UserService']=UserService;