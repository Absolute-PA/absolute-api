'use strict';const a160_0x2c5417=a160_0xbaae;(function(_0x103f40,_0x509396){const _0x3fa1a4=a160_0xbaae,_0x5ced45=_0x103f40();while(!![]){try{const _0x2ccfef=-parseInt(_0x3fa1a4(0x19f))/0x1*(parseInt(_0x3fa1a4(0x187))/0x2)+parseInt(_0x3fa1a4(0x180))/0x3*(-parseInt(_0x3fa1a4(0x191))/0x4)+parseInt(_0x3fa1a4(0x1bf))/0x5*(parseInt(_0x3fa1a4(0x196))/0x6)+-parseInt(_0x3fa1a4(0x1aa))/0x7*(parseInt(_0x3fa1a4(0x18b))/0x8)+parseInt(_0x3fa1a4(0x199))/0x9+-parseInt(_0x3fa1a4(0x1ba))/0xa+parseInt(_0x3fa1a4(0x178))/0xb;if(_0x2ccfef===_0x509396)break;else _0x5ced45['push'](_0x5ced45['shift']());}catch(_0x5d370){_0x5ced45['push'](_0x5ced45['shift']());}}}(a160_0x2df1,0xeb3f5));var __decorate=this&&this[a160_0x2c5417(0x1b9)]||function(_0x28ce8f,_0x5edf17,_0xe40fcd,_0x580286){const _0x3781b5=a160_0x2c5417;var _0x2172a3=arguments['length'],_0x131ee9=_0x2172a3<0x3?_0x5edf17:_0x580286===null?_0x580286=Object[_0x3781b5(0x183)](_0x5edf17,_0xe40fcd):_0x580286,_0x512c00;if(typeof Reflect===_0x3781b5(0x1a3)&&typeof Reflect[_0x3781b5(0x1a6)]===_0x3781b5(0x194))_0x131ee9=Reflect['decorate'](_0x28ce8f,_0x5edf17,_0xe40fcd,_0x580286);else{for(var _0x117888=_0x28ce8f['length']-0x1;_0x117888>=0x0;_0x117888--)if(_0x512c00=_0x28ce8f[_0x117888])_0x131ee9=(_0x2172a3<0x3?_0x512c00(_0x131ee9):_0x2172a3>0x3?_0x512c00(_0x5edf17,_0xe40fcd,_0x131ee9):_0x512c00(_0x5edf17,_0xe40fcd))||_0x131ee9;}return _0x2172a3>0x3&&_0x131ee9&&Object[_0x3781b5(0x1b3)](_0x5edf17,_0xe40fcd,_0x131ee9),_0x131ee9;},__metadata=this&&this[a160_0x2c5417(0x184)]||function(_0x386ade,_0x3cb8ab){const _0xc8970=a160_0x2c5417;if(typeof Reflect===_0xc8970(0x1a3)&&typeof Reflect[_0xc8970(0x189)]==='function')return Reflect[_0xc8970(0x189)](_0x386ade,_0x3cb8ab);},__param=this&&this[a160_0x2c5417(0x1a9)]||function(_0x356888,_0x1a6d8d){return function(_0x36a54a,_0x504223){_0x1a6d8d(_0x36a54a,_0x504223,_0x356888);};},UserService_1;Object[a160_0x2c5417(0x1b3)](exports,a160_0x2c5417(0x1ae),{'value':!![]}),exports[a160_0x2c5417(0x1b6)]=exports[a160_0x2c5417(0x18d)]=exports['DefaultAdminUsername']=exports[a160_0x2c5417(0x1ad)]=void 0x0;const common_1=require(a160_0x2c5417(0x17b)),mongoose_1=require(a160_0x2c5417(0x197)),mongoose_2=require('@nestjs/mongoose'),role_enum_1=require(a160_0x2c5417(0x1be)),jwt_1=require('@nestjs/jwt'),verify_1=require(a160_0x2c5417(0x1c0)),setting_service_1=require(a160_0x2c5417(0x1bd)),constants_1=require(a160_0x2c5417(0x1a2));function a160_0x2df1(){const _0x527351=['create','function','deleteUser','10287798FzVxSe','mongoose','findFirst','6375402FzUROn','User','maxUser','Role','userModel','email','55SdGqsw','InjectModel','hash','../setting/constants','object','addUser','jwtService','decorate','SettingService','env','__param','77uMqjZI','Master','-password','MasterUserUsername','__esModule','findById','getMasterUserAccessToken','admin@absolutepa','absolutePA123@gmail.com','defineProperty','select','map','UserService','logger','findOne','__decorate','10737510olPyYL','username','JWT_SECRET','../setting/setting.service','../auth/enums/role.enum','5xHjeuL','../auth/verify','deleteOne','settingService','45611005exZMRL','forgotpassword','password','@nestjs/common','updateUser','Model','error','save','3rryWbD','resetPassword','roles','getOwnPropertyDescriptor','__metadata','userSetting','design:paramtypes','54318gFRbrG','find','metadata','getAllUser','1212472oSRrHF','DEFAULT_PASSWORD','DefaultAdminPassword','DefaultAdminUsername','absolutePA123','toObject','5484992WuDPIp','DEFAULT_MAX_USER'];a160_0x2df1=function(){return _0x527351;};return a160_0x2df1();}exports['MasterUserUsername']=a160_0x2c5417(0x18f),exports[a160_0x2c5417(0x18e)]=a160_0x2c5417(0x1b1),exports['DefaultAdminPassword']=a160_0x2c5417(0x179);function a160_0xbaae(_0x1c1720,_0x590de4){const _0x2df1fe=a160_0x2df1();return a160_0xbaae=function(_0xbaaef9,_0x14b5e1){_0xbaaef9=_0xbaaef9-0x178;let _0x53d958=_0x2df1fe[_0xbaaef9];return _0x53d958;},a160_0xbaae(_0x1c1720,_0x590de4);}let UserService=UserService_1=class UserService{constructor(_0x101038,_0x3c8276,_0x4a7754){const _0x424a7f=a160_0x2c5417;this[_0x424a7f(0x19d)]=_0x101038,this[_0x424a7f(0x1a5)]=_0x3c8276,this[_0x424a7f(0x1c2)]=_0x4a7754,this[_0x424a7f(0x1b7)]=new common_1['Logger'](UserService_1['name']);}async[a160_0x2c5417(0x1a4)](_0x2aea3a){const _0x52b034=a160_0x2c5417;var _0x3f0d99;const _0x4fb80c=await this[_0x52b034(0x19d)][_0x52b034(0x1b8)]({'email':_0x2aea3a[_0x52b034(0x19e)]});if(_0x4fb80c)throw new Error('Email\x20is\x20exist\x20'+_0x2aea3a[_0x52b034(0x19e)]);const _0x140cca=(await this[_0x52b034(0x19d)]['find']({}))['length'],_0x532306=((_0x3f0d99=(await this[_0x52b034(0x1c2)][_0x52b034(0x198)]())[_0x52b034(0x185)])===null||_0x3f0d99===void 0x0?void 0x0:_0x3f0d99[_0x52b034(0x19b)])||constants_1[_0x52b034(0x192)];if(_0x140cca>_0x532306)throw new Error('Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20'+_0x532306);const _0x546093=await this['userModel'][_0x52b034(0x193)](_0x2aea3a);return _0x546093['password']=await(0x0,verify_1[_0x52b034(0x1a1)])(_0x546093[_0x52b034(0x17a)]),_0x546093[_0x52b034(0x17f)]();}async['findUser'](_0x2d91f2){const _0xd5ac79=a160_0x2c5417,_0x3b216c=await this[_0xd5ac79(0x19d)][_0xd5ac79(0x1b8)]({'username':_0x2d91f2});return _0x3b216c;}async[a160_0x2c5417(0x18a)](){const _0x23905e=a160_0x2c5417,_0x3cc2ab=await this['userModel'][_0x23905e(0x188)]({'roles':{'$ne':role_enum_1[_0x23905e(0x19c)][_0x23905e(0x1ab)]}})[_0x23905e(0x1b4)](_0x23905e(0x1ac));return _0x3cc2ab[_0x23905e(0x1b5)](_0x3df7a7=>({'email':_0x3df7a7[_0x23905e(0x19e)],'roles':_0x3df7a7[_0x23905e(0x182)],'username':_0x3df7a7[_0x23905e(0x1bb)],'id':_0x3df7a7['id']}));}async[a160_0x2c5417(0x17c)](_0x14b8d5,_0x112435){const _0xf780b=a160_0x2c5417;try{return await this[_0xf780b(0x19d)]['findByIdAndUpdate'](_0x14b8d5,_0x112435)[_0xf780b(0x1b4)](_0xf780b(0x1ac));}catch(_0x14be83){this[_0xf780b(0x1b7)]['error'](_0x14be83);return;}}async[a160_0x2c5417(0x195)](_0x22dde7){const _0x2860e4=a160_0x2c5417,_0x1b5198=await this['userModel'][_0x2860e4(0x1af)](_0x22dde7)[_0x2860e4(0x1b4)](_0x2860e4(0x1ac));if(!_0x1b5198)return;return await _0x1b5198[_0x2860e4(0x1c1)]();}async[a160_0x2c5417(0x181)](_0x8f6537){const _0x3dc182=a160_0x2c5417;try{const _0x3b54ae=await this[_0x3dc182(0x19d)][_0x3dc182(0x1af)](_0x8f6537)['select']('-password');if(!_0x3b54ae)return;return _0x3b54ae['password']=await(0x0,verify_1[_0x3dc182(0x1a1)])(process[_0x3dc182(0x1a8)][_0x3dc182(0x18c)]),_0x3b54ae[_0x3dc182(0x17f)]();}catch(_0x417370){this[_0x3dc182(0x1b7)][_0x3dc182(0x17e)](_0x417370);}}async['onModuleInit'](){const _0x208f2e=a160_0x2c5417;try{const _0x53ad3a=await this[_0x208f2e(0x19d)][_0x208f2e(0x1b8)]({'username':exports[_0x208f2e(0x1ad)]});_0x53ad3a&&await _0x53ad3a['delete']();await this[_0x208f2e(0x1a4)]({'username':exports[_0x208f2e(0x1ad)],'email':_0x208f2e(0x1b2),'roles':[role_enum_1[_0x208f2e(0x19c)][_0x208f2e(0x1ab)]],'password':process['env']['MASTER_PASSWORD']});const _0x101a7e=await this[_0x208f2e(0x19d)]['findOne']({'username':exports[_0x208f2e(0x18e)]});_0x101a7e&&await _0x101a7e['delete'](),await this['addUser']({'username':exports[_0x208f2e(0x18e)],'email':_0x208f2e(0x1b1),'roles':[role_enum_1[_0x208f2e(0x19c)]['Admin']],'password':exports[_0x208f2e(0x18d)]});}catch(_0x5033c4){this[_0x208f2e(0x1b7)][_0x208f2e(0x17e)](_0x5033c4);}}async[a160_0x2c5417(0x1b0)](){const _0x5ba0dc=a160_0x2c5417,_0x4929cf=await this[_0x5ba0dc(0x19d)][_0x5ba0dc(0x1b8)]({'username':exports[_0x5ba0dc(0x1ad)]}),_0x5d77aa=await this[_0x5ba0dc(0x1a5)]['sign'](_0x4929cf[_0x5ba0dc(0x190)](),{'secret':process[_0x5ba0dc(0x1a8)][_0x5ba0dc(0x1bc)]});return _0x5d77aa;}};UserService=UserService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_2[a160_0x2c5417(0x1a0)])(a160_0x2c5417(0x19a))),__metadata(a160_0x2c5417(0x186),[mongoose_1[a160_0x2c5417(0x17d)],jwt_1['JwtService'],setting_service_1[a160_0x2c5417(0x1a7)]])],UserService),exports[a160_0x2c5417(0x1b6)]=UserService;