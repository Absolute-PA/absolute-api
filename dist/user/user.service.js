'use strict';const a160_0x36da76=a160_0x518a;function a160_0x2075(){const _0x367649=['onModuleInit','findById','findByIdAndUpdate','-password','email','save','forgotpassword','@nestjs/jwt','toObject','delete','getMasterUserAccessToken','DefaultAdminUsername','Admin','Master','Logger','deleteUser','8003391fIFWeY','metadata','MASTER_PASSWORD','error','find','6xGWNYV','logger','select','findFirst','@nestjs/common','userModel','8481010sgcCtR','InjectModel','Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20','username','hash','mongoose','settingService','addUser','74RhhHkN','length','DEFAULT_PASSWORD','1782828MbYxkq','Model','decorate','__param','function','UserService','roles','__metadata','__decorate','admin@absolutepa','maxUser','SettingService','4960152BTQiFa','../auth/verify','../setting/constants','DEFAULT_MAX_USER','design:paramtypes','Injectable','DefaultAdminPassword','map','deleteOne','object','256125VwFzvD','findUser','User','9WVKYAf','getOwnPropertyDescriptor','13709EvjXfF','getAllUser','findOne','7dbiDkI','MasterUserUsername','password','Role','@nestjs/mongoose','636456kzDBCD','env'];a160_0x2075=function(){return _0x367649;};return a160_0x2075();}(function(_0x5b6832,_0x319a22){const _0x1c776a=a160_0x518a,_0x49c824=_0x5b6832();while(!![]){try{const _0x5c7803=-parseInt(_0x1c776a(0x1a4))/0x1*(parseInt(_0x1c776a(0x186))/0x2)+parseInt(_0x1c776a(0x1a2))/0x3*(parseInt(_0x1c776a(0x1ac))/0x4)+parseInt(_0x1c776a(0x19f))/0x5*(-parseInt(_0x1c776a(0x178))/0x6)+parseInt(_0x1c776a(0x1a7))/0x7*(parseInt(_0x1c776a(0x195))/0x8)+-parseInt(_0x1c776a(0x189))/0x9+parseInt(_0x1c776a(0x17e))/0xa+-parseInt(_0x1c776a(0x173))/0xb;if(_0x5c7803===_0x319a22)break;else _0x49c824['push'](_0x49c824['shift']());}catch(_0x33020b){_0x49c824['push'](_0x49c824['shift']());}}}(a160_0x2075,0x70a13));var __decorate=this&&this[a160_0x36da76(0x191)]||function(_0x4cec34,_0x5e1d23,_0x2d292e,_0x2c1763){const _0x37e8ef=a160_0x36da76;var _0x58b938=arguments[_0x37e8ef(0x187)],_0xfdeaa1=_0x58b938<0x3?_0x5e1d23:_0x2c1763===null?_0x2c1763=Object[_0x37e8ef(0x1a3)](_0x5e1d23,_0x2d292e):_0x2c1763,_0x5472f6;if(typeof Reflect===_0x37e8ef(0x19e)&&typeof Reflect[_0x37e8ef(0x18b)]==='function')_0xfdeaa1=Reflect[_0x37e8ef(0x18b)](_0x4cec34,_0x5e1d23,_0x2d292e,_0x2c1763);else{for(var _0x272ef1=_0x4cec34[_0x37e8ef(0x187)]-0x1;_0x272ef1>=0x0;_0x272ef1--)if(_0x5472f6=_0x4cec34[_0x272ef1])_0xfdeaa1=(_0x58b938<0x3?_0x5472f6(_0xfdeaa1):_0x58b938>0x3?_0x5472f6(_0x5e1d23,_0x2d292e,_0xfdeaa1):_0x5472f6(_0x5e1d23,_0x2d292e))||_0xfdeaa1;}return _0x58b938>0x3&&_0xfdeaa1&&Object['defineProperty'](_0x5e1d23,_0x2d292e,_0xfdeaa1),_0xfdeaa1;},__metadata=this&&this[a160_0x36da76(0x190)]||function(_0x3143ee,_0x261cc1){const _0x5244ce=a160_0x36da76;if(typeof Reflect==='object'&&typeof Reflect[_0x5244ce(0x174)]===_0x5244ce(0x18d))return Reflect[_0x5244ce(0x174)](_0x3143ee,_0x261cc1);},__param=this&&this[a160_0x36da76(0x18c)]||function(_0xc32eb0,_0x39a6eb){return function(_0xac632d,_0x12d0a5){_0x39a6eb(_0xac632d,_0x12d0a5,_0xc32eb0);};},UserService_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a160_0x36da76(0x18e)]=exports[a160_0x36da76(0x19b)]=exports['DefaultAdminUsername']=exports[a160_0x36da76(0x1a8)]=void 0x0;const common_1=require(a160_0x36da76(0x17c)),mongoose_1=require(a160_0x36da76(0x183)),mongoose_2=require(a160_0x36da76(0x1ab)),role_enum_1=require('../auth/enums/role.enum'),jwt_1=require(a160_0x36da76(0x16a)),verify_1=require(a160_0x36da76(0x196)),setting_service_1=require('../setting/setting.service'),constants_1=require(a160_0x36da76(0x197));function a160_0x518a(_0x331eb8,_0x382ac2){const _0x20759c=a160_0x2075();return a160_0x518a=function(_0x518a86,_0x3ec58e){_0x518a86=_0x518a86-0x168;let _0x161004=_0x20759c[_0x518a86];return _0x161004;},a160_0x518a(_0x331eb8,_0x382ac2);}exports[a160_0x36da76(0x1a8)]='absolutePA123',exports['DefaultAdminUsername']='admin@absolutepa',exports['DefaultAdminPassword']=a160_0x36da76(0x169);let UserService=UserService_1=class UserService{constructor(_0x34f4cf,_0x511796,_0x2143fd){const _0x3ab2ed=a160_0x36da76;this[_0x3ab2ed(0x17d)]=_0x34f4cf,this['jwtService']=_0x511796,this[_0x3ab2ed(0x184)]=_0x2143fd,this[_0x3ab2ed(0x179)]=new common_1[(_0x3ab2ed(0x171))](UserService_1['name']);}async['addUser'](_0x15fb17){const _0x38f2ac=a160_0x36da76;var _0x1dfb9b;const _0x1a6f02=await this[_0x38f2ac(0x17d)]['findOne']({'email':_0x15fb17[_0x38f2ac(0x1b2)]});if(_0x1a6f02)throw new Error('Email\x20is\x20exist\x20'+_0x15fb17['email']);const _0x2df136=(await this[_0x38f2ac(0x17d)]['find']({}))[_0x38f2ac(0x187)],_0x770b9=((_0x1dfb9b=(await this['settingService'][_0x38f2ac(0x17b)]())['userSetting'])===null||_0x1dfb9b===void 0x0?void 0x0:_0x1dfb9b[_0x38f2ac(0x193)])||constants_1[_0x38f2ac(0x198)];if(_0x2df136>_0x770b9)throw new Error(_0x38f2ac(0x180)+_0x770b9);const _0x564a94=await this[_0x38f2ac(0x17d)]['create'](_0x15fb17);return _0x564a94[_0x38f2ac(0x1a9)]=await(0x0,verify_1[_0x38f2ac(0x182)])(_0x564a94[_0x38f2ac(0x1a9)]),_0x564a94[_0x38f2ac(0x168)]();}async[a160_0x36da76(0x1a0)](_0x1e6487){const _0x3bd2f9=a160_0x36da76,_0x38b381=await this[_0x3bd2f9(0x17d)][_0x3bd2f9(0x1a6)]({'username':_0x1e6487});return _0x38b381;}async[a160_0x36da76(0x1a5)](){const _0x1603ac=a160_0x36da76,_0x361f09=await this['userModel'][_0x1603ac(0x177)]({'roles':{'$ne':role_enum_1['Role']['Master']}})[_0x1603ac(0x17a)]('-password');return _0x361f09[_0x1603ac(0x19c)](_0x2fc65e=>({'email':_0x2fc65e[_0x1603ac(0x1b2)],'roles':_0x2fc65e[_0x1603ac(0x18f)],'username':_0x2fc65e[_0x1603ac(0x181)],'id':_0x2fc65e['id']}));}async['updateUser'](_0x5a9685,_0x368b74){const _0xe48d8a=a160_0x36da76;try{return await this[_0xe48d8a(0x17d)][_0xe48d8a(0x1b0)](_0x5a9685,_0x368b74)[_0xe48d8a(0x17a)](_0xe48d8a(0x1b1));}catch(_0xa30351){this[_0xe48d8a(0x179)]['error'](_0xa30351);return;}}async[a160_0x36da76(0x172)](_0x39c69a){const _0xd5618a=a160_0x36da76,_0x5be669=await this[_0xd5618a(0x17d)][_0xd5618a(0x1af)](_0x39c69a)[_0xd5618a(0x17a)](_0xd5618a(0x1b1));if(!_0x5be669)return;return await _0x5be669[_0xd5618a(0x19d)]();}async['resetPassword'](_0x5e1294){const _0x421629=a160_0x36da76;try{const _0x4a1adc=await this['userModel'][_0x421629(0x1af)](_0x5e1294)[_0x421629(0x17a)](_0x421629(0x1b1));if(!_0x4a1adc)return;return _0x4a1adc['password']=await(0x0,verify_1[_0x421629(0x182)])(process[_0x421629(0x1ad)][_0x421629(0x188)]),_0x4a1adc[_0x421629(0x168)]();}catch(_0x48e84){this[_0x421629(0x179)]['error'](_0x48e84);}}async[a160_0x36da76(0x1ae)](){const _0x3490d5=a160_0x36da76;try{const _0x421304=await this['userModel'][_0x3490d5(0x1a6)]({'username':exports['MasterUserUsername']});_0x421304&&await _0x421304[_0x3490d5(0x16c)]();await this[_0x3490d5(0x185)]({'username':exports[_0x3490d5(0x1a8)],'email':'absolutePA123@gmail.com','roles':[role_enum_1['Role'][_0x3490d5(0x170)]],'password':process['env'][_0x3490d5(0x175)]});const _0x346a3a=await this['userModel'][_0x3490d5(0x1a6)]({'username':exports['DefaultAdminUsername']});_0x346a3a&&await _0x346a3a[_0x3490d5(0x16c)](),await this[_0x3490d5(0x185)]({'username':exports[_0x3490d5(0x16e)],'email':_0x3490d5(0x192),'roles':[role_enum_1[_0x3490d5(0x1aa)][_0x3490d5(0x16f)]],'password':exports[_0x3490d5(0x19b)]});}catch(_0x14479a){this['logger'][_0x3490d5(0x176)](_0x14479a);}}async[a160_0x36da76(0x16d)](){const _0x1e55c3=a160_0x36da76,_0x2b4d9a=await this[_0x1e55c3(0x17d)]['findOne']({'username':exports[_0x1e55c3(0x1a8)]}),_0x46da9a=await this['jwtService']['sign'](_0x2b4d9a[_0x1e55c3(0x16b)](),{'secret':process['env']['JWT_SECRET']});return _0x46da9a;}};UserService=UserService_1=__decorate([(0x0,common_1[a160_0x36da76(0x19a)])(),__param(0x0,(0x0,mongoose_2[a160_0x36da76(0x17f)])(a160_0x36da76(0x1a1))),__metadata(a160_0x36da76(0x199),[mongoose_1[a160_0x36da76(0x18a)],jwt_1['JwtService'],setting_service_1[a160_0x36da76(0x194)]])],UserService),exports[a160_0x36da76(0x18e)]=UserService;