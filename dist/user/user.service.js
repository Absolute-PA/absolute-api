'use strict';const a157_0x22469e=a157_0x336a;(function(_0x2e12c7,_0x1948c9){const _0x1fe56c=a157_0x336a,_0x25a781=_0x2e12c7();while(!![]){try{const _0x4fb3a5=parseInt(_0x1fe56c(0x1cb))/0x1*(-parseInt(_0x1fe56c(0x1ae))/0x2)+-parseInt(_0x1fe56c(0x1eb))/0x3*(-parseInt(_0x1fe56c(0x1c9))/0x4)+-parseInt(_0x1fe56c(0x1be))/0x5*(-parseInt(_0x1fe56c(0x1ed))/0x6)+-parseInt(_0x1fe56c(0x1cd))/0x7*(parseInt(_0x1fe56c(0x1dd))/0x8)+-parseInt(_0x1fe56c(0x1d1))/0x9*(-parseInt(_0x1fe56c(0x1d8))/0xa)+parseInt(_0x1fe56c(0x1e0))/0xb*(-parseInt(_0x1fe56c(0x1db))/0xc)+parseInt(_0x1fe56c(0x1d5))/0xd;if(_0x4fb3a5===_0x1948c9)break;else _0x25a781['push'](_0x25a781['shift']());}catch(_0x269352){_0x25a781['push'](_0x25a781['shift']());}}}(a157_0x41c5,0x63429));function a157_0x336a(_0x13a419,_0x1692ab){const _0x41c544=a157_0x41c5();return a157_0x336a=function(_0x336aaa,_0x3f0a89){_0x336aaa=_0x336aaa-0x1ad;let _0x4e629e=_0x41c544[_0x336aaa];return _0x4e629e;},a157_0x336a(_0x13a419,_0x1692ab);}var __decorate=this&&this[a157_0x22469e(0x1cf)]||function(_0x311372,_0x43d93e,_0x29bff6,_0x590d1e){const _0x159e32=a157_0x22469e;var _0xada889=arguments['length'],_0x423480=_0xada889<0x3?_0x43d93e:_0x590d1e===null?_0x590d1e=Object[_0x159e32(0x1b2)](_0x43d93e,_0x29bff6):_0x590d1e,_0x23d9c5;if(typeof Reflect===_0x159e32(0x1e8)&&typeof Reflect['decorate']===_0x159e32(0x1c7))_0x423480=Reflect['decorate'](_0x311372,_0x43d93e,_0x29bff6,_0x590d1e);else{for(var _0x2600e9=_0x311372[_0x159e32(0x1bd)]-0x1;_0x2600e9>=0x0;_0x2600e9--)if(_0x23d9c5=_0x311372[_0x2600e9])_0x423480=(_0xada889<0x3?_0x23d9c5(_0x423480):_0xada889>0x3?_0x23d9c5(_0x43d93e,_0x29bff6,_0x423480):_0x23d9c5(_0x43d93e,_0x29bff6))||_0x423480;}return _0xada889>0x3&&_0x423480&&Object['defineProperty'](_0x43d93e,_0x29bff6,_0x423480),_0x423480;},__metadata=this&&this[a157_0x22469e(0x1ea)]||function(_0x4ad48b,_0x45c235){const _0x26105d=a157_0x22469e;if(typeof Reflect==='object'&&typeof Reflect[_0x26105d(0x1f0)]===_0x26105d(0x1c7))return Reflect['metadata'](_0x4ad48b,_0x45c235);},__param=this&&this['__param']||function(_0x424545,_0x6653d){return function(_0x4a990f,_0x43ba1e){_0x6653d(_0x4a990f,_0x43ba1e,_0x424545);};},UserService_1;Object['defineProperty'](exports,a157_0x22469e(0x1b7),{'value':!![]}),exports['UserService']=exports[a157_0x22469e(0x1ce)]=void 0x0;const common_1=require(a157_0x22469e(0x1df)),mongoose_1=require(a157_0x22469e(0x1b9)),mongoose_2=require(a157_0x22469e(0x1e1)),role_enum_1=require('../auth/enums/role.enum'),jwt_1=require(a157_0x22469e(0x1cc)),verify_1=require('../auth/verify'),setting_service_1=require('../setting/setting.service'),constants_1=require(a157_0x22469e(0x1c2));exports['MasterUserUsername']=a157_0x22469e(0x1ba);function a157_0x41c5(){const _0x861581=['170410isvoai','findOne','logger','Email\x20is\x20exist','../setting/constants','findById','deleteUser','jwtService','Role','function','Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20','52684yiQMEp','Injectable','146153OSBySI','@nestjs/jwt','887089rRmNfU','MasterUserUsername','__decorate','env','7162353PjhzYf','deleteOne','name','username','7822139ugRPCk','delete','select','10PAvFCw','design:paramtypes','absolutePA123@gmail.com','508512WoXmKz','maxUser','48ccvdbo','addUser','@nestjs/common','110QYjOsi','@nestjs/mongoose','hash','-password','password','Master','onModuleInit','getAllUser','object','toObject','__metadata','54xojZxA','JwtService','18LkHJJi','findUser','error','metadata','userModel','2sFmzmR','DEFAULT_MAX_USER','updateUser','Model','getOwnPropertyDescriptor','User','email','save','userSetting','__esModule','Logger','mongoose','absolutePA123','InjectModel','sign','length'];a157_0x41c5=function(){return _0x861581;};return a157_0x41c5();}let UserService=UserService_1=class UserService{constructor(_0x88c52c,_0x1bd6a2,_0x140e0c){const _0x5bb227=a157_0x22469e;this[_0x5bb227(0x1ad)]=_0x88c52c,this['jwtService']=_0x1bd6a2,this['settingService']=_0x140e0c,this['logger']=new common_1[(_0x5bb227(0x1b8))](UserService_1[_0x5bb227(0x1d3)]);}async[a157_0x22469e(0x1de)](_0x5bda06){const _0x1b92c9=a157_0x22469e;var _0x4e9cef;const _0x427599=await this[_0x1b92c9(0x1ad)][_0x1b92c9(0x1bf)]({'email':_0x5bda06['email']});if(_0x427599)throw new Error(_0x1b92c9(0x1c1));const _0x4a6fa2=(await this[_0x1b92c9(0x1ad)]['find']({}))[_0x1b92c9(0x1bd)],_0x596c81=((_0x4e9cef=(await this['settingService']['findFirst']())[_0x1b92c9(0x1b6)])===null||_0x4e9cef===void 0x0?void 0x0:_0x4e9cef[_0x1b92c9(0x1dc)])||constants_1[_0x1b92c9(0x1af)];if(_0x4a6fa2>_0x596c81)throw new Error(_0x1b92c9(0x1c8)+_0x596c81);const _0x4502e5=await this[_0x1b92c9(0x1ad)]['create'](_0x5bda06);return _0x4502e5[_0x1b92c9(0x1e4)]=await(0x0,verify_1['hash'])(_0x4502e5[_0x1b92c9(0x1e4)]),_0x4502e5[_0x1b92c9(0x1b5)]();}async[a157_0x22469e(0x1ee)](_0x524614){const _0x3d4c65=a157_0x22469e,_0x1ecd27=await this[_0x3d4c65(0x1ad)]['findOne']({'username':_0x524614});return _0x1ecd27;}async[a157_0x22469e(0x1e7)](){const _0x3a9fb0=a157_0x22469e,_0x164125=await this[_0x3a9fb0(0x1ad)]['find']({'roles':{'$ne':role_enum_1[_0x3a9fb0(0x1c6)][_0x3a9fb0(0x1e5)]}})['select']('-password');return _0x164125['map'](_0x390e0c=>({'email':_0x390e0c[_0x3a9fb0(0x1b4)],'roles':_0x390e0c['roles'],'username':_0x390e0c[_0x3a9fb0(0x1d4)],'id':_0x390e0c['id']}));}async[a157_0x22469e(0x1b0)](_0x5b2201,_0x17c74e){const _0x5ac072=a157_0x22469e;try{return await this[_0x5ac072(0x1ad)]['findByIdAndUpdate'](_0x5b2201,_0x17c74e)[_0x5ac072(0x1d7)](_0x5ac072(0x1e3));}catch(_0x213198){this[_0x5ac072(0x1c0)]['error'](_0x213198);return;}}async[a157_0x22469e(0x1c4)](_0x383b57){const _0x42ef21=a157_0x22469e,_0x1b19f9=await this[_0x42ef21(0x1ad)][_0x42ef21(0x1c3)](_0x383b57)[_0x42ef21(0x1d7)](_0x42ef21(0x1e3));if(!_0x1b19f9)return;return await _0x1b19f9[_0x42ef21(0x1d2)]();}async['resetPassword'](_0x52d10a){const _0x557364=a157_0x22469e;try{const _0x1565e8=await this['userModel'][_0x557364(0x1c3)](_0x52d10a)[_0x557364(0x1d7)](_0x557364(0x1e3));if(!_0x1565e8)return;return _0x1565e8[_0x557364(0x1e4)]=await(0x0,verify_1[_0x557364(0x1e2)])(process[_0x557364(0x1d0)]['DEFAULT_PASSWORD']),_0x1565e8[_0x557364(0x1b5)]();}catch(_0x5c34a8){this[_0x557364(0x1c0)][_0x557364(0x1ef)](_0x5c34a8);}}async[a157_0x22469e(0x1e6)](){const _0x277238=a157_0x22469e;try{const _0x2c316d=await this[_0x277238(0x1ad)][_0x277238(0x1bf)]({'username':exports['MasterUserUsername']});_0x2c316d&&await _0x2c316d[_0x277238(0x1d6)](),await this[_0x277238(0x1de)]({'username':exports[_0x277238(0x1ce)],'email':_0x277238(0x1da),'roles':[role_enum_1[_0x277238(0x1c6)]['Master']],'password':process['env']['MASTER_PASSWORD']});}catch(_0x3a6706){this[_0x277238(0x1c0)][_0x277238(0x1ef)](_0x3a6706);throw _0x3a6706;}}async['getMasterUserAccessToken'](){const _0x18caef=a157_0x22469e,_0x2b01b2=await this[_0x18caef(0x1ad)]['findOne']({'username':exports[_0x18caef(0x1ce)]}),_0x3fc20e=await this[_0x18caef(0x1c5)][_0x18caef(0x1bc)](_0x2b01b2[_0x18caef(0x1e9)](),{'secret':process[_0x18caef(0x1d0)]['JWT_SECRET']});return _0x3fc20e;}};UserService=UserService_1=__decorate([(0x0,common_1[a157_0x22469e(0x1ca)])(),__param(0x0,(0x0,mongoose_2[a157_0x22469e(0x1bb)])(a157_0x22469e(0x1b3))),__metadata(a157_0x22469e(0x1d9),[mongoose_1[a157_0x22469e(0x1b1)],jwt_1[a157_0x22469e(0x1ec)],setting_service_1['SettingService']])],UserService),exports['UserService']=UserService;