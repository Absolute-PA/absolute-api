'use strict';const a157_0x32ffbc=a157_0x4c82;function a157_0x3ab4(){const _0x24831e=['decorate','email','delete','SettingService','maxUser','metadata','findOne','function','onModuleInit','__param','@nestjs/mongoose','3YSVQYg','deleteUser','50kzNjin','@nestjs/jwt','6790250RTuYjZ','length','-password','9739596LrYgRy','username','getAllUser','Injectable','sign','Model','__decorate','64550guPNeE','userModel','deleteOne','hash','userSetting','JwtService','Master','228893choCWR','addUser','MASTER_PASSWORD','UserService','Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20','select','__metadata','../auth/enums/role.enum','error','InjectModel','defineProperty','create','jwtService','design:paramtypes','save','280MLNYka','164493qCeqWe','name','toObject','absolutePA123','findById','findFirst','User','JWT_SECRET','DEFAULT_MAX_USER','../setting/constants','MasterUserUsername','object','map','Role','DEFAULT_PASSWORD','@nestjs/common','find','resetPassword','findByIdAndUpdate','21481vruZwt','../auth/verify','password','144vMeRTV','Email\x20is\x20exist','settingService','1243bgquxT','4939780mDhVdw','logger','../setting/setting.service','mongoose','updateUser'];a157_0x3ab4=function(){return _0x24831e;};return a157_0x3ab4();}(function(_0x459fac,_0x1fe4d7){const _0x2023bd=a157_0x4c82,_0x119cdf=_0x459fac();while(!![]){try{const _0x5470b0=parseInt(_0x2023bd(0x229))/0x1*(-parseInt(_0x2023bd(0x1f3))/0x2)+-parseInt(_0x2023bd(0x1f1))/0x3*(-parseInt(_0x2023bd(0x1e1))/0x4)+-parseInt(_0x2023bd(0x1f5))/0x5+parseInt(_0x2023bd(0x22c))/0x6*(parseInt(_0x2023bd(0x206))/0x7)+-parseInt(_0x2023bd(0x215))/0x8*(-parseInt(_0x2023bd(0x216))/0x9)+-parseInt(_0x2023bd(0x1ff))/0xa*(parseInt(_0x2023bd(0x1e0))/0xb)+parseInt(_0x2023bd(0x1f8))/0xc;if(_0x5470b0===_0x1fe4d7)break;else _0x119cdf['push'](_0x119cdf['shift']());}catch(_0x14906b){_0x119cdf['push'](_0x119cdf['shift']());}}}(a157_0x3ab4,0xceadf));var __decorate=this&&this[a157_0x32ffbc(0x1fe)]||function(_0x1a3403,_0x3bcc63,_0x40b306,_0xb6c51f){const _0x58b9ee=a157_0x32ffbc;var _0x5c521f=arguments[_0x58b9ee(0x1f6)],_0x1d137b=_0x5c521f<0x3?_0x3bcc63:_0xb6c51f===null?_0xb6c51f=Object['getOwnPropertyDescriptor'](_0x3bcc63,_0x40b306):_0xb6c51f,_0x299108;if(typeof Reflect===_0x58b9ee(0x221)&&typeof Reflect['decorate']===_0x58b9ee(0x1ed))_0x1d137b=Reflect[_0x58b9ee(0x1e6)](_0x1a3403,_0x3bcc63,_0x40b306,_0xb6c51f);else{for(var _0x61bc1=_0x1a3403['length']-0x1;_0x61bc1>=0x0;_0x61bc1--)if(_0x299108=_0x1a3403[_0x61bc1])_0x1d137b=(_0x5c521f<0x3?_0x299108(_0x1d137b):_0x5c521f>0x3?_0x299108(_0x3bcc63,_0x40b306,_0x1d137b):_0x299108(_0x3bcc63,_0x40b306))||_0x1d137b;}return _0x5c521f>0x3&&_0x1d137b&&Object[_0x58b9ee(0x210)](_0x3bcc63,_0x40b306,_0x1d137b),_0x1d137b;},__metadata=this&&this[a157_0x32ffbc(0x20c)]||function(_0x48ec24,_0x6064d9){const _0x408a12=a157_0x32ffbc;if(typeof Reflect===_0x408a12(0x221)&&typeof Reflect['metadata']===_0x408a12(0x1ed))return Reflect[_0x408a12(0x1eb)](_0x48ec24,_0x6064d9);},__param=this&&this[a157_0x32ffbc(0x1ef)]||function(_0xbcd07c,_0x45a039){return function(_0x23099d,_0x4421fa){_0x45a039(_0x23099d,_0x4421fa,_0xbcd07c);};},UserService_1;Object[a157_0x32ffbc(0x210)](exports,'__esModule',{'value':!![]}),exports['UserService']=exports['MasterUserUsername']=void 0x0;const common_1=require(a157_0x32ffbc(0x225)),mongoose_1=require(a157_0x32ffbc(0x1e4)),mongoose_2=require(a157_0x32ffbc(0x1f0)),role_enum_1=require(a157_0x32ffbc(0x20d)),jwt_1=require(a157_0x32ffbc(0x1f4)),verify_1=require(a157_0x32ffbc(0x22a)),setting_service_1=require(a157_0x32ffbc(0x1e3)),constants_1=require(a157_0x32ffbc(0x21f));exports[a157_0x32ffbc(0x220)]=a157_0x32ffbc(0x219);let UserService=UserService_1=class UserService{constructor(_0x3d1d67,_0x3391a0,_0x51e122){const _0xcd9a7b=a157_0x32ffbc;this[_0xcd9a7b(0x200)]=_0x3d1d67,this['jwtService']=_0x3391a0,this[_0xcd9a7b(0x1df)]=_0x51e122,this[_0xcd9a7b(0x1e2)]=new common_1['Logger'](UserService_1[_0xcd9a7b(0x217)]);}async[a157_0x32ffbc(0x207)](_0x3c03c9){const _0x350a4a=a157_0x32ffbc;var _0x47ed55;const _0x36fd96=await this[_0x350a4a(0x200)][_0x350a4a(0x1ec)]({'email':_0x3c03c9[_0x350a4a(0x1e7)]});if(_0x36fd96)throw new Error(_0x350a4a(0x1de));const _0x524df3=(await this[_0x350a4a(0x200)][_0x350a4a(0x226)]({}))[_0x350a4a(0x1f6)],_0x857697=((_0x47ed55=(await this['settingService'][_0x350a4a(0x21b)]())[_0x350a4a(0x203)])===null||_0x47ed55===void 0x0?void 0x0:_0x47ed55[_0x350a4a(0x1ea)])||constants_1[_0x350a4a(0x21e)];if(_0x524df3>_0x857697)throw new Error(_0x350a4a(0x20a)+_0x857697);const _0x4bde07=await this[_0x350a4a(0x200)][_0x350a4a(0x211)](_0x3c03c9);return _0x4bde07[_0x350a4a(0x22b)]=await(0x0,verify_1[_0x350a4a(0x202)])(_0x4bde07[_0x350a4a(0x22b)]),_0x4bde07[_0x350a4a(0x214)]();}async['findUser'](_0x1e9667){const _0x521546=a157_0x32ffbc,_0x4799be=await this[_0x521546(0x200)]['findOne']({'username':_0x1e9667});return _0x4799be;}async[a157_0x32ffbc(0x1fa)](){const _0x571f86=a157_0x32ffbc,_0x355a1e=await this[_0x571f86(0x200)]['find']({'roles':{'$ne':role_enum_1[_0x571f86(0x223)]['Master']}})['select'](_0x571f86(0x1f7));return _0x355a1e[_0x571f86(0x222)](_0x10783e=>({'email':_0x10783e[_0x571f86(0x1e7)],'roles':_0x10783e['roles'],'username':_0x10783e[_0x571f86(0x1f9)],'id':_0x10783e['id']}));}async[a157_0x32ffbc(0x1e5)](_0x189b05,_0xc08540){const _0x22ab84=a157_0x32ffbc;try{return await this[_0x22ab84(0x200)][_0x22ab84(0x228)](_0x189b05,_0xc08540)[_0x22ab84(0x20b)](_0x22ab84(0x1f7));}catch(_0x1f2e3c){this['logger'][_0x22ab84(0x20e)](_0x1f2e3c);return;}}async[a157_0x32ffbc(0x1f2)](_0x2c7728){const _0x379e64=a157_0x32ffbc,_0x34391e=await this[_0x379e64(0x200)][_0x379e64(0x21a)](_0x2c7728)[_0x379e64(0x20b)](_0x379e64(0x1f7));if(!_0x34391e)return;return await _0x34391e[_0x379e64(0x201)]();}async[a157_0x32ffbc(0x227)](_0x525a16){const _0x1283ed=a157_0x32ffbc;try{const _0x1c5e95=await this[_0x1283ed(0x200)][_0x1283ed(0x21a)](_0x525a16)[_0x1283ed(0x20b)]('-password');if(!_0x1c5e95)return;return _0x1c5e95[_0x1283ed(0x22b)]=await(0x0,verify_1['hash'])(process['env'][_0x1283ed(0x224)]),_0x1c5e95[_0x1283ed(0x214)]();}catch(_0x1f64f0){this[_0x1283ed(0x1e2)][_0x1283ed(0x20e)](_0x1f64f0);}}async[a157_0x32ffbc(0x1ee)](){const _0x154c42=a157_0x32ffbc;try{const _0x5c7212=await this[_0x154c42(0x200)][_0x154c42(0x1ec)]({'username':exports[_0x154c42(0x220)]});_0x5c7212&&await _0x5c7212[_0x154c42(0x1e8)](),await this[_0x154c42(0x207)]({'username':exports[_0x154c42(0x220)],'email':'absolutePA123@gmail.com','roles':[role_enum_1[_0x154c42(0x223)][_0x154c42(0x205)]],'password':process['env'][_0x154c42(0x208)]});}catch(_0x999929){this[_0x154c42(0x1e2)][_0x154c42(0x20e)](_0x999929);throw _0x999929;}}async['getMasterUserAccessToken'](){const _0x52a67c=a157_0x32ffbc,_0x4332c0=await this[_0x52a67c(0x200)]['findOne']({'username':exports[_0x52a67c(0x220)]}),_0x2fc659=await this[_0x52a67c(0x212)][_0x52a67c(0x1fc)](_0x4332c0[_0x52a67c(0x218)](),{'secret':process['env'][_0x52a67c(0x21d)]});return _0x2fc659;}};function a157_0x4c82(_0x23c1f8,_0x5048af){const _0x3ab415=a157_0x3ab4();return a157_0x4c82=function(_0x4c8290,_0x2d2678){_0x4c8290=_0x4c8290-0x1de;let _0x29821a=_0x3ab415[_0x4c8290];return _0x29821a;},a157_0x4c82(_0x23c1f8,_0x5048af);}UserService=UserService_1=__decorate([(0x0,common_1[a157_0x32ffbc(0x1fb)])(),__param(0x0,(0x0,mongoose_2[a157_0x32ffbc(0x20f)])(a157_0x32ffbc(0x21c))),__metadata(a157_0x32ffbc(0x213),[mongoose_1[a157_0x32ffbc(0x1fd)],jwt_1[a157_0x32ffbc(0x204)],setting_service_1[a157_0x32ffbc(0x1e9)]])],UserService),exports[a157_0x32ffbc(0x209)]=UserService;