'use strict';const a160_0xa780e6=a160_0x16d1;(function(_0x7a5c6b,_0x3b12eb){const _0x1a985c=a160_0x16d1,_0x31c8b4=_0x7a5c6b();while(!![]){try{const _0x9b6366=-parseInt(_0x1a985c(0x157))/0x1*(parseInt(_0x1a985c(0x15e))/0x2)+-parseInt(_0x1a985c(0x146))/0x3+-parseInt(_0x1a985c(0x17f))/0x4+parseInt(_0x1a985c(0x15d))/0x5+parseInt(_0x1a985c(0x17b))/0x6*(parseInt(_0x1a985c(0x177))/0x7)+-parseInt(_0x1a985c(0x182))/0x8*(parseInt(_0x1a985c(0x159))/0x9)+-parseInt(_0x1a985c(0x178))/0xa*(-parseInt(_0x1a985c(0x147))/0xb);if(_0x9b6366===_0x3b12eb)break;else _0x31c8b4['push'](_0x31c8b4['shift']());}catch(_0x43fd5a){_0x31c8b4['push'](_0x31c8b4['shift']());}}}(a160_0x3efa,0xdd88e));function a160_0x3efa(){const _0x523ff0=['Role','function','addUser','object','roles','Admin','490225WByrPL','Model','27GgwxtG','SettingService','delete','getOwnPropertyDescriptor','4654865xnJfhn','4bQIRlo','UserService','email','env','-password','name','../auth/verify','hash','getMasterUserAccessToken','onModuleInit','findById','JWT_SECRET','mongoose','toObject','jwtService','__esModule','sign','DefaultAdminPassword','Injectable','deleteOne','../setting/setting.service','@nestjs/common','findFirst','__metadata','design:paramtypes','574OiTIhD','37963130mKJKGA','@nestjs/mongoose','decorate','102318CyPpED','map','userModel','save','4963536vtqHCo','settingService','forgotpassword','3600440GJbKFs','resetPassword','logger','DEFAULT_PASSWORD','admin@absolutepa','absolutePA123','User','select','Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20','maxUser','error','getAllUser','MASTER_PASSWORD','InjectModel','@nestjs/jwt','defineProperty','updateUser','__param','password','Master','findUser','findOne','4940181IZdGPT','11tDApDA','Email\x20is\x20exist\x20','__decorate','MasterUserUsername','find','DEFAULT_MAX_USER','absolutePA123@gmail.com','DefaultAdminUsername','username','length'];a160_0x3efa=function(){return _0x523ff0;};return a160_0x3efa();}var __decorate=this&&this[a160_0xa780e6(0x149)]||function(_0x33feb6,_0x2cd463,_0xc3d5be,_0x3a6ce4){const _0x53a149=a160_0xa780e6;var _0x3ad991=arguments[_0x53a149(0x150)],_0x54be16=_0x3ad991<0x3?_0x2cd463:_0x3a6ce4===null?_0x3a6ce4=Object[_0x53a149(0x15c)](_0x2cd463,_0xc3d5be):_0x3a6ce4,_0x639621;if(typeof Reflect===_0x53a149(0x154)&&typeof Reflect[_0x53a149(0x17a)]===_0x53a149(0x152))_0x54be16=Reflect[_0x53a149(0x17a)](_0x33feb6,_0x2cd463,_0xc3d5be,_0x3a6ce4);else{for(var _0x10f565=_0x33feb6[_0x53a149(0x150)]-0x1;_0x10f565>=0x0;_0x10f565--)if(_0x639621=_0x33feb6[_0x10f565])_0x54be16=(_0x3ad991<0x3?_0x639621(_0x54be16):_0x3ad991>0x3?_0x639621(_0x2cd463,_0xc3d5be,_0x54be16):_0x639621(_0x2cd463,_0xc3d5be))||_0x54be16;}return _0x3ad991>0x3&&_0x54be16&&Object['defineProperty'](_0x2cd463,_0xc3d5be,_0x54be16),_0x54be16;},__metadata=this&&this[a160_0xa780e6(0x175)]||function(_0x1e51d2,_0x1f863b){const _0x48e615=a160_0xa780e6;if(typeof Reflect===_0x48e615(0x154)&&typeof Reflect['metadata']===_0x48e615(0x152))return Reflect['metadata'](_0x1e51d2,_0x1f863b);},__param=this&&this[a160_0xa780e6(0x141)]||function(_0xc63205,_0x15d6d6){return function(_0x5af4fa,_0x53614d){_0x15d6d6(_0x5af4fa,_0x53614d,_0xc63205);};},UserService_1;Object[a160_0xa780e6(0x13f)](exports,a160_0xa780e6(0x16d),{'value':!![]}),exports[a160_0xa780e6(0x15f)]=exports[a160_0xa780e6(0x16f)]=exports[a160_0xa780e6(0x14e)]=exports['MasterUserUsername']=void 0x0;const common_1=require(a160_0xa780e6(0x173)),mongoose_1=require(a160_0xa780e6(0x16a)),mongoose_2=require(a160_0xa780e6(0x179)),role_enum_1=require('../auth/enums/role.enum'),jwt_1=require(a160_0xa780e6(0x13e)),verify_1=require(a160_0xa780e6(0x164)),setting_service_1=require(a160_0xa780e6(0x172)),constants_1=require('../setting/constants');function a160_0x16d1(_0x9ce856,_0x1391e5){const _0x3efa54=a160_0x3efa();return a160_0x16d1=function(_0x16d145,_0xbaf323){_0x16d145=_0x16d145-0x133;let _0x1d8294=_0x3efa54[_0x16d145];return _0x1d8294;},a160_0x16d1(_0x9ce856,_0x1391e5);}exports[a160_0xa780e6(0x14a)]=a160_0xa780e6(0x135),exports[a160_0xa780e6(0x14e)]='admin@absolutepa',exports[a160_0xa780e6(0x16f)]=a160_0xa780e6(0x181);let UserService=UserService_1=class UserService{constructor(_0x4d12c7,_0xdf1f1c,_0x10b871){const _0x3e95fb=a160_0xa780e6;this[_0x3e95fb(0x17d)]=_0x4d12c7,this[_0x3e95fb(0x16c)]=_0xdf1f1c,this[_0x3e95fb(0x180)]=_0x10b871,this[_0x3e95fb(0x184)]=new common_1['Logger'](UserService_1[_0x3e95fb(0x163)]);}async[a160_0xa780e6(0x153)](_0xa00a56){const _0x1dcd10=a160_0xa780e6;var _0x40ce12;const _0x3424dd=await this[_0x1dcd10(0x17d)][_0x1dcd10(0x145)]({'email':_0xa00a56[_0x1dcd10(0x160)]});if(_0x3424dd)throw new Error(_0x1dcd10(0x148)+_0xa00a56[_0x1dcd10(0x160)]);const _0x3a39ee=(await this[_0x1dcd10(0x17d)][_0x1dcd10(0x14b)]({}))[_0x1dcd10(0x150)],_0x1f5524=((_0x40ce12=(await this['settingService'][_0x1dcd10(0x174)]())['userSetting'])===null||_0x40ce12===void 0x0?void 0x0:_0x40ce12[_0x1dcd10(0x139)])||constants_1[_0x1dcd10(0x14c)];if(_0x3a39ee>_0x1f5524)throw new Error(_0x1dcd10(0x138)+_0x1f5524);const _0x495530=await this[_0x1dcd10(0x17d)]['create'](_0xa00a56);return _0x495530[_0x1dcd10(0x142)]=await(0x0,verify_1['hash'])(_0x495530[_0x1dcd10(0x142)]),_0x495530[_0x1dcd10(0x17e)]();}async[a160_0xa780e6(0x144)](_0x104d37){const _0x4ac32a=a160_0xa780e6,_0x81b532=await this['userModel'][_0x4ac32a(0x145)]({'username':_0x104d37});return _0x81b532;}async[a160_0xa780e6(0x13b)](){const _0x428bfe=a160_0xa780e6,_0x198af0=await this[_0x428bfe(0x17d)][_0x428bfe(0x14b)]({'roles':{'$ne':role_enum_1['Role'][_0x428bfe(0x143)]}})['select'](_0x428bfe(0x162));return _0x198af0[_0x428bfe(0x17c)](_0x39a33d=>({'email':_0x39a33d[_0x428bfe(0x160)],'roles':_0x39a33d[_0x428bfe(0x155)],'username':_0x39a33d[_0x428bfe(0x14f)],'id':_0x39a33d['id']}));}async[a160_0xa780e6(0x140)](_0x5b6e15,_0x461364){const _0xf5b4dc=a160_0xa780e6;try{return await this[_0xf5b4dc(0x17d)]['findByIdAndUpdate'](_0x5b6e15,_0x461364)['select'](_0xf5b4dc(0x162));}catch(_0x135a61){this['logger'][_0xf5b4dc(0x13a)](_0x135a61);return;}}async['deleteUser'](_0x5e66a3){const _0x18f609=a160_0xa780e6,_0x295028=await this[_0x18f609(0x17d)][_0x18f609(0x168)](_0x5e66a3)[_0x18f609(0x137)](_0x18f609(0x162));if(!_0x295028)return;return await _0x295028[_0x18f609(0x171)]();}async[a160_0xa780e6(0x183)](_0xa09e59){const _0x525fcc=a160_0xa780e6;try{const _0x37df41=await this['userModel'][_0x525fcc(0x168)](_0xa09e59)[_0x525fcc(0x137)]('-password');if(!_0x37df41)return;return _0x37df41['password']=await(0x0,verify_1[_0x525fcc(0x165)])(process[_0x525fcc(0x161)][_0x525fcc(0x133)]),_0x37df41[_0x525fcc(0x17e)]();}catch(_0x54c7e1){this[_0x525fcc(0x184)][_0x525fcc(0x13a)](_0x54c7e1);}}async[a160_0xa780e6(0x167)](){const _0x4b2980=a160_0xa780e6;try{const _0x13c26d=await this[_0x4b2980(0x17d)]['findOne']({'username':exports['MasterUserUsername']});_0x13c26d&&await _0x13c26d['delete']();await this[_0x4b2980(0x153)]({'username':exports[_0x4b2980(0x14a)],'email':_0x4b2980(0x14d),'roles':[role_enum_1[_0x4b2980(0x151)]['Master']],'password':process[_0x4b2980(0x161)][_0x4b2980(0x13c)]});const _0x5b9ce6=await this[_0x4b2980(0x17d)]['findOne']({'username':exports[_0x4b2980(0x14e)]});_0x5b9ce6&&await _0x5b9ce6[_0x4b2980(0x15b)](),await this[_0x4b2980(0x153)]({'username':exports[_0x4b2980(0x14e)],'email':_0x4b2980(0x134),'roles':[role_enum_1['Role'][_0x4b2980(0x156)]],'password':exports[_0x4b2980(0x16f)]});}catch(_0x3804a8){this[_0x4b2980(0x184)][_0x4b2980(0x13a)](_0x3804a8);}}async[a160_0xa780e6(0x166)](){const _0x29c7c0=a160_0xa780e6,_0xeed72c=await this['userModel']['findOne']({'username':exports['MasterUserUsername']}),_0x17ec0d=await this[_0x29c7c0(0x16c)][_0x29c7c0(0x16e)](_0xeed72c[_0x29c7c0(0x16b)](),{'secret':process[_0x29c7c0(0x161)][_0x29c7c0(0x169)]});return _0x17ec0d;}};UserService=UserService_1=__decorate([(0x0,common_1[a160_0xa780e6(0x170)])(),__param(0x0,(0x0,mongoose_2[a160_0xa780e6(0x13d)])(a160_0xa780e6(0x136))),__metadata(a160_0xa780e6(0x176),[mongoose_1[a160_0xa780e6(0x158)],jwt_1['JwtService'],setting_service_1[a160_0xa780e6(0x15a)]])],UserService),exports[a160_0xa780e6(0x15f)]=UserService;