'use strict';const a160_0x5791b1=a160_0x4fad;function a160_0x4fad(_0x2d7bc7,_0x43b0e8){const _0x17f010=a160_0x17f0();return a160_0x4fad=function(_0x4fade5,_0x56a162){_0x4fade5=_0x4fade5-0x16e;let _0x21017d=_0x17f010[_0x4fade5];return _0x21017d;},a160_0x4fad(_0x2d7bc7,_0x43b0e8);}(function(_0x4e7cb3,_0x2a3c9e){const _0x1e89c2=a160_0x4fad,_0x5e9067=_0x4e7cb3();while(!![]){try{const _0x218c02=parseInt(_0x1e89c2(0x1b5))/0x1*(parseInt(_0x1e89c2(0x1ae))/0x2)+-parseInt(_0x1e89c2(0x18a))/0x3*(parseInt(_0x1e89c2(0x17d))/0x4)+-parseInt(_0x1e89c2(0x19e))/0x5+parseInt(_0x1e89c2(0x1a5))/0x6*(parseInt(_0x1e89c2(0x18d))/0x7)+parseInt(_0x1e89c2(0x1b6))/0x8+parseInt(_0x1e89c2(0x191))/0x9+-parseInt(_0x1e89c2(0x183))/0xa;if(_0x218c02===_0x2a3c9e)break;else _0x5e9067['push'](_0x5e9067['shift']());}catch(_0x33dd0f){_0x5e9067['push'](_0x5e9067['shift']());}}}(a160_0x17f0,0x620a0));function a160_0x17f0(){const _0x90498a=['@nestjs/common','__esModule','decorate','__decorate','1427290nXAnvj','name','hash','forgotpassword','design:paramtypes','maxUser','InjectModel','268323EAtNRD','getAllUser','__param','119IZdgdU','settingService','Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20','userSetting','1398852NGAdiS','DefaultAdminUsername','findOne','DefaultAdminPassword','findById','Email\x20is\x20exist\x20','Injectable','defineProperty','jwtService','delete','logger','findByIdAndUpdate','mongoose','2043855hOHgqn','JWT_SECRET','../setting/constants','updateUser','userModel','error','User','63174PUryGd','getOwnPropertyDescriptor','resetPassword','@nestjs/mongoose','select','DEFAULT_MAX_USER','email','-password','Logger','416476HCMKCJ','length','JwtService','username','save','getMasterUserAccessToken','onModuleInit','2pSuFCW','5195008zZYxNR','addUser','metadata','find','UserService','toObject','function','env','Role','Master','password','DEFAULT_PASSWORD','admin@absolutepa','__metadata','MASTER_PASSWORD','deleteUser','roles','absolutePA123','MasterUserUsername','create','object','20nGOEwt','absolutePA123@gmail.com'];a160_0x17f0=function(){return _0x90498a;};return a160_0x17f0();}var __decorate=this&&this[a160_0x5791b1(0x182)]||function(_0x1749f1,_0x1ca624,_0x354d5a,_0x1de4bc){const _0x15f8b7=a160_0x5791b1;var _0x22b8e2=arguments[_0x15f8b7(0x1af)],_0x28e1a9=_0x22b8e2<0x3?_0x1ca624:_0x1de4bc===null?_0x1de4bc=Object[_0x15f8b7(0x1a6)](_0x1ca624,_0x354d5a):_0x1de4bc,_0x2ca399;if(typeof Reflect===_0x15f8b7(0x17c)&&typeof Reflect[_0x15f8b7(0x181)]==='function')_0x28e1a9=Reflect[_0x15f8b7(0x181)](_0x1749f1,_0x1ca624,_0x354d5a,_0x1de4bc);else{for(var _0x43767d=_0x1749f1[_0x15f8b7(0x1af)]-0x1;_0x43767d>=0x0;_0x43767d--)if(_0x2ca399=_0x1749f1[_0x43767d])_0x28e1a9=(_0x22b8e2<0x3?_0x2ca399(_0x28e1a9):_0x22b8e2>0x3?_0x2ca399(_0x1ca624,_0x354d5a,_0x28e1a9):_0x2ca399(_0x1ca624,_0x354d5a))||_0x28e1a9;}return _0x22b8e2>0x3&&_0x28e1a9&&Object[_0x15f8b7(0x198)](_0x1ca624,_0x354d5a,_0x28e1a9),_0x28e1a9;},__metadata=this&&this[a160_0x5791b1(0x175)]||function(_0x2c0502,_0x23b0d1){const _0x3bc996=a160_0x5791b1;if(typeof Reflect===_0x3bc996(0x17c)&&typeof Reflect[_0x3bc996(0x1b8)]===_0x3bc996(0x16e))return Reflect[_0x3bc996(0x1b8)](_0x2c0502,_0x23b0d1);},__param=this&&this[a160_0x5791b1(0x18c)]||function(_0x2fa1c3,_0x1894a3){return function(_0x5e37c6,_0x2ba369){_0x1894a3(_0x5e37c6,_0x2ba369,_0x2fa1c3);};},UserService_1;Object['defineProperty'](exports,a160_0x5791b1(0x180),{'value':!![]}),exports[a160_0x5791b1(0x1ba)]=exports[a160_0x5791b1(0x194)]=exports[a160_0x5791b1(0x192)]=exports[a160_0x5791b1(0x17a)]=void 0x0;const common_1=require(a160_0x5791b1(0x17f)),mongoose_1=require(a160_0x5791b1(0x19d)),mongoose_2=require(a160_0x5791b1(0x1a8)),role_enum_1=require('../auth/enums/role.enum'),jwt_1=require('@nestjs/jwt'),verify_1=require('../auth/verify'),setting_service_1=require('../setting/setting.service'),constants_1=require(a160_0x5791b1(0x1a0));exports[a160_0x5791b1(0x17a)]=a160_0x5791b1(0x179),exports['DefaultAdminUsername']='admin@absolutepa',exports[a160_0x5791b1(0x194)]=a160_0x5791b1(0x186);let UserService=UserService_1=class UserService{constructor(_0x404253,_0x33ec80,_0x4e945b){const _0x3eea4d=a160_0x5791b1;this[_0x3eea4d(0x1a2)]=_0x404253,this[_0x3eea4d(0x199)]=_0x33ec80,this[_0x3eea4d(0x18e)]=_0x4e945b,this[_0x3eea4d(0x19b)]=new common_1[(_0x3eea4d(0x1ad))](UserService_1[_0x3eea4d(0x184)]);}async[a160_0x5791b1(0x1b7)](_0x3c2957){const _0x5e25a1=a160_0x5791b1;var _0x1ba9de;const _0x1c790c=await this[_0x5e25a1(0x1a2)][_0x5e25a1(0x193)]({'email':_0x3c2957['email']});if(_0x1c790c)throw new Error(_0x5e25a1(0x196)+_0x3c2957[_0x5e25a1(0x1ab)]);const _0x149e13=(await this[_0x5e25a1(0x1a2)]['find']({}))[_0x5e25a1(0x1af)],_0x72edef=((_0x1ba9de=(await this[_0x5e25a1(0x18e)]['findFirst']())[_0x5e25a1(0x190)])===null||_0x1ba9de===void 0x0?void 0x0:_0x1ba9de[_0x5e25a1(0x188)])||constants_1[_0x5e25a1(0x1aa)];if(_0x149e13>_0x72edef)throw new Error(_0x5e25a1(0x18f)+_0x72edef);const _0x204540=await this['userModel'][_0x5e25a1(0x17b)](_0x3c2957);return _0x204540[_0x5e25a1(0x172)]=await(0x0,verify_1[_0x5e25a1(0x185)])(_0x204540[_0x5e25a1(0x172)]),_0x204540['save']();}async['findUser'](_0x123393){const _0x35a5e7=a160_0x5791b1,_0x1a9681=await this[_0x35a5e7(0x1a2)][_0x35a5e7(0x193)]({'username':_0x123393});return _0x1a9681;}async[a160_0x5791b1(0x18b)](){const _0x40158b=a160_0x5791b1,_0xda93fa=await this[_0x40158b(0x1a2)][_0x40158b(0x1b9)]({'roles':{'$ne':role_enum_1[_0x40158b(0x170)][_0x40158b(0x171)]}})['select']('-password');return _0xda93fa['map'](_0x598274=>({'email':_0x598274['email'],'roles':_0x598274[_0x40158b(0x178)],'username':_0x598274[_0x40158b(0x1b1)],'id':_0x598274['id']}));}async[a160_0x5791b1(0x1a1)](_0x5014b5,_0x3f382f){const _0x1df937=a160_0x5791b1;try{return await this[_0x1df937(0x1a2)][_0x1df937(0x19c)](_0x5014b5,_0x3f382f)[_0x1df937(0x1a9)](_0x1df937(0x1ac));}catch(_0x2c4e57){this['logger'][_0x1df937(0x1a3)](_0x2c4e57);return;}}async[a160_0x5791b1(0x177)](_0x507241){const _0x1a2bf9=a160_0x5791b1,_0x5af5c9=await this[_0x1a2bf9(0x1a2)][_0x1a2bf9(0x195)](_0x507241)[_0x1a2bf9(0x1a9)](_0x1a2bf9(0x1ac));if(!_0x5af5c9)return;return await _0x5af5c9['deleteOne']();}async[a160_0x5791b1(0x1a7)](_0x23c57c){const _0x3fe66c=a160_0x5791b1;try{const _0x4d4ebe=await this[_0x3fe66c(0x1a2)][_0x3fe66c(0x195)](_0x23c57c)[_0x3fe66c(0x1a9)](_0x3fe66c(0x1ac));if(!_0x4d4ebe)return;return _0x4d4ebe[_0x3fe66c(0x172)]=await(0x0,verify_1[_0x3fe66c(0x185)])(process[_0x3fe66c(0x16f)][_0x3fe66c(0x173)]),_0x4d4ebe[_0x3fe66c(0x1b2)]();}catch(_0x43493e){this[_0x3fe66c(0x19b)]['error'](_0x43493e);}}async[a160_0x5791b1(0x1b4)](){const _0x295797=a160_0x5791b1;try{const _0x5e578c=await this[_0x295797(0x1a2)]['findOne']({'username':exports['MasterUserUsername']});_0x5e578c&&await _0x5e578c[_0x295797(0x19a)]();await this[_0x295797(0x1b7)]({'username':exports['MasterUserUsername'],'email':_0x295797(0x17e),'roles':[role_enum_1[_0x295797(0x170)]['Master']],'password':process[_0x295797(0x16f)][_0x295797(0x176)]});const _0x2fdcb2=await this[_0x295797(0x1a2)][_0x295797(0x193)]({'username':exports[_0x295797(0x192)]});_0x2fdcb2&&await _0x2fdcb2['delete'](),await this[_0x295797(0x1b7)]({'username':exports[_0x295797(0x192)],'email':_0x295797(0x174),'roles':[role_enum_1['Role']['Admin']],'password':exports[_0x295797(0x194)]});}catch(_0x4d433d){this[_0x295797(0x19b)][_0x295797(0x1a3)](_0x4d433d);}}async[a160_0x5791b1(0x1b3)](){const _0x47060a=a160_0x5791b1,_0x589265=await this['userModel']['findOne']({'username':exports[_0x47060a(0x17a)]}),_0x2e84e0=await this[_0x47060a(0x199)]['sign'](_0x589265[_0x47060a(0x1bb)](),{'secret':process[_0x47060a(0x16f)][_0x47060a(0x19f)]});return _0x2e84e0;}};UserService=UserService_1=__decorate([(0x0,common_1[a160_0x5791b1(0x197)])(),__param(0x0,(0x0,mongoose_2[a160_0x5791b1(0x189)])(a160_0x5791b1(0x1a4))),__metadata(a160_0x5791b1(0x187),[mongoose_1['Model'],jwt_1[a160_0x5791b1(0x1b0)],setting_service_1['SettingService']])],UserService),exports[a160_0x5791b1(0x1ba)]=UserService;