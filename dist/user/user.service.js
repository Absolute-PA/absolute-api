'use strict';const a160_0x25523d=a160_0x2401;(function(_0x245a95,_0x2f7319){const _0x355768=a160_0x2401,_0x315f68=_0x245a95();while(!![]){try{const _0x109c56=-parseInt(_0x355768(0x102))/0x1*(-parseInt(_0x355768(0x140))/0x2)+parseInt(_0x355768(0x121))/0x3+-parseInt(_0x355768(0x12d))/0x4*(-parseInt(_0x355768(0x103))/0x5)+parseInt(_0x355768(0x135))/0x6*(-parseInt(_0x355768(0x120))/0x7)+-parseInt(_0x355768(0x12b))/0x8+parseInt(_0x355768(0x111))/0x9+parseInt(_0x355768(0x112))/0xa;if(_0x109c56===_0x2f7319)break;else _0x315f68['push'](_0x315f68['shift']());}catch(_0x25b51b){_0x315f68['push'](_0x315f68['shift']());}}}(a160_0x1780,0x3c47f));var __decorate=this&&this[a160_0x25523d(0x148)]||function(_0x65ac95,_0x2482f5,_0x208503,_0x29fb2f){const _0x416879=a160_0x25523d;var _0x112a2f=arguments[_0x416879(0x13a)],_0x12b305=_0x112a2f<0x3?_0x2482f5:_0x29fb2f===null?_0x29fb2f=Object[_0x416879(0x139)](_0x2482f5,_0x208503):_0x29fb2f,_0x241474;if(typeof Reflect===_0x416879(0x141)&&typeof Reflect[_0x416879(0x128)]===_0x416879(0x131))_0x12b305=Reflect[_0x416879(0x128)](_0x65ac95,_0x2482f5,_0x208503,_0x29fb2f);else{for(var _0x332298=_0x65ac95[_0x416879(0x13a)]-0x1;_0x332298>=0x0;_0x332298--)if(_0x241474=_0x65ac95[_0x332298])_0x12b305=(_0x112a2f<0x3?_0x241474(_0x12b305):_0x112a2f>0x3?_0x241474(_0x2482f5,_0x208503,_0x12b305):_0x241474(_0x2482f5,_0x208503))||_0x12b305;}return _0x112a2f>0x3&&_0x12b305&&Object['defineProperty'](_0x2482f5,_0x208503,_0x12b305),_0x12b305;},__metadata=this&&this['__metadata']||function(_0x1ff8e7,_0x5d9450){const _0x497fb5=a160_0x25523d;if(typeof Reflect===_0x497fb5(0x141)&&typeof Reflect[_0x497fb5(0x138)]===_0x497fb5(0x131))return Reflect[_0x497fb5(0x138)](_0x1ff8e7,_0x5d9450);},__param=this&&this[a160_0x25523d(0x10d)]||function(_0x1ef37e,_0x5aad1b){return function(_0x25b418,_0x6cd34b){_0x5aad1b(_0x25b418,_0x6cd34b,_0x1ef37e);};},UserService_1;Object[a160_0x25523d(0x122)](exports,a160_0x25523d(0x107),{'value':!![]}),exports['UserService']=exports[a160_0x25523d(0x101)]=exports['DefaultAdminUsername']=exports[a160_0x25523d(0x123)]=void 0x0;const common_1=require(a160_0x25523d(0x116)),mongoose_1=require(a160_0x25523d(0x13b)),mongoose_2=require(a160_0x25523d(0x132)),role_enum_1=require('../auth/enums/role.enum'),jwt_1=require(a160_0x25523d(0x10b)),verify_1=require('../auth/verify'),setting_service_1=require(a160_0x25523d(0x13c)),constants_1=require(a160_0x25523d(0x11d));exports[a160_0x25523d(0x123)]=a160_0x25523d(0x104),exports['DefaultAdminUsername']=a160_0x25523d(0x11e),exports[a160_0x25523d(0x101)]=a160_0x25523d(0x143);let UserService=UserService_1=class UserService{constructor(_0x26522c,_0x46954c,_0x2d766b){const _0x22821e=a160_0x25523d;this['userModel']=_0x26522c,this[_0x22821e(0x11b)]=_0x46954c,this[_0x22821e(0x117)]=_0x2d766b,this[_0x22821e(0x134)]=new common_1[(_0x22821e(0x146))](UserService_1['name']);}async[a160_0x25523d(0x119)](_0x274524){const _0x7556f6=a160_0x25523d;var _0x1cd5a6;const _0x3f6316=await this[_0x7556f6(0x133)][_0x7556f6(0x12e)]({'email':_0x274524[_0x7556f6(0x13d)]});if(_0x3f6316)throw new Error(_0x7556f6(0x130)+_0x274524[_0x7556f6(0x13d)]);const _0x4ac3ca=(await this[_0x7556f6(0x133)][_0x7556f6(0x12c)]({}))['length'],_0xa056be=((_0x1cd5a6=(await this[_0x7556f6(0x117)]['findFirst']())['userSetting'])===null||_0x1cd5a6===void 0x0?void 0x0:_0x1cd5a6['maxUser'])||constants_1['DEFAULT_MAX_USER'];if(_0x4ac3ca>_0xa056be)throw new Error(_0x7556f6(0x126)+_0xa056be);const _0x1cc81e=await this[_0x7556f6(0x133)][_0x7556f6(0x14a)](_0x274524);return _0x1cc81e['password']=await(0x0,verify_1[_0x7556f6(0x106)])(_0x1cc81e[_0x7556f6(0x127)]),_0x1cc81e[_0x7556f6(0x109)]();}async[a160_0x25523d(0x13e)](_0x3892d4){const _0x582079=a160_0x25523d,_0x431ceb=await this[_0x582079(0x133)][_0x582079(0x12e)]({'username':_0x3892d4});return _0x431ceb;}async['getAllUser'](){const _0x1de96e=a160_0x25523d,_0x2effde=await this['userModel'][_0x1de96e(0x12c)]({'roles':{'$ne':role_enum_1['Role']['Master']}})[_0x1de96e(0x136)](_0x1de96e(0x145));return _0x2effde['map'](_0x431415=>({'email':_0x431415[_0x1de96e(0x13d)],'roles':_0x431415[_0x1de96e(0x129)],'username':_0x431415['username'],'id':_0x431415['id']}));}async['updateUser'](_0x27d2a4,_0x19f578){const _0x16b9f5=a160_0x25523d;try{return await this['userModel'][_0x16b9f5(0x105)](_0x27d2a4,_0x19f578)['select'](_0x16b9f5(0x145));}catch(_0x3445bc){this[_0x16b9f5(0x134)][_0x16b9f5(0x114)](_0x3445bc);return;}}async['deleteUser'](_0x3d9a5b){const _0x2c180e=a160_0x25523d,_0x3e2734=await this['userModel'][_0x2c180e(0x11a)](_0x3d9a5b)[_0x2c180e(0x136)]('-password');if(!_0x3e2734)return;return await _0x3e2734[_0x2c180e(0x149)]();}async['resetPassword'](_0xa91926){const _0x4f72b9=a160_0x25523d;try{const _0x51fa46=await this[_0x4f72b9(0x133)][_0x4f72b9(0x11a)](_0xa91926)[_0x4f72b9(0x136)](_0x4f72b9(0x145));if(!_0x51fa46)return;return _0x51fa46['password']=await(0x0,verify_1[_0x4f72b9(0x106)])(process[_0x4f72b9(0x142)][_0x4f72b9(0x11c)]),_0x51fa46['save']();}catch(_0x2a8e7f){this[_0x4f72b9(0x134)][_0x4f72b9(0x114)](_0x2a8e7f);}}async[a160_0x25523d(0x11f)](){const _0x260016=a160_0x25523d;try{const _0x2d6472=await this[_0x260016(0x133)][_0x260016(0x12e)]({'username':exports[_0x260016(0x123)]});_0x2d6472&&await _0x2d6472[_0x260016(0x12f)]();await this[_0x260016(0x119)]({'username':exports['MasterUserUsername'],'email':_0x260016(0x118),'roles':[role_enum_1[_0x260016(0x124)][_0x260016(0x10c)]],'password':process['env'][_0x260016(0x115)]});const _0x1b0428=await this[_0x260016(0x133)][_0x260016(0x12e)]({'username':exports[_0x260016(0x108)]});_0x1b0428&&await _0x1b0428[_0x260016(0x12f)](),await this['addUser']({'username':exports[_0x260016(0x108)],'email':_0x260016(0x11e),'roles':[role_enum_1[_0x260016(0x124)][_0x260016(0x10f)]],'password':exports[_0x260016(0x101)]});}catch(_0x3e1ccf){this['logger'][_0x260016(0x114)](_0x3e1ccf);}}async[a160_0x25523d(0x125)](){const _0x1c768a=a160_0x25523d,_0x1c4ac3=await this[_0x1c768a(0x133)][_0x1c768a(0x12e)]({'username':exports['MasterUserUsername']}),_0x49e667=await this[_0x1c768a(0x11b)][_0x1c768a(0x113)](_0x1c4ac3[_0x1c768a(0x10a)](),{'secret':process['env'][_0x1c768a(0x13f)]});return _0x49e667;}};function a160_0x1780(){const _0x2dbe09=['Master','__param','Model','Admin','JwtService','1236240mviAlN','2337560fCkNKu','sign','error','MASTER_PASSWORD','@nestjs/common','settingService','absolutePA123@gmail.com','addUser','findById','jwtService','DEFAULT_PASSWORD','../setting/constants','admin@absolutepa','onModuleInit','19971HPxKiZ','952662MOjGys','defineProperty','MasterUserUsername','Role','getMasterUserAccessToken','Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20','password','decorate','roles','UserService','2486456hXsNKi','find','114284GaCjHP','findOne','delete','Email\x20is\x20exist\x20','function','@nestjs/mongoose','userModel','logger','972IBWQJv','select','InjectModel','metadata','getOwnPropertyDescriptor','length','mongoose','../setting/setting.service','email','findUser','JWT_SECRET','2TSKKLp','object','env','forgotpassword','Injectable','-password','Logger','design:paramtypes','__decorate','deleteOne','create','DefaultAdminPassword','216950IpoZfk','20sWgxEs','absolutePA123','findByIdAndUpdate','hash','__esModule','DefaultAdminUsername','save','toObject','@nestjs/jwt'];a160_0x1780=function(){return _0x2dbe09;};return a160_0x1780();}function a160_0x2401(_0x11e63a,_0x2d9356){const _0x178025=a160_0x1780();return a160_0x2401=function(_0x240194,_0x280e40){_0x240194=_0x240194-0x101;let _0x1b19ff=_0x178025[_0x240194];return _0x1b19ff;},a160_0x2401(_0x11e63a,_0x2d9356);}UserService=UserService_1=__decorate([(0x0,common_1[a160_0x25523d(0x144)])(),__param(0x0,(0x0,mongoose_2[a160_0x25523d(0x137)])('User')),__metadata(a160_0x25523d(0x147),[mongoose_1[a160_0x25523d(0x10e)],jwt_1[a160_0x25523d(0x110)],setting_service_1['SettingService']])],UserService),exports[a160_0x25523d(0x12a)]=UserService;