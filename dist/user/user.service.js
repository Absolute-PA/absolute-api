'use strict';function a157_0x2473(){const _0x3ebe6c=['userModel','deleteOne','userSetting','getOwnPropertyDescriptor','hash','email','password','UserService','User','save','@nestjs/jwt','Role','findByIdAndUpdate','findOne','select','absolutePA123','findFirst','logger','Injectable','@nestjs/common','find','__param','username','object','error','settingService','absolutePA123@gmail.com','roles','3165396RcnyqF','1486AjnJru','DEFAULT_MAX_USER','env','InjectModel','deleteUser','metadata','Email\x20is\x20exist','MasterUserUsername','259ndKsJb','136280xZQIIg','toObject','DEFAULT_PASSWORD','__decorate','JWT_SECRET','285316QVrSGr','create','../auth/enums/role.enum','564115sEkGvh','__esModule','maxUser','@nestjs/mongoose','../setting/constants','design:paramtypes','11143tUHlpt','sign','6620dNoGsD','JwtService','673ppdWLt','Logger','name','__metadata','11806065KHiERB','findById','../setting/setting.service','jwtService','map','addUser','mongoose','MASTER_PASSWORD','onModuleInit','SettingService','decorate','42umkPkH','length','-password'];a157_0x2473=function(){return _0x3ebe6c;};return a157_0x2473();}const a157_0x3d9029=a157_0x4a0c;(function(_0x35f76c,_0x350216){const _0x4396e2=a157_0x4a0c,_0x35b87d=_0x35f76c();while(!![]){try{const _0x6ea457=-parseInt(_0x4396e2(0xae))/0x1*(-parseInt(_0x4396e2(0x93))/0x2)+parseInt(_0x4396e2(0x92))/0x3+-parseInt(_0x4396e2(0xa1))/0x4+-parseInt(_0x4396e2(0xa4))/0x5*(parseInt(_0x4396e2(0xbd))/0x6)+-parseInt(_0x4396e2(0x9b))/0x7*(parseInt(_0x4396e2(0x9c))/0x8)+parseInt(_0x4396e2(0xb2))/0x9+-parseInt(_0x4396e2(0xac))/0xa*(parseInt(_0x4396e2(0xaa))/0xb);if(_0x6ea457===_0x350216)break;else _0x35b87d['push'](_0x35b87d['shift']());}catch(_0x29f5ae){_0x35b87d['push'](_0x35b87d['shift']());}}}(a157_0x2473,0xac1c5));var __decorate=this&&this[a157_0x3d9029(0x9f)]||function(_0x2b1c1c,_0x23249d,_0x2549a5,_0xdf8963){const _0x561934=a157_0x3d9029;var _0x2a0844=arguments[_0x561934(0xbe)],_0x59934f=_0x2a0844<0x3?_0x23249d:_0xdf8963===null?_0xdf8963=Object[_0x561934(0xc3)](_0x23249d,_0x2549a5):_0xdf8963,_0x2b3a8a;if(typeof Reflect===_0x561934(0x8d)&&typeof Reflect[_0x561934(0xbc)]==='function')_0x59934f=Reflect['decorate'](_0x2b1c1c,_0x23249d,_0x2549a5,_0xdf8963);else{for(var _0x546ec0=_0x2b1c1c['length']-0x1;_0x546ec0>=0x0;_0x546ec0--)if(_0x2b3a8a=_0x2b1c1c[_0x546ec0])_0x59934f=(_0x2a0844<0x3?_0x2b3a8a(_0x59934f):_0x2a0844>0x3?_0x2b3a8a(_0x23249d,_0x2549a5,_0x59934f):_0x2b3a8a(_0x23249d,_0x2549a5))||_0x59934f;}return _0x2a0844>0x3&&_0x59934f&&Object['defineProperty'](_0x23249d,_0x2549a5,_0x59934f),_0x59934f;},__metadata=this&&this[a157_0x3d9029(0xb1)]||function(_0x5ec26d,_0x11f329){const _0x6fe42b=a157_0x3d9029;if(typeof Reflect===_0x6fe42b(0x8d)&&typeof Reflect['metadata']==='function')return Reflect[_0x6fe42b(0x98)](_0x5ec26d,_0x11f329);},__param=this&&this[a157_0x3d9029(0x8b)]||function(_0xefe079,_0x4dc678){return function(_0x143479,_0x425931){_0x4dc678(_0x143479,_0x425931,_0xefe079);};},UserService_1;Object['defineProperty'](exports,a157_0x3d9029(0xa5),{'value':!![]}),exports['UserService']=exports[a157_0x3d9029(0x9a)]=void 0x0;const common_1=require(a157_0x3d9029(0x89)),mongoose_1=require(a157_0x3d9029(0xb8)),mongoose_2=require(a157_0x3d9029(0xa7)),role_enum_1=require(a157_0x3d9029(0xa3)),jwt_1=require(a157_0x3d9029(0x80)),verify_1=require('../auth/verify'),setting_service_1=require(a157_0x3d9029(0xb4)),constants_1=require(a157_0x3d9029(0xa8));exports[a157_0x3d9029(0x9a)]=a157_0x3d9029(0x85);function a157_0x4a0c(_0x461a94,_0x2cec60){const _0x2473b2=a157_0x2473();return a157_0x4a0c=function(_0x4a0c4a,_0x3e198b){_0x4a0c4a=_0x4a0c4a-0x7f;let _0x4be6a9=_0x2473b2[_0x4a0c4a];return _0x4be6a9;},a157_0x4a0c(_0x461a94,_0x2cec60);}let UserService=UserService_1=class UserService{constructor(_0x21a015,_0x3268b0,_0x2eff7c){const _0x33afc4=a157_0x3d9029;this[_0x33afc4(0xc0)]=_0x21a015,this[_0x33afc4(0xb5)]=_0x3268b0,this[_0x33afc4(0x8f)]=_0x2eff7c,this[_0x33afc4(0x87)]=new common_1[(_0x33afc4(0xaf))](UserService_1[_0x33afc4(0xb0)]);}async['addUser'](_0x34b7d3){const _0xfdc583=a157_0x3d9029;var _0x53c5f5;const _0x20e603=await this[_0xfdc583(0xc0)][_0xfdc583(0x83)]({'email':_0x34b7d3[_0xfdc583(0xc5)]});if(_0x20e603)throw new Error(_0xfdc583(0x99));const _0x320626=(await this[_0xfdc583(0xc0)][_0xfdc583(0x8a)]({}))[_0xfdc583(0xbe)],_0x19d634=((_0x53c5f5=(await this['settingService'][_0xfdc583(0x86)]())[_0xfdc583(0xc2)])===null||_0x53c5f5===void 0x0?void 0x0:_0x53c5f5[_0xfdc583(0xa6)])||constants_1[_0xfdc583(0x94)];if(_0x320626>_0x19d634)throw new Error('Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20'+_0x19d634);const _0x3af76a=await this[_0xfdc583(0xc0)][_0xfdc583(0xa2)](_0x34b7d3);return _0x3af76a[_0xfdc583(0xc6)]=await(0x0,verify_1[_0xfdc583(0xc4)])(_0x3af76a[_0xfdc583(0xc6)]),_0x3af76a[_0xfdc583(0x7f)]();}async['findUser'](_0x1728ed){const _0x1056aa=a157_0x3d9029,_0x145d25=await this[_0x1056aa(0xc0)][_0x1056aa(0x83)]({'username':_0x1728ed});return _0x145d25;}async['getAllUser'](){const _0x5f476c=a157_0x3d9029,_0x13fae4=await this[_0x5f476c(0xc0)]['find']({'roles':{'$ne':role_enum_1[_0x5f476c(0x81)]['Master']}})[_0x5f476c(0x84)](_0x5f476c(0xbf));return _0x13fae4[_0x5f476c(0xb6)](_0x1a25cf=>({'email':_0x1a25cf['email'],'roles':_0x1a25cf[_0x5f476c(0x91)],'username':_0x1a25cf[_0x5f476c(0x8c)],'id':_0x1a25cf['id']}));}async['updateUser'](_0x446f85,_0x50ff40){const _0x1b304f=a157_0x3d9029;try{return await this['userModel'][_0x1b304f(0x82)](_0x446f85,_0x50ff40)[_0x1b304f(0x84)](_0x1b304f(0xbf));}catch(_0x2c69e6){this[_0x1b304f(0x87)][_0x1b304f(0x8e)](_0x2c69e6);return;}}async[a157_0x3d9029(0x97)](_0x59b367){const _0x440088=a157_0x3d9029,_0x4caee2=await this['userModel'][_0x440088(0xb3)](_0x59b367)['select']('-password');if(!_0x4caee2)return;return await _0x4caee2[_0x440088(0xc1)]();}async['resetPassword'](_0xccb4cd){const _0x2df42c=a157_0x3d9029;try{const _0x333c69=await this[_0x2df42c(0xc0)][_0x2df42c(0xb3)](_0xccb4cd)[_0x2df42c(0x84)]('-password');if(!_0x333c69)return;return _0x333c69[_0x2df42c(0xc6)]=await(0x0,verify_1[_0x2df42c(0xc4)])(process[_0x2df42c(0x95)][_0x2df42c(0x9e)]),_0x333c69[_0x2df42c(0x7f)]();}catch(_0x87cf09){this[_0x2df42c(0x87)][_0x2df42c(0x8e)](_0x87cf09);}}async[a157_0x3d9029(0xba)](){const _0x2f7bc6=a157_0x3d9029;try{const _0x51c530=await this[_0x2f7bc6(0xc0)][_0x2f7bc6(0x83)]({'username':exports['MasterUserUsername']});_0x51c530&&await _0x51c530['delete'](),await this[_0x2f7bc6(0xb7)]({'username':exports['MasterUserUsername'],'email':_0x2f7bc6(0x90),'roles':[role_enum_1[_0x2f7bc6(0x81)]['Master']],'password':process['env'][_0x2f7bc6(0xb9)]});}catch(_0x5770d0){this['logger'][_0x2f7bc6(0x8e)](_0x5770d0);throw _0x5770d0;}}async['getMasterUserAccessToken'](){const _0x41ce82=a157_0x3d9029,_0x3cf94b=await this[_0x41ce82(0xc0)]['findOne']({'username':exports[_0x41ce82(0x9a)]}),_0x49a47c=await this[_0x41ce82(0xb5)][_0x41ce82(0xab)](_0x3cf94b[_0x41ce82(0x9d)](),{'secret':process[_0x41ce82(0x95)][_0x41ce82(0xa0)]});return _0x49a47c;}};UserService=UserService_1=__decorate([(0x0,common_1[a157_0x3d9029(0x88)])(),__param(0x0,(0x0,mongoose_2[a157_0x3d9029(0x96)])(a157_0x3d9029(0xc8))),__metadata(a157_0x3d9029(0xa9),[mongoose_1['Model'],jwt_1[a157_0x3d9029(0xad)],setting_service_1[a157_0x3d9029(0xbb)]])],UserService),exports[a157_0x3d9029(0xc7)]=UserService;