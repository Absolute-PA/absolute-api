'use strict';function a160_0x2f36(){const _0x477360=['hash','@nestjs/common','../auth/verify','toObject','find','__metadata','10562838TLequW','432542mNDUyU','function','DefaultAdminPassword','InjectModel','jwtService','userSetting','forgotpassword','length','MasterUserUsername','JwtService','roles','findById','DefaultAdminUsername','settingService','save','JWT_SECRET','addUser','deleteUser','UserService','../setting/constants','108XqttDz','37838320HevghY','admin@absolutepa','create','metadata','resetPassword','User','../auth/enums/role.enum','@nestjs/jwt','select','__decorate','getMasterUserAccessToken','name','defineProperty','findUser','104768OHLKqa','object','onModuleInit','maxUser','env','Master','absolutePA123','error','username','absolutePA123@gmail.com','../setting/setting.service','deleteOne','DEFAULT_MAX_USER','design:paramtypes','sign','password','-password','logger','findOne','__param','userModel','871971weitmC','decorate','__esModule','email','3594311FCsbey','delete','183220QjoHCj','Role','getAllUser','Logger','map'];a160_0x2f36=function(){return _0x477360;};return a160_0x2f36();}const a160_0x1e06f1=a160_0x517b;(function(_0x44d640,_0x2036a5){const _0x40a0a3=a160_0x517b,_0x2e7031=_0x44d640();while(!![]){try{const _0x28e961=-parseInt(_0x40a0a3(0x181))/0x1+parseInt(_0x40a0a3(0x149))/0x2+-parseInt(_0x40a0a3(0x15d))/0x3*(parseInt(_0x40a0a3(0x16c))/0x4)+parseInt(_0x40a0a3(0x187))/0x5+-parseInt(_0x40a0a3(0x148))/0x6+-parseInt(_0x40a0a3(0x185))/0x7+parseInt(_0x40a0a3(0x15e))/0x8;if(_0x28e961===_0x2036a5)break;else _0x2e7031['push'](_0x2e7031['shift']());}catch(_0x2672b0){_0x2e7031['push'](_0x2e7031['shift']());}}}(a160_0x2f36,0xda3b4));function a160_0x517b(_0x35f4be,_0x8b98e1){const _0x2f3673=a160_0x2f36();return a160_0x517b=function(_0x517b27,_0x31744b){_0x517b27=_0x517b27-0x143;let _0x4c3e64=_0x2f3673[_0x517b27];return _0x4c3e64;},a160_0x517b(_0x35f4be,_0x8b98e1);}var __decorate=this&&this[a160_0x1e06f1(0x167)]||function(_0x19b747,_0x44b801,_0x29f935,_0x8f1ee9){const _0x5c406e=a160_0x1e06f1;var _0x1ce6ce=arguments[_0x5c406e(0x150)],_0x1bd2a1=_0x1ce6ce<0x3?_0x44b801:_0x8f1ee9===null?_0x8f1ee9=Object['getOwnPropertyDescriptor'](_0x44b801,_0x29f935):_0x8f1ee9,_0x38b337;if(typeof Reflect===_0x5c406e(0x16d)&&typeof Reflect[_0x5c406e(0x182)]===_0x5c406e(0x14a))_0x1bd2a1=Reflect['decorate'](_0x19b747,_0x44b801,_0x29f935,_0x8f1ee9);else{for(var _0x585e62=_0x19b747[_0x5c406e(0x150)]-0x1;_0x585e62>=0x0;_0x585e62--)if(_0x38b337=_0x19b747[_0x585e62])_0x1bd2a1=(_0x1ce6ce<0x3?_0x38b337(_0x1bd2a1):_0x1ce6ce>0x3?_0x38b337(_0x44b801,_0x29f935,_0x1bd2a1):_0x38b337(_0x44b801,_0x29f935))||_0x1bd2a1;}return _0x1ce6ce>0x3&&_0x1bd2a1&&Object['defineProperty'](_0x44b801,_0x29f935,_0x1bd2a1),_0x1bd2a1;},__metadata=this&&this[a160_0x1e06f1(0x147)]||function(_0xac9eeb,_0x3c6650){const _0x251223=a160_0x1e06f1;if(typeof Reflect===_0x251223(0x16d)&&typeof Reflect['metadata']===_0x251223(0x14a))return Reflect[_0x251223(0x161)](_0xac9eeb,_0x3c6650);},__param=this&&this[a160_0x1e06f1(0x17f)]||function(_0x275f2f,_0x2aaf5d){return function(_0x18c771,_0xf9680e){_0x2aaf5d(_0x18c771,_0xf9680e,_0x275f2f);};},UserService_1;Object[a160_0x1e06f1(0x16a)](exports,a160_0x1e06f1(0x183),{'value':!![]}),exports[a160_0x1e06f1(0x15b)]=exports[a160_0x1e06f1(0x14b)]=exports[a160_0x1e06f1(0x155)]=exports[a160_0x1e06f1(0x151)]=void 0x0;const common_1=require(a160_0x1e06f1(0x143)),mongoose_1=require('mongoose'),mongoose_2=require('@nestjs/mongoose'),role_enum_1=require(a160_0x1e06f1(0x164)),jwt_1=require(a160_0x1e06f1(0x165)),verify_1=require(a160_0x1e06f1(0x144)),setting_service_1=require(a160_0x1e06f1(0x176)),constants_1=require(a160_0x1e06f1(0x15c));exports[a160_0x1e06f1(0x151)]=a160_0x1e06f1(0x172),exports[a160_0x1e06f1(0x155)]=a160_0x1e06f1(0x15f),exports[a160_0x1e06f1(0x14b)]=a160_0x1e06f1(0x14f);let UserService=UserService_1=class UserService{constructor(_0x380e43,_0x237fb8,_0x2273a9){const _0x2f6bf9=a160_0x1e06f1;this[_0x2f6bf9(0x180)]=_0x380e43,this[_0x2f6bf9(0x14d)]=_0x237fb8,this[_0x2f6bf9(0x156)]=_0x2273a9,this[_0x2f6bf9(0x17d)]=new common_1[(_0x2f6bf9(0x18a))](UserService_1[_0x2f6bf9(0x169)]);}async[a160_0x1e06f1(0x159)](_0x52b05e){const _0x473928=a160_0x1e06f1;var _0x5837a1;const _0xd29eb7=await this[_0x473928(0x180)][_0x473928(0x17e)]({'email':_0x52b05e[_0x473928(0x184)]});if(_0xd29eb7)throw new Error('Email\x20is\x20exist\x20'+_0x52b05e[_0x473928(0x184)]);const _0x28ff98=(await this[_0x473928(0x180)]['find']({}))[_0x473928(0x150)],_0x2a35c7=((_0x5837a1=(await this['settingService']['findFirst']())[_0x473928(0x14e)])===null||_0x5837a1===void 0x0?void 0x0:_0x5837a1[_0x473928(0x16f)])||constants_1[_0x473928(0x178)];if(_0x28ff98>_0x2a35c7)throw new Error('Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20'+_0x2a35c7);const _0x2b8b2b=await this['userModel'][_0x473928(0x160)](_0x52b05e);return _0x2b8b2b['password']=await(0x0,verify_1[_0x473928(0x18c)])(_0x2b8b2b[_0x473928(0x17b)]),_0x2b8b2b[_0x473928(0x157)]();}async[a160_0x1e06f1(0x16b)](_0x14706d){const _0x322699=a160_0x1e06f1,_0x163094=await this['userModel'][_0x322699(0x17e)]({'username':_0x14706d});return _0x163094;}async[a160_0x1e06f1(0x189)](){const _0xd3db0b=a160_0x1e06f1,_0x4417fb=await this[_0xd3db0b(0x180)][_0xd3db0b(0x146)]({'roles':{'$ne':role_enum_1[_0xd3db0b(0x188)][_0xd3db0b(0x171)]}})[_0xd3db0b(0x166)](_0xd3db0b(0x17c));return _0x4417fb[_0xd3db0b(0x18b)](_0x3a5618=>({'email':_0x3a5618[_0xd3db0b(0x184)],'roles':_0x3a5618[_0xd3db0b(0x153)],'username':_0x3a5618[_0xd3db0b(0x174)],'id':_0x3a5618['id']}));}async['updateUser'](_0x27d254,_0x15234d){const _0x3dcb5b=a160_0x1e06f1;try{return await this[_0x3dcb5b(0x180)]['findByIdAndUpdate'](_0x27d254,_0x15234d)[_0x3dcb5b(0x166)](_0x3dcb5b(0x17c));}catch(_0x1ca457){this[_0x3dcb5b(0x17d)][_0x3dcb5b(0x173)](_0x1ca457);return;}}async[a160_0x1e06f1(0x15a)](_0x2c37f9){const _0xa42e87=a160_0x1e06f1,_0x5f2a67=await this[_0xa42e87(0x180)][_0xa42e87(0x154)](_0x2c37f9)['select'](_0xa42e87(0x17c));if(!_0x5f2a67)return;return await _0x5f2a67[_0xa42e87(0x177)]();}async[a160_0x1e06f1(0x162)](_0x3200ed){const _0x35f15b=a160_0x1e06f1;try{const _0x26eae7=await this['userModel'][_0x35f15b(0x154)](_0x3200ed)[_0x35f15b(0x166)](_0x35f15b(0x17c));if(!_0x26eae7)return;return _0x26eae7['password']=await(0x0,verify_1[_0x35f15b(0x18c)])(process[_0x35f15b(0x170)]['DEFAULT_PASSWORD']),_0x26eae7[_0x35f15b(0x157)]();}catch(_0x50de21){this[_0x35f15b(0x17d)][_0x35f15b(0x173)](_0x50de21);}}async[a160_0x1e06f1(0x16e)](){const _0x8a599e=a160_0x1e06f1;try{const _0x1fcbc2=await this['userModel'][_0x8a599e(0x17e)]({'username':exports[_0x8a599e(0x151)]});_0x1fcbc2&&await _0x1fcbc2[_0x8a599e(0x186)]();await this[_0x8a599e(0x159)]({'username':exports[_0x8a599e(0x151)],'email':_0x8a599e(0x175),'roles':[role_enum_1[_0x8a599e(0x188)]['Master']],'password':process[_0x8a599e(0x170)]['MASTER_PASSWORD']});const _0x5b4dc5=await this[_0x8a599e(0x180)][_0x8a599e(0x17e)]({'username':exports['DefaultAdminUsername']});_0x5b4dc5&&await _0x5b4dc5['delete'](),await this[_0x8a599e(0x159)]({'username':exports[_0x8a599e(0x155)],'email':'admin@absolutepa','roles':[role_enum_1[_0x8a599e(0x188)]['Admin']],'password':exports[_0x8a599e(0x14b)]});}catch(_0x269c8f){this[_0x8a599e(0x17d)][_0x8a599e(0x173)](_0x269c8f);}}async[a160_0x1e06f1(0x168)](){const _0x3b8c72=a160_0x1e06f1,_0x5c0d97=await this[_0x3b8c72(0x180)]['findOne']({'username':exports[_0x3b8c72(0x151)]}),_0x2af3f2=await this[_0x3b8c72(0x14d)][_0x3b8c72(0x17a)](_0x5c0d97[_0x3b8c72(0x145)](),{'secret':process['env'][_0x3b8c72(0x158)]});return _0x2af3f2;}};UserService=UserService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_2[a160_0x1e06f1(0x14c)])(a160_0x1e06f1(0x163))),__metadata(a160_0x1e06f1(0x179),[mongoose_1['Model'],jwt_1[a160_0x1e06f1(0x152)],setting_service_1['SettingService']])],UserService),exports[a160_0x1e06f1(0x15b)]=UserService;