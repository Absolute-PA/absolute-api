'use strict';const a157_0x3a1413=a157_0x14da;(function(_0x19b0db,_0x38918d){const _0x4966af=a157_0x14da,_0x229ca9=_0x19b0db();while(!![]){try{const _0x110813=-parseInt(_0x4966af(0xf3))/0x1+parseInt(_0x4966af(0x11b))/0x2+parseInt(_0x4966af(0x119))/0x3*(-parseInt(_0x4966af(0xf4))/0x4)+parseInt(_0x4966af(0xf5))/0x5+-parseInt(_0x4966af(0xec))/0x6*(parseInt(_0x4966af(0x10b))/0x7)+-parseInt(_0x4966af(0xe4))/0x8+parseInt(_0x4966af(0xe3))/0x9;if(_0x110813===_0x38918d)break;else _0x229ca9['push'](_0x229ca9['shift']());}catch(_0x575200){_0x229ca9['push'](_0x229ca9['shift']());}}}(a157_0x1bc0,0xe66bc));function a157_0x1bc0(){const _0x1408d7=['5152ykyOxq','map','jwtService','absolutePA123@gmail.com','password','hash','userModel','__decorate','function','logger','name','create','JwtService','design:paramtypes','65634oYcNBT','findById','2773880OYmcEF','find','@nestjs/mongoose','@nestjs/common','Model','Logger','mongoose','Master','select','save','sign','onModuleInit','35301807pbajSl','14474208VimhHQ','SettingService','object','InjectModel','addUser','deleteOne','findUser','findFirst','11898DYeJsx','username','getOwnPropertyDescriptor','env','deleteUser','error','../auth/enums/role.enum','900604rkHdAs','220YHacnS','5035495OCIktn','Email\x20is\x20exist','DEFAULT_MAX_USER','length','maxUser','resetPassword','delete','defineProperty','../setting/constants','MasterUserUsername','toObject','getAllUser','absolutePA123','__metadata','metadata','UserService','Role','-password','findOne','MASTER_PASSWORD','__param','email'];a157_0x1bc0=function(){return _0x1408d7;};return a157_0x1bc0();}var __decorate=this&&this[a157_0x3a1413(0x112)]||function(_0x934ad5,_0x4b4ffa,_0x2902dd,_0x2b88c1){const _0x1d3dcf=a157_0x3a1413;var _0x584b1c=arguments[_0x1d3dcf(0xf8)],_0x50a525=_0x584b1c<0x3?_0x4b4ffa:_0x2b88c1===null?_0x2b88c1=Object[_0x1d3dcf(0xee)](_0x4b4ffa,_0x2902dd):_0x2b88c1,_0x4ae1e0;if(typeof Reflect===_0x1d3dcf(0xe6)&&typeof Reflect['decorate']===_0x1d3dcf(0x113))_0x50a525=Reflect['decorate'](_0x934ad5,_0x4b4ffa,_0x2902dd,_0x2b88c1);else{for(var _0x2f54aa=_0x934ad5['length']-0x1;_0x2f54aa>=0x0;_0x2f54aa--)if(_0x4ae1e0=_0x934ad5[_0x2f54aa])_0x50a525=(_0x584b1c<0x3?_0x4ae1e0(_0x50a525):_0x584b1c>0x3?_0x4ae1e0(_0x4b4ffa,_0x2902dd,_0x50a525):_0x4ae1e0(_0x4b4ffa,_0x2902dd))||_0x50a525;}return _0x584b1c>0x3&&_0x50a525&&Object[_0x1d3dcf(0xfc)](_0x4b4ffa,_0x2902dd,_0x50a525),_0x50a525;},__metadata=this&&this[a157_0x3a1413(0x102)]||function(_0x4f8eb8,_0x29d911){const _0x5ca033=a157_0x3a1413;if(typeof Reflect===_0x5ca033(0xe6)&&typeof Reflect[_0x5ca033(0x103)]===_0x5ca033(0x113))return Reflect[_0x5ca033(0x103)](_0x4f8eb8,_0x29d911);},__param=this&&this[a157_0x3a1413(0x109)]||function(_0x458a8b,_0x4013dd){return function(_0x533662,_0x212e74){_0x4013dd(_0x533662,_0x212e74,_0x458a8b);};},UserService_1;Object[a157_0x3a1413(0xfc)](exports,'__esModule',{'value':!![]}),exports[a157_0x3a1413(0x104)]=exports[a157_0x3a1413(0xfe)]=void 0x0;function a157_0x14da(_0x3f6ba8,_0x1703da){const _0x1bc025=a157_0x1bc0();return a157_0x14da=function(_0x14daf0,_0x112119){_0x14daf0=_0x14daf0-0xd9;let _0x2e68c0=_0x1bc025[_0x14daf0];return _0x2e68c0;},a157_0x14da(_0x3f6ba8,_0x1703da);}const common_1=require(a157_0x3a1413(0xda)),mongoose_1=require(a157_0x3a1413(0xdd)),mongoose_2=require(a157_0x3a1413(0xd9)),role_enum_1=require(a157_0x3a1413(0xf2)),jwt_1=require('@nestjs/jwt'),verify_1=require('../auth/verify'),setting_service_1=require('../setting/setting.service'),constants_1=require(a157_0x3a1413(0xfd));exports[a157_0x3a1413(0xfe)]=a157_0x3a1413(0x101);let UserService=UserService_1=class UserService{constructor(_0x38ca41,_0x2fde92,_0x2a6994){const _0x163e15=a157_0x3a1413;this[_0x163e15(0x111)]=_0x38ca41,this[_0x163e15(0x10d)]=_0x2fde92,this['settingService']=_0x2a6994,this[_0x163e15(0x114)]=new common_1[(_0x163e15(0xdc))](UserService_1[_0x163e15(0x115)]);}async[a157_0x3a1413(0xe8)](_0x4dbf22){const _0x872dd5=a157_0x3a1413;var _0x6397de;const _0x1617e1=await this[_0x872dd5(0x111)][_0x872dd5(0x107)]({'email':_0x4dbf22[_0x872dd5(0x10a)]});if(_0x1617e1)throw new Error(_0x872dd5(0xf6));const _0x224de3=(await this[_0x872dd5(0x111)][_0x872dd5(0x11c)]({}))[_0x872dd5(0xf8)],_0x2f7c00=((_0x6397de=(await this['settingService'][_0x872dd5(0xeb)]())['userSetting'])===null||_0x6397de===void 0x0?void 0x0:_0x6397de[_0x872dd5(0xf9)])||constants_1[_0x872dd5(0xf7)];if(_0x224de3>_0x2f7c00)throw new Error('Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20'+_0x2f7c00);const _0xb6774e=await this[_0x872dd5(0x111)][_0x872dd5(0x116)](_0x4dbf22);return _0xb6774e['password']=await(0x0,verify_1[_0x872dd5(0x110)])(_0xb6774e[_0x872dd5(0x10f)]),_0xb6774e[_0x872dd5(0xe0)]();}async[a157_0x3a1413(0xea)](_0x17d589){const _0x19bfa2=a157_0x3a1413,_0x290061=await this[_0x19bfa2(0x111)]['findOne']({'username':_0x17d589});return _0x290061;}async[a157_0x3a1413(0x100)](){const _0xa05cce=a157_0x3a1413,_0x4935ae=await this[_0xa05cce(0x111)][_0xa05cce(0x11c)]({'roles':{'$ne':role_enum_1[_0xa05cce(0x105)][_0xa05cce(0xde)]}})[_0xa05cce(0xdf)](_0xa05cce(0x106));return _0x4935ae[_0xa05cce(0x10c)](_0x3d76b4=>({'email':_0x3d76b4[_0xa05cce(0x10a)],'roles':_0x3d76b4['roles'],'username':_0x3d76b4[_0xa05cce(0xed)],'id':_0x3d76b4['id']}));}async['updateUser'](_0x388941,_0x2163a4){const _0xf26264=a157_0x3a1413;try{return await this[_0xf26264(0x111)]['findByIdAndUpdate'](_0x388941,_0x2163a4)[_0xf26264(0xdf)](_0xf26264(0x106));}catch(_0x3fe598){this[_0xf26264(0x114)]['error'](_0x3fe598);return;}}async[a157_0x3a1413(0xf0)](_0x19fbc8){const _0xe7b446=a157_0x3a1413,_0x1cf631=await this[_0xe7b446(0x111)][_0xe7b446(0x11a)](_0x19fbc8)[_0xe7b446(0xdf)]('-password');if(!_0x1cf631)return;return await _0x1cf631[_0xe7b446(0xe9)]();}async[a157_0x3a1413(0xfa)](_0xd17492){const _0x9102c5=a157_0x3a1413;try{const _0x4ad232=await this[_0x9102c5(0x111)]['findById'](_0xd17492)[_0x9102c5(0xdf)](_0x9102c5(0x106));if(!_0x4ad232)return;return _0x4ad232[_0x9102c5(0x10f)]=await(0x0,verify_1['hash'])(process['env']['DEFAULT_PASSWORD']),_0x4ad232[_0x9102c5(0xe0)]();}catch(_0xaa0622){this[_0x9102c5(0x114)][_0x9102c5(0xf1)](_0xaa0622);}}async[a157_0x3a1413(0xe2)](){const _0x231635=a157_0x3a1413;try{const _0x2cb988=await this[_0x231635(0x111)]['findOne']({'username':exports[_0x231635(0xfe)]});_0x2cb988&&await _0x2cb988[_0x231635(0xfb)](),await this[_0x231635(0xe8)]({'username':exports[_0x231635(0xfe)],'email':_0x231635(0x10e),'roles':[role_enum_1[_0x231635(0x105)]['Master']],'password':process[_0x231635(0xef)][_0x231635(0x108)]});}catch(_0x3b334b){this[_0x231635(0x114)][_0x231635(0xf1)](_0x3b334b);throw _0x3b334b;}}async['getMasterUserAccessToken'](){const _0x5af849=a157_0x3a1413,_0xffd627=await this[_0x5af849(0x111)][_0x5af849(0x107)]({'username':exports[_0x5af849(0xfe)]}),_0x222399=await this[_0x5af849(0x10d)][_0x5af849(0xe1)](_0xffd627[_0x5af849(0xff)](),{'secret':process[_0x5af849(0xef)]['JWT_SECRET']});return _0x222399;}};UserService=UserService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_2[a157_0x3a1413(0xe7)])('User')),__metadata(a157_0x3a1413(0x118),[mongoose_1[a157_0x3a1413(0xdb)],jwt_1[a157_0x3a1413(0x117)],setting_service_1[a157_0x3a1413(0xe5)]])],UserService),exports[a157_0x3a1413(0x104)]=UserService;