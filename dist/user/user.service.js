'use strict';function a157_0x46aa(_0x4dfdde,_0x9e05a9){const _0x12a7e2=a157_0x12a7();return a157_0x46aa=function(_0x46aa22,_0x872de6){_0x46aa22=_0x46aa22-0x1c8;let _0x59e8c3=_0x12a7e2[_0x46aa22];return _0x59e8c3;},a157_0x46aa(_0x4dfdde,_0x9e05a9);}const a157_0x174daf=a157_0x46aa;(function(_0x306622,_0x25b8c3){const _0x47b998=a157_0x46aa,_0x2a1c6c=_0x306622();while(!![]){try{const _0x24d69d=-parseInt(_0x47b998(0x1ce))/0x1*(parseInt(_0x47b998(0x1e7))/0x2)+parseInt(_0x47b998(0x1cd))/0x3+parseInt(_0x47b998(0x1ca))/0x4*(parseInt(_0x47b998(0x1df))/0x5)+-parseInt(_0x47b998(0x1ef))/0x6+parseInt(_0x47b998(0x1f8))/0x7*(-parseInt(_0x47b998(0x1fc))/0x8)+-parseInt(_0x47b998(0x201))/0x9+-parseInt(_0x47b998(0x1fb))/0xa*(-parseInt(_0x47b998(0x1cc))/0xb);if(_0x24d69d===_0x25b8c3)break;else _0x2a1c6c['push'](_0x2a1c6c['shift']());}catch(_0x563680){_0x2a1c6c['push'](_0x2a1c6c['shift']());}}}(a157_0x12a7,0x41876));function a157_0x12a7(){const _0x505a55=['DEFAULT_PASSWORD','findFirst','metadata','4263kKMXEB','@nestjs/mongoose','onModuleInit','18260nqhAiF','808iJxnxS','@nestjs/common','mongoose','jwtService','DEFAULT_MAX_USER','385965GzwSio','JWT_SECRET','addUser','Injectable','design:paramtypes','object','hash','__param','findById','../auth/enums/role.enum','email','UserService','Email\x20is\x20exist','Logger','8VWKjLZ','select','4378jJdWUk','347832wsqWlb','70341IlplWu','logger','findOne','deleteOne','MASTER_PASSWORD','create','username','function','toObject','getAllUser','InjectModel','sign','length','save','User','-password','JwtService','948295goBhSy','Model','map','MasterUserUsername','Role','decorate','userModel','absolutePA123','14FpyBgC','env','defineProperty','absolutePA123@gmail.com','Master','updateUser','__decorate','name','2140938eAZVLC','settingService','error','delete','password','find'];a157_0x12a7=function(){return _0x505a55;};return a157_0x12a7();}var __decorate=this&&this[a157_0x174daf(0x1ed)]||function(_0x1e52aa,_0x5c56f8,_0x20be40,_0x4352db){const _0x261060=a157_0x174daf;var _0x2ba550=arguments[_0x261060(0x1da)],_0x3f6efe=_0x2ba550<0x3?_0x5c56f8:_0x4352db===null?_0x4352db=Object['getOwnPropertyDescriptor'](_0x5c56f8,_0x20be40):_0x4352db,_0x18764b;if(typeof Reflect===_0x261060(0x206)&&typeof Reflect[_0x261060(0x1e4)]===_0x261060(0x1d5))_0x3f6efe=Reflect[_0x261060(0x1e4)](_0x1e52aa,_0x5c56f8,_0x20be40,_0x4352db);else{for(var _0xe06ee8=_0x1e52aa[_0x261060(0x1da)]-0x1;_0xe06ee8>=0x0;_0xe06ee8--)if(_0x18764b=_0x1e52aa[_0xe06ee8])_0x3f6efe=(_0x2ba550<0x3?_0x18764b(_0x3f6efe):_0x2ba550>0x3?_0x18764b(_0x5c56f8,_0x20be40,_0x3f6efe):_0x18764b(_0x5c56f8,_0x20be40))||_0x3f6efe;}return _0x2ba550>0x3&&_0x3f6efe&&Object[_0x261060(0x1e9)](_0x5c56f8,_0x20be40,_0x3f6efe),_0x3f6efe;},__metadata=this&&this['__metadata']||function(_0x304d62,_0x52fba6){const _0x348478=a157_0x174daf;if(typeof Reflect===_0x348478(0x206)&&typeof Reflect[_0x348478(0x1f7)]===_0x348478(0x1d5))return Reflect[_0x348478(0x1f7)](_0x304d62,_0x52fba6);},__param=this&&this[a157_0x174daf(0x208)]||function(_0xf898ab,_0x533077){return function(_0x7a5292,_0x2e0927){_0x533077(_0x7a5292,_0x2e0927,_0xf898ab);};},UserService_1;Object[a157_0x174daf(0x1e9)](exports,'__esModule',{'value':!![]}),exports['UserService']=exports[a157_0x174daf(0x1e2)]=void 0x0;const common_1=require(a157_0x174daf(0x1fd)),mongoose_1=require(a157_0x174daf(0x1fe)),mongoose_2=require(a157_0x174daf(0x1f9)),role_enum_1=require(a157_0x174daf(0x20a)),jwt_1=require('@nestjs/jwt'),verify_1=require('../auth/verify'),setting_service_1=require('../setting/setting.service'),constants_1=require('../setting/constants');exports['MasterUserUsername']=a157_0x174daf(0x1e6);let UserService=UserService_1=class UserService{constructor(_0xa27376,_0x3cca6e,_0x54cac2){const _0x4a0179=a157_0x174daf;this[_0x4a0179(0x1e5)]=_0xa27376,this[_0x4a0179(0x1ff)]=_0x3cca6e,this[_0x4a0179(0x1f0)]=_0x54cac2,this[_0x4a0179(0x1cf)]=new common_1[(_0x4a0179(0x1c9))](UserService_1[_0x4a0179(0x1ee)]);}async[a157_0x174daf(0x203)](_0x5b4a10){const _0x251097=a157_0x174daf;var _0x37abf1;const _0x39be27=await this['userModel'][_0x251097(0x1d0)]({'email':_0x5b4a10['email']});if(_0x39be27)throw new Error(_0x251097(0x1c8));const _0x461bad=(await this['userModel'][_0x251097(0x1f4)]({}))[_0x251097(0x1da)],_0x5b5e58=((_0x37abf1=(await this[_0x251097(0x1f0)][_0x251097(0x1f6)]())['userSetting'])===null||_0x37abf1===void 0x0?void 0x0:_0x37abf1['maxUser'])||constants_1[_0x251097(0x200)];if(_0x461bad>_0x5b5e58)throw new Error('Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20'+_0x5b5e58);const _0x48da52=await this[_0x251097(0x1e5)][_0x251097(0x1d3)](_0x5b4a10);return _0x48da52['password']=await(0x0,verify_1[_0x251097(0x207)])(_0x48da52[_0x251097(0x1f3)]),_0x48da52[_0x251097(0x1db)]();}async['findUser'](_0x400a56){const _0x74060a=a157_0x174daf,_0x2bc7bd=await this[_0x74060a(0x1e5)][_0x74060a(0x1d0)]({'username':_0x400a56});return _0x2bc7bd;}async[a157_0x174daf(0x1d7)](){const _0x1b16de=a157_0x174daf,_0x4573f4=await this[_0x1b16de(0x1e5)]['find']({'roles':{'$ne':role_enum_1[_0x1b16de(0x1e3)]['Master']}})['select'](_0x1b16de(0x1dd));return _0x4573f4[_0x1b16de(0x1e1)](_0x248c6d=>({'email':_0x248c6d[_0x1b16de(0x20b)],'roles':_0x248c6d['roles'],'username':_0x248c6d[_0x1b16de(0x1d4)],'id':_0x248c6d['id']}));}async[a157_0x174daf(0x1ec)](_0x1029e4,_0x48b61c){const _0x1bef8e=a157_0x174daf;try{return await this['userModel']['findByIdAndUpdate'](_0x1029e4,_0x48b61c)['select'](_0x1bef8e(0x1dd));}catch(_0x3982f9){this[_0x1bef8e(0x1cf)]['error'](_0x3982f9);return;}}async['deleteUser'](_0x3d7179){const _0x9a7b3e=a157_0x174daf,_0x103db7=await this[_0x9a7b3e(0x1e5)][_0x9a7b3e(0x209)](_0x3d7179)['select'](_0x9a7b3e(0x1dd));if(!_0x103db7)return;return await _0x103db7[_0x9a7b3e(0x1d1)]();}async['resetPassword'](_0x345737){const _0x4d9a22=a157_0x174daf;try{const _0x5e33d4=await this['userModel'][_0x4d9a22(0x209)](_0x345737)[_0x4d9a22(0x1cb)](_0x4d9a22(0x1dd));if(!_0x5e33d4)return;return _0x5e33d4['password']=await(0x0,verify_1['hash'])(process[_0x4d9a22(0x1e8)][_0x4d9a22(0x1f5)]),_0x5e33d4[_0x4d9a22(0x1db)]();}catch(_0x1bb1cd){this['logger'][_0x4d9a22(0x1f1)](_0x1bb1cd);}}async[a157_0x174daf(0x1fa)](){const _0x28f587=a157_0x174daf;try{const _0x5575eb=await this[_0x28f587(0x1e5)]['findOne']({'username':exports[_0x28f587(0x1e2)]});_0x5575eb&&await _0x5575eb[_0x28f587(0x1f2)](),await this[_0x28f587(0x203)]({'username':exports['MasterUserUsername'],'email':_0x28f587(0x1ea),'roles':[role_enum_1['Role'][_0x28f587(0x1eb)]],'password':process['env'][_0x28f587(0x1d2)]});}catch(_0x150cf8){this[_0x28f587(0x1cf)][_0x28f587(0x1f1)](_0x150cf8);throw _0x150cf8;}}async['getMasterUserAccessToken'](){const _0x3a0e13=a157_0x174daf,_0x1f9c54=await this[_0x3a0e13(0x1e5)][_0x3a0e13(0x1d0)]({'username':exports[_0x3a0e13(0x1e2)]}),_0x3f7a7e=await this['jwtService'][_0x3a0e13(0x1d9)](_0x1f9c54[_0x3a0e13(0x1d6)](),{'secret':process[_0x3a0e13(0x1e8)][_0x3a0e13(0x202)]});return _0x3f7a7e;}};UserService=UserService_1=__decorate([(0x0,common_1[a157_0x174daf(0x204)])(),__param(0x0,(0x0,mongoose_2[a157_0x174daf(0x1d8)])(a157_0x174daf(0x1dc))),__metadata(a157_0x174daf(0x205),[mongoose_1[a157_0x174daf(0x1e0)],jwt_1[a157_0x174daf(0x1de)],setting_service_1['SettingService']])],UserService),exports[a157_0x174daf(0x20c)]=UserService;