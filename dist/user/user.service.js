'use strict';function a157_0x3dd6(_0x20a761,_0x2a03ff){const _0x2fa0a5=a157_0x2fa0();return a157_0x3dd6=function(_0x3dd6d5,_0x1a3e40){_0x3dd6d5=_0x3dd6d5-0x82;let _0x371816=_0x2fa0a5[_0x3dd6d5];return _0x371816;},a157_0x3dd6(_0x20a761,_0x2a03ff);}const a157_0xd846a7=a157_0x3dd6;(function(_0x1a5107,_0x164c08){const _0x14e47c=a157_0x3dd6,_0x1e88b7=_0x1a5107();while(!![]){try{const _0xd7fe22=parseInt(_0x14e47c(0x96))/0x1*(-parseInt(_0x14e47c(0x82))/0x2)+-parseInt(_0x14e47c(0x95))/0x3+parseInt(_0x14e47c(0xad))/0x4*(-parseInt(_0x14e47c(0x9a))/0x5)+-parseInt(_0x14e47c(0x8a))/0x6*(parseInt(_0x14e47c(0x94))/0x7)+parseInt(_0x14e47c(0xb3))/0x8+parseInt(_0x14e47c(0xa0))/0x9+parseInt(_0x14e47c(0x88))/0xa;if(_0xd7fe22===_0x164c08)break;else _0x1e88b7['push'](_0x1e88b7['shift']());}catch(_0x5d80b6){_0x1e88b7['push'](_0x1e88b7['shift']());}}}(a157_0x2fa0,0x39d6c));var __decorate=this&&this[a157_0xd846a7(0xb1)]||function(_0x3c90fa,_0x475029,_0x29a957,_0x51c986){const _0x1436ca=a157_0xd846a7;var _0x4ccb7d=arguments['length'],_0x2ed9cd=_0x4ccb7d<0x3?_0x475029:_0x51c986===null?_0x51c986=Object[_0x1436ca(0x8b)](_0x475029,_0x29a957):_0x51c986,_0x37e165;if(typeof Reflect==='object'&&typeof Reflect[_0x1436ca(0x9c)]===_0x1436ca(0xa2))_0x2ed9cd=Reflect[_0x1436ca(0x9c)](_0x3c90fa,_0x475029,_0x29a957,_0x51c986);else{for(var _0x553502=_0x3c90fa[_0x1436ca(0xa4)]-0x1;_0x553502>=0x0;_0x553502--)if(_0x37e165=_0x3c90fa[_0x553502])_0x2ed9cd=(_0x4ccb7d<0x3?_0x37e165(_0x2ed9cd):_0x4ccb7d>0x3?_0x37e165(_0x475029,_0x29a957,_0x2ed9cd):_0x37e165(_0x475029,_0x29a957))||_0x2ed9cd;}return _0x4ccb7d>0x3&&_0x2ed9cd&&Object['defineProperty'](_0x475029,_0x29a957,_0x2ed9cd),_0x2ed9cd;},__metadata=this&&this[a157_0xd846a7(0xa3)]||function(_0x49ac6f,_0x3419fe){const _0x168f4b=a157_0xd846a7;if(typeof Reflect==='object'&&typeof Reflect[_0x168f4b(0xa5)]===_0x168f4b(0xa2))return Reflect[_0x168f4b(0xa5)](_0x49ac6f,_0x3419fe);},__param=this&&this[a157_0xd846a7(0xc4)]||function(_0x342791,_0x12d622){return function(_0x311e63,_0x4a2f7b){_0x12d622(_0x311e63,_0x4a2f7b,_0x342791);};},UserService_1;Object[a157_0xd846a7(0xbe)](exports,'__esModule',{'value':!![]}),exports[a157_0xd846a7(0xc0)]=exports[a157_0xd846a7(0xba)]=void 0x0;const common_1=require(a157_0xd846a7(0xc7)),mongoose_1=require(a157_0xd846a7(0x91)),mongoose_2=require(a157_0xd846a7(0xbc)),role_enum_1=require(a157_0xd846a7(0xc6)),jwt_1=require(a157_0xd846a7(0x9f)),verify_1=require('../auth/verify'),setting_service_1=require('../setting/setting.service'),constants_1=require('../setting/constants');exports[a157_0xd846a7(0xba)]=a157_0xd846a7(0xb2);let UserService=UserService_1=class UserService{constructor(_0xbfa11a,_0x12ef18,_0x252a42){const _0x8710c4=a157_0xd846a7;this['userModel']=_0xbfa11a,this[_0x8710c4(0x92)]=_0x12ef18,this['settingService']=_0x252a42,this[_0x8710c4(0x8f)]=new common_1[(_0x8710c4(0x9d))](UserService_1[_0x8710c4(0x86)]);}async[a157_0xd846a7(0x8d)](_0x597567){const _0x5897e2=a157_0xd846a7;var _0x4fe336;const _0x51c1de=await this[_0x5897e2(0xb8)][_0x5897e2(0xc3)]({'email':_0x597567[_0x5897e2(0xc2)]});if(_0x51c1de)throw new Error(_0x5897e2(0xc5));const _0x288682=(await this[_0x5897e2(0xb8)][_0x5897e2(0x90)]({}))[_0x5897e2(0xa4)],_0x3e1e2a=((_0x4fe336=(await this[_0x5897e2(0xa9)][_0x5897e2(0x93)]())['userSetting'])===null||_0x4fe336===void 0x0?void 0x0:_0x4fe336[_0x5897e2(0xab)])||constants_1['DEFAULT_MAX_USER'];if(_0x288682>_0x3e1e2a)throw new Error(_0x5897e2(0x99)+_0x3e1e2a);const _0x29474e=await this[_0x5897e2(0xb8)][_0x5897e2(0x87)](_0x597567);return _0x29474e[_0x5897e2(0x8c)]=await(0x0,verify_1[_0x5897e2(0xbb)])(_0x29474e[_0x5897e2(0x8c)]),_0x29474e['save']();}async[a157_0xd846a7(0x9b)](_0x4d23c4){const _0x2a6838=a157_0xd846a7,_0x25a05e=await this[_0x2a6838(0xb8)]['findOne']({'username':_0x4d23c4});return _0x25a05e;}async[a157_0xd846a7(0x89)](){const _0x3475b0=a157_0xd846a7,_0x3ca1d6=await this['userModel'][_0x3475b0(0x90)]({'roles':{'$ne':role_enum_1[_0x3475b0(0xac)][_0x3475b0(0xc1)]}})[_0x3475b0(0xb7)](_0x3475b0(0xae));return _0x3ca1d6[_0x3475b0(0x83)](_0xd0152a=>({'email':_0xd0152a[_0x3475b0(0xc2)],'roles':_0xd0152a[_0x3475b0(0xb5)],'username':_0xd0152a['username'],'id':_0xd0152a['id']}));}async[a157_0xd846a7(0xb9)](_0x27b0d9,_0x28aa5a){const _0x484998=a157_0xd846a7;try{return await this[_0x484998(0xb8)]['findByIdAndUpdate'](_0x27b0d9,_0x28aa5a)[_0x484998(0xb7)](_0x484998(0xae));}catch(_0x11b663){this[_0x484998(0x8f)][_0x484998(0xbd)](_0x11b663);return;}}async[a157_0xd846a7(0xb6)](_0x3c6148){const _0x46bead=a157_0xd846a7,_0x5bcfa4=await this[_0x46bead(0xb8)][_0x46bead(0xa1)](_0x3c6148)[_0x46bead(0xb7)]('-password');if(!_0x5bcfa4)return;return await _0x5bcfa4['deleteOne']();}async['resetPassword'](_0x9e8d47){const _0x15d15f=a157_0xd846a7;try{const _0x458df2=await this[_0x15d15f(0xb8)][_0x15d15f(0xa1)](_0x9e8d47)[_0x15d15f(0xb7)](_0x15d15f(0xae));if(!_0x458df2)return;return _0x458df2['password']=await(0x0,verify_1['hash'])(process[_0x15d15f(0xaf)][_0x15d15f(0x84)]),_0x458df2[_0x15d15f(0xbf)]();}catch(_0x4c3e0c){this[_0x15d15f(0x8f)]['error'](_0x4c3e0c);}}async[a157_0xd846a7(0xaa)](){const _0x3d4628=a157_0xd846a7;try{const _0x579dc7=await this[_0x3d4628(0xb8)][_0x3d4628(0xc3)]({'username':exports['MasterUserUsername']});_0x579dc7&&await _0x579dc7[_0x3d4628(0x9e)](),await this[_0x3d4628(0x8d)]({'username':exports[_0x3d4628(0xba)],'email':_0x3d4628(0xb0),'roles':[role_enum_1[_0x3d4628(0xac)]['Master']],'password':process[_0x3d4628(0xaf)][_0x3d4628(0x85)]});}catch(_0x44acfd){this['logger'][_0x3d4628(0xbd)](_0x44acfd);throw _0x44acfd;}}async[a157_0xd846a7(0x8e)](){const _0x5e2017=a157_0xd846a7,_0x2898ba=await this[_0x5e2017(0xb8)][_0x5e2017(0xc3)]({'username':exports[_0x5e2017(0xba)]}),_0xb3813f=await this[_0x5e2017(0x92)][_0x5e2017(0xa8)](_0x2898ba['toObject'](),{'secret':process[_0x5e2017(0xaf)]['JWT_SECRET']});return _0xb3813f;}};UserService=UserService_1=__decorate([(0x0,common_1[a157_0xd846a7(0x98)])(),__param(0x0,(0x0,mongoose_2[a157_0xd846a7(0xa6)])(a157_0xd846a7(0xb4))),__metadata('design:paramtypes',[mongoose_1[a157_0xd846a7(0x97)],jwt_1['JwtService'],setting_service_1[a157_0xd846a7(0xa7)]])],UserService),exports[a157_0xd846a7(0xc0)]=UserService;function a157_0x2fa0(){const _0x46557b=['getMasterUserAccessToken','logger','find','mongoose','jwtService','findFirst','429541gVYAWD','839169BsCBoO','1847mByBON','Model','Injectable','Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20','5UEqwRz','findUser','decorate','Logger','delete','@nestjs/jwt','3390165FvnxxM','findById','function','__metadata','length','metadata','InjectModel','SettingService','sign','settingService','onModuleInit','maxUser','Role','18644LYFoUP','-password','env','absolutePA123@gmail.com','__decorate','absolutePA123','3068776MbJXHM','User','roles','deleteUser','select','userModel','updateUser','MasterUserUsername','hash','@nestjs/mongoose','error','defineProperty','save','UserService','Master','email','findOne','__param','Email\x20is\x20exist','../auth/enums/role.enum','@nestjs/common','274ITHEqo','map','DEFAULT_PASSWORD','MASTER_PASSWORD','name','create','754120tWcEZO','getAllUser','6rYsKko','getOwnPropertyDescriptor','password','addUser'];a157_0x2fa0=function(){return _0x46557b;};return a157_0x2fa0();}