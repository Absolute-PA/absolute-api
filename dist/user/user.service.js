'use strict';const a157_0x4429d6=a157_0x2a6f;function a157_0x2a6f(_0x22868a,_0x308a94){const _0x3b44ac=a157_0x3b44();return a157_0x2a6f=function(_0x2a6f33,_0xf565b4){_0x2a6f33=_0x2a6f33-0xa6;let _0x5486ed=_0x3b44ac[_0x2a6f33];return _0x5486ed;},a157_0x2a6f(_0x22868a,_0x308a94);}(function(_0x3d7dff,_0x88b0de){const _0x4080fa=a157_0x2a6f,_0x1b1eff=_0x3d7dff();while(!![]){try{const _0x4d2da7=parseInt(_0x4080fa(0xc5))/0x1*(-parseInt(_0x4080fa(0xe9))/0x2)+parseInt(_0x4080fa(0xb3))/0x3*(parseInt(_0x4080fa(0xf2))/0x4)+parseInt(_0x4080fa(0xd5))/0x5*(-parseInt(_0x4080fa(0xd9))/0x6)+parseInt(_0x4080fa(0xb5))/0x7+parseInt(_0x4080fa(0xbf))/0x8*(parseInt(_0x4080fa(0xaa))/0x9)+parseInt(_0x4080fa(0xbb))/0xa*(parseInt(_0x4080fa(0xef))/0xb)+-parseInt(_0x4080fa(0xb9))/0xc*(-parseInt(_0x4080fa(0xdd))/0xd);if(_0x4d2da7===_0x88b0de)break;else _0x1b1eff['push'](_0x1b1eff['shift']());}catch(_0x19202c){_0x1b1eff['push'](_0x1b1eff['shift']());}}}(a157_0x3b44,0x2145c));var __decorate=this&&this['__decorate']||function(_0x47b0a7,_0x4f13c9,_0x18b49a,_0x6468ca){const _0x2eb264=a157_0x2a6f;var _0x523169=arguments['length'],_0x34f721=_0x523169<0x3?_0x4f13c9:_0x6468ca===null?_0x6468ca=Object[_0x2eb264(0xaf)](_0x4f13c9,_0x18b49a):_0x6468ca,_0x2b4850;if(typeof Reflect==='object'&&typeof Reflect[_0x2eb264(0xeb)]===_0x2eb264(0xd4))_0x34f721=Reflect['decorate'](_0x47b0a7,_0x4f13c9,_0x18b49a,_0x6468ca);else{for(var _0xb9d32e=_0x47b0a7[_0x2eb264(0xf0)]-0x1;_0xb9d32e>=0x0;_0xb9d32e--)if(_0x2b4850=_0x47b0a7[_0xb9d32e])_0x34f721=(_0x523169<0x3?_0x2b4850(_0x34f721):_0x523169>0x3?_0x2b4850(_0x4f13c9,_0x18b49a,_0x34f721):_0x2b4850(_0x4f13c9,_0x18b49a))||_0x34f721;}return _0x523169>0x3&&_0x34f721&&Object['defineProperty'](_0x4f13c9,_0x18b49a,_0x34f721),_0x34f721;},__metadata=this&&this['__metadata']||function(_0x150155,_0x293ca4){const _0xe47d27=a157_0x2a6f;if(typeof Reflect==='object'&&typeof Reflect[_0xe47d27(0xed)]==='function')return Reflect[_0xe47d27(0xed)](_0x150155,_0x293ca4);},__param=this&&this[a157_0x4429d6(0xdc)]||function(_0x1dca1c,_0x533d03){return function(_0x2b43f6,_0x1d7fa0){_0x533d03(_0x2b43f6,_0x1d7fa0,_0x1dca1c);};},UserService_1;Object[a157_0x4429d6(0xc2)](exports,'__esModule',{'value':!![]}),exports[a157_0x4429d6(0xbe)]=exports['MasterUserUsername']=void 0x0;const common_1=require(a157_0x4429d6(0xde)),mongoose_1=require(a157_0x4429d6(0xe3)),mongoose_2=require(a157_0x4429d6(0xf1)),role_enum_1=require(a157_0x4429d6(0xc4)),jwt_1=require(a157_0x4429d6(0xad)),verify_1=require(a157_0x4429d6(0xd7)),setting_service_1=require('../setting/setting.service'),constants_1=require(a157_0x4429d6(0xb1));exports[a157_0x4429d6(0xb7)]=a157_0x4429d6(0xe4);let UserService=UserService_1=class UserService{constructor(_0x54dd6c,_0x574892,_0x52cfd1){const _0x15c187=a157_0x4429d6;this[_0x15c187(0xa8)]=_0x54dd6c,this[_0x15c187(0xd0)]=_0x574892,this[_0x15c187(0xc0)]=_0x52cfd1,this[_0x15c187(0xe2)]=new common_1['Logger'](UserService_1[_0x15c187(0xdb)]);}async['addUser'](_0x1257d5){const _0x19530b=a157_0x4429d6;var _0x58c543;const _0x2b5c8f=await this['userModel'][_0x19530b(0xc7)]({'email':_0x1257d5[_0x19530b(0xee)]});if(_0x2b5c8f)throw new Error('Email\x20is\x20exist');const _0x3f1688=(await this[_0x19530b(0xa8)][_0x19530b(0xcb)]({}))[_0x19530b(0xf0)],_0x68a418=((_0x58c543=(await this['settingService'][_0x19530b(0xcd)]())[_0x19530b(0xce)])===null||_0x58c543===void 0x0?void 0x0:_0x58c543['maxUser'])||constants_1[_0x19530b(0xb8)];if(_0x3f1688>_0x68a418)throw new Error(_0x19530b(0xcc)+_0x68a418);const _0x41b8fd=await this[_0x19530b(0xa8)][_0x19530b(0xd3)](_0x1257d5);return _0x41b8fd[_0x19530b(0xe8)]=await(0x0,verify_1['hash'])(_0x41b8fd[_0x19530b(0xe8)]),_0x41b8fd['save']();}async[a157_0x4429d6(0xd2)](_0x54b93c){const _0x4e3c8b=a157_0x4429d6,_0x120120=await this[_0x4e3c8b(0xa8)][_0x4e3c8b(0xc7)]({'username':_0x54b93c});return _0x120120;}async['getAllUser'](){const _0x341361=a157_0x4429d6,_0x3471a9=await this[_0x341361(0xa8)]['find']({'roles':{'$ne':role_enum_1[_0x341361(0xb6)][_0x341361(0xe0)]}})[_0x341361(0xc1)](_0x341361(0xe5));return _0x3471a9[_0x341361(0xd8)](_0x1b184a=>({'email':_0x1b184a['email'],'roles':_0x1b184a[_0x341361(0xe6)],'username':_0x1b184a[_0x341361(0xec)],'id':_0x1b184a['id']}));}async[a157_0x4429d6(0xe1)](_0x3a8357,_0x2a155a){const _0x10670d=a157_0x4429d6;try{return await this[_0x10670d(0xa8)][_0x10670d(0xca)](_0x3a8357,_0x2a155a)['select'](_0x10670d(0xe5));}catch(_0x571ec8){this[_0x10670d(0xe2)][_0x10670d(0xa6)](_0x571ec8);return;}}async[a157_0x4429d6(0xb2)](_0x1de8cb){const _0x45a505=a157_0x4429d6,_0x1d74ab=await this['userModel'][_0x45a505(0xb0)](_0x1de8cb)[_0x45a505(0xc1)](_0x45a505(0xe5));if(!_0x1d74ab)return;return await _0x1d74ab[_0x45a505(0xd6)]();}async[a157_0x4429d6(0xc8)](_0x7a9216){const _0x4494be=a157_0x4429d6;try{const _0xfab4fd=await this[_0x4494be(0xa8)][_0x4494be(0xb0)](_0x7a9216)['select'](_0x4494be(0xe5));if(!_0xfab4fd)return;return _0xfab4fd[_0x4494be(0xe8)]=await(0x0,verify_1[_0x4494be(0xea)])(process[_0x4494be(0xb4)][_0x4494be(0xc9)]),_0xfab4fd[_0x4494be(0xe7)]();}catch(_0x1f55c2){this[_0x4494be(0xe2)][_0x4494be(0xa6)](_0x1f55c2);}}async[a157_0x4429d6(0xcf)](){const _0x4c3aaf=a157_0x4429d6;try{const _0x42eb1c=await this[_0x4c3aaf(0xa8)][_0x4c3aaf(0xc7)]({'username':exports[_0x4c3aaf(0xb7)]});_0x42eb1c&&await _0x42eb1c[_0x4c3aaf(0xa9)](),await this[_0x4c3aaf(0xae)]({'username':exports['MasterUserUsername'],'email':_0x4c3aaf(0xdf),'roles':[role_enum_1[_0x4c3aaf(0xb6)][_0x4c3aaf(0xe0)]],'password':process[_0x4c3aaf(0xb4)][_0x4c3aaf(0xbc)]});}catch(_0x5e7549){this['logger'][_0x4c3aaf(0xa6)](_0x5e7549);throw _0x5e7549;}}async[a157_0x4429d6(0xba)](){const _0x1f7de5=a157_0x4429d6,_0x1bc821=await this['userModel'][_0x1f7de5(0xc7)]({'username':exports[_0x1f7de5(0xb7)]}),_0x5b5cec=await this[_0x1f7de5(0xd0)][_0x1f7de5(0xc3)](_0x1bc821[_0x1f7de5(0xc6)](),{'secret':process[_0x1f7de5(0xb4)][_0x1f7de5(0xd1)]});return _0x5b5cec;}};function a157_0x3b44(){const _0x2b7896=['MASTER_PASSWORD','design:paramtypes','UserService','24CWIeaA','settingService','select','defineProperty','sign','../auth/enums/role.enum','607wgMBAo','toObject','findOne','resetPassword','DEFAULT_PASSWORD','findByIdAndUpdate','find','Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20','findFirst','userSetting','onModuleInit','jwtService','JWT_SECRET','findUser','create','function','40970OyvKII','deleteOne','../auth/verify','map','6mpIFwc','JwtService','name','__param','396253xyEugJ','@nestjs/common','absolutePA123@gmail.com','Master','updateUser','logger','mongoose','absolutePA123','-password','roles','save','password','444VnEoAb','hash','decorate','username','metadata','email','121ZNhVmt','length','@nestjs/mongoose','92kGoIyd','error','Model','userModel','delete','20745sOowJK','User','InjectModel','@nestjs/jwt','addUser','getOwnPropertyDescriptor','findById','../setting/constants','deleteUser','18510vBECel','env','272594QQVhGh','Role','MasterUserUsername','DEFAULT_MAX_USER','36GngSRB','getMasterUserAccessToken','20seKexc'];a157_0x3b44=function(){return _0x2b7896;};return a157_0x3b44();}UserService=UserService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_2[a157_0x4429d6(0xac)])(a157_0x4429d6(0xab))),__metadata(a157_0x4429d6(0xbd),[mongoose_1[a157_0x4429d6(0xa7)],jwt_1[a157_0x4429d6(0xda)],setting_service_1['SettingService']])],UserService),exports[a157_0x4429d6(0xbe)]=UserService;