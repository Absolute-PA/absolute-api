'use strict';const a157_0x44fba6=a157_0x12d3;(function(_0x10e300,_0x877bf8){const _0x3205c1=a157_0x12d3,_0x2fa675=_0x10e300();while(!![]){try{const _0x3d3cbe=-parseInt(_0x3205c1(0xf0))/0x1+-parseInt(_0x3205c1(0xe4))/0x2+parseInt(_0x3205c1(0x104))/0x3*(-parseInt(_0x3205c1(0xfe))/0x4)+-parseInt(_0x3205c1(0xe6))/0x5*(-parseInt(_0x3205c1(0xc5))/0x6)+parseInt(_0x3205c1(0xed))/0x7*(parseInt(_0x3205c1(0xf8))/0x8)+parseInt(_0x3205c1(0xf6))/0x9*(parseInt(_0x3205c1(0xdf))/0xa)+-parseInt(_0x3205c1(0xef))/0xb*(-parseInt(_0x3205c1(0xc9))/0xc);if(_0x3d3cbe===_0x877bf8)break;else _0x2fa675['push'](_0x2fa675['shift']());}catch(_0x2ce64f){_0x2fa675['push'](_0x2fa675['shift']());}}}(a157_0x22fb,0x2fbda));function a157_0x22fb(){const _0x2f0047=['DEFAULT_MAX_USER','findByIdAndUpdate','admin@absolutepa','findById','findFirst','JwtService','hash','maxUser','Model','__esModule','deleteUser','MasterUserUsername','onModuleInit','decorate','1090630EgckSL','Master','env','email','password','325420vQdUyL','-password','20ESybMl','__metadata','create','delete','findOne','save','InjectModel','126hiXdlZ','jwtService','1353vVpfwi','231674oVTsxq','findUser','resetPassword','@nestjs/jwt','length','Admin','18uDYLFq','SettingService','47448RFLKYg','DefaultAdminUsername','username','absolutePA123','logger','Logger','72tMAAku','updateUser','DefaultAdminPassword','../setting/constants','roles','JWT_SECRET','3186xdKFnd','absolutePA123@gmail.com','../auth/verify','function','metadata','Role','error','__param','UserService','defineProperty','@nestjs/mongoose','__decorate','Injectable','@nestjs/common','settingService','68682NJpzDc','addUser','Email\x20is\x20exist','DEFAULT_PASSWORD','23256PFFanf','object','deleteOne','User','userModel','forgotpassword','name','select'];a157_0x22fb=function(){return _0x2f0047;};return a157_0x22fb();}function a157_0x12d3(_0x29af94,_0x5bfd36){const _0x22fbea=a157_0x22fb();return a157_0x12d3=function(_0x12d354,_0x66a947){_0x12d354=_0x12d354-0xbe;let _0x453f27=_0x22fbea[_0x12d354];return _0x453f27;},a157_0x12d3(_0x29af94,_0x5bfd36);}var __decorate=this&&this[a157_0x44fba6(0xc1)]||function(_0x5ddab3,_0x38734a,_0x52a38c,_0x4b0f76){const _0x13255a=a157_0x44fba6;var _0x4a78c3=arguments[_0x13255a(0xf4)],_0x149fe1=_0x4a78c3<0x3?_0x38734a:_0x4b0f76===null?_0x4b0f76=Object['getOwnPropertyDescriptor'](_0x38734a,_0x52a38c):_0x4b0f76,_0xbb0de3;if(typeof Reflect===_0x13255a(0xca)&&typeof Reflect[_0x13255a(0xde)]==='function')_0x149fe1=Reflect[_0x13255a(0xde)](_0x5ddab3,_0x38734a,_0x52a38c,_0x4b0f76);else{for(var _0x21fd40=_0x5ddab3['length']-0x1;_0x21fd40>=0x0;_0x21fd40--)if(_0xbb0de3=_0x5ddab3[_0x21fd40])_0x149fe1=(_0x4a78c3<0x3?_0xbb0de3(_0x149fe1):_0x4a78c3>0x3?_0xbb0de3(_0x38734a,_0x52a38c,_0x149fe1):_0xbb0de3(_0x38734a,_0x52a38c))||_0x149fe1;}return _0x4a78c3>0x3&&_0x149fe1&&Object[_0x13255a(0xbf)](_0x38734a,_0x52a38c,_0x149fe1),_0x149fe1;},__metadata=this&&this[a157_0x44fba6(0xe7)]||function(_0x4cb250,_0x2028bf){const _0x137541=a157_0x44fba6;if(typeof Reflect===_0x137541(0xca)&&typeof Reflect[_0x137541(0x108)]===_0x137541(0x107))return Reflect[_0x137541(0x108)](_0x4cb250,_0x2028bf);},__param=this&&this[a157_0x44fba6(0x10b)]||function(_0x280e22,_0x2cf08a){return function(_0x966b75,_0x55bef9){_0x2cf08a(_0x966b75,_0x55bef9,_0x280e22);};},UserService_1;Object['defineProperty'](exports,a157_0x44fba6(0xda),{'value':!![]}),exports[a157_0x44fba6(0xbe)]=exports[a157_0x44fba6(0x100)]=exports[a157_0x44fba6(0xf9)]=exports[a157_0x44fba6(0xdc)]=void 0x0;const common_1=require(a157_0x44fba6(0xc3)),mongoose_1=require('mongoose'),mongoose_2=require(a157_0x44fba6(0xc0)),role_enum_1=require('../auth/enums/role.enum'),jwt_1=require(a157_0x44fba6(0xf3)),verify_1=require(a157_0x44fba6(0x106)),setting_service_1=require('../setting/setting.service'),constants_1=require(a157_0x44fba6(0x101));exports[a157_0x44fba6(0xdc)]=a157_0x44fba6(0xfb),exports['DefaultAdminUsername']='admin',exports[a157_0x44fba6(0x100)]=a157_0x44fba6(0xce);let UserService=UserService_1=class UserService{constructor(_0x27f033,_0xe35489,_0x535f29){const _0x8658e4=a157_0x44fba6;this[_0x8658e4(0xcd)]=_0x27f033,this['jwtService']=_0xe35489,this['settingService']=_0x535f29,this[_0x8658e4(0xfc)]=new common_1[(_0x8658e4(0xfd))](UserService_1[_0x8658e4(0xcf)]);}async['addUser'](_0xb7b98d){const _0x19f38b=a157_0x44fba6;var _0x307cbe;const _0x3b4c9e=await this['userModel'][_0x19f38b(0xea)]({'email':_0xb7b98d[_0x19f38b(0xe2)]});if(_0x3b4c9e)throw new Error(_0x19f38b(0xc7));const _0x597121=(await this[_0x19f38b(0xcd)]['find']({}))['length'],_0xfbd9ad=((_0x307cbe=(await this[_0x19f38b(0xc4)][_0x19f38b(0xd5)]())['userSetting'])===null||_0x307cbe===void 0x0?void 0x0:_0x307cbe[_0x19f38b(0xd8)])||constants_1[_0x19f38b(0xd1)];if(_0x597121>_0xfbd9ad)throw new Error('Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20'+_0xfbd9ad);const _0x1c259b=await this[_0x19f38b(0xcd)][_0x19f38b(0xe8)](_0xb7b98d);return _0x1c259b[_0x19f38b(0xe3)]=await(0x0,verify_1['hash'])(_0x1c259b[_0x19f38b(0xe3)]),_0x1c259b[_0x19f38b(0xeb)]();}async[a157_0x44fba6(0xf1)](_0x1b18c0){const _0x312d51=a157_0x44fba6,_0x4147bd=await this[_0x312d51(0xcd)]['findOne']({'username':_0x1b18c0});return _0x4147bd;}async['getAllUser'](){const _0x5d7b91=a157_0x44fba6,_0x4e0568=await this[_0x5d7b91(0xcd)]['find']({'roles':{'$ne':role_enum_1[_0x5d7b91(0x109)][_0x5d7b91(0xe0)]}})[_0x5d7b91(0xd0)](_0x5d7b91(0xe5));return _0x4e0568['map'](_0x39214a=>({'email':_0x39214a['email'],'roles':_0x39214a[_0x5d7b91(0x102)],'username':_0x39214a[_0x5d7b91(0xfa)],'id':_0x39214a['id']}));}async[a157_0x44fba6(0xff)](_0x2d47c0,_0x236668){const _0x1f7b51=a157_0x44fba6;try{return await this[_0x1f7b51(0xcd)][_0x1f7b51(0xd2)](_0x2d47c0,_0x236668)[_0x1f7b51(0xd0)](_0x1f7b51(0xe5));}catch(_0x422988){this['logger'][_0x1f7b51(0x10a)](_0x422988);return;}}async[a157_0x44fba6(0xdb)](_0x580255){const _0x256a0e=a157_0x44fba6,_0xc40299=await this[_0x256a0e(0xcd)][_0x256a0e(0xd4)](_0x580255)['select']('-password');if(!_0xc40299)return;return await _0xc40299[_0x256a0e(0xcb)]();}async[a157_0x44fba6(0xf2)](_0x152e3e){const _0x1ed042=a157_0x44fba6;try{const _0x58cdd7=await this[_0x1ed042(0xcd)][_0x1ed042(0xd4)](_0x152e3e)[_0x1ed042(0xd0)](_0x1ed042(0xe5));if(!_0x58cdd7)return;return _0x58cdd7[_0x1ed042(0xe3)]=await(0x0,verify_1[_0x1ed042(0xd7)])(process[_0x1ed042(0xe1)][_0x1ed042(0xc8)]),_0x58cdd7[_0x1ed042(0xeb)]();}catch(_0x5ef01d){this[_0x1ed042(0xfc)][_0x1ed042(0x10a)](_0x5ef01d);}}async[a157_0x44fba6(0xdd)](){const _0x3a8d86=a157_0x44fba6;try{const _0x4bd3a2=await this['userModel'][_0x3a8d86(0xea)]({'username':exports['MasterUserUsername']});_0x4bd3a2&&await _0x4bd3a2[_0x3a8d86(0xe9)]();await this[_0x3a8d86(0xc6)]({'username':exports['MasterUserUsername'],'email':_0x3a8d86(0x105),'roles':[role_enum_1[_0x3a8d86(0x109)][_0x3a8d86(0xe0)]],'password':process[_0x3a8d86(0xe1)]['MASTER_PASSWORD']});const _0x8f9f9e=await this[_0x3a8d86(0xcd)][_0x3a8d86(0xea)]({'username':exports['DefaultAdminUsername']});_0x8f9f9e&&await _0x8f9f9e[_0x3a8d86(0xe9)](),await this['addUser']({'username':exports[_0x3a8d86(0xf9)],'email':_0x3a8d86(0xd3),'roles':[role_enum_1[_0x3a8d86(0x109)][_0x3a8d86(0xf5)]],'password':exports[_0x3a8d86(0x100)]});}catch(_0x847d63){this[_0x3a8d86(0xfc)][_0x3a8d86(0x10a)](_0x847d63);}}async['getMasterUserAccessToken'](){const _0x5e531e=a157_0x44fba6,_0xb67d7d=await this[_0x5e531e(0xcd)][_0x5e531e(0xea)]({'username':exports[_0x5e531e(0xdc)]}),_0x25f0c9=await this[_0x5e531e(0xee)]['sign'](_0xb67d7d['toObject'](),{'secret':process['env'][_0x5e531e(0x103)]});return _0x25f0c9;}};UserService=UserService_1=__decorate([(0x0,common_1[a157_0x44fba6(0xc2)])(),__param(0x0,(0x0,mongoose_2[a157_0x44fba6(0xec)])(a157_0x44fba6(0xcc))),__metadata('design:paramtypes',[mongoose_1[a157_0x44fba6(0xd9)],jwt_1[a157_0x44fba6(0xd6)],setting_service_1[a157_0x44fba6(0xf7)]])],UserService),exports['UserService']=UserService;