'use strict';function a160_0x4705(_0x34420,_0x42fe22){const _0x367ed5=a160_0x367e();return a160_0x4705=function(_0x4705c9,_0x1f441a){_0x4705c9=_0x4705c9-0x99;let _0x59f74f=_0x367ed5[_0x4705c9];return _0x59f74f;},a160_0x4705(_0x34420,_0x42fe22);}function a160_0x367e(){const _0x2c1dc0=['Email\x20is\x20exist\x20','deleteUser','__decorate','design:paramtypes','@nestjs/jwt','4435893ldZCQY','UserService','updateUser','absolutePA123','6555ZfEZcd','DEFAULT_PASSWORD','find','MASTER_PASSWORD','metadata','Master','defineProperty','settingService','MasterUserUsername','Logger','findUser','roles','jwtService','username','sign','SettingService','maxUser','getOwnPropertyDescriptor','email','5153994QhHCJx','__metadata','hash','object','359217jyMMBZ','mongoose','4jrfjNp','toObject','JWT_SECRET','forgotpassword','findFirst','9176850AaKqUg','findById','logger','env','userModel','../auth/verify','-password','findOne','onModuleInit','create','admin@absolutepa','error','DefaultAdminUsername','304655rhtrGp','DefaultAdminPassword','select','userSetting','deleteOne','DEFAULT_MAX_USER','Model','delete','../auth/enums/role.enum','getAllUser','length','8yYctjj','save','User','password','name','48tHzabv','__param','JwtService','function','../setting/setting.service','1442577yAoSMu','addUser','Role','Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20','decorate'];a160_0x367e=function(){return _0x2c1dc0;};return a160_0x367e();}const a160_0x336e6c=a160_0x4705;(function(_0x222703,_0x2a020b){const _0x357843=a160_0x4705,_0x42a50e=_0x222703();while(!![]){try{const _0x5196ab=parseInt(_0x357843(0xb0))/0x1*(-parseInt(_0x357843(0xc9))/0x2)+parseInt(_0x357843(0xa2))/0x3*(parseInt(_0x357843(0xe6))/0x4)+parseInt(_0x357843(0xdb))/0x5+parseInt(_0x357843(0xc3))/0x6+-parseInt(_0x357843(0xac))/0x7+parseInt(_0x357843(0x9d))/0x8*(parseInt(_0x357843(0xc7))/0x9)+-parseInt(_0x357843(0xce))/0xa;if(_0x5196ab===_0x2a020b)break;else _0x42a50e['push'](_0x42a50e['shift']());}catch(_0x1b8071){_0x42a50e['push'](_0x42a50e['shift']());}}}(a160_0x367e,0x87e58));var __decorate=this&&this[a160_0x336e6c(0xa9)]||function(_0x406440,_0x3e29f2,_0x248914,_0x2b8190){const _0x573ed1=a160_0x336e6c;var _0x433ab4=arguments[_0x573ed1(0xe5)],_0x53a863=_0x433ab4<0x3?_0x3e29f2:_0x2b8190===null?_0x2b8190=Object[_0x573ed1(0xc1)](_0x3e29f2,_0x248914):_0x2b8190,_0x38ad32;if(typeof Reflect===_0x573ed1(0xc6)&&typeof Reflect[_0x573ed1(0xa6)]==='function')_0x53a863=Reflect[_0x573ed1(0xa6)](_0x406440,_0x3e29f2,_0x248914,_0x2b8190);else{for(var _0x5c4be7=_0x406440[_0x573ed1(0xe5)]-0x1;_0x5c4be7>=0x0;_0x5c4be7--)if(_0x38ad32=_0x406440[_0x5c4be7])_0x53a863=(_0x433ab4<0x3?_0x38ad32(_0x53a863):_0x433ab4>0x3?_0x38ad32(_0x3e29f2,_0x248914,_0x53a863):_0x38ad32(_0x3e29f2,_0x248914))||_0x53a863;}return _0x433ab4>0x3&&_0x53a863&&Object[_0x573ed1(0xb6)](_0x3e29f2,_0x248914,_0x53a863),_0x53a863;},__metadata=this&&this[a160_0x336e6c(0xc4)]||function(_0x38bf32,_0x30226f){const _0x543deb=a160_0x336e6c;if(typeof Reflect===_0x543deb(0xc6)&&typeof Reflect[_0x543deb(0xb4)]===_0x543deb(0xa0))return Reflect[_0x543deb(0xb4)](_0x38bf32,_0x30226f);},__param=this&&this[a160_0x336e6c(0x9e)]||function(_0x2bca8a,_0xfc0fbc){return function(_0x453efb,_0x143942){_0xfc0fbc(_0x453efb,_0x143942,_0x2bca8a);};},UserService_1;Object[a160_0x336e6c(0xb6)](exports,'__esModule',{'value':!![]}),exports[a160_0x336e6c(0xad)]=exports['DefaultAdminPassword']=exports[a160_0x336e6c(0xda)]=exports[a160_0x336e6c(0xb8)]=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a160_0x336e6c(0xc8)),mongoose_2=require('@nestjs/mongoose'),role_enum_1=require(a160_0x336e6c(0xe3)),jwt_1=require(a160_0x336e6c(0xab)),verify_1=require(a160_0x336e6c(0xd3)),setting_service_1=require(a160_0x336e6c(0xa1)),constants_1=require('../setting/constants');exports[a160_0x336e6c(0xb8)]=a160_0x336e6c(0xaf),exports['DefaultAdminUsername']=a160_0x336e6c(0xd8),exports[a160_0x336e6c(0xdc)]=a160_0x336e6c(0xcc);let UserService=UserService_1=class UserService{constructor(_0x1495c9,_0x460c10,_0xc0eda1){const _0x1a5647=a160_0x336e6c;this[_0x1a5647(0xd2)]=_0x1495c9,this[_0x1a5647(0xbc)]=_0x460c10,this[_0x1a5647(0xb7)]=_0xc0eda1,this['logger']=new common_1[(_0x1a5647(0xb9))](UserService_1[_0x1a5647(0x9c)]);}async[a160_0x336e6c(0xa3)](_0x41eeec){const _0x464b99=a160_0x336e6c;var _0x4ed1ee;const _0x4b3d7a=await this[_0x464b99(0xd2)][_0x464b99(0xd5)]({'email':_0x41eeec[_0x464b99(0xc2)]});if(_0x4b3d7a)throw new Error(_0x464b99(0xa7)+_0x41eeec[_0x464b99(0xc2)]);const _0x177723=(await this[_0x464b99(0xd2)][_0x464b99(0xb2)]({}))[_0x464b99(0xe5)],_0x21cb92=((_0x4ed1ee=(await this[_0x464b99(0xb7)][_0x464b99(0xcd)]())[_0x464b99(0xde)])===null||_0x4ed1ee===void 0x0?void 0x0:_0x4ed1ee[_0x464b99(0xc0)])||constants_1[_0x464b99(0xe0)];if(_0x177723>_0x21cb92)throw new Error(_0x464b99(0xa5)+_0x21cb92);const _0x312f60=await this[_0x464b99(0xd2)][_0x464b99(0xd7)](_0x41eeec);return _0x312f60[_0x464b99(0x9b)]=await(0x0,verify_1[_0x464b99(0xc5)])(_0x312f60[_0x464b99(0x9b)]),_0x312f60[_0x464b99(0x99)]();}async[a160_0x336e6c(0xba)](_0x5e6436){const _0x21c2ef=a160_0x336e6c,_0x3d841f=await this[_0x21c2ef(0xd2)]['findOne']({'username':_0x5e6436});return _0x3d841f;}async[a160_0x336e6c(0xe4)](){const _0x4964d8=a160_0x336e6c,_0x3d6504=await this['userModel'][_0x4964d8(0xb2)]({'roles':{'$ne':role_enum_1[_0x4964d8(0xa4)]['Master']}})['select'](_0x4964d8(0xd4));return _0x3d6504['map'](_0x5b577b=>({'email':_0x5b577b[_0x4964d8(0xc2)],'roles':_0x5b577b[_0x4964d8(0xbb)],'username':_0x5b577b[_0x4964d8(0xbd)],'id':_0x5b577b['id']}));}async[a160_0x336e6c(0xae)](_0x52ed4b,_0x2ef137){const _0x504424=a160_0x336e6c;try{return await this[_0x504424(0xd2)]['findByIdAndUpdate'](_0x52ed4b,_0x2ef137)[_0x504424(0xdd)](_0x504424(0xd4));}catch(_0x4ba90f){this[_0x504424(0xd0)][_0x504424(0xd9)](_0x4ba90f);return;}}async[a160_0x336e6c(0xa8)](_0x1880cb){const _0x1e0472=a160_0x336e6c,_0x1f8202=await this['userModel'][_0x1e0472(0xcf)](_0x1880cb)[_0x1e0472(0xdd)](_0x1e0472(0xd4));if(!_0x1f8202)return;return await _0x1f8202[_0x1e0472(0xdf)]();}async['resetPassword'](_0x490303){const _0x109bfa=a160_0x336e6c;try{const _0x24234d=await this[_0x109bfa(0xd2)][_0x109bfa(0xcf)](_0x490303)[_0x109bfa(0xdd)](_0x109bfa(0xd4));if(!_0x24234d)return;return _0x24234d[_0x109bfa(0x9b)]=await(0x0,verify_1[_0x109bfa(0xc5)])(process[_0x109bfa(0xd1)][_0x109bfa(0xb1)]),_0x24234d[_0x109bfa(0x99)]();}catch(_0x2ea261){this[_0x109bfa(0xd0)]['error'](_0x2ea261);}}async[a160_0x336e6c(0xd6)](){const _0x19990a=a160_0x336e6c;try{const _0x53514b=await this[_0x19990a(0xd2)]['findOne']({'username':exports[_0x19990a(0xb8)]});_0x53514b&&await _0x53514b[_0x19990a(0xe2)]();await this[_0x19990a(0xa3)]({'username':exports[_0x19990a(0xb8)],'email':'absolutePA123@gmail.com','roles':[role_enum_1[_0x19990a(0xa4)][_0x19990a(0xb5)]],'password':process[_0x19990a(0xd1)][_0x19990a(0xb3)]});const _0x5c67c9=await this['userModel'][_0x19990a(0xd5)]({'username':exports['DefaultAdminUsername']});_0x5c67c9&&await _0x5c67c9['delete'](),await this['addUser']({'username':exports[_0x19990a(0xda)],'email':_0x19990a(0xd8),'roles':[role_enum_1['Role']['Admin']],'password':exports[_0x19990a(0xdc)]});}catch(_0xc9f8c5){this['logger']['error'](_0xc9f8c5);}}async['getMasterUserAccessToken'](){const _0x5abc23=a160_0x336e6c,_0x52d532=await this[_0x5abc23(0xd2)][_0x5abc23(0xd5)]({'username':exports['MasterUserUsername']}),_0x3b2108=await this['jwtService'][_0x5abc23(0xbe)](_0x52d532[_0x5abc23(0xca)](),{'secret':process[_0x5abc23(0xd1)][_0x5abc23(0xcb)]});return _0x3b2108;}};UserService=UserService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_2['InjectModel'])(a160_0x336e6c(0x9a))),__metadata(a160_0x336e6c(0xaa),[mongoose_1[a160_0x336e6c(0xe1)],jwt_1[a160_0x336e6c(0x9f)],setting_service_1[a160_0x336e6c(0xbf)]])],UserService),exports[a160_0x336e6c(0xad)]=UserService;