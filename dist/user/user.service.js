'use strict';function a157_0x453b(){const _0x3f0995=['Role','Model','10519341bcrzFJ','User','select','password','54942437DmQmoE','Injectable','length','487528crmPSX','-password','__metadata','settingService','addUser','absolutePA123@gmail.com','UserService','delete','__decorate','InjectModel','__param','30YVdiyl','MASTER_PASSWORD','deleteUser','../auth/verify','69186huWCZp','__esModule','24uTHiSK','jwtService','object','getOwnPropertyDescriptor','userSetting','MasterUserUsername','3MTIwKW','546027cFMtco','Logger','onModuleInit','error','Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20','resetPassword','hash','decorate','97790SbluJW','absolutePA123','username','email','metadata','findFirst','@nestjs/mongoose','env','create','123780poWjoY','sign','getMasterUserAccessToken','toObject','DEFAULT_MAX_USER','findById','mongoose','function','map','../setting/setting.service','save','defineProperty','findOne','@nestjs/jwt','findUser','DEFAULT_PASSWORD','findByIdAndUpdate','SettingService','logger','@nestjs/common','userModel','name','1179xFzwtc','../auth/enums/role.enum'];a157_0x453b=function(){return _0x3f0995;};return a157_0x453b();}const a157_0x12ce50=a157_0x44b6;(function(_0xd95dbf,_0x47868d){const _0x4a27e9=a157_0x44b6,_0x594536=_0xd95dbf();while(!![]){try{const _0x36b41b=parseInt(_0x4a27e9(0x216))/0x1*(-parseInt(_0x4a27e9(0x20e))/0x2)+parseInt(_0x4a27e9(0x217))/0x3*(-parseInt(_0x4a27e9(0x210))/0x4)+parseInt(_0x4a27e9(0x1de))/0x5*(-parseInt(_0x4a27e9(0x20a))/0x6)+-parseInt(_0x4a27e9(0x1f8))/0x7+parseInt(_0x4a27e9(0x1ff))/0x8+-parseInt(_0x4a27e9(0x1f4))/0x9*(parseInt(_0x4a27e9(0x21f))/0xa)+parseInt(_0x4a27e9(0x1fc))/0xb;if(_0x36b41b===_0x47868d)break;else _0x594536['push'](_0x594536['shift']());}catch(_0x2e44df){_0x594536['push'](_0x594536['shift']());}}}(a157_0x453b,0xe87db));var __decorate=this&&this[a157_0x12ce50(0x207)]||function(_0x47357c,_0x733ee9,_0x523c70,_0x545338){const _0x150198=a157_0x12ce50;var _0x6c3cdf=arguments[_0x150198(0x1fe)],_0x47e516=_0x6c3cdf<0x3?_0x733ee9:_0x545338===null?_0x545338=Object[_0x150198(0x213)](_0x733ee9,_0x523c70):_0x545338,_0x1bd11;if(typeof Reflect===_0x150198(0x212)&&typeof Reflect[_0x150198(0x21e)]==='function')_0x47e516=Reflect['decorate'](_0x47357c,_0x733ee9,_0x523c70,_0x545338);else{for(var _0x36d2c2=_0x47357c['length']-0x1;_0x36d2c2>=0x0;_0x36d2c2--)if(_0x1bd11=_0x47357c[_0x36d2c2])_0x47e516=(_0x6c3cdf<0x3?_0x1bd11(_0x47e516):_0x6c3cdf>0x3?_0x1bd11(_0x733ee9,_0x523c70,_0x47e516):_0x1bd11(_0x733ee9,_0x523c70))||_0x47e516;}return _0x6c3cdf>0x3&&_0x47e516&&Object[_0x150198(0x1e9)](_0x733ee9,_0x523c70,_0x47e516),_0x47e516;},__metadata=this&&this[a157_0x12ce50(0x201)]||function(_0x5d4c85,_0x3d8d22){const _0x19f2d1=a157_0x12ce50;if(typeof Reflect===_0x19f2d1(0x212)&&typeof Reflect[_0x19f2d1(0x223)]===_0x19f2d1(0x1e5))return Reflect[_0x19f2d1(0x223)](_0x5d4c85,_0x3d8d22);},__param=this&&this[a157_0x12ce50(0x209)]||function(_0x594c84,_0x51fab9){return function(_0xe91298,_0x5cf0e7){_0x51fab9(_0xe91298,_0x5cf0e7,_0x594c84);};},UserService_1;Object['defineProperty'](exports,a157_0x12ce50(0x20f),{'value':!![]}),exports['UserService']=exports['MasterUserUsername']=void 0x0;const common_1=require(a157_0x12ce50(0x1f1)),mongoose_1=require(a157_0x12ce50(0x1e4)),mongoose_2=require(a157_0x12ce50(0x225)),role_enum_1=require(a157_0x12ce50(0x1f5)),jwt_1=require(a157_0x12ce50(0x1eb)),verify_1=require(a157_0x12ce50(0x20d)),setting_service_1=require(a157_0x12ce50(0x1e7)),constants_1=require('../setting/constants');exports['MasterUserUsername']=a157_0x12ce50(0x220);let UserService=UserService_1=class UserService{constructor(_0x2b6e9c,_0x2f0778,_0x13555c){const _0xf2fcea=a157_0x12ce50;this[_0xf2fcea(0x1f2)]=_0x2b6e9c,this[_0xf2fcea(0x211)]=_0x2f0778,this[_0xf2fcea(0x202)]=_0x13555c,this[_0xf2fcea(0x1f0)]=new common_1[(_0xf2fcea(0x218))](UserService_1[_0xf2fcea(0x1f3)]);}async[a157_0x12ce50(0x203)](_0x35a3fa){const _0x5daf8f=a157_0x12ce50;var _0x58411a;const _0x51e54d=await this['userModel'][_0x5daf8f(0x1ea)]({'email':_0x35a3fa[_0x5daf8f(0x222)]});if(_0x51e54d)throw new Error('Email\x20is\x20exist');const _0xe37cf5=(await this[_0x5daf8f(0x1f2)]['find']({}))[_0x5daf8f(0x1fe)],_0x44bd29=((_0x58411a=(await this[_0x5daf8f(0x202)][_0x5daf8f(0x224)]())[_0x5daf8f(0x214)])===null||_0x58411a===void 0x0?void 0x0:_0x58411a['maxUser'])||constants_1[_0x5daf8f(0x1e2)];if(_0xe37cf5>_0x44bd29)throw new Error(_0x5daf8f(0x21b)+_0x44bd29);const _0x308eb6=await this[_0x5daf8f(0x1f2)][_0x5daf8f(0x1dd)](_0x35a3fa);return _0x308eb6[_0x5daf8f(0x1fb)]=await(0x0,verify_1[_0x5daf8f(0x21d)])(_0x308eb6[_0x5daf8f(0x1fb)]),_0x308eb6[_0x5daf8f(0x1e8)]();}async[a157_0x12ce50(0x1ec)](_0x32bd93){const _0x1c1392=a157_0x12ce50,_0x53ca6c=await this['userModel'][_0x1c1392(0x1ea)]({'username':_0x32bd93});return _0x53ca6c;}async['getAllUser'](){const _0x3ee2db=a157_0x12ce50,_0x2a5560=await this[_0x3ee2db(0x1f2)]['find']({'roles':{'$ne':role_enum_1['Role']['Master']}})[_0x3ee2db(0x1fa)]('-password');return _0x2a5560[_0x3ee2db(0x1e6)](_0x5814d2=>({'email':_0x5814d2[_0x3ee2db(0x222)],'roles':_0x5814d2['roles'],'username':_0x5814d2[_0x3ee2db(0x221)],'id':_0x5814d2['id']}));}async['updateUser'](_0x906a22,_0x2977d8){const _0xd1aa2=a157_0x12ce50;try{return await this[_0xd1aa2(0x1f2)][_0xd1aa2(0x1ee)](_0x906a22,_0x2977d8)[_0xd1aa2(0x1fa)](_0xd1aa2(0x200));}catch(_0xe7c591){this[_0xd1aa2(0x1f0)][_0xd1aa2(0x21a)](_0xe7c591);return;}}async[a157_0x12ce50(0x20c)](_0x4df32b){const _0x2d8103=a157_0x12ce50,_0x2b190e=await this[_0x2d8103(0x1f2)][_0x2d8103(0x1e3)](_0x4df32b)[_0x2d8103(0x1fa)](_0x2d8103(0x200));if(!_0x2b190e)return;return await _0x2b190e['deleteOne']();}async[a157_0x12ce50(0x21c)](_0x269e6d){const _0x3aedb6=a157_0x12ce50;try{const _0x3028de=await this[_0x3aedb6(0x1f2)][_0x3aedb6(0x1e3)](_0x269e6d)[_0x3aedb6(0x1fa)](_0x3aedb6(0x200));if(!_0x3028de)return;return _0x3028de['password']=await(0x0,verify_1[_0x3aedb6(0x21d)])(process[_0x3aedb6(0x226)][_0x3aedb6(0x1ed)]),_0x3028de[_0x3aedb6(0x1e8)]();}catch(_0x231e23){this[_0x3aedb6(0x1f0)][_0x3aedb6(0x21a)](_0x231e23);}}async[a157_0x12ce50(0x219)](){const _0x22815b=a157_0x12ce50;try{const _0x5a4bcb=await this['userModel'][_0x22815b(0x1ea)]({'username':exports['MasterUserUsername']});_0x5a4bcb&&await _0x5a4bcb[_0x22815b(0x206)](),await this['addUser']({'username':exports[_0x22815b(0x215)],'email':_0x22815b(0x204),'roles':[role_enum_1[_0x22815b(0x1f6)]['Master']],'password':process[_0x22815b(0x226)][_0x22815b(0x20b)]});}catch(_0x5b5439){this['logger'][_0x22815b(0x21a)](_0x5b5439);throw _0x5b5439;}}async[a157_0x12ce50(0x1e0)](){const _0x4dc55e=a157_0x12ce50,_0x1395d3=await this[_0x4dc55e(0x1f2)][_0x4dc55e(0x1ea)]({'username':exports[_0x4dc55e(0x215)]}),_0x27b0b1=await this['jwtService'][_0x4dc55e(0x1df)](_0x1395d3[_0x4dc55e(0x1e1)](),{'secret':process[_0x4dc55e(0x226)]['JWT_SECRET']});return _0x27b0b1;}};function a157_0x44b6(_0x40bba4,_0x4cf221){const _0x453b88=a157_0x453b();return a157_0x44b6=function(_0x44b685,_0x359f24){_0x44b685=_0x44b685-0x1dd;let _0x4a691c=_0x453b88[_0x44b685];return _0x4a691c;},a157_0x44b6(_0x40bba4,_0x4cf221);}UserService=UserService_1=__decorate([(0x0,common_1[a157_0x12ce50(0x1fd)])(),__param(0x0,(0x0,mongoose_2[a157_0x12ce50(0x208)])(a157_0x12ce50(0x1f9))),__metadata('design:paramtypes',[mongoose_1[a157_0x12ce50(0x1f7)],jwt_1['JwtService'],setting_service_1[a157_0x12ce50(0x1ef)]])],UserService),exports[a157_0x12ce50(0x205)]=UserService;