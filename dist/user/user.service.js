'use strict';function a160_0x3dca(_0x2fdae8,_0x1516a6){const _0xbb8090=a160_0xbb80();return a160_0x3dca=function(_0x3dcae3,_0x4de649){_0x3dcae3=_0x3dcae3-0x1a1;let _0x43da7f=_0xbb8090[_0x3dcae3];return _0x43da7f;},a160_0x3dca(_0x2fdae8,_0x1516a6);}const a160_0x18743c=a160_0x3dca;(function(_0x3ad4f2,_0x140106){const _0xc51f85=a160_0x3dca,_0x11ada0=_0x3ad4f2();while(!![]){try{const _0x293c17=-parseInt(_0xc51f85(0x1b5))/0x1+-parseInt(_0xc51f85(0x1e0))/0x2+-parseInt(_0xc51f85(0x1b8))/0x3*(parseInt(_0xc51f85(0x1ba))/0x4)+parseInt(_0xc51f85(0x1e8))/0x5*(parseInt(_0xc51f85(0x1cf))/0x6)+-parseInt(_0xc51f85(0x1c0))/0x7*(-parseInt(_0xc51f85(0x1e9))/0x8)+parseInt(_0xc51f85(0x1c4))/0x9+parseInt(_0xc51f85(0x1df))/0xa*(-parseInt(_0xc51f85(0x1c3))/0xb);if(_0x293c17===_0x140106)break;else _0x11ada0['push'](_0x11ada0['shift']());}catch(_0x41e65f){_0x11ada0['push'](_0x11ada0['shift']());}}}(a160_0xbb80,0x6f1f6));var __decorate=this&&this[a160_0x18743c(0x1a5)]||function(_0x3b5db3,_0x58fb92,_0x28e6f9,_0x57cef3){const _0x125965=a160_0x18743c;var _0x3ef1db=arguments[_0x125965(0x1d3)],_0x97e26b=_0x3ef1db<0x3?_0x58fb92:_0x57cef3===null?_0x57cef3=Object[_0x125965(0x1ce)](_0x58fb92,_0x28e6f9):_0x57cef3,_0x8d8ce9;if(typeof Reflect===_0x125965(0x1a8)&&typeof Reflect['decorate']===_0x125965(0x1ae))_0x97e26b=Reflect[_0x125965(0x1d6)](_0x3b5db3,_0x58fb92,_0x28e6f9,_0x57cef3);else{for(var _0x220d07=_0x3b5db3[_0x125965(0x1d3)]-0x1;_0x220d07>=0x0;_0x220d07--)if(_0x8d8ce9=_0x3b5db3[_0x220d07])_0x97e26b=(_0x3ef1db<0x3?_0x8d8ce9(_0x97e26b):_0x3ef1db>0x3?_0x8d8ce9(_0x58fb92,_0x28e6f9,_0x97e26b):_0x8d8ce9(_0x58fb92,_0x28e6f9))||_0x97e26b;}return _0x3ef1db>0x3&&_0x97e26b&&Object[_0x125965(0x1a7)](_0x58fb92,_0x28e6f9,_0x97e26b),_0x97e26b;},__metadata=this&&this[a160_0x18743c(0x1d1)]||function(_0x5b2930,_0x3c8cfe){const _0x46811b=a160_0x18743c;if(typeof Reflect==='object'&&typeof Reflect[_0x46811b(0x1bb)]===_0x46811b(0x1ae))return Reflect[_0x46811b(0x1bb)](_0x5b2930,_0x3c8cfe);},__param=this&&this[a160_0x18743c(0x1b1)]||function(_0x2d210f,_0x427a6e){return function(_0x50d196,_0x4b779d){_0x427a6e(_0x50d196,_0x4b779d,_0x2d210f);};},UserService_1;Object[a160_0x18743c(0x1a7)](exports,a160_0x18743c(0x1b7),{'value':!![]}),exports[a160_0x18743c(0x1ef)]=exports[a160_0x18743c(0x1cb)]=exports[a160_0x18743c(0x1ca)]=exports[a160_0x18743c(0x1dd)]=void 0x0;const common_1=require(a160_0x18743c(0x1eb)),mongoose_1=require(a160_0x18743c(0x1ea)),mongoose_2=require(a160_0x18743c(0x1da)),role_enum_1=require(a160_0x18743c(0x1c9)),jwt_1=require(a160_0x18743c(0x1aa)),verify_1=require('../auth/verify'),setting_service_1=require(a160_0x18743c(0x1c2)),constants_1=require(a160_0x18743c(0x1ed));exports[a160_0x18743c(0x1dd)]=a160_0x18743c(0x1ab),exports[a160_0x18743c(0x1ca)]='admin@absolutepa',exports[a160_0x18743c(0x1cb)]=a160_0x18743c(0x1e1);function a160_0xbb80(){const _0x1f814e=['556630pPMOBs','forgotpassword','find','hash','save','name','onModuleInit','getAllUser','44595micgvY','261736lLEpTx','mongoose','@nestjs/common','Role','../setting/constants','design:paramtypes','UserService','email','maxUser','InjectModel','userModel','__decorate','settingService','defineProperty','object','addUser','@nestjs/jwt','absolutePA123','Your\x20account\x20reach\x20maximum\x20number\x20of\x20account:\x20','password','function','-password','Master','__param','findById','findUser','resetPassword','30454mqYcnN','JWT_SECRET','__esModule','15WMkSnB','getMasterUserAccessToken','99592lmmngG','metadata','deleteOne','Injectable','absolutePA123@gmail.com','map','175LZEtfx','logger','../setting/setting.service','9108EQUNUn','2606778rsbByn','select','DEFAULT_MAX_USER','updateUser','findOne','../auth/enums/role.enum','DefaultAdminUsername','DefaultAdminPassword','deleteUser','sign','getOwnPropertyDescriptor','228fxlBXF','error','__metadata','Admin','length','MASTER_PASSWORD','delete','decorate','DEFAULT_PASSWORD','toObject','username','@nestjs/mongoose','Email\x20is\x20exist\x20','env','MasterUserUsername','User','6740rqavSX'];a160_0xbb80=function(){return _0x1f814e;};return a160_0xbb80();}let UserService=UserService_1=class UserService{constructor(_0x1f4f91,_0x588651,_0x4d3160){const _0x2f14c9=a160_0x18743c;this['userModel']=_0x1f4f91,this['jwtService']=_0x588651,this[_0x2f14c9(0x1a6)]=_0x4d3160,this[_0x2f14c9(0x1c1)]=new common_1['Logger'](UserService_1[_0x2f14c9(0x1e5)]);}async['addUser'](_0x43bf80){const _0x263534=a160_0x18743c;var _0x11310b;const _0x4089ba=await this[_0x263534(0x1a4)][_0x263534(0x1c8)]({'email':_0x43bf80[_0x263534(0x1a1)]});if(_0x4089ba)throw new Error(_0x263534(0x1db)+_0x43bf80[_0x263534(0x1a1)]);const _0x4e5b48=(await this['userModel'][_0x263534(0x1e2)]({}))[_0x263534(0x1d3)],_0x4a4ba0=((_0x11310b=(await this['settingService']['findFirst']())['userSetting'])===null||_0x11310b===void 0x0?void 0x0:_0x11310b[_0x263534(0x1a2)])||constants_1[_0x263534(0x1c6)];if(_0x4e5b48>_0x4a4ba0)throw new Error(_0x263534(0x1ac)+_0x4a4ba0);const _0x1863b8=await this[_0x263534(0x1a4)]['create'](_0x43bf80);return _0x1863b8[_0x263534(0x1ad)]=await(0x0,verify_1[_0x263534(0x1e3)])(_0x1863b8[_0x263534(0x1ad)]),_0x1863b8['save']();}async[a160_0x18743c(0x1b3)](_0x36ccc1){const _0x296caa=a160_0x18743c,_0xcb5123=await this[_0x296caa(0x1a4)][_0x296caa(0x1c8)]({'username':_0x36ccc1});return _0xcb5123;}async[a160_0x18743c(0x1e7)](){const _0x2ab70b=a160_0x18743c,_0x5d6000=await this[_0x2ab70b(0x1a4)][_0x2ab70b(0x1e2)]({'roles':{'$ne':role_enum_1[_0x2ab70b(0x1ec)][_0x2ab70b(0x1b0)]}})[_0x2ab70b(0x1c5)](_0x2ab70b(0x1af));return _0x5d6000[_0x2ab70b(0x1bf)](_0x55a40a=>({'email':_0x55a40a[_0x2ab70b(0x1a1)],'roles':_0x55a40a['roles'],'username':_0x55a40a[_0x2ab70b(0x1d9)],'id':_0x55a40a['id']}));}async[a160_0x18743c(0x1c7)](_0x2a1f26,_0x55981d){const _0x5f2e8e=a160_0x18743c;try{return await this['userModel']['findByIdAndUpdate'](_0x2a1f26,_0x55981d)[_0x5f2e8e(0x1c5)](_0x5f2e8e(0x1af));}catch(_0x1655a0){this['logger']['error'](_0x1655a0);return;}}async[a160_0x18743c(0x1cc)](_0x58b71f){const _0x25b751=a160_0x18743c,_0x475af5=await this[_0x25b751(0x1a4)][_0x25b751(0x1b2)](_0x58b71f)[_0x25b751(0x1c5)](_0x25b751(0x1af));if(!_0x475af5)return;return await _0x475af5[_0x25b751(0x1bc)]();}async[a160_0x18743c(0x1b4)](_0x41f713){const _0x3a4efd=a160_0x18743c;try{const _0x108c71=await this[_0x3a4efd(0x1a4)][_0x3a4efd(0x1b2)](_0x41f713)[_0x3a4efd(0x1c5)]('-password');if(!_0x108c71)return;return _0x108c71['password']=await(0x0,verify_1['hash'])(process[_0x3a4efd(0x1dc)][_0x3a4efd(0x1d7)]),_0x108c71[_0x3a4efd(0x1e4)]();}catch(_0x43e83){this[_0x3a4efd(0x1c1)][_0x3a4efd(0x1d0)](_0x43e83);}}async[a160_0x18743c(0x1e6)](){const _0x292555=a160_0x18743c;try{const _0x44fb80=await this[_0x292555(0x1a4)][_0x292555(0x1c8)]({'username':exports[_0x292555(0x1dd)]});_0x44fb80&&await _0x44fb80[_0x292555(0x1d5)]();await this[_0x292555(0x1a9)]({'username':exports[_0x292555(0x1dd)],'email':_0x292555(0x1be),'roles':[role_enum_1[_0x292555(0x1ec)][_0x292555(0x1b0)]],'password':process[_0x292555(0x1dc)][_0x292555(0x1d4)]});const _0x2c6d3f=await this[_0x292555(0x1a4)][_0x292555(0x1c8)]({'username':exports[_0x292555(0x1ca)]});_0x2c6d3f&&await _0x2c6d3f[_0x292555(0x1d5)](),await this[_0x292555(0x1a9)]({'username':exports[_0x292555(0x1ca)],'email':'admin@absolutepa','roles':[role_enum_1[_0x292555(0x1ec)][_0x292555(0x1d2)]],'password':exports[_0x292555(0x1cb)]});}catch(_0x30fd62){this[_0x292555(0x1c1)][_0x292555(0x1d0)](_0x30fd62);}}async[a160_0x18743c(0x1b9)](){const _0x8099e8=a160_0x18743c,_0x41d261=await this[_0x8099e8(0x1a4)]['findOne']({'username':exports[_0x8099e8(0x1dd)]}),_0x7ca5c6=await this['jwtService'][_0x8099e8(0x1cd)](_0x41d261[_0x8099e8(0x1d8)](),{'secret':process[_0x8099e8(0x1dc)][_0x8099e8(0x1b6)]});return _0x7ca5c6;}};UserService=UserService_1=__decorate([(0x0,common_1[a160_0x18743c(0x1bd)])(),__param(0x0,(0x0,mongoose_2[a160_0x18743c(0x1a3)])(a160_0x18743c(0x1de))),__metadata(a160_0x18743c(0x1ee),[mongoose_1['Model'],jwt_1['JwtService'],setting_service_1['SettingService']])],UserService),exports[a160_0x18743c(0x1ef)]=UserService;