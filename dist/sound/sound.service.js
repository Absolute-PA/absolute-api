'use strict';function a136_0x4b06(_0x1da74d,_0x23ea1b){const _0x51ed50=a136_0x51ed();return a136_0x4b06=function(_0x4b0636,_0x2283d7){_0x4b0636=_0x4b0636-0xab;let _0x25c7e9=_0x51ed50[_0x4b0636];return _0x25c7e9;},a136_0x4b06(_0x1da74d,_0x23ea1b);}const a136_0x530caf=a136_0x4b06;(function(_0x5153b8,_0xd369cb){const _0x26b143=a136_0x4b06,_0x3fe915=_0x5153b8();while(!![]){try{const _0x5bc38a=-parseInt(_0x26b143(0x122))/0x1+parseInt(_0x26b143(0xb0))/0x2+-parseInt(_0x26b143(0xac))/0x3+parseInt(_0x26b143(0xcb))/0x4*(parseInt(_0x26b143(0x112))/0x5)+-parseInt(_0x26b143(0xd2))/0x6+-parseInt(_0x26b143(0x109))/0x7*(parseInt(_0x26b143(0xbd))/0x8)+parseInt(_0x26b143(0xfe))/0x9*(parseInt(_0x26b143(0xf2))/0xa);if(_0x5bc38a===_0xd369cb)break;else _0x3fe915['push'](_0x3fe915['shift']());}catch(_0x471cf9){_0x3fe915['push'](_0x3fe915['shift']());}}}(a136_0x51ed,0xd5771));var __decorate=this&&this['__decorate']||function(_0x4f365f,_0x58c497,_0x32e102,_0x23d093){const _0x340b4b=a136_0x4b06;var _0x41f010=arguments[_0x340b4b(0x11e)],_0x55f57c=_0x41f010<0x3?_0x58c497:_0x23d093===null?_0x23d093=Object[_0x340b4b(0xb3)](_0x58c497,_0x32e102):_0x23d093,_0x27da7d;if(typeof Reflect===_0x340b4b(0xb6)&&typeof Reflect[_0x340b4b(0xce)]==='function')_0x55f57c=Reflect[_0x340b4b(0xce)](_0x4f365f,_0x58c497,_0x32e102,_0x23d093);else{for(var _0x195545=_0x4f365f[_0x340b4b(0x11e)]-0x1;_0x195545>=0x0;_0x195545--)if(_0x27da7d=_0x4f365f[_0x195545])_0x55f57c=(_0x41f010<0x3?_0x27da7d(_0x55f57c):_0x41f010>0x3?_0x27da7d(_0x58c497,_0x32e102,_0x55f57c):_0x27da7d(_0x58c497,_0x32e102))||_0x55f57c;}return _0x41f010>0x3&&_0x55f57c&&Object['defineProperty'](_0x58c497,_0x32e102,_0x55f57c),_0x55f57c;},__metadata=this&&this[a136_0x530caf(0xee)]||function(_0x53640f,_0x384fb3){const _0xbaef62=a136_0x530caf;if(typeof Reflect==='object'&&typeof Reflect[_0xbaef62(0x115)]==='function')return Reflect[_0xbaef62(0x115)](_0x53640f,_0x384fb3);},__param=this&&this['__param']||function(_0x3bfa70,_0x5b2fb7){return function(_0x1d975c,_0x52b55e){_0x5b2fb7(_0x1d975c,_0x52b55e,_0x3bfa70);};},SoundService_1;function a136_0x51ed(){const _0x24e13d=['SoundEvent','Play','audio','all','@nestjs/mongoose','140XGlrsa','create','./data/default-sounds','playAsync','\x20-\x20','SoundService','now','name','exec','2233960nqcUPo','isFileExist','moveFile','metadata','../streaming/streaming.service','Playing\x20voice\x20recorded:\x20','stop','killAll','DEFAULT_TUNES_DIR','__esModule','cancelJob','./sound.gateway','length','Logger','filePath','SoundGateway','111405iKPvfU','join','../common/utils','4020492BMvvIk','Sound\x20file\x20not\x20found:\x20','prototype','findByIds','2416194luQzBq','InjectModel','Playing\x20sound:\x20','getOwnPropertyDescriptor','findByIdAndDelete','validateAndMoveFileAsync','object','design:returntype','fileName','error','../common/enums','../common/events/sound','uploadService','398360cwcjYw','logger','PROCESS_CACHE','findById','Model','volume','soundModel','agendaService','broadcastPlaying','playTextToAudioRecorded','find','findOne','uuid','Tune','4oCgvIm','JobType','deleteFile','decorate','processRootPath','@nestjs/common','soundGateway','40698gXsVgw','@nestjs/event-emitter','getMessageById','Voice\x20file\x20not\x20found:\x20','Sound\x20not\x20found!','TextToAudio','resetTunes','design:paramtypes','originalname','split','Play\x20sound:\x20','log','Inject','./constants','Sound','UploadService','delete','playVoiceRecorded','PlaySound','assign','cwd','AudioPlayer','streamingService','AUDIO_DIR','playStreamAudioAsync','play','../text-to-audio/text-to-audio.service','executeJob','__metadata','../common/job','findByType','createFolder','760780VXeonu','design:type','OnEvent','upload','getNewFileName','forEach','SoundType','textToAudioService','path','AgendaService','TMP_UPLOAD_DIR','push','198sMVLaK','update','playSoundOnEvent','findByIdAndUpdate','../upload/upload.service','assets'];a136_0x51ed=function(){return _0x24e13d;};return a136_0x51ed();}Object['defineProperty'](exports,a136_0x530caf(0x11b),{'value':!![]}),exports[a136_0x530caf(0x10e)]=void 0x0;const common_1=require(a136_0x530caf(0xd0)),mongoose_1=require(a136_0x530caf(0x108)),mongoose_2=require('mongoose'),path=require(a136_0x530caf(0xfa)),event_emitter_1=require(a136_0x530caf(0xd3)),file_1=require('../common/file'),agenda_service_1=require('../agenda/agenda.service'),enums_1=require(a136_0x530caf(0xba)),constants_1=require('../common/constants'),utils_1=require(a136_0x530caf(0xab)),path_1=require('../common/path'),audio_player_1=require('../common/audio/audio-player'),sound_1=require(a136_0x530caf(0xbb)),job_1=require(a136_0x530caf(0xef)),constants_2=require(a136_0x530caf(0xdf)),default_sounds_1=require(a136_0x530caf(0x10b)),sound_gateway_1=require(a136_0x530caf(0x11d)),path_2=require(a136_0x530caf(0xfa)),upload_service_1=require(a136_0x530caf(0x102)),text_to_audio_service_1=require(a136_0x530caf(0xec)),streaming_service_1=require(a136_0x530caf(0x116));let SoundService=SoundService_1=class SoundService{constructor(_0x269a71,_0xb258f,_0x366c63,_0x45d957,_0x1e2a39,_0x508681){const _0xad50c7=a136_0x530caf;this[_0xad50c7(0xc3)]=_0x269a71,this[_0xad50c7(0xc4)]=_0xb258f,this[_0xad50c7(0xbc)]=_0x366c63,this['textToAudioService']=_0x45d957,this[_0xad50c7(0xe8)]=_0x1e2a39,this[_0xad50c7(0xd1)]=_0x508681,this[_0xad50c7(0xbe)]=new common_1[(_0xad50c7(0x11f))](SoundService_1['name']);}async[a136_0x530caf(0x10a)](_0x2b086a){const _0x3d4725=a136_0x530caf;await this['validateAndMoveFileAsync'](_0x2b086a,null);const _0x3c3dde=new this[(_0x3d4725(0xc3))](_0x2b086a);return _0x3c3dde['save']();}async[a136_0x530caf(0xf0)](_0x520295){const _0x98bcb3=a136_0x530caf,_0x10f133=await this[_0x98bcb3(0xc3)][_0x98bcb3(0xc7)]({'type':_0x520295})[_0x98bcb3(0x111)]();return _0x10f133;}async['findOne'](_0x273721){const _0x2205f3=a136_0x530caf,_0x2fe2fb=await this['soundModel'][_0x2205f3(0xc0)](_0x273721);return _0x2fe2fb;}async[a136_0x530caf(0xaf)](_0x50c1a2){const _0x3a7763=a136_0x530caf,_0x4eb6a6=await this[_0x3a7763(0xc3)]['find']({'_id':{'$in':_0x50c1a2}});return _0x4eb6a6;}async[a136_0x530caf(0xff)](_0x18e2dd,_0xace71){const _0x1fb6af=a136_0x530caf,_0x272824=await this[_0x1fb6af(0xc3)][_0x1fb6af(0xc0)](_0x18e2dd)[_0x1fb6af(0x111)]();if(!_0x272824)throw new Error(_0x1fb6af(0xd6));await this['validateAndMoveFileAsync'](_0xace71,_0x272824===null||_0x272824===void 0x0?void 0x0:_0x272824[_0x1fb6af(0xb8)]);const _0x58aadc=await this[_0x1fb6af(0xc3)][_0x1fb6af(0x101)](_0x18e2dd,Object['assign'](Object['assign']({},_0xace71),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x58aadc;}async['updateVolume'](_0xfaa434,_0x1a39b0){const _0x1fd7c7=a136_0x530caf,_0x327ed4=await this[_0x1fd7c7(0xc3)][_0x1fd7c7(0xc0)](_0xfaa434)[_0x1fd7c7(0x111)]();if(!_0x327ed4)throw new Error(_0x1fd7c7(0xd6));const _0x1c8f87=await this['soundModel'][_0x1fd7c7(0x101)](_0xfaa434,Object[_0x1fd7c7(0xe5)](Object[_0x1fd7c7(0xe5)]({},_0x1a39b0),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x1c8f87;}async[a136_0x530caf(0xe2)](_0x8f0299){const _0x5bb350=a136_0x530caf,_0x25862a=await this['soundModel'][_0x5bb350(0xb4)](_0x8f0299);if(_0x25862a[_0x5bb350(0xb8)]){const _0x41095e=constants_1[_0x5bb350(0xe9)]+'/'+_0x25862a[_0x5bb350(0xb8)];try{(0x0,file_1[_0x5bb350(0xcd)])(_0x41095e);}catch(_0x48a938){this[_0x5bb350(0xbe)][_0x5bb350(0xb9)](_0x48a938);}}return _0x25862a;}async[a136_0x530caf(0xf5)](_0xd40919,_0x546dbc){const _0x2f65d6=a136_0x530caf,_0x1fd280=await this[_0x2f65d6(0xc3)]['findById'](_0xd40919)[_0x2f65d6(0x111)](),_0x516e7e=_0x1fd280===null||_0x1fd280===void 0x0?void 0x0:_0x1fd280[_0x2f65d6(0xb8)],_0x3893a6=this[_0x2f65d6(0xf6)](_0x546dbc[_0x2f65d6(0xda)]),_0x184a1f=constants_1['AUDIO_DIR']+'/'+_0x3893a6;await(0x0,file_1[_0x2f65d6(0x114)])(_0x546dbc['path'],_0x184a1f);const _0x42b4a2={'fileName':_0x3893a6},_0x54bc7d=await this['soundModel'][_0x2f65d6(0x101)](_0xd40919,Object[_0x2f65d6(0xe5)](Object[_0x2f65d6(0xe5)]({},_0x42b4a2),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0x516e7e){const _0x3b3771=constants_1[_0x2f65d6(0xe9)]+'/'+_0x516e7e;(0x0,file_1[_0x2f65d6(0xcd)])(_0x3b3771);}return _0x54bc7d;}async[a136_0x530caf(0x100)](_0x2f776a){const _0x1fba27=a136_0x530caf,{soundId:_0x431b9d,jobId:_0x2d40ee,durationInSecond:_0x14a1f8}=_0x2f776a,_0x2fc885=await this[_0x1fba27(0xc8)](_0x431b9d),_0x2c5fdd=path[_0x1fba27(0x123)](path_1[_0x1fba27(0xcf)],_0x1fba27(0x103),_0x1fba27(0x106),_0x2fc885['fileName']);if(!(0x0,file_1[_0x1fba27(0x113)])(_0x2c5fdd)){this[_0x1fba27(0xbe)][_0x1fba27(0xb9)](_0x1fba27(0xad)+_0x2c5fdd);return;}job_1[_0x1fba27(0xbf)][_0x1fba27(0x119)](),this[_0x1fba27(0xbe)][_0x1fba27(0xdd)](_0x1fba27(0xb2)+_0x431b9d+_0x1fba27(0x10d)+_0x2fc885[_0x1fba27(0x110)]),(0x0,job_1[_0x1fba27(0xed)])({'jobId':_0x2d40ee,'run':()=>audio_player_1[_0x1fba27(0xe7)][_0x1fba27(0x10c)](_0x2c5fdd,_0x2fc885[_0x1fba27(0xc2)]),'next':()=>this[_0x1fba27(0x118)](_0x431b9d),'durationInSecond':_0x14a1f8}),this[_0x1fba27(0xd1)][_0x1fba27(0xc5)]({'id':_0x431b9d,'isPlaying':!![]});}async[a136_0x530caf(0xe3)](_0x239cda){const _0x58355e=a136_0x530caf,{voiceId:_0x17510d,jobId:_0x2c3fe4,durationInSecond:_0x126f82}=_0x239cda,_0x6f8728=await this[_0x58355e(0xbc)]['findVoiceRecoredById'](_0x17510d),_0x365f1e=_0x6f8728[_0x58355e(0x120)],_0x5b809f=(0x0,path_2[_0x58355e(0x123)])(process[_0x58355e(0xe6)](),_0x365f1e);if(!(0x0,file_1[_0x58355e(0x113)])(_0x5b809f)){this[_0x58355e(0xbe)][_0x58355e(0xb9)](_0x58355e(0xd5)+_0x5b809f);return;}job_1[_0x58355e(0xbf)][_0x58355e(0x119)](),this[_0x58355e(0xbe)][_0x58355e(0xdd)](_0x58355e(0x117)+_0x17510d),(0x0,job_1[_0x58355e(0xed)])({'jobId':_0x2c3fe4,'run':()=>audio_player_1['AudioPlayer'][_0x58355e(0x10c)](_0x5b809f),'durationInSecond':_0x126f82,'next':()=>null});}async[a136_0x530caf(0xc6)](_0x23c550){const _0x221611=a136_0x530caf,{textToAudioId:_0x20d210,jobId:_0x242452,durationInSecond:_0x5f3ca5}=_0x23c550,{message:_0xa64b1c}=await this[_0x221611(0xf9)][_0x221611(0xd4)](_0x20d210);job_1['PROCESS_CACHE'][_0x221611(0x119)](),(0x0,job_1[_0x221611(0xed)])({'jobId':_0x242452,'run':()=>{let _0x1cdb51=null;return this['textToAudioService']['textToAudio'](_0xa64b1c,_0x3a4d93=>{const _0x2f68b0=a136_0x4b06;_0x1cdb51=this['streamingService'][_0x2f68b0(0xea)](_0x3a4d93);}),_0x1cdb51;},'durationInSecond':_0x5f3ca5,'next':()=>null});}async[a136_0x530caf(0xeb)](_0x8970c9,_0x49e16e,_0xa5810f=![]){const _0x3fe90a=a136_0x530caf,_0x4297cc={'when':_0x3fe90a(0x10f),'jobType':enums_1[_0x3fe90a(0xcc)][_0x3fe90a(0xe4)],'attributes':{'soundId':_0x49e16e,'durationInSecond':_0xa5810f?0x15180:undefined},'audit':{'actor':_0x8970c9,'name':enums_1['JobType'][_0x3fe90a(0xe4)],'message':_0x3fe90a(0xdc)+_0x49e16e}},_0x368049=await this[_0x3fe90a(0xc3)][_0x3fe90a(0xc8)]({'jobId':{'$ne':null}});_0x368049&&await this[_0x3fe90a(0x118)](_0x368049['id']);const {jobId:_0x37ed0c}=await this['agendaService']['scheduleJob'](_0x4297cc);return this['update'](_0x49e16e,{'jobId':_0x37ed0c});}async[a136_0x530caf(0x118)](_0x19525c){const _0x1e4b7c=a136_0x530caf;let _0x50810c=await this['findOne'](_0x19525c);const {jobId:_0x2398cc}=_0x50810c||{};if(_0x2398cc){const {success:_0x30c10f}=await this[_0x1e4b7c(0xc4)][_0x1e4b7c(0x11c)](_0x2398cc);_0x30c10f&&(_0x50810c=await this[_0x1e4b7c(0xff)](_0x19525c,{'jobId':null}));}return this[_0x1e4b7c(0xd1)][_0x1e4b7c(0xc5)]({'id':_0x50810c['id'],'isPlaying':![]}),_0x50810c;}async[a136_0x530caf(0xd8)](){const _0x5e7692=a136_0x530caf,_0x1e76fa=await this[_0x5e7692(0xf0)](constants_2[_0x5e7692(0xf8)][_0x5e7692(0xca)]);if(_0x1e76fa[_0x5e7692(0x11e)]>0x0){const _0x545cad=[];_0x1e76fa[_0x5e7692(0xf7)](_0xafd10=>{const _0x178465=_0x5e7692;_0x545cad[_0x178465(0xfd)](this[_0x178465(0xe2)](_0xafd10['_id']));}),await Promise[_0x5e7692(0x107)](_0x545cad);}await(0x0,file_1['copyFiles'])(constants_1[_0x5e7692(0x11a)],constants_1[_0x5e7692(0xfc)]);const _0x24d679=[];return default_sounds_1['DEFAULT_TUNES']['forEach'](_0x31c547=>{const _0x2886c7=_0x5e7692;_0x24d679[_0x2886c7(0xfd)](this[_0x2886c7(0x10a)](Object[_0x2886c7(0xe5)]({},_0x31c547)));}),await Promise[_0x5e7692(0x107)](_0x24d679),!![];}[a136_0x530caf(0xf6)](_0x5b869f){const _0x386e19=a136_0x530caf,_0x5928c9=_0x5b869f[_0x386e19(0xdb)]('.')['pop']();return(0x0,utils_1[_0x386e19(0xc9)])()+'.'+_0x5928c9;}async[a136_0x530caf(0xb5)](_0x8b2bc8,_0x4d58ac){const _0xef9c0a=a136_0x530caf;if(!_0x8b2bc8[_0xef9c0a(0xb8)])return;const _0x1b10ef=constants_1['TMP_UPLOAD_DIR']+'/'+_0x8b2bc8['fileName'],_0xe76887=_0x4d58ac||this['getNewFileName'](_0x8b2bc8[_0xef9c0a(0xb8)]),_0x2d117f=constants_1[_0xef9c0a(0xe9)]+'/'+_0xe76887;if(!(0x0,file_1[_0xef9c0a(0x113)])(_0x1b10ef))throw new Error('File\x20not\x20found!');!(0x0,file_1[_0xef9c0a(0x113)])(constants_1['AUDIO_DIR'])&&(0x0,file_1[_0xef9c0a(0xf1)])(constants_1[_0xef9c0a(0xe9)]),await(0x0,file_1[_0xef9c0a(0x114)])(_0x1b10ef,_0x2d117f),_0x8b2bc8[_0xef9c0a(0xb8)]=_0xe76887;}};__decorate([(0x0,event_emitter_1[a136_0x530caf(0xf4)])(sound_1[a136_0x530caf(0x104)][a136_0x530caf(0x105)]),__metadata(a136_0x530caf(0xf3),Function),__metadata(a136_0x530caf(0xd9),[Object]),__metadata(a136_0x530caf(0xb7),Promise)],SoundService['prototype'],a136_0x530caf(0x100),null),__decorate([(0x0,event_emitter_1[a136_0x530caf(0xf4)])(sound_1['SoundEvent']['VoiceRecorded']),__metadata(a136_0x530caf(0xf3),Function),__metadata(a136_0x530caf(0xd9),[Object]),__metadata('design:returntype',Promise)],SoundService['prototype'],a136_0x530caf(0xe3),null),__decorate([(0x0,event_emitter_1[a136_0x530caf(0xf4)])(sound_1[a136_0x530caf(0x104)][a136_0x530caf(0xd7)]),__metadata('design:type',Function),__metadata(a136_0x530caf(0xd9),[Object]),__metadata(a136_0x530caf(0xb7),Promise)],SoundService[a136_0x530caf(0xae)],'playTextToAudioRecorded',null),SoundService=SoundService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_1[a136_0x530caf(0xb1)])(a136_0x530caf(0xe0))),__param(0x5,(0x0,common_1[a136_0x530caf(0xde)])(sound_gateway_1[a136_0x530caf(0x121)])),__metadata(a136_0x530caf(0xd9),[mongoose_2[a136_0x530caf(0xc1)],agenda_service_1[a136_0x530caf(0xfb)],upload_service_1[a136_0x530caf(0xe1)],text_to_audio_service_1['TextToAudioService'],streaming_service_1['StreamingService'],sound_gateway_1[a136_0x530caf(0x121)]])],SoundService),exports[a136_0x530caf(0x10e)]=SoundService;