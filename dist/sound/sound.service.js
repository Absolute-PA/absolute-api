'use strict';const a133_0x331ed6=a133_0x1f19;(function(_0x5e5d8d,_0x33922d){const _0x52309d=a133_0x1f19,_0x4503b8=_0x5e5d8d();while(!![]){try{const _0x2b55da=-parseInt(_0x52309d(0x176))/0x1*(parseInt(_0x52309d(0x155))/0x2)+-parseInt(_0x52309d(0x19c))/0x3+parseInt(_0x52309d(0x19d))/0x4*(-parseInt(_0x52309d(0x18b))/0x5)+-parseInt(_0x52309d(0x157))/0x6+-parseInt(_0x52309d(0x151))/0x7+-parseInt(_0x52309d(0x133))/0x8*(-parseInt(_0x52309d(0x187))/0x9)+parseInt(_0x52309d(0x163))/0xa;if(_0x2b55da===_0x33922d)break;else _0x4503b8['push'](_0x4503b8['shift']());}catch(_0x415f85){_0x4503b8['push'](_0x4503b8['shift']());}}}(a133_0x2e58,0x26700));var __decorate=this&&this['__decorate']||function(_0x22dc83,_0x5d9dcf,_0x4e6427,_0x5d1068){const _0x3c54b2=a133_0x1f19;var _0x40ce70=arguments[_0x3c54b2(0x166)],_0x266ce2=_0x40ce70<0x3?_0x5d9dcf:_0x5d1068===null?_0x5d1068=Object[_0x3c54b2(0x17a)](_0x5d9dcf,_0x4e6427):_0x5d1068,_0x895cab;if(typeof Reflect===_0x3c54b2(0x15e)&&typeof Reflect[_0x3c54b2(0x193)]===_0x3c54b2(0x144))_0x266ce2=Reflect[_0x3c54b2(0x193)](_0x22dc83,_0x5d9dcf,_0x4e6427,_0x5d1068);else{for(var _0x28cd09=_0x22dc83['length']-0x1;_0x28cd09>=0x0;_0x28cd09--)if(_0x895cab=_0x22dc83[_0x28cd09])_0x266ce2=(_0x40ce70<0x3?_0x895cab(_0x266ce2):_0x40ce70>0x3?_0x895cab(_0x5d9dcf,_0x4e6427,_0x266ce2):_0x895cab(_0x5d9dcf,_0x4e6427))||_0x266ce2;}return _0x40ce70>0x3&&_0x266ce2&&Object[_0x3c54b2(0x168)](_0x5d9dcf,_0x4e6427,_0x266ce2),_0x266ce2;},__metadata=this&&this[a133_0x331ed6(0x13f)]||function(_0x47077c,_0x5a22aa){const _0x418638=a133_0x331ed6;if(typeof Reflect===_0x418638(0x15e)&&typeof Reflect[_0x418638(0x173)]===_0x418638(0x144))return Reflect[_0x418638(0x173)](_0x47077c,_0x5a22aa);},__param=this&&this[a133_0x331ed6(0x167)]||function(_0x5cc174,_0x30fa6b){return function(_0xc2573a,_0x2ef231){_0x30fa6b(_0xc2573a,_0x2ef231,_0x5cc174);};},SoundService_1;Object[a133_0x331ed6(0x168)](exports,a133_0x331ed6(0x16d),{'value':!![]}),exports[a133_0x331ed6(0x174)]=void 0x0;function a133_0x2e58(){const _0x199828=['TextToAudio','DEFAULT_TUNES','PlaySound','getNewFileName','broadcastPlaying','deleteFile','@nestjs/common','AgendaService','mongoose','delete','getMessageById','copyFiles','exec','moveFile','agendaService','fileName','128TeMLlB','resetTunes','cwd','Model','AudioPlayer','PROCESS_CACHE','log','findByIdAndDelete','executeJob','Tune','./constants','playAsync','__metadata','JobType','playStreamAudioAsync','createFolder','StreamingService','function','TextToAudioService','play','@nestjs/event-emitter','isFileExist','../common/constants','Sound','validateAndMoveFileAsync','_id','design:returntype','create','design:paramtypes','Playing\x20voice\x20recorded:\x20','1928066KkWjUe','./sound.gateway','AUDIO_DIR','playVoiceRecorded','2qawYUz','Play','504780nTzkJW','path','save','prototype','name','audio','stop','object','update','Inject','join','../common/events/sound','8536070CJuCQx','VoiceRecorded','design:type','length','__param','defineProperty','../common/file','soundModel','findOne','now','__esModule','DEFAULT_TUNES_DIR','playTextToAudioRecorded','all','Sound\x20not\x20found!','../text-to-audio/text-to-audio.service','metadata','SoundService','find','139793PHjFGr','UploadService','push','textToAudioService','getOwnPropertyDescriptor','Injectable','findByIdAndUpdate','killAll','Logger','@nestjs/mongoose','Play\x20sound:\x20','soundGateway','../streaming/streaming.service','SoundEvent','logger','streamingService','assets','23832MEKoQv','Playing\x20sound:\x20','playSoundOnEvent','error','560425qWPjGG','assign','OnEvent','../upload/upload.service','volume','updateVolume','textToAudio','../agenda/agenda.service','decorate','findByIds','SoundGateway','TMP_UPLOAD_DIR','upload','split','findById','findByType','../common/audio/audio-player','45012puiBCW','8gUrjgd','pop','uploadService','findVoiceRecoredById','forEach'];a133_0x2e58=function(){return _0x199828;};return a133_0x2e58();}function a133_0x1f19(_0x4340d1,_0x3e5d37){const _0x2e58e3=a133_0x2e58();return a133_0x1f19=function(_0x1f19da,_0x38def0){_0x1f19da=_0x1f19da-0x12c;let _0x4ef3e1=_0x2e58e3[_0x1f19da];return _0x4ef3e1;},a133_0x1f19(_0x4340d1,_0x3e5d37);}const common_1=require(a133_0x331ed6(0x1a8)),mongoose_1=require(a133_0x331ed6(0x17f)),mongoose_2=require(a133_0x331ed6(0x1aa)),path=require(a133_0x331ed6(0x158)),event_emitter_1=require(a133_0x331ed6(0x147)),file_1=require(a133_0x331ed6(0x169)),agenda_service_1=require(a133_0x331ed6(0x192)),enums_1=require('../common/enums'),constants_1=require(a133_0x331ed6(0x149)),utils_1=require('../common/utils'),path_1=require('../common/path'),audio_player_1=require(a133_0x331ed6(0x19b)),sound_1=require(a133_0x331ed6(0x162)),job_1=require('../common/job'),constants_2=require(a133_0x331ed6(0x13d)),default_sounds_1=require('./data/default-sounds'),sound_gateway_1=require(a133_0x331ed6(0x152)),path_2=require(a133_0x331ed6(0x158)),upload_service_1=require(a133_0x331ed6(0x18e)),text_to_audio_service_1=require(a133_0x331ed6(0x172)),streaming_service_1=require(a133_0x331ed6(0x182));let SoundService=SoundService_1=class SoundService{constructor(_0x5295a7,_0x32a903,_0x135145,_0x1ae5fd,_0x1ad20c,_0x374ea3){const _0x49a964=a133_0x331ed6;this[_0x49a964(0x16a)]=_0x5295a7,this[_0x49a964(0x131)]=_0x32a903,this[_0x49a964(0x19f)]=_0x135145,this['textToAudioService']=_0x1ae5fd,this[_0x49a964(0x185)]=_0x1ad20c,this['soundGateway']=_0x374ea3,this[_0x49a964(0x184)]=new common_1[(_0x49a964(0x17e))](SoundService_1[_0x49a964(0x15b)]);}async[a133_0x331ed6(0x14e)](_0x44e396){const _0x505f35=a133_0x331ed6;await this[_0x505f35(0x14b)](_0x44e396,null);const _0x385740=new this[(_0x505f35(0x16a))](_0x44e396);return _0x385740[_0x505f35(0x159)]();}async['findByType'](_0x34f87f){const _0x247445=a133_0x331ed6,_0x10dc84=await this[_0x247445(0x16a)][_0x247445(0x175)]({'type':_0x34f87f})['exec']();return _0x10dc84;}async[a133_0x331ed6(0x16b)](_0x5f1d85){const _0x306d30=a133_0x331ed6,_0x33ab8b=await this[_0x306d30(0x16a)][_0x306d30(0x199)](_0x5f1d85);return _0x33ab8b;}async[a133_0x331ed6(0x194)](_0x4cf5af){const _0x35660d=a133_0x331ed6,_0x697751=await this[_0x35660d(0x16a)][_0x35660d(0x175)]({'_id':{'$in':_0x4cf5af}});return _0x697751;}async['update'](_0x51261a,_0x1e7e1e){const _0x2fdb66=a133_0x331ed6,_0x46a4cc=await this[_0x2fdb66(0x16a)][_0x2fdb66(0x199)](_0x51261a)[_0x2fdb66(0x12f)]();if(!_0x46a4cc)throw new Error(_0x2fdb66(0x171));await this['validateAndMoveFileAsync'](_0x1e7e1e,_0x46a4cc===null||_0x46a4cc===void 0x0?void 0x0:_0x46a4cc[_0x2fdb66(0x132)]);const _0x4d6bec=await this['soundModel']['findByIdAndUpdate'](_0x51261a,Object['assign'](Object['assign']({},_0x1e7e1e),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x4d6bec;}async[a133_0x331ed6(0x190)](_0x57360e,_0x374f71){const _0x3cd84f=a133_0x331ed6,_0x181704=await this[_0x3cd84f(0x16a)]['findById'](_0x57360e)[_0x3cd84f(0x12f)]();if(!_0x181704)throw new Error('Sound\x20not\x20found!');const _0x3abbb1=await this[_0x3cd84f(0x16a)][_0x3cd84f(0x17c)](_0x57360e,Object[_0x3cd84f(0x18c)](Object[_0x3cd84f(0x18c)]({},_0x374f71),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x3abbb1;}async[a133_0x331ed6(0x12c)](_0x3df7c1){const _0x4c3c99=a133_0x331ed6,_0x403174=await this[_0x4c3c99(0x16a)][_0x4c3c99(0x13a)](_0x3df7c1);if(_0x403174['fileName']){const _0x159969=constants_1[_0x4c3c99(0x153)]+'/'+_0x403174['fileName'];try{(0x0,file_1[_0x4c3c99(0x1a7)])(_0x159969);}catch(_0x3ffd0d){this[_0x4c3c99(0x184)][_0x4c3c99(0x18a)](_0x3ffd0d);}}return _0x403174;}async[a133_0x331ed6(0x197)](_0x333203,_0x2455b8){const _0x419e00=a133_0x331ed6,_0x156c33=await this['soundModel']['findById'](_0x333203)[_0x419e00(0x12f)](),_0x3e4fc2=_0x156c33===null||_0x156c33===void 0x0?void 0x0:_0x156c33[_0x419e00(0x132)],_0x146f46=this['getNewFileName'](_0x2455b8['originalname']),_0x3a6b29=constants_1['AUDIO_DIR']+'/'+_0x146f46;await(0x0,file_1['moveFile'])(_0x2455b8[_0x419e00(0x158)],_0x3a6b29);const _0x100c29={'fileName':_0x146f46},_0x2bf6a3=await this[_0x419e00(0x16a)][_0x419e00(0x17c)](_0x333203,Object['assign'](Object[_0x419e00(0x18c)]({},_0x100c29),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0x3e4fc2){const _0x5052f7=constants_1['AUDIO_DIR']+'/'+_0x3e4fc2;(0x0,file_1[_0x419e00(0x1a7)])(_0x5052f7);}return _0x2bf6a3;}async[a133_0x331ed6(0x189)](_0x5c1ac5){const _0x2b3c14=a133_0x331ed6,{soundId:_0x118d47,jobId:_0x293701,durationInSecond:_0xf38013}=_0x5c1ac5,_0x11382b=await this['findOne'](_0x118d47),_0x10f321=path[_0x2b3c14(0x161)](path_1['processRootPath'],_0x2b3c14(0x186),_0x2b3c14(0x15c),_0x11382b[_0x2b3c14(0x132)]);job_1[_0x2b3c14(0x138)]['killAll'](),this[_0x2b3c14(0x184)][_0x2b3c14(0x139)](_0x2b3c14(0x188)+_0x118d47+'\x20-\x20'+_0x11382b[_0x2b3c14(0x15b)]),(0x0,job_1['executeJob'])({'jobId':_0x293701,'run':()=>audio_player_1[_0x2b3c14(0x137)][_0x2b3c14(0x13e)](_0x10f321,_0x11382b[_0x2b3c14(0x18f)]),'next':()=>this[_0x2b3c14(0x15d)](_0x118d47),'durationInSecond':_0xf38013}),this[_0x2b3c14(0x181)][_0x2b3c14(0x1a6)]({'id':_0x118d47,'isPlaying':!![]});}async[a133_0x331ed6(0x154)](_0x3974d3){const _0x2ffaee=a133_0x331ed6,{voiceId:_0x13bc1a,jobId:_0x197869,durationInSecond:_0x4c5b75}=_0x3974d3,_0x178861=await this['uploadService'][_0x2ffaee(0x1a0)](_0x13bc1a),_0x17f82c=_0x178861['filePath'],_0x56417c=(0x0,path_2[_0x2ffaee(0x161)])(process[_0x2ffaee(0x135)](),_0x17f82c);job_1[_0x2ffaee(0x138)]['killAll'](),this[_0x2ffaee(0x184)]['log'](_0x2ffaee(0x150)+_0x13bc1a),(0x0,job_1['executeJob'])({'jobId':_0x197869,'run':()=>audio_player_1['AudioPlayer'][_0x2ffaee(0x13e)](_0x56417c),'durationInSecond':_0x4c5b75,'next':()=>null});}async['playTextToAudioRecorded'](_0x2b1e57){const _0x4d3f2a=a133_0x331ed6,{textToAudioId:_0xeffa3c,jobId:_0x49308d,durationInSecond:_0x4d3e17}=_0x2b1e57,{message:_0x1b1530}=await this['textToAudioService'][_0x4d3f2a(0x12d)](_0xeffa3c);job_1[_0x4d3f2a(0x138)][_0x4d3f2a(0x17d)](),(0x0,job_1[_0x4d3f2a(0x13b)])({'jobId':_0x49308d,'run':()=>{const _0x1ffa4c=_0x4d3f2a;let _0x3ec8af=null;return this[_0x1ffa4c(0x179)][_0x1ffa4c(0x191)](_0x1b1530,_0xf3427f=>{const _0x27e611=_0x1ffa4c;_0x3ec8af=this['streamingService'][_0x27e611(0x141)](_0xf3427f);}),_0x3ec8af;},'durationInSecond':_0x4d3e17,'next':()=>null});}async[a133_0x331ed6(0x146)](_0x2a7b57,_0x2529d9,_0x4ec204=![]){const _0x230e1a=a133_0x331ed6,_0x1be011={'when':_0x230e1a(0x16c),'jobType':enums_1['JobType'][_0x230e1a(0x1a4)],'attributes':{'soundId':_0x2529d9,'durationInSecond':_0x4ec204?0x15180:undefined},'audit':{'actor':_0x2a7b57,'name':enums_1[_0x230e1a(0x140)]['PlaySound'],'message':_0x230e1a(0x180)+_0x2529d9}},_0x16618d=await this['soundModel'][_0x230e1a(0x16b)]({'jobId':{'$ne':null}});_0x16618d&&await this[_0x230e1a(0x15d)](_0x16618d['id']);const {jobId:_0x129adb}=await this['agendaService']['scheduleJob'](_0x1be011);return this[_0x230e1a(0x15f)](_0x2529d9,{'jobId':_0x129adb});}async[a133_0x331ed6(0x15d)](_0xdf74f5){const _0x2f9cd9=a133_0x331ed6;let _0x324151=await this['findOne'](_0xdf74f5);const {jobId:_0x182863}=_0x324151||{};if(_0x182863){const {success:_0x2bc041}=await this['agendaService']['cancelJob'](_0x182863);_0x2bc041&&(_0x324151=await this['update'](_0xdf74f5,{'jobId':null}));}return this[_0x2f9cd9(0x181)][_0x2f9cd9(0x1a6)]({'id':_0x324151['id'],'isPlaying':![]}),_0x324151;}async[a133_0x331ed6(0x134)](){const _0x50e6f8=a133_0x331ed6,_0x2c42ac=await this[_0x50e6f8(0x19a)](constants_2['SoundType'][_0x50e6f8(0x13c)]);if(_0x2c42ac['length']>0x0){const _0x3364fe=[];_0x2c42ac[_0x50e6f8(0x1a1)](_0x275e52=>{const _0x29a870=_0x50e6f8;_0x3364fe[_0x29a870(0x178)](this['delete'](_0x275e52[_0x29a870(0x14c)]));}),await Promise[_0x50e6f8(0x170)](_0x3364fe);}await(0x0,file_1[_0x50e6f8(0x12e)])(constants_1[_0x50e6f8(0x16e)],constants_1[_0x50e6f8(0x196)]);const _0x1c299b=[];return default_sounds_1[_0x50e6f8(0x1a3)][_0x50e6f8(0x1a1)](_0x29f651=>{const _0x2e9a61=_0x50e6f8;_0x1c299b['push'](this[_0x2e9a61(0x14e)](Object[_0x2e9a61(0x18c)]({},_0x29f651)));}),await Promise['all'](_0x1c299b),!![];}['getNewFileName'](_0x169fc1){const _0x5ccec5=a133_0x331ed6,_0x2618bf=_0x169fc1[_0x5ccec5(0x198)]('.')[_0x5ccec5(0x19e)]();return(0x0,utils_1['uuid'])()+'.'+_0x2618bf;}async[a133_0x331ed6(0x14b)](_0x4deb07,_0x98568){const _0x52e341=a133_0x331ed6;if(!_0x4deb07[_0x52e341(0x132)])return;const _0x5f034d=constants_1['TMP_UPLOAD_DIR']+'/'+_0x4deb07[_0x52e341(0x132)],_0x5854b6=_0x98568||this[_0x52e341(0x1a5)](_0x4deb07[_0x52e341(0x132)]),_0x54fd23=constants_1[_0x52e341(0x153)]+'/'+_0x5854b6;if(!(0x0,file_1[_0x52e341(0x148)])(_0x5f034d))throw new Error('File\x20not\x20found!');!(0x0,file_1['isFileExist'])(constants_1[_0x52e341(0x153)])&&(0x0,file_1[_0x52e341(0x142)])(constants_1['AUDIO_DIR']),await(0x0,file_1[_0x52e341(0x130)])(_0x5f034d,_0x54fd23),_0x4deb07[_0x52e341(0x132)]=_0x5854b6;}};__decorate([(0x0,event_emitter_1['OnEvent'])(sound_1['SoundEvent'][a133_0x331ed6(0x156)]),__metadata(a133_0x331ed6(0x165),Function),__metadata(a133_0x331ed6(0x14f),[Object]),__metadata(a133_0x331ed6(0x14d),Promise)],SoundService[a133_0x331ed6(0x15a)],'playSoundOnEvent',null),__decorate([(0x0,event_emitter_1[a133_0x331ed6(0x18d)])(sound_1['SoundEvent'][a133_0x331ed6(0x164)]),__metadata(a133_0x331ed6(0x165),Function),__metadata(a133_0x331ed6(0x14f),[Object]),__metadata(a133_0x331ed6(0x14d),Promise)],SoundService[a133_0x331ed6(0x15a)],'playVoiceRecorded',null),__decorate([(0x0,event_emitter_1[a133_0x331ed6(0x18d)])(sound_1[a133_0x331ed6(0x183)][a133_0x331ed6(0x1a2)]),__metadata(a133_0x331ed6(0x165),Function),__metadata(a133_0x331ed6(0x14f),[Object]),__metadata('design:returntype',Promise)],SoundService[a133_0x331ed6(0x15a)],a133_0x331ed6(0x16f),null),SoundService=SoundService_1=__decorate([(0x0,common_1[a133_0x331ed6(0x17b)])(),__param(0x0,(0x0,mongoose_1['InjectModel'])(a133_0x331ed6(0x14a))),__param(0x5,(0x0,common_1[a133_0x331ed6(0x160)])(sound_gateway_1[a133_0x331ed6(0x195)])),__metadata(a133_0x331ed6(0x14f),[mongoose_2[a133_0x331ed6(0x136)],agenda_service_1[a133_0x331ed6(0x1a9)],upload_service_1[a133_0x331ed6(0x177)],text_to_audio_service_1[a133_0x331ed6(0x145)],streaming_service_1[a133_0x331ed6(0x143)],sound_gateway_1[a133_0x331ed6(0x195)]])],SoundService),exports['SoundService']=SoundService;