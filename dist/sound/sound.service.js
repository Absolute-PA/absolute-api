'use strict';const a133_0x5afe09=a133_0x181a;(function(_0x1590d4,_0x1b4ad2){const _0x52a3c4=a133_0x181a,_0x527a1d=_0x1590d4();while(!![]){try{const _0x469a9b=-parseInt(_0x52a3c4(0x1a1))/0x1+-parseInt(_0x52a3c4(0x1e6))/0x2+parseInt(_0x52a3c4(0x1e5))/0x3*(parseInt(_0x52a3c4(0x1d4))/0x4)+parseInt(_0x52a3c4(0x1c5))/0x5+parseInt(_0x52a3c4(0x1b7))/0x6+parseInt(_0x52a3c4(0x1dc))/0x7*(-parseInt(_0x52a3c4(0x188))/0x8)+parseInt(_0x52a3c4(0x1bd))/0x9*(parseInt(_0x52a3c4(0x187))/0xa);if(_0x469a9b===_0x1b4ad2)break;else _0x527a1d['push'](_0x527a1d['shift']());}catch(_0x3cc3ad){_0x527a1d['push'](_0x527a1d['shift']());}}}(a133_0x6934,0x4f5f3));var __decorate=this&&this[a133_0x5afe09(0x1ad)]||function(_0x2aaeb6,_0x52780b,_0x146971,_0x5cdef1){const _0x283a6f=a133_0x5afe09;var _0x3fc528=arguments[_0x283a6f(0x1c9)],_0x5e9905=_0x3fc528<0x3?_0x52780b:_0x5cdef1===null?_0x5cdef1=Object[_0x283a6f(0x193)](_0x52780b,_0x146971):_0x5cdef1,_0x4ff0a9;if(typeof Reflect===_0x283a6f(0x175)&&typeof Reflect[_0x283a6f(0x1b2)]===_0x283a6f(0x1ba))_0x5e9905=Reflect[_0x283a6f(0x1b2)](_0x2aaeb6,_0x52780b,_0x146971,_0x5cdef1);else{for(var _0xebabb2=_0x2aaeb6[_0x283a6f(0x1c9)]-0x1;_0xebabb2>=0x0;_0xebabb2--)if(_0x4ff0a9=_0x2aaeb6[_0xebabb2])_0x5e9905=(_0x3fc528<0x3?_0x4ff0a9(_0x5e9905):_0x3fc528>0x3?_0x4ff0a9(_0x52780b,_0x146971,_0x5e9905):_0x4ff0a9(_0x52780b,_0x146971))||_0x5e9905;}return _0x3fc528>0x3&&_0x5e9905&&Object[_0x283a6f(0x1c2)](_0x52780b,_0x146971,_0x5e9905),_0x5e9905;},__metadata=this&&this[a133_0x5afe09(0x1b9)]||function(_0x1058eb,_0x23ac57){const _0x31e026=a133_0x5afe09;if(typeof Reflect===_0x31e026(0x175)&&typeof Reflect['metadata']==='function')return Reflect['metadata'](_0x1058eb,_0x23ac57);},__param=this&&this[a133_0x5afe09(0x18e)]||function(_0x38ac64,_0x518495){return function(_0x3f4743,_0x3b233d){_0x518495(_0x3f4743,_0x3b233d,_0x38ac64);};},SoundService_1;function a133_0x6934(){const _0x1cfd9b=['uploadService','./data/default-sounds','@nestjs/mongoose','decorate','InjectModel','stop','textToAudio','create','653898PDWueJ','findByIdAndUpdate','__metadata','function','soundModel','TextToAudioService','9knGYkg','design:returntype','../common/path','findVoiceRecoredById','cancelJob','defineProperty','delete','audio','1973130BpiqEt','OnEvent','executeJob','SoundEvent','length','Logger','resetTunes','now','join','error','split','processRootPath','AUDIO_DIR','Playing\x20sound:\x20','SoundGateway','840CrCTej','Sound','playTextToAudioRecorded','findByIds','SoundService','DEFAULT_TUNES','playStreamAudioAsync','soundGateway','21jTLXFr','broadcastPlaying','TMP_UPLOAD_DIR','Play','File\x20not\x20found!','isFileExist','../common/audio/audio-player','Inject','VoiceRecorded','3417PAfmuy','1236378RWvPph','validateAndMoveFileAsync','AgendaService','exec','design:paramtypes','../common/job','deleteFile','copyFiles','find','Playing\x20voice\x20recorded:\x20','JobType','object','PlaySound','findById','playAsync','getNewFileName','UploadService','Model','all','PROCESS_CACHE','../text-to-audio/text-to-audio.service','../common/utils','../agenda/agenda.service','forEach','pop','prototype','killAll','playVoiceRecorded','Play\x20sound:\x20','9534880ttPpZU','1477016AzwgLw','findByType','play','_id','volume','name','__param','@nestjs/event-emitter','assign','textToAudioService','../common/events/sound','getOwnPropertyDescriptor','cwd','../common/file','findByIdAndDelete','update','createFolder','scheduleJob','Sound\x20not\x20found!','path','findOne','logger','mongoose','StreamingService','push','199110XLpCbH','originalname','log','@nestjs/common','filePath','playSoundOnEvent','save','moveFile','assets','AudioPlayer','./sound.gateway','agendaService','__decorate','fileName'];a133_0x6934=function(){return _0x1cfd9b;};return a133_0x6934();}function a133_0x181a(_0x60a45f,_0x28ffeb){const _0x6934c1=a133_0x6934();return a133_0x181a=function(_0x181a6d,_0x1dafee){_0x181a6d=_0x181a6d-0x16e;let _0x5a0e2d=_0x6934c1[_0x181a6d];return _0x5a0e2d;},a133_0x181a(_0x60a45f,_0x28ffeb);}Object[a133_0x5afe09(0x1c2)](exports,'__esModule',{'value':!![]}),exports[a133_0x5afe09(0x1d8)]=void 0x0;const common_1=require(a133_0x5afe09(0x1a4)),mongoose_1=require(a133_0x5afe09(0x1b1)),mongoose_2=require(a133_0x5afe09(0x19e)),path=require('path'),event_emitter_1=require(a133_0x5afe09(0x18f)),file_1=require(a133_0x5afe09(0x195)),agenda_service_1=require(a133_0x5afe09(0x180)),enums_1=require('../common/enums'),constants_1=require('../common/constants'),utils_1=require(a133_0x5afe09(0x17f)),path_1=require(a133_0x5afe09(0x1bf)),audio_player_1=require(a133_0x5afe09(0x1e2)),sound_1=require(a133_0x5afe09(0x192)),job_1=require(a133_0x5afe09(0x16f)),constants_2=require('./constants'),default_sounds_1=require(a133_0x5afe09(0x1b0)),sound_gateway_1=require(a133_0x5afe09(0x1ab)),path_2=require('path'),upload_service_1=require('../upload/upload.service'),text_to_audio_service_1=require(a133_0x5afe09(0x17e)),streaming_service_1=require('../streaming/streaming.service');let SoundService=SoundService_1=class SoundService{constructor(_0x2511bd,_0x598a88,_0x2cc70b,_0x28a3cf,_0x5b11e2,_0x3e289f){const _0x14a101=a133_0x5afe09;this[_0x14a101(0x1bb)]=_0x2511bd,this[_0x14a101(0x1ac)]=_0x598a88,this[_0x14a101(0x1af)]=_0x2cc70b,this['textToAudioService']=_0x28a3cf,this['streamingService']=_0x5b11e2,this[_0x14a101(0x1db)]=_0x3e289f,this[_0x14a101(0x19d)]=new common_1[(_0x14a101(0x1ca))](SoundService_1[_0x14a101(0x18d)]);}async[a133_0x5afe09(0x1b6)](_0x2580c9){const _0x2fa6ba=a133_0x5afe09;await this[_0x2fa6ba(0x1e7)](_0x2580c9,null);const _0x17847c=new this['soundModel'](_0x2580c9);return _0x17847c[_0x2fa6ba(0x1a7)]();}async[a133_0x5afe09(0x189)](_0x3b8c5c){const _0x72ebf=a133_0x5afe09,_0x1d3a3d=await this[_0x72ebf(0x1bb)][_0x72ebf(0x172)]({'type':_0x3b8c5c})[_0x72ebf(0x1e9)]();return _0x1d3a3d;}async['findOne'](_0x3c1549){const _0x4295f6=a133_0x5afe09,_0x1c31b1=await this[_0x4295f6(0x1bb)][_0x4295f6(0x177)](_0x3c1549);return _0x1c31b1;}async[a133_0x5afe09(0x1d7)](_0x2d0695){const _0x552e39=a133_0x5afe09,_0x581489=await this[_0x552e39(0x1bb)][_0x552e39(0x172)]({'_id':{'$in':_0x2d0695}});return _0x581489;}async[a133_0x5afe09(0x197)](_0x552d08,_0x42c79b){const _0x5ab3d3=a133_0x5afe09,_0x68315e=await this[_0x5ab3d3(0x1bb)][_0x5ab3d3(0x177)](_0x552d08)[_0x5ab3d3(0x1e9)]();if(!_0x68315e)throw new Error(_0x5ab3d3(0x19a));await this['validateAndMoveFileAsync'](_0x42c79b,_0x68315e===null||_0x68315e===void 0x0?void 0x0:_0x68315e[_0x5ab3d3(0x1ae)]);const _0x69caf1=await this['soundModel'][_0x5ab3d3(0x1b8)](_0x552d08,Object['assign'](Object[_0x5ab3d3(0x190)]({},_0x42c79b),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x69caf1;}async['updateVolume'](_0x125f4c,_0x233440){const _0x2be0e9=a133_0x5afe09,_0x2c96bf=await this[_0x2be0e9(0x1bb)][_0x2be0e9(0x177)](_0x125f4c)['exec']();if(!_0x2c96bf)throw new Error(_0x2be0e9(0x19a));const _0x4e58f6=await this[_0x2be0e9(0x1bb)][_0x2be0e9(0x1b8)](_0x125f4c,Object['assign'](Object[_0x2be0e9(0x190)]({},_0x233440),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x4e58f6;}async[a133_0x5afe09(0x1c3)](_0x50d94d){const _0x4bd69b=a133_0x5afe09,_0x546058=await this[_0x4bd69b(0x1bb)][_0x4bd69b(0x196)](_0x50d94d);if(_0x546058[_0x4bd69b(0x1ae)]){const _0x12c2ba=constants_1[_0x4bd69b(0x1d1)]+'/'+_0x546058['fileName'];try{(0x0,file_1[_0x4bd69b(0x170)])(_0x12c2ba);}catch(_0x5956af){this[_0x4bd69b(0x19d)][_0x4bd69b(0x1ce)](_0x5956af);}}return _0x546058;}async['upload'](_0x1ee351,_0x45a613){const _0x267325=a133_0x5afe09,_0x287044=await this[_0x267325(0x1bb)][_0x267325(0x177)](_0x1ee351)[_0x267325(0x1e9)](),_0x365521=_0x287044===null||_0x287044===void 0x0?void 0x0:_0x287044[_0x267325(0x1ae)],_0x534c3d=this[_0x267325(0x179)](_0x45a613[_0x267325(0x1a2)]),_0xa13fe4=constants_1['AUDIO_DIR']+'/'+_0x534c3d;await(0x0,file_1[_0x267325(0x1a8)])(_0x45a613[_0x267325(0x19b)],_0xa13fe4);const _0x2b99e4={'fileName':_0x534c3d},_0x500b48=await this['soundModel'][_0x267325(0x1b8)](_0x1ee351,Object[_0x267325(0x190)](Object['assign']({},_0x2b99e4),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0x365521){const _0x1a3719=constants_1[_0x267325(0x1d1)]+'/'+_0x365521;(0x0,file_1[_0x267325(0x170)])(_0x1a3719);}return _0x500b48;}async[a133_0x5afe09(0x1a6)](_0x2be796){const _0x2bd655=a133_0x5afe09,{soundId:_0x576ef9,jobId:_0x14eed5,durationInSecond:_0x51892c}=_0x2be796,_0x2d6e02=await this[_0x2bd655(0x19c)](_0x576ef9),_0x276703=path[_0x2bd655(0x1cd)](path_1[_0x2bd655(0x1d0)],_0x2bd655(0x1a9),_0x2bd655(0x1c4),_0x2d6e02[_0x2bd655(0x1ae)]);job_1['PROCESS_CACHE']['killAll'](),this[_0x2bd655(0x19d)][_0x2bd655(0x1a3)](_0x2bd655(0x1d2)+_0x576ef9+'\x20-\x20'+_0x2d6e02[_0x2bd655(0x18d)]),(0x0,job_1['executeJob'])({'jobId':_0x14eed5,'run':()=>audio_player_1[_0x2bd655(0x1aa)][_0x2bd655(0x178)](_0x276703,_0x2d6e02[_0x2bd655(0x18c)]),'next':()=>this[_0x2bd655(0x1b4)](_0x576ef9),'durationInSecond':_0x51892c}),this[_0x2bd655(0x1db)][_0x2bd655(0x1dd)]({'id':_0x576ef9,'isPlaying':!![]});}async[a133_0x5afe09(0x185)](_0x59f83f){const _0x27c083=a133_0x5afe09,{voiceId:_0x12100b,jobId:_0x500b00,durationInSecond:_0x23ef71}=_0x59f83f,_0x39a3f4=await this['uploadService'][_0x27c083(0x1c0)](_0x12100b),_0x1262ce=_0x39a3f4[_0x27c083(0x1a5)],_0x2aea8a=(0x0,path_2[_0x27c083(0x1cd)])(process[_0x27c083(0x194)](),_0x1262ce);job_1[_0x27c083(0x17d)][_0x27c083(0x184)](),this[_0x27c083(0x19d)][_0x27c083(0x1a3)](_0x27c083(0x173)+_0x12100b),(0x0,job_1[_0x27c083(0x1c7)])({'jobId':_0x500b00,'run':()=>audio_player_1[_0x27c083(0x1aa)]['playAsync'](_0x2aea8a),'durationInSecond':_0x23ef71,'next':()=>null});}async[a133_0x5afe09(0x1d6)](_0x5cfed4){const _0x1cb0b6=a133_0x5afe09,{textToAudioId:_0x1372cc,jobId:_0x9b6d29,durationInSecond:_0x39e9ab}=_0x5cfed4,{message:_0x106dd6}=await this[_0x1cb0b6(0x191)]['getMessageById'](_0x1372cc);job_1[_0x1cb0b6(0x17d)][_0x1cb0b6(0x184)](),(0x0,job_1['executeJob'])({'jobId':_0x9b6d29,'run':()=>{const _0x1cb524=_0x1cb0b6;let _0x122a8f=null;return this[_0x1cb524(0x191)][_0x1cb524(0x1b5)](_0x106dd6,_0x2a4f53=>{const _0x1cf875=_0x1cb524;_0x122a8f=this['streamingService'][_0x1cf875(0x1da)](_0x2a4f53);}),_0x122a8f;},'durationInSecond':_0x39e9ab,'next':()=>null});}async[a133_0x5afe09(0x18a)](_0x4e7179,_0x3b1967,_0x6cbb16=![]){const _0x3f3877=a133_0x5afe09,_0x1e8085={'when':_0x3f3877(0x1cc),'jobType':enums_1[_0x3f3877(0x174)][_0x3f3877(0x176)],'attributes':{'soundId':_0x3b1967,'durationInSecond':_0x6cbb16?0x15180:undefined},'audit':{'actor':_0x4e7179,'name':enums_1[_0x3f3877(0x174)][_0x3f3877(0x176)],'message':_0x3f3877(0x186)+_0x3b1967}},_0x3ccfe2=await this[_0x3f3877(0x1bb)]['findOne']({'jobId':{'$ne':null}});_0x3ccfe2&&await this[_0x3f3877(0x1b4)](_0x3ccfe2['id']);const {jobId:_0xcfa0ae}=await this[_0x3f3877(0x1ac)][_0x3f3877(0x199)](_0x1e8085);return this[_0x3f3877(0x197)](_0x3b1967,{'jobId':_0xcfa0ae});}async[a133_0x5afe09(0x1b4)](_0x1d8330){const _0x32e1ff=a133_0x5afe09;let _0x5651cf=await this[_0x32e1ff(0x19c)](_0x1d8330);const {jobId:_0x5463a2}=_0x5651cf||{};if(_0x5463a2){const {success:_0x37c9b9}=await this[_0x32e1ff(0x1ac)][_0x32e1ff(0x1c1)](_0x5463a2);_0x37c9b9&&(_0x5651cf=await this[_0x32e1ff(0x197)](_0x1d8330,{'jobId':null}));}return this['soundGateway'][_0x32e1ff(0x1dd)]({'id':_0x5651cf['id'],'isPlaying':![]}),_0x5651cf;}async[a133_0x5afe09(0x1cb)](){const _0xbf80c1=a133_0x5afe09,_0x351f75=await this['findByType'](constants_2['SoundType']['Tune']);if(_0x351f75[_0xbf80c1(0x1c9)]>0x0){const _0x27a8a6=[];_0x351f75['forEach'](_0x1e90bc=>{const _0x344317=_0xbf80c1;_0x27a8a6[_0x344317(0x1a0)](this[_0x344317(0x1c3)](_0x1e90bc[_0x344317(0x18b)]));}),await Promise[_0xbf80c1(0x17c)](_0x27a8a6);}await(0x0,file_1[_0xbf80c1(0x171)])(constants_1['DEFAULT_TUNES_DIR'],constants_1[_0xbf80c1(0x1de)]);const _0x3b3fb8=[];return default_sounds_1[_0xbf80c1(0x1d9)][_0xbf80c1(0x181)](_0x32a2d4=>{const _0x2d2134=_0xbf80c1;_0x3b3fb8[_0x2d2134(0x1a0)](this[_0x2d2134(0x1b6)](Object['assign']({},_0x32a2d4)));}),await Promise[_0xbf80c1(0x17c)](_0x3b3fb8),!![];}[a133_0x5afe09(0x179)](_0x17cee8){const _0x4f1bce=a133_0x5afe09,_0x276884=_0x17cee8[_0x4f1bce(0x1cf)]('.')[_0x4f1bce(0x182)]();return(0x0,utils_1['uuid'])()+'.'+_0x276884;}async[a133_0x5afe09(0x1e7)](_0x1b1866,_0x2e6878){const _0x4e09a4=a133_0x5afe09;if(!_0x1b1866[_0x4e09a4(0x1ae)])return;const _0x3536e8=constants_1['TMP_UPLOAD_DIR']+'/'+_0x1b1866[_0x4e09a4(0x1ae)],_0x367c42=_0x2e6878||this['getNewFileName'](_0x1b1866[_0x4e09a4(0x1ae)]),_0x5d5fde=constants_1[_0x4e09a4(0x1d1)]+'/'+_0x367c42;if(!(0x0,file_1[_0x4e09a4(0x1e1)])(_0x3536e8))throw new Error(_0x4e09a4(0x1e0));!(0x0,file_1[_0x4e09a4(0x1e1)])(constants_1[_0x4e09a4(0x1d1)])&&(0x0,file_1[_0x4e09a4(0x198)])(constants_1[_0x4e09a4(0x1d1)]),await(0x0,file_1[_0x4e09a4(0x1a8)])(_0x3536e8,_0x5d5fde),_0x1b1866['fileName']=_0x367c42;}};__decorate([(0x0,event_emitter_1[a133_0x5afe09(0x1c6)])(sound_1['SoundEvent'][a133_0x5afe09(0x1df)]),__metadata('design:type',Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],SoundService[a133_0x5afe09(0x183)],a133_0x5afe09(0x1a6),null),__decorate([(0x0,event_emitter_1[a133_0x5afe09(0x1c6)])(sound_1[a133_0x5afe09(0x1c8)][a133_0x5afe09(0x1e4)]),__metadata('design:type',Function),__metadata(a133_0x5afe09(0x16e),[Object]),__metadata(a133_0x5afe09(0x1be),Promise)],SoundService[a133_0x5afe09(0x183)],a133_0x5afe09(0x185),null),__decorate([(0x0,event_emitter_1[a133_0x5afe09(0x1c6)])(sound_1['SoundEvent']['TextToAudio']),__metadata('design:type',Function),__metadata(a133_0x5afe09(0x16e),[Object]),__metadata(a133_0x5afe09(0x1be),Promise)],SoundService[a133_0x5afe09(0x183)],a133_0x5afe09(0x1d6),null),SoundService=SoundService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_1[a133_0x5afe09(0x1b3)])(a133_0x5afe09(0x1d5))),__param(0x5,(0x0,common_1[a133_0x5afe09(0x1e3)])(sound_gateway_1[a133_0x5afe09(0x1d3)])),__metadata('design:paramtypes',[mongoose_2[a133_0x5afe09(0x17b)],agenda_service_1[a133_0x5afe09(0x1e8)],upload_service_1[a133_0x5afe09(0x17a)],text_to_audio_service_1[a133_0x5afe09(0x1bc)],streaming_service_1[a133_0x5afe09(0x19f)],sound_gateway_1['SoundGateway']])],SoundService),exports['SoundService']=SoundService;