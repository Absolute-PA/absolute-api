'use strict';const a133_0x5bcd2d=a133_0x3f74;(function(_0x300cbc,_0x4cca86){const _0x1594ae=a133_0x3f74,_0x418044=_0x300cbc();while(!![]){try{const _0x40433b=parseInt(_0x1594ae(0x19a))/0x1+-parseInt(_0x1594ae(0x1b8))/0x2*(parseInt(_0x1594ae(0x18c))/0x3)+-parseInt(_0x1594ae(0x168))/0x4+parseInt(_0x1594ae(0x196))/0x5*(parseInt(_0x1594ae(0x1cb))/0x6)+-parseInt(_0x1594ae(0x154))/0x7*(parseInt(_0x1594ae(0x1ba))/0x8)+-parseInt(_0x1594ae(0x1a7))/0x9+-parseInt(_0x1594ae(0x190))/0xa*(-parseInt(_0x1594ae(0x1ab))/0xb);if(_0x40433b===_0x4cca86)break;else _0x418044['push'](_0x418044['shift']());}catch(_0x25bd17){_0x418044['push'](_0x418044['shift']());}}}(a133_0x543f,0x4e584));function a133_0x3f74(_0x50e2c2,_0x421f05){const _0x543f59=a133_0x543f();return a133_0x3f74=function(_0x3f7491,_0x21ade5){_0x3f7491=_0x3f7491-0x154;let _0x31f818=_0x543f59[_0x3f7491];return _0x31f818;},a133_0x3f74(_0x50e2c2,_0x421f05);}var __decorate=this&&this[a133_0x5bcd2d(0x198)]||function(_0x55f10a,_0x5f417a,_0x5052fd,_0x55c01a){const _0x422066=a133_0x5bcd2d;var _0x2cd56e=arguments[_0x422066(0x1b9)],_0x1eebce=_0x2cd56e<0x3?_0x5f417a:_0x55c01a===null?_0x55c01a=Object[_0x422066(0x193)](_0x5f417a,_0x5052fd):_0x55c01a,_0x4be616;if(typeof Reflect===_0x422066(0x1bb)&&typeof Reflect[_0x422066(0x18a)]==='function')_0x1eebce=Reflect['decorate'](_0x55f10a,_0x5f417a,_0x5052fd,_0x55c01a);else{for(var _0x13600f=_0x55f10a['length']-0x1;_0x13600f>=0x0;_0x13600f--)if(_0x4be616=_0x55f10a[_0x13600f])_0x1eebce=(_0x2cd56e<0x3?_0x4be616(_0x1eebce):_0x2cd56e>0x3?_0x4be616(_0x5f417a,_0x5052fd,_0x1eebce):_0x4be616(_0x5f417a,_0x5052fd))||_0x1eebce;}return _0x2cd56e>0x3&&_0x1eebce&&Object[_0x422066(0x17f)](_0x5f417a,_0x5052fd,_0x1eebce),_0x1eebce;},__metadata=this&&this[a133_0x5bcd2d(0x1c9)]||function(_0x11f1ba,_0x52b6c1){const _0x978b19=a133_0x5bcd2d;if(typeof Reflect===_0x978b19(0x1bb)&&typeof Reflect[_0x978b19(0x18e)]===_0x978b19(0x1b0))return Reflect[_0x978b19(0x18e)](_0x11f1ba,_0x52b6c1);},__param=this&&this[a133_0x5bcd2d(0x176)]||function(_0x249371,_0x34d169){return function(_0x46e8a3,_0x5ed808){_0x34d169(_0x46e8a3,_0x5ed808,_0x249371);};},SoundService_1;function a133_0x543f(){const _0x1e6f2e=['now','find','../common/constants','SoundType','618174kbDVUu','update','join','filePath','11VGtYNa','./data/default-sounds','VoiceRecorded','Play\x20sound:\x20','soundModel','function','findOne','name','__esModule','AUDIO_DIR','PROCESS_CACHE','JobType','assets','607918AllNGQ','length','16AcxXql','object','agendaService','prototype','uploadService','executeJob','../common/audio/audio-player','originalname','DEFAULT_TUNES_DIR','playAsync','error','fileName','createFolder','design:paramtypes','../common/path','__metadata','assign','12MQxjKE','playStreamAudioAsync','SoundGateway','1787947OVDFVe','DEFAULT_TUNES','../common/utils','uuid','playVoiceRecorded','processRootPath','path','cwd','delete','isFileExist','scheduleJob','updateVolume','\x20-\x20','../common/enums','cancelJob','OnEvent','soundGateway','../common/job','all','UploadService','1377612BfXRmV','design:type','create','SoundService','moveFile','Tune','forEach','findByIdAndDelete','findByIds','../upload/upload.service','findVoiceRecoredById','Playing\x20voice\x20recorded:\x20','streamingService','PlaySound','__param','getNewFileName','pop','AudioPlayer','Inject','logger','findById','Injectable','Playing\x20sound:\x20','defineProperty','../streaming/streaming.service','resetTunes','../text-to-audio/text-to-audio.service','@nestjs/mongoose','findByType','design:returntype','AgendaService','TMP_UPLOAD_DIR','TextToAudioService','TextToAudio','decorate','deleteFile','3xHvbHE','textToAudioService','metadata','SoundEvent','9047330ElCgHx','playSoundOnEvent','playTextToAudioRecorded','getOwnPropertyDescriptor','push','validateAndMoveFileAsync','969555Ohhwgi','stop','__decorate','broadcastPlaying','256235seVPwA','exec','../common/events/sound','copyFiles','@nestjs/common','../common/file','findByIdAndUpdate','killAll','File\x20not\x20found!'];a133_0x543f=function(){return _0x1e6f2e;};return a133_0x543f();}Object[a133_0x5bcd2d(0x17f)](exports,a133_0x5bcd2d(0x1b3),{'value':!![]}),exports[a133_0x5bcd2d(0x16b)]=void 0x0;const common_1=require(a133_0x5bcd2d(0x19e)),mongoose_1=require(a133_0x5bcd2d(0x183)),mongoose_2=require('mongoose'),path=require('path'),event_emitter_1=require('@nestjs/event-emitter'),file_1=require(a133_0x5bcd2d(0x19f)),agenda_service_1=require('../agenda/agenda.service'),enums_1=require(a133_0x5bcd2d(0x161)),constants_1=require(a133_0x5bcd2d(0x1a5)),utils_1=require(a133_0x5bcd2d(0x156)),path_1=require(a133_0x5bcd2d(0x1c8)),audio_player_1=require(a133_0x5bcd2d(0x1c0)),sound_1=require(a133_0x5bcd2d(0x19c)),job_1=require(a133_0x5bcd2d(0x165)),constants_2=require('./constants'),default_sounds_1=require(a133_0x5bcd2d(0x1ac)),sound_gateway_1=require('./sound.gateway'),path_2=require(a133_0x5bcd2d(0x15a)),upload_service_1=require(a133_0x5bcd2d(0x171)),text_to_audio_service_1=require(a133_0x5bcd2d(0x182)),streaming_service_1=require(a133_0x5bcd2d(0x180));let SoundService=SoundService_1=class SoundService{constructor(_0x3b481a,_0x224ad9,_0x1e3873,_0x5d3bdf,_0xb66ac4,_0x2be1e0){const _0x27cea0=a133_0x5bcd2d;this[_0x27cea0(0x1af)]=_0x3b481a,this['agendaService']=_0x224ad9,this[_0x27cea0(0x1be)]=_0x1e3873,this[_0x27cea0(0x18d)]=_0x5d3bdf,this[_0x27cea0(0x174)]=_0xb66ac4,this['soundGateway']=_0x2be1e0,this['logger']=new common_1['Logger'](SoundService_1[_0x27cea0(0x1b2)]);}async[a133_0x5bcd2d(0x16a)](_0x2021e9){const _0xac24da=a133_0x5bcd2d;await this['validateAndMoveFileAsync'](_0x2021e9,null);const _0x264e80=new this[(_0xac24da(0x1af))](_0x2021e9);return _0x264e80['save']();}async[a133_0x5bcd2d(0x184)](_0x261398){const _0x25cbab=a133_0x5bcd2d,_0x56cafe=await this[_0x25cbab(0x1af)][_0x25cbab(0x1a4)]({'type':_0x261398})['exec']();return _0x56cafe;}async[a133_0x5bcd2d(0x1b1)](_0x337285){const _0xc77d77=a133_0x5bcd2d,_0x5050ad=await this['soundModel'][_0xc77d77(0x17c)](_0x337285);return _0x5050ad;}async[a133_0x5bcd2d(0x170)](_0x4d314c){const _0xab9c75=a133_0x5bcd2d,_0x42df23=await this['soundModel'][_0xab9c75(0x1a4)]({'_id':{'$in':_0x4d314c}});return _0x42df23;}async[a133_0x5bcd2d(0x1a8)](_0x581010,_0x36b3d2){const _0x1e3e8c=a133_0x5bcd2d,_0x1cc51=await this[_0x1e3e8c(0x1af)][_0x1e3e8c(0x17c)](_0x581010)[_0x1e3e8c(0x19b)]();if(!_0x1cc51)throw new Error('Sound\x20not\x20found!');await this[_0x1e3e8c(0x195)](_0x36b3d2,_0x1cc51===null||_0x1cc51===void 0x0?void 0x0:_0x1cc51[_0x1e3e8c(0x1c5)]);const _0x3b9aeb=await this[_0x1e3e8c(0x1af)][_0x1e3e8c(0x1a0)](_0x581010,Object['assign'](Object['assign']({},_0x36b3d2),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x3b9aeb;}async[a133_0x5bcd2d(0x15f)](_0xb8f60b,_0x494555){const _0x538ac8=a133_0x5bcd2d,_0x27cc66=await this[_0x538ac8(0x1af)]['findById'](_0xb8f60b)[_0x538ac8(0x19b)]();if(!_0x27cc66)throw new Error('Sound\x20not\x20found!');const _0x2a1137=await this[_0x538ac8(0x1af)]['findByIdAndUpdate'](_0xb8f60b,Object[_0x538ac8(0x1ca)](Object[_0x538ac8(0x1ca)]({},_0x494555),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x2a1137;}async['delete'](_0x23b581){const _0x143870=a133_0x5bcd2d,_0x1c2c16=await this[_0x143870(0x1af)][_0x143870(0x16f)](_0x23b581);if(_0x1c2c16['fileName']){const _0x16c0a1=constants_1[_0x143870(0x1b4)]+'/'+_0x1c2c16[_0x143870(0x1c5)];try{(0x0,file_1[_0x143870(0x18b)])(_0x16c0a1);}catch(_0x22c2f4){this[_0x143870(0x17b)][_0x143870(0x1c4)](_0x22c2f4);}}return _0x1c2c16;}async['upload'](_0x2d7eb0,_0x197af8){const _0x3a645e=a133_0x5bcd2d,_0x357899=await this[_0x3a645e(0x1af)][_0x3a645e(0x17c)](_0x2d7eb0)[_0x3a645e(0x19b)](),_0x146bef=_0x357899===null||_0x357899===void 0x0?void 0x0:_0x357899['fileName'],_0x1af228=this[_0x3a645e(0x177)](_0x197af8[_0x3a645e(0x1c1)]),_0x211483=constants_1['AUDIO_DIR']+'/'+_0x1af228;await(0x0,file_1[_0x3a645e(0x16c)])(_0x197af8[_0x3a645e(0x15a)],_0x211483);const _0x11e13e={'fileName':_0x1af228},_0x18a28c=await this['soundModel'][_0x3a645e(0x1a0)](_0x2d7eb0,Object[_0x3a645e(0x1ca)](Object[_0x3a645e(0x1ca)]({},_0x11e13e),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0x146bef){const _0x5f55eb=constants_1[_0x3a645e(0x1b4)]+'/'+_0x146bef;(0x0,file_1['deleteFile'])(_0x5f55eb);}return _0x18a28c;}async[a133_0x5bcd2d(0x191)](_0x10d082){const _0x430809=a133_0x5bcd2d,{soundId:_0x8c2598,jobId:_0xe3c222,durationInSecond:_0x1391c5}=_0x10d082,_0x5cd79b=await this[_0x430809(0x1b1)](_0x8c2598),_0x2772cf=path[_0x430809(0x1a9)](path_1[_0x430809(0x159)],_0x430809(0x1b7),'audio',_0x5cd79b[_0x430809(0x1c5)]);job_1['PROCESS_CACHE'][_0x430809(0x1a1)](),this[_0x430809(0x17b)]['log'](_0x430809(0x17e)+_0x8c2598+_0x430809(0x160)+_0x5cd79b[_0x430809(0x1b2)]),(0x0,job_1['executeJob'])({'jobId':_0xe3c222,'run':()=>audio_player_1[_0x430809(0x179)][_0x430809(0x1c3)](_0x2772cf,_0x5cd79b['volume']),'next':()=>this['stop'](_0x8c2598),'durationInSecond':_0x1391c5}),this[_0x430809(0x164)]['broadcastPlaying']({'id':_0x8c2598,'isPlaying':!![]});}async[a133_0x5bcd2d(0x158)](_0x440647){const _0x1ff48=a133_0x5bcd2d,{voiceId:_0x46a6ac,jobId:_0x57212b,durationInSecond:_0x2d4798}=_0x440647,_0x54cef4=await this[_0x1ff48(0x1be)][_0x1ff48(0x172)](_0x46a6ac),_0x410cb6=_0x54cef4[_0x1ff48(0x1aa)],_0x16ea06=(0x0,path_2['join'])(process[_0x1ff48(0x15b)](),_0x410cb6);job_1[_0x1ff48(0x1b5)][_0x1ff48(0x1a1)](),this[_0x1ff48(0x17b)]['log'](_0x1ff48(0x173)+_0x46a6ac),(0x0,job_1[_0x1ff48(0x1bf)])({'jobId':_0x57212b,'run':()=>audio_player_1[_0x1ff48(0x179)][_0x1ff48(0x1c3)](_0x16ea06),'durationInSecond':_0x2d4798,'next':()=>null});}async[a133_0x5bcd2d(0x192)](_0x3b90e3){const _0x8edb60=a133_0x5bcd2d,{textToAudioId:_0x4e8af7,jobId:_0x4edfe5,durationInSecond:_0x2b6082}=_0x3b90e3,{message:_0x280721}=await this[_0x8edb60(0x18d)]['getMessageById'](_0x4e8af7);job_1[_0x8edb60(0x1b5)][_0x8edb60(0x1a1)](),(0x0,job_1[_0x8edb60(0x1bf)])({'jobId':_0x4edfe5,'run':()=>{let _0x271e07=null;return this['textToAudioService']['textToAudio'](_0x280721,_0x485230=>{const _0x262932=a133_0x3f74;_0x271e07=this[_0x262932(0x174)][_0x262932(0x1cc)](_0x485230);}),_0x271e07;},'durationInSecond':_0x2b6082,'next':()=>null});}async['play'](_0x3d3cb3,_0x41d965,_0x171b4b=![]){const _0x38f416=a133_0x5bcd2d,_0x4a3b45={'when':_0x38f416(0x1a3),'jobType':enums_1[_0x38f416(0x1b6)][_0x38f416(0x175)],'attributes':{'soundId':_0x41d965,'durationInSecond':_0x171b4b?0x15180:undefined},'audit':{'actor':_0x3d3cb3,'name':enums_1['JobType'][_0x38f416(0x175)],'message':_0x38f416(0x1ae)+_0x41d965}},_0x459247=await this[_0x38f416(0x1af)]['findOne']({'jobId':{'$ne':null}});_0x459247&&await this[_0x38f416(0x197)](_0x459247['id']);const {jobId:_0x4e36e7}=await this[_0x38f416(0x1bc)][_0x38f416(0x15e)](_0x4a3b45);return this[_0x38f416(0x1a8)](_0x41d965,{'jobId':_0x4e36e7});}async[a133_0x5bcd2d(0x197)](_0x5aee3c){const _0x56b5c5=a133_0x5bcd2d;let _0x3b8441=await this[_0x56b5c5(0x1b1)](_0x5aee3c);const {jobId:_0x589b1c}=_0x3b8441||{};if(_0x589b1c){const {success:_0x5c3eb4}=await this[_0x56b5c5(0x1bc)][_0x56b5c5(0x162)](_0x589b1c);_0x5c3eb4&&(_0x3b8441=await this[_0x56b5c5(0x1a8)](_0x5aee3c,{'jobId':null}));}return this['soundGateway'][_0x56b5c5(0x199)]({'id':_0x3b8441['id'],'isPlaying':![]}),_0x3b8441;}async[a133_0x5bcd2d(0x181)](){const _0x56d05b=a133_0x5bcd2d,_0x3c8eaa=await this['findByType'](constants_2[_0x56d05b(0x1a6)][_0x56d05b(0x16d)]);if(_0x3c8eaa[_0x56d05b(0x1b9)]>0x0){const _0x5cf1a7=[];_0x3c8eaa[_0x56d05b(0x16e)](_0x2a3682=>{const _0xbba51e=_0x56d05b;_0x5cf1a7[_0xbba51e(0x194)](this[_0xbba51e(0x15c)](_0x2a3682['_id']));}),await Promise[_0x56d05b(0x166)](_0x5cf1a7);}await(0x0,file_1[_0x56d05b(0x19d)])(constants_1[_0x56d05b(0x1c2)],constants_1[_0x56d05b(0x187)]);const _0xbc7acc=[];return default_sounds_1[_0x56d05b(0x155)][_0x56d05b(0x16e)](_0x1429f9=>{const _0x6e668=_0x56d05b;_0xbc7acc[_0x6e668(0x194)](this[_0x6e668(0x16a)](Object[_0x6e668(0x1ca)]({},_0x1429f9)));}),await Promise[_0x56d05b(0x166)](_0xbc7acc),!![];}[a133_0x5bcd2d(0x177)](_0x20bb68){const _0x6dbcae=a133_0x5bcd2d,_0x568d1e=_0x20bb68['split']('.')[_0x6dbcae(0x178)]();return(0x0,utils_1[_0x6dbcae(0x157)])()+'.'+_0x568d1e;}async[a133_0x5bcd2d(0x195)](_0x4b9e20,_0x2f8ad7){const _0xead6d5=a133_0x5bcd2d;if(!_0x4b9e20[_0xead6d5(0x1c5)])return;const _0x248cd5=constants_1[_0xead6d5(0x187)]+'/'+_0x4b9e20[_0xead6d5(0x1c5)],_0x21368e=_0x2f8ad7||this['getNewFileName'](_0x4b9e20['fileName']),_0x84d9c5=constants_1[_0xead6d5(0x1b4)]+'/'+_0x21368e;if(!(0x0,file_1[_0xead6d5(0x15d)])(_0x248cd5))throw new Error(_0xead6d5(0x1a2));!(0x0,file_1[_0xead6d5(0x15d)])(constants_1['AUDIO_DIR'])&&(0x0,file_1[_0xead6d5(0x1c6)])(constants_1['AUDIO_DIR']),await(0x0,file_1[_0xead6d5(0x16c)])(_0x248cd5,_0x84d9c5),_0x4b9e20[_0xead6d5(0x1c5)]=_0x21368e;}};__decorate([(0x0,event_emitter_1[a133_0x5bcd2d(0x163)])(sound_1['SoundEvent']['Play']),__metadata(a133_0x5bcd2d(0x169),Function),__metadata(a133_0x5bcd2d(0x1c7),[Object]),__metadata('design:returntype',Promise)],SoundService['prototype'],a133_0x5bcd2d(0x191),null),__decorate([(0x0,event_emitter_1[a133_0x5bcd2d(0x163)])(sound_1[a133_0x5bcd2d(0x18f)][a133_0x5bcd2d(0x1ad)]),__metadata(a133_0x5bcd2d(0x169),Function),__metadata(a133_0x5bcd2d(0x1c7),[Object]),__metadata(a133_0x5bcd2d(0x185),Promise)],SoundService[a133_0x5bcd2d(0x1bd)],a133_0x5bcd2d(0x158),null),__decorate([(0x0,event_emitter_1['OnEvent'])(sound_1['SoundEvent'][a133_0x5bcd2d(0x189)]),__metadata('design:type',Function),__metadata(a133_0x5bcd2d(0x1c7),[Object]),__metadata('design:returntype',Promise)],SoundService[a133_0x5bcd2d(0x1bd)],a133_0x5bcd2d(0x192),null),SoundService=SoundService_1=__decorate([(0x0,common_1[a133_0x5bcd2d(0x17d)])(),__param(0x0,(0x0,mongoose_1['InjectModel'])('Sound')),__param(0x5,(0x0,common_1[a133_0x5bcd2d(0x17a)])(sound_gateway_1[a133_0x5bcd2d(0x1cd)])),__metadata(a133_0x5bcd2d(0x1c7),[mongoose_2['Model'],agenda_service_1[a133_0x5bcd2d(0x186)],upload_service_1[a133_0x5bcd2d(0x167)],text_to_audio_service_1[a133_0x5bcd2d(0x188)],streaming_service_1['StreamingService'],sound_gateway_1[a133_0x5bcd2d(0x1cd)]])],SoundService),exports['SoundService']=SoundService;