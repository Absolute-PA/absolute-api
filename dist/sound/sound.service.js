'use strict';const a133_0x5c850a=a133_0x5ac7;(function(_0x2a23dd,_0x4a0c69){const _0x5ce329=a133_0x5ac7,_0x500e62=_0x2a23dd();while(!![]){try{const _0x379560=-parseInt(_0x5ce329(0x18b))/0x1*(parseInt(_0x5ce329(0x142))/0x2)+-parseInt(_0x5ce329(0x133))/0x3*(-parseInt(_0x5ce329(0x170))/0x4)+-parseInt(_0x5ce329(0x155))/0x5+parseInt(_0x5ce329(0x151))/0x6+-parseInt(_0x5ce329(0x130))/0x7*(parseInt(_0x5ce329(0x17d))/0x8)+parseInt(_0x5ce329(0x169))/0x9+-parseInt(_0x5ce329(0x150))/0xa*(parseInt(_0x5ce329(0x14c))/0xb);if(_0x379560===_0x4a0c69)break;else _0x500e62['push'](_0x500e62['shift']());}catch(_0x3ef3c1){_0x500e62['push'](_0x500e62['shift']());}}}(a133_0x2ad3,0x52552));function a133_0x5ac7(_0x339ce0,_0x3280e7){const _0x2ad3cb=a133_0x2ad3();return a133_0x5ac7=function(_0x5ac72a,_0x183b66){_0x5ac72a=_0x5ac72a-0x126;let _0xf6a9bb=_0x2ad3cb[_0x5ac72a];return _0xf6a9bb;},a133_0x5ac7(_0x339ce0,_0x3280e7);}function a133_0x2ad3(){const _0x25db82=['moveFile','Logger','StreamingService','Injectable','10844DVJdSh','PROCESS_CACHE','Sound\x20not\x20found!','defineProperty','./constants','filePath','isFileExist','mongoose','../agenda/agenda.service','cancelJob','decorate','originalname','executeJob','1240cAMbmi','textToAudioService','JobType','design:returntype','_id','copyFiles','findByIds','path','AUDIO_DIR','findById','object','killAll','PlaySound','exec','15jxHKNr','name','resetTunes','findByIdAndUpdate','getMessageById','__param','AgendaService','create','deleteFile','../common/utils','validateAndMoveFileAsync','assign','../common/constants','audio','forEach','../common/file','UploadService','DEFAULT_TUNES_DIR','volume','split','design:type','streamingService','playSoundOnEvent','soundModel','\x20-\x20','stop','Play\x20sound:\x20','find','10913RKzcRR','Sound','assets','177YWuBWJ','TextToAudioService','__decorate','playVoiceRecorded','File\x20not\x20found!','soundGateway','findByType','Inject','./sound.gateway','OnEvent','./data/default-sounds','SoundService','design:paramtypes','join','VoiceRecorded','50494SuvCRZ','pop','createFolder','length','agendaService','TMP_UPLOAD_DIR','Playing\x20sound:\x20','../common/path','logger','metadata','11sfJgPn','DEFAULT_TUNES','findOne','AudioPlayer','958570aiLOes','3557478aBBLZo','playTextToAudioRecorded','SoundEvent','processRootPath','1450190eNFuzq','SoundGateway','Model','playAsync','@nestjs/mongoose','getOwnPropertyDescriptor','broadcastPlaying','getNewFileName','Tune','error','play','fileName','update','TextToAudio','now','save','../streaming/streaming.service','function','scheduleJob','InjectModel','5315553kFSinH','delete','uploadService'];a133_0x2ad3=function(){return _0x25db82;};return a133_0x2ad3();}var __decorate=this&&this[a133_0x5c850a(0x135)]||function(_0x30c4cd,_0xb36a66,_0x7a306,_0x98431a){const _0x5647de=a133_0x5c850a;var _0x59983c=arguments[_0x5647de(0x145)],_0x5c8c15=_0x59983c<0x3?_0xb36a66:_0x98431a===null?_0x98431a=Object[_0x5647de(0x15a)](_0xb36a66,_0x7a306):_0x98431a,_0x4234e7;if(typeof Reflect===_0x5647de(0x187)&&typeof Reflect[_0x5647de(0x17a)]===_0x5647de(0x166))_0x5c8c15=Reflect['decorate'](_0x30c4cd,_0xb36a66,_0x7a306,_0x98431a);else{for(var _0x2f658a=_0x30c4cd[_0x5647de(0x145)]-0x1;_0x2f658a>=0x0;_0x2f658a--)if(_0x4234e7=_0x30c4cd[_0x2f658a])_0x5c8c15=(_0x59983c<0x3?_0x4234e7(_0x5c8c15):_0x59983c>0x3?_0x4234e7(_0xb36a66,_0x7a306,_0x5c8c15):_0x4234e7(_0xb36a66,_0x7a306))||_0x5c8c15;}return _0x59983c>0x3&&_0x5c8c15&&Object[_0x5647de(0x173)](_0xb36a66,_0x7a306,_0x5c8c15),_0x5c8c15;},__metadata=this&&this['__metadata']||function(_0x3b01a6,_0x423061){const _0x5376d5=a133_0x5c850a;if(typeof Reflect==='object'&&typeof Reflect[_0x5376d5(0x14b)]===_0x5376d5(0x166))return Reflect[_0x5376d5(0x14b)](_0x3b01a6,_0x423061);},__param=this&&this[a133_0x5c850a(0x190)]||function(_0x2f2cd2,_0x4bb8fc){return function(_0x4ba772,_0x4eae1d){_0x4bb8fc(_0x4ba772,_0x4eae1d,_0x2f2cd2);};},SoundService_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['SoundService']=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a133_0x5c850a(0x159)),mongoose_2=require(a133_0x5c850a(0x177)),path=require('path'),event_emitter_1=require('@nestjs/event-emitter'),file_1=require(a133_0x5c850a(0x19a)),agenda_service_1=require(a133_0x5c850a(0x178)),enums_1=require('../common/enums'),constants_1=require(a133_0x5c850a(0x197)),utils_1=require(a133_0x5c850a(0x194)),path_1=require(a133_0x5c850a(0x149)),audio_player_1=require('../common/audio/audio-player'),sound_1=require('../common/events/sound'),job_1=require('../common/job'),constants_2=require(a133_0x5c850a(0x174)),default_sounds_1=require(a133_0x5c850a(0x13d)),sound_gateway_1=require(a133_0x5c850a(0x13b)),path_2=require(a133_0x5c850a(0x184)),upload_service_1=require('../upload/upload.service'),text_to_audio_service_1=require('../text-to-audio/text-to-audio.service'),streaming_service_1=require(a133_0x5c850a(0x165));let SoundService=SoundService_1=class SoundService{constructor(_0x29565c,_0xecf163,_0x55f0b5,_0x10fd8f,_0x1834b4,_0x535abc){const _0x4cf147=a133_0x5c850a;this[_0x4cf147(0x12b)]=_0x29565c,this[_0x4cf147(0x146)]=_0xecf163,this[_0x4cf147(0x16b)]=_0x55f0b5,this[_0x4cf147(0x17e)]=_0x10fd8f,this['streamingService']=_0x1834b4,this['soundGateway']=_0x535abc,this[_0x4cf147(0x14a)]=new common_1[(_0x4cf147(0x16d))](SoundService_1[_0x4cf147(0x18c)]);}async[a133_0x5c850a(0x192)](_0x29ab2d){const _0xd87dc=a133_0x5c850a;await this[_0xd87dc(0x195)](_0x29ab2d,null);const _0x5d7512=new this[(_0xd87dc(0x12b))](_0x29ab2d);return _0x5d7512[_0xd87dc(0x164)]();}async['findByType'](_0x49ac1b){const _0x49252f=a133_0x5c850a,_0x2b0cfa=await this[_0x49252f(0x12b)][_0x49252f(0x12f)]({'type':_0x49ac1b})[_0x49252f(0x18a)]();return _0x2b0cfa;}async[a133_0x5c850a(0x14e)](_0x246cd7){const _0x515663=a133_0x5c850a,_0x31ab40=await this['soundModel'][_0x515663(0x186)](_0x246cd7);return _0x31ab40;}async[a133_0x5c850a(0x183)](_0x50333d){const _0x18df0a=a133_0x5c850a,_0x47e31d=await this[_0x18df0a(0x12b)][_0x18df0a(0x12f)]({'_id':{'$in':_0x50333d}});return _0x47e31d;}async['update'](_0x554400,_0x442702){const _0x14cddf=a133_0x5c850a,_0x363bed=await this[_0x14cddf(0x12b)][_0x14cddf(0x186)](_0x554400)[_0x14cddf(0x18a)]();if(!_0x363bed)throw new Error('Sound\x20not\x20found!');await this[_0x14cddf(0x195)](_0x442702,_0x363bed===null||_0x363bed===void 0x0?void 0x0:_0x363bed[_0x14cddf(0x160)]);const _0x37831a=await this[_0x14cddf(0x12b)][_0x14cddf(0x18e)](_0x554400,Object[_0x14cddf(0x196)](Object[_0x14cddf(0x196)]({},_0x442702),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x37831a;}async['updateVolume'](_0x28d239,_0x3ce27f){const _0x32f335=a133_0x5c850a,_0x5b61aa=await this[_0x32f335(0x12b)][_0x32f335(0x186)](_0x28d239)[_0x32f335(0x18a)]();if(!_0x5b61aa)throw new Error(_0x32f335(0x172));const _0x38ff29=await this['soundModel']['findByIdAndUpdate'](_0x28d239,Object['assign'](Object[_0x32f335(0x196)]({},_0x3ce27f),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x38ff29;}async[a133_0x5c850a(0x16a)](_0x5ae3e6){const _0x2f3716=a133_0x5c850a,_0x1f92a9=await this[_0x2f3716(0x12b)]['findByIdAndDelete'](_0x5ae3e6);if(_0x1f92a9[_0x2f3716(0x160)]){const _0x56a065=constants_1['AUDIO_DIR']+'/'+_0x1f92a9[_0x2f3716(0x160)];try{(0x0,file_1[_0x2f3716(0x193)])(_0x56a065);}catch(_0x2d823d){this[_0x2f3716(0x14a)][_0x2f3716(0x15e)](_0x2d823d);}}return _0x1f92a9;}async['upload'](_0x470bf4,_0x5ba0e6){const _0x4ce64b=a133_0x5c850a,_0xf86775=await this[_0x4ce64b(0x12b)][_0x4ce64b(0x186)](_0x470bf4)[_0x4ce64b(0x18a)](),_0x20b52a=_0xf86775===null||_0xf86775===void 0x0?void 0x0:_0xf86775[_0x4ce64b(0x160)],_0x5a8acf=this[_0x4ce64b(0x15c)](_0x5ba0e6[_0x4ce64b(0x17b)]),_0x1d803d=constants_1[_0x4ce64b(0x185)]+'/'+_0x5a8acf;await(0x0,file_1['moveFile'])(_0x5ba0e6[_0x4ce64b(0x184)],_0x1d803d);const _0x52e8f2={'fileName':_0x5a8acf},_0x846ecc=await this['soundModel'][_0x4ce64b(0x18e)](_0x470bf4,Object[_0x4ce64b(0x196)](Object['assign']({},_0x52e8f2),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0x20b52a){const _0x460790=constants_1['AUDIO_DIR']+'/'+_0x20b52a;(0x0,file_1['deleteFile'])(_0x460790);}return _0x846ecc;}async[a133_0x5c850a(0x12a)](_0x39776b){const _0x2ead4d=a133_0x5c850a,{soundId:_0x5bdf7c,jobId:_0xaffcd9,durationInSecond:_0x14fd10}=_0x39776b,_0x52f8dc=await this[_0x2ead4d(0x14e)](_0x5bdf7c),_0x1c0fa=path[_0x2ead4d(0x140)](path_1[_0x2ead4d(0x154)],_0x2ead4d(0x132),_0x2ead4d(0x198),_0x52f8dc[_0x2ead4d(0x160)]);job_1[_0x2ead4d(0x171)][_0x2ead4d(0x188)](),this[_0x2ead4d(0x14a)]['log'](_0x2ead4d(0x148)+_0x5bdf7c+_0x2ead4d(0x12c)+_0x52f8dc['name']),(0x0,job_1[_0x2ead4d(0x17c)])({'jobId':_0xaffcd9,'run':()=>audio_player_1['AudioPlayer'][_0x2ead4d(0x158)](_0x1c0fa,_0x52f8dc[_0x2ead4d(0x126)]),'next':()=>this[_0x2ead4d(0x12d)](_0x5bdf7c),'durationInSecond':_0x14fd10}),this['soundGateway']['broadcastPlaying']({'id':_0x5bdf7c,'isPlaying':!![]});}async[a133_0x5c850a(0x136)](_0x32be51){const _0x49d0a3=a133_0x5c850a,{voiceId:_0x543d07,jobId:_0x3d1da3,durationInSecond:_0x44da95}=_0x32be51,_0x11c2c0=await this['uploadService']['findVoiceRecoredById'](_0x543d07),_0x427d68=_0x11c2c0[_0x49d0a3(0x175)],_0x192583=(0x0,path_2[_0x49d0a3(0x140)])(process['cwd'](),_0x427d68);job_1[_0x49d0a3(0x171)][_0x49d0a3(0x188)](),this[_0x49d0a3(0x14a)]['log']('Playing\x20voice\x20recorded:\x20'+_0x543d07),(0x0,job_1[_0x49d0a3(0x17c)])({'jobId':_0x3d1da3,'run':()=>audio_player_1[_0x49d0a3(0x14f)][_0x49d0a3(0x158)](_0x192583),'durationInSecond':_0x44da95,'next':()=>null});}async[a133_0x5c850a(0x152)](_0x2f66a3){const _0x5327f2=a133_0x5c850a,{textToAudioId:_0x3eadda,jobId:_0x4322fd,durationInSecond:_0x240f5c}=_0x2f66a3,{message:_0x30b719}=await this[_0x5327f2(0x17e)][_0x5327f2(0x18f)](_0x3eadda);job_1[_0x5327f2(0x171)][_0x5327f2(0x188)](),(0x0,job_1[_0x5327f2(0x17c)])({'jobId':_0x4322fd,'run':()=>{const _0x15bc36=_0x5327f2;let _0x41e55b=null;return this[_0x15bc36(0x17e)]['textToAudio'](_0x30b719,_0x23d24a=>{const _0x2cd85d=_0x15bc36;_0x41e55b=this[_0x2cd85d(0x129)]['playStreamAudioAsync'](_0x23d24a);}),_0x41e55b;},'durationInSecond':_0x240f5c,'next':()=>null});}async[a133_0x5c850a(0x15f)](_0x15b214,_0x149c64,_0x55abb7=![]){const _0x138bcf=a133_0x5c850a,_0x472915={'when':_0x138bcf(0x163),'jobType':enums_1[_0x138bcf(0x17f)]['PlaySound'],'attributes':{'soundId':_0x149c64,'durationInSecond':_0x55abb7?0x15180:undefined},'audit':{'actor':_0x15b214,'name':enums_1['JobType'][_0x138bcf(0x189)],'message':_0x138bcf(0x12e)+_0x149c64}},_0xe8e1ca=await this['soundModel'][_0x138bcf(0x14e)]({'jobId':{'$ne':null}});_0xe8e1ca&&await this[_0x138bcf(0x12d)](_0xe8e1ca['id']);const {jobId:_0x5f37b9}=await this[_0x138bcf(0x146)][_0x138bcf(0x167)](_0x472915);return this[_0x138bcf(0x161)](_0x149c64,{'jobId':_0x5f37b9});}async[a133_0x5c850a(0x12d)](_0x148147){const _0x24e449=a133_0x5c850a;let _0x2c47a2=await this[_0x24e449(0x14e)](_0x148147);const {jobId:_0x501c51}=_0x2c47a2||{};if(_0x501c51){const {success:_0x209276}=await this[_0x24e449(0x146)][_0x24e449(0x179)](_0x501c51);_0x209276&&(_0x2c47a2=await this[_0x24e449(0x161)](_0x148147,{'jobId':null}));}return this[_0x24e449(0x138)][_0x24e449(0x15b)]({'id':_0x2c47a2['id'],'isPlaying':![]}),_0x2c47a2;}async[a133_0x5c850a(0x18d)](){const _0x3383ac=a133_0x5c850a,_0x185014=await this[_0x3383ac(0x139)](constants_2['SoundType'][_0x3383ac(0x15d)]);if(_0x185014[_0x3383ac(0x145)]>0x0){const _0xc8dc5c=[];_0x185014[_0x3383ac(0x199)](_0x8cc6eb=>{const _0x34a55d=_0x3383ac;_0xc8dc5c['push'](this[_0x34a55d(0x16a)](_0x8cc6eb[_0x34a55d(0x181)]));}),await Promise['all'](_0xc8dc5c);}await(0x0,file_1[_0x3383ac(0x182)])(constants_1[_0x3383ac(0x19c)],constants_1[_0x3383ac(0x147)]);const _0x5d2df5=[];return default_sounds_1[_0x3383ac(0x14d)][_0x3383ac(0x199)](_0x515ab9=>{const _0x5f3aa3=_0x3383ac;_0x5d2df5['push'](this['create'](Object[_0x5f3aa3(0x196)]({},_0x515ab9)));}),await Promise['all'](_0x5d2df5),!![];}['getNewFileName'](_0x64d41){const _0x3c0aab=a133_0x5c850a,_0x5981c1=_0x64d41[_0x3c0aab(0x127)]('.')[_0x3c0aab(0x143)]();return(0x0,utils_1['uuid'])()+'.'+_0x5981c1;}async['validateAndMoveFileAsync'](_0x536020,_0x2fa75c){const _0x35fe89=a133_0x5c850a;if(!_0x536020[_0x35fe89(0x160)])return;const _0xbe9b74=constants_1[_0x35fe89(0x147)]+'/'+_0x536020[_0x35fe89(0x160)],_0x16a988=_0x2fa75c||this[_0x35fe89(0x15c)](_0x536020[_0x35fe89(0x160)]),_0x3c2c2f=constants_1['AUDIO_DIR']+'/'+_0x16a988;if(!(0x0,file_1[_0x35fe89(0x176)])(_0xbe9b74))throw new Error(_0x35fe89(0x137));!(0x0,file_1[_0x35fe89(0x176)])(constants_1[_0x35fe89(0x185)])&&(0x0,file_1[_0x35fe89(0x144)])(constants_1['AUDIO_DIR']),await(0x0,file_1[_0x35fe89(0x16c)])(_0xbe9b74,_0x3c2c2f),_0x536020[_0x35fe89(0x160)]=_0x16a988;}};__decorate([(0x0,event_emitter_1['OnEvent'])(sound_1[a133_0x5c850a(0x153)]['Play']),__metadata(a133_0x5c850a(0x128),Function),__metadata('design:paramtypes',[Object]),__metadata(a133_0x5c850a(0x180),Promise)],SoundService['prototype'],a133_0x5c850a(0x12a),null),__decorate([(0x0,event_emitter_1[a133_0x5c850a(0x13c)])(sound_1[a133_0x5c850a(0x153)][a133_0x5c850a(0x141)]),__metadata(a133_0x5c850a(0x128),Function),__metadata(a133_0x5c850a(0x13f),[Object]),__metadata(a133_0x5c850a(0x180),Promise)],SoundService['prototype'],a133_0x5c850a(0x136),null),__decorate([(0x0,event_emitter_1['OnEvent'])(sound_1[a133_0x5c850a(0x153)][a133_0x5c850a(0x162)]),__metadata(a133_0x5c850a(0x128),Function),__metadata(a133_0x5c850a(0x13f),[Object]),__metadata('design:returntype',Promise)],SoundService['prototype'],'playTextToAudioRecorded',null),SoundService=SoundService_1=__decorate([(0x0,common_1[a133_0x5c850a(0x16f)])(),__param(0x0,(0x0,mongoose_1[a133_0x5c850a(0x168)])(a133_0x5c850a(0x131))),__param(0x5,(0x0,common_1[a133_0x5c850a(0x13a)])(sound_gateway_1[a133_0x5c850a(0x156)])),__metadata(a133_0x5c850a(0x13f),[mongoose_2[a133_0x5c850a(0x157)],agenda_service_1[a133_0x5c850a(0x191)],upload_service_1[a133_0x5c850a(0x19b)],text_to_audio_service_1[a133_0x5c850a(0x134)],streaming_service_1[a133_0x5c850a(0x16e)],sound_gateway_1[a133_0x5c850a(0x156)]])],SoundService),exports[a133_0x5c850a(0x13e)]=SoundService;