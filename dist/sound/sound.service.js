'use strict';const a133_0x3e40cf=a133_0x5749;(function(_0x5bccb2,_0x1775b9){const _0x5c13bd=a133_0x5749,_0xd0568b=_0x5bccb2();while(!![]){try{const _0x434f85=-parseInt(_0x5c13bd(0x1ea))/0x1*(parseInt(_0x5c13bd(0x233))/0x2)+parseInt(_0x5c13bd(0x20f))/0x3*(-parseInt(_0x5c13bd(0x221))/0x4)+-parseInt(_0x5c13bd(0x1f4))/0x5+parseInt(_0x5c13bd(0x22e))/0x6+parseInt(_0x5c13bd(0x1e2))/0x7*(-parseInt(_0x5c13bd(0x1f6))/0x8)+parseInt(_0x5c13bd(0x205))/0x9*(-parseInt(_0x5c13bd(0x228))/0xa)+parseInt(_0x5c13bd(0x223))/0xb;if(_0x434f85===_0x1775b9)break;else _0xd0568b['push'](_0xd0568b['shift']());}catch(_0x545de2){_0xd0568b['push'](_0xd0568b['shift']());}}}(a133_0x4a32,0x54f9f));var __decorate=this&&this['__decorate']||function(_0x2f0d4b,_0x17863f,_0x1f612b,_0x8aab83){const _0xf7bb15=a133_0x5749;var _0x1af132=arguments[_0xf7bb15(0x22c)],_0x2d254b=_0x1af132<0x3?_0x17863f:_0x8aab83===null?_0x8aab83=Object['getOwnPropertyDescriptor'](_0x17863f,_0x1f612b):_0x8aab83,_0xf58cfe;if(typeof Reflect===_0xf7bb15(0x212)&&typeof Reflect[_0xf7bb15(0x1e5)]===_0xf7bb15(0x209))_0x2d254b=Reflect[_0xf7bb15(0x1e5)](_0x2f0d4b,_0x17863f,_0x1f612b,_0x8aab83);else{for(var _0x5654a5=_0x2f0d4b[_0xf7bb15(0x22c)]-0x1;_0x5654a5>=0x0;_0x5654a5--)if(_0xf58cfe=_0x2f0d4b[_0x5654a5])_0x2d254b=(_0x1af132<0x3?_0xf58cfe(_0x2d254b):_0x1af132>0x3?_0xf58cfe(_0x17863f,_0x1f612b,_0x2d254b):_0xf58cfe(_0x17863f,_0x1f612b))||_0x2d254b;}return _0x1af132>0x3&&_0x2d254b&&Object[_0xf7bb15(0x1d9)](_0x17863f,_0x1f612b,_0x2d254b),_0x2d254b;},__metadata=this&&this[a133_0x3e40cf(0x236)]||function(_0x34793d,_0x268b79){const _0x498ff2=a133_0x3e40cf;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x498ff2(0x209))return Reflect['metadata'](_0x34793d,_0x268b79);},__param=this&&this[a133_0x3e40cf(0x23f)]||function(_0x5c0baa,_0x3fe01e){return function(_0x261f8a,_0x8a26d9){_0x3fe01e(_0x261f8a,_0x8a26d9,_0x5c0baa);};},SoundService_1;function a133_0x4a32(){const _0x56685c=['SoundType','14vUGiOp','@nestjs/common','getNewFileName','__metadata','prototype','SoundService','findOne','broadcastPlaying','upload','../upload/upload.service','findVoiceRecoredById','filePath','__param','deleteFile','textToAudio','split','Tune','createFolder','findByIdAndUpdate','playVoiceRecorded','audio','Play','../common/utils','copyFiles','save','OnEvent','../text-to-audio/text-to-audio.service','uploadService','forEach','soundModel','isFileExist','./data/default-sounds','../common/enums','executeJob','defineProperty','now','originalname','cwd','DEFAULT_TUNES','update','../common/job','playSoundOnEvent','VoiceRecorded','267673jQSiLB','Playing\x20voice\x20recorded:\x20','exec','decorate','findByType','AUDIO_DIR','soundGateway','InjectModel','92693sqhbVQ','stop','../common/path','PlaySound','./constants','getMessageById','PROCESS_CACHE','_id','@nestjs/event-emitter','name','235230EYdNqN','join','80isIZul','moveFile','AudioPlayer','design:type','create','Sound\x20not\x20found!','push','streamingService','AgendaService','logger','Play\x20sound:\x20','volume','killAll','updateVolume','log','1236042bxOGbz','all','TMP_UPLOAD_DIR','./sound.gateway','function','../common/file','path','validateAndMoveFileAsync','findByIds','assets','6ocnQCX','assign','DEFAULT_TUNES_DIR','object','Logger','File\x20not\x20found!','SoundEvent','delete','Sound','find','\x20-\x20','StreamingService','resetTunes','SoundGateway','scheduleJob','../common/audio/audio-player','findByIdAndDelete','UploadService','725284UuvmEz','@nestjs/mongoose','14949836YjaDbl','textToAudioService','mongoose','Model','design:returntype','10jwuAZL','agendaService','findById','Playing\x20sound:\x20','length','Inject','3403524MXCfee','design:paramtypes','playTextToAudioRecorded','fileName'];a133_0x4a32=function(){return _0x56685c;};return a133_0x4a32();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a133_0x3e40cf(0x238)]=void 0x0;function a133_0x5749(_0x2394c8,_0x2daa01){const _0x4a322e=a133_0x4a32();return a133_0x5749=function(_0x574987,_0x6f4548){_0x574987=_0x574987-0x1cb;let _0x14e13d=_0x4a322e[_0x574987];return _0x14e13d;},a133_0x5749(_0x2394c8,_0x2daa01);}const common_1=require(a133_0x3e40cf(0x234)),mongoose_1=require(a133_0x3e40cf(0x222)),mongoose_2=require(a133_0x3e40cf(0x225)),path=require('path'),event_emitter_1=require(a133_0x3e40cf(0x1f2)),file_1=require(a133_0x3e40cf(0x20a)),agenda_service_1=require('../agenda/agenda.service'),enums_1=require(a133_0x3e40cf(0x1d7)),constants_1=require('../common/constants'),utils_1=require(a133_0x3e40cf(0x1cd)),path_1=require(a133_0x3e40cf(0x1ec)),audio_player_1=require(a133_0x3e40cf(0x21e)),sound_1=require('../common/events/sound'),job_1=require(a133_0x3e40cf(0x1df)),constants_2=require(a133_0x3e40cf(0x1ee)),default_sounds_1=require(a133_0x3e40cf(0x1d6)),sound_gateway_1=require(a133_0x3e40cf(0x208)),path_2=require(a133_0x3e40cf(0x20b)),upload_service_1=require(a133_0x3e40cf(0x23c)),text_to_audio_service_1=require(a133_0x3e40cf(0x1d1)),streaming_service_1=require('../streaming/streaming.service');let SoundService=SoundService_1=class SoundService{constructor(_0x2854f2,_0x42f45b,_0x477959,_0x42cd79,_0x456d0,_0x1ef5d5){const _0x3f6d43=a133_0x3e40cf;this[_0x3f6d43(0x1d4)]=_0x2854f2,this[_0x3f6d43(0x229)]=_0x42f45b,this['uploadService']=_0x477959,this['textToAudioService']=_0x42cd79,this['streamingService']=_0x456d0,this[_0x3f6d43(0x1e8)]=_0x1ef5d5,this[_0x3f6d43(0x1ff)]=new common_1[(_0x3f6d43(0x213))](SoundService_1[_0x3f6d43(0x1f3)]);}async[a133_0x3e40cf(0x1fa)](_0x5d6369){const _0x2cd288=a133_0x3e40cf;await this[_0x2cd288(0x20c)](_0x5d6369,null);const _0x22ed16=new this[(_0x2cd288(0x1d4))](_0x5d6369);return _0x22ed16[_0x2cd288(0x1cf)]();}async[a133_0x3e40cf(0x1e6)](_0x46dda6){const _0x3c4738=a133_0x3e40cf,_0x1127b3=await this[_0x3c4738(0x1d4)][_0x3c4738(0x218)]({'type':_0x46dda6})[_0x3c4738(0x1e4)]();return _0x1127b3;}async[a133_0x3e40cf(0x239)](_0xa19519){const _0x2ae391=a133_0x3e40cf,_0x5edd52=await this['soundModel'][_0x2ae391(0x22a)](_0xa19519);return _0x5edd52;}async[a133_0x3e40cf(0x20d)](_0x7eab03){const _0x2eb323=a133_0x3e40cf,_0x36adfd=await this[_0x2eb323(0x1d4)][_0x2eb323(0x218)]({'_id':{'$in':_0x7eab03}});return _0x36adfd;}async['update'](_0x2c20cd,_0x38965a){const _0x99cb71=a133_0x3e40cf,_0x4ffa74=await this[_0x99cb71(0x1d4)]['findById'](_0x2c20cd)['exec']();if(!_0x4ffa74)throw new Error(_0x99cb71(0x1fb));await this[_0x99cb71(0x20c)](_0x38965a,_0x4ffa74===null||_0x4ffa74===void 0x0?void 0x0:_0x4ffa74[_0x99cb71(0x231)]);const _0x392e73=await this[_0x99cb71(0x1d4)][_0x99cb71(0x245)](_0x2c20cd,Object['assign'](Object[_0x99cb71(0x210)]({},_0x38965a),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x392e73;}async[a133_0x3e40cf(0x203)](_0x5002d2,_0x111785){const _0x415bcb=a133_0x3e40cf,_0x3d49a3=await this[_0x415bcb(0x1d4)][_0x415bcb(0x22a)](_0x5002d2)[_0x415bcb(0x1e4)]();if(!_0x3d49a3)throw new Error(_0x415bcb(0x1fb));const _0x248441=await this[_0x415bcb(0x1d4)][_0x415bcb(0x245)](_0x5002d2,Object[_0x415bcb(0x210)](Object['assign']({},_0x111785),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x248441;}async[a133_0x3e40cf(0x216)](_0x276593){const _0x5c107a=a133_0x3e40cf,_0x14cd3c=await this[_0x5c107a(0x1d4)][_0x5c107a(0x21f)](_0x276593);if(_0x14cd3c[_0x5c107a(0x231)]){const _0x134f7f=constants_1[_0x5c107a(0x1e7)]+'/'+_0x14cd3c['fileName'];try{(0x0,file_1[_0x5c107a(0x240)])(_0x134f7f);}catch(_0x348db2){this[_0x5c107a(0x1ff)]['error'](_0x348db2);}}return _0x14cd3c;}async[a133_0x3e40cf(0x23b)](_0x117cd9,_0x5c7d71){const _0x391aa1=a133_0x3e40cf,_0x4bd5be=await this[_0x391aa1(0x1d4)][_0x391aa1(0x22a)](_0x117cd9)['exec'](),_0x2a12f8=_0x4bd5be===null||_0x4bd5be===void 0x0?void 0x0:_0x4bd5be[_0x391aa1(0x231)],_0x318201=this['getNewFileName'](_0x5c7d71[_0x391aa1(0x1db)]),_0x3dd185=constants_1[_0x391aa1(0x1e7)]+'/'+_0x318201;await(0x0,file_1[_0x391aa1(0x1f7)])(_0x5c7d71['path'],_0x3dd185);const _0x222889={'fileName':_0x318201},_0x4155d7=await this[_0x391aa1(0x1d4)][_0x391aa1(0x245)](_0x117cd9,Object[_0x391aa1(0x210)](Object[_0x391aa1(0x210)]({},_0x222889),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0x2a12f8){const _0x592517=constants_1['AUDIO_DIR']+'/'+_0x2a12f8;(0x0,file_1[_0x391aa1(0x240)])(_0x592517);}return _0x4155d7;}async['playSoundOnEvent'](_0x2a143b){const _0xa732f7=a133_0x3e40cf,{soundId:_0x3bc7cc,jobId:_0x3881fe,durationInSecond:_0x38b0b2}=_0x2a143b,_0x2dc096=await this[_0xa732f7(0x239)](_0x3bc7cc),_0x197be9=path[_0xa732f7(0x1f5)](path_1['processRootPath'],_0xa732f7(0x20e),_0xa732f7(0x1cb),_0x2dc096[_0xa732f7(0x231)]);job_1[_0xa732f7(0x1f0)][_0xa732f7(0x202)](),this[_0xa732f7(0x1ff)][_0xa732f7(0x204)](_0xa732f7(0x22b)+_0x3bc7cc+_0xa732f7(0x219)+_0x2dc096['name']),(0x0,job_1['executeJob'])({'jobId':_0x3881fe,'run':()=>audio_player_1[_0xa732f7(0x1f8)]['playAsync'](_0x197be9,_0x2dc096[_0xa732f7(0x201)]),'next':()=>this[_0xa732f7(0x1eb)](_0x3bc7cc),'durationInSecond':_0x38b0b2}),this[_0xa732f7(0x1e8)]['broadcastPlaying']({'id':_0x3bc7cc,'isPlaying':!![]});}async[a133_0x3e40cf(0x246)](_0x1a7aa7){const _0x5424fb=a133_0x3e40cf,{voiceId:_0x350de0,jobId:_0x54a40d,durationInSecond:_0x13c294}=_0x1a7aa7,_0x1287f3=await this[_0x5424fb(0x1d2)][_0x5424fb(0x23d)](_0x350de0),_0x40cab6=_0x1287f3[_0x5424fb(0x23e)],_0x5c9bae=(0x0,path_2[_0x5424fb(0x1f5)])(process[_0x5424fb(0x1dc)](),_0x40cab6);job_1['PROCESS_CACHE'][_0x5424fb(0x202)](),this[_0x5424fb(0x1ff)][_0x5424fb(0x204)](_0x5424fb(0x1e3)+_0x350de0),(0x0,job_1[_0x5424fb(0x1d8)])({'jobId':_0x54a40d,'run':()=>audio_player_1[_0x5424fb(0x1f8)]['playAsync'](_0x5c9bae),'durationInSecond':_0x13c294,'next':()=>null});}async[a133_0x3e40cf(0x230)](_0x19862b){const _0x3b682d=a133_0x3e40cf,{textToAudioId:_0x480630,jobId:_0x21e0a3,durationInSecond:_0x165124}=_0x19862b,{message:_0x21c381}=await this[_0x3b682d(0x224)][_0x3b682d(0x1ef)](_0x480630);job_1[_0x3b682d(0x1f0)][_0x3b682d(0x202)](),(0x0,job_1['executeJob'])({'jobId':_0x21e0a3,'run':()=>{const _0x3f7882=_0x3b682d;let _0x490471=null;return this[_0x3f7882(0x224)][_0x3f7882(0x241)](_0x21c381,_0x2b3656=>{const _0x54e159=_0x3f7882;_0x490471=this[_0x54e159(0x1fd)]['playStreamAudioAsync'](_0x2b3656);}),_0x490471;},'durationInSecond':_0x165124,'next':()=>null});}async['play'](_0x157ee3,_0x311581,_0x602dfb=![]){const _0x317c64=a133_0x3e40cf,_0x3bdd5e={'when':_0x317c64(0x1da),'jobType':enums_1['JobType'][_0x317c64(0x1ed)],'attributes':{'soundId':_0x311581,'durationInSecond':_0x602dfb?0x15180:undefined},'audit':{'actor':_0x157ee3,'name':enums_1['JobType'][_0x317c64(0x1ed)],'message':_0x317c64(0x200)+_0x311581}},_0x56113d=await this['soundModel'][_0x317c64(0x239)]({'jobId':{'$ne':null}});_0x56113d&&await this[_0x317c64(0x1eb)](_0x56113d['id']);const {jobId:_0x487624}=await this[_0x317c64(0x229)][_0x317c64(0x21d)](_0x3bdd5e);return this['update'](_0x311581,{'jobId':_0x487624});}async['stop'](_0x2bcb91){const _0x3ff333=a133_0x3e40cf;let _0x2dbeb3=await this[_0x3ff333(0x239)](_0x2bcb91);const {jobId:_0x12f4fe}=_0x2dbeb3||{};if(_0x12f4fe){const {success:_0x58d0ce}=await this['agendaService']['cancelJob'](_0x12f4fe);_0x58d0ce&&(_0x2dbeb3=await this[_0x3ff333(0x1de)](_0x2bcb91,{'jobId':null}));}return this[_0x3ff333(0x1e8)][_0x3ff333(0x23a)]({'id':_0x2dbeb3['id'],'isPlaying':![]}),_0x2dbeb3;}async[a133_0x3e40cf(0x21b)](){const _0x1b3d0e=a133_0x3e40cf,_0x3d53eb=await this[_0x1b3d0e(0x1e6)](constants_2[_0x1b3d0e(0x232)][_0x1b3d0e(0x243)]);if(_0x3d53eb[_0x1b3d0e(0x22c)]>0x0){const _0x234352=[];_0x3d53eb[_0x1b3d0e(0x1d3)](_0x283e8d=>{const _0x2ebdcd=_0x1b3d0e;_0x234352[_0x2ebdcd(0x1fc)](this['delete'](_0x283e8d[_0x2ebdcd(0x1f1)]));}),await Promise['all'](_0x234352);}await(0x0,file_1[_0x1b3d0e(0x1ce)])(constants_1[_0x1b3d0e(0x211)],constants_1['TMP_UPLOAD_DIR']);const _0x157b23=[];return default_sounds_1[_0x1b3d0e(0x1dd)][_0x1b3d0e(0x1d3)](_0x45b87a=>{const _0x5a2e8a=_0x1b3d0e;_0x157b23['push'](this[_0x5a2e8a(0x1fa)](Object[_0x5a2e8a(0x210)]({},_0x45b87a)));}),await Promise[_0x1b3d0e(0x206)](_0x157b23),!![];}[a133_0x3e40cf(0x235)](_0x19ac02){const _0x3c3b62=a133_0x3e40cf,_0x59448e=_0x19ac02[_0x3c3b62(0x242)]('.')['pop']();return(0x0,utils_1['uuid'])()+'.'+_0x59448e;}async[a133_0x3e40cf(0x20c)](_0x1907bc,_0x23b947){const _0x46f675=a133_0x3e40cf;if(!_0x1907bc[_0x46f675(0x231)])return;const _0x29a528=constants_1[_0x46f675(0x207)]+'/'+_0x1907bc[_0x46f675(0x231)],_0x3becd1=_0x23b947||this[_0x46f675(0x235)](_0x1907bc[_0x46f675(0x231)]),_0x207bc8=constants_1[_0x46f675(0x1e7)]+'/'+_0x3becd1;if(!(0x0,file_1['isFileExist'])(_0x29a528))throw new Error(_0x46f675(0x214));!(0x0,file_1[_0x46f675(0x1d5)])(constants_1[_0x46f675(0x1e7)])&&(0x0,file_1[_0x46f675(0x244)])(constants_1['AUDIO_DIR']),await(0x0,file_1['moveFile'])(_0x29a528,_0x207bc8),_0x1907bc['fileName']=_0x3becd1;}};__decorate([(0x0,event_emitter_1[a133_0x3e40cf(0x1d0)])(sound_1['SoundEvent'][a133_0x3e40cf(0x1cc)]),__metadata(a133_0x3e40cf(0x1f9),Function),__metadata(a133_0x3e40cf(0x22f),[Object]),__metadata(a133_0x3e40cf(0x227),Promise)],SoundService['prototype'],a133_0x3e40cf(0x1e0),null),__decorate([(0x0,event_emitter_1[a133_0x3e40cf(0x1d0)])(sound_1[a133_0x3e40cf(0x215)][a133_0x3e40cf(0x1e1)]),__metadata(a133_0x3e40cf(0x1f9),Function),__metadata(a133_0x3e40cf(0x22f),[Object]),__metadata(a133_0x3e40cf(0x227),Promise)],SoundService[a133_0x3e40cf(0x237)],a133_0x3e40cf(0x246),null),__decorate([(0x0,event_emitter_1[a133_0x3e40cf(0x1d0)])(sound_1[a133_0x3e40cf(0x215)]['TextToAudio']),__metadata('design:type',Function),__metadata(a133_0x3e40cf(0x22f),[Object]),__metadata('design:returntype',Promise)],SoundService[a133_0x3e40cf(0x237)],a133_0x3e40cf(0x230),null),SoundService=SoundService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_1[a133_0x3e40cf(0x1e9)])(a133_0x3e40cf(0x217))),__param(0x5,(0x0,common_1[a133_0x3e40cf(0x22d)])(sound_gateway_1['SoundGateway'])),__metadata(a133_0x3e40cf(0x22f),[mongoose_2[a133_0x3e40cf(0x226)],agenda_service_1[a133_0x3e40cf(0x1fe)],upload_service_1[a133_0x3e40cf(0x220)],text_to_audio_service_1['TextToAudioService'],streaming_service_1[a133_0x3e40cf(0x21a)],sound_gateway_1[a133_0x3e40cf(0x21c)]])],SoundService),exports[a133_0x3e40cf(0x238)]=SoundService;