'use strict';function a133_0x4cd6(){const _0x53ea05=['filePath','executeJob','283970XfzLeT','createFolder','defineProperty','3bpDqPA','assign','Sound\x20not\x20found!','playVoiceRecorded','path','logger','findById','textToAudioService','Injectable','SoundService','PROCESS_CACHE','../common/events/sound','StreamingService','DEFAULT_TUNES_DIR','length','cancelJob','PlaySound','fileName','assets','validateAndMoveFileAsync','__param','../agenda/agenda.service','./sound.gateway','pop','volume','design:returntype','error','cwd','AUDIO_DIR','textToAudio','../common/constants','function','File\x20not\x20found!','find','./data/default-sounds','AgendaService','playAsync','exec','TextToAudioService','originalname','4KELJGG','findByIdAndUpdate','findByIdAndDelete','Playing\x20sound:\x20','update','2112156uEhvNL','findVoiceRecoredById','log','Play\x20sound:\x20','soundModel','broadcastPlaying','moveFile','killAll','isFileExist','SoundEvent','streamingService','uuid','../text-to-audio/text-to-audio.service','490RkQUnJ','copyFiles','Playing\x20voice\x20recorded:\x20','../common/utils','_id','deleteFile','playTextToAudioRecorded','join','Sound','delete','36976HGKmFZ','forEach','Inject','45bBfeEy','audio','uploadService','object','2506823nQliQO','TMP_UPLOAD_DIR','playSoundOnEvent','metadata','AudioPlayer','DEFAULT_TUNES','239948FczoLc','getMessageById','push','agendaService','processRootPath','Tune','Model','findOne','getNewFileName','playStreamAudioAsync','findByType','design:type','design:paramtypes','prototype','../common/path','all','../common/job','create','280MVudYA','SoundGateway','OnEvent','stop','upload','48630TQWwIY','soundGateway','split','decorate','\x20-\x20','JobType','2953428FfgRoX','resetTunes'];a133_0x4cd6=function(){return _0x53ea05;};return a133_0x4cd6();}const a133_0x31ea6a=a133_0xac1c;(function(_0x42a11b,_0x3e5f57){const _0x3d0d3e=a133_0xac1c,_0x27529e=_0x42a11b();while(!![]){try{const _0x3d2c76=-parseInt(_0x3d0d3e(0xce))/0x1*(parseInt(_0x3d0d3e(0x11f))/0x2)+parseInt(_0x3d0d3e(0xc7))/0x3*(parseInt(_0x3d0d3e(0xf6))/0x4)+-parseInt(_0x3d0d3e(0x108))/0x5*(parseInt(_0x3d0d3e(0xc1))/0x6)+-parseInt(_0x3d0d3e(0xbc))/0x7*(-parseInt(_0x3d0d3e(0x112))/0x8)+parseInt(_0x3d0d3e(0x115))/0x9*(parseInt(_0x3d0d3e(0xcb))/0xa)+parseInt(_0x3d0d3e(0x119))/0xb+parseInt(_0x3d0d3e(0xfb))/0xc;if(_0x3d2c76===_0x3e5f57)break;else _0x27529e['push'](_0x27529e['shift']());}catch(_0x3d8013){_0x27529e['push'](_0x27529e['shift']());}}}(a133_0x4cd6,0x88f8b));function a133_0xac1c(_0x1e7d76,_0x50d2b7){const _0x4cd605=a133_0x4cd6();return a133_0xac1c=function(_0xac1c72,_0x143949){_0xac1c72=_0xac1c72-0xb6;let _0x35e20b=_0x4cd605[_0xac1c72];return _0x35e20b;},a133_0xac1c(_0x1e7d76,_0x50d2b7);}var __decorate=this&&this['__decorate']||function(_0x29f3b9,_0x29f488,_0x5a29d0,_0x2d923e){const _0x36b752=a133_0xac1c;var _0x40970f=arguments[_0x36b752(0xdc)],_0x3ad649=_0x40970f<0x3?_0x29f488:_0x2d923e===null?_0x2d923e=Object['getOwnPropertyDescriptor'](_0x29f488,_0x5a29d0):_0x2d923e,_0x220400;if(typeof Reflect==='object'&&typeof Reflect[_0x36b752(0xc4)]===_0x36b752(0xed))_0x3ad649=Reflect['decorate'](_0x29f3b9,_0x29f488,_0x5a29d0,_0x2d923e);else{for(var _0x55834b=_0x29f3b9[_0x36b752(0xdc)]-0x1;_0x55834b>=0x0;_0x55834b--)if(_0x220400=_0x29f3b9[_0x55834b])_0x3ad649=(_0x40970f<0x3?_0x220400(_0x3ad649):_0x40970f>0x3?_0x220400(_0x29f488,_0x5a29d0,_0x3ad649):_0x220400(_0x29f488,_0x5a29d0))||_0x3ad649;}return _0x40970f>0x3&&_0x3ad649&&Object['defineProperty'](_0x29f488,_0x5a29d0,_0x3ad649),_0x3ad649;},__metadata=this&&this['__metadata']||function(_0x58c56e,_0x26d64f){const _0x35be0c=a133_0xac1c;if(typeof Reflect===_0x35be0c(0x118)&&typeof Reflect['metadata']===_0x35be0c(0xed))return Reflect[_0x35be0c(0x11c)](_0x58c56e,_0x26d64f);},__param=this&&this[a133_0x31ea6a(0xe2)]||function(_0x3c8c88,_0x36509e){return function(_0x113c64,_0x1ec0f8){_0x36509e(_0x113c64,_0x1ec0f8,_0x3c8c88);};},SoundService_1;Object[a133_0x31ea6a(0xcd)](exports,'__esModule',{'value':!![]}),exports[a133_0x31ea6a(0xd7)]=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require('mongoose'),path=require(a133_0x31ea6a(0xd2)),event_emitter_1=require('@nestjs/event-emitter'),file_1=require('../common/file'),agenda_service_1=require(a133_0x31ea6a(0xe3)),enums_1=require('../common/enums'),constants_1=require(a133_0x31ea6a(0xec)),utils_1=require(a133_0x31ea6a(0x10b)),path_1=require(a133_0x31ea6a(0xb8)),audio_player_1=require('../common/audio/audio-player'),sound_1=require(a133_0x31ea6a(0xd9)),job_1=require(a133_0x31ea6a(0xba)),constants_2=require('./constants'),default_sounds_1=require(a133_0x31ea6a(0xf0)),sound_gateway_1=require(a133_0x31ea6a(0xe4)),path_2=require('path'),upload_service_1=require('../upload/upload.service'),text_to_audio_service_1=require(a133_0x31ea6a(0x107)),streaming_service_1=require('../streaming/streaming.service');let SoundService=SoundService_1=class SoundService{constructor(_0x47ef4f,_0x5bab6e,_0x51d86c,_0x3e932d,_0x515446,_0x16b080){const _0x27e164=a133_0x31ea6a;this[_0x27e164(0xff)]=_0x47ef4f,this[_0x27e164(0x122)]=_0x5bab6e,this[_0x27e164(0x117)]=_0x51d86c,this['textToAudioService']=_0x3e932d,this[_0x27e164(0x105)]=_0x515446,this[_0x27e164(0xc2)]=_0x16b080,this[_0x27e164(0xd3)]=new common_1['Logger'](SoundService_1['name']);}async['create'](_0x198c62){const _0x9b6ba4=a133_0x31ea6a;await this[_0x9b6ba4(0xe1)](_0x198c62,null);const _0x33891b=new this[(_0x9b6ba4(0xff))](_0x198c62);return _0x33891b['save']();}async[a133_0x31ea6a(0x129)](_0x107790){const _0x37bfe5=a133_0x31ea6a,_0x3a9d70=await this[_0x37bfe5(0xff)][_0x37bfe5(0xef)]({'type':_0x107790})['exec']();return _0x3a9d70;}async[a133_0x31ea6a(0x126)](_0x58683a){const _0x2ba66d=a133_0x31ea6a,_0xeadcf1=await this[_0x2ba66d(0xff)][_0x2ba66d(0xd4)](_0x58683a);return _0xeadcf1;}async['findByIds'](_0x2ce12d){const _0x1dfd6f=a133_0x31ea6a,_0xddb96e=await this[_0x1dfd6f(0xff)][_0x1dfd6f(0xef)]({'_id':{'$in':_0x2ce12d}});return _0xddb96e;}async[a133_0x31ea6a(0xfa)](_0x1b62d9,_0x37e81e){const _0x282a77=a133_0x31ea6a,_0x3694ba=await this['soundModel'][_0x282a77(0xd4)](_0x1b62d9)[_0x282a77(0xf3)]();if(!_0x3694ba)throw new Error(_0x282a77(0xd0));await this[_0x282a77(0xe1)](_0x37e81e,_0x3694ba===null||_0x3694ba===void 0x0?void 0x0:_0x3694ba[_0x282a77(0xdf)]);const _0x3b950b=await this[_0x282a77(0xff)][_0x282a77(0xf7)](_0x1b62d9,Object[_0x282a77(0xcf)](Object[_0x282a77(0xcf)]({},_0x37e81e),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x3b950b;}async['updateVolume'](_0x2ef177,_0x34c377){const _0x46e720=a133_0x31ea6a,_0x187e4d=await this[_0x46e720(0xff)][_0x46e720(0xd4)](_0x2ef177)[_0x46e720(0xf3)]();if(!_0x187e4d)throw new Error(_0x46e720(0xd0));const _0xab642=await this['soundModel']['findByIdAndUpdate'](_0x2ef177,Object['assign'](Object[_0x46e720(0xcf)]({},_0x34c377),{'updatedAtUtc':new Date()}),{'new':!![]});return _0xab642;}async[a133_0x31ea6a(0x111)](_0x34fc7a){const _0x3bf173=a133_0x31ea6a,_0x5f13af=await this['soundModel'][_0x3bf173(0xf8)](_0x34fc7a);if(_0x5f13af[_0x3bf173(0xdf)]){const _0x23a6db=constants_1[_0x3bf173(0xea)]+'/'+_0x5f13af[_0x3bf173(0xdf)];try{(0x0,file_1['deleteFile'])(_0x23a6db);}catch(_0x1f4d50){this[_0x3bf173(0xd3)][_0x3bf173(0xe8)](_0x1f4d50);}}return _0x5f13af;}async[a133_0x31ea6a(0xc0)](_0x28ebd8,_0x3021fb){const _0x218dbd=a133_0x31ea6a,_0x47be12=await this[_0x218dbd(0xff)]['findById'](_0x28ebd8)[_0x218dbd(0xf3)](),_0x4a9bcd=_0x47be12===null||_0x47be12===void 0x0?void 0x0:_0x47be12[_0x218dbd(0xdf)],_0x5d59fa=this[_0x218dbd(0x127)](_0x3021fb[_0x218dbd(0xf5)]),_0x359d67=constants_1[_0x218dbd(0xea)]+'/'+_0x5d59fa;await(0x0,file_1[_0x218dbd(0x101)])(_0x3021fb[_0x218dbd(0xd2)],_0x359d67);const _0x4ff9c2={'fileName':_0x5d59fa},_0x1f3fe7=await this[_0x218dbd(0xff)]['findByIdAndUpdate'](_0x28ebd8,Object[_0x218dbd(0xcf)](Object[_0x218dbd(0xcf)]({},_0x4ff9c2),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0x4a9bcd){const _0x3ab734=constants_1[_0x218dbd(0xea)]+'/'+_0x4a9bcd;(0x0,file_1[_0x218dbd(0x10d)])(_0x3ab734);}return _0x1f3fe7;}async[a133_0x31ea6a(0x11b)](_0x13902b){const _0x454b9f=a133_0x31ea6a,{soundId:_0x3e18f0,jobId:_0x4e9b97,durationInSecond:_0x217b2b}=_0x13902b,_0x8efd8a=await this[_0x454b9f(0x126)](_0x3e18f0),_0x3f4676=path['join'](path_1[_0x454b9f(0x123)],_0x454b9f(0xe0),_0x454b9f(0x116),_0x8efd8a[_0x454b9f(0xdf)]);job_1[_0x454b9f(0xd8)][_0x454b9f(0x102)](),this['logger'][_0x454b9f(0xfd)](_0x454b9f(0xf9)+_0x3e18f0+_0x454b9f(0xc5)+_0x8efd8a['name']),(0x0,job_1[_0x454b9f(0xca)])({'jobId':_0x4e9b97,'run':()=>audio_player_1[_0x454b9f(0x11d)][_0x454b9f(0xf2)](_0x3f4676,_0x8efd8a[_0x454b9f(0xe6)]),'next':()=>this[_0x454b9f(0xbf)](_0x3e18f0),'durationInSecond':_0x217b2b}),this[_0x454b9f(0xc2)][_0x454b9f(0x100)]({'id':_0x3e18f0,'isPlaying':!![]});}async['playVoiceRecorded'](_0x3e2ad5){const _0x3ec86d=a133_0x31ea6a,{voiceId:_0x3711e3,jobId:_0x3446dc,durationInSecond:_0x41eb12}=_0x3e2ad5,_0x59924c=await this[_0x3ec86d(0x117)][_0x3ec86d(0xfc)](_0x3711e3),_0x35b917=_0x59924c[_0x3ec86d(0xc9)],_0x2cb042=(0x0,path_2[_0x3ec86d(0x10f)])(process[_0x3ec86d(0xe9)](),_0x35b917);job_1[_0x3ec86d(0xd8)][_0x3ec86d(0x102)](),this['logger'][_0x3ec86d(0xfd)](_0x3ec86d(0x10a)+_0x3711e3),(0x0,job_1['executeJob'])({'jobId':_0x3446dc,'run':()=>audio_player_1[_0x3ec86d(0x11d)][_0x3ec86d(0xf2)](_0x2cb042),'durationInSecond':_0x41eb12,'next':()=>null});}async[a133_0x31ea6a(0x10e)](_0x109308){const _0x15bd7d=a133_0x31ea6a,{textToAudioId:_0x2568cd,jobId:_0x13953d,durationInSecond:_0x2f7d00}=_0x109308,{message:_0x3e4dc5}=await this[_0x15bd7d(0xd5)][_0x15bd7d(0x120)](_0x2568cd);job_1[_0x15bd7d(0xd8)][_0x15bd7d(0x102)](),(0x0,job_1[_0x15bd7d(0xca)])({'jobId':_0x13953d,'run':()=>{const _0x3c01d2=_0x15bd7d;let _0x13e6e4=null;return this[_0x3c01d2(0xd5)][_0x3c01d2(0xeb)](_0x3e4dc5,_0x107567=>{const _0x792f97=_0x3c01d2;_0x13e6e4=this[_0x792f97(0x105)][_0x792f97(0x128)](_0x107567);}),_0x13e6e4;},'durationInSecond':_0x2f7d00,'next':()=>null});}async['play'](_0x503e54,_0x355acd,_0x34777b=![]){const _0x52e784=a133_0x31ea6a,_0x52d255={'when':'now','jobType':enums_1['JobType'][_0x52e784(0xde)],'attributes':{'soundId':_0x355acd,'durationInSecond':_0x34777b?0x15180:undefined},'audit':{'actor':_0x503e54,'name':enums_1[_0x52e784(0xc6)][_0x52e784(0xde)],'message':_0x52e784(0xfe)+_0x355acd}},_0x47913e=await this[_0x52e784(0xff)]['findOne']({'jobId':{'$ne':null}});_0x47913e&&await this[_0x52e784(0xbf)](_0x47913e['id']);const {jobId:_0x267c2b}=await this[_0x52e784(0x122)]['scheduleJob'](_0x52d255);return this[_0x52e784(0xfa)](_0x355acd,{'jobId':_0x267c2b});}async['stop'](_0x580936){const _0x577c30=a133_0x31ea6a;let _0x6bdc95=await this[_0x577c30(0x126)](_0x580936);const {jobId:_0x515ef4}=_0x6bdc95||{};if(_0x515ef4){const {success:_0x343160}=await this['agendaService'][_0x577c30(0xdd)](_0x515ef4);_0x343160&&(_0x6bdc95=await this[_0x577c30(0xfa)](_0x580936,{'jobId':null}));}return this[_0x577c30(0xc2)][_0x577c30(0x100)]({'id':_0x6bdc95['id'],'isPlaying':![]}),_0x6bdc95;}async[a133_0x31ea6a(0xc8)](){const _0x9d7466=a133_0x31ea6a,_0x87cf5a=await this[_0x9d7466(0x129)](constants_2['SoundType'][_0x9d7466(0x124)]);if(_0x87cf5a['length']>0x0){const _0x2aa5ee=[];_0x87cf5a[_0x9d7466(0x113)](_0x2cf81f=>{const _0x1a6109=_0x9d7466;_0x2aa5ee[_0x1a6109(0x121)](this[_0x1a6109(0x111)](_0x2cf81f[_0x1a6109(0x10c)]));}),await Promise[_0x9d7466(0xb9)](_0x2aa5ee);}await(0x0,file_1[_0x9d7466(0x109)])(constants_1[_0x9d7466(0xdb)],constants_1[_0x9d7466(0x11a)]);const _0x9e7c9a=[];return default_sounds_1[_0x9d7466(0x11e)]['forEach'](_0x57a55e=>{const _0x1b4128=_0x9d7466;_0x9e7c9a[_0x1b4128(0x121)](this[_0x1b4128(0xbb)](Object[_0x1b4128(0xcf)]({},_0x57a55e)));}),await Promise['all'](_0x9e7c9a),!![];}['getNewFileName'](_0x2c8597){const _0x32790e=a133_0x31ea6a,_0x5d4881=_0x2c8597[_0x32790e(0xc3)]('.')[_0x32790e(0xe5)]();return(0x0,utils_1[_0x32790e(0x106)])()+'.'+_0x5d4881;}async[a133_0x31ea6a(0xe1)](_0x27de3f,_0xaa4086){const _0x3bd0f5=a133_0x31ea6a;if(!_0x27de3f['fileName'])return;const _0x558a31=constants_1[_0x3bd0f5(0x11a)]+'/'+_0x27de3f[_0x3bd0f5(0xdf)],_0x170dae=_0xaa4086||this[_0x3bd0f5(0x127)](_0x27de3f['fileName']),_0x367147=constants_1[_0x3bd0f5(0xea)]+'/'+_0x170dae;if(!(0x0,file_1[_0x3bd0f5(0x103)])(_0x558a31))throw new Error(_0x3bd0f5(0xee));!(0x0,file_1[_0x3bd0f5(0x103)])(constants_1[_0x3bd0f5(0xea)])&&(0x0,file_1[_0x3bd0f5(0xcc)])(constants_1['AUDIO_DIR']),await(0x0,file_1[_0x3bd0f5(0x101)])(_0x558a31,_0x367147),_0x27de3f[_0x3bd0f5(0xdf)]=_0x170dae;}};__decorate([(0x0,event_emitter_1[a133_0x31ea6a(0xbe)])(sound_1[a133_0x31ea6a(0x104)]['Play']),__metadata(a133_0x31ea6a(0x12a),Function),__metadata(a133_0x31ea6a(0xb6),[Object]),__metadata(a133_0x31ea6a(0xe7),Promise)],SoundService[a133_0x31ea6a(0xb7)],a133_0x31ea6a(0x11b),null),__decorate([(0x0,event_emitter_1['OnEvent'])(sound_1[a133_0x31ea6a(0x104)]['VoiceRecorded']),__metadata('design:type',Function),__metadata(a133_0x31ea6a(0xb6),[Object]),__metadata(a133_0x31ea6a(0xe7),Promise)],SoundService[a133_0x31ea6a(0xb7)],a133_0x31ea6a(0xd1),null),__decorate([(0x0,event_emitter_1['OnEvent'])(sound_1[a133_0x31ea6a(0x104)]['TextToAudio']),__metadata('design:type',Function),__metadata(a133_0x31ea6a(0xb6),[Object]),__metadata(a133_0x31ea6a(0xe7),Promise)],SoundService[a133_0x31ea6a(0xb7)],a133_0x31ea6a(0x10e),null),SoundService=SoundService_1=__decorate([(0x0,common_1[a133_0x31ea6a(0xd6)])(),__param(0x0,(0x0,mongoose_1['InjectModel'])(a133_0x31ea6a(0x110))),__param(0x5,(0x0,common_1[a133_0x31ea6a(0x114)])(sound_gateway_1['SoundGateway'])),__metadata(a133_0x31ea6a(0xb6),[mongoose_2[a133_0x31ea6a(0x125)],agenda_service_1[a133_0x31ea6a(0xf1)],upload_service_1['UploadService'],text_to_audio_service_1[a133_0x31ea6a(0xf4)],streaming_service_1[a133_0x31ea6a(0xda)],sound_gateway_1[a133_0x31ea6a(0xbd)]])],SoundService),exports[a133_0x31ea6a(0xd7)]=SoundService;