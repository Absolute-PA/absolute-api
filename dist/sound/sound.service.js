'use strict';const a136_0x38181b=a136_0x244b;(function(_0x338b1,_0x4ed366){const _0x251a8b=a136_0x244b,_0x26456f=_0x338b1();while(!![]){try{const _0x446d4a=parseInt(_0x251a8b(0x217))/0x1+parseInt(_0x251a8b(0x1a9))/0x2+-parseInt(_0x251a8b(0x1e7))/0x3+-parseInt(_0x251a8b(0x1f9))/0x4*(-parseInt(_0x251a8b(0x1af))/0x5)+parseInt(_0x251a8b(0x1c6))/0x6+-parseInt(_0x251a8b(0x1e0))/0x7+parseInt(_0x251a8b(0x1ed))/0x8*(-parseInt(_0x251a8b(0x1b4))/0x9);if(_0x446d4a===_0x4ed366)break;else _0x26456f['push'](_0x26456f['shift']());}catch(_0x49e002){_0x26456f['push'](_0x26456f['shift']());}}}(a136_0x21eb,0x55f2e));function a136_0x21eb(){const _0x426cd6=['prototype','PlaySound','killAll','JobType','uuid','logger','fileName','streamingService','audio','getMessageById','Voice\x20file\x20not\x20found:\x20','getOwnPropertyDescriptor','isFileExist','save','assets','__param','VoiceRecorded','1065295lZgyGF','error','../common/constants','copyFiles','File\x20not\x20found!','@nestjs/mongoose','agendaService','530655Nfkdzw','join','design:type','../common/events/sound','cancelJob','filePath','8KgOWTg','DEFAULT_TUNES','broadcastPlaying','uploadService','executeJob','../common/enums','soundModel','getNewFileName','resetTunes','object','StreamingService','Sound\x20not\x20found!','472zphlRN','DEFAULT_TUNES_DIR','Logger','UploadService','./sound.gateway','upload','__decorate','defineProperty','__metadata','soundGateway','forEach','SoundEvent','stop','Sound\x20file\x20not\x20found:\x20','SoundService','textToAudioService','update','function','metadata','./constants','findOne','createFolder','TextToAudio','processRootPath','../common/job','OnEvent','name','assign','playVoiceRecorded','design:returntype','16254RXYgnv','length','../common/audio/audio-player','updateVolume','push','scheduleJob','AUDIO_DIR','delete','log','InjectModel','Model','design:paramtypes','exec','96054rajbnu','PROCESS_CACHE','path','findByType','@nestjs/event-emitter','findByIdAndDelete','27605swGQep','SoundType','findByIdAndUpdate','AudioPlayer','all','5825403YmbaeC','validateAndMoveFileAsync','\x20-\x20','pop','play','decorate','playAsync','findById','../agenda/agenda.service','playTextToAudioRecorded','__esModule','create','textToAudio','../upload/upload.service','findVoiceRecoredById','Playing\x20sound:\x20','Playing\x20voice\x20recorded:\x20','mongoose','3675744gpAtjN','moveFile','Inject','../text-to-audio/text-to-audio.service','findByIds','deleteFile','TMP_UPLOAD_DIR','Play','../common/path'];a136_0x21eb=function(){return _0x426cd6;};return a136_0x21eb();}var __decorate=this&&this[a136_0x38181b(0x1ff)]||function(_0x188320,_0x29c221,_0x11c2c8,_0x4dceb6){const _0x111176=a136_0x38181b;var _0x2c06d9=arguments[_0x111176(0x218)],_0x40dce5=_0x2c06d9<0x3?_0x29c221:_0x4dceb6===null?_0x4dceb6=Object[_0x111176(0x1da)](_0x29c221,_0x11c2c8):_0x4dceb6,_0x21885b;if(typeof Reflect===_0x111176(0x1f6)&&typeof Reflect[_0x111176(0x1b9)]==='function')_0x40dce5=Reflect['decorate'](_0x188320,_0x29c221,_0x11c2c8,_0x4dceb6);else{for(var _0x103b61=_0x188320[_0x111176(0x218)]-0x1;_0x103b61>=0x0;_0x103b61--)if(_0x21885b=_0x188320[_0x103b61])_0x40dce5=(_0x2c06d9<0x3?_0x21885b(_0x40dce5):_0x2c06d9>0x3?_0x21885b(_0x29c221,_0x11c2c8,_0x40dce5):_0x21885b(_0x29c221,_0x11c2c8))||_0x40dce5;}return _0x2c06d9>0x3&&_0x40dce5&&Object[_0x111176(0x200)](_0x29c221,_0x11c2c8,_0x40dce5),_0x40dce5;},__metadata=this&&this[a136_0x38181b(0x201)]||function(_0xf542c1,_0x23200a){const _0x17a901=a136_0x38181b;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x17a901(0x20a))return Reflect[_0x17a901(0x20b)](_0xf542c1,_0x23200a);},__param=this&&this[a136_0x38181b(0x1de)]||function(_0x17ebf0,_0x1e440f){return function(_0x314f54,_0xe1ac58){_0x1e440f(_0x314f54,_0xe1ac58,_0x17ebf0);};},SoundService_1;Object[a136_0x38181b(0x200)](exports,a136_0x38181b(0x1be),{'value':!![]}),exports[a136_0x38181b(0x207)]=void 0x0;function a136_0x244b(_0x154f23,_0x343751){const _0x21eb79=a136_0x21eb();return a136_0x244b=function(_0x244ba0,_0x1eb61b){_0x244ba0=_0x244ba0-0x19f;let _0x3ff268=_0x21eb79[_0x244ba0];return _0x3ff268;},a136_0x244b(_0x154f23,_0x343751);}const common_1=require('@nestjs/common'),mongoose_1=require(a136_0x38181b(0x1e5)),mongoose_2=require(a136_0x38181b(0x1c5)),path=require(a136_0x38181b(0x1ab)),event_emitter_1=require(a136_0x38181b(0x1ad)),file_1=require('../common/file'),agenda_service_1=require(a136_0x38181b(0x1bc)),enums_1=require(a136_0x38181b(0x1f2)),constants_1=require(a136_0x38181b(0x1e2)),utils_1=require('../common/utils'),path_1=require(a136_0x38181b(0x1ce)),audio_player_1=require(a136_0x38181b(0x219)),sound_1=require(a136_0x38181b(0x1ea)),job_1=require(a136_0x38181b(0x211)),constants_2=require(a136_0x38181b(0x20c)),default_sounds_1=require('./data/default-sounds'),sound_gateway_1=require(a136_0x38181b(0x1fd)),path_2=require(a136_0x38181b(0x1ab)),upload_service_1=require(a136_0x38181b(0x1c1)),text_to_audio_service_1=require(a136_0x38181b(0x1c9)),streaming_service_1=require('../streaming/streaming.service');let SoundService=SoundService_1=class SoundService{constructor(_0x1eab7f,_0x3f8965,_0x14b6fd,_0x411f78,_0x44dabc,_0x539932){const _0x380035=a136_0x38181b;this['soundModel']=_0x1eab7f,this['agendaService']=_0x3f8965,this['uploadService']=_0x14b6fd,this[_0x380035(0x208)]=_0x411f78,this[_0x380035(0x1d6)]=_0x44dabc,this['soundGateway']=_0x539932,this[_0x380035(0x1d4)]=new common_1[(_0x380035(0x1fb))](SoundService_1[_0x380035(0x213)]);}async[a136_0x38181b(0x1bf)](_0x4f2687){const _0x27fc5a=a136_0x38181b;await this[_0x27fc5a(0x1b5)](_0x4f2687,null);const _0x3afde2=new this[(_0x27fc5a(0x1f3))](_0x4f2687);return _0x3afde2[_0x27fc5a(0x1dc)]();}async[a136_0x38181b(0x1ac)](_0x49455a){const _0x517b2f=a136_0x38181b,_0x5ba02a=await this['soundModel']['find']({'type':_0x49455a})[_0x517b2f(0x1a8)]();return _0x5ba02a;}async[a136_0x38181b(0x20d)](_0x489245){const _0x3e6a3f=a136_0x38181b,_0x949ff=await this[_0x3e6a3f(0x1f3)][_0x3e6a3f(0x1bb)](_0x489245);return _0x949ff;}async[a136_0x38181b(0x1ca)](_0x259b4f){const _0x3c209c=a136_0x38181b,_0x11297b=await this[_0x3c209c(0x1f3)]['find']({'_id':{'$in':_0x259b4f}});return _0x11297b;}async[a136_0x38181b(0x209)](_0x655a65,_0x2addb8){const _0x20d02d=a136_0x38181b,_0x9ca742=await this[_0x20d02d(0x1f3)][_0x20d02d(0x1bb)](_0x655a65)[_0x20d02d(0x1a8)]();if(!_0x9ca742)throw new Error(_0x20d02d(0x1f8));await this[_0x20d02d(0x1b5)](_0x2addb8,_0x9ca742===null||_0x9ca742===void 0x0?void 0x0:_0x9ca742[_0x20d02d(0x1d5)]);const _0x4671b3=await this[_0x20d02d(0x1f3)][_0x20d02d(0x1b1)](_0x655a65,Object[_0x20d02d(0x214)](Object[_0x20d02d(0x214)]({},_0x2addb8),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x4671b3;}async[a136_0x38181b(0x19f)](_0xb03138,_0x402ae8){const _0x1f5110=a136_0x38181b,_0x477cea=await this[_0x1f5110(0x1f3)]['findById'](_0xb03138)[_0x1f5110(0x1a8)]();if(!_0x477cea)throw new Error(_0x1f5110(0x1f8));const _0x481089=await this['soundModel']['findByIdAndUpdate'](_0xb03138,Object[_0x1f5110(0x214)](Object['assign']({},_0x402ae8),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x481089;}async[a136_0x38181b(0x1a3)](_0x52d9c4){const _0x384b11=a136_0x38181b,_0x5341e6=await this[_0x384b11(0x1f3)][_0x384b11(0x1ae)](_0x52d9c4);if(_0x5341e6[_0x384b11(0x1d5)]){const _0x468ae2=constants_1['AUDIO_DIR']+'/'+_0x5341e6[_0x384b11(0x1d5)];try{(0x0,file_1[_0x384b11(0x1cb)])(_0x468ae2);}catch(_0x15335c){this[_0x384b11(0x1d4)][_0x384b11(0x1e1)](_0x15335c);}}return _0x5341e6;}async[a136_0x38181b(0x1fe)](_0x4b1c87,_0x1e602a){const _0x285037=a136_0x38181b,_0x1838f5=await this[_0x285037(0x1f3)][_0x285037(0x1bb)](_0x4b1c87)[_0x285037(0x1a8)](),_0x4c7e84=_0x1838f5===null||_0x1838f5===void 0x0?void 0x0:_0x1838f5['fileName'],_0x56cc38=this[_0x285037(0x1f4)](_0x1e602a['originalname']),_0x272f5d=constants_1[_0x285037(0x1a2)]+'/'+_0x56cc38;await(0x0,file_1[_0x285037(0x1c7)])(_0x1e602a[_0x285037(0x1ab)],_0x272f5d);const _0x190c51={'fileName':_0x56cc38},_0x307209=await this[_0x285037(0x1f3)]['findByIdAndUpdate'](_0x4b1c87,Object[_0x285037(0x214)](Object[_0x285037(0x214)]({},_0x190c51),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0x4c7e84){const _0x32caa3=constants_1[_0x285037(0x1a2)]+'/'+_0x4c7e84;(0x0,file_1[_0x285037(0x1cb)])(_0x32caa3);}return _0x307209;}async['playSoundOnEvent'](_0x15fd3d){const _0x303e88=a136_0x38181b,{soundId:_0x2c2eb2,jobId:_0x26710c,durationInSecond:_0x20c8f2}=_0x15fd3d,_0x2bfb9c=await this[_0x303e88(0x20d)](_0x2c2eb2),_0x25d370=path[_0x303e88(0x1e8)](path_1[_0x303e88(0x210)],_0x303e88(0x1dd),_0x303e88(0x1d7),_0x2bfb9c[_0x303e88(0x1d5)]);if(!(0x0,file_1[_0x303e88(0x1db)])(_0x25d370)){this[_0x303e88(0x1d4)][_0x303e88(0x1e1)](_0x303e88(0x206)+_0x25d370);return;}job_1[_0x303e88(0x1aa)][_0x303e88(0x1d1)](),this['logger'][_0x303e88(0x1a4)](_0x303e88(0x1c3)+_0x2c2eb2+_0x303e88(0x1b6)+_0x2bfb9c[_0x303e88(0x213)]),(0x0,job_1['executeJob'])({'jobId':_0x26710c,'run':()=>audio_player_1['AudioPlayer'][_0x303e88(0x1ba)](_0x25d370,_0x2bfb9c['volume']),'next':()=>this[_0x303e88(0x205)](_0x2c2eb2),'durationInSecond':_0x20c8f2}),this[_0x303e88(0x202)][_0x303e88(0x1ef)]({'id':_0x2c2eb2,'isPlaying':!![]});}async[a136_0x38181b(0x215)](_0x1e0df7){const _0x4189a6=a136_0x38181b,{voiceId:_0x481794,jobId:_0x7db160,durationInSecond:_0x20406d}=_0x1e0df7,_0x56add6=await this[_0x4189a6(0x1f0)][_0x4189a6(0x1c2)](_0x481794),_0x19bf18=_0x56add6[_0x4189a6(0x1ec)],_0x3e9d76=(0x0,path_2['join'])(process['cwd'](),_0x19bf18);if(!(0x0,file_1[_0x4189a6(0x1db)])(_0x3e9d76)){this[_0x4189a6(0x1d4)][_0x4189a6(0x1e1)](_0x4189a6(0x1d9)+_0x3e9d76);return;}job_1[_0x4189a6(0x1aa)][_0x4189a6(0x1d1)](),this[_0x4189a6(0x1d4)]['log'](_0x4189a6(0x1c4)+_0x481794),(0x0,job_1[_0x4189a6(0x1f1)])({'jobId':_0x7db160,'run':()=>audio_player_1[_0x4189a6(0x1b2)]['playAsync'](_0x3e9d76),'durationInSecond':_0x20406d,'next':()=>null});}async[a136_0x38181b(0x1bd)](_0x4c7130){const _0x42958a=a136_0x38181b,{textToAudioId:_0x11ab9b,jobId:_0x583c15,durationInSecond:_0x335758}=_0x4c7130,{message:_0x10f52c}=await this[_0x42958a(0x208)][_0x42958a(0x1d8)](_0x11ab9b);job_1[_0x42958a(0x1aa)][_0x42958a(0x1d1)](),(0x0,job_1['executeJob'])({'jobId':_0x583c15,'run':()=>{const _0x40470b=_0x42958a;let _0x2194c7=null;return this[_0x40470b(0x208)][_0x40470b(0x1c0)](_0x10f52c,_0x4bbb29=>{const _0x2aec93=_0x40470b;_0x2194c7=this[_0x2aec93(0x1d6)]['playStreamAudioAsync'](_0x4bbb29);}),_0x2194c7;},'durationInSecond':_0x335758,'next':()=>null});}async[a136_0x38181b(0x1b8)](_0x487f2a,_0x274be9,_0x2f66ea=![]){const _0x417755=a136_0x38181b,_0x578052={'when':'now','jobType':enums_1[_0x417755(0x1d2)][_0x417755(0x1d0)],'attributes':{'soundId':_0x274be9,'durationInSecond':_0x2f66ea?0x15180:undefined},'audit':{'actor':_0x487f2a,'name':enums_1['JobType'][_0x417755(0x1d0)],'message':'Play\x20sound:\x20'+_0x274be9}},_0x18daf1=await this[_0x417755(0x1f3)][_0x417755(0x20d)]({'jobId':{'$ne':null}});_0x18daf1&&await this[_0x417755(0x205)](_0x18daf1['id']);const {jobId:_0x58f642}=await this[_0x417755(0x1e6)][_0x417755(0x1a1)](_0x578052);return this['update'](_0x274be9,{'jobId':_0x58f642});}async['stop'](_0x3f755a){const _0x599508=a136_0x38181b;let _0x14241d=await this[_0x599508(0x20d)](_0x3f755a);const {jobId:_0xee80d8}=_0x14241d||{};if(_0xee80d8){const {success:_0x378f52}=await this[_0x599508(0x1e6)][_0x599508(0x1eb)](_0xee80d8);_0x378f52&&(_0x14241d=await this[_0x599508(0x209)](_0x3f755a,{'jobId':null}));}return this[_0x599508(0x202)][_0x599508(0x1ef)]({'id':_0x14241d['id'],'isPlaying':![]}),_0x14241d;}async[a136_0x38181b(0x1f5)](){const _0x56af29=a136_0x38181b,_0x1bade7=await this[_0x56af29(0x1ac)](constants_2[_0x56af29(0x1b0)]['Tune']);if(_0x1bade7[_0x56af29(0x218)]>0x0){const _0x2e741d=[];_0x1bade7[_0x56af29(0x203)](_0x420a72=>{const _0x4534cf=_0x56af29;_0x2e741d[_0x4534cf(0x1a0)](this['delete'](_0x420a72['_id']));}),await Promise[_0x56af29(0x1b3)](_0x2e741d);}await(0x0,file_1[_0x56af29(0x1e3)])(constants_1[_0x56af29(0x1fa)],constants_1[_0x56af29(0x1cc)]);const _0x555602=[];return default_sounds_1[_0x56af29(0x1ee)][_0x56af29(0x203)](_0x3da768=>{const _0x270d45=_0x56af29;_0x555602['push'](this[_0x270d45(0x1bf)](Object[_0x270d45(0x214)]({},_0x3da768)));}),await Promise['all'](_0x555602),!![];}[a136_0x38181b(0x1f4)](_0x42548e){const _0x7299dc=a136_0x38181b,_0x30d597=_0x42548e['split']('.')[_0x7299dc(0x1b7)]();return(0x0,utils_1[_0x7299dc(0x1d3)])()+'.'+_0x30d597;}async[a136_0x38181b(0x1b5)](_0x225f17,_0x5e0011){const _0xf2d5a7=a136_0x38181b;if(!_0x225f17['fileName'])return;const _0x7357e8=constants_1['TMP_UPLOAD_DIR']+'/'+_0x225f17[_0xf2d5a7(0x1d5)],_0x44e6c0=_0x5e0011||this[_0xf2d5a7(0x1f4)](_0x225f17[_0xf2d5a7(0x1d5)]),_0xc12dfe=constants_1[_0xf2d5a7(0x1a2)]+'/'+_0x44e6c0;if(!(0x0,file_1[_0xf2d5a7(0x1db)])(_0x7357e8))throw new Error(_0xf2d5a7(0x1e4));!(0x0,file_1[_0xf2d5a7(0x1db)])(constants_1[_0xf2d5a7(0x1a2)])&&(0x0,file_1[_0xf2d5a7(0x20e)])(constants_1[_0xf2d5a7(0x1a2)]),await(0x0,file_1['moveFile'])(_0x7357e8,_0xc12dfe),_0x225f17[_0xf2d5a7(0x1d5)]=_0x44e6c0;}};__decorate([(0x0,event_emitter_1['OnEvent'])(sound_1[a136_0x38181b(0x204)][a136_0x38181b(0x1cd)]),__metadata(a136_0x38181b(0x1e9),Function),__metadata('design:paramtypes',[Object]),__metadata(a136_0x38181b(0x216),Promise)],SoundService[a136_0x38181b(0x1cf)],'playSoundOnEvent',null),__decorate([(0x0,event_emitter_1['OnEvent'])(sound_1[a136_0x38181b(0x204)][a136_0x38181b(0x1df)]),__metadata(a136_0x38181b(0x1e9),Function),__metadata(a136_0x38181b(0x1a7),[Object]),__metadata(a136_0x38181b(0x216),Promise)],SoundService[a136_0x38181b(0x1cf)],a136_0x38181b(0x215),null),__decorate([(0x0,event_emitter_1[a136_0x38181b(0x212)])(sound_1[a136_0x38181b(0x204)][a136_0x38181b(0x20f)]),__metadata('design:type',Function),__metadata(a136_0x38181b(0x1a7),[Object]),__metadata('design:returntype',Promise)],SoundService[a136_0x38181b(0x1cf)],a136_0x38181b(0x1bd),null),SoundService=SoundService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_1[a136_0x38181b(0x1a5)])('Sound')),__param(0x5,(0x0,common_1[a136_0x38181b(0x1c8)])(sound_gateway_1['SoundGateway'])),__metadata(a136_0x38181b(0x1a7),[mongoose_2[a136_0x38181b(0x1a6)],agenda_service_1['AgendaService'],upload_service_1[a136_0x38181b(0x1fc)],text_to_audio_service_1['TextToAudioService'],streaming_service_1[a136_0x38181b(0x1f7)],sound_gateway_1['SoundGateway']])],SoundService),exports[a136_0x38181b(0x207)]=SoundService;