'use strict';const a136_0x532cdf=a136_0x3f7a;(function(_0x52e305,_0x726cda){const _0x2a12d2=a136_0x3f7a,_0x391d28=_0x52e305();while(!![]){try{const _0xa20ab=-parseInt(_0x2a12d2(0x15d))/0x1*(-parseInt(_0x2a12d2(0x13a))/0x2)+-parseInt(_0x2a12d2(0x147))/0x3+parseInt(_0x2a12d2(0x161))/0x4*(-parseInt(_0x2a12d2(0x14c))/0x5)+-parseInt(_0x2a12d2(0x14e))/0x6+parseInt(_0x2a12d2(0x168))/0x7+parseInt(_0x2a12d2(0x108))/0x8+parseInt(_0x2a12d2(0x173))/0x9;if(_0xa20ab===_0x726cda)break;else _0x391d28['push'](_0x391d28['shift']());}catch(_0x2d212d){_0x391d28['push'](_0x391d28['shift']());}}}(a136_0x2516,0x98df8));function a136_0x3f7a(_0x5b9815,_0x2f23ab){const _0x2516a3=a136_0x2516();return a136_0x3f7a=function(_0x3f7ae9,_0x403f26){_0x3f7ae9=_0x3f7ae9-0x102;let _0x2fc4=_0x2516a3[_0x3f7ae9];return _0x2fc4;},a136_0x3f7a(_0x5b9815,_0x2f23ab);}var __decorate=this&&this['__decorate']||function(_0x4c8d9e,_0x2a3be5,_0x1a87f1,_0x5ec691){const _0x24178c=a136_0x3f7a;var _0x25e206=arguments[_0x24178c(0x171)],_0x92c1be=_0x25e206<0x3?_0x2a3be5:_0x5ec691===null?_0x5ec691=Object[_0x24178c(0x14f)](_0x2a3be5,_0x1a87f1):_0x5ec691,_0x41a403;if(typeof Reflect===_0x24178c(0x104)&&typeof Reflect[_0x24178c(0x156)]===_0x24178c(0x13c))_0x92c1be=Reflect[_0x24178c(0x156)](_0x4c8d9e,_0x2a3be5,_0x1a87f1,_0x5ec691);else{for(var _0x9dcb1=_0x4c8d9e['length']-0x1;_0x9dcb1>=0x0;_0x9dcb1--)if(_0x41a403=_0x4c8d9e[_0x9dcb1])_0x92c1be=(_0x25e206<0x3?_0x41a403(_0x92c1be):_0x25e206>0x3?_0x41a403(_0x2a3be5,_0x1a87f1,_0x92c1be):_0x41a403(_0x2a3be5,_0x1a87f1))||_0x92c1be;}return _0x25e206>0x3&&_0x92c1be&&Object[_0x24178c(0x15c)](_0x2a3be5,_0x1a87f1,_0x92c1be),_0x92c1be;},__metadata=this&&this['__metadata']||function(_0x3327ee,_0xb107c6){const _0xdeb158=a136_0x3f7a;if(typeof Reflect===_0xdeb158(0x104)&&typeof Reflect['metadata']===_0xdeb158(0x13c))return Reflect[_0xdeb158(0x148)](_0x3327ee,_0xb107c6);},__param=this&&this['__param']||function(_0x4f7164,_0x18605d){return function(_0x267429,_0x122af8){_0x18605d(_0x267429,_0x122af8,_0x4f7164);};},SoundService_1;Object['defineProperty'](exports,a136_0x532cdf(0x13b),{'value':!![]}),exports[a136_0x532cdf(0x146)]=void 0x0;function a136_0x2516(){const _0x3548dc=['SoundService','1881522CVxqIR','metadata','agendaService','Voice\x20file\x20not\x20found:\x20','getMessageById','3635UKtwLR','design:paramtypes','3058986zNZRqK','getOwnPropertyDescriptor','design:type','soundGateway','fileName','updateVolume','UploadService','all','decorate','StreamingService','exec','logger','Sound\x20not\x20found!','../common/path','defineProperty','919834iRwxig','Logger','findById','playTextToAudioRecorded','4948jRMSNc','save','resetTunes','Playing\x20voice\x20recorded:\x20','uploadService','audio','AudioPlayer','8335810UWrxTG','InjectModel','getNewFileName','PlaySound','@nestjs/mongoose','originalname','upload','../common/enums','deleteFile','length','\x20-\x20','2624076xNYraO','mongoose','JobType','killAll','stop','../common/events/sound','Inject','push','volume','pop','playVoiceRecorded','Model','uuid','Sound','../common/audio/audio-player','object','@nestjs/event-emitter','assign','OnEvent','2081952coRJKz','findByIdAndUpdate','SoundGateway','PROCESS_CACHE','../text-to-audio/text-to-audio.service','../agenda/agenda.service','name','assets','Tune','Injectable','error','_id','streamingService','SoundType','forEach','design:returntype','../common/file','textToAudio','find','playStreamAudioAsync','prototype','Play\x20sound:\x20','validateAndMoveFileAsync','moveFile','Play','soundModel','path','../upload/upload.service','textToAudioService','update','../streaming/streaming.service','copyFiles','broadcastPlaying','scheduleJob','DEFAULT_TUNES_DIR','TMP_UPLOAD_DIR','playSoundOnEvent','cwd','playAsync','./data/default-sounds','filePath','TextToAudio','AUDIO_DIR','create','isFileExist','now','log','findByIdAndDelete','findOne','VoiceRecorded','2uuxUWu','__esModule','function','processRootPath','findByType','SoundEvent','executeJob','File\x20not\x20found!','Sound\x20file\x20not\x20found:\x20','join','delete','Playing\x20sound:\x20'];a136_0x2516=function(){return _0x3548dc;};return a136_0x2516();}const common_1=require('@nestjs/common'),mongoose_1=require(a136_0x532cdf(0x16c)),mongoose_2=require(a136_0x532cdf(0x174)),path=require(a136_0x532cdf(0x122)),event_emitter_1=require(a136_0x532cdf(0x105)),file_1=require(a136_0x532cdf(0x118)),agenda_service_1=require(a136_0x532cdf(0x10d)),enums_1=require(a136_0x532cdf(0x16f)),constants_1=require('../common/constants'),utils_1=require('../common/utils'),path_1=require(a136_0x532cdf(0x15b)),audio_player_1=require(a136_0x532cdf(0x103)),sound_1=require(a136_0x532cdf(0x178)),job_1=require('../common/job'),constants_2=require('./constants'),default_sounds_1=require(a136_0x532cdf(0x12f)),sound_gateway_1=require('./sound.gateway'),path_2=require(a136_0x532cdf(0x122)),upload_service_1=require(a136_0x532cdf(0x123)),text_to_audio_service_1=require(a136_0x532cdf(0x10c)),streaming_service_1=require(a136_0x532cdf(0x126));let SoundService=SoundService_1=class SoundService{constructor(_0x1261d4,_0x456186,_0x506549,_0x4f35a3,_0x51da97,_0x318389){const _0xcf733a=a136_0x532cdf;this['soundModel']=_0x1261d4,this[_0xcf733a(0x149)]=_0x456186,this['uploadService']=_0x506549,this[_0xcf733a(0x124)]=_0x4f35a3,this[_0xcf733a(0x114)]=_0x51da97,this[_0xcf733a(0x151)]=_0x318389,this[_0xcf733a(0x159)]=new common_1[(_0xcf733a(0x15e))](SoundService_1[_0xcf733a(0x10e)]);}async[a136_0x532cdf(0x133)](_0x48ee6e){const _0x576930=a136_0x532cdf;await this[_0x576930(0x11e)](_0x48ee6e,null);const _0xfbe31a=new this[(_0x576930(0x121))](_0x48ee6e);return _0xfbe31a[_0x576930(0x162)]();}async[a136_0x532cdf(0x13e)](_0x4c29b3){const _0x842089=a136_0x532cdf,_0xa88515=await this[_0x842089(0x121)]['find']({'type':_0x4c29b3})[_0x842089(0x158)]();return _0xa88515;}async[a136_0x532cdf(0x138)](_0x1710bb){const _0x13997a=a136_0x532cdf,_0x582937=await this[_0x13997a(0x121)][_0x13997a(0x15f)](_0x1710bb);return _0x582937;}async['findByIds'](_0x30c50c){const _0x21d7bf=a136_0x532cdf,_0x26d54c=await this[_0x21d7bf(0x121)][_0x21d7bf(0x11a)]({'_id':{'$in':_0x30c50c}});return _0x26d54c;}async[a136_0x532cdf(0x125)](_0x356133,_0x3bbe72){const _0x5d15a7=a136_0x532cdf,_0x554fc7=await this[_0x5d15a7(0x121)][_0x5d15a7(0x15f)](_0x356133)['exec']();if(!_0x554fc7)throw new Error(_0x5d15a7(0x15a));await this[_0x5d15a7(0x11e)](_0x3bbe72,_0x554fc7===null||_0x554fc7===void 0x0?void 0x0:_0x554fc7['fileName']);const _0x1ad01b=await this[_0x5d15a7(0x121)]['findByIdAndUpdate'](_0x356133,Object['assign'](Object[_0x5d15a7(0x106)]({},_0x3bbe72),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x1ad01b;}async[a136_0x532cdf(0x153)](_0x52320a,_0x57c99b){const _0x279a0e=a136_0x532cdf,_0xb99dbb=await this[_0x279a0e(0x121)]['findById'](_0x52320a)[_0x279a0e(0x158)]();if(!_0xb99dbb)throw new Error('Sound\x20not\x20found!');const _0x39dff8=await this[_0x279a0e(0x121)]['findByIdAndUpdate'](_0x52320a,Object[_0x279a0e(0x106)](Object[_0x279a0e(0x106)]({},_0x57c99b),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x39dff8;}async[a136_0x532cdf(0x144)](_0x3a9ce1){const _0x678d09=a136_0x532cdf,_0x102cb3=await this[_0x678d09(0x121)][_0x678d09(0x137)](_0x3a9ce1);if(_0x102cb3[_0x678d09(0x152)]){const _0x3a7e7d=constants_1['AUDIO_DIR']+'/'+_0x102cb3[_0x678d09(0x152)];try{(0x0,file_1['deleteFile'])(_0x3a7e7d);}catch(_0x14f692){this[_0x678d09(0x159)][_0x678d09(0x112)](_0x14f692);}}return _0x102cb3;}async[a136_0x532cdf(0x16e)](_0x13c2fc,_0xb14bb){const _0x4defe0=a136_0x532cdf,_0x3922c9=await this['soundModel'][_0x4defe0(0x15f)](_0x13c2fc)[_0x4defe0(0x158)](),_0x35f384=_0x3922c9===null||_0x3922c9===void 0x0?void 0x0:_0x3922c9['fileName'],_0x23da0c=this[_0x4defe0(0x16a)](_0xb14bb[_0x4defe0(0x16d)]),_0x1c511c=constants_1[_0x4defe0(0x132)]+'/'+_0x23da0c;await(0x0,file_1[_0x4defe0(0x11f)])(_0xb14bb['path'],_0x1c511c);const _0x16115a={'fileName':_0x23da0c},_0x124089=await this[_0x4defe0(0x121)][_0x4defe0(0x109)](_0x13c2fc,Object[_0x4defe0(0x106)](Object[_0x4defe0(0x106)]({},_0x16115a),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0x35f384){const _0x31cd81=constants_1['AUDIO_DIR']+'/'+_0x35f384;(0x0,file_1[_0x4defe0(0x170)])(_0x31cd81);}return _0x124089;}async[a136_0x532cdf(0x12c)](_0x390237){const _0x11ab9f=a136_0x532cdf,{soundId:_0x22d5f8,jobId:_0x8aa597,durationInSecond:_0x5107c4}=_0x390237,_0x1bd906=await this[_0x11ab9f(0x138)](_0x22d5f8),_0x1c7815=path[_0x11ab9f(0x143)](path_1[_0x11ab9f(0x13d)],_0x11ab9f(0x10f),_0x11ab9f(0x166),_0x1bd906['fileName']);if(!(0x0,file_1[_0x11ab9f(0x134)])(_0x1c7815)){this[_0x11ab9f(0x159)][_0x11ab9f(0x112)](_0x11ab9f(0x142)+_0x1c7815);return;}job_1[_0x11ab9f(0x10b)]['killAll'](),this[_0x11ab9f(0x159)][_0x11ab9f(0x136)](_0x11ab9f(0x145)+_0x22d5f8+_0x11ab9f(0x172)+_0x1bd906['name']),(0x0,job_1[_0x11ab9f(0x140)])({'jobId':_0x8aa597,'run':()=>audio_player_1['AudioPlayer'][_0x11ab9f(0x12e)](_0x1c7815,_0x1bd906[_0x11ab9f(0x17b)]),'next':()=>this[_0x11ab9f(0x177)](_0x22d5f8),'durationInSecond':_0x5107c4}),this[_0x11ab9f(0x151)]['broadcastPlaying']({'id':_0x22d5f8,'isPlaying':!![]});}async[a136_0x532cdf(0x17d)](_0x5f2ea4){const _0x547e69=a136_0x532cdf,{voiceId:_0x54c5c1,jobId:_0xdece51,durationInSecond:_0x89c7ce}=_0x5f2ea4,_0x8289fb=await this[_0x547e69(0x165)]['findVoiceRecoredById'](_0x54c5c1),_0x314756=_0x8289fb[_0x547e69(0x130)],_0x57662d=(0x0,path_2[_0x547e69(0x143)])(process[_0x547e69(0x12d)](),_0x314756);if(!(0x0,file_1[_0x547e69(0x134)])(_0x57662d)){this['logger'][_0x547e69(0x112)](_0x547e69(0x14a)+_0x57662d);return;}job_1[_0x547e69(0x10b)][_0x547e69(0x176)](),this['logger'][_0x547e69(0x136)](_0x547e69(0x164)+_0x54c5c1),(0x0,job_1['executeJob'])({'jobId':_0xdece51,'run':()=>audio_player_1[_0x547e69(0x167)][_0x547e69(0x12e)](_0x57662d),'durationInSecond':_0x89c7ce,'next':()=>null});}async[a136_0x532cdf(0x160)](_0x4f0858){const _0x96002e=a136_0x532cdf,{textToAudioId:_0x426d31,jobId:_0x51e90f,durationInSecond:_0x462ef8}=_0x4f0858,{message:_0x3e15cd}=await this[_0x96002e(0x124)][_0x96002e(0x14b)](_0x426d31);job_1[_0x96002e(0x10b)][_0x96002e(0x176)](),(0x0,job_1[_0x96002e(0x140)])({'jobId':_0x51e90f,'run':()=>{const _0x3db597=_0x96002e;let _0x475c4d=null;return this[_0x3db597(0x124)][_0x3db597(0x119)](_0x3e15cd,_0x59e449=>{const _0x3ee3ce=_0x3db597;_0x475c4d=this[_0x3ee3ce(0x114)][_0x3ee3ce(0x11b)](_0x59e449);}),_0x475c4d;},'durationInSecond':_0x462ef8,'next':()=>null});}async['play'](_0x12c365,_0x43291d,_0x1b8c8e=![]){const _0x4e1d7e=a136_0x532cdf,_0x3736d6={'when':_0x4e1d7e(0x135),'jobType':enums_1[_0x4e1d7e(0x175)][_0x4e1d7e(0x16b)],'attributes':{'soundId':_0x43291d,'durationInSecond':_0x1b8c8e?0x15180:undefined},'audit':{'actor':_0x12c365,'name':enums_1[_0x4e1d7e(0x175)][_0x4e1d7e(0x16b)],'message':_0x4e1d7e(0x11d)+_0x43291d}},_0x24d83f=await this['soundModel']['findOne']({'jobId':{'$ne':null}});_0x24d83f&&await this[_0x4e1d7e(0x177)](_0x24d83f['id']);const {jobId:_0x750561}=await this['agendaService'][_0x4e1d7e(0x129)](_0x3736d6);return this[_0x4e1d7e(0x125)](_0x43291d,{'jobId':_0x750561});}async[a136_0x532cdf(0x177)](_0x386932){const _0x55b88d=a136_0x532cdf;let _0x2c5017=await this['findOne'](_0x386932);const {jobId:_0x2345fe}=_0x2c5017||{};if(_0x2345fe){const {success:_0x5cb0a0}=await this[_0x55b88d(0x149)]['cancelJob'](_0x2345fe);_0x5cb0a0&&(_0x2c5017=await this[_0x55b88d(0x125)](_0x386932,{'jobId':null}));}return this[_0x55b88d(0x151)][_0x55b88d(0x128)]({'id':_0x2c5017['id'],'isPlaying':![]}),_0x2c5017;}async[a136_0x532cdf(0x163)](){const _0x4fa4a5=a136_0x532cdf,_0x2df443=await this[_0x4fa4a5(0x13e)](constants_2[_0x4fa4a5(0x115)][_0x4fa4a5(0x110)]);if(_0x2df443[_0x4fa4a5(0x171)]>0x0){const _0x3ca771=[];_0x2df443[_0x4fa4a5(0x116)](_0x3415f7=>{const _0x5613e8=_0x4fa4a5;_0x3ca771[_0x5613e8(0x17a)](this[_0x5613e8(0x144)](_0x3415f7[_0x5613e8(0x113)]));}),await Promise[_0x4fa4a5(0x155)](_0x3ca771);}await(0x0,file_1[_0x4fa4a5(0x127)])(constants_1[_0x4fa4a5(0x12a)],constants_1['TMP_UPLOAD_DIR']);const _0x2b27d1=[];return default_sounds_1['DEFAULT_TUNES'][_0x4fa4a5(0x116)](_0x7c377e=>{const _0x58f1d8=_0x4fa4a5;_0x2b27d1[_0x58f1d8(0x17a)](this[_0x58f1d8(0x133)](Object[_0x58f1d8(0x106)]({},_0x7c377e)));}),await Promise[_0x4fa4a5(0x155)](_0x2b27d1),!![];}['getNewFileName'](_0x386af2){const _0x16484a=a136_0x532cdf,_0x8a99d1=_0x386af2['split']('.')[_0x16484a(0x17c)]();return(0x0,utils_1[_0x16484a(0x17f)])()+'.'+_0x8a99d1;}async[a136_0x532cdf(0x11e)](_0x1825cc,_0x19f992){const _0x6f0d19=a136_0x532cdf;if(!_0x1825cc[_0x6f0d19(0x152)])return;const _0x3ff1f7=constants_1[_0x6f0d19(0x12b)]+'/'+_0x1825cc[_0x6f0d19(0x152)],_0x55c4ec=_0x19f992||this[_0x6f0d19(0x16a)](_0x1825cc[_0x6f0d19(0x152)]),_0x247b27=constants_1[_0x6f0d19(0x132)]+'/'+_0x55c4ec;if(!(0x0,file_1['isFileExist'])(_0x3ff1f7))throw new Error(_0x6f0d19(0x141));!(0x0,file_1[_0x6f0d19(0x134)])(constants_1[_0x6f0d19(0x132)])&&(0x0,file_1['createFolder'])(constants_1[_0x6f0d19(0x132)]),await(0x0,file_1[_0x6f0d19(0x11f)])(_0x3ff1f7,_0x247b27),_0x1825cc[_0x6f0d19(0x152)]=_0x55c4ec;}};__decorate([(0x0,event_emitter_1['OnEvent'])(sound_1['SoundEvent'][a136_0x532cdf(0x120)]),__metadata(a136_0x532cdf(0x150),Function),__metadata(a136_0x532cdf(0x14d),[Object]),__metadata(a136_0x532cdf(0x117),Promise)],SoundService[a136_0x532cdf(0x11c)],a136_0x532cdf(0x12c),null),__decorate([(0x0,event_emitter_1[a136_0x532cdf(0x107)])(sound_1['SoundEvent'][a136_0x532cdf(0x139)]),__metadata(a136_0x532cdf(0x150),Function),__metadata('design:paramtypes',[Object]),__metadata(a136_0x532cdf(0x117),Promise)],SoundService[a136_0x532cdf(0x11c)],a136_0x532cdf(0x17d),null),__decorate([(0x0,event_emitter_1['OnEvent'])(sound_1[a136_0x532cdf(0x13f)][a136_0x532cdf(0x131)]),__metadata(a136_0x532cdf(0x150),Function),__metadata(a136_0x532cdf(0x14d),[Object]),__metadata(a136_0x532cdf(0x117),Promise)],SoundService[a136_0x532cdf(0x11c)],a136_0x532cdf(0x160),null),SoundService=SoundService_1=__decorate([(0x0,common_1[a136_0x532cdf(0x111)])(),__param(0x0,(0x0,mongoose_1[a136_0x532cdf(0x169)])(a136_0x532cdf(0x102))),__param(0x5,(0x0,common_1[a136_0x532cdf(0x179)])(sound_gateway_1[a136_0x532cdf(0x10a)])),__metadata(a136_0x532cdf(0x14d),[mongoose_2[a136_0x532cdf(0x17e)],agenda_service_1['AgendaService'],upload_service_1[a136_0x532cdf(0x154)],text_to_audio_service_1['TextToAudioService'],streaming_service_1[a136_0x532cdf(0x157)],sound_gateway_1['SoundGateway']])],SoundService),exports[a136_0x532cdf(0x146)]=SoundService;