'use strict';function a136_0x3b21(_0x21ad0a,_0x36f5d6){const _0x51a18c=a136_0x51a1();return a136_0x3b21=function(_0x3b21be,_0x5047dd){_0x3b21be=_0x3b21be-0x1d2;let _0x4b0cd2=_0x51a18c[_0x3b21be];return _0x4b0cd2;},a136_0x3b21(_0x21ad0a,_0x36f5d6);}const a136_0x36c0c0=a136_0x3b21;function a136_0x51a1(){const _0x34fb7c=['audio','TMP_UPLOAD_DIR','getOwnPropertyDescriptor','File\x20not\x20found!','@nestjs/event-emitter','33428vGMTRz','assets','PlaySound','createFolder','assign','processRootPath','findOne','8ZPPCTs','moveFile','6850280DIgAdA','SoundEvent','originalname','findByType','error','cancelJob','SoundService','killAll','findByIds','./constants','playAsync','Sound','Logger','__metadata','play','exec','StreamingService','66CxaOEa','Injectable','deleteFile','Model','design:paramtypes','all','Play\x20sound:\x20','Playing\x20voice\x20recorded:\x20','@nestjs/common','PROCESS_CACHE','stop','function','@nestjs/mongoose','broadcastPlaying','../common/constants','5337144YkHUMr','save','split','playSoundOnEvent','../common/path','./data/default-sounds','prototype','AUDIO_DIR','Play','forEach','uuid','upload','OnEvent','soundGateway','delete','executeJob','../text-to-audio/text-to-audio.service','filePath','__param','logger','path','../common/job','agendaService','DEFAULT_TUNES_DIR','streamingService','../common/events/sound','defineProperty','update','push','../common/audio/audio-player','InjectModel','log','playStreamAudioAsync','create','../upload/upload.service','pop','../common/enums','Playing\x20sound:\x20','validateAndMoveFileAsync','__esModule','22046616abhvGN','1030355vIATMH','6645048tECzWH','find','object','now','findByIdAndUpdate','findById','Sound\x20file\x20not\x20found:\x20','mongoose','getNewFileName','metadata','name','design:type','playTextToAudioRecorded','Sound\x20not\x20found!','\x20-\x20','JobType','UploadService','isFileExist','length','updateVolume','volume','AudioPlayer','../streaming/streaming.service','SoundGateway','uploadService','DEFAULT_TUNES','playVoiceRecorded','soundModel','textToAudio','fileName','scheduleJob','41146OqlKOV','join','copyFiles','TextToAudio','__decorate','textToAudioService','../agenda/agenda.service','VoiceRecorded'];a136_0x51a1=function(){return _0x34fb7c;};return a136_0x51a1();}(function(_0x569c86,_0x3659c0){const _0x57dcee=a136_0x3b21,_0x1fb82=_0x569c86();while(!![]){try{const _0x2ccfab=-parseInt(_0x57dcee(0x1f3))/0x1+-parseInt(_0x57dcee(0x220))/0x2*(-parseInt(_0x57dcee(0x23a))/0x3)+-parseInt(_0x57dcee(0x249))/0x4+parseInt(_0x57dcee(0x229))/0x5+-parseInt(_0x57dcee(0x1f4))/0x6+-parseInt(_0x57dcee(0x213))/0x7*(parseInt(_0x57dcee(0x227))/0x8)+parseInt(_0x57dcee(0x1f2))/0x9;if(_0x2ccfab===_0x3659c0)break;else _0x1fb82['push'](_0x1fb82['shift']());}catch(_0x5c3ca4){_0x1fb82['push'](_0x1fb82['shift']());}}}(a136_0x51a1,0xad2f1));var __decorate=this&&this[a136_0x36c0c0(0x217)]||function(_0x21d093,_0x1a75eb,_0x56c679,_0x2a09c5){const _0xede48b=a136_0x36c0c0;var _0x2f9cbf=arguments[_0xede48b(0x206)],_0x355d3b=_0x2f9cbf<0x3?_0x1a75eb:_0x2a09c5===null?_0x2a09c5=Object[_0xede48b(0x21d)](_0x1a75eb,_0x56c679):_0x2a09c5,_0x1a6508;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0xede48b(0x245))_0x355d3b=Reflect['decorate'](_0x21d093,_0x1a75eb,_0x56c679,_0x2a09c5);else{for(var _0x4f3eb0=_0x21d093['length']-0x1;_0x4f3eb0>=0x0;_0x4f3eb0--)if(_0x1a6508=_0x21d093[_0x4f3eb0])_0x355d3b=(_0x2f9cbf<0x3?_0x1a6508(_0x355d3b):_0x2f9cbf>0x3?_0x1a6508(_0x1a75eb,_0x56c679,_0x355d3b):_0x1a6508(_0x1a75eb,_0x56c679))||_0x355d3b;}return _0x2f9cbf>0x3&&_0x355d3b&&Object['defineProperty'](_0x1a75eb,_0x56c679,_0x355d3b),_0x355d3b;},__metadata=this&&this[a136_0x36c0c0(0x236)]||function(_0x3dc00d,_0x502f19){const _0x1c59a0=a136_0x36c0c0;if(typeof Reflect===_0x1c59a0(0x1f6)&&typeof Reflect['metadata']==='function')return Reflect[_0x1c59a0(0x1fd)](_0x3dc00d,_0x502f19);},__param=this&&this[a136_0x36c0c0(0x1dc)]||function(_0x299ae8,_0x23dce6){return function(_0x4eaea8,_0x126558){_0x23dce6(_0x4eaea8,_0x126558,_0x299ae8);};},SoundService_1;Object[a136_0x36c0c0(0x1e4)](exports,a136_0x36c0c0(0x1f1),{'value':!![]}),exports[a136_0x36c0c0(0x22f)]=void 0x0;const common_1=require(a136_0x36c0c0(0x242)),mongoose_1=require(a136_0x36c0c0(0x246)),mongoose_2=require(a136_0x36c0c0(0x1fb)),path=require(a136_0x36c0c0(0x1de)),event_emitter_1=require(a136_0x36c0c0(0x21f)),file_1=require('../common/file'),agenda_service_1=require(a136_0x36c0c0(0x219)),enums_1=require(a136_0x36c0c0(0x1ee)),constants_1=require(a136_0x36c0c0(0x248)),utils_1=require('../common/utils'),path_1=require(a136_0x36c0c0(0x24d)),audio_player_1=require(a136_0x36c0c0(0x1e7)),sound_1=require(a136_0x36c0c0(0x1e3)),job_1=require(a136_0x36c0c0(0x1df)),constants_2=require(a136_0x36c0c0(0x232)),default_sounds_1=require(a136_0x36c0c0(0x24e)),sound_gateway_1=require('./sound.gateway'),path_2=require(a136_0x36c0c0(0x1de)),upload_service_1=require(a136_0x36c0c0(0x1ec)),text_to_audio_service_1=require(a136_0x36c0c0(0x1da)),streaming_service_1=require(a136_0x36c0c0(0x20a));let SoundService=SoundService_1=class SoundService{constructor(_0x52eea6,_0x2b60e9,_0x3f2933,_0x55885e,_0x459163,_0x439a47){const _0x3ba33b=a136_0x36c0c0;this[_0x3ba33b(0x20f)]=_0x52eea6,this[_0x3ba33b(0x1e0)]=_0x2b60e9,this[_0x3ba33b(0x20c)]=_0x3f2933,this[_0x3ba33b(0x218)]=_0x55885e,this[_0x3ba33b(0x1e2)]=_0x459163,this[_0x3ba33b(0x1d7)]=_0x439a47,this[_0x3ba33b(0x1dd)]=new common_1[(_0x3ba33b(0x235))](SoundService_1[_0x3ba33b(0x1fe)]);}async['create'](_0x4a735){const _0x5409b3=a136_0x36c0c0;await this[_0x5409b3(0x1f0)](_0x4a735,null);const _0x4e84b0=new this['soundModel'](_0x4a735);return _0x4e84b0[_0x5409b3(0x24a)]();}async[a136_0x36c0c0(0x22c)](_0x8d2e97){const _0x4c7e82=a136_0x36c0c0,_0x2f2698=await this[_0x4c7e82(0x20f)][_0x4c7e82(0x1f5)]({'type':_0x8d2e97})[_0x4c7e82(0x238)]();return _0x2f2698;}async[a136_0x36c0c0(0x226)](_0x3f816e){const _0xd39efd=a136_0x36c0c0,_0x149b7d=await this[_0xd39efd(0x20f)]['findById'](_0x3f816e);return _0x149b7d;}async[a136_0x36c0c0(0x231)](_0x4c23d7){const _0x3c601d=a136_0x36c0c0,_0x1e9a95=await this[_0x3c601d(0x20f)][_0x3c601d(0x1f5)]({'_id':{'$in':_0x4c23d7}});return _0x1e9a95;}async[a136_0x36c0c0(0x1e5)](_0x7a0901,_0x767696){const _0xfaa291=a136_0x36c0c0,_0x2b49fa=await this[_0xfaa291(0x20f)][_0xfaa291(0x1f9)](_0x7a0901)[_0xfaa291(0x238)]();if(!_0x2b49fa)throw new Error(_0xfaa291(0x201));await this[_0xfaa291(0x1f0)](_0x767696,_0x2b49fa===null||_0x2b49fa===void 0x0?void 0x0:_0x2b49fa[_0xfaa291(0x211)]);const _0x46b70b=await this['soundModel'][_0xfaa291(0x1f8)](_0x7a0901,Object[_0xfaa291(0x224)](Object[_0xfaa291(0x224)]({},_0x767696),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x46b70b;}async[a136_0x36c0c0(0x207)](_0x220ca4,_0x4bcf44){const _0x1acca2=a136_0x36c0c0,_0x276b22=await this[_0x1acca2(0x20f)][_0x1acca2(0x1f9)](_0x220ca4)[_0x1acca2(0x238)]();if(!_0x276b22)throw new Error(_0x1acca2(0x201));const _0x2559a8=await this['soundModel'][_0x1acca2(0x1f8)](_0x220ca4,Object[_0x1acca2(0x224)](Object[_0x1acca2(0x224)]({},_0x4bcf44),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x2559a8;}async['delete'](_0x4d0e84){const _0xce62b6=a136_0x36c0c0,_0x39e169=await this['soundModel']['findByIdAndDelete'](_0x4d0e84);if(_0x39e169[_0xce62b6(0x211)]){const _0x5ab20a=constants_1[_0xce62b6(0x250)]+'/'+_0x39e169[_0xce62b6(0x211)];try{(0x0,file_1[_0xce62b6(0x23c)])(_0x5ab20a);}catch(_0x4cb6d1){this['logger'][_0xce62b6(0x22d)](_0x4cb6d1);}}return _0x39e169;}async[a136_0x36c0c0(0x1d5)](_0x4923a5,_0x5e5a71){const _0x474a48=a136_0x36c0c0,_0x3eae3c=await this[_0x474a48(0x20f)][_0x474a48(0x1f9)](_0x4923a5)[_0x474a48(0x238)](),_0x2f8707=_0x3eae3c===null||_0x3eae3c===void 0x0?void 0x0:_0x3eae3c['fileName'],_0x42da1a=this[_0x474a48(0x1fc)](_0x5e5a71[_0x474a48(0x22b)]),_0x243bf7=constants_1[_0x474a48(0x250)]+'/'+_0x42da1a;await(0x0,file_1[_0x474a48(0x228)])(_0x5e5a71['path'],_0x243bf7);const _0x312ea5={'fileName':_0x42da1a},_0x3b260e=await this['soundModel'][_0x474a48(0x1f8)](_0x4923a5,Object['assign'](Object['assign']({},_0x312ea5),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0x2f8707){const _0x41b444=constants_1[_0x474a48(0x250)]+'/'+_0x2f8707;(0x0,file_1[_0x474a48(0x23c)])(_0x41b444);}return _0x3b260e;}async[a136_0x36c0c0(0x24c)](_0x5059d1){const _0x37824d=a136_0x36c0c0,{soundId:_0x42d55c,jobId:_0x18caf1,durationInSecond:_0x5ab318}=_0x5059d1,_0x346a0e=await this[_0x37824d(0x226)](_0x42d55c),_0x27daf6=path[_0x37824d(0x214)](path_1[_0x37824d(0x225)],_0x37824d(0x221),_0x37824d(0x21b),_0x346a0e[_0x37824d(0x211)]);if(!(0x0,file_1[_0x37824d(0x205)])(_0x27daf6)){this[_0x37824d(0x1dd)][_0x37824d(0x22d)](_0x37824d(0x1fa)+_0x27daf6);return;}job_1['PROCESS_CACHE'][_0x37824d(0x230)](),this['logger']['log'](_0x37824d(0x1ef)+_0x42d55c+_0x37824d(0x202)+_0x346a0e[_0x37824d(0x1fe)]),(0x0,job_1['executeJob'])({'jobId':_0x18caf1,'run':()=>audio_player_1[_0x37824d(0x209)][_0x37824d(0x233)](_0x27daf6,_0x346a0e[_0x37824d(0x208)]),'next':()=>this[_0x37824d(0x244)](_0x42d55c),'durationInSecond':_0x5ab318}),this[_0x37824d(0x1d7)]['broadcastPlaying']({'id':_0x42d55c,'isPlaying':!![]});}async[a136_0x36c0c0(0x20e)](_0x2ed047){const _0xed12cb=a136_0x36c0c0,{voiceId:_0x535fe9,jobId:_0x9e5955,durationInSecond:_0x306d79}=_0x2ed047,_0x130f2c=await this[_0xed12cb(0x20c)]['findVoiceRecoredById'](_0x535fe9),_0x454628=_0x130f2c[_0xed12cb(0x1db)],_0x3687ad=(0x0,path_2[_0xed12cb(0x214)])(process['cwd'](),_0x454628);if(!(0x0,file_1[_0xed12cb(0x205)])(_0x3687ad)){this[_0xed12cb(0x1dd)][_0xed12cb(0x22d)]('Voice\x20file\x20not\x20found:\x20'+_0x3687ad);return;}job_1[_0xed12cb(0x243)][_0xed12cb(0x230)](),this[_0xed12cb(0x1dd)][_0xed12cb(0x1e9)](_0xed12cb(0x241)+_0x535fe9),(0x0,job_1[_0xed12cb(0x1d9)])({'jobId':_0x9e5955,'run':()=>audio_player_1[_0xed12cb(0x209)][_0xed12cb(0x233)](_0x3687ad),'durationInSecond':_0x306d79,'next':()=>null});}async[a136_0x36c0c0(0x200)](_0x4c32e6){const _0x270027=a136_0x36c0c0,{textToAudioId:_0x4f056f,jobId:_0x357c9c,durationInSecond:_0x496276}=_0x4c32e6,{message:_0x4ac008}=await this[_0x270027(0x218)]['getMessageById'](_0x4f056f);job_1[_0x270027(0x243)]['killAll'](),(0x0,job_1['executeJob'])({'jobId':_0x357c9c,'run':()=>{const _0x1aed3e=_0x270027;let _0x15ddb3=null;return this[_0x1aed3e(0x218)][_0x1aed3e(0x210)](_0x4ac008,_0x184fe5=>{const _0x57844c=_0x1aed3e;_0x15ddb3=this['streamingService'][_0x57844c(0x1ea)](_0x184fe5);}),_0x15ddb3;},'durationInSecond':_0x496276,'next':()=>null});}async[a136_0x36c0c0(0x237)](_0x59e746,_0x5027d1,_0x3a6b11=![]){const _0x3a6c52=a136_0x36c0c0,_0x2262a5={'when':_0x3a6c52(0x1f7),'jobType':enums_1[_0x3a6c52(0x203)][_0x3a6c52(0x222)],'attributes':{'soundId':_0x5027d1,'durationInSecond':_0x3a6b11?0x15180:undefined},'audit':{'actor':_0x59e746,'name':enums_1['JobType'][_0x3a6c52(0x222)],'message':_0x3a6c52(0x240)+_0x5027d1}},_0x1544c6=await this[_0x3a6c52(0x20f)][_0x3a6c52(0x226)]({'jobId':{'$ne':null}});_0x1544c6&&await this[_0x3a6c52(0x244)](_0x1544c6['id']);const {jobId:_0x5b14ee}=await this[_0x3a6c52(0x1e0)][_0x3a6c52(0x212)](_0x2262a5);return this['update'](_0x5027d1,{'jobId':_0x5b14ee});}async[a136_0x36c0c0(0x244)](_0x37e9c7){const _0x172f99=a136_0x36c0c0;let _0x3d6d09=await this[_0x172f99(0x226)](_0x37e9c7);const {jobId:_0x2273d4}=_0x3d6d09||{};if(_0x2273d4){const {success:_0x25adc9}=await this['agendaService'][_0x172f99(0x22e)](_0x2273d4);_0x25adc9&&(_0x3d6d09=await this['update'](_0x37e9c7,{'jobId':null}));}return this[_0x172f99(0x1d7)][_0x172f99(0x247)]({'id':_0x3d6d09['id'],'isPlaying':![]}),_0x3d6d09;}async['resetTunes'](){const _0x18a9e2=a136_0x36c0c0,_0x441fb5=await this['findByType'](constants_2['SoundType']['Tune']);if(_0x441fb5[_0x18a9e2(0x206)]>0x0){const _0x48c04b=[];_0x441fb5[_0x18a9e2(0x1d3)](_0xa929b4=>{const _0x57453c=_0x18a9e2;_0x48c04b[_0x57453c(0x1e6)](this[_0x57453c(0x1d8)](_0xa929b4['_id']));}),await Promise[_0x18a9e2(0x23f)](_0x48c04b);}await(0x0,file_1[_0x18a9e2(0x215)])(constants_1[_0x18a9e2(0x1e1)],constants_1['TMP_UPLOAD_DIR']);const _0x192341=[];return default_sounds_1[_0x18a9e2(0x20d)][_0x18a9e2(0x1d3)](_0x127176=>{const _0x123e12=_0x18a9e2;_0x192341[_0x123e12(0x1e6)](this[_0x123e12(0x1eb)](Object['assign']({},_0x127176)));}),await Promise[_0x18a9e2(0x23f)](_0x192341),!![];}[a136_0x36c0c0(0x1fc)](_0x4db29c){const _0x1349ca=a136_0x36c0c0,_0x1dc3cd=_0x4db29c[_0x1349ca(0x24b)]('.')[_0x1349ca(0x1ed)]();return(0x0,utils_1[_0x1349ca(0x1d4)])()+'.'+_0x1dc3cd;}async[a136_0x36c0c0(0x1f0)](_0x210502,_0x42f5a5){const _0xa72b87=a136_0x36c0c0;if(!_0x210502[_0xa72b87(0x211)])return;const _0x31f172=constants_1[_0xa72b87(0x21c)]+'/'+_0x210502[_0xa72b87(0x211)],_0x4d1ba9=_0x42f5a5||this[_0xa72b87(0x1fc)](_0x210502['fileName']),_0x213b42=constants_1['AUDIO_DIR']+'/'+_0x4d1ba9;if(!(0x0,file_1[_0xa72b87(0x205)])(_0x31f172))throw new Error(_0xa72b87(0x21e));!(0x0,file_1['isFileExist'])(constants_1[_0xa72b87(0x250)])&&(0x0,file_1[_0xa72b87(0x223)])(constants_1[_0xa72b87(0x250)]),await(0x0,file_1[_0xa72b87(0x228)])(_0x31f172,_0x213b42),_0x210502[_0xa72b87(0x211)]=_0x4d1ba9;}};__decorate([(0x0,event_emitter_1[a136_0x36c0c0(0x1d6)])(sound_1[a136_0x36c0c0(0x22a)][a136_0x36c0c0(0x1d2)]),__metadata('design:type',Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],SoundService[a136_0x36c0c0(0x24f)],a136_0x36c0c0(0x24c),null),__decorate([(0x0,event_emitter_1[a136_0x36c0c0(0x1d6)])(sound_1[a136_0x36c0c0(0x22a)][a136_0x36c0c0(0x21a)]),__metadata(a136_0x36c0c0(0x1ff),Function),__metadata(a136_0x36c0c0(0x23e),[Object]),__metadata('design:returntype',Promise)],SoundService[a136_0x36c0c0(0x24f)],a136_0x36c0c0(0x20e),null),__decorate([(0x0,event_emitter_1[a136_0x36c0c0(0x1d6)])(sound_1[a136_0x36c0c0(0x22a)][a136_0x36c0c0(0x216)]),__metadata(a136_0x36c0c0(0x1ff),Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],SoundService['prototype'],'playTextToAudioRecorded',null),SoundService=SoundService_1=__decorate([(0x0,common_1[a136_0x36c0c0(0x23b)])(),__param(0x0,(0x0,mongoose_1[a136_0x36c0c0(0x1e8)])(a136_0x36c0c0(0x234))),__param(0x5,(0x0,common_1['Inject'])(sound_gateway_1['SoundGateway'])),__metadata('design:paramtypes',[mongoose_2[a136_0x36c0c0(0x23d)],agenda_service_1['AgendaService'],upload_service_1[a136_0x36c0c0(0x204)],text_to_audio_service_1['TextToAudioService'],streaming_service_1[a136_0x36c0c0(0x239)],sound_gateway_1[a136_0x36c0c0(0x20b)]])],SoundService),exports[a136_0x36c0c0(0x22f)]=SoundService;