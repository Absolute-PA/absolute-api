'use strict';const a133_0x5dd83a=a133_0x26ed;(function(_0x2d52a6,_0xa5d8ba){const _0x48b896=a133_0x26ed,_0x577144=_0x2d52a6();while(!![]){try{const _0x6ac4a0=parseInt(_0x48b896(0x18f))/0x1+parseInt(_0x48b896(0x12d))/0x2*(-parseInt(_0x48b896(0x16b))/0x3)+parseInt(_0x48b896(0x18d))/0x4+parseInt(_0x48b896(0x145))/0x5*(parseInt(_0x48b896(0x184))/0x6)+-parseInt(_0x48b896(0x161))/0x7+parseInt(_0x48b896(0x149))/0x8*(parseInt(_0x48b896(0x15f))/0x9)+parseInt(_0x48b896(0x176))/0xa*(-parseInt(_0x48b896(0x13f))/0xb);if(_0x6ac4a0===_0xa5d8ba)break;else _0x577144['push'](_0x577144['shift']());}catch(_0x130e23){_0x577144['push'](_0x577144['shift']());}}}(a133_0x4e4e,0xe9526));var __decorate=this&&this[a133_0x5dd83a(0x140)]||function(_0x3deaa5,_0x3ed632,_0x169770,_0x6c79ff){const _0x3396bb=a133_0x5dd83a;var _0xbbbf87=arguments[_0x3396bb(0x16f)],_0xf28452=_0xbbbf87<0x3?_0x3ed632:_0x6c79ff===null?_0x6c79ff=Object[_0x3396bb(0x143)](_0x3ed632,_0x169770):_0x6c79ff,_0x3ea41f;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x3396bb(0x15c))_0xf28452=Reflect[_0x3396bb(0x156)](_0x3deaa5,_0x3ed632,_0x169770,_0x6c79ff);else{for(var _0x5d6291=_0x3deaa5[_0x3396bb(0x16f)]-0x1;_0x5d6291>=0x0;_0x5d6291--)if(_0x3ea41f=_0x3deaa5[_0x5d6291])_0xf28452=(_0xbbbf87<0x3?_0x3ea41f(_0xf28452):_0xbbbf87>0x3?_0x3ea41f(_0x3ed632,_0x169770,_0xf28452):_0x3ea41f(_0x3ed632,_0x169770))||_0xf28452;}return _0xbbbf87>0x3&&_0xf28452&&Object['defineProperty'](_0x3ed632,_0x169770,_0xf28452),_0xf28452;},__metadata=this&&this[a133_0x5dd83a(0x121)]||function(_0xfa33cc,_0x491efc){const _0x568131=a133_0x5dd83a;if(typeof Reflect===_0x568131(0x189)&&typeof Reflect[_0x568131(0x194)]===_0x568131(0x15c))return Reflect['metadata'](_0xfa33cc,_0x491efc);},__param=this&&this[a133_0x5dd83a(0x126)]||function(_0x28a8e5,_0x255bc0){return function(_0x295e7d,_0x15cf2b){_0x255bc0(_0x295e7d,_0x15cf2b,_0x28a8e5);};},SoundService_1;Object['defineProperty'](exports,a133_0x5dd83a(0x197),{'value':!![]}),exports['SoundService']=void 0x0;function a133_0x4e4e(){const _0x1acc39=['path','Play\x20sound:\x20','DEFAULT_TUNES','function','play','Inject','9GySLBp','textToAudioService','10397919UOgHxV','@nestjs/mongoose','textToAudio','agendaService','playVoiceRecorded','save','\x20-\x20','../common/enums','soundModel','VoiceRecorded','3JXcfXL','validateAndMoveFileAsync','PlaySound','logger','length','_id','volume','design:paramtypes','InjectModel','JobType','DEFAULT_TUNES_DIR','1420vRkNHx','updateVolume','Sound\x20not\x20found!','./constants','isFileExist','cwd','log','uploadService','now','playTextToAudioRecorded','moveFile','getNewFileName','@nestjs/event-emitter','audio','6KmOjyz','uuid','playStreamAudioAsync','@nestjs/common','../agenda/agenda.service','object','../upload/upload.service','prototype','join','1028416eZfutm','forEach','492520FvADEF','findByType','streamingService','update','findOne','metadata','cancelJob','processRootPath','__esModule','OnEvent','findByIds','filePath','Model','find','__metadata','scheduleJob','../common/job','Sound','assign','__param','File\x20not\x20found!','AgendaService','executeJob','name','../common/events/sound','resetTunes','1193414KuIlcT','../streaming/streaming.service','UploadService','SoundEvent','../text-to-audio/text-to-audio.service','findVoiceRecoredById','../common/file','create','playSoundOnEvent','broadcastPlaying','SoundService','fileName','soundGateway','findByIdAndUpdate','TextToAudioService','stop','getMessageById','createFolder','48884tFBEpp','__decorate','all','exec','getOwnPropertyDescriptor','design:returntype','8299265FWSawl','design:type','error','split','10075048PFZaOL','PROCESS_CACHE','assets','SoundGateway','Injectable','findById','pop','AudioPlayer','Playing\x20voice\x20recorded:\x20','Tune','TMP_UPLOAD_DIR','Play','../common/utils','decorate','AUDIO_DIR','killAll'];a133_0x4e4e=function(){return _0x1acc39;};return a133_0x4e4e();}const common_1=require(a133_0x5dd83a(0x187)),mongoose_1=require(a133_0x5dd83a(0x162)),mongoose_2=require('mongoose'),path=require(a133_0x5dd83a(0x159)),event_emitter_1=require(a133_0x5dd83a(0x182)),file_1=require(a133_0x5dd83a(0x133)),agenda_service_1=require(a133_0x5dd83a(0x188)),enums_1=require(a133_0x5dd83a(0x168)),constants_1=require('../common/constants'),utils_1=require(a133_0x5dd83a(0x155)),path_1=require('../common/path'),audio_player_1=require('../common/audio/audio-player'),sound_1=require(a133_0x5dd83a(0x12b)),job_1=require(a133_0x5dd83a(0x123)),constants_2=require(a133_0x5dd83a(0x179)),default_sounds_1=require('./data/default-sounds'),sound_gateway_1=require('./sound.gateway'),path_2=require(a133_0x5dd83a(0x159)),upload_service_1=require(a133_0x5dd83a(0x18a)),text_to_audio_service_1=require(a133_0x5dd83a(0x131)),streaming_service_1=require(a133_0x5dd83a(0x12e));function a133_0x26ed(_0x1e0efd,_0x35e0a7){const _0x4e4ecb=a133_0x4e4e();return a133_0x26ed=function(_0x26ed46,_0x4a1619){_0x26ed46=_0x26ed46-0x11e;let _0xd285ad=_0x4e4ecb[_0x26ed46];return _0xd285ad;},a133_0x26ed(_0x1e0efd,_0x35e0a7);}let SoundService=SoundService_1=class SoundService{constructor(_0xec52e5,_0x37356e,_0xc1478e,_0x18cb59,_0x260a70,_0x5d6192){const _0xf79a63=a133_0x5dd83a;this[_0xf79a63(0x169)]=_0xec52e5,this[_0xf79a63(0x164)]=_0x37356e,this[_0xf79a63(0x17d)]=_0xc1478e,this['textToAudioService']=_0x18cb59,this[_0xf79a63(0x191)]=_0x260a70,this['soundGateway']=_0x5d6192,this[_0xf79a63(0x16e)]=new common_1['Logger'](SoundService_1[_0xf79a63(0x12a)]);}async[a133_0x5dd83a(0x134)](_0xc02605){const _0x275d45=a133_0x5dd83a;await this[_0x275d45(0x16c)](_0xc02605,null);const _0xba34d8=new this[(_0x275d45(0x169))](_0xc02605);return _0xba34d8[_0x275d45(0x166)]();}async[a133_0x5dd83a(0x190)](_0x5f25e4){const _0x4f4e7f=a133_0x5dd83a,_0x3e1133=await this['soundModel']['find']({'type':_0x5f25e4})[_0x4f4e7f(0x142)]();return _0x3e1133;}async[a133_0x5dd83a(0x193)](_0x279ad2){const _0x3aa2fc=a133_0x5dd83a,_0x11201f=await this[_0x3aa2fc(0x169)]['findById'](_0x279ad2);return _0x11201f;}async[a133_0x5dd83a(0x199)](_0x457996){const _0x486530=a133_0x5dd83a,_0x36842c=await this['soundModel'][_0x486530(0x120)]({'_id':{'$in':_0x457996}});return _0x36842c;}async[a133_0x5dd83a(0x192)](_0x5d5f79,_0x584533){const _0x4b6b8d=a133_0x5dd83a,_0x501126=await this[_0x4b6b8d(0x169)]['findById'](_0x5d5f79)[_0x4b6b8d(0x142)]();if(!_0x501126)throw new Error(_0x4b6b8d(0x178));await this[_0x4b6b8d(0x16c)](_0x584533,_0x501126===null||_0x501126===void 0x0?void 0x0:_0x501126[_0x4b6b8d(0x138)]);const _0x168880=await this[_0x4b6b8d(0x169)]['findByIdAndUpdate'](_0x5d5f79,Object['assign'](Object[_0x4b6b8d(0x125)]({},_0x584533),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x168880;}async[a133_0x5dd83a(0x177)](_0xab1297,_0x76b017){const _0xb634d0=a133_0x5dd83a,_0x1ef81a=await this[_0xb634d0(0x169)]['findById'](_0xab1297)['exec']();if(!_0x1ef81a)throw new Error(_0xb634d0(0x178));const _0x2b7381=await this[_0xb634d0(0x169)][_0xb634d0(0x13a)](_0xab1297,Object[_0xb634d0(0x125)](Object[_0xb634d0(0x125)]({},_0x76b017),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x2b7381;}async['delete'](_0x4e0e15){const _0x254eb1=a133_0x5dd83a,_0x1f1240=await this[_0x254eb1(0x169)]['findByIdAndDelete'](_0x4e0e15);if(_0x1f1240[_0x254eb1(0x138)]){const _0xf822d2=constants_1[_0x254eb1(0x157)]+'/'+_0x1f1240[_0x254eb1(0x138)];try{(0x0,file_1['deleteFile'])(_0xf822d2);}catch(_0x5dcbe1){this[_0x254eb1(0x16e)][_0x254eb1(0x147)](_0x5dcbe1);}}return _0x1f1240;}async['upload'](_0x44a23f,_0x21ae98){const _0x5ea903=a133_0x5dd83a,_0x25f00e=await this[_0x5ea903(0x169)][_0x5ea903(0x14e)](_0x44a23f)[_0x5ea903(0x142)](),_0xc5ff61=_0x25f00e===null||_0x25f00e===void 0x0?void 0x0:_0x25f00e[_0x5ea903(0x138)],_0x1fd27f=this[_0x5ea903(0x181)](_0x21ae98['originalname']),_0x2951a1=constants_1[_0x5ea903(0x157)]+'/'+_0x1fd27f;await(0x0,file_1[_0x5ea903(0x180)])(_0x21ae98['path'],_0x2951a1);const _0x5e56af={'fileName':_0x1fd27f},_0x239838=await this[_0x5ea903(0x169)][_0x5ea903(0x13a)](_0x44a23f,Object['assign'](Object['assign']({},_0x5e56af),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0xc5ff61){const _0x7e63c9=constants_1[_0x5ea903(0x157)]+'/'+_0xc5ff61;(0x0,file_1['deleteFile'])(_0x7e63c9);}return _0x239838;}async[a133_0x5dd83a(0x135)](_0x5eab3b){const _0x31ceca=a133_0x5dd83a,{soundId:_0x41c6,jobId:_0x1c698d,durationInSecond:_0x3d53bb}=_0x5eab3b,_0x1feb6d=await this[_0x31ceca(0x193)](_0x41c6),_0x5a26ba=path['join'](path_1[_0x31ceca(0x196)],_0x31ceca(0x14b),_0x31ceca(0x183),_0x1feb6d['fileName']);job_1['PROCESS_CACHE'][_0x31ceca(0x158)](),this[_0x31ceca(0x16e)][_0x31ceca(0x17c)]('Playing\x20sound:\x20'+_0x41c6+_0x31ceca(0x167)+_0x1feb6d[_0x31ceca(0x12a)]),(0x0,job_1['executeJob'])({'jobId':_0x1c698d,'run':()=>audio_player_1[_0x31ceca(0x150)]['playAsync'](_0x5a26ba,_0x1feb6d[_0x31ceca(0x171)]),'next':()=>this['stop'](_0x41c6),'durationInSecond':_0x3d53bb}),this[_0x31ceca(0x139)][_0x31ceca(0x136)]({'id':_0x41c6,'isPlaying':!![]});}async[a133_0x5dd83a(0x165)](_0x107f77){const _0x44288f=a133_0x5dd83a,{voiceId:_0x4e87b0,jobId:_0x543ac9,durationInSecond:_0x7ffa93}=_0x107f77,_0xf0f0fd=await this['uploadService'][_0x44288f(0x132)](_0x4e87b0),_0x591b13=_0xf0f0fd[_0x44288f(0x11e)],_0x54bcd8=(0x0,path_2[_0x44288f(0x18c)])(process[_0x44288f(0x17b)](),_0x591b13);job_1[_0x44288f(0x14a)]['killAll'](),this[_0x44288f(0x16e)][_0x44288f(0x17c)](_0x44288f(0x151)+_0x4e87b0),(0x0,job_1[_0x44288f(0x129)])({'jobId':_0x543ac9,'run':()=>audio_player_1[_0x44288f(0x150)]['playAsync'](_0x54bcd8),'durationInSecond':_0x7ffa93,'next':()=>null});}async['playTextToAudioRecorded'](_0x339ac5){const _0x460714=a133_0x5dd83a,{textToAudioId:_0x2868ea,jobId:_0x22ac18,durationInSecond:_0x3d3556}=_0x339ac5,{message:_0x385044}=await this[_0x460714(0x160)][_0x460714(0x13d)](_0x2868ea);job_1[_0x460714(0x14a)][_0x460714(0x158)](),(0x0,job_1[_0x460714(0x129)])({'jobId':_0x22ac18,'run':()=>{const _0x407eaf=_0x460714;let _0x18ccef=null;return this[_0x407eaf(0x160)][_0x407eaf(0x163)](_0x385044,_0x478e0e=>{const _0x1f4dc5=_0x407eaf;_0x18ccef=this[_0x1f4dc5(0x191)][_0x1f4dc5(0x186)](_0x478e0e);}),_0x18ccef;},'durationInSecond':_0x3d3556,'next':()=>null});}async[a133_0x5dd83a(0x15d)](_0x49cc87,_0xc57540,_0x3f3025=![]){const _0x582e83=a133_0x5dd83a,_0x184427={'when':_0x582e83(0x17e),'jobType':enums_1[_0x582e83(0x174)][_0x582e83(0x16d)],'attributes':{'soundId':_0xc57540,'durationInSecond':_0x3f3025?0x15180:undefined},'audit':{'actor':_0x49cc87,'name':enums_1[_0x582e83(0x174)][_0x582e83(0x16d)],'message':_0x582e83(0x15a)+_0xc57540}},_0x2bf608=await this[_0x582e83(0x169)][_0x582e83(0x193)]({'jobId':{'$ne':null}});_0x2bf608&&await this[_0x582e83(0x13c)](_0x2bf608['id']);const {jobId:_0x2daabb}=await this[_0x582e83(0x164)][_0x582e83(0x122)](_0x184427);return this[_0x582e83(0x192)](_0xc57540,{'jobId':_0x2daabb});}async[a133_0x5dd83a(0x13c)](_0x2b4ca6){const _0x22d8c6=a133_0x5dd83a;let _0x3234eb=await this[_0x22d8c6(0x193)](_0x2b4ca6);const {jobId:_0x38c4d8}=_0x3234eb||{};if(_0x38c4d8){const {success:_0x382415}=await this['agendaService'][_0x22d8c6(0x195)](_0x38c4d8);_0x382415&&(_0x3234eb=await this[_0x22d8c6(0x192)](_0x2b4ca6,{'jobId':null}));}return this[_0x22d8c6(0x139)]['broadcastPlaying']({'id':_0x3234eb['id'],'isPlaying':![]}),_0x3234eb;}async[a133_0x5dd83a(0x12c)](){const _0x255176=a133_0x5dd83a,_0x544865=await this[_0x255176(0x190)](constants_2['SoundType'][_0x255176(0x152)]);if(_0x544865['length']>0x0){const _0x4a270b=[];_0x544865[_0x255176(0x18e)](_0x4979b8=>{const _0x84c492=_0x255176;_0x4a270b['push'](this['delete'](_0x4979b8[_0x84c492(0x170)]));}),await Promise[_0x255176(0x141)](_0x4a270b);}await(0x0,file_1['copyFiles'])(constants_1[_0x255176(0x175)],constants_1['TMP_UPLOAD_DIR']);const _0x54d15c=[];return default_sounds_1[_0x255176(0x15b)][_0x255176(0x18e)](_0x149f61=>{const _0x3bebe3=_0x255176;_0x54d15c['push'](this[_0x3bebe3(0x134)](Object[_0x3bebe3(0x125)]({},_0x149f61)));}),await Promise[_0x255176(0x141)](_0x54d15c),!![];}[a133_0x5dd83a(0x181)](_0x11743d){const _0x114c27=a133_0x5dd83a,_0x5f34f8=_0x11743d[_0x114c27(0x148)]('.')[_0x114c27(0x14f)]();return(0x0,utils_1[_0x114c27(0x185)])()+'.'+_0x5f34f8;}async['validateAndMoveFileAsync'](_0x38f040,_0x23251f){const _0x10f2ec=a133_0x5dd83a;if(!_0x38f040['fileName'])return;const _0x1c41db=constants_1[_0x10f2ec(0x153)]+'/'+_0x38f040[_0x10f2ec(0x138)],_0x303174=_0x23251f||this[_0x10f2ec(0x181)](_0x38f040[_0x10f2ec(0x138)]),_0x22e6b6=constants_1[_0x10f2ec(0x157)]+'/'+_0x303174;if(!(0x0,file_1[_0x10f2ec(0x17a)])(_0x1c41db))throw new Error(_0x10f2ec(0x127));!(0x0,file_1[_0x10f2ec(0x17a)])(constants_1[_0x10f2ec(0x157)])&&(0x0,file_1[_0x10f2ec(0x13e)])(constants_1['AUDIO_DIR']),await(0x0,file_1['moveFile'])(_0x1c41db,_0x22e6b6),_0x38f040[_0x10f2ec(0x138)]=_0x303174;}};__decorate([(0x0,event_emitter_1[a133_0x5dd83a(0x198)])(sound_1[a133_0x5dd83a(0x130)][a133_0x5dd83a(0x154)]),__metadata(a133_0x5dd83a(0x146),Function),__metadata(a133_0x5dd83a(0x172),[Object]),__metadata(a133_0x5dd83a(0x144),Promise)],SoundService['prototype'],a133_0x5dd83a(0x135),null),__decorate([(0x0,event_emitter_1['OnEvent'])(sound_1['SoundEvent'][a133_0x5dd83a(0x16a)]),__metadata(a133_0x5dd83a(0x146),Function),__metadata(a133_0x5dd83a(0x172),[Object]),__metadata(a133_0x5dd83a(0x144),Promise)],SoundService[a133_0x5dd83a(0x18b)],a133_0x5dd83a(0x165),null),__decorate([(0x0,event_emitter_1[a133_0x5dd83a(0x198)])(sound_1[a133_0x5dd83a(0x130)]['TextToAudio']),__metadata(a133_0x5dd83a(0x146),Function),__metadata('design:paramtypes',[Object]),__metadata(a133_0x5dd83a(0x144),Promise)],SoundService[a133_0x5dd83a(0x18b)],a133_0x5dd83a(0x17f),null),SoundService=SoundService_1=__decorate([(0x0,common_1[a133_0x5dd83a(0x14d)])(),__param(0x0,(0x0,mongoose_1[a133_0x5dd83a(0x173)])(a133_0x5dd83a(0x124))),__param(0x5,(0x0,common_1[a133_0x5dd83a(0x15e)])(sound_gateway_1[a133_0x5dd83a(0x14c)])),__metadata(a133_0x5dd83a(0x172),[mongoose_2[a133_0x5dd83a(0x11f)],agenda_service_1[a133_0x5dd83a(0x128)],upload_service_1[a133_0x5dd83a(0x12f)],text_to_audio_service_1[a133_0x5dd83a(0x13b)],streaming_service_1['StreamingService'],sound_gateway_1['SoundGateway']])],SoundService),exports[a133_0x5dd83a(0x137)]=SoundService;