'use strict';const a133_0x11123d=a133_0x3326;function a133_0x3326(_0x49e338,_0x2c25a4){const _0xe9dd85=a133_0xe9dd();return a133_0x3326=function(_0x3326ea,_0x2c61a4){_0x3326ea=_0x3326ea-0x1b1;let _0x5a54db=_0xe9dd85[_0x3326ea];return _0x5a54db;},a133_0x3326(_0x49e338,_0x2c25a4);}(function(_0x41bbce,_0x42fcb4){const _0x10bf81=a133_0x3326,_0x290f59=_0x41bbce();while(!![]){try{const _0x51ba25=parseInt(_0x10bf81(0x1d3))/0x1*(-parseInt(_0x10bf81(0x20c))/0x2)+-parseInt(_0x10bf81(0x21f))/0x3+-parseInt(_0x10bf81(0x1b2))/0x4*(parseInt(_0x10bf81(0x203))/0x5)+parseInt(_0x10bf81(0x1c0))/0x6+parseInt(_0x10bf81(0x1da))/0x7+-parseInt(_0x10bf81(0x1ef))/0x8*(parseInt(_0x10bf81(0x1ba))/0x9)+parseInt(_0x10bf81(0x1e1))/0xa;if(_0x51ba25===_0x42fcb4)break;else _0x290f59['push'](_0x290f59['shift']());}catch(_0x14ee7c){_0x290f59['push'](_0x290f59['shift']());}}}(a133_0xe9dd,0xd36b3));var __decorate=this&&this[a133_0x11123d(0x1d6)]||function(_0x247964,_0x3cf3af,_0x1e85cb,_0x4f50a4){const _0x30bef1=a133_0x11123d;var _0x28a80c=arguments[_0x30bef1(0x212)],_0x198824=_0x28a80c<0x3?_0x3cf3af:_0x4f50a4===null?_0x4f50a4=Object['getOwnPropertyDescriptor'](_0x3cf3af,_0x1e85cb):_0x4f50a4,_0x474d0b;if(typeof Reflect==='object'&&typeof Reflect[_0x30bef1(0x1d4)]===_0x30bef1(0x20e))_0x198824=Reflect[_0x30bef1(0x1d4)](_0x247964,_0x3cf3af,_0x1e85cb,_0x4f50a4);else{for(var _0x319723=_0x247964[_0x30bef1(0x212)]-0x1;_0x319723>=0x0;_0x319723--)if(_0x474d0b=_0x247964[_0x319723])_0x198824=(_0x28a80c<0x3?_0x474d0b(_0x198824):_0x28a80c>0x3?_0x474d0b(_0x3cf3af,_0x1e85cb,_0x198824):_0x474d0b(_0x3cf3af,_0x1e85cb))||_0x198824;}return _0x28a80c>0x3&&_0x198824&&Object['defineProperty'](_0x3cf3af,_0x1e85cb,_0x198824),_0x198824;},__metadata=this&&this[a133_0x11123d(0x1cc)]||function(_0xc15840,_0x18bdb9){const _0x1813f3=a133_0x11123d;if(typeof Reflect===_0x1813f3(0x218)&&typeof Reflect['metadata']===_0x1813f3(0x20e))return Reflect[_0x1813f3(0x1ff)](_0xc15840,_0x18bdb9);},__param=this&&this[a133_0x11123d(0x1d8)]||function(_0x28ca05,_0xc3ad6d){return function(_0x5b017a,_0x576842){_0xc3ad6d(_0x5b017a,_0x576842,_0x28ca05);};},SoundService_1;Object['defineProperty'](exports,a133_0x11123d(0x219),{'value':!![]}),exports[a133_0x11123d(0x204)]=void 0x0;const common_1=require(a133_0x11123d(0x1be)),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require(a133_0x11123d(0x1fe)),path=require('path'),event_emitter_1=require('@nestjs/event-emitter'),file_1=require(a133_0x11123d(0x214)),agenda_service_1=require(a133_0x11123d(0x1c9)),enums_1=require(a133_0x11123d(0x1f6)),constants_1=require('../common/constants'),utils_1=require(a133_0x11123d(0x1dc)),path_1=require(a133_0x11123d(0x1c2)),audio_player_1=require('../common/audio/audio-player'),sound_1=require(a133_0x11123d(0x1c3)),job_1=require('../common/job'),constants_2=require(a133_0x11123d(0x202)),default_sounds_1=require('./data/default-sounds'),sound_gateway_1=require(a133_0x11123d(0x200)),path_2=require('path'),upload_service_1=require('../upload/upload.service'),text_to_audio_service_1=require(a133_0x11123d(0x1e0)),streaming_service_1=require(a133_0x11123d(0x225));let SoundService=SoundService_1=class SoundService{constructor(_0x3b0da4,_0x557b0b,_0x1d3c3f,_0x324b81,_0x32eb03,_0x48a6a8){const _0x2dab29=a133_0x11123d;this[_0x2dab29(0x20f)]=_0x3b0da4,this[_0x2dab29(0x226)]=_0x557b0b,this[_0x2dab29(0x1ea)]=_0x1d3c3f,this[_0x2dab29(0x1c5)]=_0x324b81,this[_0x2dab29(0x224)]=_0x32eb03,this[_0x2dab29(0x1df)]=_0x48a6a8,this['logger']=new common_1['Logger'](SoundService_1[_0x2dab29(0x1e2)]);}async[a133_0x11123d(0x215)](_0x4a43a9){const _0x15c553=a133_0x11123d;await this[_0x15c553(0x1ed)](_0x4a43a9,null);const _0x4de200=new this[(_0x15c553(0x20f))](_0x4a43a9);return _0x4de200[_0x15c553(0x1ca)]();}async['findByType'](_0x12b01b){const _0x567698=a133_0x11123d,_0x416904=await this[_0x567698(0x20f)][_0x567698(0x217)]({'type':_0x12b01b})[_0x567698(0x1d0)]();return _0x416904;}async[a133_0x11123d(0x21b)](_0x58b18b){const _0x1e69ad=a133_0x11123d,_0x4009f6=await this[_0x1e69ad(0x20f)][_0x1e69ad(0x1e5)](_0x58b18b);return _0x4009f6;}async[a133_0x11123d(0x1b7)](_0x1397c1){const _0xff6ca3=a133_0x11123d,_0x24efc2=await this[_0xff6ca3(0x20f)][_0xff6ca3(0x217)]({'_id':{'$in':_0x1397c1}});return _0x24efc2;}async[a133_0x11123d(0x222)](_0x255506,_0x1170ff){const _0x30fff2=a133_0x11123d,_0x5d3ff2=await this[_0x30fff2(0x20f)][_0x30fff2(0x1e5)](_0x255506)[_0x30fff2(0x1d0)]();if(!_0x5d3ff2)throw new Error(_0x30fff2(0x1b3));await this[_0x30fff2(0x1ed)](_0x1170ff,_0x5d3ff2===null||_0x5d3ff2===void 0x0?void 0x0:_0x5d3ff2[_0x30fff2(0x1b5)]);const _0xa432a0=await this[_0x30fff2(0x20f)]['findByIdAndUpdate'](_0x255506,Object[_0x30fff2(0x21a)](Object[_0x30fff2(0x21a)]({},_0x1170ff),{'updatedAtUtc':new Date()}),{'new':!![]});return _0xa432a0;}async[a133_0x11123d(0x1bb)](_0x494646,_0x3b4e40){const _0x4163e0=a133_0x11123d,_0x3056c1=await this[_0x4163e0(0x20f)][_0x4163e0(0x1e5)](_0x494646)['exec']();if(!_0x3056c1)throw new Error(_0x4163e0(0x1b3));const _0x16bc6d=await this[_0x4163e0(0x20f)]['findByIdAndUpdate'](_0x494646,Object[_0x4163e0(0x21a)](Object[_0x4163e0(0x21a)]({},_0x3b4e40),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x16bc6d;}async[a133_0x11123d(0x1f7)](_0x4b8d35){const _0x221b5d=a133_0x11123d,_0xbc9a7=await this[_0x221b5d(0x20f)][_0x221b5d(0x1f3)](_0x4b8d35);if(_0xbc9a7['fileName']){const _0x51de46=constants_1[_0x221b5d(0x1f4)]+'/'+_0xbc9a7[_0x221b5d(0x1b5)];try{(0x0,file_1[_0x221b5d(0x1eb)])(_0x51de46);}catch(_0x1bcfc0){this['logger'][_0x221b5d(0x205)](_0x1bcfc0);}}return _0xbc9a7;}async[a133_0x11123d(0x1f0)](_0x27d1cd,_0x2d1a03){const _0x52993=a133_0x11123d,_0x254b0b=await this[_0x52993(0x20f)][_0x52993(0x1e5)](_0x27d1cd)[_0x52993(0x1d0)](),_0x29624a=_0x254b0b===null||_0x254b0b===void 0x0?void 0x0:_0x254b0b[_0x52993(0x1b5)],_0x409265=this[_0x52993(0x1e6)](_0x2d1a03[_0x52993(0x1ce)]),_0x5df3d7=constants_1[_0x52993(0x1f4)]+'/'+_0x409265;await(0x0,file_1[_0x52993(0x1fb)])(_0x2d1a03[_0x52993(0x20d)],_0x5df3d7);const _0x39abe9={'fileName':_0x409265},_0x1e833e=await this[_0x52993(0x20f)]['findByIdAndUpdate'](_0x27d1cd,Object['assign'](Object[_0x52993(0x21a)]({},_0x39abe9),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0x29624a){const _0x5c2d34=constants_1[_0x52993(0x1f4)]+'/'+_0x29624a;(0x0,file_1['deleteFile'])(_0x5c2d34);}return _0x1e833e;}async['playSoundOnEvent'](_0x50aa6e){const _0x3ff42e=a133_0x11123d,{soundId:_0x3b8a69,jobId:_0x26874c,durationInSecond:_0x12c96b}=_0x50aa6e,_0x301a8e=await this[_0x3ff42e(0x21b)](_0x3b8a69),_0x284378=path['join'](path_1[_0x3ff42e(0x1cb)],_0x3ff42e(0x1c4),'audio',_0x301a8e[_0x3ff42e(0x1b5)]);job_1[_0x3ff42e(0x1c7)][_0x3ff42e(0x1e3)](),this[_0x3ff42e(0x1f8)][_0x3ff42e(0x208)](_0x3ff42e(0x1e9)+_0x3b8a69+_0x3ff42e(0x21d)+_0x301a8e[_0x3ff42e(0x1e2)]),(0x0,job_1[_0x3ff42e(0x1bd)])({'jobId':_0x26874c,'run':()=>audio_player_1['AudioPlayer']['playAsync'](_0x284378,_0x301a8e['volume']),'next':()=>this[_0x3ff42e(0x1c6)](_0x3b8a69),'durationInSecond':_0x12c96b}),this[_0x3ff42e(0x1df)][_0x3ff42e(0x1cd)]({'id':_0x3b8a69,'isPlaying':!![]});}async['playVoiceRecorded'](_0x2dbf1a){const _0x3e25b6=a133_0x11123d,{voiceId:_0x18ab76,jobId:_0x17339a,durationInSecond:_0x2721a1}=_0x2dbf1a,_0xa619ea=await this['uploadService']['findVoiceRecoredById'](_0x18ab76),_0x16fe54=_0xa619ea[_0x3e25b6(0x1e4)],_0x2406cd=(0x0,path_2['join'])(process['cwd'](),_0x16fe54);job_1[_0x3e25b6(0x1c7)][_0x3e25b6(0x1e3)](),this[_0x3e25b6(0x1f8)]['log'](_0x3e25b6(0x21e)+_0x18ab76),(0x0,job_1[_0x3e25b6(0x1bd)])({'jobId':_0x17339a,'run':()=>audio_player_1[_0x3e25b6(0x216)][_0x3e25b6(0x1b8)](_0x2406cd),'durationInSecond':_0x2721a1,'next':()=>null});}async[a133_0x11123d(0x220)](_0x7f0c3e){const _0x34b0c0=a133_0x11123d,{textToAudioId:_0x3e0634,jobId:_0x41f02d,durationInSecond:_0x2a6d5f}=_0x7f0c3e,{message:_0x429c2f}=await this['textToAudioService'][_0x34b0c0(0x1c1)](_0x3e0634);job_1['PROCESS_CACHE'][_0x34b0c0(0x1e3)](),(0x0,job_1[_0x34b0c0(0x1bd)])({'jobId':_0x41f02d,'run':()=>{const _0x46142f=_0x34b0c0;let _0x4bcf23=null;return this[_0x46142f(0x1c5)][_0x46142f(0x1e8)](_0x429c2f,_0x85a33c=>{const _0x30a1c7=_0x46142f;_0x4bcf23=this[_0x30a1c7(0x224)][_0x30a1c7(0x1d1)](_0x85a33c);}),_0x4bcf23;},'durationInSecond':_0x2a6d5f,'next':()=>null});}async[a133_0x11123d(0x211)](_0xf95436,_0x108687,_0x9894f8=![]){const _0x40f42d=a133_0x11123d,_0xac8946={'when':_0x40f42d(0x1bf),'jobType':enums_1[_0x40f42d(0x1bc)][_0x40f42d(0x209)],'attributes':{'soundId':_0x108687,'durationInSecond':_0x9894f8?0x15180:undefined},'audit':{'actor':_0xf95436,'name':enums_1[_0x40f42d(0x1bc)][_0x40f42d(0x209)],'message':_0x40f42d(0x1f1)+_0x108687}},_0x1ff6ff=await this[_0x40f42d(0x20f)][_0x40f42d(0x21b)]({'jobId':{'$ne':null}});_0x1ff6ff&&await this[_0x40f42d(0x1c6)](_0x1ff6ff['id']);const {jobId:_0x300319}=await this['agendaService'][_0x40f42d(0x213)](_0xac8946);return this[_0x40f42d(0x222)](_0x108687,{'jobId':_0x300319});}async['stop'](_0x174d75){const _0x3ce05e=a133_0x11123d;let _0x204804=await this['findOne'](_0x174d75);const {jobId:_0x1661bd}=_0x204804||{};if(_0x1661bd){const {success:_0x24d3df}=await this[_0x3ce05e(0x226)][_0x3ce05e(0x21c)](_0x1661bd);_0x24d3df&&(_0x204804=await this[_0x3ce05e(0x222)](_0x174d75,{'jobId':null}));}return this[_0x3ce05e(0x1df)][_0x3ce05e(0x1cd)]({'id':_0x204804['id'],'isPlaying':![]}),_0x204804;}async[a133_0x11123d(0x210)](){const _0x4fd5df=a133_0x11123d,_0x1c5046=await this['findByType'](constants_2[_0x4fd5df(0x1f2)]['Tune']);if(_0x1c5046[_0x4fd5df(0x212)]>0x0){const _0x1a3d4b=[];_0x1c5046[_0x4fd5df(0x221)](_0x2250cd=>{const _0x154e3d=_0x4fd5df;_0x1a3d4b[_0x154e3d(0x1f9)](this['delete'](_0x2250cd[_0x154e3d(0x1d2)]));}),await Promise['all'](_0x1a3d4b);}await(0x0,file_1[_0x4fd5df(0x1d9)])(constants_1[_0x4fd5df(0x1b1)],constants_1['TMP_UPLOAD_DIR']);const _0x2429b7=[];return default_sounds_1[_0x4fd5df(0x207)][_0x4fd5df(0x221)](_0xcf030d=>{const _0x3b74e9=_0x4fd5df;_0x2429b7[_0x3b74e9(0x1f9)](this[_0x3b74e9(0x215)](Object[_0x3b74e9(0x21a)]({},_0xcf030d)));}),await Promise['all'](_0x2429b7),!![];}[a133_0x11123d(0x1e6)](_0x5e3d2c){const _0x526fc2=a133_0x11123d,_0x230cc=_0x5e3d2c[_0x526fc2(0x1c8)]('.')[_0x526fc2(0x206)]();return(0x0,utils_1[_0x526fc2(0x1de)])()+'.'+_0x230cc;}async['validateAndMoveFileAsync'](_0x103f98,_0x129f09){const _0x18bc12=a133_0x11123d;if(!_0x103f98[_0x18bc12(0x1b5)])return;const _0x55699c=constants_1[_0x18bc12(0x1cf)]+'/'+_0x103f98[_0x18bc12(0x1b5)],_0x4be49b=_0x129f09||this[_0x18bc12(0x1e6)](_0x103f98[_0x18bc12(0x1b5)]),_0x1f51d9=constants_1['AUDIO_DIR']+'/'+_0x4be49b;if(!(0x0,file_1[_0x18bc12(0x1b6)])(_0x55699c))throw new Error('File\x20not\x20found!');!(0x0,file_1['isFileExist'])(constants_1[_0x18bc12(0x1f4)])&&(0x0,file_1[_0x18bc12(0x1fc)])(constants_1[_0x18bc12(0x1f4)]),await(0x0,file_1[_0x18bc12(0x1fb)])(_0x55699c,_0x1f51d9),_0x103f98[_0x18bc12(0x1b5)]=_0x4be49b;}};__decorate([(0x0,event_emitter_1[a133_0x11123d(0x1db)])(sound_1['SoundEvent'][a133_0x11123d(0x1ec)]),__metadata('design:type',Function),__metadata(a133_0x11123d(0x1fd),[Object]),__metadata(a133_0x11123d(0x20a),Promise)],SoundService[a133_0x11123d(0x201)],a133_0x11123d(0x1f5),null),__decorate([(0x0,event_emitter_1[a133_0x11123d(0x1db)])(sound_1[a133_0x11123d(0x1d5)][a133_0x11123d(0x1b9)]),__metadata('design:type',Function),__metadata(a133_0x11123d(0x1fd),[Object]),__metadata(a133_0x11123d(0x20a),Promise)],SoundService[a133_0x11123d(0x201)],a133_0x11123d(0x223),null),__decorate([(0x0,event_emitter_1[a133_0x11123d(0x1db)])(sound_1[a133_0x11123d(0x1d5)]['TextToAudio']),__metadata(a133_0x11123d(0x1ee),Function),__metadata(a133_0x11123d(0x1fd),[Object]),__metadata('design:returntype',Promise)],SoundService[a133_0x11123d(0x201)],a133_0x11123d(0x220),null),SoundService=SoundService_1=__decorate([(0x0,common_1[a133_0x11123d(0x1e7)])(),__param(0x0,(0x0,mongoose_1[a133_0x11123d(0x1b4)])('Sound')),__param(0x5,(0x0,common_1['Inject'])(sound_gateway_1[a133_0x11123d(0x20b)])),__metadata('design:paramtypes',[mongoose_2['Model'],agenda_service_1[a133_0x11123d(0x1dd)],upload_service_1[a133_0x11123d(0x1d7)],text_to_audio_service_1['TextToAudioService'],streaming_service_1[a133_0x11123d(0x1fa)],sound_gateway_1[a133_0x11123d(0x20b)]])],SoundService),exports[a133_0x11123d(0x204)]=SoundService;function a133_0xe9dd(){const _0x189d42=['save','processRootPath','__metadata','broadcastPlaying','originalname','TMP_UPLOAD_DIR','exec','playStreamAudioAsync','_id','387667qhgwyj','decorate','SoundEvent','__decorate','UploadService','__param','copyFiles','6655488azcMzE','OnEvent','../common/utils','AgendaService','uuid','soundGateway','../text-to-audio/text-to-audio.service','26903650bECHmV','name','killAll','filePath','findById','getNewFileName','Injectable','textToAudio','Playing\x20sound:\x20','uploadService','deleteFile','Play','validateAndMoveFileAsync','design:type','2056flTzxH','upload','Play\x20sound:\x20','SoundType','findByIdAndDelete','AUDIO_DIR','playSoundOnEvent','../common/enums','delete','logger','push','StreamingService','moveFile','createFolder','design:paramtypes','mongoose','metadata','./sound.gateway','prototype','./constants','6117425VgzFdy','SoundService','error','pop','DEFAULT_TUNES','log','PlaySound','design:returntype','SoundGateway','4kCseFV','path','function','soundModel','resetTunes','play','length','scheduleJob','../common/file','create','AudioPlayer','find','object','__esModule','assign','findOne','cancelJob','\x20-\x20','Playing\x20voice\x20recorded:\x20','3638802qqSybu','playTextToAudioRecorded','forEach','update','playVoiceRecorded','streamingService','../streaming/streaming.service','agendaService','DEFAULT_TUNES_DIR','4iCGKiw','Sound\x20not\x20found!','InjectModel','fileName','isFileExist','findByIds','playAsync','VoiceRecorded','12384DPkkOd','updateVolume','JobType','executeJob','@nestjs/common','now','4741242ciJBkz','getMessageById','../common/path','../common/events/sound','assets','textToAudioService','stop','PROCESS_CACHE','split','../agenda/agenda.service'];a133_0xe9dd=function(){return _0x189d42;};return a133_0xe9dd();}