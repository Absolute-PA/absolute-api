'use strict';const a136_0x534c46=a136_0x2cc9;(function(_0x584207,_0x10d748){const _0x1d3cec=a136_0x2cc9,_0x33318c=_0x584207();while(!![]){try{const _0x42da92=parseInt(_0x1d3cec(0x124))/0x1*(parseInt(_0x1d3cec(0xcd))/0x2)+parseInt(_0x1d3cec(0x11b))/0x3+-parseInt(_0x1d3cec(0x10b))/0x4*(-parseInt(_0x1d3cec(0x117))/0x5)+-parseInt(_0x1d3cec(0x100))/0x6+parseInt(_0x1d3cec(0x12a))/0x7*(parseInt(_0x1d3cec(0x138))/0x8)+-parseInt(_0x1d3cec(0xcf))/0x9+-parseInt(_0x1d3cec(0x134))/0xa;if(_0x42da92===_0x10d748)break;else _0x33318c['push'](_0x33318c['shift']());}catch(_0x219005){_0x33318c['push'](_0x33318c['shift']());}}}(a136_0x165d,0x2e9f1));var __decorate=this&&this[a136_0x534c46(0x12c)]||function(_0x1eae6a,_0xd8b593,_0x772a6e,_0x4d82fc){const _0xa80aa7=a136_0x534c46;var _0x1f1678=arguments[_0xa80aa7(0xd8)],_0x2d64dd=_0x1f1678<0x3?_0xd8b593:_0x4d82fc===null?_0x4d82fc=Object[_0xa80aa7(0x11c)](_0xd8b593,_0x772a6e):_0x4d82fc,_0x44daf0;if(typeof Reflect===_0xa80aa7(0xd2)&&typeof Reflect['decorate']==='function')_0x2d64dd=Reflect[_0xa80aa7(0xc6)](_0x1eae6a,_0xd8b593,_0x772a6e,_0x4d82fc);else{for(var _0x387403=_0x1eae6a[_0xa80aa7(0xd8)]-0x1;_0x387403>=0x0;_0x387403--)if(_0x44daf0=_0x1eae6a[_0x387403])_0x2d64dd=(_0x1f1678<0x3?_0x44daf0(_0x2d64dd):_0x1f1678>0x3?_0x44daf0(_0xd8b593,_0x772a6e,_0x2d64dd):_0x44daf0(_0xd8b593,_0x772a6e))||_0x2d64dd;}return _0x1f1678>0x3&&_0x2d64dd&&Object[_0xa80aa7(0xe2)](_0xd8b593,_0x772a6e,_0x2d64dd),_0x2d64dd;},__metadata=this&&this[a136_0x534c46(0x125)]||function(_0x36c18c,_0x476daa){const _0x5cf2e6=a136_0x534c46;if(typeof Reflect===_0x5cf2e6(0xd2)&&typeof Reflect[_0x5cf2e6(0x110)]===_0x5cf2e6(0xf2))return Reflect[_0x5cf2e6(0x110)](_0x36c18c,_0x476daa);},__param=this&&this[a136_0x534c46(0x122)]||function(_0xa741c5,_0xc5a665){return function(_0x11c25f,_0xe3da18){_0xc5a665(_0x11c25f,_0xe3da18,_0xa741c5);};},SoundService_1;function a136_0x165d(){const _0x4dfd87=['StreamingService','DEFAULT_TUNES_DIR','decorate','../agenda/agenda.service','Sound','cwd','./data/default-sounds','assign','updateVolume','72318FvpGYb','resetTunes','1552626JsjbfP','TMP_UPLOAD_DIR','playTextToAudioRecorded','object','find','create','now','TextToAudio','../common/audio/audio-player','length','playSoundOnEvent','\x20-\x20','SoundGateway','uuid','playVoiceRecorded','streamingService','moveFile','Play','delete','defineProperty','PROCESS_CACHE','exec','Inject','findByIdAndUpdate','findOne','stop','copyFiles','../common/enums','Sound\x20file\x20not\x20found:\x20','AUDIO_DIR','uploadService','join','PlaySound','SoundType','all','function','findById','findByIds','killAll','path','assets','__esModule','save','findByIdAndDelete','OnEvent','filePath','update','error','InjectModel','1317324OImrIa','AudioPlayer','processRootPath','isFileExist','forEach','createFolder','SoundEvent','textToAudioService','../upload/upload.service','Play\x20sound:\x20','soundModel','4qJroLe','upload','Playing\x20sound:\x20','mongoose','getMessageById','metadata','volume','Sound\x20not\x20found!','broadcastPlaying','VoiceRecorded','findByType','deleteFile','1885705VHfDcD','Logger','_id','design:paramtypes','475395uRaFEH','getOwnPropertyDescriptor','fileName','Tune','play','Model','name','__param','AgendaService','3nsQpaJ','__metadata','../common/events/sound','getNewFileName','push','../common/utils','4011fNqOUT','log','__decorate','Playing\x20voice\x20recorded:\x20','logger','agendaService','JobType','design:returntype','prototype','File\x20not\x20found!','994450iahygf','design:type','textToAudio','cancelJob','536rirpoV','scheduleJob'];a136_0x165d=function(){return _0x4dfd87;};return a136_0x165d();}Object[a136_0x534c46(0xe2)](exports,a136_0x534c46(0xf8),{'value':!![]}),exports['SoundService']=void 0x0;function a136_0x2cc9(_0x311c48,_0x8e114c){const _0x165df0=a136_0x165d();return a136_0x2cc9=function(_0x2cc980,_0x4f4989){_0x2cc980=_0x2cc980-0xc4;let _0x4ec576=_0x165df0[_0x2cc980];return _0x4ec576;},a136_0x2cc9(_0x311c48,_0x8e114c);}const common_1=require('@nestjs/common'),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require(a136_0x534c46(0x10e)),path=require('path'),event_emitter_1=require('@nestjs/event-emitter'),file_1=require('../common/file'),agenda_service_1=require(a136_0x534c46(0xc7)),enums_1=require(a136_0x534c46(0xea)),constants_1=require('../common/constants'),utils_1=require(a136_0x534c46(0x129)),path_1=require('../common/path'),audio_player_1=require(a136_0x534c46(0xd7)),sound_1=require(a136_0x534c46(0x126)),job_1=require('../common/job'),constants_2=require('./constants'),default_sounds_1=require(a136_0x534c46(0xca)),sound_gateway_1=require('./sound.gateway'),path_2=require(a136_0x534c46(0xf6)),upload_service_1=require(a136_0x534c46(0x108)),text_to_audio_service_1=require('../text-to-audio/text-to-audio.service'),streaming_service_1=require('../streaming/streaming.service');let SoundService=SoundService_1=class SoundService{constructor(_0x7b976,_0xf05fa8,_0x4366e6,_0x1e2ee8,_0x2b4833,_0xf4b943){const _0xb9c49d=a136_0x534c46;this[_0xb9c49d(0x10a)]=_0x7b976,this[_0xb9c49d(0x12f)]=_0xf05fa8,this[_0xb9c49d(0xed)]=_0x4366e6,this[_0xb9c49d(0x107)]=_0x1e2ee8,this[_0xb9c49d(0xde)]=_0x2b4833,this['soundGateway']=_0xf4b943,this[_0xb9c49d(0x12e)]=new common_1[(_0xb9c49d(0x118))](SoundService_1[_0xb9c49d(0x121)]);}async['create'](_0x39bf6e){const _0xa030d=a136_0x534c46;await this['validateAndMoveFileAsync'](_0x39bf6e,null);const _0x23d877=new this[(_0xa030d(0x10a))](_0x39bf6e);return _0x23d877[_0xa030d(0xf9)]();}async[a136_0x534c46(0x115)](_0x1ea8f1){const _0x4fb552=a136_0x534c46,_0x48c9c8=await this['soundModel'][_0x4fb552(0xd3)]({'type':_0x1ea8f1})['exec']();return _0x48c9c8;}async[a136_0x534c46(0xe7)](_0x4e9933){const _0x5dcce0=a136_0x534c46,_0x311b09=await this['soundModel'][_0x5dcce0(0xf3)](_0x4e9933);return _0x311b09;}async[a136_0x534c46(0xf4)](_0x43a0ce){const _0x570913=a136_0x534c46,_0x3e39f3=await this[_0x570913(0x10a)]['find']({'_id':{'$in':_0x43a0ce}});return _0x3e39f3;}async[a136_0x534c46(0xfd)](_0x390961,_0x2e905a){const _0x193ae3=a136_0x534c46,_0x2d6a1d=await this[_0x193ae3(0x10a)][_0x193ae3(0xf3)](_0x390961)['exec']();if(!_0x2d6a1d)throw new Error(_0x193ae3(0x112));await this['validateAndMoveFileAsync'](_0x2e905a,_0x2d6a1d===null||_0x2d6a1d===void 0x0?void 0x0:_0x2d6a1d[_0x193ae3(0x11d)]);const _0x5308b1=await this['soundModel'][_0x193ae3(0xe6)](_0x390961,Object['assign'](Object[_0x193ae3(0xcb)]({},_0x2e905a),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x5308b1;}async[a136_0x534c46(0xcc)](_0x435786,_0x43da3d){const _0x400b8e=a136_0x534c46,_0x438fc3=await this[_0x400b8e(0x10a)][_0x400b8e(0xf3)](_0x435786)[_0x400b8e(0xe4)]();if(!_0x438fc3)throw new Error('Sound\x20not\x20found!');const _0x552665=await this[_0x400b8e(0x10a)]['findByIdAndUpdate'](_0x435786,Object[_0x400b8e(0xcb)](Object[_0x400b8e(0xcb)]({},_0x43da3d),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x552665;}async['delete'](_0x301b42){const _0x5061ba=a136_0x534c46,_0x3c8825=await this[_0x5061ba(0x10a)][_0x5061ba(0xfa)](_0x301b42);if(_0x3c8825[_0x5061ba(0x11d)]){const _0x3e490d=constants_1[_0x5061ba(0xec)]+'/'+_0x3c8825[_0x5061ba(0x11d)];try{(0x0,file_1[_0x5061ba(0x116)])(_0x3e490d);}catch(_0x18a0e1){this[_0x5061ba(0x12e)][_0x5061ba(0xfe)](_0x18a0e1);}}return _0x3c8825;}async[a136_0x534c46(0x10c)](_0x4d018d,_0x3b3c6c){const _0x34bd23=a136_0x534c46,_0x5cbcf3=await this[_0x34bd23(0x10a)][_0x34bd23(0xf3)](_0x4d018d)['exec'](),_0x230ef3=_0x5cbcf3===null||_0x5cbcf3===void 0x0?void 0x0:_0x5cbcf3[_0x34bd23(0x11d)],_0x3ddccd=this[_0x34bd23(0x127)](_0x3b3c6c['originalname']),_0x5e0b13=constants_1[_0x34bd23(0xec)]+'/'+_0x3ddccd;await(0x0,file_1['moveFile'])(_0x3b3c6c['path'],_0x5e0b13);const _0x5b550a={'fileName':_0x3ddccd},_0x5ee22d=await this[_0x34bd23(0x10a)]['findByIdAndUpdate'](_0x4d018d,Object[_0x34bd23(0xcb)](Object[_0x34bd23(0xcb)]({},_0x5b550a),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0x230ef3){const _0x32fc66=constants_1[_0x34bd23(0xec)]+'/'+_0x230ef3;(0x0,file_1['deleteFile'])(_0x32fc66);}return _0x5ee22d;}async[a136_0x534c46(0xd9)](_0x24d670){const _0x50743b=a136_0x534c46,{soundId:_0x16cc4c,jobId:_0x57b6bd,durationInSecond:_0x52833a}=_0x24d670,_0x9e5781=await this[_0x50743b(0xe7)](_0x16cc4c),_0x2a5356=path[_0x50743b(0xee)](path_1[_0x50743b(0x102)],_0x50743b(0xf7),'audio',_0x9e5781['fileName']);if(!(0x0,file_1[_0x50743b(0x103)])(_0x2a5356)){this[_0x50743b(0x12e)]['error'](_0x50743b(0xeb)+_0x2a5356);return;}job_1[_0x50743b(0xe3)]['killAll'](),this[_0x50743b(0x12e)][_0x50743b(0x12b)](_0x50743b(0x10d)+_0x16cc4c+_0x50743b(0xda)+_0x9e5781['name']),(0x0,job_1['executeJob'])({'jobId':_0x57b6bd,'run':()=>audio_player_1[_0x50743b(0x101)]['playAsync'](_0x2a5356,_0x9e5781[_0x50743b(0x111)]),'next':()=>this['stop'](_0x16cc4c),'durationInSecond':_0x52833a}),this['soundGateway'][_0x50743b(0x113)]({'id':_0x16cc4c,'isPlaying':!![]});}async[a136_0x534c46(0xdd)](_0x2f1e75){const _0x30cd2e=a136_0x534c46,{voiceId:_0x3070fb,jobId:_0x3aad5f,durationInSecond:_0x508019}=_0x2f1e75,_0x26a832=await this[_0x30cd2e(0xed)]['findVoiceRecoredById'](_0x3070fb),_0x12c6e1=_0x26a832[_0x30cd2e(0xfc)],_0x26aa57=(0x0,path_2[_0x30cd2e(0xee)])(process[_0x30cd2e(0xc9)](),_0x12c6e1);if(!(0x0,file_1[_0x30cd2e(0x103)])(_0x26aa57)){this[_0x30cd2e(0x12e)][_0x30cd2e(0xfe)]('Voice\x20file\x20not\x20found:\x20'+_0x26aa57);return;}job_1['PROCESS_CACHE']['killAll'](),this[_0x30cd2e(0x12e)]['log'](_0x30cd2e(0x12d)+_0x3070fb),(0x0,job_1['executeJob'])({'jobId':_0x3aad5f,'run':()=>audio_player_1[_0x30cd2e(0x101)]['playAsync'](_0x26aa57),'durationInSecond':_0x508019,'next':()=>null});}async[a136_0x534c46(0xd1)](_0x4d66f3){const _0xa62e19=a136_0x534c46,{textToAudioId:_0x1a2689,jobId:_0xa0a60,durationInSecond:_0x4926b0}=_0x4d66f3,{message:_0x47f7d5}=await this[_0xa62e19(0x107)][_0xa62e19(0x10f)](_0x1a2689);job_1[_0xa62e19(0xe3)][_0xa62e19(0xf5)](),(0x0,job_1['executeJob'])({'jobId':_0xa0a60,'run':()=>{const _0x54a5e2=_0xa62e19;let _0x4a36cf=null;return this[_0x54a5e2(0x107)][_0x54a5e2(0x136)](_0x47f7d5,_0x29dded=>{const _0x2540e9=_0x54a5e2;_0x4a36cf=this[_0x2540e9(0xde)]['playStreamAudioAsync'](_0x29dded);}),_0x4a36cf;},'durationInSecond':_0x4926b0,'next':()=>null});}async[a136_0x534c46(0x11f)](_0x4ec7cd,_0x3d3ada,_0x5f7495=![]){const _0x229b92=a136_0x534c46,_0x3aa08b={'when':_0x229b92(0xd5),'jobType':enums_1[_0x229b92(0x130)][_0x229b92(0xef)],'attributes':{'soundId':_0x3d3ada,'durationInSecond':_0x5f7495?0x15180:undefined},'audit':{'actor':_0x4ec7cd,'name':enums_1[_0x229b92(0x130)][_0x229b92(0xef)],'message':_0x229b92(0x109)+_0x3d3ada}},_0x4e29a5=await this['soundModel']['findOne']({'jobId':{'$ne':null}});_0x4e29a5&&await this['stop'](_0x4e29a5['id']);const {jobId:_0x1f1380}=await this[_0x229b92(0x12f)][_0x229b92(0x139)](_0x3aa08b);return this[_0x229b92(0xfd)](_0x3d3ada,{'jobId':_0x1f1380});}async[a136_0x534c46(0xe8)](_0x32f2fa){const _0x2046ca=a136_0x534c46;let _0x136761=await this[_0x2046ca(0xe7)](_0x32f2fa);const {jobId:_0x5218c8}=_0x136761||{};if(_0x5218c8){const {success:_0x9984e9}=await this[_0x2046ca(0x12f)][_0x2046ca(0x137)](_0x5218c8);_0x9984e9&&(_0x136761=await this['update'](_0x32f2fa,{'jobId':null}));}return this['soundGateway']['broadcastPlaying']({'id':_0x136761['id'],'isPlaying':![]}),_0x136761;}async[a136_0x534c46(0xce)](){const _0xd8d10e=a136_0x534c46,_0x46e41f=await this['findByType'](constants_2[_0xd8d10e(0xf0)][_0xd8d10e(0x11e)]);if(_0x46e41f[_0xd8d10e(0xd8)]>0x0){const _0x6eeedc=[];_0x46e41f[_0xd8d10e(0x104)](_0x1ac20a=>{const _0x213303=_0xd8d10e;_0x6eeedc[_0x213303(0x128)](this[_0x213303(0xe1)](_0x1ac20a[_0x213303(0x119)]));}),await Promise[_0xd8d10e(0xf1)](_0x6eeedc);}await(0x0,file_1[_0xd8d10e(0xe9)])(constants_1[_0xd8d10e(0xc5)],constants_1[_0xd8d10e(0xd0)]);const _0x19863a=[];return default_sounds_1['DEFAULT_TUNES'][_0xd8d10e(0x104)](_0x527c53=>{const _0x50d1b3=_0xd8d10e;_0x19863a['push'](this[_0x50d1b3(0xd4)](Object[_0x50d1b3(0xcb)]({},_0x527c53)));}),await Promise[_0xd8d10e(0xf1)](_0x19863a),!![];}[a136_0x534c46(0x127)](_0x403a10){const _0x55b52c=a136_0x534c46,_0x374742=_0x403a10['split']('.')['pop']();return(0x0,utils_1[_0x55b52c(0xdc)])()+'.'+_0x374742;}async['validateAndMoveFileAsync'](_0x5f4b98,_0x3f246b){const _0x490ee1=a136_0x534c46;if(!_0x5f4b98['fileName'])return;const _0x340d7c=constants_1['TMP_UPLOAD_DIR']+'/'+_0x5f4b98['fileName'],_0x3e11ca=_0x3f246b||this[_0x490ee1(0x127)](_0x5f4b98['fileName']),_0x2a6c9=constants_1[_0x490ee1(0xec)]+'/'+_0x3e11ca;if(!(0x0,file_1['isFileExist'])(_0x340d7c))throw new Error(_0x490ee1(0x133));!(0x0,file_1[_0x490ee1(0x103)])(constants_1['AUDIO_DIR'])&&(0x0,file_1[_0x490ee1(0x105)])(constants_1[_0x490ee1(0xec)]),await(0x0,file_1[_0x490ee1(0xdf)])(_0x340d7c,_0x2a6c9),_0x5f4b98[_0x490ee1(0x11d)]=_0x3e11ca;}};__decorate([(0x0,event_emitter_1[a136_0x534c46(0xfb)])(sound_1[a136_0x534c46(0x106)][a136_0x534c46(0xe0)]),__metadata(a136_0x534c46(0x135),Function),__metadata(a136_0x534c46(0x11a),[Object]),__metadata(a136_0x534c46(0x131),Promise)],SoundService[a136_0x534c46(0x132)],a136_0x534c46(0xd9),null),__decorate([(0x0,event_emitter_1['OnEvent'])(sound_1[a136_0x534c46(0x106)][a136_0x534c46(0x114)]),__metadata(a136_0x534c46(0x135),Function),__metadata(a136_0x534c46(0x11a),[Object]),__metadata('design:returntype',Promise)],SoundService['prototype'],'playVoiceRecorded',null),__decorate([(0x0,event_emitter_1['OnEvent'])(sound_1[a136_0x534c46(0x106)][a136_0x534c46(0xd6)]),__metadata(a136_0x534c46(0x135),Function),__metadata(a136_0x534c46(0x11a),[Object]),__metadata(a136_0x534c46(0x131),Promise)],SoundService[a136_0x534c46(0x132)],a136_0x534c46(0xd1),null),SoundService=SoundService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_1[a136_0x534c46(0xff)])(a136_0x534c46(0xc8))),__param(0x5,(0x0,common_1[a136_0x534c46(0xe5)])(sound_gateway_1[a136_0x534c46(0xdb)])),__metadata(a136_0x534c46(0x11a),[mongoose_2[a136_0x534c46(0x120)],agenda_service_1[a136_0x534c46(0x123)],upload_service_1['UploadService'],text_to_audio_service_1['TextToAudioService'],streaming_service_1[a136_0x534c46(0xc4)],sound_gateway_1['SoundGateway']])],SoundService),exports['SoundService']=SoundService;