'use strict';const a133_0x44de1f=a133_0x1506;(function(_0x383b76,_0x125457){const _0x31f358=a133_0x1506,_0x5c275b=_0x383b76();while(!![]){try{const _0x38b34b=parseInt(_0x31f358(0x127))/0x1*(parseInt(_0x31f358(0x123))/0x2)+parseInt(_0x31f358(0x171))/0x3+-parseInt(_0x31f358(0x13e))/0x4+parseInt(_0x31f358(0x166))/0x5+parseInt(_0x31f358(0x141))/0x6+parseInt(_0x31f358(0x118))/0x7*(parseInt(_0x31f358(0x15f))/0x8)+-parseInt(_0x31f358(0x180))/0x9;if(_0x38b34b===_0x125457)break;else _0x5c275b['push'](_0x5c275b['shift']());}catch(_0x28ac46){_0x5c275b['push'](_0x5c275b['shift']());}}}(a133_0x24a1,0x4efae));function a133_0x24a1(){const _0x181469=['error','TMP_UPLOAD_DIR','textToAudioService','Play\x20sound:\x20','audio','AUDIO_DIR','cancelJob','findByType','getMessageById','playAsync','assign','../upload/upload.service','design:paramtypes','../common/job','volume','@nestjs/event-emitter','Playing\x20voice\x20recorded:\x20','fileName','VoiceRecorded','push','prototype','918386voPQUr','DEFAULT_TUNES_DIR','function','../streaming/streaming.service','isFileExist','play','playStreamAudioAsync','length','defineProperty','__decorate','join','298706wHOwxt','PROCESS_CACHE','playVoiceRecorded','__param','4lVQuDB','__metadata','Logger','object','design:returntype','assets','../common/path','originalname','log','PlaySound','_id','processRootPath','save','update','pop','findOne','getOwnPropertyDescriptor','soundGateway','../common/file','SoundEvent','agendaService','@nestjs/mongoose','__esModule','1834040GfDBFZ','AgendaService','now','1884276gPjcIA','mongoose','soundModel','validateAndMoveFileAsync','../common/constants','../common/utils','deleteFile','streamingService','decorate','TextToAudioService','AudioPlayer','all','killAll','name','../common/audio/audio-player','SoundService','path','findById','filePath','create','Play','getNewFileName','JobType','Model','executeJob','uploadService','../text-to-audio/text-to-audio.service','SoundType','playSoundOnEvent','textToAudio','8FzfrLr','broadcastPlaying','./data/default-sounds','exec','scheduleJob','forEach','logger','201430MuxXqE','moveFile','Injectable','find','findVoiceRecoredById','resetTunes','OnEvent','UploadService','findByIds','findByIdAndUpdate','TextToAudio','1165914CGRbqI','\x20-\x20','createFolder','stop','./constants','delete','Sound\x20not\x20found!','playTextToAudioRecorded','upload','design:type','updateVolume','copyFiles','SoundGateway','InjectModel','metadata','6206112mPTqmw','Tune','uuid'];a133_0x24a1=function(){return _0x181469;};return a133_0x24a1();}var __decorate=this&&this[a133_0x44de1f(0x121)]||function(_0x1947a3,_0x47ad9f,_0x326b91,_0xdf0e1b){const _0x24cd79=a133_0x44de1f;var _0x28fcc0=arguments[_0x24cd79(0x11f)],_0x21f5aa=_0x28fcc0<0x3?_0x47ad9f:_0xdf0e1b===null?_0xdf0e1b=Object[_0x24cd79(0x137)](_0x47ad9f,_0x326b91):_0xdf0e1b,_0x8fe67f;if(typeof Reflect===_0x24cd79(0x12a)&&typeof Reflect[_0x24cd79(0x149)]===_0x24cd79(0x11a))_0x21f5aa=Reflect[_0x24cd79(0x149)](_0x1947a3,_0x47ad9f,_0x326b91,_0xdf0e1b);else{for(var _0x383847=_0x1947a3[_0x24cd79(0x11f)]-0x1;_0x383847>=0x0;_0x383847--)if(_0x8fe67f=_0x1947a3[_0x383847])_0x21f5aa=(_0x28fcc0<0x3?_0x8fe67f(_0x21f5aa):_0x28fcc0>0x3?_0x8fe67f(_0x47ad9f,_0x326b91,_0x21f5aa):_0x8fe67f(_0x47ad9f,_0x326b91))||_0x21f5aa;}return _0x28fcc0>0x3&&_0x21f5aa&&Object[_0x24cd79(0x120)](_0x47ad9f,_0x326b91,_0x21f5aa),_0x21f5aa;},__metadata=this&&this[a133_0x44de1f(0x128)]||function(_0x2a40ce,_0x56e320){const _0xc99cd5=a133_0x44de1f;if(typeof Reflect==='object'&&typeof Reflect[_0xc99cd5(0x17f)]===_0xc99cd5(0x11a))return Reflect[_0xc99cd5(0x17f)](_0x2a40ce,_0x56e320);},__param=this&&this[a133_0x44de1f(0x126)]||function(_0x10d0d0,_0x3025be){return function(_0x13ed08,_0x36f95e){_0x3025be(_0x13ed08,_0x36f95e,_0x10d0d0);};},SoundService_1;Object[a133_0x44de1f(0x120)](exports,a133_0x44de1f(0x13d),{'value':!![]}),exports[a133_0x44de1f(0x150)]=void 0x0;function a133_0x1506(_0x21f3a2,_0x51d6bd){const _0x24a15b=a133_0x24a1();return a133_0x1506=function(_0x150697,_0x396e71){_0x150697=_0x150697-0x111;let _0x5828a7=_0x24a15b[_0x150697];return _0x5828a7;},a133_0x1506(_0x21f3a2,_0x51d6bd);}const common_1=require('@nestjs/common'),mongoose_1=require(a133_0x44de1f(0x13c)),mongoose_2=require(a133_0x44de1f(0x142)),path=require(a133_0x44de1f(0x151)),event_emitter_1=require(a133_0x44de1f(0x112)),file_1=require(a133_0x44de1f(0x139)),agenda_service_1=require('../agenda/agenda.service'),enums_1=require('../common/enums'),constants_1=require(a133_0x44de1f(0x145)),utils_1=require(a133_0x44de1f(0x146)),path_1=require(a133_0x44de1f(0x12d)),audio_player_1=require(a133_0x44de1f(0x14f)),sound_1=require('../common/events/sound'),job_1=require(a133_0x44de1f(0x190)),constants_2=require(a133_0x44de1f(0x175)),default_sounds_1=require(a133_0x44de1f(0x161)),sound_gateway_1=require('./sound.gateway'),path_2=require(a133_0x44de1f(0x151)),upload_service_1=require(a133_0x44de1f(0x18e)),text_to_audio_service_1=require(a133_0x44de1f(0x15b)),streaming_service_1=require(a133_0x44de1f(0x11b));let SoundService=SoundService_1=class SoundService{constructor(_0x4698cb,_0x100d92,_0x158e78,_0x396158,_0x1464b3,_0x3c7f5e){const _0x17d6ad=a133_0x44de1f;this[_0x17d6ad(0x143)]=_0x4698cb,this[_0x17d6ad(0x13b)]=_0x100d92,this[_0x17d6ad(0x15a)]=_0x158e78,this[_0x17d6ad(0x185)]=_0x396158,this[_0x17d6ad(0x148)]=_0x1464b3,this[_0x17d6ad(0x138)]=_0x3c7f5e,this[_0x17d6ad(0x165)]=new common_1[(_0x17d6ad(0x129))](SoundService_1[_0x17d6ad(0x14e)]);}async[a133_0x44de1f(0x154)](_0x236548){const _0x3eb2a0=a133_0x44de1f;await this['validateAndMoveFileAsync'](_0x236548,null);const _0x444cfb=new this[(_0x3eb2a0(0x143))](_0x236548);return _0x444cfb[_0x3eb2a0(0x133)]();}async[a133_0x44de1f(0x18a)](_0x141eea){const _0x7783ab=a133_0x44de1f,_0x47c59c=await this['soundModel'][_0x7783ab(0x169)]({'type':_0x141eea})[_0x7783ab(0x162)]();return _0x47c59c;}async['findOne'](_0x46fc02){const _0x450733=a133_0x44de1f,_0x5102a3=await this[_0x450733(0x143)][_0x450733(0x152)](_0x46fc02);return _0x5102a3;}async[a133_0x44de1f(0x16e)](_0x5ae128){const _0x674939=a133_0x44de1f,_0x292786=await this['soundModel'][_0x674939(0x169)]({'_id':{'$in':_0x5ae128}});return _0x292786;}async[a133_0x44de1f(0x134)](_0x1fc7fa,_0x3c3c4a){const _0x244bc4=a133_0x44de1f,_0x1df64b=await this[_0x244bc4(0x143)][_0x244bc4(0x152)](_0x1fc7fa)[_0x244bc4(0x162)]();if(!_0x1df64b)throw new Error('Sound\x20not\x20found!');await this[_0x244bc4(0x144)](_0x3c3c4a,_0x1df64b===null||_0x1df64b===void 0x0?void 0x0:_0x1df64b[_0x244bc4(0x114)]);const _0x412cbd=await this[_0x244bc4(0x143)][_0x244bc4(0x16f)](_0x1fc7fa,Object[_0x244bc4(0x18d)](Object[_0x244bc4(0x18d)]({},_0x3c3c4a),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x412cbd;}async[a133_0x44de1f(0x17b)](_0x525094,_0x5b1a19){const _0x282e81=a133_0x44de1f,_0x43a46d=await this[_0x282e81(0x143)][_0x282e81(0x152)](_0x525094)['exec']();if(!_0x43a46d)throw new Error(_0x282e81(0x177));const _0x1b32d4=await this[_0x282e81(0x143)][_0x282e81(0x16f)](_0x525094,Object[_0x282e81(0x18d)](Object[_0x282e81(0x18d)]({},_0x5b1a19),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x1b32d4;}async[a133_0x44de1f(0x176)](_0x34e4db){const _0x59af29=a133_0x44de1f,_0x34d86f=await this[_0x59af29(0x143)]['findByIdAndDelete'](_0x34e4db);if(_0x34d86f[_0x59af29(0x114)]){const _0x364270=constants_1[_0x59af29(0x188)]+'/'+_0x34d86f[_0x59af29(0x114)];try{(0x0,file_1['deleteFile'])(_0x364270);}catch(_0x2ff3e1){this['logger'][_0x59af29(0x183)](_0x2ff3e1);}}return _0x34d86f;}async[a133_0x44de1f(0x179)](_0x3a883a,_0x19b6f9){const _0x2edf02=a133_0x44de1f,_0x586cb3=await this[_0x2edf02(0x143)][_0x2edf02(0x152)](_0x3a883a)[_0x2edf02(0x162)](),_0x4cee94=_0x586cb3===null||_0x586cb3===void 0x0?void 0x0:_0x586cb3[_0x2edf02(0x114)],_0x69bac8=this[_0x2edf02(0x156)](_0x19b6f9[_0x2edf02(0x12e)]),_0x50e538=constants_1['AUDIO_DIR']+'/'+_0x69bac8;await(0x0,file_1['moveFile'])(_0x19b6f9['path'],_0x50e538);const _0x2079a8={'fileName':_0x69bac8},_0x541970=await this[_0x2edf02(0x143)][_0x2edf02(0x16f)](_0x3a883a,Object['assign'](Object['assign']({},_0x2079a8),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0x4cee94){const _0x509a47=constants_1[_0x2edf02(0x188)]+'/'+_0x4cee94;(0x0,file_1[_0x2edf02(0x147)])(_0x509a47);}return _0x541970;}async[a133_0x44de1f(0x15d)](_0x1de2e4){const _0x517cec=a133_0x44de1f,{soundId:_0x2b7578,jobId:_0x2be096,durationInSecond:_0x3b913a}=_0x1de2e4,_0x20e572=await this['findOne'](_0x2b7578),_0x5d7229=path['join'](path_1[_0x517cec(0x132)],_0x517cec(0x12c),_0x517cec(0x187),_0x20e572[_0x517cec(0x114)]);job_1[_0x517cec(0x124)][_0x517cec(0x14d)](),this['logger'][_0x517cec(0x12f)]('Playing\x20sound:\x20'+_0x2b7578+_0x517cec(0x172)+_0x20e572[_0x517cec(0x14e)]),(0x0,job_1['executeJob'])({'jobId':_0x2be096,'run':()=>audio_player_1[_0x517cec(0x14b)][_0x517cec(0x18c)](_0x5d7229,_0x20e572[_0x517cec(0x111)]),'next':()=>this['stop'](_0x2b7578),'durationInSecond':_0x3b913a}),this[_0x517cec(0x138)][_0x517cec(0x160)]({'id':_0x2b7578,'isPlaying':!![]});}async[a133_0x44de1f(0x125)](_0x38eb23){const _0x43d052=a133_0x44de1f,{voiceId:_0x37f60b,jobId:_0x3e3e9c,durationInSecond:_0xdbc2c8}=_0x38eb23,_0x5a196d=await this[_0x43d052(0x15a)][_0x43d052(0x16a)](_0x37f60b),_0x328827=_0x5a196d[_0x43d052(0x153)],_0x4a9607=(0x0,path_2[_0x43d052(0x122)])(process['cwd'](),_0x328827);job_1['PROCESS_CACHE'][_0x43d052(0x14d)](),this[_0x43d052(0x165)][_0x43d052(0x12f)](_0x43d052(0x113)+_0x37f60b),(0x0,job_1['executeJob'])({'jobId':_0x3e3e9c,'run':()=>audio_player_1[_0x43d052(0x14b)][_0x43d052(0x18c)](_0x4a9607),'durationInSecond':_0xdbc2c8,'next':()=>null});}async[a133_0x44de1f(0x178)](_0x79882f){const _0x105e52=a133_0x44de1f,{textToAudioId:_0x585db0,jobId:_0x3bb925,durationInSecond:_0x1d93db}=_0x79882f,{message:_0x484189}=await this['textToAudioService'][_0x105e52(0x18b)](_0x585db0);job_1[_0x105e52(0x124)]['killAll'](),(0x0,job_1[_0x105e52(0x159)])({'jobId':_0x3bb925,'run':()=>{const _0x1020b0=_0x105e52;let _0x51f566=null;return this[_0x1020b0(0x185)][_0x1020b0(0x15e)](_0x484189,_0x476dee=>{const _0x58afc1=_0x1020b0;_0x51f566=this[_0x58afc1(0x148)][_0x58afc1(0x11e)](_0x476dee);}),_0x51f566;},'durationInSecond':_0x1d93db,'next':()=>null});}async[a133_0x44de1f(0x11d)](_0x541ee4,_0x535680,_0x55ada3=![]){const _0x2e12b8=a133_0x44de1f,_0x5325d2={'when':_0x2e12b8(0x140),'jobType':enums_1[_0x2e12b8(0x157)][_0x2e12b8(0x130)],'attributes':{'soundId':_0x535680,'durationInSecond':_0x55ada3?0x15180:undefined},'audit':{'actor':_0x541ee4,'name':enums_1[_0x2e12b8(0x157)]['PlaySound'],'message':_0x2e12b8(0x186)+_0x535680}},_0x1da3b7=await this[_0x2e12b8(0x143)][_0x2e12b8(0x136)]({'jobId':{'$ne':null}});_0x1da3b7&&await this[_0x2e12b8(0x174)](_0x1da3b7['id']);const {jobId:_0x1d3a06}=await this[_0x2e12b8(0x13b)][_0x2e12b8(0x163)](_0x5325d2);return this[_0x2e12b8(0x134)](_0x535680,{'jobId':_0x1d3a06});}async[a133_0x44de1f(0x174)](_0x23370a){const _0x4b5165=a133_0x44de1f;let _0xb0e394=await this['findOne'](_0x23370a);const {jobId:_0x5225e2}=_0xb0e394||{};if(_0x5225e2){const {success:_0x5ffe1a}=await this[_0x4b5165(0x13b)][_0x4b5165(0x189)](_0x5225e2);_0x5ffe1a&&(_0xb0e394=await this[_0x4b5165(0x134)](_0x23370a,{'jobId':null}));}return this['soundGateway'][_0x4b5165(0x160)]({'id':_0xb0e394['id'],'isPlaying':![]}),_0xb0e394;}async[a133_0x44de1f(0x16b)](){const _0x172d00=a133_0x44de1f,_0x7e1ac2=await this[_0x172d00(0x18a)](constants_2[_0x172d00(0x15c)][_0x172d00(0x181)]);if(_0x7e1ac2[_0x172d00(0x11f)]>0x0){const _0xd0a297=[];_0x7e1ac2[_0x172d00(0x164)](_0x597e5a=>{const _0x2c3169=_0x172d00;_0xd0a297[_0x2c3169(0x116)](this['delete'](_0x597e5a[_0x2c3169(0x131)]));}),await Promise[_0x172d00(0x14c)](_0xd0a297);}await(0x0,file_1[_0x172d00(0x17c)])(constants_1[_0x172d00(0x119)],constants_1[_0x172d00(0x184)]);const _0x1f2dc0=[];return default_sounds_1['DEFAULT_TUNES']['forEach'](_0x474d91=>{const _0x5d0857=_0x172d00;_0x1f2dc0['push'](this['create'](Object[_0x5d0857(0x18d)]({},_0x474d91)));}),await Promise['all'](_0x1f2dc0),!![];}[a133_0x44de1f(0x156)](_0x46047e){const _0x5622b7=a133_0x44de1f,_0x4de10f=_0x46047e['split']('.')[_0x5622b7(0x135)]();return(0x0,utils_1[_0x5622b7(0x182)])()+'.'+_0x4de10f;}async['validateAndMoveFileAsync'](_0x562d72,_0x2f100b){const _0x5f034d=a133_0x44de1f;if(!_0x562d72[_0x5f034d(0x114)])return;const _0x3d2878=constants_1[_0x5f034d(0x184)]+'/'+_0x562d72['fileName'],_0x13b932=_0x2f100b||this[_0x5f034d(0x156)](_0x562d72['fileName']),_0x3a7178=constants_1[_0x5f034d(0x188)]+'/'+_0x13b932;if(!(0x0,file_1[_0x5f034d(0x11c)])(_0x3d2878))throw new Error('File\x20not\x20found!');!(0x0,file_1[_0x5f034d(0x11c)])(constants_1['AUDIO_DIR'])&&(0x0,file_1[_0x5f034d(0x173)])(constants_1['AUDIO_DIR']),await(0x0,file_1[_0x5f034d(0x167)])(_0x3d2878,_0x3a7178),_0x562d72[_0x5f034d(0x114)]=_0x13b932;}};__decorate([(0x0,event_emitter_1[a133_0x44de1f(0x16c)])(sound_1[a133_0x44de1f(0x13a)][a133_0x44de1f(0x155)]),__metadata(a133_0x44de1f(0x17a),Function),__metadata(a133_0x44de1f(0x18f),[Object]),__metadata(a133_0x44de1f(0x12b),Promise)],SoundService[a133_0x44de1f(0x117)],a133_0x44de1f(0x15d),null),__decorate([(0x0,event_emitter_1[a133_0x44de1f(0x16c)])(sound_1['SoundEvent'][a133_0x44de1f(0x115)]),__metadata(a133_0x44de1f(0x17a),Function),__metadata('design:paramtypes',[Object]),__metadata(a133_0x44de1f(0x12b),Promise)],SoundService[a133_0x44de1f(0x117)],'playVoiceRecorded',null),__decorate([(0x0,event_emitter_1[a133_0x44de1f(0x16c)])(sound_1[a133_0x44de1f(0x13a)][a133_0x44de1f(0x170)]),__metadata(a133_0x44de1f(0x17a),Function),__metadata(a133_0x44de1f(0x18f),[Object]),__metadata('design:returntype',Promise)],SoundService[a133_0x44de1f(0x117)],a133_0x44de1f(0x178),null),SoundService=SoundService_1=__decorate([(0x0,common_1[a133_0x44de1f(0x168)])(),__param(0x0,(0x0,mongoose_1[a133_0x44de1f(0x17e)])('Sound')),__param(0x5,(0x0,common_1['Inject'])(sound_gateway_1[a133_0x44de1f(0x17d)])),__metadata('design:paramtypes',[mongoose_2[a133_0x44de1f(0x158)],agenda_service_1[a133_0x44de1f(0x13f)],upload_service_1[a133_0x44de1f(0x16d)],text_to_audio_service_1[a133_0x44de1f(0x14a)],streaming_service_1['StreamingService'],sound_gateway_1[a133_0x44de1f(0x17d)]])],SoundService),exports[a133_0x44de1f(0x150)]=SoundService;