'use strict';const a133_0x3a68f4=a133_0x1d85;(function(_0x122b6c,_0x141d24){const _0x2b5c34=a133_0x1d85,_0x475e18=_0x122b6c();while(!![]){try{const _0x19c763=parseInt(_0x2b5c34(0xb6))/0x1+-parseInt(_0x2b5c34(0x89))/0x2*(-parseInt(_0x2b5c34(0x91))/0x3)+-parseInt(_0x2b5c34(0xee))/0x4*(-parseInt(_0x2b5c34(0x82))/0x5)+parseInt(_0x2b5c34(0xf9))/0x6+-parseInt(_0x2b5c34(0xd9))/0x7+parseInt(_0x2b5c34(0x83))/0x8+-parseInt(_0x2b5c34(0x86))/0x9;if(_0x19c763===_0x141d24)break;else _0x475e18['push'](_0x475e18['shift']());}catch(_0x8ef92a){_0x475e18['push'](_0x475e18['shift']());}}}(a133_0x25f4,0x6c609));var __decorate=this&&this['__decorate']||function(_0x29d01a,_0x16f8cc,_0x38c655,_0x38c96a){const _0x295204=a133_0x1d85;var _0x2421c1=arguments[_0x295204(0x8e)],_0x23f28a=_0x2421c1<0x3?_0x16f8cc:_0x38c96a===null?_0x38c96a=Object[_0x295204(0x9b)](_0x16f8cc,_0x38c655):_0x38c96a,_0x47af8c;if(typeof Reflect===_0x295204(0x9d)&&typeof Reflect[_0x295204(0xed)]===_0x295204(0x97))_0x23f28a=Reflect[_0x295204(0xed)](_0x29d01a,_0x16f8cc,_0x38c655,_0x38c96a);else{for(var _0x34c5c9=_0x29d01a[_0x295204(0x8e)]-0x1;_0x34c5c9>=0x0;_0x34c5c9--)if(_0x47af8c=_0x29d01a[_0x34c5c9])_0x23f28a=(_0x2421c1<0x3?_0x47af8c(_0x23f28a):_0x2421c1>0x3?_0x47af8c(_0x16f8cc,_0x38c655,_0x23f28a):_0x47af8c(_0x16f8cc,_0x38c655))||_0x23f28a;}return _0x2421c1>0x3&&_0x23f28a&&Object[_0x295204(0xff)](_0x16f8cc,_0x38c655,_0x23f28a),_0x23f28a;},__metadata=this&&this[a133_0x3a68f4(0x81)]||function(_0x1b7d14,_0x3e6a94){const _0x35794d=a133_0x3a68f4;if(typeof Reflect===_0x35794d(0x9d)&&typeof Reflect[_0x35794d(0xa9)]==='function')return Reflect[_0x35794d(0xa9)](_0x1b7d14,_0x3e6a94);},__param=this&&this[a133_0x3a68f4(0xa5)]||function(_0x58f145,_0x334f6b){return function(_0x207577,_0x54659d){_0x334f6b(_0x207577,_0x54659d,_0x58f145);};},SoundService_1;Object[a133_0x3a68f4(0xff)](exports,a133_0x3a68f4(0xe1),{'value':!![]}),exports['SoundService']=void 0x0;const common_1=require(a133_0x3a68f4(0xa1)),mongoose_1=require(a133_0x3a68f4(0xab)),mongoose_2=require(a133_0x3a68f4(0xb0)),path=require('path'),event_emitter_1=require(a133_0x3a68f4(0xa0)),file_1=require('../common/file'),agenda_service_1=require('../agenda/agenda.service'),enums_1=require(a133_0x3a68f4(0x84)),constants_1=require('../common/constants'),utils_1=require(a133_0x3a68f4(0x85)),path_1=require(a133_0x3a68f4(0xcd)),audio_player_1=require(a133_0x3a68f4(0xa4)),sound_1=require(a133_0x3a68f4(0xec)),job_1=require(a133_0x3a68f4(0xc9)),constants_2=require(a133_0x3a68f4(0xbd)),default_sounds_1=require(a133_0x3a68f4(0xe2)),sound_gateway_1=require(a133_0x3a68f4(0xf2)),path_2=require('path'),upload_service_1=require('../upload/upload.service'),text_to_audio_service_1=require(a133_0x3a68f4(0xc7)),streaming_service_1=require('../streaming/streaming.service');function a133_0x25f4(){const _0x21aa64=['2911728lPkjcE','../common/enums','../common/utils','11604249bqRnQw','soundModel','Play','126794kKKuLD','logger','moveFile','TextToAudioService','error','length','InjectModel','find','33qsiiCv','exec','Tune','scheduleJob','pop','playVoiceRecorded','function','TMP_UPLOAD_DIR','DEFAULT_TUNES','_id','getOwnPropertyDescriptor','log','object','Play\x20sound:\x20','textToAudioService','@nestjs/event-emitter','@nestjs/common','SoundGateway','soundGateway','../common/audio/audio-player','__param','playTextToAudioRecorded','now','delete','metadata','join','@nestjs/mongoose','name','resetTunes','getNewFileName','stop','mongoose','save','update','playSoundOnEvent','isFileExist','fileName','556235OrhEdZ','broadcastPlaying','Playing\x20sound:\x20','VoiceRecorded','design:type','Sound\x20not\x20found!','killAll','./constants','File\x20not\x20found!','playStreamAudioAsync','findByIdAndUpdate','agendaService','processRootPath','play','Sound\x20file\x20not\x20found:\x20','copyFiles','AUDIO_DIR','../text-to-audio/text-to-audio.service','JobType','../common/job','createFolder','Sound','push','../common/path','validateAndMoveFileAsync','SoundService','\x20-\x20','assign','uploadService','streamingService','SoundType','design:returntype','path','Voice\x20file\x20not\x20found:\x20','Injectable','6188749qWpAzY','design:paramtypes','findVoiceRecoredById','uuid','SoundEvent','all','findOne','playAsync','__esModule','./data/default-sounds','split','originalname','UploadService','deleteFile','PROCESS_CACHE','textToAudio','findByType','Playing\x20voice\x20recorded:\x20','AudioPlayer','../common/events/sound','decorate','3018556isKRSR','audio','TextToAudio','getMessageById','./sound.gateway','StreamingService','volume','cwd','create','prototype','AgendaService','1471044tawTAr','assets','Inject','forEach','cancelJob','Model','defineProperty','executeJob','findById','filePath','OnEvent','findByIdAndDelete','__metadata','5rVspeB'];a133_0x25f4=function(){return _0x21aa64;};return a133_0x25f4();}let SoundService=SoundService_1=class SoundService{constructor(_0x5309b5,_0x51237f,_0x251012,_0x1a64be,_0x46e1df,_0x2bff0c){const _0x2309de=a133_0x3a68f4;this['soundModel']=_0x5309b5,this[_0x2309de(0xc1)]=_0x51237f,this['uploadService']=_0x251012,this[_0x2309de(0x9f)]=_0x1a64be,this[_0x2309de(0xd3)]=_0x46e1df,this['soundGateway']=_0x2bff0c,this[_0x2309de(0x8a)]=new common_1['Logger'](SoundService_1[_0x2309de(0xac)]);}async[a133_0x3a68f4(0xf6)](_0xcce2e8){const _0x2422d0=a133_0x3a68f4;await this[_0x2422d0(0xce)](_0xcce2e8,null);const _0x20f4d3=new this[(_0x2422d0(0x87))](_0xcce2e8);return _0x20f4d3[_0x2422d0(0xb1)]();}async[a133_0x3a68f4(0xe9)](_0x2afbce){const _0x4a49fe=a133_0x3a68f4,_0x21f391=await this['soundModel']['find']({'type':_0x2afbce})[_0x4a49fe(0x92)]();return _0x21f391;}async[a133_0x3a68f4(0xdf)](_0x1cfbaa){const _0x2f9478=a133_0x3a68f4,_0x336343=await this['soundModel'][_0x2f9478(0x101)](_0x1cfbaa);return _0x336343;}async['findByIds'](_0x5cfe96){const _0x322e6d=a133_0x3a68f4,_0xe76a33=await this['soundModel'][_0x322e6d(0x90)]({'_id':{'$in':_0x5cfe96}});return _0xe76a33;}async['update'](_0x3c2389,_0x3d34d7){const _0x2762ce=a133_0x3a68f4,_0x4912c9=await this[_0x2762ce(0x87)][_0x2762ce(0x101)](_0x3c2389)[_0x2762ce(0x92)]();if(!_0x4912c9)throw new Error(_0x2762ce(0xbb));await this['validateAndMoveFileAsync'](_0x3d34d7,_0x4912c9===null||_0x4912c9===void 0x0?void 0x0:_0x4912c9[_0x2762ce(0xb5)]);const _0x26ba41=await this[_0x2762ce(0x87)][_0x2762ce(0xc0)](_0x3c2389,Object[_0x2762ce(0xd1)](Object[_0x2762ce(0xd1)]({},_0x3d34d7),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x26ba41;}async['updateVolume'](_0x1db0e1,_0x11eee4){const _0x23380c=a133_0x3a68f4,_0x5266da=await this[_0x23380c(0x87)]['findById'](_0x1db0e1)[_0x23380c(0x92)]();if(!_0x5266da)throw new Error(_0x23380c(0xbb));const _0x454906=await this[_0x23380c(0x87)]['findByIdAndUpdate'](_0x1db0e1,Object[_0x23380c(0xd1)](Object['assign']({},_0x11eee4),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x454906;}async[a133_0x3a68f4(0xa8)](_0x1df0ab){const _0x3b47a8=a133_0x3a68f4,_0x1fdb90=await this[_0x3b47a8(0x87)][_0x3b47a8(0x80)](_0x1df0ab);if(_0x1fdb90['fileName']){const _0x3ef216=constants_1['AUDIO_DIR']+'/'+_0x1fdb90[_0x3b47a8(0xb5)];try{(0x0,file_1[_0x3b47a8(0xe6)])(_0x3ef216);}catch(_0xbd6573){this[_0x3b47a8(0x8a)][_0x3b47a8(0x8d)](_0xbd6573);}}return _0x1fdb90;}async['upload'](_0x422b11,_0x218900){const _0x978ef8=a133_0x3a68f4,_0x1caf43=await this[_0x978ef8(0x87)][_0x978ef8(0x101)](_0x422b11)[_0x978ef8(0x92)](),_0x40c6a6=_0x1caf43===null||_0x1caf43===void 0x0?void 0x0:_0x1caf43[_0x978ef8(0xb5)],_0x4b46ea=this[_0x978ef8(0xae)](_0x218900[_0x978ef8(0xe4)]),_0x4452c1=constants_1[_0x978ef8(0xc6)]+'/'+_0x4b46ea;await(0x0,file_1[_0x978ef8(0x8b)])(_0x218900[_0x978ef8(0xd6)],_0x4452c1);const _0x47d0d8={'fileName':_0x4b46ea},_0x10be80=await this['soundModel'][_0x978ef8(0xc0)](_0x422b11,Object[_0x978ef8(0xd1)](Object[_0x978ef8(0xd1)]({},_0x47d0d8),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0x40c6a6){const _0x1b823e=constants_1[_0x978ef8(0xc6)]+'/'+_0x40c6a6;(0x0,file_1[_0x978ef8(0xe6)])(_0x1b823e);}return _0x10be80;}async[a133_0x3a68f4(0xb3)](_0x2e49cb){const _0x3bccfe=a133_0x3a68f4,{soundId:_0x5b69ae,jobId:_0x4eb967,durationInSecond:_0x5514c3}=_0x2e49cb,_0x464169=await this['findOne'](_0x5b69ae),_0x3f9348=path[_0x3bccfe(0xaa)](path_1[_0x3bccfe(0xc2)],_0x3bccfe(0xfa),_0x3bccfe(0xef),_0x464169[_0x3bccfe(0xb5)]);if(!(0x0,file_1[_0x3bccfe(0xb4)])(_0x3f9348)){this[_0x3bccfe(0x8a)][_0x3bccfe(0x8d)](_0x3bccfe(0xc4)+_0x3f9348);return;}job_1[_0x3bccfe(0xe7)][_0x3bccfe(0xbc)](),this[_0x3bccfe(0x8a)][_0x3bccfe(0x9c)](_0x3bccfe(0xb8)+_0x5b69ae+_0x3bccfe(0xd0)+_0x464169[_0x3bccfe(0xac)]),(0x0,job_1[_0x3bccfe(0x100)])({'jobId':_0x4eb967,'run':()=>audio_player_1[_0x3bccfe(0xeb)][_0x3bccfe(0xe0)](_0x3f9348,_0x464169[_0x3bccfe(0xf4)]),'next':()=>this['stop'](_0x5b69ae),'durationInSecond':_0x5514c3}),this['soundGateway']['broadcastPlaying']({'id':_0x5b69ae,'isPlaying':!![]});}async[a133_0x3a68f4(0x96)](_0x28c268){const _0x5bb89=a133_0x3a68f4,{voiceId:_0x74a6d4,jobId:_0x1d9f68,durationInSecond:_0x5b008b}=_0x28c268,_0x519d15=await this[_0x5bb89(0xd2)][_0x5bb89(0xdb)](_0x74a6d4),_0x4c6dcb=_0x519d15[_0x5bb89(0x7e)],_0x2d37b3=(0x0,path_2['join'])(process[_0x5bb89(0xf5)](),_0x4c6dcb);if(!(0x0,file_1['isFileExist'])(_0x2d37b3)){this[_0x5bb89(0x8a)]['error'](_0x5bb89(0xd7)+_0x2d37b3);return;}job_1[_0x5bb89(0xe7)][_0x5bb89(0xbc)](),this[_0x5bb89(0x8a)]['log'](_0x5bb89(0xea)+_0x74a6d4),(0x0,job_1[_0x5bb89(0x100)])({'jobId':_0x1d9f68,'run':()=>audio_player_1['AudioPlayer'][_0x5bb89(0xe0)](_0x2d37b3),'durationInSecond':_0x5b008b,'next':()=>null});}async[a133_0x3a68f4(0xa6)](_0x2c26ee){const _0x5a25ed=a133_0x3a68f4,{textToAudioId:_0x186330,jobId:_0x192d7f,durationInSecond:_0x525fbe}=_0x2c26ee,{message:_0x2ee759}=await this[_0x5a25ed(0x9f)][_0x5a25ed(0xf1)](_0x186330);job_1[_0x5a25ed(0xe7)][_0x5a25ed(0xbc)](),(0x0,job_1[_0x5a25ed(0x100)])({'jobId':_0x192d7f,'run':()=>{const _0x525bf3=_0x5a25ed;let _0x39d25d=null;return this[_0x525bf3(0x9f)][_0x525bf3(0xe8)](_0x2ee759,_0x492159=>{const _0x51be8d=_0x525bf3;_0x39d25d=this['streamingService'][_0x51be8d(0xbf)](_0x492159);}),_0x39d25d;},'durationInSecond':_0x525fbe,'next':()=>null});}async[a133_0x3a68f4(0xc3)](_0x30051a,_0x17d8e2,_0x4dcb50=![]){const _0x16bfbb=a133_0x3a68f4,_0x1cc5a1={'when':_0x16bfbb(0xa7),'jobType':enums_1['JobType']['PlaySound'],'attributes':{'soundId':_0x17d8e2,'durationInSecond':_0x4dcb50?0x15180:undefined},'audit':{'actor':_0x30051a,'name':enums_1[_0x16bfbb(0xc8)]['PlaySound'],'message':_0x16bfbb(0x9e)+_0x17d8e2}},_0x246029=await this[_0x16bfbb(0x87)][_0x16bfbb(0xdf)]({'jobId':{'$ne':null}});_0x246029&&await this['stop'](_0x246029['id']);const {jobId:_0x10e320}=await this[_0x16bfbb(0xc1)][_0x16bfbb(0x94)](_0x1cc5a1);return this[_0x16bfbb(0xb2)](_0x17d8e2,{'jobId':_0x10e320});}async[a133_0x3a68f4(0xaf)](_0x2638e0){const _0x49420a=a133_0x3a68f4;let _0x4cf4d7=await this[_0x49420a(0xdf)](_0x2638e0);const {jobId:_0x520eb4}=_0x4cf4d7||{};if(_0x520eb4){const {success:_0x5e7a9e}=await this[_0x49420a(0xc1)][_0x49420a(0xfd)](_0x520eb4);_0x5e7a9e&&(_0x4cf4d7=await this[_0x49420a(0xb2)](_0x2638e0,{'jobId':null}));}return this[_0x49420a(0xa3)][_0x49420a(0xb7)]({'id':_0x4cf4d7['id'],'isPlaying':![]}),_0x4cf4d7;}async[a133_0x3a68f4(0xad)](){const _0x479b42=a133_0x3a68f4,_0x15fe2f=await this[_0x479b42(0xe9)](constants_2[_0x479b42(0xd4)][_0x479b42(0x93)]);if(_0x15fe2f[_0x479b42(0x8e)]>0x0){const _0x3f4809=[];_0x15fe2f[_0x479b42(0xfc)](_0xeef57a=>{const _0x438f08=_0x479b42;_0x3f4809['push'](this[_0x438f08(0xa8)](_0xeef57a[_0x438f08(0x9a)]));}),await Promise[_0x479b42(0xde)](_0x3f4809);}await(0x0,file_1[_0x479b42(0xc5)])(constants_1['DEFAULT_TUNES_DIR'],constants_1[_0x479b42(0x98)]);const _0x3da878=[];return default_sounds_1[_0x479b42(0x99)]['forEach'](_0x42dea4=>{const _0x1ae33a=_0x479b42;_0x3da878[_0x1ae33a(0xcc)](this[_0x1ae33a(0xf6)](Object['assign']({},_0x42dea4)));}),await Promise[_0x479b42(0xde)](_0x3da878),!![];}[a133_0x3a68f4(0xae)](_0x3f69cf){const _0x2ff8c=a133_0x3a68f4,_0x5ae44c=_0x3f69cf[_0x2ff8c(0xe3)]('.')[_0x2ff8c(0x95)]();return(0x0,utils_1[_0x2ff8c(0xdc)])()+'.'+_0x5ae44c;}async[a133_0x3a68f4(0xce)](_0xf5bc72,_0x4648a9){const _0x2c0324=a133_0x3a68f4;if(!_0xf5bc72[_0x2c0324(0xb5)])return;const _0x419051=constants_1[_0x2c0324(0x98)]+'/'+_0xf5bc72['fileName'],_0x51d4fd=_0x4648a9||this[_0x2c0324(0xae)](_0xf5bc72[_0x2c0324(0xb5)]),_0x216697=constants_1[_0x2c0324(0xc6)]+'/'+_0x51d4fd;if(!(0x0,file_1['isFileExist'])(_0x419051))throw new Error(_0x2c0324(0xbe));!(0x0,file_1['isFileExist'])(constants_1[_0x2c0324(0xc6)])&&(0x0,file_1[_0x2c0324(0xca)])(constants_1[_0x2c0324(0xc6)]),await(0x0,file_1[_0x2c0324(0x8b)])(_0x419051,_0x216697),_0xf5bc72[_0x2c0324(0xb5)]=_0x51d4fd;}};function a133_0x1d85(_0x3edbc7,_0x56d028){const _0x25f476=a133_0x25f4();return a133_0x1d85=function(_0x1d85bc,_0x1abc18){_0x1d85bc=_0x1d85bc-0x7e;let _0x1f834e=_0x25f476[_0x1d85bc];return _0x1f834e;},a133_0x1d85(_0x3edbc7,_0x56d028);}__decorate([(0x0,event_emitter_1[a133_0x3a68f4(0x7f)])(sound_1[a133_0x3a68f4(0xdd)][a133_0x3a68f4(0x88)]),__metadata(a133_0x3a68f4(0xba),Function),__metadata(a133_0x3a68f4(0xda),[Object]),__metadata('design:returntype',Promise)],SoundService[a133_0x3a68f4(0xf7)],a133_0x3a68f4(0xb3),null),__decorate([(0x0,event_emitter_1[a133_0x3a68f4(0x7f)])(sound_1[a133_0x3a68f4(0xdd)][a133_0x3a68f4(0xb9)]),__metadata(a133_0x3a68f4(0xba),Function),__metadata(a133_0x3a68f4(0xda),[Object]),__metadata(a133_0x3a68f4(0xd5),Promise)],SoundService[a133_0x3a68f4(0xf7)],a133_0x3a68f4(0x96),null),__decorate([(0x0,event_emitter_1[a133_0x3a68f4(0x7f)])(sound_1[a133_0x3a68f4(0xdd)][a133_0x3a68f4(0xf0)]),__metadata('design:type',Function),__metadata(a133_0x3a68f4(0xda),[Object]),__metadata(a133_0x3a68f4(0xd5),Promise)],SoundService[a133_0x3a68f4(0xf7)],a133_0x3a68f4(0xa6),null),SoundService=SoundService_1=__decorate([(0x0,common_1[a133_0x3a68f4(0xd8)])(),__param(0x0,(0x0,mongoose_1[a133_0x3a68f4(0x8f)])(a133_0x3a68f4(0xcb))),__param(0x5,(0x0,common_1[a133_0x3a68f4(0xfb)])(sound_gateway_1['SoundGateway'])),__metadata(a133_0x3a68f4(0xda),[mongoose_2[a133_0x3a68f4(0xfe)],agenda_service_1[a133_0x3a68f4(0xf8)],upload_service_1[a133_0x3a68f4(0xe5)],text_to_audio_service_1[a133_0x3a68f4(0x8c)],streaming_service_1[a133_0x3a68f4(0xf3)],sound_gateway_1[a133_0x3a68f4(0xa2)]])],SoundService),exports[a133_0x3a68f4(0xcf)]=SoundService;