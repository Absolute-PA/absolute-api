'use strict';const a136_0x58c2bd=a136_0x3ab2;(function(_0x26f6cd,_0x516c58){const _0x2713c3=a136_0x3ab2,_0x282a8c=_0x26f6cd();while(!![]){try{const _0x346b81=parseInt(_0x2713c3(0x1ed))/0x1*(parseInt(_0x2713c3(0x230))/0x2)+-parseInt(_0x2713c3(0x221))/0x3*(-parseInt(_0x2713c3(0x1e5))/0x4)+parseInt(_0x2713c3(0x223))/0x5*(parseInt(_0x2713c3(0x212))/0x6)+parseInt(_0x2713c3(0x1e3))/0x7+parseInt(_0x2713c3(0x206))/0x8*(-parseInt(_0x2713c3(0x1d0))/0x9)+-parseInt(_0x2713c3(0x21d))/0xa+-parseInt(_0x2713c3(0x1db))/0xb;if(_0x346b81===_0x516c58)break;else _0x282a8c['push'](_0x282a8c['shift']());}catch(_0x37b55e){_0x282a8c['push'](_0x282a8c['shift']());}}}(a136_0x35a5,0x85b75));var __decorate=this&&this[a136_0x58c2bd(0x1f0)]||function(_0x4b72d4,_0x2ffc85,_0x15b4e0,_0x47a4f1){const _0xfc800f=a136_0x58c2bd;var _0x629c86=arguments[_0xfc800f(0x247)],_0x202b0b=_0x629c86<0x3?_0x2ffc85:_0x47a4f1===null?_0x47a4f1=Object[_0xfc800f(0x1df)](_0x2ffc85,_0x15b4e0):_0x47a4f1,_0x5fcf97;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0xfc800f(0x242))_0x202b0b=Reflect[_0xfc800f(0x202)](_0x4b72d4,_0x2ffc85,_0x15b4e0,_0x47a4f1);else{for(var _0x1486b1=_0x4b72d4[_0xfc800f(0x247)]-0x1;_0x1486b1>=0x0;_0x1486b1--)if(_0x5fcf97=_0x4b72d4[_0x1486b1])_0x202b0b=(_0x629c86<0x3?_0x5fcf97(_0x202b0b):_0x629c86>0x3?_0x5fcf97(_0x2ffc85,_0x15b4e0,_0x202b0b):_0x5fcf97(_0x2ffc85,_0x15b4e0))||_0x202b0b;}return _0x629c86>0x3&&_0x202b0b&&Object[_0xfc800f(0x22b)](_0x2ffc85,_0x15b4e0,_0x202b0b),_0x202b0b;},__metadata=this&&this[a136_0x58c2bd(0x237)]||function(_0x4708b4,_0x1b638e){const _0x3032f3=a136_0x58c2bd;if(typeof Reflect===_0x3032f3(0x222)&&typeof Reflect[_0x3032f3(0x233)]===_0x3032f3(0x242))return Reflect[_0x3032f3(0x233)](_0x4708b4,_0x1b638e);},__param=this&&this[a136_0x58c2bd(0x227)]||function(_0x5b8d0d,_0x1071b3){return function(_0x4eb3fc,_0x44d63f){_0x1071b3(_0x4eb3fc,_0x44d63f,_0x5b8d0d);};},SoundService_1;Object[a136_0x58c2bd(0x22b)](exports,a136_0x58c2bd(0x21e),{'value':!![]}),exports[a136_0x58c2bd(0x1fd)]=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a136_0x58c2bd(0x1ea)),mongoose_2=require(a136_0x58c2bd(0x21c)),path=require('path'),event_emitter_1=require(a136_0x58c2bd(0x20a)),file_1=require(a136_0x58c2bd(0x21b)),agenda_service_1=require(a136_0x58c2bd(0x236)),enums_1=require('../common/enums'),constants_1=require('../common/constants'),utils_1=require(a136_0x58c2bd(0x249)),path_1=require(a136_0x58c2bd(0x1ef)),audio_player_1=require(a136_0x58c2bd(0x201)),sound_1=require('../common/events/sound'),job_1=require('../common/job'),constants_2=require('./constants'),default_sounds_1=require(a136_0x58c2bd(0x210)),sound_gateway_1=require(a136_0x58c2bd(0x23f)),path_2=require(a136_0x58c2bd(0x1d6)),upload_service_1=require(a136_0x58c2bd(0x1de)),text_to_audio_service_1=require(a136_0x58c2bd(0x1dd)),streaming_service_1=require(a136_0x58c2bd(0x22e));let SoundService=SoundService_1=class SoundService{constructor(_0x4d943d,_0x35cdf0,_0x10ff81,_0x5492a7,_0x2b600,_0x52c853){const _0x5e8bb9=a136_0x58c2bd;this[_0x5e8bb9(0x1f4)]=_0x4d943d,this[_0x5e8bb9(0x214)]=_0x35cdf0,this[_0x5e8bb9(0x200)]=_0x10ff81,this['textToAudioService']=_0x5492a7,this[_0x5e8bb9(0x1d1)]=_0x2b600,this[_0x5e8bb9(0x20f)]=_0x52c853,this[_0x5e8bb9(0x1f9)]=new common_1[(_0x5e8bb9(0x1f7))](SoundService_1[_0x5e8bb9(0x1fa)]);}async['create'](_0x2c42ac){const _0x2f75b9=a136_0x58c2bd;await this[_0x2f75b9(0x211)](_0x2c42ac,null);const _0x3bc68a=new this[(_0x2f75b9(0x1f4))](_0x2c42ac);return _0x3bc68a['save']();}async[a136_0x58c2bd(0x1e6)](_0x3ea4e1){const _0x2bf128=a136_0x58c2bd,_0x1cf017=await this[_0x2bf128(0x1f4)][_0x2bf128(0x1f3)]({'type':_0x3ea4e1})[_0x2bf128(0x1f1)]();return _0x1cf017;}async[a136_0x58c2bd(0x23d)](_0x3f177a){const _0x41f628=a136_0x58c2bd,_0x1745f0=await this[_0x41f628(0x1f4)][_0x41f628(0x228)](_0x3f177a);return _0x1745f0;}async['findByIds'](_0x379a00){const _0xa9da4f=a136_0x58c2bd,_0x2d0da1=await this[_0xa9da4f(0x1f4)][_0xa9da4f(0x1f3)]({'_id':{'$in':_0x379a00}});return _0x2d0da1;}async['update'](_0x516234,_0x859dfd){const _0x1ca434=a136_0x58c2bd,_0x545150=await this[_0x1ca434(0x1f4)]['findById'](_0x516234)[_0x1ca434(0x1f1)]();if(!_0x545150)throw new Error(_0x1ca434(0x231));await this[_0x1ca434(0x211)](_0x859dfd,_0x545150===null||_0x545150===void 0x0?void 0x0:_0x545150[_0x1ca434(0x21f)]);const _0x342b51=await this[_0x1ca434(0x1f4)]['findByIdAndUpdate'](_0x516234,Object[_0x1ca434(0x245)](Object['assign']({},_0x859dfd),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x342b51;}async[a136_0x58c2bd(0x244)](_0x145f40,_0x205230){const _0x1aa651=a136_0x58c2bd,_0x462420=await this[_0x1aa651(0x1f4)][_0x1aa651(0x228)](_0x145f40)[_0x1aa651(0x1f1)]();if(!_0x462420)throw new Error(_0x1aa651(0x231));const _0x51e387=await this[_0x1aa651(0x1f4)][_0x1aa651(0x1e2)](_0x145f40,Object[_0x1aa651(0x245)](Object[_0x1aa651(0x245)]({},_0x205230),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x51e387;}async[a136_0x58c2bd(0x23c)](_0x34f475){const _0x2cf9dc=a136_0x58c2bd,_0x3d336c=await this[_0x2cf9dc(0x1f4)]['findByIdAndDelete'](_0x34f475);if(_0x3d336c['fileName']){const _0x543ea6=constants_1[_0x2cf9dc(0x216)]+'/'+_0x3d336c[_0x2cf9dc(0x21f)];try{(0x0,file_1[_0x2cf9dc(0x207)])(_0x543ea6);}catch(_0x2fb7e2){this[_0x2cf9dc(0x1f9)][_0x2cf9dc(0x1d4)](_0x2fb7e2);}}return _0x3d336c;}async[a136_0x58c2bd(0x219)](_0x55964d,_0x5b8b61){const _0x3f22b3=a136_0x58c2bd,_0x50af5d=await this['soundModel'][_0x3f22b3(0x228)](_0x55964d)[_0x3f22b3(0x1f1)](),_0x4fb03a=_0x50af5d===null||_0x50af5d===void 0x0?void 0x0:_0x50af5d[_0x3f22b3(0x21f)],_0x534ae1=this[_0x3f22b3(0x209)](_0x5b8b61[_0x3f22b3(0x220)]),_0x226882=constants_1[_0x3f22b3(0x216)]+'/'+_0x534ae1;await(0x0,file_1[_0x3f22b3(0x225)])(_0x5b8b61[_0x3f22b3(0x1d6)],_0x226882);const _0xd4cd7c={'fileName':_0x534ae1},_0x2ac7c2=await this[_0x3f22b3(0x1f4)]['findByIdAndUpdate'](_0x55964d,Object[_0x3f22b3(0x245)](Object['assign']({},_0xd4cd7c),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0x4fb03a){const _0x39e68e=constants_1['AUDIO_DIR']+'/'+_0x4fb03a;(0x0,file_1[_0x3f22b3(0x207)])(_0x39e68e);}return _0x2ac7c2;}async[a136_0x58c2bd(0x1eb)](_0x35629d){const _0x23b89d=a136_0x58c2bd,{soundId:_0x1506a6,jobId:_0x1038cf,durationInSecond:_0x315196}=_0x35629d,_0x28610d=await this[_0x23b89d(0x23d)](_0x1506a6),_0x17c302=path[_0x23b89d(0x218)](path_1['processRootPath'],_0x23b89d(0x1f2),'audio',_0x28610d[_0x23b89d(0x21f)]);if(!(0x0,file_1[_0x23b89d(0x1e1)])(_0x17c302)){this[_0x23b89d(0x1f9)][_0x23b89d(0x1d4)]('Sound\x20file\x20not\x20found:\x20'+_0x17c302);return;}job_1[_0x23b89d(0x234)][_0x23b89d(0x1dc)](),this[_0x23b89d(0x1f9)]['log'](_0x23b89d(0x215)+_0x1506a6+_0x23b89d(0x20b)+_0x28610d['name']),(0x0,job_1['executeJob'])({'jobId':_0x1038cf,'run':()=>audio_player_1[_0x23b89d(0x22d)]['playAsync'](_0x17c302,_0x28610d[_0x23b89d(0x1d2)]),'next':()=>this[_0x23b89d(0x238)](_0x1506a6),'durationInSecond':_0x315196}),this[_0x23b89d(0x20f)][_0x23b89d(0x1da)]({'id':_0x1506a6,'isPlaying':!![]});}async[a136_0x58c2bd(0x1ee)](_0x1589b7){const _0x1a487=a136_0x58c2bd,{voiceId:_0x1f7da9,jobId:_0x133c80,durationInSecond:_0x21f147}=_0x1589b7,_0x113665=await this[_0x1a487(0x200)][_0x1a487(0x213)](_0x1f7da9),_0x2eb704=_0x113665['filePath'],_0x541a92=(0x0,path_2['join'])(process[_0x1a487(0x1f8)](),_0x2eb704);if(!(0x0,file_1[_0x1a487(0x1e1)])(_0x541a92)){this[_0x1a487(0x1f9)]['error']('Voice\x20file\x20not\x20found:\x20'+_0x541a92);return;}job_1[_0x1a487(0x234)][_0x1a487(0x1dc)](),this[_0x1a487(0x1f9)][_0x1a487(0x1d8)](_0x1a487(0x20d)+_0x1f7da9),(0x0,job_1[_0x1a487(0x229)])({'jobId':_0x133c80,'run':()=>audio_player_1[_0x1a487(0x22d)][_0x1a487(0x1e7)](_0x541a92),'durationInSecond':_0x21f147,'next':()=>null});}async['playTextToAudioRecorded'](_0x24c142){const _0x3e0a98=a136_0x58c2bd,{textToAudioId:_0x20de80,jobId:_0x484724,durationInSecond:_0x44c3f4}=_0x24c142,{message:_0x340bd1}=await this['textToAudioService'][_0x3e0a98(0x248)](_0x20de80);job_1[_0x3e0a98(0x234)][_0x3e0a98(0x1dc)](),(0x0,job_1[_0x3e0a98(0x229)])({'jobId':_0x484724,'run':()=>{const _0x51d9db=_0x3e0a98;let _0x4afa04=null;return this[_0x51d9db(0x208)][_0x51d9db(0x226)](_0x340bd1,_0x32f0fb=>{const _0x3cef36=_0x51d9db;_0x4afa04=this['streamingService'][_0x3cef36(0x1f6)](_0x32f0fb);}),_0x4afa04;},'durationInSecond':_0x44c3f4,'next':()=>null});}async[a136_0x58c2bd(0x205)](_0xabc787,_0x5338f7,_0x274ed9=![]){const _0x395aa7=a136_0x58c2bd,_0x1b3fe2={'when':_0x395aa7(0x224),'jobType':enums_1[_0x395aa7(0x1fe)]['PlaySound'],'attributes':{'soundId':_0x5338f7,'durationInSecond':_0x274ed9?0x15180:undefined},'audit':{'actor':_0xabc787,'name':enums_1[_0x395aa7(0x1fe)]['PlaySound'],'message':_0x395aa7(0x243)+_0x5338f7}},_0x40868d=await this[_0x395aa7(0x1f4)][_0x395aa7(0x23d)]({'jobId':{'$ne':null}});_0x40868d&&await this[_0x395aa7(0x238)](_0x40868d['id']);const {jobId:_0x2b8919}=await this[_0x395aa7(0x214)]['scheduleJob'](_0x1b3fe2);return this[_0x395aa7(0x22f)](_0x5338f7,{'jobId':_0x2b8919});}async[a136_0x58c2bd(0x238)](_0x5778be){const _0x1580e9=a136_0x58c2bd;let _0x5db79c=await this[_0x1580e9(0x23d)](_0x5778be);const {jobId:_0x1c7062}=_0x5db79c||{};if(_0x1c7062){const {success:_0x5aa076}=await this[_0x1580e9(0x214)][_0x1580e9(0x241)](_0x1c7062);_0x5aa076&&(_0x5db79c=await this[_0x1580e9(0x22f)](_0x5778be,{'jobId':null}));}return this['soundGateway'][_0x1580e9(0x1da)]({'id':_0x5db79c['id'],'isPlaying':![]}),_0x5db79c;}async[a136_0x58c2bd(0x1f5)](){const _0x3ef2a9=a136_0x58c2bd,_0x4598d9=await this[_0x3ef2a9(0x1e6)](constants_2['SoundType'][_0x3ef2a9(0x1d3)]);if(_0x4598d9['length']>0x0){const _0x5d663b=[];_0x4598d9[_0x3ef2a9(0x1d9)](_0x29d663=>{const _0x188bac=_0x3ef2a9;_0x5d663b[_0x188bac(0x1e4)](this[_0x188bac(0x23c)](_0x29d663[_0x188bac(0x239)]));}),await Promise[_0x3ef2a9(0x1e9)](_0x5d663b);}await(0x0,file_1[_0x3ef2a9(0x203)])(constants_1['DEFAULT_TUNES_DIR'],constants_1[_0x3ef2a9(0x1ff)]);const _0x534cc2=[];return default_sounds_1[_0x3ef2a9(0x22a)][_0x3ef2a9(0x1d9)](_0x2206c8=>{const _0x4182a5=_0x3ef2a9;_0x534cc2[_0x4182a5(0x1e4)](this[_0x4182a5(0x22c)](Object[_0x4182a5(0x245)]({},_0x2206c8)));}),await Promise[_0x3ef2a9(0x1e9)](_0x534cc2),!![];}['getNewFileName'](_0xa581d6){const _0x4c6308=a136_0x58c2bd,_0x363dcb=_0xa581d6[_0x4c6308(0x1fb)]('.')[_0x4c6308(0x1fc)]();return(0x0,utils_1[_0x4c6308(0x21a)])()+'.'+_0x363dcb;}async['validateAndMoveFileAsync'](_0x22ecac,_0x52ac84){const _0x289cdf=a136_0x58c2bd;if(!_0x22ecac[_0x289cdf(0x21f)])return;const _0x2d0926=constants_1['TMP_UPLOAD_DIR']+'/'+_0x22ecac[_0x289cdf(0x21f)],_0x1cbc0f=_0x52ac84||this[_0x289cdf(0x209)](_0x22ecac[_0x289cdf(0x21f)]),_0x4d00a7=constants_1[_0x289cdf(0x216)]+'/'+_0x1cbc0f;if(!(0x0,file_1[_0x289cdf(0x1e1)])(_0x2d0926))throw new Error('File\x20not\x20found!');!(0x0,file_1['isFileExist'])(constants_1[_0x289cdf(0x216)])&&(0x0,file_1[_0x289cdf(0x24a)])(constants_1[_0x289cdf(0x216)]),await(0x0,file_1['moveFile'])(_0x2d0926,_0x4d00a7),_0x22ecac[_0x289cdf(0x21f)]=_0x1cbc0f;}};function a136_0x3ab2(_0x42f7c7,_0xb83a17){const _0x35a57f=a136_0x35a5();return a136_0x3ab2=function(_0x3ab270,_0x57ff5e){_0x3ab270=_0x3ab270-0x1d0;let _0x49aa6d=_0x35a57f[_0x3ab270];return _0x49aa6d;},a136_0x3ab2(_0x42f7c7,_0xb83a17);}function a136_0x35a5(){const _0x2b6909=['../streaming/streaming.service','update','398IcKLAj','Sound\x20not\x20found!','prototype','metadata','PROCESS_CACHE','design:paramtypes','../agenda/agenda.service','__metadata','stop','_id','AgendaService','playTextToAudioRecorded','delete','findOne','TextToAudioService','./sound.gateway','OnEvent','cancelJob','function','Play\x20sound:\x20','updateVolume','assign','StreamingService','length','getMessageById','../common/utils','createFolder','81qopMUQ','streamingService','volume','Tune','error','SoundEvent','path','Play','log','forEach','broadcastPlaying','5315167uWTBsx','killAll','../text-to-audio/text-to-audio.service','../upload/upload.service','getOwnPropertyDescriptor','UploadService','isFileExist','findByIdAndUpdate','3350634egFosp','push','4QwaeUc','findByType','playAsync','SoundGateway','all','@nestjs/mongoose','playSoundOnEvent','Model','3817abYITN','playVoiceRecorded','../common/path','__decorate','exec','assets','find','soundModel','resetTunes','playStreamAudioAsync','Logger','cwd','logger','name','split','pop','SoundService','JobType','TMP_UPLOAD_DIR','uploadService','../common/audio/audio-player','decorate','copyFiles','design:type','play','959704Gpzisf','deleteFile','textToAudioService','getNewFileName','@nestjs/event-emitter','\x20-\x20','InjectModel','Playing\x20voice\x20recorded:\x20','Sound','soundGateway','./data/default-sounds','validateAndMoveFileAsync','246lmyFtS','findVoiceRecoredById','agendaService','Playing\x20sound:\x20','AUDIO_DIR','design:returntype','join','upload','uuid','../common/file','mongoose','8393960wlLXDi','__esModule','fileName','originalname','2616231ZZMIXp','object','102395xIEdSw','now','moveFile','textToAudio','__param','findById','executeJob','DEFAULT_TUNES','defineProperty','create','AudioPlayer'];a136_0x35a5=function(){return _0x2b6909;};return a136_0x35a5();}__decorate([(0x0,event_emitter_1[a136_0x58c2bd(0x240)])(sound_1[a136_0x58c2bd(0x1d5)][a136_0x58c2bd(0x1d7)]),__metadata(a136_0x58c2bd(0x204),Function),__metadata(a136_0x58c2bd(0x235),[Object]),__metadata(a136_0x58c2bd(0x217),Promise)],SoundService[a136_0x58c2bd(0x232)],a136_0x58c2bd(0x1eb),null),__decorate([(0x0,event_emitter_1[a136_0x58c2bd(0x240)])(sound_1[a136_0x58c2bd(0x1d5)]['VoiceRecorded']),__metadata(a136_0x58c2bd(0x204),Function),__metadata('design:paramtypes',[Object]),__metadata(a136_0x58c2bd(0x217),Promise)],SoundService[a136_0x58c2bd(0x232)],a136_0x58c2bd(0x1ee),null),__decorate([(0x0,event_emitter_1[a136_0x58c2bd(0x240)])(sound_1[a136_0x58c2bd(0x1d5)]['TextToAudio']),__metadata(a136_0x58c2bd(0x204),Function),__metadata(a136_0x58c2bd(0x235),[Object]),__metadata(a136_0x58c2bd(0x217),Promise)],SoundService[a136_0x58c2bd(0x232)],a136_0x58c2bd(0x23b),null),SoundService=SoundService_1=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_1[a136_0x58c2bd(0x20c)])(a136_0x58c2bd(0x20e))),__param(0x5,(0x0,common_1['Inject'])(sound_gateway_1[a136_0x58c2bd(0x1e8)])),__metadata(a136_0x58c2bd(0x235),[mongoose_2[a136_0x58c2bd(0x1ec)],agenda_service_1[a136_0x58c2bd(0x23a)],upload_service_1[a136_0x58c2bd(0x1e0)],text_to_audio_service_1[a136_0x58c2bd(0x23e)],streaming_service_1[a136_0x58c2bd(0x246)],sound_gateway_1[a136_0x58c2bd(0x1e8)]])],SoundService),exports[a136_0x58c2bd(0x1fd)]=SoundService;