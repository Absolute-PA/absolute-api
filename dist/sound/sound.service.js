'use strict';function a133_0x1c46(_0x26c911,_0x2f1bcb){const _0x2b5109=a133_0x2b51();return a133_0x1c46=function(_0x1c4667,_0x38b384){_0x1c4667=_0x1c4667-0x1d1;let _0x26af32=_0x2b5109[_0x1c4667];return _0x26af32;},a133_0x1c46(_0x26c911,_0x2f1bcb);}const a133_0x24e588=a133_0x1c46;(function(_0x487fd4,_0x7bc654){const _0x1b3c90=a133_0x1c46,_0x39b4be=_0x487fd4();while(!![]){try{const _0x34d5b9=-parseInt(_0x1b3c90(0x237))/0x1*(parseInt(_0x1b3c90(0x1fd))/0x2)+-parseInt(_0x1b3c90(0x243))/0x3*(-parseInt(_0x1b3c90(0x1d9))/0x4)+parseInt(_0x1b3c90(0x1e2))/0x5+-parseInt(_0x1b3c90(0x211))/0x6+-parseInt(_0x1b3c90(0x1ec))/0x7*(parseInt(_0x1b3c90(0x1e7))/0x8)+-parseInt(_0x1b3c90(0x1e1))/0x9+parseInt(_0x1b3c90(0x23a))/0xa;if(_0x34d5b9===_0x7bc654)break;else _0x39b4be['push'](_0x39b4be['shift']());}catch(_0x2c0488){_0x39b4be['push'](_0x39b4be['shift']());}}}(a133_0x2b51,0xa083d));function a133_0x2b51(){const _0x17adf7=['assign','exec','DEFAULT_TUNES_DIR','textToAudioService','AgendaService','TextToAudioService','../common/constants','processRootPath','findByType','soundModel','findOne','SoundEvent','playVoiceRecorded','Playing\x20sound:\x20','../agenda/agenda.service','validateAndMoveFileAsync','getNewFileName','play','_id','function','assets','23FjxApi','createFolder','../common/enums','15104520vfBeyg','uuid','./data/default-sounds','broadcastPlaying','SoundGateway','upload','../common/file','./constants','../streaming/streaming.service','140886rdjXDY','split','cancelJob','mongoose','defineProperty','all','playSoundOnEvent','agendaService','../common/events/sound','fileName','executeJob','TMP_UPLOAD_DIR','update','84sxixdH','../common/job','findVoiceRecoredById','prototype','killAll','Tune','../common/audio/audio-player','AUDIO_DIR','10353186aLOJYm','5212585iAeaFM','OnEvent','log','find','../common/path','10760EkJEGz','delete','File\x20not\x20found!','cwd','playStreamAudioAsync','2653hFgvgj','textToAudio','forEach','decorate','PROCESS_CACHE','Play','uploadService','save','create','audio','AudioPlayer','now','UploadService','\x20-\x20','../common/utils','../text-to-audio/text-to-audio.service','name','16870ifsdKB','design:returntype','Model','streamingService','findByIdAndUpdate','deleteFile','InjectModel','design:type','push','@nestjs/common','design:paramtypes','playAsync','Injectable','stop','length','playTextToAudioRecorded','updateVolume','resetTunes','@nestjs/mongoose','__metadata','6165528UETQSl','DEFAULT_TUNES','metadata','../upload/upload.service','findByIdAndDelete','JobType','moveFile','findById','Sound','__decorate','path','__esModule','scheduleJob','object','soundGateway','PlaySound','logger'];a133_0x2b51=function(){return _0x17adf7;};return a133_0x2b51();}var __decorate=this&&this[a133_0x24e588(0x21a)]||function(_0x1bb96c,_0x427744,_0x4a8d4e,_0x2f615d){const _0x12a403=a133_0x24e588;var _0x2cfc9c=arguments['length'],_0x461abe=_0x2cfc9c<0x3?_0x427744:_0x2f615d===null?_0x2f615d=Object['getOwnPropertyDescriptor'](_0x427744,_0x4a8d4e):_0x2f615d,_0x1a4e60;if(typeof Reflect==='object'&&typeof Reflect[_0x12a403(0x1ef)]===_0x12a403(0x235))_0x461abe=Reflect['decorate'](_0x1bb96c,_0x427744,_0x4a8d4e,_0x2f615d);else{for(var _0x52d498=_0x1bb96c[_0x12a403(0x20b)]-0x1;_0x52d498>=0x0;_0x52d498--)if(_0x1a4e60=_0x1bb96c[_0x52d498])_0x461abe=(_0x2cfc9c<0x3?_0x1a4e60(_0x461abe):_0x2cfc9c>0x3?_0x1a4e60(_0x427744,_0x4a8d4e,_0x461abe):_0x1a4e60(_0x427744,_0x4a8d4e))||_0x461abe;}return _0x2cfc9c>0x3&&_0x461abe&&Object[_0x12a403(0x247)](_0x427744,_0x4a8d4e,_0x461abe),_0x461abe;},__metadata=this&&this[a133_0x24e588(0x210)]||function(_0x2ab60c,_0x2d13b9){const _0x5874bc=a133_0x24e588;if(typeof Reflect===_0x5874bc(0x21e)&&typeof Reflect[_0x5874bc(0x213)]==='function')return Reflect[_0x5874bc(0x213)](_0x2ab60c,_0x2d13b9);},__param=this&&this['__param']||function(_0x36d255,_0x1155e8){return function(_0x49f7a3,_0x54c94e){_0x1155e8(_0x49f7a3,_0x54c94e,_0x36d255);};},SoundService_1;Object[a133_0x24e588(0x247)](exports,a133_0x24e588(0x21c),{'value':!![]}),exports['SoundService']=void 0x0;const common_1=require(a133_0x24e588(0x206)),mongoose_1=require(a133_0x24e588(0x20f)),mongoose_2=require(a133_0x24e588(0x246)),path=require(a133_0x24e588(0x21b)),event_emitter_1=require('@nestjs/event-emitter'),file_1=require(a133_0x24e588(0x240)),agenda_service_1=require(a133_0x24e588(0x230)),enums_1=require(a133_0x24e588(0x239)),constants_1=require(a133_0x24e588(0x228)),utils_1=require(a133_0x24e588(0x1fa)),path_1=require(a133_0x24e588(0x1e6)),audio_player_1=require(a133_0x24e588(0x1df)),sound_1=require(a133_0x24e588(0x1d4)),job_1=require(a133_0x24e588(0x1da)),constants_2=require(a133_0x24e588(0x241)),default_sounds_1=require(a133_0x24e588(0x23c)),sound_gateway_1=require('./sound.gateway'),path_2=require('path'),upload_service_1=require(a133_0x24e588(0x214)),text_to_audio_service_1=require(a133_0x24e588(0x1fb)),streaming_service_1=require(a133_0x24e588(0x242));let SoundService=SoundService_1=class SoundService{constructor(_0x198bfd,_0x20249f,_0x5e3d2c,_0x24375f,_0x390194,_0x256017){const _0x331df1=a133_0x24e588;this[_0x331df1(0x22b)]=_0x198bfd,this[_0x331df1(0x1d3)]=_0x20249f,this['uploadService']=_0x5e3d2c,this['textToAudioService']=_0x24375f,this[_0x331df1(0x200)]=_0x390194,this['soundGateway']=_0x256017,this[_0x331df1(0x221)]=new common_1['Logger'](SoundService_1[_0x331df1(0x1fc)]);}async[a133_0x24e588(0x1f4)](_0x407533){const _0x223472=a133_0x24e588;await this[_0x223472(0x231)](_0x407533,null);const _0x119843=new this[(_0x223472(0x22b))](_0x407533);return _0x119843[_0x223472(0x1f3)]();}async['findByType'](_0x93da5d){const _0x4b6211=a133_0x24e588,_0x45de25=await this['soundModel'][_0x4b6211(0x1e5)]({'type':_0x93da5d})['exec']();return _0x45de25;}async['findOne'](_0x41cc77){const _0x5762c5=await this['soundModel']['findById'](_0x41cc77);return _0x5762c5;}async['findByIds'](_0x3b6551){const _0x2bc5f5=a133_0x24e588,_0x3a7bc8=await this[_0x2bc5f5(0x22b)][_0x2bc5f5(0x1e5)]({'_id':{'$in':_0x3b6551}});return _0x3a7bc8;}async[a133_0x24e588(0x1d8)](_0xdf0720,_0x44c28d){const _0x20b22b=a133_0x24e588,_0x29601c=await this[_0x20b22b(0x22b)][_0x20b22b(0x218)](_0xdf0720)['exec']();if(!_0x29601c)throw new Error('Sound\x20not\x20found!');await this[_0x20b22b(0x231)](_0x44c28d,_0x29601c===null||_0x29601c===void 0x0?void 0x0:_0x29601c[_0x20b22b(0x1d5)]);const _0x31eaa1=await this[_0x20b22b(0x22b)][_0x20b22b(0x201)](_0xdf0720,Object[_0x20b22b(0x222)](Object[_0x20b22b(0x222)]({},_0x44c28d),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x31eaa1;}async[a133_0x24e588(0x20d)](_0xd1c451,_0x41da9e){const _0x5bbd0e=a133_0x24e588,_0xa1db0=await this[_0x5bbd0e(0x22b)][_0x5bbd0e(0x218)](_0xd1c451)[_0x5bbd0e(0x223)]();if(!_0xa1db0)throw new Error('Sound\x20not\x20found!');const _0x55aad3=await this[_0x5bbd0e(0x22b)][_0x5bbd0e(0x201)](_0xd1c451,Object[_0x5bbd0e(0x222)](Object[_0x5bbd0e(0x222)]({},_0x41da9e),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x55aad3;}async[a133_0x24e588(0x1e8)](_0x4dd3f3){const _0x210747=a133_0x24e588,_0x3afd09=await this[_0x210747(0x22b)][_0x210747(0x215)](_0x4dd3f3);if(_0x3afd09[_0x210747(0x1d5)]){const _0x56f3e9=constants_1['AUDIO_DIR']+'/'+_0x3afd09[_0x210747(0x1d5)];try{(0x0,file_1[_0x210747(0x202)])(_0x56f3e9);}catch(_0x5eb467){this[_0x210747(0x221)]['error'](_0x5eb467);}}return _0x3afd09;}async[a133_0x24e588(0x23f)](_0x302cf8,_0x3455c6){const _0x3d0632=a133_0x24e588,_0x12400c=await this[_0x3d0632(0x22b)][_0x3d0632(0x218)](_0x302cf8)[_0x3d0632(0x223)](),_0xf6654f=_0x12400c===null||_0x12400c===void 0x0?void 0x0:_0x12400c['fileName'],_0x249bf1=this[_0x3d0632(0x232)](_0x3455c6['originalname']),_0x4f3ff9=constants_1[_0x3d0632(0x1e0)]+'/'+_0x249bf1;await(0x0,file_1['moveFile'])(_0x3455c6[_0x3d0632(0x21b)],_0x4f3ff9);const _0x582192={'fileName':_0x249bf1},_0x29e345=await this[_0x3d0632(0x22b)][_0x3d0632(0x201)](_0x302cf8,Object[_0x3d0632(0x222)](Object[_0x3d0632(0x222)]({},_0x582192),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0xf6654f){const _0x3631e1=constants_1[_0x3d0632(0x1e0)]+'/'+_0xf6654f;(0x0,file_1[_0x3d0632(0x202)])(_0x3631e1);}return _0x29e345;}async['playSoundOnEvent'](_0x4699c9){const _0x3dc4e7=a133_0x24e588,{soundId:_0x197c8e,jobId:_0x2ece6b,durationInSecond:_0x2d5b15}=_0x4699c9,_0x4c0253=await this[_0x3dc4e7(0x22c)](_0x197c8e),_0x1be4dc=path['join'](path_1[_0x3dc4e7(0x229)],_0x3dc4e7(0x236),_0x3dc4e7(0x1f5),_0x4c0253[_0x3dc4e7(0x1d5)]);job_1['PROCESS_CACHE'][_0x3dc4e7(0x1dd)](),this[_0x3dc4e7(0x221)]['log'](_0x3dc4e7(0x22f)+_0x197c8e+_0x3dc4e7(0x1f9)+_0x4c0253[_0x3dc4e7(0x1fc)]),(0x0,job_1['executeJob'])({'jobId':_0x2ece6b,'run':()=>audio_player_1[_0x3dc4e7(0x1f6)]['playAsync'](_0x1be4dc,_0x4c0253['volume']),'next':()=>this[_0x3dc4e7(0x20a)](_0x197c8e),'durationInSecond':_0x2d5b15}),this['soundGateway'][_0x3dc4e7(0x23d)]({'id':_0x197c8e,'isPlaying':!![]});}async[a133_0x24e588(0x22e)](_0x19bdce){const _0x24a185=a133_0x24e588,{voiceId:_0x1e8454,jobId:_0xef11fc,durationInSecond:_0x2951eb}=_0x19bdce,_0x200cee=await this[_0x24a185(0x1f2)][_0x24a185(0x1db)](_0x1e8454),_0x251196=_0x200cee['filePath'],_0x326aa3=(0x0,path_2['join'])(process[_0x24a185(0x1ea)](),_0x251196);job_1[_0x24a185(0x1f0)][_0x24a185(0x1dd)](),this['logger'][_0x24a185(0x1e4)]('Playing\x20voice\x20recorded:\x20'+_0x1e8454),(0x0,job_1[_0x24a185(0x1d6)])({'jobId':_0xef11fc,'run':()=>audio_player_1['AudioPlayer'][_0x24a185(0x208)](_0x326aa3),'durationInSecond':_0x2951eb,'next':()=>null});}async['playTextToAudioRecorded'](_0x2c1802){const _0x434741=a133_0x24e588,{textToAudioId:_0x552a2a,jobId:_0x20db4e,durationInSecond:_0xec9f9a}=_0x2c1802,{message:_0x1fec56}=await this['textToAudioService']['getMessageById'](_0x552a2a);job_1[_0x434741(0x1f0)][_0x434741(0x1dd)](),(0x0,job_1[_0x434741(0x1d6)])({'jobId':_0x20db4e,'run':()=>{const _0x2a21e1=_0x434741;let _0x19e953=null;return this[_0x2a21e1(0x225)][_0x2a21e1(0x1ed)](_0x1fec56,_0xb75e2=>{const _0x482d6f=_0x2a21e1;_0x19e953=this[_0x482d6f(0x200)][_0x482d6f(0x1eb)](_0xb75e2);}),_0x19e953;},'durationInSecond':_0xec9f9a,'next':()=>null});}async[a133_0x24e588(0x233)](_0x48d904,_0x328b13,_0x387d12=![]){const _0x221159=a133_0x24e588,_0x192c72={'when':_0x221159(0x1f7),'jobType':enums_1[_0x221159(0x216)][_0x221159(0x220)],'attributes':{'soundId':_0x328b13,'durationInSecond':_0x387d12?0x15180:undefined},'audit':{'actor':_0x48d904,'name':enums_1[_0x221159(0x216)][_0x221159(0x220)],'message':'Play\x20sound:\x20'+_0x328b13}},_0x7d3512=await this[_0x221159(0x22b)][_0x221159(0x22c)]({'jobId':{'$ne':null}});_0x7d3512&&await this['stop'](_0x7d3512['id']);const {jobId:_0x421e18}=await this[_0x221159(0x1d3)][_0x221159(0x21d)](_0x192c72);return this[_0x221159(0x1d8)](_0x328b13,{'jobId':_0x421e18});}async[a133_0x24e588(0x20a)](_0x451178){const _0x25678e=a133_0x24e588;let _0x3369aa=await this[_0x25678e(0x22c)](_0x451178);const {jobId:_0x5ca211}=_0x3369aa||{};if(_0x5ca211){const {success:_0x3fa269}=await this[_0x25678e(0x1d3)][_0x25678e(0x245)](_0x5ca211);_0x3fa269&&(_0x3369aa=await this[_0x25678e(0x1d8)](_0x451178,{'jobId':null}));}return this[_0x25678e(0x21f)][_0x25678e(0x23d)]({'id':_0x3369aa['id'],'isPlaying':![]}),_0x3369aa;}async[a133_0x24e588(0x20e)](){const _0x41c092=a133_0x24e588,_0x499d4e=await this[_0x41c092(0x22a)](constants_2['SoundType'][_0x41c092(0x1de)]);if(_0x499d4e[_0x41c092(0x20b)]>0x0){const _0x3566d7=[];_0x499d4e[_0x41c092(0x1ee)](_0x328020=>{const _0x1e0c92=_0x41c092;_0x3566d7[_0x1e0c92(0x205)](this[_0x1e0c92(0x1e8)](_0x328020[_0x1e0c92(0x234)]));}),await Promise[_0x41c092(0x1d1)](_0x3566d7);}await(0x0,file_1['copyFiles'])(constants_1[_0x41c092(0x224)],constants_1[_0x41c092(0x1d7)]);const _0x12cea7=[];return default_sounds_1[_0x41c092(0x212)][_0x41c092(0x1ee)](_0x575b8e=>{const _0x358db2=_0x41c092;_0x12cea7[_0x358db2(0x205)](this[_0x358db2(0x1f4)](Object[_0x358db2(0x222)]({},_0x575b8e)));}),await Promise['all'](_0x12cea7),!![];}[a133_0x24e588(0x232)](_0x2d8c21){const _0x15a18a=a133_0x24e588,_0x1345e0=_0x2d8c21[_0x15a18a(0x244)]('.')['pop']();return(0x0,utils_1[_0x15a18a(0x23b)])()+'.'+_0x1345e0;}async['validateAndMoveFileAsync'](_0x16f5e5,_0x2fbf35){const _0x45fc30=a133_0x24e588;if(!_0x16f5e5[_0x45fc30(0x1d5)])return;const _0x4b13f2=constants_1['TMP_UPLOAD_DIR']+'/'+_0x16f5e5['fileName'],_0x281e2f=_0x2fbf35||this[_0x45fc30(0x232)](_0x16f5e5[_0x45fc30(0x1d5)]),_0x40bc99=constants_1[_0x45fc30(0x1e0)]+'/'+_0x281e2f;if(!(0x0,file_1['isFileExist'])(_0x4b13f2))throw new Error(_0x45fc30(0x1e9));!(0x0,file_1['isFileExist'])(constants_1[_0x45fc30(0x1e0)])&&(0x0,file_1[_0x45fc30(0x238)])(constants_1[_0x45fc30(0x1e0)]),await(0x0,file_1[_0x45fc30(0x217)])(_0x4b13f2,_0x40bc99),_0x16f5e5[_0x45fc30(0x1d5)]=_0x281e2f;}};__decorate([(0x0,event_emitter_1['OnEvent'])(sound_1[a133_0x24e588(0x22d)][a133_0x24e588(0x1f1)]),__metadata(a133_0x24e588(0x204),Function),__metadata(a133_0x24e588(0x207),[Object]),__metadata(a133_0x24e588(0x1fe),Promise)],SoundService['prototype'],a133_0x24e588(0x1d2),null),__decorate([(0x0,event_emitter_1[a133_0x24e588(0x1e3)])(sound_1[a133_0x24e588(0x22d)]['VoiceRecorded']),__metadata(a133_0x24e588(0x204),Function),__metadata(a133_0x24e588(0x207),[Object]),__metadata(a133_0x24e588(0x1fe),Promise)],SoundService['prototype'],'playVoiceRecorded',null),__decorate([(0x0,event_emitter_1[a133_0x24e588(0x1e3)])(sound_1[a133_0x24e588(0x22d)]['TextToAudio']),__metadata(a133_0x24e588(0x204),Function),__metadata(a133_0x24e588(0x207),[Object]),__metadata('design:returntype',Promise)],SoundService[a133_0x24e588(0x1dc)],a133_0x24e588(0x20c),null),SoundService=SoundService_1=__decorate([(0x0,common_1[a133_0x24e588(0x209)])(),__param(0x0,(0x0,mongoose_1[a133_0x24e588(0x203)])(a133_0x24e588(0x219))),__param(0x5,(0x0,common_1['Inject'])(sound_gateway_1[a133_0x24e588(0x23e)])),__metadata(a133_0x24e588(0x207),[mongoose_2[a133_0x24e588(0x1ff)],agenda_service_1[a133_0x24e588(0x226)],upload_service_1[a133_0x24e588(0x1f8)],text_to_audio_service_1[a133_0x24e588(0x227)],streaming_service_1['StreamingService'],sound_gateway_1['SoundGateway']])],SoundService),exports['SoundService']=SoundService;