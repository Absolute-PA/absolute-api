'use strict';const a136_0x54015a=a136_0x31d5;(function(_0xb5e2bb,_0xc33e40){const _0x562027=a136_0x31d5,_0x1def2a=_0xb5e2bb();while(!![]){try{const _0x20f41e=parseInt(_0x562027(0x1a5))/0x1+-parseInt(_0x562027(0x151))/0x2*(-parseInt(_0x562027(0x1af))/0x3)+-parseInt(_0x562027(0x1bb))/0x4*(-parseInt(_0x562027(0x1bf))/0x5)+parseInt(_0x562027(0x181))/0x6+-parseInt(_0x562027(0x19f))/0x7*(parseInt(_0x562027(0x188))/0x8)+-parseInt(_0x562027(0x178))/0x9+parseInt(_0x562027(0x1b3))/0xa*(-parseInt(_0x562027(0x16e))/0xb);if(_0x20f41e===_0xc33e40)break;else _0x1def2a['push'](_0x1def2a['shift']());}catch(_0x37a69c){_0x1def2a['push'](_0x1def2a['shift']());}}}(a136_0x2ee4,0xaeb7c));var __decorate=this&&this['__decorate']||function(_0x2dd033,_0xc18686,_0x3ffdef,_0x4d8dab){const _0x2154ce=a136_0x31d5;var _0x1e2066=arguments[_0x2154ce(0x1c5)],_0x2d5cba=_0x1e2066<0x3?_0xc18686:_0x4d8dab===null?_0x4d8dab=Object[_0x2154ce(0x1c3)](_0xc18686,_0x3ffdef):_0x4d8dab,_0x3ba34b;if(typeof Reflect==='object'&&typeof Reflect[_0x2154ce(0x189)]===_0x2154ce(0x1b6))_0x2d5cba=Reflect[_0x2154ce(0x189)](_0x2dd033,_0xc18686,_0x3ffdef,_0x4d8dab);else{for(var _0x44921f=_0x2dd033['length']-0x1;_0x44921f>=0x0;_0x44921f--)if(_0x3ba34b=_0x2dd033[_0x44921f])_0x2d5cba=(_0x1e2066<0x3?_0x3ba34b(_0x2d5cba):_0x1e2066>0x3?_0x3ba34b(_0xc18686,_0x3ffdef,_0x2d5cba):_0x3ba34b(_0xc18686,_0x3ffdef))||_0x2d5cba;}return _0x1e2066>0x3&&_0x2d5cba&&Object['defineProperty'](_0xc18686,_0x3ffdef,_0x2d5cba),_0x2d5cba;},__metadata=this&&this[a136_0x54015a(0x1b1)]||function(_0x4ed27a,_0x456f5d){const _0x13d413=a136_0x54015a;if(typeof Reflect===_0x13d413(0x1a6)&&typeof Reflect['metadata']==='function')return Reflect['metadata'](_0x4ed27a,_0x456f5d);},__param=this&&this[a136_0x54015a(0x163)]||function(_0x27d2a9,_0x4dd46f){return function(_0xbd3482,_0x2934ed){_0x4dd46f(_0xbd3482,_0x2934ed,_0x27d2a9);};},SoundService_1;Object[a136_0x54015a(0x1c1)](exports,a136_0x54015a(0x1b5),{'value':!![]}),exports[a136_0x54015a(0x18e)]=void 0x0;const common_1=require(a136_0x54015a(0x1a7)),mongoose_1=require(a136_0x54015a(0x19a)),mongoose_2=require(a136_0x54015a(0x18b)),path=require(a136_0x54015a(0x159)),event_emitter_1=require('@nestjs/event-emitter'),file_1=require(a136_0x54015a(0x18f)),agenda_service_1=require(a136_0x54015a(0x1d0)),enums_1=require(a136_0x54015a(0x18d)),constants_1=require(a136_0x54015a(0x1a1)),utils_1=require(a136_0x54015a(0x154)),path_1=require('../common/path'),audio_player_1=require(a136_0x54015a(0x17c)),sound_1=require(a136_0x54015a(0x187)),job_1=require(a136_0x54015a(0x18a)),constants_2=require(a136_0x54015a(0x191)),default_sounds_1=require(a136_0x54015a(0x16b)),sound_gateway_1=require(a136_0x54015a(0x1a8)),path_2=require(a136_0x54015a(0x159)),upload_service_1=require(a136_0x54015a(0x1ce)),text_to_audio_service_1=require('../text-to-audio/text-to-audio.service'),streaming_service_1=require(a136_0x54015a(0x1c6));let SoundService=SoundService_1=class SoundService{constructor(_0x383c99,_0x3a2168,_0x417c27,_0x1d24d1,_0x4b810f,_0x1b9fa2){const _0x524df1=a136_0x54015a;this[_0x524df1(0x1ca)]=_0x383c99,this['agendaService']=_0x3a2168,this[_0x524df1(0x15b)]=_0x417c27,this['textToAudioService']=_0x1d24d1,this['streamingService']=_0x4b810f,this[_0x524df1(0x177)]=_0x1b9fa2,this['logger']=new common_1[(_0x524df1(0x176))](SoundService_1[_0x524df1(0x1aa)]);}async[a136_0x54015a(0x15a)](_0x2f46df){const _0x35bad7=a136_0x54015a;await this[_0x35bad7(0x19e)](_0x2f46df,null);const _0xeb6c20=new this[(_0x35bad7(0x1ca))](_0x2f46df);return _0xeb6c20['save']();}async[a136_0x54015a(0x15e)](_0x25e153){const _0x466d63=a136_0x54015a,_0x462b01=await this[_0x466d63(0x1ca)][_0x466d63(0x174)]({'type':_0x25e153})[_0x466d63(0x1c9)]();return _0x462b01;}async['findOne'](_0x294241){const _0x3f04eb=a136_0x54015a,_0x41f1b9=await this['soundModel'][_0x3f04eb(0x170)](_0x294241);return _0x41f1b9;}async[a136_0x54015a(0x1b0)](_0x4ab66a){const _0x117718=a136_0x54015a,_0x596ae4=await this[_0x117718(0x1ca)][_0x117718(0x174)]({'_id':{'$in':_0x4ab66a}});return _0x596ae4;}async[a136_0x54015a(0x1b2)](_0x230588,_0x3ea766){const _0x24451d=a136_0x54015a,_0x444dbe=await this[_0x24451d(0x1ca)][_0x24451d(0x170)](_0x230588)[_0x24451d(0x1c9)]();if(!_0x444dbe)throw new Error(_0x24451d(0x1a9));await this['validateAndMoveFileAsync'](_0x3ea766,_0x444dbe===null||_0x444dbe===void 0x0?void 0x0:_0x444dbe['fileName']);const _0x5b35b3=await this[_0x24451d(0x1ca)]['findByIdAndUpdate'](_0x230588,Object['assign'](Object[_0x24451d(0x15f)]({},_0x3ea766),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x5b35b3;}async[a136_0x54015a(0x184)](_0x224fed,_0x59334d){const _0x351560=a136_0x54015a,_0x27bc89=await this['soundModel'][_0x351560(0x170)](_0x224fed)['exec']();if(!_0x27bc89)throw new Error(_0x351560(0x1a9));const _0x47912c=await this[_0x351560(0x1ca)][_0x351560(0x1ad)](_0x224fed,Object[_0x351560(0x15f)](Object[_0x351560(0x15f)]({},_0x59334d),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x47912c;}async[a136_0x54015a(0x17e)](_0x27beee){const _0x4b4ef0=a136_0x54015a,_0x47ed12=await this[_0x4b4ef0(0x1ca)]['findByIdAndDelete'](_0x27beee);if(_0x47ed12['fileName']){const _0x3ed4d2=constants_1[_0x4b4ef0(0x192)]+'/'+_0x47ed12[_0x4b4ef0(0x19c)];try{(0x0,file_1[_0x4b4ef0(0x165)])(_0x3ed4d2);}catch(_0x58aa2d){this[_0x4b4ef0(0x1ab)][_0x4b4ef0(0x193)](_0x58aa2d);}}return _0x47ed12;}async[a136_0x54015a(0x1bd)](_0x1ad145,_0x410613){const _0x3354ec=a136_0x54015a,_0x44fecf=await this['soundModel'][_0x3354ec(0x170)](_0x1ad145)[_0x3354ec(0x1c9)](),_0xcae128=_0x44fecf===null||_0x44fecf===void 0x0?void 0x0:_0x44fecf[_0x3354ec(0x19c)],_0x233bad=this[_0x3354ec(0x1c8)](_0x410613[_0x3354ec(0x158)]),_0x32caea=constants_1[_0x3354ec(0x192)]+'/'+_0x233bad;await(0x0,file_1[_0x3354ec(0x179)])(_0x410613['path'],_0x32caea);const _0x1d81c0={'fileName':_0x233bad},_0x46cbe2=await this[_0x3354ec(0x1ca)]['findByIdAndUpdate'](_0x1ad145,Object[_0x3354ec(0x15f)](Object['assign']({},_0x1d81c0),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0xcae128){const _0xf98a16=constants_1[_0x3354ec(0x192)]+'/'+_0xcae128;(0x0,file_1[_0x3354ec(0x165)])(_0xf98a16);}return _0x46cbe2;}async[a136_0x54015a(0x199)](_0x3f34cf){const _0x35da0e=a136_0x54015a,{soundId:_0x3015a4,jobId:_0x35d49f,durationInSecond:_0x149793}=_0x3f34cf,_0x35a589=await this['findOne'](_0x3015a4),_0x324044=path[_0x35da0e(0x1ac)](path_1['processRootPath'],_0x35da0e(0x180),_0x35da0e(0x1cb),_0x35a589['fileName']);if(!(0x0,file_1[_0x35da0e(0x169)])(_0x324044)){this['logger'][_0x35da0e(0x193)](_0x35da0e(0x182)+_0x324044);return;}job_1[_0x35da0e(0x1be)][_0x35da0e(0x19b)](),this[_0x35da0e(0x1ab)][_0x35da0e(0x185)](_0x35da0e(0x164)+_0x3015a4+_0x35da0e(0x1c0)+_0x35a589['name']),(0x0,job_1[_0x35da0e(0x15c)])({'jobId':_0x35d49f,'run':()=>audio_player_1[_0x35da0e(0x1b8)][_0x35da0e(0x15d)](_0x324044,_0x35a589[_0x35da0e(0x19d)]),'next':()=>this[_0x35da0e(0x1b4)](_0x3015a4),'durationInSecond':_0x149793}),this[_0x35da0e(0x177)][_0x35da0e(0x1d1)]({'id':_0x3015a4,'isPlaying':!![]});}async[a136_0x54015a(0x1cd)](_0x883858){const _0x42647d=a136_0x54015a,{voiceId:_0x25bf18,jobId:_0x5b8b7c,durationInSecond:_0x1dacd5}=_0x883858,_0x5d57eb=await this[_0x42647d(0x15b)]['findVoiceRecoredById'](_0x25bf18),_0x234c88=_0x5d57eb['filePath'],_0x48ff83=(0x0,path_2[_0x42647d(0x1ac)])(process[_0x42647d(0x152)](),_0x234c88);if(!(0x0,file_1[_0x42647d(0x169)])(_0x48ff83)){this['logger'][_0x42647d(0x193)]('Voice\x20file\x20not\x20found:\x20'+_0x48ff83);return;}job_1['PROCESS_CACHE'][_0x42647d(0x19b)](),this[_0x42647d(0x1ab)][_0x42647d(0x185)](_0x42647d(0x1cc)+_0x25bf18),(0x0,job_1['executeJob'])({'jobId':_0x5b8b7c,'run':()=>audio_player_1[_0x42647d(0x1b8)][_0x42647d(0x15d)](_0x48ff83),'durationInSecond':_0x1dacd5,'next':()=>null});}async[a136_0x54015a(0x162)](_0x32414e){const _0x1899ab=a136_0x54015a,{textToAudioId:_0x346ac5,jobId:_0x89a36e,durationInSecond:_0x30a44f}=_0x32414e,{message:_0x50b4a9}=await this[_0x1899ab(0x1a4)][_0x1899ab(0x16f)](_0x346ac5);job_1[_0x1899ab(0x1be)][_0x1899ab(0x19b)](),(0x0,job_1['executeJob'])({'jobId':_0x89a36e,'run':()=>{const _0x2925c5=_0x1899ab;let _0x160493=null;return this[_0x2925c5(0x1a4)]['textToAudio'](_0x50b4a9,_0x1eb02a=>{const _0x52523c=_0x2925c5;_0x160493=this[_0x52523c(0x1b7)][_0x52523c(0x166)](_0x1eb02a);}),_0x160493;},'durationInSecond':_0x30a44f,'next':()=>null});}async['play'](_0x1964e8,_0x2ca908,_0x2a9f53=![]){const _0x5daf67=a136_0x54015a,_0x3fb851={'when':'now','jobType':enums_1[_0x5daf67(0x198)]['PlaySound'],'attributes':{'soundId':_0x2ca908,'durationInSecond':_0x2a9f53?0x15180:undefined},'audit':{'actor':_0x1964e8,'name':enums_1[_0x5daf67(0x198)][_0x5daf67(0x196)],'message':'Play\x20sound:\x20'+_0x2ca908}},_0x3e24e9=await this[_0x5daf67(0x1ca)][_0x5daf67(0x1ae)]({'jobId':{'$ne':null}});_0x3e24e9&&await this[_0x5daf67(0x1b4)](_0x3e24e9['id']);const {jobId:_0x107792}=await this['agendaService'][_0x5daf67(0x171)](_0x3fb851);return this[_0x5daf67(0x1b2)](_0x2ca908,{'jobId':_0x107792});}async[a136_0x54015a(0x1b4)](_0x40e121){const _0x334959=a136_0x54015a;let _0xe4217c=await this['findOne'](_0x40e121);const {jobId:_0x177590}=_0xe4217c||{};if(_0x177590){const {success:_0x1cf6cc}=await this[_0x334959(0x1cf)][_0x334959(0x1bc)](_0x177590);_0x1cf6cc&&(_0xe4217c=await this[_0x334959(0x1b2)](_0x40e121,{'jobId':null}));}return this['soundGateway'][_0x334959(0x1d1)]({'id':_0xe4217c['id'],'isPlaying':![]}),_0xe4217c;}async[a136_0x54015a(0x18c)](){const _0x12b352=a136_0x54015a,_0x41e3d0=await this['findByType'](constants_2[_0x12b352(0x172)][_0x12b352(0x16a)]);if(_0x41e3d0['length']>0x0){const _0x428607=[];_0x41e3d0['forEach'](_0x5128a2=>{const _0x5e0cc1=_0x12b352;_0x428607[_0x5e0cc1(0x16d)](this[_0x5e0cc1(0x17e)](_0x5128a2[_0x5e0cc1(0x183)]));}),await Promise['all'](_0x428607);}await(0x0,file_1[_0x12b352(0x1a3)])(constants_1[_0x12b352(0x195)],constants_1[_0x12b352(0x1a2)]);const _0xee75ee=[];return default_sounds_1['DEFAULT_TUNES'][_0x12b352(0x17f)](_0x2541ba=>{const _0x3278c2=_0x12b352;_0xee75ee['push'](this[_0x3278c2(0x15a)](Object['assign']({},_0x2541ba)));}),await Promise[_0x12b352(0x168)](_0xee75ee),!![];}[a136_0x54015a(0x1c8)](_0xbdafc8){const _0x10b3d2=a136_0x54015a,_0x20a501=_0xbdafc8[_0x10b3d2(0x173)]('.')[_0x10b3d2(0x1c7)]();return(0x0,utils_1[_0x10b3d2(0x190)])()+'.'+_0x20a501;}async[a136_0x54015a(0x19e)](_0x59d9b2,_0x2a78b2){const _0x139f35=a136_0x54015a;if(!_0x59d9b2[_0x139f35(0x19c)])return;const _0x24eb6d=constants_1[_0x139f35(0x1a2)]+'/'+_0x59d9b2[_0x139f35(0x19c)],_0x13e1c3=_0x2a78b2||this[_0x139f35(0x1c8)](_0x59d9b2[_0x139f35(0x19c)]),_0x2aca6a=constants_1[_0x139f35(0x192)]+'/'+_0x13e1c3;if(!(0x0,file_1['isFileExist'])(_0x24eb6d))throw new Error(_0x139f35(0x167));!(0x0,file_1[_0x139f35(0x169)])(constants_1[_0x139f35(0x192)])&&(0x0,file_1[_0x139f35(0x157)])(constants_1[_0x139f35(0x192)]),await(0x0,file_1['moveFile'])(_0x24eb6d,_0x2aca6a),_0x59d9b2[_0x139f35(0x19c)]=_0x13e1c3;}};function a136_0x2ee4(){const _0x3cfbae=['./constants','AUDIO_DIR','error','TextToAudioService','DEFAULT_TUNES_DIR','PlaySound','Model','JobType','playSoundOnEvent','@nestjs/mongoose','killAll','fileName','volume','validateAndMoveFileAsync','7EHSOHz','OnEvent','../common/constants','TMP_UPLOAD_DIR','copyFiles','textToAudioService','1400860CrHgEd','object','@nestjs/common','./sound.gateway','Sound\x20not\x20found!','name','logger','join','findByIdAndUpdate','findOne','20544JYaLoa','findByIds','__metadata','update','1282330iffsCD','stop','__esModule','function','streamingService','AudioPlayer','prototype','design:returntype','461456RvMKAG','cancelJob','upload','PROCESS_CACHE','40Jannzl','\x20-\x20','defineProperty','SoundEvent','getOwnPropertyDescriptor','SoundGateway','length','../streaming/streaming.service','pop','getNewFileName','exec','soundModel','audio','Playing\x20voice\x20recorded:\x20','playVoiceRecorded','../upload/upload.service','agendaService','../agenda/agenda.service','broadcastPlaying','404ZqdDYz','cwd','VoiceRecorded','../common/utils','design:paramtypes','Inject','createFolder','originalname','path','create','uploadService','executeJob','playAsync','findByType','assign','StreamingService','AgendaService','playTextToAudioRecorded','__param','Playing\x20sound:\x20','deleteFile','playStreamAudioAsync','File\x20not\x20found!','all','isFileExist','Tune','./data/default-sounds','Injectable','push','209znrOeq','getMessageById','findById','scheduleJob','SoundType','split','find','Sound','Logger','soundGateway','4230270bYXrBf','moveFile','Play','InjectModel','../common/audio/audio-player','design:type','delete','forEach','assets','4779366lnudYf','Sound\x20file\x20not\x20found:\x20','_id','updateVolume','log','UploadService','../common/events/sound','7052224iwTczZ','decorate','../common/job','mongoose','resetTunes','../common/enums','SoundService','../common/file','uuid'];a136_0x2ee4=function(){return _0x3cfbae;};return a136_0x2ee4();}function a136_0x31d5(_0x3c0da8,_0xfb63b6){const _0x2ee4d9=a136_0x2ee4();return a136_0x31d5=function(_0x31d5f8,_0x2aa95c){_0x31d5f8=_0x31d5f8-0x151;let _0x4a1bd0=_0x2ee4d9[_0x31d5f8];return _0x4a1bd0;},a136_0x31d5(_0x3c0da8,_0xfb63b6);}__decorate([(0x0,event_emitter_1[a136_0x54015a(0x1a0)])(sound_1[a136_0x54015a(0x1c2)][a136_0x54015a(0x17a)]),__metadata('design:type',Function),__metadata(a136_0x54015a(0x155),[Object]),__metadata(a136_0x54015a(0x1ba),Promise)],SoundService[a136_0x54015a(0x1b9)],a136_0x54015a(0x199),null),__decorate([(0x0,event_emitter_1[a136_0x54015a(0x1a0)])(sound_1['SoundEvent'][a136_0x54015a(0x153)]),__metadata(a136_0x54015a(0x17d),Function),__metadata(a136_0x54015a(0x155),[Object]),__metadata(a136_0x54015a(0x1ba),Promise)],SoundService[a136_0x54015a(0x1b9)],'playVoiceRecorded',null),__decorate([(0x0,event_emitter_1[a136_0x54015a(0x1a0)])(sound_1[a136_0x54015a(0x1c2)]['TextToAudio']),__metadata('design:type',Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],SoundService['prototype'],a136_0x54015a(0x162),null),SoundService=SoundService_1=__decorate([(0x0,common_1[a136_0x54015a(0x16c)])(),__param(0x0,(0x0,mongoose_1[a136_0x54015a(0x17b)])(a136_0x54015a(0x175))),__param(0x5,(0x0,common_1[a136_0x54015a(0x156)])(sound_gateway_1[a136_0x54015a(0x1c4)])),__metadata(a136_0x54015a(0x155),[mongoose_2[a136_0x54015a(0x197)],agenda_service_1[a136_0x54015a(0x161)],upload_service_1[a136_0x54015a(0x186)],text_to_audio_service_1[a136_0x54015a(0x194)],streaming_service_1[a136_0x54015a(0x160)],sound_gateway_1['SoundGateway']])],SoundService),exports[a136_0x54015a(0x18e)]=SoundService;