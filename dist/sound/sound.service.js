'use strict';const a133_0x5284c7=a133_0x1528;(function(_0x4591aa,_0x46bcd1){const _0x4b21d7=a133_0x1528,_0x3bdea3=_0x4591aa();while(!![]){try{const _0xa677e3=-parseInt(_0x4b21d7(0x17c))/0x1*(parseInt(_0x4b21d7(0x1aa))/0x2)+-parseInt(_0x4b21d7(0x1a3))/0x3+-parseInt(_0x4b21d7(0x1a4))/0x4*(parseInt(_0x4b21d7(0x160))/0x5)+-parseInt(_0x4b21d7(0x15a))/0x6+parseInt(_0x4b21d7(0x15e))/0x7+parseInt(_0x4b21d7(0x196))/0x8+parseInt(_0x4b21d7(0x1a6))/0x9*(parseInt(_0x4b21d7(0x158))/0xa);if(_0xa677e3===_0x46bcd1)break;else _0x3bdea3['push'](_0x3bdea3['shift']());}catch(_0x47bf38){_0x3bdea3['push'](_0x3bdea3['shift']());}}}(a133_0x5330,0xc4cf8));function a133_0x1528(_0x33d6df,_0xb62eb8){const _0x5330f6=a133_0x5330();return a133_0x1528=function(_0x152899,_0x2ca92a){_0x152899=_0x152899-0x13f;let _0x7c8664=_0x5330f6[_0x152899];return _0x7c8664;},a133_0x1528(_0x33d6df,_0xb62eb8);}var __decorate=this&&this[a133_0x5284c7(0x14e)]||function(_0x5de9c7,_0x571ea6,_0x2493a8,_0x390b1f){const _0x389431=a133_0x5284c7;var _0x56433b=arguments[_0x389431(0x172)],_0x583f99=_0x56433b<0x3?_0x571ea6:_0x390b1f===null?_0x390b1f=Object[_0x389431(0x179)](_0x571ea6,_0x2493a8):_0x390b1f,_0x11d873;if(typeof Reflect===_0x389431(0x15d)&&typeof Reflect[_0x389431(0x1a2)]==='function')_0x583f99=Reflect[_0x389431(0x1a2)](_0x5de9c7,_0x571ea6,_0x2493a8,_0x390b1f);else{for(var _0x5dd9ef=_0x5de9c7[_0x389431(0x172)]-0x1;_0x5dd9ef>=0x0;_0x5dd9ef--)if(_0x11d873=_0x5de9c7[_0x5dd9ef])_0x583f99=(_0x56433b<0x3?_0x11d873(_0x583f99):_0x56433b>0x3?_0x11d873(_0x571ea6,_0x2493a8,_0x583f99):_0x11d873(_0x571ea6,_0x2493a8))||_0x583f99;}return _0x56433b>0x3&&_0x583f99&&Object[_0x389431(0x18b)](_0x571ea6,_0x2493a8,_0x583f99),_0x583f99;},__metadata=this&&this['__metadata']||function(_0x966fa0,_0x329921){const _0x3e5bcc=a133_0x5284c7;if(typeof Reflect===_0x3e5bcc(0x15d)&&typeof Reflect['metadata']==='function')return Reflect[_0x3e5bcc(0x148)](_0x966fa0,_0x329921);},__param=this&&this['__param']||function(_0x438ddd,_0x125a38){return function(_0x1b89bf,_0x41544d){_0x125a38(_0x1b89bf,_0x41544d,_0x438ddd);};},SoundService_1;Object[a133_0x5284c7(0x18b)](exports,a133_0x5284c7(0x157),{'value':!![]}),exports[a133_0x5284c7(0x170)]=void 0x0;const common_1=require(a133_0x5284c7(0x15b)),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require(a133_0x5284c7(0x143)),path=require('path'),event_emitter_1=require('@nestjs/event-emitter'),file_1=require('../common/file'),agenda_service_1=require(a133_0x5284c7(0x1ab)),enums_1=require(a133_0x5284c7(0x195)),constants_1=require(a133_0x5284c7(0x197)),utils_1=require('../common/utils'),path_1=require('../common/path'),audio_player_1=require(a133_0x5284c7(0x175)),sound_1=require(a133_0x5284c7(0x16d)),job_1=require(a133_0x5284c7(0x180)),constants_2=require(a133_0x5284c7(0x192)),default_sounds_1=require('./data/default-sounds'),sound_gateway_1=require(a133_0x5284c7(0x19a)),path_2=require(a133_0x5284c7(0x145)),upload_service_1=require('../upload/upload.service'),text_to_audio_service_1=require(a133_0x5284c7(0x14a)),streaming_service_1=require(a133_0x5284c7(0x153));let SoundService=SoundService_1=class SoundService{constructor(_0x61aa22,_0x33a03a,_0x59f884,_0x426ed6,_0xe7623e,_0x31ec2c){const _0xc28b2a=a133_0x5284c7;this[_0xc28b2a(0x1a5)]=_0x61aa22,this[_0xc28b2a(0x17a)]=_0x33a03a,this[_0xc28b2a(0x169)]=_0x59f884,this[_0xc28b2a(0x159)]=_0x426ed6,this['streamingService']=_0xe7623e,this[_0xc28b2a(0x177)]=_0x31ec2c,this[_0xc28b2a(0x193)]=new common_1[(_0xc28b2a(0x18a))](SoundService_1['name']);}async[a133_0x5284c7(0x17f)](_0x448e09){const _0x240270=a133_0x5284c7;await this[_0x240270(0x185)](_0x448e09,null);const _0x5a27d5=new this[(_0x240270(0x1a5))](_0x448e09);return _0x5a27d5[_0x240270(0x17b)]();}async[a133_0x5284c7(0x1a0)](_0x2273c4){const _0x500de9=a133_0x5284c7,_0x3888dc=await this['soundModel'][_0x500de9(0x19c)]({'type':_0x2273c4})['exec']();return _0x3888dc;}async[a133_0x5284c7(0x1a1)](_0x1ac6e0){const _0x353782=a133_0x5284c7,_0x30dd5d=await this[_0x353782(0x1a5)]['findById'](_0x1ac6e0);return _0x30dd5d;}async[a133_0x5284c7(0x146)](_0x23b8cc){const _0x56dd31=a133_0x5284c7,_0x711ed3=await this['soundModel'][_0x56dd31(0x19c)]({'_id':{'$in':_0x23b8cc}});return _0x711ed3;}async[a133_0x5284c7(0x14f)](_0x7eb9b6,_0x28f17a){const _0xd76d5f=a133_0x5284c7,_0x3adef4=await this[_0xd76d5f(0x1a5)][_0xd76d5f(0x166)](_0x7eb9b6)['exec']();if(!_0x3adef4)throw new Error(_0xd76d5f(0x167));await this[_0xd76d5f(0x185)](_0x28f17a,_0x3adef4===null||_0x3adef4===void 0x0?void 0x0:_0x3adef4[_0xd76d5f(0x15f)]);const _0x2c18a8=await this[_0xd76d5f(0x1a5)]['findByIdAndUpdate'](_0x7eb9b6,Object[_0xd76d5f(0x171)](Object[_0xd76d5f(0x171)]({},_0x28f17a),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x2c18a8;}async['updateVolume'](_0x4f851f,_0x150e40){const _0x418660=a133_0x5284c7,_0x18c43a=await this[_0x418660(0x1a5)][_0x418660(0x166)](_0x4f851f)[_0x418660(0x186)]();if(!_0x18c43a)throw new Error(_0x418660(0x167));const _0x715455=await this[_0x418660(0x1a5)]['findByIdAndUpdate'](_0x4f851f,Object[_0x418660(0x171)](Object[_0x418660(0x171)]({},_0x150e40),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x715455;}async['delete'](_0x269b3b){const _0x10f736=a133_0x5284c7,_0x3a2939=await this[_0x10f736(0x1a5)]['findByIdAndDelete'](_0x269b3b);if(_0x3a2939[_0x10f736(0x15f)]){const _0x587793=constants_1['AUDIO_DIR']+'/'+_0x3a2939['fileName'];try{(0x0,file_1[_0x10f736(0x13f)])(_0x587793);}catch(_0x21e0cb){this[_0x10f736(0x193)][_0x10f736(0x149)](_0x21e0cb);}}return _0x3a2939;}async[a133_0x5284c7(0x168)](_0x48c248,_0x534abb){const _0x303836=a133_0x5284c7,_0x68c1ff=await this[_0x303836(0x1a5)][_0x303836(0x166)](_0x48c248)[_0x303836(0x186)](),_0x5dc71e=_0x68c1ff===null||_0x68c1ff===void 0x0?void 0x0:_0x68c1ff[_0x303836(0x15f)],_0x3cfee5=this[_0x303836(0x152)](_0x534abb[_0x303836(0x165)]),_0xb8c723=constants_1[_0x303836(0x174)]+'/'+_0x3cfee5;await(0x0,file_1[_0x303836(0x176)])(_0x534abb[_0x303836(0x145)],_0xb8c723);const _0x4a7ea8={'fileName':_0x3cfee5},_0x3bb186=await this['soundModel'][_0x303836(0x18d)](_0x48c248,Object[_0x303836(0x171)](Object[_0x303836(0x171)]({},_0x4a7ea8),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0x5dc71e){const _0x526008=constants_1[_0x303836(0x174)]+'/'+_0x5dc71e;(0x0,file_1[_0x303836(0x13f)])(_0x526008);}return _0x3bb186;}async[a133_0x5284c7(0x1b0)](_0x5a127a){const _0x5d8b60=a133_0x5284c7,{soundId:_0x3ca0be,jobId:_0x3aaf86,durationInSecond:_0x4c595}=_0x5a127a,_0x52dea3=await this[_0x5d8b60(0x1a1)](_0x3ca0be),_0x430237=path['join'](path_1['processRootPath'],_0x5d8b60(0x144),_0x5d8b60(0x16e),_0x52dea3['fileName']);job_1[_0x5d8b60(0x189)][_0x5d8b60(0x162)](),this[_0x5d8b60(0x193)][_0x5d8b60(0x19b)](_0x5d8b60(0x19d)+_0x3ca0be+'\x20-\x20'+_0x52dea3[_0x5d8b60(0x15c)]),(0x0,job_1[_0x5d8b60(0x184)])({'jobId':_0x3aaf86,'run':()=>audio_player_1['AudioPlayer'][_0x5d8b60(0x1a8)](_0x430237,_0x52dea3['volume']),'next':()=>this[_0x5d8b60(0x1af)](_0x3ca0be),'durationInSecond':_0x4c595}),this[_0x5d8b60(0x177)]['broadcastPlaying']({'id':_0x3ca0be,'isPlaying':!![]});}async[a133_0x5284c7(0x16f)](_0x474a38){const _0x1e9bdd=a133_0x5284c7,{voiceId:_0xe065b9,jobId:_0x49c5e7,durationInSecond:_0x5d4f82}=_0x474a38,_0x5948d6=await this[_0x1e9bdd(0x169)][_0x1e9bdd(0x181)](_0xe065b9),_0x47a866=_0x5948d6[_0x1e9bdd(0x14b)],_0x4d2e60=(0x0,path_2['join'])(process['cwd'](),_0x47a866);job_1[_0x1e9bdd(0x189)][_0x1e9bdd(0x162)](),this[_0x1e9bdd(0x193)]['log'](_0x1e9bdd(0x1ad)+_0xe065b9),(0x0,job_1[_0x1e9bdd(0x184)])({'jobId':_0x49c5e7,'run':()=>audio_player_1['AudioPlayer']['playAsync'](_0x4d2e60),'durationInSecond':_0x5d4f82,'next':()=>null});}async['playTextToAudioRecorded'](_0x432e09){const _0x36e52f=a133_0x5284c7,{textToAudioId:_0x408937,jobId:_0xd7638,durationInSecond:_0x5146fc}=_0x432e09,{message:_0x2ba3d1}=await this[_0x36e52f(0x159)]['getMessageById'](_0x408937);job_1[_0x36e52f(0x189)][_0x36e52f(0x162)](),(0x0,job_1[_0x36e52f(0x184)])({'jobId':_0xd7638,'run':()=>{const _0x4f019d=_0x36e52f;let _0x3d5937=null;return this[_0x4f019d(0x159)]['textToAudio'](_0x2ba3d1,_0x3d06f6=>{const _0x3a7eef=_0x4f019d;_0x3d5937=this[_0x3a7eef(0x140)][_0x3a7eef(0x17d)](_0x3d06f6);}),_0x3d5937;},'durationInSecond':_0x5146fc,'next':()=>null});}async[a133_0x5284c7(0x19f)](_0x1e1b1d,_0x3ba895,_0x55d2a=![]){const _0x1c91bb=a133_0x5284c7,_0x105fe3={'when':'now','jobType':enums_1[_0x1c91bb(0x187)][_0x1c91bb(0x142)],'attributes':{'soundId':_0x3ba895,'durationInSecond':_0x55d2a?0x15180:undefined},'audit':{'actor':_0x1e1b1d,'name':enums_1[_0x1c91bb(0x187)][_0x1c91bb(0x142)],'message':_0x1c91bb(0x154)+_0x3ba895}},_0x29f7d8=await this['soundModel'][_0x1c91bb(0x1a1)]({'jobId':{'$ne':null}});_0x29f7d8&&await this[_0x1c91bb(0x1af)](_0x29f7d8['id']);const {jobId:_0x393484}=await this[_0x1c91bb(0x17a)][_0x1c91bb(0x17e)](_0x105fe3);return this[_0x1c91bb(0x14f)](_0x3ba895,{'jobId':_0x393484});}async[a133_0x5284c7(0x1af)](_0xeca00a){const _0x2925d0=a133_0x5284c7;let _0x57b161=await this['findOne'](_0xeca00a);const {jobId:_0x52f121}=_0x57b161||{};if(_0x52f121){const {success:_0x4585fe}=await this['agendaService'][_0x2925d0(0x161)](_0x52f121);_0x4585fe&&(_0x57b161=await this[_0x2925d0(0x14f)](_0xeca00a,{'jobId':null}));}return this[_0x2925d0(0x177)]['broadcastPlaying']({'id':_0x57b161['id'],'isPlaying':![]}),_0x57b161;}async[a133_0x5284c7(0x14d)](){const _0x2b1f24=a133_0x5284c7,_0x166f45=await this['findByType'](constants_2['SoundType'][_0x2b1f24(0x155)]);if(_0x166f45[_0x2b1f24(0x172)]>0x0){const _0x350e7f=[];_0x166f45[_0x2b1f24(0x194)](_0x158400=>{const _0x29ae94=_0x2b1f24;_0x350e7f[_0x29ae94(0x150)](this[_0x29ae94(0x163)](_0x158400[_0x29ae94(0x1a7)]));}),await Promise[_0x2b1f24(0x190)](_0x350e7f);}await(0x0,file_1[_0x2b1f24(0x14c)])(constants_1[_0x2b1f24(0x16b)],constants_1['TMP_UPLOAD_DIR']);const _0x23e96a=[];return default_sounds_1[_0x2b1f24(0x198)][_0x2b1f24(0x194)](_0x35098d=>{const _0x2d2ba0=_0x2b1f24;_0x23e96a[_0x2d2ba0(0x150)](this[_0x2d2ba0(0x17f)](Object['assign']({},_0x35098d)));}),await Promise[_0x2b1f24(0x190)](_0x23e96a),!![];}[a133_0x5284c7(0x152)](_0x240a7b){const _0x16ce25=a133_0x5284c7,_0x24cb97=_0x240a7b['split']('.')[_0x16ce25(0x1a9)]();return(0x0,utils_1['uuid'])()+'.'+_0x24cb97;}async[a133_0x5284c7(0x185)](_0x2f2f48,_0xf7a2d){const _0x422bc5=a133_0x5284c7;if(!_0x2f2f48[_0x422bc5(0x15f)])return;const _0x3a5327=constants_1[_0x422bc5(0x173)]+'/'+_0x2f2f48[_0x422bc5(0x15f)],_0x39bd6c=_0xf7a2d||this[_0x422bc5(0x152)](_0x2f2f48[_0x422bc5(0x15f)]),_0xe47a33=constants_1[_0x422bc5(0x174)]+'/'+_0x39bd6c;if(!(0x0,file_1[_0x422bc5(0x182)])(_0x3a5327))throw new Error('File\x20not\x20found!');!(0x0,file_1[_0x422bc5(0x182)])(constants_1[_0x422bc5(0x174)])&&(0x0,file_1['createFolder'])(constants_1[_0x422bc5(0x174)]),await(0x0,file_1[_0x422bc5(0x176)])(_0x3a5327,_0xe47a33),_0x2f2f48[_0x422bc5(0x15f)]=_0x39bd6c;}};__decorate([(0x0,event_emitter_1[a133_0x5284c7(0x141)])(sound_1[a133_0x5284c7(0x164)][a133_0x5284c7(0x1ac)]),__metadata(a133_0x5284c7(0x18c),Function),__metadata('design:paramtypes',[Object]),__metadata(a133_0x5284c7(0x16c),Promise)],SoundService['prototype'],'playSoundOnEvent',null),__decorate([(0x0,event_emitter_1['OnEvent'])(sound_1['SoundEvent'][a133_0x5284c7(0x183)]),__metadata(a133_0x5284c7(0x18c),Function),__metadata('design:paramtypes',[Object]),__metadata(a133_0x5284c7(0x16c),Promise)],SoundService[a133_0x5284c7(0x1ae)],a133_0x5284c7(0x16f),null),__decorate([(0x0,event_emitter_1['OnEvent'])(sound_1[a133_0x5284c7(0x164)][a133_0x5284c7(0x151)]),__metadata(a133_0x5284c7(0x18c),Function),__metadata(a133_0x5284c7(0x18e),[Object]),__metadata(a133_0x5284c7(0x16c),Promise)],SoundService['prototype'],a133_0x5284c7(0x16a),null),SoundService=SoundService_1=__decorate([(0x0,common_1[a133_0x5284c7(0x178)])(),__param(0x0,(0x0,mongoose_1[a133_0x5284c7(0x199)])('Sound')),__param(0x5,(0x0,common_1[a133_0x5284c7(0x18f)])(sound_gateway_1['SoundGateway'])),__metadata('design:paramtypes',[mongoose_2[a133_0x5284c7(0x188)],agenda_service_1[a133_0x5284c7(0x191)],upload_service_1[a133_0x5284c7(0x156)],text_to_audio_service_1[a133_0x5284c7(0x147)],streaming_service_1['StreamingService'],sound_gateway_1[a133_0x5284c7(0x19e)]])],SoundService),exports['SoundService']=SoundService;function a133_0x5330(){const _0x585a57=['../agenda/agenda.service','Play','Playing\x20voice\x20recorded:\x20','prototype','stop','playSoundOnEvent','deleteFile','streamingService','OnEvent','PlaySound','mongoose','assets','path','findByIds','TextToAudioService','metadata','error','../text-to-audio/text-to-audio.service','filePath','copyFiles','resetTunes','__decorate','update','push','TextToAudio','getNewFileName','../streaming/streaming.service','Play\x20sound:\x20','Tune','UploadService','__esModule','1430xiRDgs','textToAudioService','208932EsANMJ','@nestjs/common','name','object','1737456wjScIg','fileName','149440hDnPDu','cancelJob','killAll','delete','SoundEvent','originalname','findById','Sound\x20not\x20found!','upload','uploadService','playTextToAudioRecorded','DEFAULT_TUNES_DIR','design:returntype','../common/events/sound','audio','playVoiceRecorded','SoundService','assign','length','TMP_UPLOAD_DIR','AUDIO_DIR','../common/audio/audio-player','moveFile','soundGateway','Injectable','getOwnPropertyDescriptor','agendaService','save','4IylnLu','playStreamAudioAsync','scheduleJob','create','../common/job','findVoiceRecoredById','isFileExist','VoiceRecorded','executeJob','validateAndMoveFileAsync','exec','JobType','Model','PROCESS_CACHE','Logger','defineProperty','design:type','findByIdAndUpdate','design:paramtypes','Inject','all','AgendaService','./constants','logger','forEach','../common/enums','3025664zllgTw','../common/constants','DEFAULT_TUNES','InjectModel','./sound.gateway','log','find','Playing\x20sound:\x20','SoundGateway','play','findByType','findOne','decorate','1525662fcFqZq','188lphWVp','soundModel','165456urAWBM','_id','playAsync','pop','250540mKAwmZ'];a133_0x5330=function(){return _0x585a57;};return a133_0x5330();}