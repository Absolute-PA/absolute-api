'use strict';const a136_0x33c9d8=a136_0x1866;(function(_0x59116e,_0x41ec3b){const _0xeaf41=a136_0x1866,_0x282896=_0x59116e();while(!![]){try{const _0x3fe93a=parseInt(_0xeaf41(0x125))/0x1*(parseInt(_0xeaf41(0xfe))/0x2)+parseInt(_0xeaf41(0xe0))/0x3*(parseInt(_0xeaf41(0x10a))/0x4)+parseInt(_0xeaf41(0x134))/0x5+-parseInt(_0xeaf41(0x144))/0x6+parseInt(_0xeaf41(0xe7))/0x7+-parseInt(_0xeaf41(0xc9))/0x8*(parseInt(_0xeaf41(0xd8))/0x9)+-parseInt(_0xeaf41(0xdf))/0xa*(parseInt(_0xeaf41(0x13c))/0xb);if(_0x3fe93a===_0x41ec3b)break;else _0x282896['push'](_0x282896['shift']());}catch(_0x27b378){_0x282896['push'](_0x282896['shift']());}}}(a136_0x33cf,0x66ae8));function a136_0x1866(_0x1760aa,_0x17d46d){const _0x33cfb4=a136_0x33cf();return a136_0x1866=function(_0x1866c4,_0x3fef64){_0x1866c4=_0x1866c4-0xc9;let _0x11d96e=_0x33cfb4[_0x1866c4];return _0x11d96e;},a136_0x1866(_0x1760aa,_0x17d46d);}function a136_0x33cf(){const _0x50a070=['TextToAudio','UploadService','Sound','5073502rYNAsG','save','audio','filePath','SoundType','createFolder','TMP_UPLOAD_DIR','uploadService','textToAudioService','Play','find','Sound\x20not\x20found!','create','SoundEvent','join','play','../common/job','findByIdAndDelete','AudioPlayer','findByIdAndUpdate','assign','../text-to-audio/text-to-audio.service','\x20-\x20','115202lLtTYe','__param','@nestjs/common','broadcastPlaying','prototype','playVoiceRecorded','metadata','findByType','@nestjs/event-emitter','../common/file','updateVolume','function','37404IBZldI','AgendaService','soundGateway','../common/audio/audio-player','originalname','agendaService','Inject','../upload/upload.service','validateAndMoveFileAsync','delete','exec','DEFAULT_TUNES','update','findVoiceRecoredById','Logger','all','forEach','mongoose','../common/path','streamingService','AUDIO_DIR','OnEvent','PROCESS_CACHE','TextToAudioService','decorate','Voice\x20file\x20not\x20found:\x20','assets','7rbnXig','length','design:paramtypes','__decorate','VoiceRecorded','./constants','playTextToAudioRecorded','logger','getMessageById','JobType','StreamingService','SoundService','__metadata','../agenda/agenda.service','../common/constants','2628170piDZGI','defineProperty','Injectable','Play\x20sound:\x20','deleteFile','stop','executeJob','getNewFileName','11owfOdZ','upload','fileName','push','playStreamAudioAsync','object','cwd','path','3914832QAiSLp','textToAudio','findOne','split','getOwnPropertyDescriptor','findByIds','1664792meKIIo','SoundGateway','_id','copyFiles','../common/events/sound','Sound\x20file\x20not\x20found:\x20','playAsync','killAll','uuid','design:type','__esModule','findById','soundModel','now','isFileExist','27OGdfLc','design:returntype','File\x20not\x20found!','log','Playing\x20voice\x20recorded:\x20','playSoundOnEvent','DEFAULT_TUNES_DIR','1339430Qpsfct','57HtgulG','error','volume','PlaySound'];a136_0x33cf=function(){return _0x50a070;};return a136_0x33cf();}var __decorate=this&&this[a136_0x33c9d8(0x128)]||function(_0x21bb71,_0x204f12,_0x414e96,_0x4e9350){const _0x31fc99=a136_0x33c9d8;var _0x46cc43=arguments[_0x31fc99(0x126)],_0x3e9d46=_0x46cc43<0x3?_0x204f12:_0x4e9350===null?_0x4e9350=Object[_0x31fc99(0x148)](_0x204f12,_0x414e96):_0x4e9350,_0x4c3730;if(typeof Reflect==='object'&&typeof Reflect[_0x31fc99(0x122)]===_0x31fc99(0x109))_0x3e9d46=Reflect[_0x31fc99(0x122)](_0x21bb71,_0x204f12,_0x414e96,_0x4e9350);else{for(var _0x17d8bf=_0x21bb71[_0x31fc99(0x126)]-0x1;_0x17d8bf>=0x0;_0x17d8bf--)if(_0x4c3730=_0x21bb71[_0x17d8bf])_0x3e9d46=(_0x46cc43<0x3?_0x4c3730(_0x3e9d46):_0x46cc43>0x3?_0x4c3730(_0x204f12,_0x414e96,_0x3e9d46):_0x4c3730(_0x204f12,_0x414e96))||_0x3e9d46;}return _0x46cc43>0x3&&_0x3e9d46&&Object[_0x31fc99(0x135)](_0x204f12,_0x414e96,_0x3e9d46),_0x3e9d46;},__metadata=this&&this[a136_0x33c9d8(0x131)]||function(_0x5301ea,_0x25942d){const _0xa3f986=a136_0x33c9d8;if(typeof Reflect===_0xa3f986(0x141)&&typeof Reflect[_0xa3f986(0x104)]===_0xa3f986(0x109))return Reflect[_0xa3f986(0x104)](_0x5301ea,_0x25942d);},__param=this&&this[a136_0x33c9d8(0xff)]||function(_0x5ee34b,_0x42b2dc){return function(_0xe69821,_0x5cb981){_0x42b2dc(_0xe69821,_0x5cb981,_0x5ee34b);};},SoundService_1;Object['defineProperty'](exports,a136_0x33c9d8(0xd3),{'value':!![]}),exports[a136_0x33c9d8(0x130)]=void 0x0;const common_1=require(a136_0x33c9d8(0x100)),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require(a136_0x33c9d8(0x11b)),path=require(a136_0x33c9d8(0x143)),event_emitter_1=require(a136_0x33c9d8(0x106)),file_1=require(a136_0x33c9d8(0x107)),agenda_service_1=require(a136_0x33c9d8(0x132)),enums_1=require('../common/enums'),constants_1=require(a136_0x33c9d8(0x133)),utils_1=require('../common/utils'),path_1=require(a136_0x33c9d8(0x11c)),audio_player_1=require(a136_0x33c9d8(0x10d)),sound_1=require(a136_0x33c9d8(0xcd)),job_1=require(a136_0x33c9d8(0xf7)),constants_2=require(a136_0x33c9d8(0x12a)),default_sounds_1=require('./data/default-sounds'),sound_gateway_1=require('./sound.gateway'),path_2=require(a136_0x33c9d8(0x143)),upload_service_1=require(a136_0x33c9d8(0x111)),text_to_audio_service_1=require(a136_0x33c9d8(0xfc)),streaming_service_1=require('../streaming/streaming.service');let SoundService=SoundService_1=class SoundService{constructor(_0x3326b7,_0x38d96b,_0x35c893,_0x196cc9,_0x48c5e6,_0x371f88){const _0x3edaa5=a136_0x33c9d8;this[_0x3edaa5(0xd5)]=_0x3326b7,this[_0x3edaa5(0x10f)]=_0x38d96b,this[_0x3edaa5(0xee)]=_0x35c893,this[_0x3edaa5(0xef)]=_0x196cc9,this[_0x3edaa5(0x11d)]=_0x48c5e6,this['soundGateway']=_0x371f88,this['logger']=new common_1[(_0x3edaa5(0x118))](SoundService_1['name']);}async[a136_0x33c9d8(0xf3)](_0x3d3f6e){const _0x5b231b=a136_0x33c9d8;await this[_0x5b231b(0x112)](_0x3d3f6e,null);const _0x228551=new this[(_0x5b231b(0xd5))](_0x3d3f6e);return _0x228551[_0x5b231b(0xe8)]();}async[a136_0x33c9d8(0x105)](_0x1bf871){const _0x12d1ea=a136_0x33c9d8,_0x219e5c=await this[_0x12d1ea(0xd5)][_0x12d1ea(0xf1)]({'type':_0x1bf871})[_0x12d1ea(0x114)]();return _0x219e5c;}async['findOne'](_0x526ba6){const _0x5c7fa0=a136_0x33c9d8,_0x447655=await this[_0x5c7fa0(0xd5)]['findById'](_0x526ba6);return _0x447655;}async[a136_0x33c9d8(0x149)](_0x5ba6ad){const _0x814a8a=a136_0x33c9d8,_0x2e57e4=await this[_0x814a8a(0xd5)][_0x814a8a(0xf1)]({'_id':{'$in':_0x5ba6ad}});return _0x2e57e4;}async[a136_0x33c9d8(0x116)](_0x4ceb3b,_0x4f3c7b){const _0xa05bf6=a136_0x33c9d8,_0x1a2d00=await this[_0xa05bf6(0xd5)][_0xa05bf6(0xd4)](_0x4ceb3b)[_0xa05bf6(0x114)]();if(!_0x1a2d00)throw new Error(_0xa05bf6(0xf2));await this[_0xa05bf6(0x112)](_0x4f3c7b,_0x1a2d00===null||_0x1a2d00===void 0x0?void 0x0:_0x1a2d00['fileName']);const _0x5d3657=await this[_0xa05bf6(0xd5)][_0xa05bf6(0xfa)](_0x4ceb3b,Object[_0xa05bf6(0xfb)](Object['assign']({},_0x4f3c7b),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x5d3657;}async[a136_0x33c9d8(0x108)](_0x193bea,_0x424aed){const _0xe17212=a136_0x33c9d8,_0x32ceb6=await this[_0xe17212(0xd5)][_0xe17212(0xd4)](_0x193bea)[_0xe17212(0x114)]();if(!_0x32ceb6)throw new Error(_0xe17212(0xf2));const _0x5e04fb=await this[_0xe17212(0xd5)]['findByIdAndUpdate'](_0x193bea,Object[_0xe17212(0xfb)](Object[_0xe17212(0xfb)]({},_0x424aed),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x5e04fb;}async[a136_0x33c9d8(0x113)](_0x306672){const _0x573ecd=a136_0x33c9d8,_0x49a54d=await this['soundModel'][_0x573ecd(0xf8)](_0x306672);if(_0x49a54d[_0x573ecd(0x13e)]){const _0x5341fc=constants_1[_0x573ecd(0x11e)]+'/'+_0x49a54d[_0x573ecd(0x13e)];try{(0x0,file_1[_0x573ecd(0x138)])(_0x5341fc);}catch(_0x2aff35){this['logger'][_0x573ecd(0xe1)](_0x2aff35);}}return _0x49a54d;}async[a136_0x33c9d8(0x13d)](_0x290614,_0x3702e4){const _0x39cc5b=a136_0x33c9d8,_0x24ad71=await this[_0x39cc5b(0xd5)]['findById'](_0x290614)[_0x39cc5b(0x114)](),_0x1fea7a=_0x24ad71===null||_0x24ad71===void 0x0?void 0x0:_0x24ad71[_0x39cc5b(0x13e)],_0x5d458c=this[_0x39cc5b(0x13b)](_0x3702e4[_0x39cc5b(0x10e)]),_0x452755=constants_1[_0x39cc5b(0x11e)]+'/'+_0x5d458c;await(0x0,file_1['moveFile'])(_0x3702e4[_0x39cc5b(0x143)],_0x452755);const _0x953e06={'fileName':_0x5d458c},_0x611df=await this[_0x39cc5b(0xd5)]['findByIdAndUpdate'](_0x290614,Object[_0x39cc5b(0xfb)](Object['assign']({},_0x953e06),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0x1fea7a){const _0x273eed=constants_1[_0x39cc5b(0x11e)]+'/'+_0x1fea7a;(0x0,file_1[_0x39cc5b(0x138)])(_0x273eed);}return _0x611df;}async[a136_0x33c9d8(0xdd)](_0x1fc79b){const _0x2f07bb=a136_0x33c9d8,{soundId:_0x425f8d,jobId:_0x464650,durationInSecond:_0xa9fe8c}=_0x1fc79b,_0x7a61dd=await this[_0x2f07bb(0x146)](_0x425f8d),_0x50316d=path[_0x2f07bb(0xf5)](path_1['processRootPath'],_0x2f07bb(0x124),_0x2f07bb(0xe9),_0x7a61dd[_0x2f07bb(0x13e)]);if(!(0x0,file_1['isFileExist'])(_0x50316d)){this[_0x2f07bb(0x12c)][_0x2f07bb(0xe1)](_0x2f07bb(0xce)+_0x50316d);return;}job_1['PROCESS_CACHE'][_0x2f07bb(0xd0)](),this['logger'][_0x2f07bb(0xdb)]('Playing\x20sound:\x20'+_0x425f8d+_0x2f07bb(0xfd)+_0x7a61dd['name']),(0x0,job_1[_0x2f07bb(0x13a)])({'jobId':_0x464650,'run':()=>audio_player_1[_0x2f07bb(0xf9)][_0x2f07bb(0xcf)](_0x50316d,_0x7a61dd[_0x2f07bb(0xe2)]),'next':()=>this[_0x2f07bb(0x139)](_0x425f8d),'durationInSecond':_0xa9fe8c}),this['soundGateway'][_0x2f07bb(0x101)]({'id':_0x425f8d,'isPlaying':!![]});}async[a136_0x33c9d8(0x103)](_0x5dec47){const _0x54a977=a136_0x33c9d8,{voiceId:_0x34c1bf,jobId:_0x581cde,durationInSecond:_0x387585}=_0x5dec47,_0x22d57d=await this[_0x54a977(0xee)][_0x54a977(0x117)](_0x34c1bf),_0x15b51b=_0x22d57d[_0x54a977(0xea)],_0x3e4901=(0x0,path_2[_0x54a977(0xf5)])(process[_0x54a977(0x142)](),_0x15b51b);if(!(0x0,file_1['isFileExist'])(_0x3e4901)){this[_0x54a977(0x12c)][_0x54a977(0xe1)](_0x54a977(0x123)+_0x3e4901);return;}job_1['PROCESS_CACHE']['killAll'](),this[_0x54a977(0x12c)][_0x54a977(0xdb)](_0x54a977(0xdc)+_0x34c1bf),(0x0,job_1[_0x54a977(0x13a)])({'jobId':_0x581cde,'run':()=>audio_player_1[_0x54a977(0xf9)][_0x54a977(0xcf)](_0x3e4901),'durationInSecond':_0x387585,'next':()=>null});}async[a136_0x33c9d8(0x12b)](_0x5aa5b5){const _0x2e6053=a136_0x33c9d8,{textToAudioId:_0x5ccfee,jobId:_0x238d46,durationInSecond:_0x1bbf2c}=_0x5aa5b5,{message:_0x1c52fa}=await this[_0x2e6053(0xef)][_0x2e6053(0x12d)](_0x5ccfee);job_1[_0x2e6053(0x120)][_0x2e6053(0xd0)](),(0x0,job_1[_0x2e6053(0x13a)])({'jobId':_0x238d46,'run':()=>{const _0x20540b=_0x2e6053;let _0x5dade2=null;return this[_0x20540b(0xef)][_0x20540b(0x145)](_0x1c52fa,_0x27c5c6=>{const _0x359aed=_0x20540b;_0x5dade2=this[_0x359aed(0x11d)][_0x359aed(0x140)](_0x27c5c6);}),_0x5dade2;},'durationInSecond':_0x1bbf2c,'next':()=>null});}async[a136_0x33c9d8(0xf6)](_0x1d011d,_0x44d386,_0x6d830b=![]){const _0x484f72=a136_0x33c9d8,_0x58a529={'when':_0x484f72(0xd6),'jobType':enums_1[_0x484f72(0x12e)][_0x484f72(0xe3)],'attributes':{'soundId':_0x44d386,'durationInSecond':_0x6d830b?0x15180:undefined},'audit':{'actor':_0x1d011d,'name':enums_1['JobType']['PlaySound'],'message':_0x484f72(0x137)+_0x44d386}},_0x3d3eb0=await this[_0x484f72(0xd5)][_0x484f72(0x146)]({'jobId':{'$ne':null}});_0x3d3eb0&&await this[_0x484f72(0x139)](_0x3d3eb0['id']);const {jobId:_0x22fc62}=await this[_0x484f72(0x10f)]['scheduleJob'](_0x58a529);return this[_0x484f72(0x116)](_0x44d386,{'jobId':_0x22fc62});}async[a136_0x33c9d8(0x139)](_0x2588a9){const _0x5d32a9=a136_0x33c9d8;let _0x46e282=await this[_0x5d32a9(0x146)](_0x2588a9);const {jobId:_0x2182e7}=_0x46e282||{};if(_0x2182e7){const {success:_0x4c78a7}=await this['agendaService']['cancelJob'](_0x2182e7);_0x4c78a7&&(_0x46e282=await this[_0x5d32a9(0x116)](_0x2588a9,{'jobId':null}));}return this[_0x5d32a9(0x10c)]['broadcastPlaying']({'id':_0x46e282['id'],'isPlaying':![]}),_0x46e282;}async['resetTunes'](){const _0xfb028d=a136_0x33c9d8,_0x524f5c=await this[_0xfb028d(0x105)](constants_2[_0xfb028d(0xeb)]['Tune']);if(_0x524f5c[_0xfb028d(0x126)]>0x0){const _0x4f4953=[];_0x524f5c[_0xfb028d(0x11a)](_0x3bda12=>{const _0x3491e=_0xfb028d;_0x4f4953[_0x3491e(0x13f)](this['delete'](_0x3bda12[_0x3491e(0xcb)]));}),await Promise[_0xfb028d(0x119)](_0x4f4953);}await(0x0,file_1[_0xfb028d(0xcc)])(constants_1[_0xfb028d(0xde)],constants_1['TMP_UPLOAD_DIR']);const _0x34ac7c=[];return default_sounds_1[_0xfb028d(0x115)]['forEach'](_0x32f561=>{const _0x5d577a=_0xfb028d;_0x34ac7c[_0x5d577a(0x13f)](this[_0x5d577a(0xf3)](Object[_0x5d577a(0xfb)]({},_0x32f561)));}),await Promise[_0xfb028d(0x119)](_0x34ac7c),!![];}[a136_0x33c9d8(0x13b)](_0x316c00){const _0x9d936=a136_0x33c9d8,_0x821944=_0x316c00[_0x9d936(0x147)]('.')['pop']();return(0x0,utils_1[_0x9d936(0xd1)])()+'.'+_0x821944;}async[a136_0x33c9d8(0x112)](_0x494879,_0x12e724){const _0x5cfdac=a136_0x33c9d8;if(!_0x494879[_0x5cfdac(0x13e)])return;const _0x3c8de0=constants_1[_0x5cfdac(0xed)]+'/'+_0x494879[_0x5cfdac(0x13e)],_0x2f59af=_0x12e724||this[_0x5cfdac(0x13b)](_0x494879[_0x5cfdac(0x13e)]),_0x577dda=constants_1[_0x5cfdac(0x11e)]+'/'+_0x2f59af;if(!(0x0,file_1['isFileExist'])(_0x3c8de0))throw new Error(_0x5cfdac(0xda));!(0x0,file_1[_0x5cfdac(0xd7)])(constants_1[_0x5cfdac(0x11e)])&&(0x0,file_1[_0x5cfdac(0xec)])(constants_1[_0x5cfdac(0x11e)]),await(0x0,file_1['moveFile'])(_0x3c8de0,_0x577dda),_0x494879[_0x5cfdac(0x13e)]=_0x2f59af;}};__decorate([(0x0,event_emitter_1[a136_0x33c9d8(0x11f)])(sound_1[a136_0x33c9d8(0xf4)][a136_0x33c9d8(0xf0)]),__metadata('design:type',Function),__metadata('design:paramtypes',[Object]),__metadata(a136_0x33c9d8(0xd9),Promise)],SoundService[a136_0x33c9d8(0x102)],a136_0x33c9d8(0xdd),null),__decorate([(0x0,event_emitter_1[a136_0x33c9d8(0x11f)])(sound_1[a136_0x33c9d8(0xf4)][a136_0x33c9d8(0x129)]),__metadata('design:type',Function),__metadata(a136_0x33c9d8(0x127),[Object]),__metadata('design:returntype',Promise)],SoundService[a136_0x33c9d8(0x102)],a136_0x33c9d8(0x103),null),__decorate([(0x0,event_emitter_1[a136_0x33c9d8(0x11f)])(sound_1[a136_0x33c9d8(0xf4)][a136_0x33c9d8(0xe4)]),__metadata(a136_0x33c9d8(0xd2),Function),__metadata(a136_0x33c9d8(0x127),[Object]),__metadata(a136_0x33c9d8(0xd9),Promise)],SoundService[a136_0x33c9d8(0x102)],a136_0x33c9d8(0x12b),null),SoundService=SoundService_1=__decorate([(0x0,common_1[a136_0x33c9d8(0x136)])(),__param(0x0,(0x0,mongoose_1['InjectModel'])(a136_0x33c9d8(0xe6))),__param(0x5,(0x0,common_1[a136_0x33c9d8(0x110)])(sound_gateway_1['SoundGateway'])),__metadata(a136_0x33c9d8(0x127),[mongoose_2['Model'],agenda_service_1[a136_0x33c9d8(0x10b)],upload_service_1[a136_0x33c9d8(0xe5)],text_to_audio_service_1[a136_0x33c9d8(0x121)],streaming_service_1[a136_0x33c9d8(0x12f)],sound_gateway_1[a136_0x33c9d8(0xca)]])],SoundService),exports[a136_0x33c9d8(0x130)]=SoundService;