'use strict';const a133_0x1abc71=a133_0x45de;(function(_0x5578a9,_0x2c9423){const _0x5b8b6c=a133_0x45de,_0x11993e=_0x5578a9();while(!![]){try{const _0x2fbe98=-parseInt(_0x5b8b6c(0x15f))/0x1*(parseInt(_0x5b8b6c(0x13b))/0x2)+-parseInt(_0x5b8b6c(0x104))/0x3*(parseInt(_0x5b8b6c(0x14d))/0x4)+parseInt(_0x5b8b6c(0x128))/0x5+-parseInt(_0x5b8b6c(0x146))/0x6+parseInt(_0x5b8b6c(0x12b))/0x7*(-parseInt(_0x5b8b6c(0x15a))/0x8)+-parseInt(_0x5b8b6c(0x12a))/0x9*(-parseInt(_0x5b8b6c(0x107))/0xa)+parseInt(_0x5b8b6c(0x162))/0xb*(parseInt(_0x5b8b6c(0x14a))/0xc);if(_0x2fbe98===_0x2c9423)break;else _0x11993e['push'](_0x11993e['shift']());}catch(_0x22d3fc){_0x11993e['push'](_0x11993e['shift']());}}}(a133_0xd590,0x8a26f));function a133_0xd590(){const _0x322b00=['playSoundOnEvent','isFileExist','now','design:returntype','object','function','update','findByIdAndUpdate','../common/audio/audio-player','PROCESS_CACHE','Injectable','textToAudioService','cancelJob','assets','InjectModel','name','validateAndMoveFileAsync','agendaService','9cQhttz','playAsync','createFolder','10XwVmUl','../common/events/sound','mongoose','design:paramtypes','./data/default-sounds','__param','./constants','__metadata','PlaySound','forEach','playStreamAudioAsync','logger','./sound.gateway','length','delete','save','Playing\x20sound:\x20','playTextToAudioRecorded','uuid','SoundGateway','Inject','findByType','originalname','error','prototype','../common/file','@nestjs/common','Sound\x20not\x20found!','getNewFileName','broadcastPlaying','playVoiceRecorded','join','soundModel','3460630TCyOSf','push','340650IjeKbo','5204815AmtUSL','uploadService','Tune','JobType','killAll','Play','../agenda/agenda.service','all','_id','../common/enums','DEFAULT_TUNES','path','streamingService','Play\x20sound:\x20','AudioPlayer','AgendaService','122546zrPUmX','design:type','moveFile','stop','../common/path','metadata','OnEvent','getMessageById','play','SoundType','executeJob','2382882KTnhcd','split','create','\x20-\x20','19818636kYtEUp','TextToAudio','../text-to-audio/text-to-audio.service','1284DXkPYu','VoiceRecorded','findById','log','assign','StreamingService','@nestjs/mongoose','DEFAULT_TUNES_DIR','../common/utils','audio','getOwnPropertyDescriptor','scheduleJob','SoundEvent','8DXFkxW','soundGateway','findOne','__esModule','../common/job','11dpWXiA','TMP_UPLOAD_DIR','resetTunes','11CujSJZ','filePath','TextToAudioService','__decorate','defineProperty','AUDIO_DIR','pop','fileName','Logger','volume','deleteFile','decorate','UploadService','SoundService','exec'];a133_0xd590=function(){return _0x322b00;};return a133_0xd590();}function a133_0x45de(_0xb74730,_0x1c39b2){const _0xd59052=a133_0xd590();return a133_0x45de=function(_0x45dee4,_0x19e3eb){_0x45dee4=_0x45dee4-0x102;let _0x22424d=_0xd59052[_0x45dee4];return _0x22424d;},a133_0x45de(_0xb74730,_0x1c39b2);}var __decorate=this&&this[a133_0x1abc71(0x165)]||function(_0x5720ca,_0x4b321d,_0x3cb884,_0x502a40){const _0x38796f=a133_0x1abc71;var _0x54426c=arguments['length'],_0x28aee5=_0x54426c<0x3?_0x4b321d:_0x502a40===null?_0x502a40=Object[_0x38796f(0x157)](_0x4b321d,_0x3cb884):_0x502a40,_0x161a91;if(typeof Reflect===_0x38796f(0x175)&&typeof Reflect[_0x38796f(0x16d)]==='function')_0x28aee5=Reflect['decorate'](_0x5720ca,_0x4b321d,_0x3cb884,_0x502a40);else{for(var _0x30ad23=_0x5720ca['length']-0x1;_0x30ad23>=0x0;_0x30ad23--)if(_0x161a91=_0x5720ca[_0x30ad23])_0x28aee5=(_0x54426c<0x3?_0x161a91(_0x28aee5):_0x54426c>0x3?_0x161a91(_0x4b321d,_0x3cb884,_0x28aee5):_0x161a91(_0x4b321d,_0x3cb884))||_0x28aee5;}return _0x54426c>0x3&&_0x28aee5&&Object[_0x38796f(0x166)](_0x4b321d,_0x3cb884,_0x28aee5),_0x28aee5;},__metadata=this&&this[a133_0x1abc71(0x10e)]||function(_0x1d91e6,_0x24d910){const _0x1c5770=a133_0x1abc71;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x1c5770(0x176))return Reflect[_0x1c5770(0x140)](_0x1d91e6,_0x24d910);},__param=this&&this[a133_0x1abc71(0x10c)]||function(_0x173460,_0x373305){return function(_0x239832,_0x30496b){_0x373305(_0x239832,_0x30496b,_0x173460);};},SoundService_1;Object[a133_0x1abc71(0x166)](exports,a133_0x1abc71(0x15d),{'value':!![]}),exports[a133_0x1abc71(0x16f)]=void 0x0;const common_1=require(a133_0x1abc71(0x121)),mongoose_1=require(a133_0x1abc71(0x153)),mongoose_2=require(a133_0x1abc71(0x109)),path=require('path'),event_emitter_1=require('@nestjs/event-emitter'),file_1=require(a133_0x1abc71(0x120)),agenda_service_1=require(a133_0x1abc71(0x131)),enums_1=require(a133_0x1abc71(0x134)),constants_1=require('../common/constants'),utils_1=require(a133_0x1abc71(0x155)),path_1=require(a133_0x1abc71(0x13f)),audio_player_1=require(a133_0x1abc71(0x179)),sound_1=require(a133_0x1abc71(0x108)),job_1=require(a133_0x1abc71(0x15e)),constants_2=require(a133_0x1abc71(0x10d)),default_sounds_1=require(a133_0x1abc71(0x10b)),sound_gateway_1=require(a133_0x1abc71(0x113)),path_2=require(a133_0x1abc71(0x136)),upload_service_1=require('../upload/upload.service'),text_to_audio_service_1=require(a133_0x1abc71(0x14c)),streaming_service_1=require('../streaming/streaming.service');let SoundService=SoundService_1=class SoundService{constructor(_0x1ab4ca,_0x5b694e,_0x578162,_0x259ad7,_0x2c2808,_0x534993){const _0xddced8=a133_0x1abc71;this[_0xddced8(0x127)]=_0x1ab4ca,this[_0xddced8(0x103)]=_0x5b694e,this[_0xddced8(0x12c)]=_0x578162,this[_0xddced8(0x17c)]=_0x259ad7,this[_0xddced8(0x137)]=_0x2c2808,this[_0xddced8(0x15b)]=_0x534993,this[_0xddced8(0x112)]=new common_1[(_0xddced8(0x16a))](SoundService_1[_0xddced8(0x180)]);}async['create'](_0x538ac5){const _0x2444d9=a133_0x1abc71;await this[_0x2444d9(0x102)](_0x538ac5,null);const _0x32a187=new this['soundModel'](_0x538ac5);return _0x32a187[_0x2444d9(0x116)]();}async[a133_0x1abc71(0x11c)](_0xbaf8e1){const _0x29dbbf=a133_0x1abc71,_0x4a7819=await this['soundModel']['find']({'type':_0xbaf8e1})[_0x29dbbf(0x170)]();return _0x4a7819;}async['findOne'](_0x2daf9c){const _0x2d15e8=a133_0x1abc71,_0x3b5f0d=await this['soundModel'][_0x2d15e8(0x14f)](_0x2daf9c);return _0x3b5f0d;}async['findByIds'](_0x592e8e){const _0x1af36e=a133_0x1abc71,_0x4c2572=await this[_0x1af36e(0x127)]['find']({'_id':{'$in':_0x592e8e}});return _0x4c2572;}async[a133_0x1abc71(0x177)](_0x2ef805,_0xad8089){const _0x26ee02=a133_0x1abc71,_0x51c58c=await this[_0x26ee02(0x127)][_0x26ee02(0x14f)](_0x2ef805)['exec']();if(!_0x51c58c)throw new Error(_0x26ee02(0x122));await this[_0x26ee02(0x102)](_0xad8089,_0x51c58c===null||_0x51c58c===void 0x0?void 0x0:_0x51c58c[_0x26ee02(0x169)]);const _0xc00e33=await this[_0x26ee02(0x127)][_0x26ee02(0x178)](_0x2ef805,Object[_0x26ee02(0x151)](Object[_0x26ee02(0x151)]({},_0xad8089),{'updatedAtUtc':new Date()}),{'new':!![]});return _0xc00e33;}async['updateVolume'](_0x25dfbf,_0x58d63a){const _0x351f6d=a133_0x1abc71,_0x876a78=await this[_0x351f6d(0x127)][_0x351f6d(0x14f)](_0x25dfbf)[_0x351f6d(0x170)]();if(!_0x876a78)throw new Error(_0x351f6d(0x122));const _0x3a4244=await this[_0x351f6d(0x127)][_0x351f6d(0x178)](_0x25dfbf,Object[_0x351f6d(0x151)](Object[_0x351f6d(0x151)]({},_0x58d63a),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x3a4244;}async[a133_0x1abc71(0x115)](_0x534dc7){const _0x489db5=a133_0x1abc71,_0x4e052f=await this[_0x489db5(0x127)]['findByIdAndDelete'](_0x534dc7);if(_0x4e052f['fileName']){const _0x4607be=constants_1['AUDIO_DIR']+'/'+_0x4e052f[_0x489db5(0x169)];try{(0x0,file_1[_0x489db5(0x16c)])(_0x4607be);}catch(_0x5cfaed){this['logger'][_0x489db5(0x11e)](_0x5cfaed);}}return _0x4e052f;}async['upload'](_0x50ad92,_0xfb1334){const _0x19b94b=a133_0x1abc71,_0x17217b=await this['soundModel'][_0x19b94b(0x14f)](_0x50ad92)[_0x19b94b(0x170)](),_0x515439=_0x17217b===null||_0x17217b===void 0x0?void 0x0:_0x17217b[_0x19b94b(0x169)],_0x1e14f5=this['getNewFileName'](_0xfb1334[_0x19b94b(0x11d)]),_0x3104f6=constants_1[_0x19b94b(0x167)]+'/'+_0x1e14f5;await(0x0,file_1[_0x19b94b(0x13d)])(_0xfb1334[_0x19b94b(0x136)],_0x3104f6);const _0x228c3c={'fileName':_0x1e14f5},_0x138ec8=await this[_0x19b94b(0x127)][_0x19b94b(0x178)](_0x50ad92,Object[_0x19b94b(0x151)](Object[_0x19b94b(0x151)]({},_0x228c3c),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0x515439){const _0x3b6201=constants_1[_0x19b94b(0x167)]+'/'+_0x515439;(0x0,file_1[_0x19b94b(0x16c)])(_0x3b6201);}return _0x138ec8;}async[a133_0x1abc71(0x171)](_0x3b887c){const _0x276c8f=a133_0x1abc71,{soundId:_0x3fd137,jobId:_0x3659e9,durationInSecond:_0x4b3de9}=_0x3b887c,_0x211814=await this['findOne'](_0x3fd137),_0x38a5e1=path[_0x276c8f(0x126)](path_1['processRootPath'],_0x276c8f(0x17e),_0x276c8f(0x156),_0x211814[_0x276c8f(0x169)]);job_1['PROCESS_CACHE'][_0x276c8f(0x12f)](),this[_0x276c8f(0x112)][_0x276c8f(0x150)](_0x276c8f(0x117)+_0x3fd137+_0x276c8f(0x149)+_0x211814[_0x276c8f(0x180)]),(0x0,job_1[_0x276c8f(0x145)])({'jobId':_0x3659e9,'run':()=>audio_player_1[_0x276c8f(0x139)][_0x276c8f(0x105)](_0x38a5e1,_0x211814[_0x276c8f(0x16b)]),'next':()=>this[_0x276c8f(0x13e)](_0x3fd137),'durationInSecond':_0x4b3de9}),this[_0x276c8f(0x15b)][_0x276c8f(0x124)]({'id':_0x3fd137,'isPlaying':!![]});}async[a133_0x1abc71(0x125)](_0x31457e){const _0x3ecbe5=a133_0x1abc71,{voiceId:_0x1958e8,jobId:_0x55d9bb,durationInSecond:_0x2bea7d}=_0x31457e,_0x18ed9e=await this[_0x3ecbe5(0x12c)]['findVoiceRecoredById'](_0x1958e8),_0x5038d4=_0x18ed9e[_0x3ecbe5(0x163)],_0x3cd9bd=(0x0,path_2['join'])(process['cwd'](),_0x5038d4);job_1[_0x3ecbe5(0x17a)][_0x3ecbe5(0x12f)](),this[_0x3ecbe5(0x112)][_0x3ecbe5(0x150)]('Playing\x20voice\x20recorded:\x20'+_0x1958e8),(0x0,job_1[_0x3ecbe5(0x145)])({'jobId':_0x55d9bb,'run':()=>audio_player_1[_0x3ecbe5(0x139)][_0x3ecbe5(0x105)](_0x3cd9bd),'durationInSecond':_0x2bea7d,'next':()=>null});}async[a133_0x1abc71(0x118)](_0x665d7c){const _0x334d37=a133_0x1abc71,{textToAudioId:_0x1413b9,jobId:_0x4acab4,durationInSecond:_0x34d3ab}=_0x665d7c,{message:_0x4bb327}=await this[_0x334d37(0x17c)][_0x334d37(0x142)](_0x1413b9);job_1['PROCESS_CACHE'][_0x334d37(0x12f)](),(0x0,job_1[_0x334d37(0x145)])({'jobId':_0x4acab4,'run':()=>{const _0x22645a=_0x334d37;let _0x4e2f5a=null;return this[_0x22645a(0x17c)]['textToAudio'](_0x4bb327,_0x4eadf9=>{const _0x38b599=_0x22645a;_0x4e2f5a=this[_0x38b599(0x137)][_0x38b599(0x111)](_0x4eadf9);}),_0x4e2f5a;},'durationInSecond':_0x34d3ab,'next':()=>null});}async[a133_0x1abc71(0x143)](_0x37f464,_0x5bc877,_0x434930=![]){const _0x173192=a133_0x1abc71,_0x5dc8a8={'when':_0x173192(0x173),'jobType':enums_1[_0x173192(0x12e)][_0x173192(0x10f)],'attributes':{'soundId':_0x5bc877,'durationInSecond':_0x434930?0x15180:undefined},'audit':{'actor':_0x37f464,'name':enums_1[_0x173192(0x12e)]['PlaySound'],'message':_0x173192(0x138)+_0x5bc877}},_0x4fe1bd=await this[_0x173192(0x127)][_0x173192(0x15c)]({'jobId':{'$ne':null}});_0x4fe1bd&&await this[_0x173192(0x13e)](_0x4fe1bd['id']);const {jobId:_0x15d93f}=await this[_0x173192(0x103)][_0x173192(0x158)](_0x5dc8a8);return this[_0x173192(0x177)](_0x5bc877,{'jobId':_0x15d93f});}async[a133_0x1abc71(0x13e)](_0x5ae08a){const _0x6ad584=a133_0x1abc71;let _0x1eb294=await this[_0x6ad584(0x15c)](_0x5ae08a);const {jobId:_0x37f77b}=_0x1eb294||{};if(_0x37f77b){const {success:_0x4f40b3}=await this[_0x6ad584(0x103)][_0x6ad584(0x17d)](_0x37f77b);_0x4f40b3&&(_0x1eb294=await this[_0x6ad584(0x177)](_0x5ae08a,{'jobId':null}));}return this['soundGateway'][_0x6ad584(0x124)]({'id':_0x1eb294['id'],'isPlaying':![]}),_0x1eb294;}async[a133_0x1abc71(0x161)](){const _0x1790a2=a133_0x1abc71,_0x28bc92=await this[_0x1790a2(0x11c)](constants_2[_0x1790a2(0x144)][_0x1790a2(0x12d)]);if(_0x28bc92[_0x1790a2(0x114)]>0x0){const _0x5078a0=[];_0x28bc92[_0x1790a2(0x110)](_0x4b968b=>{const _0x35b54f=_0x1790a2;_0x5078a0['push'](this['delete'](_0x4b968b[_0x35b54f(0x133)]));}),await Promise[_0x1790a2(0x132)](_0x5078a0);}await(0x0,file_1['copyFiles'])(constants_1[_0x1790a2(0x154)],constants_1[_0x1790a2(0x160)]);const _0x300ed8=[];return default_sounds_1[_0x1790a2(0x135)][_0x1790a2(0x110)](_0x3635b6=>{const _0x168f85=_0x1790a2;_0x300ed8[_0x168f85(0x129)](this[_0x168f85(0x148)](Object['assign']({},_0x3635b6)));}),await Promise[_0x1790a2(0x132)](_0x300ed8),!![];}[a133_0x1abc71(0x123)](_0x5dde94){const _0x44e1fe=a133_0x1abc71,_0xa1c93c=_0x5dde94[_0x44e1fe(0x147)]('.')[_0x44e1fe(0x168)]();return(0x0,utils_1[_0x44e1fe(0x119)])()+'.'+_0xa1c93c;}async[a133_0x1abc71(0x102)](_0x4bbc40,_0xa12182){const _0x163e12=a133_0x1abc71;if(!_0x4bbc40['fileName'])return;const _0x39b100=constants_1[_0x163e12(0x160)]+'/'+_0x4bbc40[_0x163e12(0x169)],_0x12147a=_0xa12182||this['getNewFileName'](_0x4bbc40['fileName']),_0x4fe557=constants_1['AUDIO_DIR']+'/'+_0x12147a;if(!(0x0,file_1[_0x163e12(0x172)])(_0x39b100))throw new Error('File\x20not\x20found!');!(0x0,file_1['isFileExist'])(constants_1[_0x163e12(0x167)])&&(0x0,file_1[_0x163e12(0x106)])(constants_1[_0x163e12(0x167)]),await(0x0,file_1[_0x163e12(0x13d)])(_0x39b100,_0x4fe557),_0x4bbc40[_0x163e12(0x169)]=_0x12147a;}};__decorate([(0x0,event_emitter_1[a133_0x1abc71(0x141)])(sound_1[a133_0x1abc71(0x159)][a133_0x1abc71(0x130)]),__metadata('design:type',Function),__metadata(a133_0x1abc71(0x10a),[Object]),__metadata(a133_0x1abc71(0x174),Promise)],SoundService['prototype'],a133_0x1abc71(0x171),null),__decorate([(0x0,event_emitter_1['OnEvent'])(sound_1['SoundEvent'][a133_0x1abc71(0x14e)]),__metadata(a133_0x1abc71(0x13c),Function),__metadata(a133_0x1abc71(0x10a),[Object]),__metadata(a133_0x1abc71(0x174),Promise)],SoundService[a133_0x1abc71(0x11f)],a133_0x1abc71(0x125),null),__decorate([(0x0,event_emitter_1['OnEvent'])(sound_1[a133_0x1abc71(0x159)][a133_0x1abc71(0x14b)]),__metadata(a133_0x1abc71(0x13c),Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],SoundService['prototype'],a133_0x1abc71(0x118),null),SoundService=SoundService_1=__decorate([(0x0,common_1[a133_0x1abc71(0x17b)])(),__param(0x0,(0x0,mongoose_1[a133_0x1abc71(0x17f)])('Sound')),__param(0x5,(0x0,common_1[a133_0x1abc71(0x11b)])(sound_gateway_1[a133_0x1abc71(0x11a)])),__metadata(a133_0x1abc71(0x10a),[mongoose_2['Model'],agenda_service_1[a133_0x1abc71(0x13a)],upload_service_1[a133_0x1abc71(0x16e)],text_to_audio_service_1[a133_0x1abc71(0x164)],streaming_service_1[a133_0x1abc71(0x152)],sound_gateway_1[a133_0x1abc71(0x11a)]])],SoundService),exports['SoundService']=SoundService;