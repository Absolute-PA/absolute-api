'use strict';const a136_0x36cccd=a136_0x1774;(function(_0x430bfa,_0x1347a1){const _0x17865c=a136_0x1774,_0x208c8a=_0x430bfa();while(!![]){try{const _0x46e40e=parseInt(_0x17865c(0x193))/0x1*(parseInt(_0x17865c(0x1b5))/0x2)+parseInt(_0x17865c(0x1be))/0x3+parseInt(_0x17865c(0x1cf))/0x4+-parseInt(_0x17865c(0x174))/0x5*(parseInt(_0x17865c(0x1b3))/0x6)+parseInt(_0x17865c(0x1d6))/0x7*(-parseInt(_0x17865c(0x1eb))/0x8)+parseInt(_0x17865c(0x1de))/0x9+parseInt(_0x17865c(0x17d))/0xa*(-parseInt(_0x17865c(0x18c))/0xb);if(_0x46e40e===_0x1347a1)break;else _0x208c8a['push'](_0x208c8a['shift']());}catch(_0x10b8b5){_0x208c8a['push'](_0x208c8a['shift']());}}}(a136_0x4bc5,0x56006));function a136_0x4bc5(){const _0x1fa06b=['Play\x20sound:\x20','File\x20not\x20found!','split','fileName','design:paramtypes','save','streamingService','78pPcWqe','metadata','8EqBrwE','PlaySound','../common/utils','__param','volume','stop','./data/default-sounds','TMP_UPLOAD_DIR','getNewFileName','773262uBeNhq','uuid','findByIdAndDelete','log','Logger','Voice\x20file\x20not\x20found:\x20','deleteFile','isFileExist','processRootPath','moveFile','findVoiceRecoredById','audio','DEFAULT_TUNES_DIR','TextToAudioService','playVoiceRecorded','mongoose','@nestjs/mongoose','247200JCEDbi','playTextToAudioRecorded','logger','textToAudio','Playing\x20voice\x20recorded:\x20','forEach','length','7yGFNAg','../agenda/agenda.service','textToAudioService','PROCESS_CACHE','AgendaService','assign','executeJob','OnEvent','2233224tcBfMU','all','findByType','../common/job','uploadService','Sound\x20not\x20found!','assets','_id','updateVolume','../common/constants','agendaService','findByIds','find','3661128DydFUA','validateAndMoveFileAsync','20585WgVPeh','Model','__metadata','__decorate','update','UploadService','AUDIO_DIR','../text-to-audio/text-to-audio.service','../streaming/streaming.service','27610fLSZPz','../common/audio/audio-player','soundModel','push','name','AudioPlayer','function','exec','design:type','Play','upload','killAll','SoundGateway','object','SoundService','902TjZJTS','create','@nestjs/common','Playing\x20sound:\x20','SoundEvent','playAsync','copyFiles','130534SREDWh','prototype','soundGateway','StreamingService','cancelJob','error','../common/enums','Injectable','Sound','findOne','VoiceRecorded','defineProperty','path','findById','decorate','../common/file','__esModule','playSoundOnEvent','../common/events/sound','broadcastPlaying','SoundType','now','findByIdAndUpdate','design:returntype','playStreamAudioAsync'];a136_0x4bc5=function(){return _0x1fa06b;};return a136_0x4bc5();}var __decorate=this&&this[a136_0x36cccd(0x177)]||function(_0x4f3a40,_0x555d17,_0x316fc0,_0x53b885){const _0x39f7ea=a136_0x36cccd;var _0x230814=arguments['length'],_0x5c5961=_0x230814<0x3?_0x555d17:_0x53b885===null?_0x53b885=Object['getOwnPropertyDescriptor'](_0x555d17,_0x316fc0):_0x53b885,_0x3c8050;if(typeof Reflect===_0x39f7ea(0x18a)&&typeof Reflect[_0x39f7ea(0x1a1)]===_0x39f7ea(0x183))_0x5c5961=Reflect['decorate'](_0x4f3a40,_0x555d17,_0x316fc0,_0x53b885);else{for(var _0x31dab8=_0x4f3a40['length']-0x1;_0x31dab8>=0x0;_0x31dab8--)if(_0x3c8050=_0x4f3a40[_0x31dab8])_0x5c5961=(_0x230814<0x3?_0x3c8050(_0x5c5961):_0x230814>0x3?_0x3c8050(_0x555d17,_0x316fc0,_0x5c5961):_0x3c8050(_0x555d17,_0x316fc0))||_0x5c5961;}return _0x230814>0x3&&_0x5c5961&&Object[_0x39f7ea(0x19e)](_0x555d17,_0x316fc0,_0x5c5961),_0x5c5961;},__metadata=this&&this[a136_0x36cccd(0x176)]||function(_0x41f639,_0x5f4d6f){const _0x5e4c92=a136_0x36cccd;if(typeof Reflect===_0x5e4c92(0x18a)&&typeof Reflect[_0x5e4c92(0x1b4)]==='function')return Reflect[_0x5e4c92(0x1b4)](_0x41f639,_0x5f4d6f);},__param=this&&this[a136_0x36cccd(0x1b8)]||function(_0x222b91,_0xefb646){return function(_0x163627,_0x556b39){_0xefb646(_0x163627,_0x556b39,_0x222b91);};},SoundService_1;Object[a136_0x36cccd(0x19e)](exports,a136_0x36cccd(0x1a3),{'value':!![]}),exports[a136_0x36cccd(0x18b)]=void 0x0;function a136_0x1774(_0x3432de,_0x4e552a){const _0x4bc540=a136_0x4bc5();return a136_0x1774=function(_0x17744d,_0x2cb576){_0x17744d=_0x17744d-0x174;let _0x400aee=_0x4bc540[_0x17744d];return _0x400aee;},a136_0x1774(_0x3432de,_0x4e552a);}const common_1=require(a136_0x36cccd(0x18e)),mongoose_1=require(a136_0x36cccd(0x1ce)),mongoose_2=require(a136_0x36cccd(0x1cd)),path=require(a136_0x36cccd(0x19f)),event_emitter_1=require('@nestjs/event-emitter'),file_1=require(a136_0x36cccd(0x1a2)),agenda_service_1=require(a136_0x36cccd(0x1d7)),enums_1=require(a136_0x36cccd(0x199)),constants_1=require(a136_0x36cccd(0x1e7)),utils_1=require(a136_0x36cccd(0x1b7)),path_1=require('../common/path'),audio_player_1=require(a136_0x36cccd(0x17e)),sound_1=require(a136_0x36cccd(0x1a5)),job_1=require(a136_0x36cccd(0x1e1)),constants_2=require('./constants'),default_sounds_1=require(a136_0x36cccd(0x1bb)),sound_gateway_1=require('./sound.gateway'),path_2=require(a136_0x36cccd(0x19f)),upload_service_1=require('../upload/upload.service'),text_to_audio_service_1=require(a136_0x36cccd(0x17b)),streaming_service_1=require(a136_0x36cccd(0x17c));let SoundService=SoundService_1=class SoundService{constructor(_0x5a3820,_0x2d4143,_0x305e48,_0x4995f5,_0x1f816a,_0x5c73c9){const _0x5c39c3=a136_0x36cccd;this[_0x5c39c3(0x17f)]=_0x5a3820,this['agendaService']=_0x2d4143,this['uploadService']=_0x305e48,this[_0x5c39c3(0x1d8)]=_0x4995f5,this[_0x5c39c3(0x1b2)]=_0x1f816a,this[_0x5c39c3(0x195)]=_0x5c73c9,this[_0x5c39c3(0x1d1)]=new common_1[(_0x5c39c3(0x1c2))](SoundService_1['name']);}async['create'](_0x5b432b){const _0x54cf4a=a136_0x36cccd;await this[_0x54cf4a(0x1ec)](_0x5b432b,null);const _0x400c38=new this[(_0x54cf4a(0x17f))](_0x5b432b);return _0x400c38[_0x54cf4a(0x1b1)]();}async['findByType'](_0x5921a2){const _0x243235=a136_0x36cccd,_0x451761=await this[_0x243235(0x17f)]['find']({'type':_0x5921a2})[_0x243235(0x184)]();return _0x451761;}async[a136_0x36cccd(0x19c)](_0x2de1cc){const _0x2e37fc=a136_0x36cccd,_0x17b189=await this[_0x2e37fc(0x17f)][_0x2e37fc(0x1a0)](_0x2de1cc);return _0x17b189;}async[a136_0x36cccd(0x1e9)](_0xe679e5){const _0x5574b8=a136_0x36cccd,_0x598da5=await this[_0x5574b8(0x17f)][_0x5574b8(0x1ea)]({'_id':{'$in':_0xe679e5}});return _0x598da5;}async[a136_0x36cccd(0x178)](_0x4b12a5,_0x44139b){const _0x115905=a136_0x36cccd,_0x40c203=await this['soundModel'][_0x115905(0x1a0)](_0x4b12a5)[_0x115905(0x184)]();if(!_0x40c203)throw new Error(_0x115905(0x1e3));await this[_0x115905(0x1ec)](_0x44139b,_0x40c203===null||_0x40c203===void 0x0?void 0x0:_0x40c203['fileName']);const _0x263ad3=await this[_0x115905(0x17f)][_0x115905(0x1a9)](_0x4b12a5,Object[_0x115905(0x1db)](Object['assign']({},_0x44139b),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x263ad3;}async[a136_0x36cccd(0x1e6)](_0x4ea1b9,_0x2363a9){const _0x344847=a136_0x36cccd,_0x4b95af=await this[_0x344847(0x17f)]['findById'](_0x4ea1b9)[_0x344847(0x184)]();if(!_0x4b95af)throw new Error('Sound\x20not\x20found!');const _0x2ff0b8=await this[_0x344847(0x17f)][_0x344847(0x1a9)](_0x4ea1b9,Object[_0x344847(0x1db)](Object[_0x344847(0x1db)]({},_0x2363a9),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x2ff0b8;}async['delete'](_0x31e662){const _0x53527a=a136_0x36cccd,_0x4af81c=await this[_0x53527a(0x17f)][_0x53527a(0x1c0)](_0x31e662);if(_0x4af81c[_0x53527a(0x1af)]){const _0x359422=constants_1[_0x53527a(0x17a)]+'/'+_0x4af81c['fileName'];try{(0x0,file_1[_0x53527a(0x1c4)])(_0x359422);}catch(_0x3a7847){this[_0x53527a(0x1d1)][_0x53527a(0x198)](_0x3a7847);}}return _0x4af81c;}async[a136_0x36cccd(0x187)](_0x23fe57,_0x4ad8a0){const _0x1f500a=a136_0x36cccd,_0x402001=await this['soundModel'][_0x1f500a(0x1a0)](_0x23fe57)[_0x1f500a(0x184)](),_0x13464e=_0x402001===null||_0x402001===void 0x0?void 0x0:_0x402001[_0x1f500a(0x1af)],_0x34c2dd=this[_0x1f500a(0x1bd)](_0x4ad8a0['originalname']),_0x36f351=constants_1[_0x1f500a(0x17a)]+'/'+_0x34c2dd;await(0x0,file_1[_0x1f500a(0x1c7)])(_0x4ad8a0[_0x1f500a(0x19f)],_0x36f351);const _0x1fe79a={'fileName':_0x34c2dd},_0x2f207c=await this[_0x1f500a(0x17f)][_0x1f500a(0x1a9)](_0x23fe57,Object['assign'](Object[_0x1f500a(0x1db)]({},_0x1fe79a),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0x13464e){const _0x58fab5=constants_1[_0x1f500a(0x17a)]+'/'+_0x13464e;(0x0,file_1['deleteFile'])(_0x58fab5);}return _0x2f207c;}async[a136_0x36cccd(0x1a4)](_0x3de3c0){const _0x5e3dea=a136_0x36cccd,{soundId:_0x3494c8,jobId:_0x346614,durationInSecond:_0x5cc56b}=_0x3de3c0,_0x20912a=await this[_0x5e3dea(0x19c)](_0x3494c8),_0xbc837f=path['join'](path_1[_0x5e3dea(0x1c6)],_0x5e3dea(0x1e4),_0x5e3dea(0x1c9),_0x20912a[_0x5e3dea(0x1af)]);if(!(0x0,file_1['isFileExist'])(_0xbc837f)){this[_0x5e3dea(0x1d1)]['error']('Sound\x20file\x20not\x20found:\x20'+_0xbc837f);return;}job_1[_0x5e3dea(0x1d9)][_0x5e3dea(0x188)](),this[_0x5e3dea(0x1d1)][_0x5e3dea(0x1c1)](_0x5e3dea(0x18f)+_0x3494c8+'\x20-\x20'+_0x20912a[_0x5e3dea(0x181)]),(0x0,job_1['executeJob'])({'jobId':_0x346614,'run':()=>audio_player_1[_0x5e3dea(0x182)]['playAsync'](_0xbc837f,_0x20912a[_0x5e3dea(0x1b9)]),'next':()=>this['stop'](_0x3494c8),'durationInSecond':_0x5cc56b}),this['soundGateway'][_0x5e3dea(0x1a6)]({'id':_0x3494c8,'isPlaying':!![]});}async[a136_0x36cccd(0x1cc)](_0x2e5d55){const _0xe10151=a136_0x36cccd,{voiceId:_0x1b7ea5,jobId:_0x502493,durationInSecond:_0x5f1cb2}=_0x2e5d55,_0x10fae4=await this[_0xe10151(0x1e2)][_0xe10151(0x1c8)](_0x1b7ea5),_0x630ad2=_0x10fae4['filePath'],_0x123a63=(0x0,path_2['join'])(process['cwd'](),_0x630ad2);if(!(0x0,file_1['isFileExist'])(_0x123a63)){this[_0xe10151(0x1d1)]['error'](_0xe10151(0x1c3)+_0x123a63);return;}job_1[_0xe10151(0x1d9)][_0xe10151(0x188)](),this[_0xe10151(0x1d1)][_0xe10151(0x1c1)](_0xe10151(0x1d3)+_0x1b7ea5),(0x0,job_1[_0xe10151(0x1dc)])({'jobId':_0x502493,'run':()=>audio_player_1[_0xe10151(0x182)][_0xe10151(0x191)](_0x123a63),'durationInSecond':_0x5f1cb2,'next':()=>null});}async[a136_0x36cccd(0x1d0)](_0xc3a496){const _0x26dcf4=a136_0x36cccd,{textToAudioId:_0x46920f,jobId:_0x19b909,durationInSecond:_0x100560}=_0xc3a496,{message:_0x4fd84a}=await this[_0x26dcf4(0x1d8)]['getMessageById'](_0x46920f);job_1[_0x26dcf4(0x1d9)][_0x26dcf4(0x188)](),(0x0,job_1['executeJob'])({'jobId':_0x19b909,'run':()=>{const _0x4742e4=_0x26dcf4;let _0x3184c5=null;return this[_0x4742e4(0x1d8)][_0x4742e4(0x1d2)](_0x4fd84a,_0x181fdd=>{const _0x14faef=_0x4742e4;_0x3184c5=this[_0x14faef(0x1b2)][_0x14faef(0x1ab)](_0x181fdd);}),_0x3184c5;},'durationInSecond':_0x100560,'next':()=>null});}async['play'](_0x4c8e3e,_0x5da5e5,_0xec33f=![]){const _0x4eb62f=a136_0x36cccd,_0x245509={'when':_0x4eb62f(0x1a8),'jobType':enums_1['JobType']['PlaySound'],'attributes':{'soundId':_0x5da5e5,'durationInSecond':_0xec33f?0x15180:undefined},'audit':{'actor':_0x4c8e3e,'name':enums_1['JobType'][_0x4eb62f(0x1b6)],'message':_0x4eb62f(0x1ac)+_0x5da5e5}},_0x2be814=await this[_0x4eb62f(0x17f)][_0x4eb62f(0x19c)]({'jobId':{'$ne':null}});_0x2be814&&await this[_0x4eb62f(0x1ba)](_0x2be814['id']);const {jobId:_0x5d1405}=await this[_0x4eb62f(0x1e8)]['scheduleJob'](_0x245509);return this[_0x4eb62f(0x178)](_0x5da5e5,{'jobId':_0x5d1405});}async[a136_0x36cccd(0x1ba)](_0x36fd28){const _0x4daaa5=a136_0x36cccd;let _0x5b0236=await this[_0x4daaa5(0x19c)](_0x36fd28);const {jobId:_0x368dbc}=_0x5b0236||{};if(_0x368dbc){const {success:_0x92463a}=await this['agendaService'][_0x4daaa5(0x197)](_0x368dbc);_0x92463a&&(_0x5b0236=await this['update'](_0x36fd28,{'jobId':null}));}return this[_0x4daaa5(0x195)][_0x4daaa5(0x1a6)]({'id':_0x5b0236['id'],'isPlaying':![]}),_0x5b0236;}async['resetTunes'](){const _0x1560c7=a136_0x36cccd,_0x432037=await this[_0x1560c7(0x1e0)](constants_2[_0x1560c7(0x1a7)]['Tune']);if(_0x432037[_0x1560c7(0x1d5)]>0x0){const _0x55f4cb=[];_0x432037[_0x1560c7(0x1d4)](_0x3ee37b=>{const _0x566073=_0x1560c7;_0x55f4cb[_0x566073(0x180)](this['delete'](_0x3ee37b[_0x566073(0x1e5)]));}),await Promise[_0x1560c7(0x1df)](_0x55f4cb);}await(0x0,file_1[_0x1560c7(0x192)])(constants_1[_0x1560c7(0x1ca)],constants_1[_0x1560c7(0x1bc)]);const _0x273363=[];return default_sounds_1['DEFAULT_TUNES'][_0x1560c7(0x1d4)](_0x1cd5d3=>{const _0x1b20fe=_0x1560c7;_0x273363[_0x1b20fe(0x180)](this[_0x1b20fe(0x18d)](Object[_0x1b20fe(0x1db)]({},_0x1cd5d3)));}),await Promise['all'](_0x273363),!![];}[a136_0x36cccd(0x1bd)](_0x52a21e){const _0x1fbf84=a136_0x36cccd,_0x2ae139=_0x52a21e[_0x1fbf84(0x1ae)]('.')['pop']();return(0x0,utils_1[_0x1fbf84(0x1bf)])()+'.'+_0x2ae139;}async[a136_0x36cccd(0x1ec)](_0x1fac56,_0x507a09){const _0x146e8a=a136_0x36cccd;if(!_0x1fac56[_0x146e8a(0x1af)])return;const _0x1d4e05=constants_1[_0x146e8a(0x1bc)]+'/'+_0x1fac56['fileName'],_0x47529e=_0x507a09||this[_0x146e8a(0x1bd)](_0x1fac56[_0x146e8a(0x1af)]),_0x296057=constants_1[_0x146e8a(0x17a)]+'/'+_0x47529e;if(!(0x0,file_1[_0x146e8a(0x1c5)])(_0x1d4e05))throw new Error(_0x146e8a(0x1ad));!(0x0,file_1[_0x146e8a(0x1c5)])(constants_1[_0x146e8a(0x17a)])&&(0x0,file_1['createFolder'])(constants_1[_0x146e8a(0x17a)]),await(0x0,file_1[_0x146e8a(0x1c7)])(_0x1d4e05,_0x296057),_0x1fac56[_0x146e8a(0x1af)]=_0x47529e;}};__decorate([(0x0,event_emitter_1[a136_0x36cccd(0x1dd)])(sound_1['SoundEvent'][a136_0x36cccd(0x186)]),__metadata(a136_0x36cccd(0x185),Function),__metadata(a136_0x36cccd(0x1b0),[Object]),__metadata(a136_0x36cccd(0x1aa),Promise)],SoundService[a136_0x36cccd(0x194)],a136_0x36cccd(0x1a4),null),__decorate([(0x0,event_emitter_1[a136_0x36cccd(0x1dd)])(sound_1['SoundEvent'][a136_0x36cccd(0x19d)]),__metadata(a136_0x36cccd(0x185),Function),__metadata(a136_0x36cccd(0x1b0),[Object]),__metadata(a136_0x36cccd(0x1aa),Promise)],SoundService['prototype'],'playVoiceRecorded',null),__decorate([(0x0,event_emitter_1[a136_0x36cccd(0x1dd)])(sound_1[a136_0x36cccd(0x190)]['TextToAudio']),__metadata('design:type',Function),__metadata(a136_0x36cccd(0x1b0),[Object]),__metadata('design:returntype',Promise)],SoundService[a136_0x36cccd(0x194)],a136_0x36cccd(0x1d0),null),SoundService=SoundService_1=__decorate([(0x0,common_1[a136_0x36cccd(0x19a)])(),__param(0x0,(0x0,mongoose_1['InjectModel'])(a136_0x36cccd(0x19b))),__param(0x5,(0x0,common_1['Inject'])(sound_gateway_1['SoundGateway'])),__metadata(a136_0x36cccd(0x1b0),[mongoose_2[a136_0x36cccd(0x175)],agenda_service_1[a136_0x36cccd(0x1da)],upload_service_1[a136_0x36cccd(0x179)],text_to_audio_service_1[a136_0x36cccd(0x1cb)],streaming_service_1[a136_0x36cccd(0x196)],sound_gateway_1[a136_0x36cccd(0x189)]])],SoundService),exports['SoundService']=SoundService;