'use strict';const a133_0x5f4965=a133_0x108c;(function(_0x1ec46e,_0x2d6463){const _0x258df0=a133_0x108c,_0x5a91e8=_0x1ec46e();while(!![]){try{const _0x5ad695=parseInt(_0x258df0(0x1f0))/0x1+parseInt(_0x258df0(0x22a))/0x2+parseInt(_0x258df0(0x1bd))/0x3*(parseInt(_0x258df0(0x1b6))/0x4)+parseInt(_0x258df0(0x1c0))/0x5+-parseInt(_0x258df0(0x1d9))/0x6+parseInt(_0x258df0(0x1b7))/0x7*(-parseInt(_0x258df0(0x1bb))/0x8)+-parseInt(_0x258df0(0x1ed))/0x9;if(_0x5ad695===_0x2d6463)break;else _0x5a91e8['push'](_0x5a91e8['shift']());}catch(_0x43a5a6){_0x5a91e8['push'](_0x5a91e8['shift']());}}}(a133_0x74cd,0xc3690));function a133_0x74cd(){const _0x5d3410=['../common/path','__param','Voice\x20file\x20not\x20found:\x20','volume','findById','validateAndMoveFileAsync','Injectable','design:paramtypes','create','PlaySound','find','createFolder','../common/events/sound','copyFiles','707650NRWodB','now','mongoose','../agenda/agenda.service','length','cancelJob','./data/default-sounds','soundModel','Sound','12jtrMTM','119LmyjSP','../common/audio/audio-player','streamingService','uuid','425752oEsjYo','play','888387QJclhC','VoiceRecorded','Playing\x20voice\x20recorded:\x20','1366380KmglzC','TMP_UPLOAD_DIR','push','update','exec','__esModule','SoundType','findByIdAndUpdate','function','findByIds','getOwnPropertyDescriptor','Play','AgendaService','audio','__metadata','design:type','uploadService','isFileExist','broadcastPlaying','OnEvent','__decorate','TextToAudioService','../common/file','@nestjs/mongoose','SoundGateway','2158458niUCxe','textToAudioService','decorate','DEFAULT_TUNES_DIR','Inject','executeJob','log','scheduleJob','fileName','JobType','TextToAudio','agendaService','playVoiceRecorded','Sound\x20not\x20found!','findByType','./sound.gateway','\x20-\x20','filePath','join','Model','9459756YSDqDr','_id','killAll','1600462XdCYqr','deleteFile','name','findOne','delete','getNewFileName','@nestjs/common','design:returntype','forEach','logger','playStreamAudioAsync','stop','path','originalname','defineProperty','../common/utils','../common/enums','save','findVoiceRecoredById','playTextToAudioRecorded','../common/job','upload','textToAudio','playAsync','PROCESS_CACHE','AudioPlayer','../upload/upload.service','Tune','StreamingService','../text-to-audio/text-to-audio.service','AUDIO_DIR','File\x20not\x20found!','soundGateway','prototype','./constants','object','Sound\x20file\x20not\x20found:\x20','assign','updateVolume','cwd','error','UploadService','all','metadata'];a133_0x74cd=function(){return _0x5d3410;};return a133_0x74cd();}var __decorate=this&&this[a133_0x5f4965(0x1d4)]||function(_0x5500ae,_0xf76094,_0x480da6,_0x2c21f1){const _0x1a9f55=a133_0x5f4965;var _0xfa4232=arguments[_0x1a9f55(0x22e)],_0x1bb002=_0xfa4232<0x3?_0xf76094:_0x2c21f1===null?_0x2c21f1=Object[_0x1a9f55(0x1ca)](_0xf76094,_0x480da6):_0x2c21f1,_0x556f14;if(typeof Reflect===_0x1a9f55(0x213)&&typeof Reflect[_0x1a9f55(0x1db)]===_0x1a9f55(0x1c8))_0x1bb002=Reflect[_0x1a9f55(0x1db)](_0x5500ae,_0xf76094,_0x480da6,_0x2c21f1);else{for(var _0x71d23f=_0x5500ae[_0x1a9f55(0x22e)]-0x1;_0x71d23f>=0x0;_0x71d23f--)if(_0x556f14=_0x5500ae[_0x71d23f])_0x1bb002=(_0xfa4232<0x3?_0x556f14(_0x1bb002):_0xfa4232>0x3?_0x556f14(_0xf76094,_0x480da6,_0x1bb002):_0x556f14(_0xf76094,_0x480da6))||_0x1bb002;}return _0xfa4232>0x3&&_0x1bb002&&Object['defineProperty'](_0xf76094,_0x480da6,_0x1bb002),_0x1bb002;},__metadata=this&&this[a133_0x5f4965(0x1ce)]||function(_0x4cdccb,_0x50dfde){const _0x519381=a133_0x5f4965;if(typeof Reflect===_0x519381(0x213)&&typeof Reflect[_0x519381(0x21b)]===_0x519381(0x1c8))return Reflect[_0x519381(0x21b)](_0x4cdccb,_0x50dfde);},__param=this&&this[a133_0x5f4965(0x21d)]||function(_0x4f3cd2,_0x4e9e0e){return function(_0x4bcdca,_0x88107a){_0x4e9e0e(_0x4bcdca,_0x88107a,_0x4f3cd2);};},SoundService_1;Object[a133_0x5f4965(0x1fe)](exports,a133_0x5f4965(0x1c5),{'value':!![]}),exports['SoundService']=void 0x0;function a133_0x108c(_0x3ef640,_0x359dce){const _0x74cd87=a133_0x74cd();return a133_0x108c=function(_0x108c75,_0x4acee6){_0x108c75=_0x108c75-0x1b6;let _0x37368b=_0x74cd87[_0x108c75];return _0x37368b;},a133_0x108c(_0x3ef640,_0x359dce);}const common_1=require(a133_0x5f4965(0x1f6)),mongoose_1=require(a133_0x5f4965(0x1d7)),mongoose_2=require(a133_0x5f4965(0x22c)),path=require(a133_0x5f4965(0x1fc)),event_emitter_1=require('@nestjs/event-emitter'),file_1=require(a133_0x5f4965(0x1d6)),agenda_service_1=require(a133_0x5f4965(0x22d)),enums_1=require(a133_0x5f4965(0x200)),constants_1=require('../common/constants'),utils_1=require(a133_0x5f4965(0x1ff)),path_1=require(a133_0x5f4965(0x21c)),audio_player_1=require(a133_0x5f4965(0x1b8)),sound_1=require(a133_0x5f4965(0x228)),job_1=require(a133_0x5f4965(0x204)),constants_2=require(a133_0x5f4965(0x212)),default_sounds_1=require(a133_0x5f4965(0x230)),sound_gateway_1=require(a133_0x5f4965(0x1e8)),path_2=require(a133_0x5f4965(0x1fc)),upload_service_1=require(a133_0x5f4965(0x20a)),text_to_audio_service_1=require(a133_0x5f4965(0x20d)),streaming_service_1=require('../streaming/streaming.service');let SoundService=SoundService_1=class SoundService{constructor(_0x450495,_0x5c8483,_0x372c97,_0x4479cc,_0x3e9d56,_0x44972d){const _0x16fb83=a133_0x5f4965;this[_0x16fb83(0x231)]=_0x450495,this[_0x16fb83(0x1e4)]=_0x5c8483,this[_0x16fb83(0x1d0)]=_0x372c97,this['textToAudioService']=_0x4479cc,this[_0x16fb83(0x1b9)]=_0x3e9d56,this['soundGateway']=_0x44972d,this[_0x16fb83(0x1f9)]=new common_1['Logger'](SoundService_1[_0x16fb83(0x1f2)]);}async[a133_0x5f4965(0x224)](_0x307dd3){const _0x4e9b2c=a133_0x5f4965;await this[_0x4e9b2c(0x221)](_0x307dd3,null);const _0x5c141f=new this[(_0x4e9b2c(0x231))](_0x307dd3);return _0x5c141f[_0x4e9b2c(0x201)]();}async[a133_0x5f4965(0x1e7)](_0x5d6d93){const _0xa078dd=a133_0x5f4965,_0x515fe3=await this[_0xa078dd(0x231)][_0xa078dd(0x226)]({'type':_0x5d6d93})[_0xa078dd(0x1c4)]();return _0x515fe3;}async[a133_0x5f4965(0x1f3)](_0x8ecfdf){const _0x64c91a=a133_0x5f4965,_0x5dc36b=await this[_0x64c91a(0x231)][_0x64c91a(0x220)](_0x8ecfdf);return _0x5dc36b;}async[a133_0x5f4965(0x1c9)](_0x46fd0c){const _0x58f77b=a133_0x5f4965,_0x57cbd1=await this[_0x58f77b(0x231)][_0x58f77b(0x226)]({'_id':{'$in':_0x46fd0c}});return _0x57cbd1;}async[a133_0x5f4965(0x1c3)](_0x26d2ff,_0x1909d2){const _0x2b5701=a133_0x5f4965,_0x23d639=await this[_0x2b5701(0x231)]['findById'](_0x26d2ff)['exec']();if(!_0x23d639)throw new Error(_0x2b5701(0x1e6));await this[_0x2b5701(0x221)](_0x1909d2,_0x23d639===null||_0x23d639===void 0x0?void 0x0:_0x23d639[_0x2b5701(0x1e1)]);const _0xb91f78=await this[_0x2b5701(0x231)]['findByIdAndUpdate'](_0x26d2ff,Object[_0x2b5701(0x215)](Object[_0x2b5701(0x215)]({},_0x1909d2),{'updatedAtUtc':new Date()}),{'new':!![]});return _0xb91f78;}async[a133_0x5f4965(0x216)](_0x2c179d,_0x17bd53){const _0x2bf213=a133_0x5f4965,_0x53f7ab=await this[_0x2bf213(0x231)][_0x2bf213(0x220)](_0x2c179d)[_0x2bf213(0x1c4)]();if(!_0x53f7ab)throw new Error(_0x2bf213(0x1e6));const _0x53f0c3=await this[_0x2bf213(0x231)]['findByIdAndUpdate'](_0x2c179d,Object['assign'](Object[_0x2bf213(0x215)]({},_0x17bd53),{'updatedAtUtc':new Date()}),{'new':!![]});return _0x53f0c3;}async[a133_0x5f4965(0x1f4)](_0x928d4){const _0x568fcd=a133_0x5f4965,_0x56e9d2=await this['soundModel']['findByIdAndDelete'](_0x928d4);if(_0x56e9d2[_0x568fcd(0x1e1)]){const _0x519b5f=constants_1[_0x568fcd(0x20e)]+'/'+_0x56e9d2[_0x568fcd(0x1e1)];try{(0x0,file_1['deleteFile'])(_0x519b5f);}catch(_0x49e021){this['logger']['error'](_0x49e021);}}return _0x56e9d2;}async[a133_0x5f4965(0x205)](_0xfc69ce,_0x13888b){const _0x140d9b=a133_0x5f4965,_0x5ed272=await this[_0x140d9b(0x231)][_0x140d9b(0x220)](_0xfc69ce)[_0x140d9b(0x1c4)](),_0x3255be=_0x5ed272===null||_0x5ed272===void 0x0?void 0x0:_0x5ed272[_0x140d9b(0x1e1)],_0x30cc72=this[_0x140d9b(0x1f5)](_0x13888b[_0x140d9b(0x1fd)]),_0x1bdd65=constants_1[_0x140d9b(0x20e)]+'/'+_0x30cc72;await(0x0,file_1['moveFile'])(_0x13888b['path'],_0x1bdd65);const _0x3fcfc0={'fileName':_0x30cc72},_0x309d4d=await this[_0x140d9b(0x231)][_0x140d9b(0x1c7)](_0xfc69ce,Object[_0x140d9b(0x215)](Object[_0x140d9b(0x215)]({},_0x3fcfc0),{'updatedAtUtc':new Date()}),{'new':!![]});if(_0x3255be){const _0x214704=constants_1[_0x140d9b(0x20e)]+'/'+_0x3255be;(0x0,file_1[_0x140d9b(0x1f1)])(_0x214704);}return _0x309d4d;}async['playSoundOnEvent'](_0x10d4fc){const _0xa7a5d7=a133_0x5f4965,{soundId:_0x5e02c5,jobId:_0x522ad2,durationInSecond:_0x56e906}=_0x10d4fc,_0x39d05f=await this[_0xa7a5d7(0x1f3)](_0x5e02c5),_0x1d3600=path[_0xa7a5d7(0x1eb)](path_1['processRootPath'],'assets',_0xa7a5d7(0x1cd),_0x39d05f['fileName']);if(!(0x0,file_1['isFileExist'])(_0x1d3600)){this['logger'][_0xa7a5d7(0x218)](_0xa7a5d7(0x214)+_0x1d3600);return;}job_1[_0xa7a5d7(0x208)][_0xa7a5d7(0x1ef)](),this[_0xa7a5d7(0x1f9)][_0xa7a5d7(0x1df)]('Playing\x20sound:\x20'+_0x5e02c5+_0xa7a5d7(0x1e9)+_0x39d05f[_0xa7a5d7(0x1f2)]),(0x0,job_1[_0xa7a5d7(0x1de)])({'jobId':_0x522ad2,'run':()=>audio_player_1[_0xa7a5d7(0x209)][_0xa7a5d7(0x207)](_0x1d3600,_0x39d05f[_0xa7a5d7(0x21f)]),'next':()=>this[_0xa7a5d7(0x1fb)](_0x5e02c5),'durationInSecond':_0x56e906}),this[_0xa7a5d7(0x210)][_0xa7a5d7(0x1d2)]({'id':_0x5e02c5,'isPlaying':!![]});}async[a133_0x5f4965(0x1e5)](_0x344155){const _0x495d7b=a133_0x5f4965,{voiceId:_0x34d121,jobId:_0x518712,durationInSecond:_0x316e42}=_0x344155,_0x1fb4c0=await this[_0x495d7b(0x1d0)][_0x495d7b(0x202)](_0x34d121),_0x44e5d9=_0x1fb4c0[_0x495d7b(0x1ea)],_0x8ca56d=(0x0,path_2[_0x495d7b(0x1eb)])(process[_0x495d7b(0x217)](),_0x44e5d9);if(!(0x0,file_1['isFileExist'])(_0x8ca56d)){this[_0x495d7b(0x1f9)][_0x495d7b(0x218)](_0x495d7b(0x21e)+_0x8ca56d);return;}job_1['PROCESS_CACHE'][_0x495d7b(0x1ef)](),this[_0x495d7b(0x1f9)][_0x495d7b(0x1df)](_0x495d7b(0x1bf)+_0x34d121),(0x0,job_1[_0x495d7b(0x1de)])({'jobId':_0x518712,'run':()=>audio_player_1['AudioPlayer'][_0x495d7b(0x207)](_0x8ca56d),'durationInSecond':_0x316e42,'next':()=>null});}async[a133_0x5f4965(0x203)](_0x236a41){const _0x5409f1=a133_0x5f4965,{textToAudioId:_0x2ecf03,jobId:_0x12d431,durationInSecond:_0x24230d}=_0x236a41,{message:_0x3b3a5e}=await this['textToAudioService']['getMessageById'](_0x2ecf03);job_1[_0x5409f1(0x208)][_0x5409f1(0x1ef)](),(0x0,job_1[_0x5409f1(0x1de)])({'jobId':_0x12d431,'run':()=>{const _0x1d6657=_0x5409f1;let _0xc3f7a9=null;return this[_0x1d6657(0x1da)][_0x1d6657(0x206)](_0x3b3a5e,_0x55f682=>{const _0x3183f4=_0x1d6657;_0xc3f7a9=this[_0x3183f4(0x1b9)][_0x3183f4(0x1fa)](_0x55f682);}),_0xc3f7a9;},'durationInSecond':_0x24230d,'next':()=>null});}async[a133_0x5f4965(0x1bc)](_0x390b49,_0x29f6ba,_0x32cf88=![]){const _0x3fe7e1=a133_0x5f4965,_0x4a987a={'when':_0x3fe7e1(0x22b),'jobType':enums_1[_0x3fe7e1(0x1e2)][_0x3fe7e1(0x225)],'attributes':{'soundId':_0x29f6ba,'durationInSecond':_0x32cf88?0x15180:undefined},'audit':{'actor':_0x390b49,'name':enums_1['JobType'][_0x3fe7e1(0x225)],'message':'Play\x20sound:\x20'+_0x29f6ba}},_0x554dde=await this['soundModel'][_0x3fe7e1(0x1f3)]({'jobId':{'$ne':null}});_0x554dde&&await this['stop'](_0x554dde['id']);const {jobId:_0x21d25c}=await this['agendaService'][_0x3fe7e1(0x1e0)](_0x4a987a);return this['update'](_0x29f6ba,{'jobId':_0x21d25c});}async[a133_0x5f4965(0x1fb)](_0x44971f){const _0x1f5dc5=a133_0x5f4965;let _0x489396=await this[_0x1f5dc5(0x1f3)](_0x44971f);const {jobId:_0x2470ae}=_0x489396||{};if(_0x2470ae){const {success:_0x427a39}=await this[_0x1f5dc5(0x1e4)][_0x1f5dc5(0x22f)](_0x2470ae);_0x427a39&&(_0x489396=await this['update'](_0x44971f,{'jobId':null}));}return this[_0x1f5dc5(0x210)][_0x1f5dc5(0x1d2)]({'id':_0x489396['id'],'isPlaying':![]}),_0x489396;}async['resetTunes'](){const _0x2944d5=a133_0x5f4965,_0x439d06=await this[_0x2944d5(0x1e7)](constants_2[_0x2944d5(0x1c6)][_0x2944d5(0x20b)]);if(_0x439d06['length']>0x0){const _0x386943=[];_0x439d06[_0x2944d5(0x1f8)](_0x5ed5a6=>{const _0x46343c=_0x2944d5;_0x386943['push'](this[_0x46343c(0x1f4)](_0x5ed5a6[_0x46343c(0x1ee)]));}),await Promise[_0x2944d5(0x21a)](_0x386943);}await(0x0,file_1[_0x2944d5(0x229)])(constants_1[_0x2944d5(0x1dc)],constants_1['TMP_UPLOAD_DIR']);const _0x59459a=[];return default_sounds_1['DEFAULT_TUNES']['forEach'](_0x672099=>{const _0x247dea=_0x2944d5;_0x59459a[_0x247dea(0x1c2)](this[_0x247dea(0x224)](Object[_0x247dea(0x215)]({},_0x672099)));}),await Promise[_0x2944d5(0x21a)](_0x59459a),!![];}['getNewFileName'](_0x44ab0b){const _0x2cd272=a133_0x5f4965,_0x463aef=_0x44ab0b['split']('.')['pop']();return(0x0,utils_1[_0x2cd272(0x1ba)])()+'.'+_0x463aef;}async['validateAndMoveFileAsync'](_0x5b0634,_0x4cd501){const _0x532104=a133_0x5f4965;if(!_0x5b0634[_0x532104(0x1e1)])return;const _0x5a9a7c=constants_1[_0x532104(0x1c1)]+'/'+_0x5b0634[_0x532104(0x1e1)],_0x33eea7=_0x4cd501||this['getNewFileName'](_0x5b0634[_0x532104(0x1e1)]),_0x57556d=constants_1[_0x532104(0x20e)]+'/'+_0x33eea7;if(!(0x0,file_1[_0x532104(0x1d1)])(_0x5a9a7c))throw new Error(_0x532104(0x20f));!(0x0,file_1[_0x532104(0x1d1)])(constants_1['AUDIO_DIR'])&&(0x0,file_1[_0x532104(0x227)])(constants_1[_0x532104(0x20e)]),await(0x0,file_1['moveFile'])(_0x5a9a7c,_0x57556d),_0x5b0634['fileName']=_0x33eea7;}};__decorate([(0x0,event_emitter_1[a133_0x5f4965(0x1d3)])(sound_1['SoundEvent'][a133_0x5f4965(0x1cb)]),__metadata('design:type',Function),__metadata(a133_0x5f4965(0x223),[Object]),__metadata(a133_0x5f4965(0x1f7),Promise)],SoundService[a133_0x5f4965(0x211)],'playSoundOnEvent',null),__decorate([(0x0,event_emitter_1['OnEvent'])(sound_1['SoundEvent'][a133_0x5f4965(0x1be)]),__metadata(a133_0x5f4965(0x1cf),Function),__metadata(a133_0x5f4965(0x223),[Object]),__metadata(a133_0x5f4965(0x1f7),Promise)],SoundService[a133_0x5f4965(0x211)],a133_0x5f4965(0x1e5),null),__decorate([(0x0,event_emitter_1[a133_0x5f4965(0x1d3)])(sound_1['SoundEvent'][a133_0x5f4965(0x1e3)]),__metadata(a133_0x5f4965(0x1cf),Function),__metadata(a133_0x5f4965(0x223),[Object]),__metadata(a133_0x5f4965(0x1f7),Promise)],SoundService[a133_0x5f4965(0x211)],'playTextToAudioRecorded',null),SoundService=SoundService_1=__decorate([(0x0,common_1[a133_0x5f4965(0x222)])(),__param(0x0,(0x0,mongoose_1['InjectModel'])(a133_0x5f4965(0x232))),__param(0x5,(0x0,common_1[a133_0x5f4965(0x1dd)])(sound_gateway_1[a133_0x5f4965(0x1d8)])),__metadata('design:paramtypes',[mongoose_2[a133_0x5f4965(0x1ec)],agenda_service_1[a133_0x5f4965(0x1cc)],upload_service_1[a133_0x5f4965(0x219)],text_to_audio_service_1[a133_0x5f4965(0x1d5)],streaming_service_1[a133_0x5f4965(0x20c)],sound_gateway_1[a133_0x5f4965(0x1d8)]])],SoundService),exports['SoundService']=SoundService;